function md5cycle(e,t){var o=e[0],n=e[1],i=e[2],r=e[3];o=ff(o,n,i,r,t[0],7,-680876936),r=ff(r,o,n,i,t[1],12,-389564586),i=ff(i,r,o,n,t[2],17,606105819),n=ff(n,i,r,o,t[3],22,-1044525330),o=ff(o,n,i,r,t[4],7,-176418897),r=ff(r,o,n,i,t[5],12,1200080426),i=ff(i,r,o,n,t[6],17,-1473231341),n=ff(n,i,r,o,t[7],22,-45705983),o=ff(o,n,i,r,t[8],7,1770035416),r=ff(r,o,n,i,t[9],12,-1958414417),i=ff(i,r,o,n,t[10],17,-42063),n=ff(n,i,r,o,t[11],22,-1990404162),o=ff(o,n,i,r,t[12],7,1804603682),r=ff(r,o,n,i,t[13],12,-40341101),i=ff(i,r,o,n,t[14],17,-1502002290),n=ff(n,i,r,o,t[15],22,1236535329),o=gg(o,n,i,r,t[1],5,-165796510),r=gg(r,o,n,i,t[6],9,-1069501632),i=gg(i,r,o,n,t[11],14,643717713),n=gg(n,i,r,o,t[0],20,-373897302),o=gg(o,n,i,r,t[5],5,-701558691),r=gg(r,o,n,i,t[10],9,38016083),i=gg(i,r,o,n,t[15],14,-660478335),n=gg(n,i,r,o,t[4],20,-405537848),o=gg(o,n,i,r,t[9],5,568446438),r=gg(r,o,n,i,t[14],9,-1019803690),i=gg(i,r,o,n,t[3],14,-187363961),n=gg(n,i,r,o,t[8],20,1163531501),o=gg(o,n,i,r,t[13],5,-1444681467),r=gg(r,o,n,i,t[2],9,-51403784),i=gg(i,r,o,n,t[7],14,1735328473),n=gg(n,i,r,o,t[12],20,-1926607734),o=hh(o,n,i,r,t[5],4,-378558),r=hh(r,o,n,i,t[8],11,-2022574463),i=hh(i,r,o,n,t[11],16,1839030562),n=hh(n,i,r,o,t[14],23,-35309556),o=hh(o,n,i,r,t[1],4,-1530992060),r=hh(r,o,n,i,t[4],11,1272893353),i=hh(i,r,o,n,t[7],16,-155497632),n=hh(n,i,r,o,t[10],23,-1094730640),o=hh(o,n,i,r,t[13],4,681279174),r=hh(r,o,n,i,t[0],11,-358537222),i=hh(i,r,o,n,t[3],16,-722521979),n=hh(n,i,r,o,t[6],23,76029189),o=hh(o,n,i,r,t[9],4,-640364487),r=hh(r,o,n,i,t[12],11,-421815835),i=hh(i,r,o,n,t[15],16,530742520),n=hh(n,i,r,o,t[2],23,-995338651),o=ii(o,n,i,r,t[0],6,-198630844),r=ii(r,o,n,i,t[7],10,1126891415),i=ii(i,r,o,n,t[14],15,-1416354905),n=ii(n,i,r,o,t[5],21,-57434055),o=ii(o,n,i,r,t[12],6,1700485571),r=ii(r,o,n,i,t[3],10,-1894986606),i=ii(i,r,o,n,t[10],15,-1051523),n=ii(n,i,r,o,t[1],21,-2054922799),o=ii(o,n,i,r,t[8],6,1873313359),r=ii(r,o,n,i,t[15],10,-30611744),i=ii(i,r,o,n,t[6],15,-1560198380),n=ii(n,i,r,o,t[13],21,1309151649),o=ii(o,n,i,r,t[4],6,-145523070),r=ii(r,o,n,i,t[11],10,-1120210379),i=ii(i,r,o,n,t[2],15,718787259),n=ii(n,i,r,o,t[9],21,-343485551),e[0]=add32(o,e[0]),e[1]=add32(n,e[1]),e[2]=add32(i,e[2]),e[3]=add32(r,e[3])}function cmn(e,t,o,n,i,r){return t=add32(add32(t,e),add32(n,r)),add32(t<<i|t>>>32-i,o)}function ff(e,t,o,n,i,r,a){return cmn(t&o|~t&n,e,t,i,r,a)}function gg(e,t,o,n,i,r,a){return cmn(t&n|o&~n,e,t,i,r,a)}function hh(e,t,o,n,i,r,a){return cmn(t^o^n,e,t,i,r,a)}function ii(e,t,o,n,i,r,a){return cmn(o^(t|~n),e,t,i,r,a)}function md51(e){txt="";var t,o=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)md5cycle(n,md5blk(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(md5cycle(n,i),t=0;t<16;t++)i[t]=0;return i[14]=8*o,md5cycle(n,i),n}function md5blk(e){var t,o=[];for(t=0;t<64;t+=4)o[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return o}function rhex(e){for(var t="",o=0;o<4;o++)t+=hex_chr[e>>8*o+4&15]+hex_chr[e>>8*o&15];return t}function hex(e){for(var t=0;t<e.length;t++)e[t]=rhex(e[t]);return e.join("")}function md5(e){try{return hex(md51(e))}catch(t){return function(e){return require("common").common.PutToDebugLogException(2,"md5: md5",e)}}}function add32(e,t){return e+t&4294967295}function add32(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}(function(){"use strict";function e(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function t(e,t,o){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&o&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&o&&(e=e.replace(RegExp(t,"i"),o)),e=n(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function o(e,t){var o=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=f)for(;++o<n;)t(e[o],o,e);else i(e,t)}function n(t){return t=c(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:e(t)}function i(e,t){for(var o in e)_.call(e,o)&&t(e[o],o,e)}function r(t){return null==t?e(t):E.call(t).slice(8,-1)}function a(e,t){var o=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(o)||"object"==o&&!e[t])}function s(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function l(e,t){var n=null;return o(e,function(o,i){n=t(n,o,i,e)}),n}function c(e){return String(e).replace(/^ +| +$/g,"")}function u(e){function o(t){return l(t,function(t,o){var i=o.pattern||s(o);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(o.label&&!RegExp(i,"i").test(o.label)?o.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),o=o.label||o,t=n(t[0].replace(RegExp(i,"i"),o).replace(RegExp("; *(?:"+o+"[_-])?","i")," ").replace(RegExp("("+o+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function m(){return this.description||""}var d=g,p=e&&"object"==typeof e&&"String"!=r(e);p&&(d=e,e=null);var h=d.navigator||{},f=h.userAgent||"";e||(e=f);var v,_,T=p?!!h.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(E.toString()),P=p?"Object":"ScriptBridgingProxyObject",S=p?"Object":"Environment",N=p&&d.java?"JavaPackage":r(d.java),w=p?"Object":"RuntimeObject",I=/\bJava/.test(N)&&d.java,C=I&&r(d.environment)==S,R=I?"a":"α",y=I?"b":"β",L=d.document||{},D=d.operamini||d.opera,G=b.test(G=p&&D?D["[[Class]]"]:r(D))?G:D=null,x=e,O=[],A=null,k=e==f,U=k&&D&&"function"==typeof D.version&&D.version(),V=function(t){return l(t,function(t,o){return t||RegExp("\\b"+(o.pattern||s(o))+"\\b","i").exec(e)&&(o.label||o)})}([{label:"EdgeHTML",pattern:"(?:Edge|EdgA|EdgiOS)"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),W=function(t){return l(t,function(t,o){return t||RegExp("\\b"+(o.pattern||s(o))+"\\b","i").exec(e)&&(o.label||o)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),M=o([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),F=function(t){return l(t,function(t,o,n){return t||(o[M]||o[/^[a-z]+(?: +[a-z]+\b)*/i.exec(M)]||RegExp("\\b"+s(n)+"(?:\\b|\\w*\\d)","i").exec(e))&&n})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),H=function(o){return l(o,function(o,n){var i=n.pattern||s(n);return!o&&(o=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(o=t(o,i,n.label||n)),o})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(V&&(V=[V]),F&&!M&&(M=o([F])),(v=/\bGoogle TV\b/.exec(M))&&(M=v[0]),/\bSimulator\b/i.test(e)&&(M=(M?M+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(e)&&O.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(e)?(v=u(e.replace(/like iPhone OS/,"")),F=v.manufacturer,M=v.product):/^iP/.test(M)?(W||(W="Safari"),H="iOS"+((v=/ OS ([\d_]+)/i.exec(e))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"!=W||/buntu/i.test(H)?F&&"Google"!=F&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(M))||/\bAndroid\b/.test(H)&&/^Chrome/.test(W)&&/\bVersion\//i.test(e)?(W="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):"Silk"==W?(/\bMobi/i.test(e)||(H="Android",O.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&O.unshift("accelerated")):"PaleMoon"==W&&(v=/\bFirefox\/([\d.]+)\b/.exec(e))?O.push("identifying as Firefox "+v[1]):"Firefox"==W&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(H||(H="Firefox OS"),M||(M=v[1])):!W||(v=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!M&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(v+"/")+8))&&(W=null),(v=M||F||H)&&(M||F||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:v)+" Browser")):"Electron"==W&&(v=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&O.push("Chromium "+v):H="Kubuntu",U||(U=function(t){return l(t,function(t,o){return t||(RegExp(o+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",s(W),"(?:Firefox|Minefield|NetFront)"])),(v="iCab"==V&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(W)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(V)&&"WebKit"||!V&&/\bMSIE\b/i.test(e)&&("Mac OS"==H?"Tasman":"Trident")||"WebKit"==V&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&(V=[v]),"IE"==W&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(W+=" Mobile",H="Windows Phone "+(/\+$/.test(v)?v:v+".x"),O.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(W="IE Mobile",H="Windows Phone 8.x",O.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=W&&"Trident"==V&&(v=/\brv:([\d.]+)/.exec(e))&&(W&&O.push("identifying as "+W+(U?" "+U:"")),W="IE",U=v[1]),k){if(a(d,"global"))if(I&&(v=I.lang.System,x=v.getProperty("os.arch"),H=H||v.getProperty("os.name")+" "+v.getProperty("os.version")),C){try{U=d.require("ringo/engine").version.join("."),W="RingoJS"}catch(B){(v=d.system)&&v.global.system==d.system&&(W="Narwhal",H||(H=v[0].os||null))}W||(W="Rhino")}else"object"==typeof d.process&&!d.process.browser&&(v=d.process)&&("object"==typeof v.versions&&("string"==typeof v.versions.electron?(O.push("Node "+v.versions.node),W="Electron",U=v.versions.electron):"string"==typeof v.versions.nw&&(O.push("Chromium "+U,"Node "+v.versions.node),W="NW.js",U=v.versions.nw)),W||(W="Node.js",x=v.arch,H=v.platform,U=/[\d.]+/.exec(v.version),U=U?U[0]:null));else r(v=d.runtime)==P?(W="Adobe AIR",H=v.flash.system.Capabilities.os):r(v=d.phantom)==w?(W="PhantomJS",U=(v=v.version||null)&&v.major+"."+v.minor+"."+v.patch):"number"==typeof L.documentMode&&(v=/\bTrident\/(\d+)/i.exec(e))?(U=[U,L.documentMode],(v=+v[1]+4)!=U[1]&&(O.push("IE "+U[1]+" mode"),V&&(V[1]=""),U[1]=v),U="IE"==W?String(U[1].toFixed(1)):U[0]):"number"==typeof L.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(O.push("masking as "+W+" "+U),W="IE",U="11.0",V=["Trident"],H="Windows");H=H&&n(H)}if(U&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(k&&h.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(A=/b/i.test(v)?"beta":"alpha",U=U.replace(RegExp(v+"\\+?$"),"")+("beta"==A?y:R)+(/\d+\+?/.exec(v)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS)\b/.test(H))W="Firefox Mobile";else if("Maxthon"==W&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(M))"Xbox 360"==M&&(H=null),"Xbox 360"==M&&/\bIEMobile\b/.test(e)&&O.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||M||/Browser|Mobi/.test(W))||"Windows CE"!=H&&!/Mobi/i.test(e))if("IE"==W&&k)try{null===d.external&&O.unshift("platform preview")}catch(B){O.unshift("embedded")}else(/\bBlackBerry\b/.test(M)||/\bBB10\b/.test(e))&&(v=(RegExp(M.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||U)?(v=[v,/BB10/.test(e)],H=(v[1]?(M=null,F="BlackBerry"):"Device Software")+" "+v[0],U=null):this!=i&&"Wii"!=M&&(k&&D||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(H)||"IE"==W&&(H&&!/^Win/.test(H)&&U>5.5||/\bWindows XP\b/.test(H)&&U>8||8==U&&!/\bTrident\b/.test(e)))&&!b.test(v=u.call(i,e.replace(b,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),b.test(W)?(/\bIE\b/.test(v)&&"Mac OS"==H&&(H=null),v="identify"+v):(v="mask"+v,W=G?n(G.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(H=null),k||(U=null)),V=["Presto"],O.push(v));else W+=" Mobile";(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v],"Safari"==W&&"+"==v[1].slice(-1)?(W="WebKit Nightly",A="alpha",U=v[1].slice(0,-1)):U!=v[1]&&U!=(v[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(U=null),v[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==v[0]&&537.36==v[2]&&parseFloat(v[1])>=28&&"WebKit"==V&&(V=["Blink"]),k&&(T||v[1])?(V&&(V[1]="like Chrome"),v=v[1]||(v=v[0],v<530?1:v<532?2:v<532.05?3:v<533?4:v<534.03?5:v<534.07?6:v<534.1?7:v<534.13?8:v<534.16?9:v<534.24?10:v<534.3?11:v<535.01?12:v<535.02?"13+":v<535.07?15:v<535.11?16:v<535.19?17:v<536.05?18:v<536.1?19:v<537.01?20:v<537.11?"21+":v<537.13?23:v<537.18?24:v<537.24?25:v<537.36?26:"Blink"!=V?"27":"28")):(V&&(V[1]="like Safari"),v=v[0],v=v<400?1:v<500?2:v<526?3:v<533?4:v<534?"4+":v<535?5:v<537?6:v<538?7:v<601?8:"8"),V&&(V[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+")),"Safari"==W&&(!U||parseInt(U)>45)&&(U=v)),"Opera"==W&&(v=/\bzbov|zvav$/.exec(H))?(W+=" ",O.unshift("desktop mode"),"zvav"==v?(W+="Mini",U=null):W+="Mobile",H=H.replace(RegExp(" *"+v+"$"),"")):"Safari"==W&&/\bChrome\b/.exec(V&&V[1])&&(O.unshift("desktop mode"),W="Chrome Mobile",U=null,/\bOS X\b/.test(H)?(F="Apple",H="iOS 4.3+"):H=null),U&&0==U.indexOf(v=/[\d.]+$/.exec(H))&&e.indexOf("/"+v+"-")>-1&&(H=c(H.replace(v,""))),V&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(H)&&/\bSafari\b/.test(V[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W)&&V[1])&&(v=V[V.length-1])&&O.push(v),O.length&&(O=["("+O.join("; ")+")"]),F&&M&&M.indexOf(F)<0&&O.push("on "+F),M&&O.push((/^on /.test(O[O.length-1])?"":"on ")+M),H&&(v=/ ([\d.+]+)$/.exec(H),_=v&&"/"==H.charAt(H.length-v[0].length-1),H={architecture:32,family:v&&!_?H.replace(v[0],""):H,version:v?v[1]:null,toString:function(){var e=this.version;return this.family+(e&&!_?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(x))&&!/\bi686\b/i.test(x)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+v),"")),W&&(/\bWOW64\b/i.test(e)||k&&/\w(?:86|32)$/.test(h.cpuClass||h.platform)&&!/\bWin64; x64\b/i.test(e))&&O.unshift("32-bit")):H&&/^OS X/.test(H.family)&&"Chrome"==W&&parseFloat(U)>=39&&(H.architecture=64),e||(e=null);var j={};return j.description=e,j.layout=V&&V[0],j.manufacturer=F,j.name=W,j.prerelease=A,j.product=M,j.ua=e,j.version=W&&U,j.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},j.parse=u,j.toString=m,j.version&&O.unshift(U),j.name&&O.unshift(W),H&&W&&(H!=String(H).split(" ")[0]||H!=W.split(" ")[0]&&!M)&&O.push(M?"("+H+")":"on "+H),O.length&&(j.description=O.join(" ")),j}var m={"function":!0,object:!0},g=m[typeof window]&&window||this,d=m[typeof exports]&&exports,p=m[typeof module]&&module&&!module.nodeType&&module,h=d&&p&&"object"==typeof global&&global;!h||h.global!==h&&h.window!==h&&h.self!==h||(g=h);var f=Math.pow(2,53)-1,b=/\bOpera/,v=Object.prototype,_=v.hasOwnProperty,E=v.toString,T=u();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(g.platform=T,define(function(){return T})):d&&p?i(T,function(e,t){d[t]=e}):g.platform=T}).call(this),function(e,t){"use strict";e.picoModal=function(){"use strict";function e(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType}function t(e){return"string"==typeof e}function o(){var e=[];return{watch:e.push.bind(e),trigger:function(t){for(var o=!0,n={preventDefault:function(){o=!1}},i=0;i<e.length;i++)e[i](t,n);return o}}}function n(e){this.elem=e}function i(e,t){return n.div().clazz("pico-overlay").clazz(e("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(e("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){e("overlayClose",!0)&&t()})}function r(e,t){var o=e("width","auto");return"number"==typeof o&&(o+="px"),n.div().clazz("pico-content").clazz(e("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"50px",width:o,"-ms-transform":"translateX(-50%)","-moz-transform":"translateX(-50%)","-webkit-transform":"translateX(-50%)","-o-transform":"translateX(-50%)",transform:"translateX(-50%)"}).stylize(e("modalStyles",{backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(e("content")).attr("role","dialog").onClick(function(e){new n(e.target).anyAncestor(function(e){return/\bpico-close\b/.test(e.elem.className)})&&t()})}function a(e,t){if(t("closeButton",!0))return e.child().html(t("closeHtml","&#xD7;")).clazz("pico-close").clazz(t("closeClass")).stylize(t("closeStyles",{borderRadius:"2px",cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"}))}function s(e){return function(){return e().elem}}return n.div=function(e){var t=document.createElement("div");return(e||document.body).appendChild(t),new n(t)},n.prototype={child:function(){return n.div(this.elem)},stylize:function(e){e=e||{},"undefined"!=typeof e.opacity&&(e.filter="alpha(opacity="+100*e.opacity+")");for(var t in e)e.hasOwnProperty(t)&&(this.elem.style[t]=e[t]);return this},clazz:function(e){return this.elem.className+=" "+e,this},html:function(t){return e(t)?this.elem.appendChild(t):this.elem.innerHTML=t,this},onClick:function(e){return this.elem.addEventListener("click",e),this},destroy:function(){document.body.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(e,t){return this.elem.setAttribute(e,t),this},anyAncestor:function(e){for(var t=this.elem;t;){if(e(new n(t)))return!0;t=t.parentNode}return!1}},function(n){function l(e,t){var o=n[e];return"function"==typeof o&&(o=o(t)),o===undefined?t:o}function c(){E().hide(),_().hide(),v.trigger(P)}function u(){b.trigger(P)&&c()}function m(e){return function(){return e.apply(this,arguments),P}}function g(e){if(!d){var t=r(l,u);d={modal:t,overlay:i(l,u),close:a(t,l)},p.trigger(P)}return d[e]}(t(n)||e(n))&&(n={content:n});var d,p=o(),h=o(),f=o(),b=o(),v=o(),_=g.bind(window,"modal"),E=g.bind(window,"overlay"),T=g.bind(window,"close"),P={modalElem:s(_),closeElem:s(T),overlayElem:s(E),buildDom:m(g),show:function(){return h.trigger(P)&&(E().show(),T(),_().show(),f.trigger(P)),this},close:m(u),forceClose:m(c),destroy:function(){_=_().destroy(),E=E().destroy(),T=undefined},options:function(e){n=e},afterCreate:m(p.watch),beforeShow:m(h.watch),afterShow:m(f.watch),beforeClose:m(b.watch),afterClose:m(v.watch)};return P}}()}(this);var swfobject=function(){function e(){if(!M){try{var e=x.getElementsByTagName("body")[0].appendChild(f("span"));e.parentNode.removeChild(e)}catch(n){return}M=!0;for(var t=k.length,o=0;o<t;o++)k[o]()}}function t(e){M?e():k[k.length]=e}function o(e){if(typeof G.addEventListener!=R)G.addEventListener("load",e,!1);else if(typeof x.addEventListener!=R)x.addEventListener("load",e,!1);else if(typeof G.attachEvent!=R)b(G,"onload",e);else if("function"==typeof G.onload){var t=G.onload;G.onload=function(){t(),e()}}else G.onload=e}function n(){A?i():r()}function i(){if(!0!==webphone_api.flashdeepdetect)return void r();var e=x.getElementsByTagName("body")[0],t=f(y);t.setAttribute("type",L);var o=e.appendChild(t);if(o){var n=0;!function(){if(typeof o.GetVariable!=R){var i=o.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),j.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(n<10)return n++,void setTimeout(arguments.callee,10);e.removeChild(t),o=null,r()}()}else r()}function r(){var e=U.length;if(e>0)for(var t=0;t<e;t++){var o=U[t].id,n=U[t].callbackFn,i={success:!1,id:o};if(j.pv[0]>0){var r=h(o);if(r)if(!v(U[t].swfVersion)||j.wk&&j.wk<312)if(U[t].expressInstall&&s()){var u={};u.data=U[t].expressInstall,u.width=r.getAttribute("width")||"0",u.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(u.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(u.align=r.getAttribute("align"));for(var m={},g=r.getElementsByTagName("param"),d=g.length,p=0;p<d;p++)"movie"!=g[p].getAttribute("name").toLowerCase()&&(m[g[p].getAttribute("name")]=g[p].getAttribute("value"));l(u,m,o,n)}else c(r),n&&n(i);else E(o,!0),n&&(i.success=!0,i.ref=a(o),n(i))}else if(E(o,!0),n){var f=a(o);f&&typeof f.SetVariable!=R&&(i.success=!0,i.ref=f),n(i)}}}function a(e){var t=null,o=h(e);if(o&&"OBJECT"==o.nodeName)if(typeof o.SetVariable!=R)t=o;else{var n=o.getElementsByTagName(y)[0];n&&(t=n)}return t}function s(){return!F&&v("6.0.65")&&(j.win||j.mac)&&!(j.wk&&j.wk<312)}function l(e,t,o,n){F=!0,N=n||null,w={success:!1,id:o};var i=h(o);if(i){"OBJECT"==i.nodeName?(P=u(i),S=null):(P=i,S=o),e.id=D,(typeof e.width==R||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==R||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),x.title=x.title.slice(0,47)+" - Flash Player Installation";var r=j.ie&&j.win?"ActiveX":"PlugIn",a="MMredirectURL="+encodeURI(G.location).toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+x.title;if(typeof t.flashvars!=R?t.flashvars+="&"+a:t.flashvars=a,j.ie&&j.win&&4!=i.readyState){var s=f("div");o+="SWFObjectNew",s.setAttribute("id",o),i.parentNode.insertBefore(s,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}m(e,t,o)}}function c(e){if(j.ie&&j.win&&4!=e.readyState){var t=f("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=f("div");if(j.win&&j.ie)t.innerHTML=e.innerHTML;else{var o=e.getElementsByTagName(y)[0];if(o){var n=o.childNodes;if(n)for(var i=n.length,r=0;r<i;r++)1==n[r].nodeType&&"PARAM"==n[r].nodeName||8==n[r].nodeType||t.appendChild(n[r].cloneNode(!0))}}return t}function m(e,t,o){var n,i=h(o);if(j.wk&&j.wk<312)return n;if(i)if(typeof e.id==R&&(e.id=o),j.ie&&j.win){var r="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?r+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(r+=" "+a+'="'+e[a]+'"'));var s="";for(var l in t)t[l]!=Object.prototype[l]&&(s+='<param name="'+l+'" value="'+t[l]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+s+"</object>",V[V.length]=e.id,n=h(e.id)}else{var c=f(y);c.setAttribute("type",L);for(var u in e)e[u]!=Object.prototype[u]&&("styleclass"==u.toLowerCase()?c.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&c.setAttribute(u,e[u]));for(var m in t)t[m]!=Object.prototype[m]&&"movie"!=m.toLowerCase()&&g(c,m,t[m]);i.parentNode.replaceChild(c,i),n=c}return n}function g(e,t,o){var n=f("param");n.setAttribute("name",t),n.setAttribute("value",o),e.appendChild(n)}function d(e){var t=h(e);t&&"OBJECT"==t.nodeName&&(j.ie&&j.win?(t.style.display="none",function(){4==t.readyState?p(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function p(e){var t=h(e);if(t){for(var o in t)"function"==typeof t[o]&&(t[o]=null);t.parentNode.removeChild(t)}}function h(e){var t=null;try{t=x.getElementById(e)}catch(o){}return t}function f(e){return x.createElement(e)}function b(e,t,o){e.attachEvent(t,o),W[W.length]=[e,t,o]}function v(e){var t=j.pv,o=e.split(".");return o[0]=parseInt(o[0],10),o[1]=parseInt(o[1],10)||0,o[2]=parseInt(o[2],10)||0,t[0]>o[0]||t[0]==o[0]&&t[1]>o[1]||t[0]==o[0]&&t[1]==o[1]&&t[2]>=o[2]}function _(e,t,o,n){if(!j.ie||!j.mac){var i=x.getElementsByTagName("head")[0];if(i){var r=o&&"string"==typeof o?o:"screen";if(n&&(I=null,C=null),!I||C!=r){var a=f("style");a.setAttribute("type","text/css"),a.setAttribute("media",r),I=i.appendChild(a),j.ie&&j.win&&typeof x.styleSheets!=R&&x.styleSheets.length>0&&(I=x.styleSheets[x.styleSheets.length-1]),C=r}j.ie&&j.win?I&&typeof I.addRule==y&&I.addRule(e,t):I&&typeof x.createTextNode!=R&&I.appendChild(x.createTextNode(e+" {"+t+"}"))}}}function E(e,t){if(H){var o=t?"visible":"hidden";M&&h(e)?h(e).style.visibility=o:_("#"+e,"visibility:"+o)}}function T(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=R?encodeURIComponent(e):e}var P,S,N,w,I,C,R="undefined",y="object",L="application/x-shockwave-flash",D="SWFObjectExprInst",G=window,x=document,O=navigator,A=!1,k=[n],U=[],V=[],W=[],M=!1,F=!1,H=!0,j=function(){var e=typeof x.getElementById!=R&&typeof x.getElementsByTagName!=R&&typeof x.createElement!=R,t=O.userAgent.toLowerCase(),o=O.platform.toLowerCase(),n=/win/.test(o?o:t),i=/mac/.test(o?o:t),r=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a=!1,s=[0,0,0],l=null;if(typeof O.plugins!=R&&typeof O.plugins["Shockwave Flash"]==y)!(l=O.plugins["Shockwave Flash"].description)||typeof O.mimeTypes!=R&&O.mimeTypes[L]&&!O.mimeTypes[L].enabledPlugin||(A=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof G.ActiveXObject!=R)try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");c&&(l=c.GetVariable("$version"))&&(a=!0,l=l.split(" ")[1].split(","),s=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)])}catch(u){}return{w3:e,pv:s,wk:r,ie:a,win:n,mac:i}}();(function(){j.w3&&((typeof x.readyState!=R&&"complete"==x.readyState||typeof x.readyState==R&&(x.getElementsByTagName("body")[0]||x.body))&&e(),M||(typeof x.addEventListener!=R&&x.addEventListener("DOMContentLoaded",e,!1),j.ie&&j.win&&(x.attachEvent("onreadystatechange",function(){"complete"==x.readyState&&(x.detachEvent("onreadystatechange",arguments.callee),e())}),G==top&&function(){if(!M){try{x.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),j.wk&&function(){if(!M)/loaded|complete/.test(x.readyState)?e():setTimeout(arguments.callee,0)}(),o(e)))})(),function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var e=W.length,t=0;t<e;t++)W[t][0].detachEvent(W[t][1],W[t][2]);for(var o=V.length,n=0;n<o;n++)d(V[n]);for(var i in j)j[i]=null;j=null;for(var r in swfobject)swfobject[r]=null;swfobject=null})}();return{registerObject:function(e,t,o,n){if(j.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=o,i.callbackFn=n,U[U.length]=i,E(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){if(j.w3)return a(e)},embedSWF:function(e,o,n,i,r,a,c,u,g,d){var p={success:!1,id:o};j.w3&&!(j.wk&&j.wk<312)&&e&&o&&n&&i&&r?(E(o,!1),t(function(){n+="",i+="";var t={};if(g&&typeof g===y)for(var h in g)t[h]=g[h];t.data=e,t.width=n,t.height=i;var f={};if(u&&typeof u===y)for(var b in u)f[b]=u[b];if(c&&typeof c===y)for(var _ in c)typeof f.flashvars!=R?f.flashvars+="&"+_+"="+c[_]:f.flashvars=_+"="+c[_];if(v(r)){var T=m(t,f,o);t.id==o&&E(o,!0),p.success=!0,p.ref=T}else{if(a&&s())return t.data=a,void l(t,f,o,d);E(o,!0)}d&&d(p)})):d&&d(p)},switchOffAutoHideShow:function(){H=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:v,createSWF:function(e,t,o){return j.w3?m(e,t,o):undefined},showExpressInstall:function(e,t,o,n){j.w3&&s()&&l(e,t,o,n)},removeSWF:function(e){j.w3&&d(e)},createCSS:function(e,t,o,n){j.w3&&_(e,t,o,n)},addDomLoadEvent:t,addLoadEvent:o,getQueryParamValue:function(e){var t=x.location.search||x.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return T(t);for(var o=t.split("&"),n=0;n<o.length;n++)if(o[n].substring(0,o[n].indexOf("="))==e)return T(o[n].substring(o[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var e=h(D);e&&P&&(e.parentNode.replaceChild(P,e),S&&(E(S,!0),j.ie&&j.win&&(P.style.display="block")),N&&N(w)),F=!1}}}}(),mwphonecfg={passphrase:"h39idbfqw7116ghh",loglevel:"5",autotransportdetect:"false",cfgusetunneling:"0",useencryption:"false",upperserverfromuser:"2",featureset:"10",needactivation:"false",brandid:"-1",video:"1",enable_video:"true",has_video:"true",enablepresence2:"1",enablepresence:"1",hasfiletransfer:"true",screensharing:"1",hasconference:"true",useg729:"2",useopuswb:"2",customizedversion:"false",autoprovisioning:"1",colortheme:"-1",actionbarhideicon:"false",usemizuwebrtcgateway:"-1",deploydate:"2/11/2020 12:28:56",homepage:"www.mizu-voip.com",server_comment:"VoIP server address (domain or IP:port)",companynameex:"MizuTech",confighash:"6190565b7a4cc409c70e83fff7cc9739",firstdeploydate:"2/11/2020 12:28:56",lastdeploydate:"2/11/2020 12:28:56",BUILDNUMBER:"518",mclientid:"5795",get:function(e){return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof mwphonecfg[e]||null===mwphonecfg[e]?"":mwphonecfg[e])},getAll:function(){return mwphonecfg}};!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this,t.localforage=e()}}(function(){return function e(t,o,n){function i(a,s){if(!o[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){var o=t[a][1][e];return i(o||e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,o){(function(e){"use strict";function o(){u=!0;for(var e,t,o=m.length;o;){for(t=m,m=[],e=-1;++e<o;)t[e]();o=m.length}u=!1}function n(e){1!==m.push(e)||u||i()}var i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var a=0,s=new r(o),l=e.document.createTextNode("");s.observe(l,{
characterData:!0}),i=function(){l.data=a=++a%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){o(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(o,0)};else{var c=new e.MessageChannel;c.port1.onmessage=o,i=function(){c.port2.postMessage(0)}}var u,m=[];t.exports=n}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";function n(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,e!==n&&l(this,e)}function r(e,t,o){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof o&&(this.onRejected=o,this.callRejected=this.otherCallRejected)}function a(e,t,o){p(function(){var n;try{n=t(o)}catch(i){return h.reject(e,i)}n===e?h.reject(e,new TypeError("Cannot resolve promise with itself")):h.resolve(e,n)})}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function o(t){r||(r=!0,h.reject(e,t))}function n(t){r||(r=!0,h.resolve(e,t))}function i(){t(n,o)}var r=!1,a=c(i);"error"===a.status&&o(a.value)}function c(e,t){var o={};try{o.value=e(t),o.status="success"}catch(n){o.status="error",o.value=n}return o}function u(e){return e instanceof this?e:h.resolve(new this(n),e)}function m(e){var t=new this(n);return h.reject(t,e)}function g(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var o=e.length,i=!1;if(!o)return this.resolve([]);for(var r=new Array(o),a=0,s=-1,l=new this(n);++s<o;)!function(e,n){function s(e){r[n]=e,++a!==o||i||(i=!0,h.resolve(l,r))}t.resolve(e).then(s,function(e){i||(i=!0,h.reject(l,e))})}(e[s],s);return l}function d(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var o=e.length,i=!1;if(!o)return this.resolve([]);for(var r=-1,a=new this(n);++r<o;)!function(e){t.resolve(e).then(function(e){i||(i=!0,h.resolve(a,e))},function(e){i||(i=!0,h.reject(a,e))})}(e[r]);return a}var p=e(1),h={},f=["REJECTED"],b=["FULFILLED"],v=["PENDING"];t.exports=i,i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===b||"function"!=typeof t&&this.state===f)return this;var o=new this.constructor(n);if(this.state!==v){a(o,this.state===b?e:t,this.outcome)}else this.queue.push(new r(o,e,t));return o},r.prototype.callFulfilled=function(e){h.resolve(this.promise,e)},r.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},r.prototype.callRejected=function(e){h.reject(this.promise,e)},r.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},h.resolve=function(e,t){var o=c(s,t);if("error"===o.status)return h.reject(e,o.value);var n=o.value;if(n)l(e,n);else{e.state=b,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callFulfilled(t)}return e},h.reject=function(e,t){e.state=f,e.outcome=t;for(var o=-1,n=e.queue.length;++o<n;)e.queue[o].callRejected(t);return e},i.resolve=u,i.reject=m,i.all=g,i.race=d},{1:1}],3:[function(e,t,o){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var o="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,n=new o,i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}function r(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function a(e,t,o){"function"==typeof t&&e.then(t),"function"==typeof o&&e["catch"](o)}function s(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function c(e){for(var t=e.length,o=new ArrayBuffer(t),n=new Uint8Array(o),i=0;i<t;i++)n[i]=e.charCodeAt(i);return o}function u(e){return new be(function(t){var o=e.transaction(ve,Se),n=i([""]);o.objectStore(ve).put(n,"key"),o.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},o.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);t(o||!e||parseInt(e[1],10)>=43)}})["catch"](function(){return!1})}function m(e){return"boolean"==typeof _e?be.resolve(_e):u(e).then(function(e){return _e=e})}function g(e){var t=Ee[e.name],o={};o.promise=new be(function(e,t){o.resolve=e,o.reject=t}),t.deferredOperations.push(o),t.dbReady?t.dbReady=t.dbReady.then(function(){return o.promise}):t.dbReady=o.promise}function d(e){var t=Ee[e.name],o=t.deferredOperations.pop();if(o)return o.resolve(),o.promise}function p(e,t){var o=Ee[e.name],n=o.deferredOperations.pop();if(n)return n.reject(t),n.promise}function h(e,t){return new be(function(o,n){if(Ee[e.name]=Ee[e.name]||w(),e.db){if(!t)return o(e.db);g(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=fe.open.apply(fe,i);t&&(r.onupgradeneeded=function(t){var o=r.result;try{o.createObjectStore(e.storeName),t.oldVersion<=1&&o.createObjectStore(ve)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),n(r.error)},r.onsuccess=function(){o(r.result),d(e)}})}function f(e){return h(e,!1)}function b(e){return h(e,!0)}function v(e,t){if(!e.db)return!0;var o=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||o){if(o){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function _(e){return new be(function(t,o){var n=new FileReader;n.onerror=o,n.onloadend=function(o){var n=btoa(o.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)})}function E(e){return i([c(atob(e.data))],{type:e.type})}function T(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,o=t._initReady().then(function(){var e=Ee[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return a(o,e,e),o}function S(e){g(e);for(var t=Ee[e.name],o=t.forages,n=0;n<o.length;n++){var i=o[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,f(e).then(function(t){return e.db=t,v(e)?b(e):t}).then(function(n){e.db=t.db=n;for(var i=0;i<o.length;i++)o[i]._dbInfo.db=n})["catch"](function(t){throw p(e,t),t})}function N(e,t,o,n){n===undefined&&(n=1);try{var i=e.db.transaction(e.storeName,t);o(null,i)}catch(r){if(n>0&&(!e.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return be.resolve().then(function(){if(!e.db||"NotFoundError"===r.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),b(e)}).then(function(){return S(e).then(function(){N(e,t,o,n-1)})})["catch"](o);o(r)}}function w(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function I(e){function t(){return be.resolve()}var o=this,n={db:null};if(e)for(var i in e)n[i]=e[i];var r=Ee[n.name];r||(r=w(),Ee[n.name]=r),r.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=P);for(var a=[],s=0;s<r.forages.length;s++){var l=r.forages[s];l!==o&&a.push(l._initReady()["catch"](t))}var c=r.forages.slice(0);return be.all(a).then(function(){return n.db=r.db,f(n)}).then(function(e){return n.db=e,v(n,o._defaultConfig.version)?b(n):e}).then(function(e){n.db=r.db=e,o._dbInfo=n;for(var t=0;t<c.length;t++){var i=c[t];i!==o&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})}function C(e,t){var o=this;e=s(e);var n=new be(function(t,n){o.ready().then(function(){N(o._dbInfo,Pe,function(i,r){if(i)return n(i);try{var a=r.objectStore(o._dbInfo.storeName),s=a.get(e);s.onsuccess=function(){var e=s.result;e===undefined&&(e=null),T(e)&&(e=E(e)),t(e)},s.onerror=function(){n(s.error)}}catch(l){n(l)}})})["catch"](n)});return r(n,t),n}function R(e,t){var o=this,n=new be(function(t,n){o.ready().then(function(){N(o._dbInfo,Pe,function(i,r){if(i)return n(i);try{var a=r.objectStore(o._dbInfo.storeName),s=a.openCursor(),l=1;s.onsuccess=function(){var o=s.result;if(o){var n=o.value;T(n)&&(n=E(n));var i=e(n,o.key,l++);void 0!==i?t(i):o["continue"]()}else t()},s.onerror=function(){n(s.error)}}catch(c){n(c)}})})["catch"](n)});return r(n,t),n}function y(e,t,o){var n=this;e=s(e);var i=new be(function(o,i){var r;n.ready().then(function(){return r=n._dbInfo,"[object Blob]"===Te.call(t)?m(r.db).then(function(e){return e?t:_(t)}):t}).then(function(t){N(n._dbInfo,Se,function(r,a){if(r)return i(r);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=undefined);var l=s.put(t,e);a.oncomplete=function(){t===undefined&&(t=null),o(t)},a.onabort=a.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(c){i(c)}})})["catch"](i)});return r(i,o),i}function L(e,t){var o=this;e=s(e);var n=new be(function(t,n){o.ready().then(function(){N(o._dbInfo,Se,function(i,r){if(i)return n(i);try{var a=r.objectStore(o._dbInfo.storeName),s=a["delete"](e);r.oncomplete=function(){t()},r.onerror=function(){n(s.error)},r.onabort=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(l){n(l)}})})["catch"](n)});return r(n,t),n}function D(e){var t=this,o=new be(function(e,o){t.ready().then(function(){N(t._dbInfo,Se,function(n,i){if(n)return o(n);try{var r=i.objectStore(t._dbInfo.storeName),a=r.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;o(e)}}catch(s){o(s)}})})["catch"](o)});return r(o,e),o}function G(e){var t=this,o=new be(function(e,o){t.ready().then(function(){N(t._dbInfo,Pe,function(n,i){if(n)return o(n);try{var r=i.objectStore(t._dbInfo.storeName),a=r.count();a.onsuccess=function(){e(a.result)},a.onerror=function(){o(a.error)}}catch(s){o(s)}})})["catch"](o)});return r(o,e),o}function x(e,t){var o=this,n=new be(function(t,n){if(e<0)return void t(null);o.ready().then(function(){N(o._dbInfo,Pe,function(i,r){if(i)return n(i);try{var a=r.objectStore(o._dbInfo.storeName),s=!1,l=a.openCursor();l.onsuccess=function(){var o=l.result;if(!o)return void t(null);0===e?t(o.key):s?t(o.key):(s=!0,o.advance(e))},l.onerror=function(){n(l.error)}}catch(c){n(c)}})})["catch"](n)});return r(n,t),n}function O(e){var t=this,o=new be(function(e,o){t.ready().then(function(){N(t._dbInfo,Pe,function(n,i){if(n)return o(n);try{var r=i.objectStore(t._dbInfo.storeName),a=r.openCursor(),s=[];a.onsuccess=function(){var t=a.result;if(!t)return void e(s);s.push(t.key),t["continue"]()},a.onerror=function(){o(a.error)}}catch(l){o(l)}})})["catch"](o)});return r(o,e),o}function A(e,t){t=l.apply(this,arguments);var o=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||o.name,e.storeName=e.storeName||o.storeName);var n,i=this;if(e.name){var a=e.name===o.name&&i._dbInfo.db,s=a?be.resolve(i._dbInfo.db):f(e).then(function(t){var o=Ee[e.name],n=o.forages;o.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t});n=e.storeName?s.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var o=t.version+1;g(e);var n=Ee[e.name],i=n.forages;t.close();for(var r=0;r<i.length;r++){var a=i[r];a._dbInfo.db=null,a._dbInfo.version=o}return new be(function(t,n){var i=fe.open(e.name,o);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<i.length;t++){var o=i[t];o._dbInfo.db=e,d(o._dbInfo)}})["catch"](function(t){throw(p(e,t)||be.resolve())["catch"](function(){}),t})}}):s.then(function(t){g(e);var o=Ee[e.name],n=o.forages;t.close();for(var i=0;i<n.length;i++){n[i]._dbInfo.db=null}return new be(function(t,o){var n=fe.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),o(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){o.db=e;for(var t=0;t<n.length;t++)d(n[t]._dbInfo)})["catch"](function(t){throw(p(e,t)||be.resolve())["catch"](function(){}),t})})}else n=be.reject("Invalid arguments");return r(n,t),n}function k(e){var t,o,n,i,r,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(t=0;t<s;t+=4)o=we.indexOf(e[t]),n=we.indexOf(e[t+1]),i=we.indexOf(e[t+2]),r=we.indexOf(e[t+3]),u[l++]=o<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&r;return c}function U(e){var t,o=new Uint8Array(e),n="";for(t=0;t<o.length;t+=3)n+=we[o[t]>>2],n+=we[(3&o[t])<<4|o[t+1]>>4],n+=we[(15&o[t+1])<<2|o[t+2]>>6],n+=we[63&o[t+2]];return o.length%3==2?n=n.substring(0,n.length-1)+"=":o.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function V(e,t){var o="";if(e&&(o=He.call(e)),e&&("[object ArrayBuffer]"===o||e.buffer&&"[object ArrayBuffer]"===He.call(e.buffer))){var n,i=Re;e instanceof ArrayBuffer?(n=e,i+=Le):(n=e.buffer,"[object Int8Array]"===o?i+=Ge:"[object Uint8Array]"===o?i+=xe:"[object Uint8ClampedArray]"===o?i+=Oe:"[object Int16Array]"===o?i+=Ae:"[object Uint16Array]"===o?i+=Ue:"[object Int32Array]"===o?i+=ke:"[object Uint32Array]"===o?i+=Ve:"[object Float32Array]"===o?i+=We:"[object Float64Array]"===o?i+=Me:t(new Error("Failed to get type for BinaryArray"))),t(i+U(n))}else if("[object Blob]"===o){var r=new FileReader;r.onload=function(){var o=Ie+e.type+"~"+U(this.result);t(Re+De+o)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(a){console.error("Couldn't convert value into a JSON string: ",e),t(null,a)}}function W(e){if(e.substring(0,ye)!==Re)return JSON.parse(e);var t,o=e.substring(Fe),n=e.substring(ye,Fe);if(n===De&&Ce.test(o)){var r=o.match(Ce);t=r[1],o=o.substring(r[0].length)}var a=k(o);switch(n){case Le:return a;case De:return i([a],{type:t});case Ge:return new Int8Array(a);case xe:return new Uint8Array(a);case Oe:return new Uint8ClampedArray(a);case Ae:return new Int16Array(a);case Ue:return new Uint16Array(a);case ke:return new Int32Array(a);case Ve:return new Uint32Array(a);case We:return new Float32Array(a);case Me:return new Float64Array(a);default:throw new Error("Unkown type: "+n)}}function M(e,t,o,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],o,n)}function F(e){var t=this,o={db:null};if(e)for(var n in e)o[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new be(function(e,n){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(i){return n(i)}o.db.transaction(function(i){M(i,o,function(){t._dbInfo=o,e()},function(e,t){n(t)})},n)});return o.serializer=je,i}function H(e,t,o,n,i,r){e.executeSql(o,n,i,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?r(e,a):M(e,t,function(){e.executeSql(o,n,i,r)},r)},r):r(e,a)},r)}function j(e,t){var o=this;e=s(e);var n=new be(function(t,n){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){H(o,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,o){var n=o.rows.length?o.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})})["catch"](n)});return r(n,t),n}function B(e,t){var o=this,n=new be(function(t,n){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){H(o,i,"SELECT * FROM "+i.storeName,[],function(o,n){for(var r=n.rows,a=r.length,s=0;s<a;s++){var l=r.item(s),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()},function(e,t){n(t)})})})["catch"](n)});return r(n,t),n}function $(e,t,o,n){var i=this;e=s(e);var a=new be(function(r,a){i.ready().then(function(){t===undefined&&(t=null);var s=t,l=i._dbInfo;l.serializer.serialize(t,function(t,c){c?a(c):l.db.transaction(function(o){H(o,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){r(s)},function(e,t){a(t)})},function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r($.apply(i,[e,s,o,n-1]));a(t)}})})})["catch"](a)});return r(a,o),a}function q(e,t,o){return $.apply(this,[e,t,o,1])}function z(e,t){var o=this;e=s(e);var n=new be(function(t,n){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){H(o,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})})["catch"](n)});return r(n,t),n}function K(e){var t=this,o=new be(function(e,o){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){H(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){o(t)})})})["catch"](o)});return r(o,e),o}function X(e){var t=this,o=new be(function(e,o){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){H(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,o){var n=o.rows.item(0).c;e(n)},function(e,t){o(t)})})})["catch"](o)});return r(o,e),o}function J(e,t){var o=this,n=new be(function(t,n){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){H(o,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,o){var n=o.rows.length?o.rows.item(0).key:null;t(n)},function(e,t){n(t)})})})["catch"](n)});return r(n,t),n}function Y(e){var t=this,o=new be(function(e,o){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){H(t,n,"SELECT key FROM "+n.storeName,[],function(t,o){for(var n=[],i=0;i<o.rows.length;i++)n.push(o.rows.item(i).key);e(n)},function(e,t){o(t)})})})["catch"](o)});return r(o,e),o}function Q(e){return new be(function(t,o){e.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(o,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);t({db:e,storeNames:i})},function(e,t){o(t)})},function(e){o(e)})})}function Z(e,t){t=l.apply(this,arguments);var o=this.config();e="function"!=typeof e&&e||{},e.name||(e.name=e.name||o.name,e.storeName=e.storeName||o.storeName);var n,i=this;return n=e.name?new be(function(t){var n;n=e.name===o.name?i._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:n,storeNames:[e.storeName]}:Q(n))}).then(function(e){return new be(function(t,o){e.db.transaction(function(n){for(var i=[],r=0,a=e.storeNames.length;r<a;r++)i.push(function(e){return new be(function(t,o){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){o(t)})})}(e.storeNames[r]));be.all(i).then(function(){t()})["catch"](function(e){o(e)})},function(e){o(e)})})}):be.reject("Invalid arguments"),r(n,t),n}function ee(e,t){var o=e.name+"/";return e.storeName!==t.storeName&&(o+=e.storeName+"/"),o}function te(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}function oe(){return!te()||localStorage.length>0}function ne(e){var t=this,o={};if(e)for(var n in e)o[n]=e[n];return o.keyPrefix=ee(e,t._defaultConfig),oe()?(t._dbInfo=o,o.serializer=je,be.resolve()):be.reject()}function ie(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);0===n.indexOf(e)&&localStorage.removeItem(n)}});return r(o,e),o}function re(e,t){var o=this;e=s(e);var n=o.ready().then(function(){var t=o._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return r(n,t),n}function ae(e,t){var o=this,n=o.ready().then(function(){for(var t=o._dbInfo,n=t.keyPrefix,i=n.length,r=localStorage.length,a=1,s=0;s<r;s++){var l=localStorage.key(s);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),a++)))return c}}});return r(n,t),n}function se(e,t){var o=this,n=o.ready().then(function(){var t,n=o._dbInfo;try{t=localStorage.key(e)}catch(i){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return r(n,t),n}function le(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo,o=localStorage.length,n=[],i=0;i<o;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n});return r(o,e),o}function ce(e){var t=this,o=t.keys().then(function(e){return e.length});return r(o,e),o}function ue(e,t){var o=this;e=s(e);var n=o.ready().then(function(){var t=o._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return r(n,t),n}function me(e,t,o){var n=this;e=s(e);var i=n.ready().then(function(){t===undefined&&(t=null);var o=t;return new be(function(i,r){var a=n._dbInfo;a.serializer.serialize(t,function(t,n){if(n)r(n);else try{localStorage.setItem(a.keyPrefix+e,t),i(o)}catch(s){"QuotaExceededError"!==s.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==s.name||r(s),r(s)}})})});return r(i,o),i}function ge(e,t){if(t=l.apply(this,arguments),e="function"!=typeof e&&e||{},!e.name){var o=this.config();e.name=e.name||o.name,e.storeName=e.storeName||o.storeName}var n,i=this;return n=e.name?new be(function(t){t(e.storeName?ee(e,i._defaultConfig):e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var o=localStorage.key(t);0===o.indexOf(e)&&localStorage.removeItem(o)}}):be.reject("Invalid arguments"),r(n,t),n}function de(e,t){e[t]=function(){var o=arguments;return arguments.length&&"function"==typeof arguments[arguments.length-1]&&(global.localforage_last_cb=arguments[arguments.length-1]),e.ready().then(function(){return e[t].apply(e,o)})}}function pe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var o in t)t.hasOwnProperty(o)&&(Ke(t[o])?arguments[0][o]=t[o].slice():arguments[0][o]=t[o])}return arguments[0]}var he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var be=Promise,ve="local-forage-detect-blob-support",_e=void 0,Ee={},Te=Object.prototype.toString,Pe="readonly",Se="readwrite",Ne={_driver:"asyncStorage",_initStorage:I,_support:function(){try{if(!fe)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(o){return!1}}(),iterate:R,getItem:C,setItem:y,removeItem:L,clear:D,length:G,key:x,keys:O,dropInstance:A},we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ie="~~local_forage_type~",Ce=/^~~local_forage_type~([^~]+)~/,Re="__lfsc__:",ye=Re.length,Le="arbf",De="blob",Ge="si08",xe="ui08",Oe="uic8",Ae="si16",ke="si32",Ue="ur16",Ve="ui32",We="fl32",Me="fl64",Fe=ye+Le.length,He=Object.prototype.toString,je={serialize:V,deserialize:W,stringToBuffer:k,bufferToString:U},Be={_driver:"webSQLStorage",_initStorage:F,_support:function(){return"function"==typeof openDatabase}(),iterate:B,getItem:j,setItem:q,removeItem:z,clear:K,length:X,key:J,keys:Y,dropInstance:Z},$e={_driver:"localStorageWrapper",_initStorage:ne,_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:ae,getItem:re,setItem:me,removeItem:ue,clear:ie,length:ce,key:se,keys:le,dropInstance:ge},qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ze=function(e,t){for(var o=e.length,n=0;n<o;){if(qe(e[n],t))return!0;n++}return!1},Ke=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Je={},Ye={INDEXEDDB:Ne,WEBSQL:Be,LOCALSTORAGE:$e},Qe=[Ye.INDEXEDDB._driver,Ye.WEBSQL._driver,Ye.LOCALSTORAGE._driver],Ze=["dropInstance"],et=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ze),tt={description:"",driver:Qe.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},ot=function(){function e(t){n(this,e);for(var o in Ye)if(Ye.hasOwnProperty(o)){var i=Ye[o],r=i._driver;this[o]=r,Xe[r]||this.defineDriver(i)}this._defaultConfig=pe({},tt),this._config=pe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)["catch"](function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":he(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,o){var n=new be(function(t,o){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void o(i);for(var a=et.concat("_initStorage"),s=0,l=a.length;s<l;s++){var c=a[s];if((!ze(Ze,c)||e[c])&&"function"!=typeof e[c])return void o(i)}!function(){for(var t=0,o=Ze.length;t<o;t++){var n=Ze[t];e[n]||(e[n]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),o=be.reject(t);return r(o,arguments[arguments.length-1]),o}}(n))}}();var u=function(o){Xe[n]&&console.info("Redefining LocalForage driver: "+n),Xe[n]=e,Je[n]=o,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,o):u(!!e._support):u(!0)}catch(m){o(m)}});return a(n,t,o),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,o){var n=Xe[e]?be.resolve(Xe[e]):be.reject(new Error("Driver not found."));return a(n,t,o),n},e.prototype.getSerializer=function(e){var t=be.resolve(je);return a(t,e),t},e.prototype.ready=function(e){var t=this,o=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return a(o,e,e),o},e.prototype.setDriver=function(e,t,o){function n(){s._config.driver=s.driver()}function i(e){return s._extend(e),n(),s._ready=s._initStorage(s._config),s._ready}function r(e){return function(){function t(){for(;o<e.length;){var r=e[o];return o++,s._dbInfo=null,s._ready=null,s.getDriver(r).then(i)["catch"](t)}n();var a=new Error("No available storage method found.");return null!==global.localforage_last_cb&&"function"==typeof global.localforage_last_cb&&global.localforage_last_cb("ERROR, driverPromiseLoop:No available storage method found.",""),s._driverSet=be.reject(a),s._driverSet}var o=0;return t()}}var s=this;Ke(e)||(e=[e]);var l=this._getSupportedDrivers(e),c=null!==this._driverSet?this._driverSet["catch"](function(){return be.resolve()}):be.resolve();return this._driverSet=c.then(function(){var e=l[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then(function(e){s._driver=e._driver,n(),s._wrapLibraryMethodsWithReady(),s._initDriver=r(l)})})["catch"](function(){n();var e=new Error("No available storage method found.");return s._driverSet=be.reject(e),s._driverSet}),a(this._driverSet,t,o),this._driverSet},e.prototype.supports=function(e){return!!Je[e]},e.prototype._extend=function(e){pe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],o=0,n=e.length;o<n;o++){var i=e[o];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=et.length;e<t;e++)de(this,et[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),nt=new ot;t.exports=nt},{3:3}]},{},[4])(4)}),function(e,t){"undefined"!=typeof module?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):this.domready=t()}(0,function(e){function t(e){for(l=1;e=n.shift();)e()}var o,n=[],i=document,r=i.documentElement,a=r.doScroll,s=a?/^loaded|^c/:/^loaded|c/,l=s.test(i.readyState);return i.addEventListener&&i.addEventListener("DOMContentLoaded",o=function(){i.removeEventListener("DOMContentLoaded",o,!1),t()},!1),a&&i.attachEvent("onreadystatechange",o=function(){/^c/.test(i.readyState)&&(i.detachEvent("onreadystatechange",o),t())}),e=a?function(t){self!=top?l?t():n.push(t):function(){try{r.doScroll("left")}catch(o){return setTimeout(function(){e(t)},50)}t()}()}:function(e){l?e():n.push(e)}}),function(e,t){function o(e){var t=e.length,o=le.type(e);return!le.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===o||"function"!==o&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function n(e){var t=be[e]={};return le.each(e.match(ue)||[],function(e,o){t[o]=!0}),t}function i(e,o,n,i){if(le.acceptData(e)){var r,a,s=le.expando,l="string"==typeof o,c=e.nodeType,u=c?le.cache:e,m=c?e[s]:e[s]&&s;if(m&&u[m]&&(i||u[m].data)||!l||n!==t)return m||(c?e[s]=m=Z.pop()||le.guid++:m=s),u[m]||(u[m]={},c||(u[m].toJSON=le.noop)),("object"==typeof o||"function"==typeof o)&&(i?u[m]=le.extend(u[m],o):u[m].data=le.extend(u[m].data,o)),r=u[m],i||(r.data||(r.data={}),r=r.data),n!==t&&(r[le.camelCase(o)]=n),l?null==(a=r[o])&&(a=r[le.camelCase(o)]):a=r,a}}function r(e,t,o){if(le.acceptData(e)){var n,i,r,a=e.nodeType,l=a?le.cache:e,c=a?e[le.expando]:le.expando;if(l[c]){if(t&&(r=o?l[c]:l[c].data)){le.isArray(t)?t=t.concat(le.map(t,le.camelCase)):t in r?t=[t]:(t=le.camelCase(t),t=t in r?[t]:t.split(" "));for(n=0,i=t.length;i>n;n++)delete r[t[n]];if(!(o?s:le.isEmptyObject)(r))return}(o||(delete l[c].data,s(l[c])))&&(a?le.cleanData([e],!0):le.support.deleteExpando||l!=l.window?delete l[c]:l[c]=null)}}}function a(e,o,n){if(n===t&&1===e.nodeType){var i="data-"+o.replace(_e,"-$1").toLowerCase();if("string"==typeof(n=e.getAttribute(i))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:ve.test(n)?le.parseJSON(n):n)}catch(K){}le.data(e,o,n)}else n=t}return n}function s(e){var t;for(t in e)if(("data"!==t||!le.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function c(){return!1}function u(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function m(e,t,o){if(t=t||0,le.isFunction(t))return le.grep(e,function(e,n){return!!t.call(e,n,e)===o});if(t.nodeType)return le.grep(e,function(e){return e===t===o});if("string"==typeof t){var n=le.grep(e,function(e){return 1===e.nodeType});if(ke.test(t))return le.filter(t,n,!o);t=le.filter(t,n)}return le.grep(e,function(e){return le.inArray(e,t)>=0===o})}function g(e){var t=We.split("|"),o=e.createDocumentFragment();if(o.createElement)for(;t.length;)o.createElement(t.pop());return o}function d(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function p(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function h(e){var t=Je.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function f(e,t){for(var o,n=0;null!=(o=e[n]);n++)le._data(o,"globalEval",!t||le._data(t[n],"globalEval"))}function b(e,t){
if(1===t.nodeType&&le.hasData(e)){var o,n,i,r=le._data(e),a=le._data(t,r),s=r.events;if(s){delete a.handle,a.events={};for(o in s)for(n=0,i=s[o].length;i>n;n++)le.event.add(t,o,s[o][n])}a.data&&(a.data=le.extend({},a.data))}}function v(e,t){var o,n,i;if(1===t.nodeType){if(o=t.nodeName.toLowerCase(),!le.support.noCloneEvent&&t[le.expando]){i=le._data(t);for(n in i.events)le.removeEvent(t,n,i.handle);t.removeAttribute(le.expando)}"script"===o&&t.text!==e.text?(p(t).text=e.text,h(t)):"object"===o?(t.parentNode&&(t.outerHTML=e.outerHTML),le.support.html5Clone&&e.innerHTML&&!le.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===o&&ze.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===o?t.defaultSelected=t.selected=e.defaultSelected:("input"===o||"textarea"===o)&&(t.defaultValue=e.defaultValue)}}function _(e,o){var n,i,r=0,a=typeof e.getElementsByTagName!==z?e.getElementsByTagName(o||"*"):typeof e.querySelectorAll!==z?e.querySelectorAll(o||"*"):t;if(!a)for(a=[],n=e.childNodes||e;null!=(i=n[r]);r++)!o||le.nodeName(i,o)?a.push(i):le.merge(a,_(i,o));return o===t||o&&le.nodeName(e,o)?le.merge([e],a):a}function E(e){ze.test(e.type)&&(e.defaultChecked=e.checked)}function T(e,t){if(t in e)return t;for(var o=t.charAt(0).toUpperCase()+t.slice(1),n=t,i=ht.length;i--;)if((t=ht[i]+o)in e)return t;return n}function P(e,t){return e=t||e,"none"===le.css(e,"display")||!le.contains(e.ownerDocument,e)}function S(e,t){for(var o,n,i,r=[],a=0,s=e.length;s>a;a++)n=e[a],n.style&&(r[a]=le._data(n,"olddisplay"),o=n.style.display,t?(r[a]||"none"!==o||(n.style.display=""),""===n.style.display&&P(n)&&(r[a]=le._data(n,"olddisplay",C(n.nodeName)))):r[a]||(i=P(n),(o&&"none"!==o||!i)&&le._data(n,"olddisplay",i?o:le.css(n,"display"))));for(a=0;s>a;a++)n=e[a],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?r[a]||"":"none"));return e}function N(e,t,o){var n=lt.exec(t);return n?Math.max(0,n[1]-(o||0))+(n[2]||"px"):t}function w(e,t,o,n,i){for(var r=o===(n?"border":"content")?4:"width"===t?1:0,a=0;4>r;r+=2)"margin"===o&&(a+=le.css(e,o+pt[r],!0,i)),n?("content"===o&&(a-=le.css(e,"padding"+pt[r],!0,i)),"margin"!==o&&(a-=le.css(e,"border"+pt[r]+"Width",!0,i))):(a+=le.css(e,"padding"+pt[r],!0,i),"padding"!==o&&(a+=le.css(e,"border"+pt[r]+"Width",!0,i)));return a}function I(e,t,o){var n=!0,i="width"===t?e.offsetWidth:e.offsetHeight,r=tt(e),a=le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,r);if(0>=i||null==i){if(i=ot(e,t,r),(0>i||null==i)&&(i=e.style[t]),ct.test(i))return i;n=a&&(le.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+w(e,t,o||(a?"border":"content"),n,r)+"px"}function C(e){var t=K,o=mt[e];return o||(o=R(e,t),"none"!==o&&o||(et=(et||le("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(et[0].contentWindow||et[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),o=R(e,t),et.detach()),mt[e]=o),o}function R(e,t){var o=le(t.createElement(e)).appendTo(t.body),n=le.css(o[0],"display");return o.remove(),n}function y(e,t,o,n){var i;if(le.isArray(t))le.each(t,function(t,i){o||ft.test(e)?n(e,i):y(e+"["+("object"==typeof i?t:"")+"]",i,o,n)});else if(o||"object"!==le.type(t))n(e,t);else for(i in t)y(e+"["+i+"]",t[i],o,n)}function L(e){return function(t,o){"string"!=typeof t&&(o=t,t="*");var n,i=0,r=t.toLowerCase().match(ue)||[];if(le.isFunction(o))for(;n=r[i++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(o)):(e[n]=e[n]||[]).push(o)}}function D(e,o,n,i){function r(l){var c;return a[l]=!0,le.each(e[l]||[],function(e,l){var u=l(o,n,i);return"string"!=typeof u||s||a[u]?s?!(c=u):t:(o.dataTypes.unshift(u),r(u),!1)}),c}var a={},s=e===Lt;return r(o.dataTypes[0])||!a["*"]&&r("*")}function G(e,o){var n,i,r=le.ajaxSettings.flatOptions||{};for(i in o)o[i]!==t&&((r[i]?e:n||(n={}))[i]=o[i]);return n&&le.extend(!0,e,n),e}function x(e,o,n){var i,r,a,s,l=e.contents,c=e.dataTypes,u=e.responseFields;for(s in u)s in n&&(o[u[s]]=n[s]);for(;"*"===c[0];)c.shift(),r===t&&(r=e.mimeType||o.getResponseHeader("Content-Type"));if(r)for(s in l)if(l[s]&&l[s].test(r)){c.unshift(s);break}if(c[0]in n)a=c[0];else{for(s in n){if(!c[0]||e.converters[s+" "+c[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==c[0]&&c.unshift(a),n[a]):t}function O(e,t){var o,n,i,r,a={},s=0,l=e.dataTypes.slice(),c=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;n=l[++s];)if("*"!==n){if("*"!==c&&c!==n){if(!(i=a[c+" "+n]||a["* "+n]))for(o in a)if(r=o.split(" "),r[1]===n&&(i=a[c+" "+r[0]]||a["* "+r[0]])){!0===i?i=a[o]:!0!==a[o]&&(n=r[0],l.splice(s--,0,n));break}if(!0!==i)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(Z){return{state:"parsererror",error:i?Z:"No conversion from "+c+" to "+n}}}c=n}return{state:"success",data:t}}function A(){try{return new e.XMLHttpRequest}catch(t){}}function k(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function U(){return setTimeout(function(){Vt=t}),Vt=le.now()}function V(e,t){le.each(t,function(t,o){for(var n=(Bt[t]||[]).concat(Bt["*"]),i=0,r=n.length;r>i;i++)if(n[i].call(e,t,o))return})}function W(e,t,o){var n,i,r=0,a=jt.length,s=le.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Vt||U(),o=Math.max(0,c.startTime+c.duration-t),n=o/c.duration||0,r=1-n,a=0,l=c.tweens.length;l>a;a++)c.tweens[a].run(r);return s.notifyWith(e,[c,r,o]),1>r&&l?o:(s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:le.extend({},t),opts:le.extend(!0,{specialEasing:{}},o),originalProperties:t,originalOptions:o,startTime:Vt||U(),duration:o.duration,tweens:[],createTween:function(t,o){var n=le.Tween(e,c.opts,t,o,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var o=0,n=t?c.tweens.length:0;if(i)return this;for(i=!0;n>o;o++)c.tweens[o].run(1);return t?s.resolveWith(e,[c,t]):s.rejectWith(e,[c,t]),this}}),u=c.props;for(M(u,c.opts.specialEasing);a>r;r++)if(n=jt[r].call(c,e,u,c.opts))return n;return V(c,u),le.isFunction(c.opts.start)&&c.opts.start.call(e,c),le.fx.timer(le.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function M(e,t){var o,n,i,r,a;for(i in e)if(n=le.camelCase(i),r=t[n],o=e[i],le.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),(a=le.cssHooks[n])&&"expand"in a){o=a.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function F(e,t,o){var n,i,r,a,s,l,c,u,m,g=this,d=e.style,p={},h=[],f=e.nodeType&&P(e);o.queue||(u=le._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,m=u.empty.fire,u.empty.fire=function(){u.unqueued||m()}),u.unqueued++,g.always(function(){g.always(function(){u.unqueued--,le.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(o.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===le.css(e,"display")&&"none"===le.css(e,"float")&&(le.support.inlineBlockNeedsLayout&&"inline"!==C(e.nodeName)?d.zoom=1:d.display="inline-block")),o.overflow&&(d.overflow="hidden",le.support.shrinkWrapBlocks||g.always(function(){d.overflow=o.overflow[0],d.overflowX=o.overflow[1],d.overflowY=o.overflow[2]}));for(i in t)if(a=t[i],Mt.exec(a)){if(delete t[i],l=l||"toggle"===a,a===(f?"hide":"show"))continue;h.push(i)}if(r=h.length){s=le._data(e,"fxshow")||le._data(e,"fxshow",{}),"hidden"in s&&(f=s.hidden),l&&(s.hidden=!f),f?le(e).show():g.done(function(){le(e).hide()}),g.done(function(){var t;le._removeData(e,"fxshow");for(t in p)le.style(e,t,p[t])});for(i=0;r>i;i++)n=h[i],c=g.createTween(n,f?s[n]:0),p[n]=s[n]||le.style(e,n),n in s||(s[n]=c.start,f&&(c.end=c.start,c.start="width"===n||"height"===n?1:0))}}function H(e,t,o,n,i){return new H.prototype.init(e,t,o,n,i)}function j(e,t){var o,n={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)o=pt[i],n["margin"+o]=n["padding"+o]=e;return t&&(n.opacity=n.width=e),n}function B(e){return le.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var $,q,z=typeof t,K=e.document,X=e.location,J=e.jQuery,Y=e.$,Q={},Z=[],ee="1.9.1",te=Z.concat,oe=Z.push,ne=Z.slice,ie=Z.indexOf,re=Q.toString,ae=Q.hasOwnProperty,se=ee.trim,le=function(e,t){return new le.fn.init(e,t,q)},ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ue=/\S+/g,me=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,ge=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,de=/^[\],:{}\s]*$/,pe=function(e,t){return t.toUpperCase()},he=function(e){(K.addEventListener||"load"===e.type||"complete"===K.readyState)&&(fe(),le.ready())},fe=function(){K.addEventListener?(K.removeEventListener("DOMContentLoaded",he,!1),e.removeEventListener("load",he,!1)):(K.detachEvent("onreadystatechange",he),e.detachEvent("onload",he))};le.fn=le.prototype={jquery:ee,constructor:le,init:function(e,o,n){var i,r;if(!e)return this;if("string"==typeof e){if(!(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:me.exec(e))||!i[1]&&o)return!o||o.jquery?(o||n).find(e):this.constructor(o).find(e);if(i[1]){if(o=o instanceof le?o[0]:o,le.merge(this,le.parseHTML(i[1],o&&o.nodeType?o.ownerDocument||o:K,!0)),ge.test(i[1])&&le.isPlainObject(o))for(i in o)le.isFunction(this[i])?this[i](o[i]):this.attr(i,o[i]);return this}if((r=K.getElementById(i[2]))&&r.parentNode){if(r.id!==i[2])return n.find(e);this.length=1,this[0]=r}return this.context=K,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):le.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),le.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return ne.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=le.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return le.each(this,e,t)},ready:function(e){return le.ready.promise().done(e),this},slice:function(){return this.pushStack(ne.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,o=+e+(0>e?t:0);return this.pushStack(o>=0&&t>o?[this[o]]:[])},map:function(e){return this.pushStack(le.map(this,function(t,o){return e.call(t,o,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:oe,sort:[].sort,splice:[].splice},le.fn.init.prototype=le.fn,le.extend=le.fn.extend=function(){var e,o,n,i,r,a,s=arguments[0]||{},l=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},l=2),"object"==typeof s||le.isFunction(s)||(s={}),c===l&&(s=this,--l);c>l;l++)if(null!=(r=arguments[l]))for(i in r)e=s[i],n=r[i],s!==n&&(u&&n&&(le.isPlainObject(n)||(o=le.isArray(n)))?(o?(o=!1,a=e&&le.isArray(e)?e:[]):a=e&&le.isPlainObject(e)?e:{},s[i]=le.extend(u,a,n)):n!==t&&(s[i]=n));return s},le.extend({noConflict:function(t){return e.$===le&&(e.$=Y),t&&e.jQuery===le&&(e.jQuery=J),le},isReady:!1,readyWait:1,holdReady:function(e){e?le.readyWait++:le.ready(!0)},ready:function(e){if(!0===e?!--le.readyWait:!le.isReady){if(!K.body)return setTimeout(le.ready);le.isReady=!0,!0!==e&&--le.readyWait>0||($.resolveWith(K,[le]),le.fn.trigger&&le(K).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===le.type(e)},isArray:Array.isArray||function(e){return"array"===le.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Q[re.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==le.type(e)||e.nodeType||le.isWindow(e))return!1;try{if(e.constructor&&!ae.call(e,"constructor")&&!ae.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch($){return!1}var o;for(o in e);return o===t||ae.call(e,o)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,o){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(o=t,t=!1),t=t||K;var n=ge.exec(e),i=!o&&[];return n?[t.createElement(n[1])]:(n=le.buildFragment([e],t,i),i&&le(i).remove(),le.merge([],n.childNodes))},parseJSON:function(o){return e.JSON&&e.JSON.parse?e.JSON.parse(o):null===o?o:"string"==typeof o&&(o=le.trim(o))&&de.test(o.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?Function("return "+o)():(le.error("Invalid JSON: "+o),t)},parseXML:function(o){var n,i;if(!o||"string"!=typeof o)return null;try{e.DOMParser?(i=new DOMParser,n=i.parseFromString(o,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(o))}catch(K){n=t}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||le.error("Invalid XML: "+o),n},noop:function(){},globalEval:function(t){t&&le.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,pe)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var i=0,r=e.length,a=o(e);if(n){if(a)for(;r>i&&!1!==t.apply(e[i],n);i++);else for(i in e)if(!1===t.apply(e[i],n))break}else if(a)for(;r>i&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},trim:se&&!se.call("\ufeff ")?function(e){return null==e?"":se.call(e)}:function(e){return null==e?"":(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(o(Object(e))?le.merge(n,"string"==typeof e?[e]:e):oe.call(n,e)),n},inArray:function(e,t,o){var n;if(t){if(ie)return ie.call(t,e,o);for(n=t.length,o=o?0>o?Math.max(0,n+o):o:0;n>o;o++)if(o in t&&t[o]===e)return o}return-1},merge:function(e,o){var n=o.length,i=e.length,r=0;if("number"==typeof n)for(;n>r;r++)e[i++]=o[r];else for(;o[r]!==t;)e[i++]=o[r++];return e.length=i,e},grep:function(e,t,o){var n,i=[],r=0,a=e.length;for(o=!!o;a>r;r++)n=!!t(e[r],r),o!==n&&i.push(e[r]);return i},map:function(e,t,n){var i,r=0,a=e.length,s=o(e),l=[];if(s)for(;a>r;r++)null!=(i=t(e[r],r,n))&&(l[l.length]=i);else for(r in e)null!=(i=t(e[r],r,n))&&(l[l.length]=i);return te.apply([],l)},guid:1,proxy:function(e,o){var n,i,r;return"string"==typeof o&&(r=e[o],o=e,e=r),le.isFunction(e)?(n=ne.call(arguments,2),i=function(){return e.apply(o||this,n.concat(ne.call(arguments)))},i.guid=e.guid=e.guid||le.guid++,i):t},access:function(e,o,n,i,r,a,s){var l=0,c=e.length,u=null==n;if("object"===le.type(n)){r=!0;for(l in n)le.access(e,o,l,n[l],!0,a,s)}else if(i!==t&&(r=!0,le.isFunction(i)||(s=!0),u&&(s?(o.call(e,i),o=null):(u=o,o=function(e,t,o){return u.call(le(e),o)})),o))for(;c>l;l++)o(e[l],n,s?i:i.call(e[l],l,o(e[l],n)));return r?e:u?o.call(e):c?o(e[0],n):a},now:function(){return(new Date).getTime()}}),le.ready.promise=function(t){if(!$)if($=le.Deferred(),"complete"===K.readyState)setTimeout(le.ready);else if(K.addEventListener)K.addEventListener("DOMContentLoaded",he,!1),e.addEventListener("load",he,!1);else{K.attachEvent("onreadystatechange",he),e.attachEvent("onload",he);var o=!1;try{o=null==e.frameElement&&K.documentElement}catch(z){}o&&o.doScroll&&function n(){if(!le.isReady){try{o.doScroll("left")}catch(e){return setTimeout(n,50)}fe(),le.ready()}}()}return $.promise(t)},le.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Q["[object "+t+"]"]=t.toLowerCase()}),q=le(K);var be={};le.Callbacks=function(e){e="string"==typeof e?be[e]||n(e):le.extend({},e);var o,i,r,a,s,l,c=[],u=!e.once&&[],m=function(t){for(i=e.memory&&t,r=!0,s=l||0,l=0,a=c.length,o=!0;c&&a>s;s++)if(!1===c[s].apply(t[0],t[1])&&e.stopOnFalse){i=!1;break}o=!1,c&&(u?u.length&&m(u.shift()):i?c=[]:g.disable())},g={add:function(){if(c){var t=c.length;(function n(t){le.each(t,function(t,o){var i=le.type(o);"function"===i?e.unique&&g.has(o)||c.push(o):o&&o.length&&"string"!==i&&n(o)})})(arguments),o?a=c.length:i&&(l=t,m(i))}return this},remove:function(){return c&&le.each(arguments,function(e,t){for(var n;(n=le.inArray(t,c,n))>-1;)c.splice(n,1),o&&(a>=n&&a--,s>=n&&s--)}),this},has:function(e){return e?le.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){return c=[],this},disable:function(){return c=u=i=t,this},disabled:function(){return!c},lock:function(){return u=t,i||g.disable(),this},locked:function(){return!u},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!c||r&&!u||(o?u.push(t):m(t)),this},fire:function(){return g.fireWith(this,arguments),this},fired:function(){return!!r}};return g},le.extend({Deferred:function(e){var t=[["resolve","done",le.Callbacks("once memory"),"resolved"],["reject","fail",le.Callbacks("once memory"),"rejected"],["notify","progress",le.Callbacks("memory")]],o="pending",n={state:function(){return o},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return le.Deferred(function(o){le.each(t,function(t,r){var a=r[0],s=le.isFunction(e[t])&&e[t];i[r[1]](function(){var e=s&&s.apply(this,arguments);e&&le.isFunction(e.promise)?e.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[a+"With"](this===n?o.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?le.extend(e,n):n}},i={};return n.pipe=n.then,le.each(t,function(e,r){var a=r[2],s=r[3];n[r[1]]=a.add,s&&a.add(function(){o=s},t[1^e][2].disable,t[2][2].lock),i[r[0]]=function(){return i[r[0]+"With"](this===i?n:this,arguments),this},i[r[0]+"With"]=a.fireWith}),n.promise(i),e&&e.call(i,i),i},when:function(e){var t,o,n,i=0,r=ne.call(arguments),a=r.length,s=1!==a||e&&le.isFunction(e.promise)?a:0,l=1===s?e:le.Deferred(),c=function(e,o,n){return function(i){o[e]=this,n[e]=arguments.length>1?ne.call(arguments):i,n===t?l.notifyWith(o,n):--s||l.resolveWith(o,n)}};if(a>1)for(t=Array(a),o=Array(a),n=Array(a);a>i;i++)r[i]&&le.isFunction(r[i].promise)?r[i].promise().done(c(i,n,r)).fail(l.reject).progress(c(i,o,t)):--s;return s||l.resolveWith(n,r),l.promise()}}),le.support=function(){var t,o,n,i,r,a,s,l,c,u,m=K.createElement("div");if(m.setAttribute("className","t"),m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",o=m.getElementsByTagName("*"),n=m.getElementsByTagName("a")[0],!o||!n||!o.length)return{};r=K.createElement("select"),s=r.appendChild(K.createElement("option")),i=m.getElementsByTagName("input")[0],n.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==m.className,leadingWhitespace:3===m.firstChild.nodeType,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:!!i.value,optSelected:s.selected,enctype:!!K.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===K.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},i.checked=!0,t.noCloneChecked=i.cloneNode(!0).checked,r.disabled=!0,t.optDisabled=!s.disabled;try{delete m.test}catch(ne){t.deleteExpando=!1}i=K.createElement("input"),i.setAttribute("value",""),t.input=""===i.getAttribute("value"),i.value="t",i.setAttribute("type","radio"),t.radioValue="t"===i.value,i.setAttribute("checked","t"),i.setAttribute("name","t"),a=K.createDocumentFragment(),a.appendChild(i),t.appendChecked=i.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,m.attachEvent&&(m.attachEvent("onclick",function(){t.noCloneEvent=!1}),m.cloneNode(!0).click());for(u in{submit:!0,change:!0,focusin:!0})m.setAttribute(l="on"+u,"t"),t[u+"Bubbles"]=l in e||!1===m.attributes[l].expando;return m.style.backgroundClip="content-box",m.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===m.style.backgroundClip,le(function(){var o,n,i,r="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=K.getElementsByTagName("body")[0];a&&(o=K.createElement("div"),o.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(o).appendChild(m),m.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=m.getElementsByTagName("td"),i[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===i[0].offsetHeight,i[0].style.display="",i[1].style.display="none",t.reliableHiddenOffsets=c&&0===i[0].offsetHeight,m.innerHTML="",m.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===m.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(m,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(m,null)||{width:"4px"}).width,n=m.appendChild(K.createElement("div")),n.style.cssText=m.style.cssText=r,n.style.marginRight=n.style.width="0",m.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)),typeof m.style.zoom!==z&&(m.innerHTML="",m.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===m.offsetWidth,m.style.display="block",m.innerHTML="<div></div>",m.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==m.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(o),o=m=i=n=null)}),o=r=a=s=n=i=null,t}();var ve=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,_e=/([A-Z])/g;le.extend({cache:{},expando:"jQuery"+(ee+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?le.cache[e[le.expando]]:e[le.expando])&&!s(e)},data:function(e,t,o){return i(e,t,o)},removeData:function(e,t){return r(e,t)},_data:function(e,t,o){return i(e,t,o,!0)},_removeData:function(e,t){return r(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&le.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),le.fn.extend({data:function(e,o){var n,i,r=this[0],s=0,l=null;if(e===t){if(this.length&&(l=le.data(r),1===r.nodeType&&!le._data(r,"parsedAttrs"))){for(n=r.attributes;n.length>s;s++)i=n[s].name,i.indexOf("data-")||(i=le.camelCase(i.slice(5)),a(r,i,l[i]));le._data(r,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){le.data(this,e)}):le.access(this,function(o){return o===t?r?a(r,e,le.data(r,e)):null:(this.each(function(){le.data(this,e,o)}),t)},null,o,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){le.removeData(this,e)})}}),le.extend({queue:function(e,o,n){var i;return e?(o=(o||"fx")+"queue",i=le._data(e,o),n&&(!i||le.isArray(n)?i=le._data(e,o,le.makeArray(n)):i.push(n)),i||[]):t},dequeue:function(e,t){t=t||"fx";var o=le.queue(e,t),n=o.length,i=o.shift(),r=le._queueHooks(e,t),a=function(){le.dequeue(e,t)};"inprogress"===i&&(i=o.shift(),n--),r.cur=i,i&&("fx"===t&&o.unshift("inprogress"),delete r.stop,i.call(e,a,r)),!n&&r&&r.empty.fire()},_queueHooks:function(e,t){var o=t+"queueHooks";return le._data(e,o)||le._data(e,o,{empty:le.Callbacks("once memory").add(function(){le._removeData(e,t+"queue"),le._removeData(e,o)})})}}),le.fn.extend({queue:function(e,o){var n=2;return"string"!=typeof e&&(o=e,e="fx",n--),n>arguments.length?le.queue(this[0],e):o===t?this:this.each(function(){var t=le.queue(this,e,o);le._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&le.dequeue(this,e)})},dequeue:function(e){return this.each(function(){le.dequeue(this,e)})},delay:function(e,t){return e=le.fx?le.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,o){var n=setTimeout(t,e);o.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,o){var n,i=1,r=le.Deferred(),a=this,s=this.length,l=function(){--i||r.resolveWith(a,[a])};for("string"!=typeof e&&(o=e,e=t),e=e||"fx";s--;)(n=le._data(a[s],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(l));return l(),r.promise(o)}});var Ee,Te,Pe=/[\t\r\n]/g,Se=/^(?:input|select|textarea|button|object)$/i,Ne=/^(?:a|area)$/i,we=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Ie=/^(?:checked|selected)$/i,Ce=le.support.getSetAttribute,Re=le.support.input;le.fn.extend({attr:function(e,t){return le.access(this,le.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){le.removeAttr(this,e)})},prop:function(e,t){return le.access(this,le.prop,e,t,arguments.length>1)},removeProp:function(e){return e=le.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch($){}})},addClass:function(e){var t,o,n,i,r,a=0,s=this.length,l="string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ue)||[];s>a;a++)if(o=this[a],n=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Pe," "):" ")){for(r=0;i=t[r++];)0>n.indexOf(" "+i+" ")&&(n+=i+" ");o.className=le.trim(n)}return this},removeClass:function(e){var t,o,n,i,r,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ue)||[];s>a;a++)if(o=this[a],n=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Pe," "):"")){for(r=0;i=t[r++];)for(;n.indexOf(" "+i+" ")>=0;)n=n.replace(" "+i+" "," ");o.className=e?le.trim(n):""}return this},toggleClass:function(e,t){var o=typeof e,n="boolean"==typeof t;return le.isFunction(e)?this.each(function(o){le(this).toggleClass(e.call(this,o,this.className,t),t)}):this.each(function(){if("string"===o)for(var i,r=0,a=le(this),s=t,l=e.match(ue)||[];i=l[r++];)s=n?s:!a.hasClass(i),a[s?"addClass":"removeClass"](i);else(o===z||"boolean"===o)&&(this.className&&le._data(this,"__className__",this.className),this.className=this.className||!1===e?"":le._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",o=0,n=this.length;n>o;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(Pe," ").indexOf(t)>=0)return!0;return!1},val:function(e){var o,n,i,r=this[0];return arguments.length?(i=le.isFunction(e),this.each(function(o){var r,a=le(this);1===this.nodeType&&(r=i?e.call(this,o,a.val()):e,null==r?r="":"number"==typeof r?r+="":le.isArray(r)&&(r=le.map(r,function(e){return null==e?"":e+""})),(n=le.valHooks[this.type]||le.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&n.set(this,r,"value")!==t||(this.value=r))})):r?(n=le.valHooks[r.type]||le.valHooks[r.nodeName.toLowerCase()],n&&"get"in n&&(o=n.get(r,"value"))!==t?o:(o=r.value,"string"==typeof o?o.replace(/\r/g,""):null==o?"":o)):void 0}}),le.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,o,n=e.options,i=e.selectedIndex,r="select-one"===e.type||0>i,a=r?null:[],s=r?i+1:n.length,l=0>i?s:r?i:0;s>l;l++)if(o=n[l],!(!o.selected&&l!==i||(le.support.optDisabled?o.disabled:null!==o.getAttribute("disabled"))||o.parentNode.disabled&&le.nodeName(o.parentNode,"optgroup"))){if(t=le(o).val(),r)return t;a.push(t)}return a},set:function(e,t){var o=le.makeArray(t);return le(e).find("option").each(function(){this.selected=le.inArray(le(this).val(),o)>=0}),o.length||(e.selectedIndex=-1),o}}},attr:function(e,o,n){var i,r,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===z?le.prop(e,o,n):(r=1!==s||!le.isXMLDoc(e),r&&(o=o.toLowerCase(),i=le.attrHooks[o]||(we.test(o)?Te:Ee)),n===t?i&&r&&"get"in i&&null!==(a=i.get(e,o))?a:(typeof e.getAttribute!==z&&(a=e.getAttribute(o)),null==a?t:a):null!==n?i&&r&&"set"in i&&(a=i.set(e,n,o))!==t?a:(e.setAttribute(o,n+""),n):(le.removeAttr(e,o),t))},removeAttr:function(e,t){var o,n,i=0,r=t&&t.match(ue);if(r&&1===e.nodeType)for(;o=r[i++];)n=le.propFix[o]||o,we.test(o)?!Ce&&Ie.test(o)?e[le.camelCase("default-"+o)]=e[n]=!1:e[n]=!1:le.attr(e,o,""),e.removeAttribute(Ce?o:n)},attrHooks:{type:{set:function(e,t){if(!le.support.radioValue&&"radio"===t&&le.nodeName(e,"input")){var o=e.value;return e.setAttribute("type",t),o&&(e.value=o),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,o,n){var i,r,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!le.isXMLDoc(e),a&&(o=le.propFix[o]||o,r=le.propHooks[o]),n!==t?r&&"set"in r&&(i=r.set(e,n,o))!==t?i:e[o]=n:r&&"get"in r&&null!==(i=r.get(e,o))?i:e[o]},propHooks:{tabIndex:{get:function(e){var o=e.getAttributeNode("tabindex");return o&&o.specified?parseInt(o.value,10):Se.test(e.nodeName)||Ne.test(e.nodeName)&&e.href?0:t}}}}),Te={get:function(e,o){var n=le.prop(e,o),i="boolean"==typeof n&&e.getAttribute(o),r="boolean"==typeof n?Re&&Ce?null!=i:Ie.test(o)?e[le.camelCase("default-"+o)]:!!i:e.getAttributeNode(o);return r&&!1!==r.value?o.toLowerCase():t},set:function(e,t,o){return!1===t?le.removeAttr(e,o):Re&&Ce||!Ie.test(o)?e.setAttribute(!Ce&&le.propFix[o]||o,o):e[le.camelCase("default-"+o)]=e[o]=!0,o}},Re&&Ce||(le.attrHooks.value={get:function(e,o){var n=e.getAttributeNode(o);return le.nodeName(e,"input")?e.defaultValue:n&&n.specified?n.value:t},set:function(e,o,n){return le.nodeName(e,"input")?(e.defaultValue=o,t):Ee&&Ee.set(e,o,n)}}),Ce||(Ee=le.valHooks.button={get:function(e,o){var n=e.getAttributeNode(o);return n&&("id"===o||"name"===o||"coords"===o?""!==n.value:n.specified)?n.value:t},set:function(e,o,n){var i=e.getAttributeNode(n);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(n)),i.value=o+="","value"===n||o===e.getAttribute(n)?o:t}},le.attrHooks.contenteditable={get:Ee.get,set:function(e,t,o){Ee.set(e,""!==t&&t,o)}},le.each(["width","height"],function(e,o){le.attrHooks[o]=le.extend(le.attrHooks[o],{set:function(e,n){return""===n?(e.setAttribute(o,"auto"),n):t}})})),le.support.hrefNormalized||(le.each(["href","src","width","height"],function(e,o){le.attrHooks[o]=le.extend(le.attrHooks[o],{get:function(e){var n=e.getAttribute(o,2);return null==n?t:n}})}),le.each(["href","src"],function(e,t){le.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),le.support.style||(le.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),le.support.optSelected||(le.propHooks.selected=le.extend(le.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),le.support.enctype||(le.propFix.enctype="encoding"),le.support.checkOn||le.each(["radio","checkbox"],function(){le.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),le.each(["radio","checkbox"],function(){le.valHooks[this]=le.extend(le.valHooks[this],{set:function(e,o){return le.isArray(o)?e.checked=le.inArray(le(e).val(),o)>=0:t}})});var ye=/^(?:input|select|textarea)$/i,Le=/^key/,De=/^(?:mouse|contextmenu)|click/,Ge=/^(?:focusinfocus|focusoutblur)$/,xe=/^([^.]*)(?:\.(.+)|)$/;le.event={global:{},add:function(e,o,n,i,r){var a,s,l,c,u,m,g,d,p,h,f,b=le._data(e);if(b){for(n.handler&&(c=n,n=c.handler,r=c.selector),n.guid||(n.guid=le.guid++),(s=b.events)||(s=b.events={}),(m=b.handle)||(m=b.handle=function(e){return typeof le===z||e&&le.event.triggered===e.type?t:le.event.dispatch.apply(m.elem,arguments)},m.elem=e),o=(o||"").match(ue)||[""],l=o.length;l--;)a=xe.exec(o[l])||[],p=f=a[1],h=(a[2]||"").split(".").sort(),u=le.event.special[p]||{},p=(r?u.delegateType:u.bindType)||p,u=le.event.special[p]||{},
g=le.extend({type:p,origType:f,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&le.expr.match.needsContext.test(r),namespace:h.join(".")},c),(d=s[p])||(d=s[p]=[],d.delegateCount=0,u.setup&&!1!==u.setup.call(e,i,h,m)||(e.addEventListener?e.addEventListener(p,m,!1):e.attachEvent&&e.attachEvent("on"+p,m))),u.add&&(u.add.call(e,g),g.handler.guid||(g.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,g):d.push(g),le.event.global[p]=!0;e=null}},remove:function(e,t,o,n,i){var r,a,s,l,c,u,m,g,d,p,h,f=le.hasData(e)&&le._data(e);if(f&&(u=f.events)){for(t=(t||"").match(ue)||[""],c=t.length;c--;)if(s=xe.exec(t[c])||[],d=h=s[1],p=(s[2]||"").split(".").sort(),d){for(m=le.event.special[d]||{},d=(n?m.delegateType:m.bindType)||d,g=u[d]||[],s=s[2]&&RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=g.length;r--;)a=g[r],!i&&h!==a.origType||o&&o.guid!==a.guid||s&&!s.test(a.namespace)||n&&n!==a.selector&&("**"!==n||!a.selector)||(g.splice(r,1),a.selector&&g.delegateCount--,m.remove&&m.remove.call(e,a));l&&!g.length&&(m.teardown&&!1!==m.teardown.call(e,p,f.handle)||le.removeEvent(e,d,f.handle),delete u[d])}else for(d in u)le.event.remove(e,d+t[c],o,n,!0);le.isEmptyObject(u)&&(delete f.handle,le._removeData(e,"events"))}},trigger:function(o,n,i,r){var a,s,l,c,u,m,g,d=[i||K],p=ae.call(o,"type")?o.type:o,h=ae.call(o,"namespace")?o.namespace.split("."):[];if(l=m=i=i||K,3!==i.nodeType&&8!==i.nodeType&&!Ge.test(p+le.event.triggered)&&(p.indexOf(".")>=0&&(h=p.split("."),p=h.shift(),h.sort()),s=0>p.indexOf(":")&&"on"+p,o=o[le.expando]?o:new le.Event(p,"object"==typeof o&&o),o.isTrigger=!0,o.namespace=h.join("."),o.namespace_re=o.namespace?RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,o.result=t,o.target||(o.target=i),n=null==n?[o]:le.makeArray(n,[o]),u=le.event.special[p]||{},r||!u.trigger||!1!==u.trigger.apply(i,n))){if(!r&&!u.noBubble&&!le.isWindow(i)){for(c=u.delegateType||p,Ge.test(c+p)||(l=l.parentNode);l;l=l.parentNode)d.push(l),m=l;m===(i.ownerDocument||K)&&d.push(m.defaultView||m.parentWindow||e)}for(g=0;(l=d[g++])&&!o.isPropagationStopped();)o.type=g>1?c:u.bindType||p,a=(le._data(l,"events")||{})[o.type]&&le._data(l,"handle"),a&&a.apply(l,n),(a=s&&l[s])&&le.acceptData(l)&&a.apply&&!1===a.apply(l,n)&&o.preventDefault();if(o.type=p,!(r||o.isDefaultPrevented()||u._default&&!1!==u._default.apply(i.ownerDocument,n)||"click"===p&&le.nodeName(i,"a")||!le.acceptData(i)||!s||!i[p]||le.isWindow(i))){m=i[s],m&&(i[s]=null),le.event.triggered=p;try{i[p]()}catch(se){}le.event.triggered=t,m&&(i[s]=m)}return o.result}},dispatch:function(e){e=le.event.fix(e);var o,n,i,r,a,s=[],l=ne.call(arguments),c=(le._data(this,"events")||{})[e.type]||[],u=le.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,e)){for(s=le.event.handlers.call(this,e,c),o=0;(r=s[o++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,a=0;(i=r.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,(n=((le.event.special[i.origType]||{}).handle||i.handler).apply(r.elem,l))!==t&&!1===(e.result=n)&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,o){var n,i,r,a,s=[],l=o.delegateCount,c=e.target;if(l&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(!0!==c.disabled||"click"!==e.type)){for(r=[],a=0;l>a;a++)i=o[a],n=i.selector+" ",r[n]===t&&(r[n]=i.needsContext?le(n,this).index(c)>=0:le.find(n,this,null,[c]).length),r[n]&&r.push(i);r.length&&s.push({elem:c,handlers:r})}return o.length>l&&s.push({elem:this,handlers:o.slice(l)}),s},fix:function(e){if(e[le.expando])return e;var t,o,n,i=e.type,r=e,a=this.fixHooks[i];for(a||(this.fixHooks[i]=a=De.test(i)?this.mouseHooks:Le.test(i)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,e=new le.Event(r),t=n.length;t--;)o=n[t],e[o]=r[o];return e.target||(e.target=r.srcElement||K),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,o){var n,i,r,a=o.button,s=o.fromElement;return null==e.pageX&&null!=o.clientX&&(i=e.target.ownerDocument||K,r=i.documentElement,n=i.body,e.pageX=o.clientX+(r&&r.scrollLeft||n&&n.scrollLeft||0)-(r&&r.clientLeft||n&&n.clientLeft||0),e.pageY=o.clientY+(r&&r.scrollTop||n&&n.scrollTop||0)-(r&&r.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?o.toElement:s),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return le.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==K.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===K.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,o,n){var i=le.extend(new le.Event,o,{type:e,isSimulated:!0,originalEvent:{}});n?le.event.trigger(i,null,t):le.event.dispatch.call(t,i),i.isDefaultPrevented()&&o.preventDefault()}},le.removeEvent=K.removeEventListener?function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o,!1)}:function(e,t,o){var n="on"+t;e.detachEvent&&(typeof e[n]===z&&(e[n]=null),e.detachEvent(n,o))},le.Event=function(e,o){return this instanceof le.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.defaultPrevented?l:c):this.type=e,o&&le.extend(this,o),this.timeStamp=e&&e.timeStamp||le.now(),this[le.expando]=!0,t):new le.Event(e,o)},le.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()}},le.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){le.event.special[e]={delegateType:t,bindType:t,handle:function(e){var o,n=this,i=e.relatedTarget,r=e.handleObj;return(!i||i!==n&&!le.contains(n,i))&&(e.type=r.origType,o=r.handler.apply(this,arguments),e.type=t),o}}}),le.support.submitBubbles||(le.event.special.submit={setup:function(){return!le.nodeName(this,"form")&&(le.event.add(this,"click._submit keypress._submit",function(e){var o=e.target,n=le.nodeName(o,"input")||le.nodeName(o,"button")?o.form:t;n&&!le._data(n,"submitBubbles")&&(le.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),le._data(n,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&le.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!le.nodeName(this,"form")&&(le.event.remove(this,"._submit"),t)}}),le.support.changeBubbles||(le.event.special.change={setup:function(){return ye.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(le.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),le.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),le.event.simulate("change",this,e,!0)})),!1):(le.event.add(this,"beforeactivate._change",function(e){var t=e.target;ye.test(t.nodeName)&&!le._data(t,"changeBubbles")&&(le.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||le.event.simulate("change",this.parentNode,e,!0)}),le._data(t,"changeBubbles",!0))}),t)},handle:function(e){var o=e.target;return this!==o||e.isSimulated||e.isTrigger||"radio"!==o.type&&"checkbox"!==o.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return le.event.remove(this,"._change"),!ye.test(this.nodeName)}}),le.support.focusinBubbles||le.each({focus:"focusin",blur:"focusout"},function(e,t){var o=0,n=function(e){le.event.simulate(t,e.target,le.event.fix(e),!0)};le.event.special[t]={setup:function(){0==o++&&K.addEventListener(e,n,!0)},teardown:function(){0==--o&&K.removeEventListener(e,n,!0)}}}),le.fn.extend({on:function(e,o,n,i,r){var a,s;if("object"==typeof e){"string"!=typeof o&&(n=n||o,o=t);for(a in e)this.on(a,o,n,e[a],r);return this}if(null==n&&null==i?(i=o,n=o=t):null==i&&("string"==typeof o?(i=n,n=t):(i=n,n=o,o=t)),!1===i)i=c;else if(!i)return this;return 1===r&&(s=i,i=function(e){return le().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=le.guid++)),this.each(function(){le.event.add(this,e,i,n,o)})},one:function(e,t,o,n){return this.on(e,t,o,n,1)},off:function(e,o,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,le(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,o,e[r]);return this}return(!1===o||"function"==typeof o)&&(n=o,o=t),!1===n&&(n=c),this.each(function(){le.event.remove(this,e,n,o)})},bind:function(e,t,o){return this.on(e,null,t,o)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,o,n){return this.on(t,e,o,n)},undelegate:function(e,t,o){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",o)},trigger:function(e,t){return this.each(function(){le.event.trigger(e,t,this)})},triggerHandler:function(e,o){var n=this[0];return n?le.event.trigger(e,o,n,!0):t}}),function(e,t){function o(e){return me.test(e+"")}function n(){var e,t=[];return e=function(o,n){return t.push(o+=" ")>P.cacheLength&&delete e[t.shift()],e[o]=n}}function i(e){return e[U]=!0,e}function r(e){var t=y.createElement("div");try{return e(t)}catch(E){return!1}finally{t=null}}function a(e,t,o,n){var i,r,a,s,l,m,g,d,p,h;if((t?t.ownerDocument||t:V)!==y&&R(t),t=t||y,o=o||[],!e||"string"!=typeof e)return o;if(1!==(s=t.nodeType)&&9!==s)return[];if(!D&&!n){if(i=ge.exec(e))if(a=i[1]){if(9===s){if(!(r=t.getElementById(a))||!r.parentNode)return o;if(r.id===a)return o.push(r),o}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(a))&&A(t,r)&&r.id===a)return o.push(r),o}else{if(i[2])return X.apply(o,J.call(t.getElementsByTagName(e),0)),o;if((a=i[3])&&W.getByClassName&&t.getElementsByClassName)return X.apply(o,J.call(t.getElementsByClassName(a),0)),o}if(W.qsa&&!G.test(e)){if(g=!0,d=U,p=t,h=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(m=c(e),(g=t.getAttribute("id"))?d=g.replace(he,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",l=m.length;l--;)m[l]=d+u(m[l]);p=ue.test(e)&&t.parentNode||t,h=m.join(",")}if(h)try{return X.apply(o,J.call(p.querySelectorAll(h),0)),o}catch(le){}finally{g||t.removeAttribute("id")}}}return v(e.replace(ne,"$1"),t,o,n)}function s(e,t){var o=t&&e,n=o&&(~t.sourceIndex||q)-(~e.sourceIndex||q);if(n)return n;if(o)for(;o=o.nextSibling;)if(o===t)return-1;return e?1:-1}function l(e){return i(function(t){return t=+t,i(function(o,n){for(var i,r=e([],o.length,t),a=r.length;a--;)o[i=r[a]]&&(o[i]=!(n[i]=o[i]))})})}function c(e,t){var o,n,i,r,s,l,c,u=j[e+" "];if(u)return t?0:u.slice(0);for(s=e,l=[],c=P.preFilter;s;){(!o||(n=ie.exec(s)))&&(n&&(s=s.slice(n[0].length)||s),l.push(i=[])),o=!1,(n=re.exec(s))&&(o=n.shift(),i.push({value:o,type:n[0].replace(ne," ")}),s=s.slice(o.length));for(r in P.filter)!(n=ce[r].exec(s))||c[r]&&!(n=c[r](n))||(o=n.shift(),i.push({value:o,type:r,matches:n}),s=s.slice(o.length));if(!o)break}return t?s.length:s?a.error(e):j(e,l).slice(0)}function u(e){for(var t=0,o=e.length,n="";o>t;t++)n+=e[t].value;return n}function m(e,t,o){var n=t.dir,i=o&&"parentNode"===n,r=F++;return t.first?function(t,o,r){for(;t=t[n];)if(1===t.nodeType||i)return e(t,o,r)}:function(t,o,a){var s,l,c,u=M+" "+r;if(a){for(;t=t[n];)if((1===t.nodeType||i)&&e(t,o,a))return!0}else for(;t=t[n];)if(1===t.nodeType||i)if(c=t[U]||(t[U]={}),(l=c[n])&&l[0]===u){if(!0===(s=l[1])||s===T)return!0===s}else if(l=c[n]=[u],l[1]=e(t,o,a)||T,!0===l[1])return!0}}function g(e){return e.length>1?function(t,o,n){for(var i=e.length;i--;)if(!e[i](t,o,n))return!1;return!0}:e[0]}function d(e,t,o,n,i){for(var r,a=[],s=0,l=e.length,c=null!=t;l>s;s++)(r=e[s])&&(!o||o(r,n,i))&&(a.push(r),c&&t.push(s));return a}function p(e,t,o,n,r,a){return n&&!n[U]&&(n=p(n)),r&&!r[U]&&(r=p(r,a)),i(function(i,a,s,l){var c,u,m,g=[],p=[],h=a.length,f=i||b(t||"*",s.nodeType?[s]:s,[]),v=!e||!i&&t?f:d(f,g,e,s,l),_=o?r||(i?e:h||n)?[]:a:v;if(o&&o(v,_,s,l),n)for(c=d(_,p),n(c,[],s,l),u=c.length;u--;)(m=c[u])&&(_[p[u]]=!(v[p[u]]=m));if(i){if(r||e){if(r){for(c=[],u=_.length;u--;)(m=_[u])&&c.push(v[u]=m);r(null,_=[],c,l)}for(u=_.length;u--;)(m=_[u])&&(c=r?Y.call(i,m):g[u])>-1&&(i[c]=!(a[c]=m))}}else _=d(_===a?_.splice(h,_.length):_),r?r(null,a,_,l):X.apply(a,_)})}function h(e){for(var t,o,n,i=e.length,r=P.relative[e[0].type],a=r||P.relative[" "],s=r?1:0,l=m(function(e){return e===t},a,!0),c=m(function(e){return Y.call(t,e)>-1},a,!0),d=[function(e,o,n){return!r&&(n||o!==C)||((t=o).nodeType?l(e,o,n):c(e,o,n))}];i>s;s++)if(o=P.relative[e[s].type])d=[m(g(d),o)];else{if(o=P.filter[e[s].type].apply(null,e[s].matches),o[U]){for(n=++s;i>n&&!P.relative[e[n].type];n++);return p(s>1&&g(d),s>1&&u(e.slice(0,s-1)).replace(ne,"$1"),o,n>s&&h(e.slice(s,n)),i>n&&h(e=e.slice(n)),i>n&&u(e))}d.push(o)}return g(d)}function f(e,t){var o=0,n=t.length>0,r=e.length>0,s=function(i,s,l,c,u){var m,g,p,h=[],f=0,b="0",v=i&&[],_=null!=u,E=C,S=i||r&&P.find.TAG("*",u&&s.parentNode||s),N=M+=null==E?1:Math.random()||.1;for(_&&(C=s!==y&&s,T=o);null!=(m=S[b]);b++){if(r&&m){for(g=0;p=e[g++];)if(p(m,s,l)){c.push(m);break}_&&(M=N,T=++o)}n&&((m=!p&&m)&&f--,i&&v.push(m))}if(f+=b,n&&b!==f){for(g=0;p=t[g++];)p(v,h,s,l);if(i){if(f>0)for(;b--;)v[b]||h[b]||(h[b]=K.call(c));h=d(h)}X.apply(c,h),_&&!i&&h.length>0&&f+t.length>1&&a.uniqueSort(c)}return _&&(M=N,C=E),v};return n?i(s):s}function b(e,t,o){for(var n=0,i=t.length;i>n;n++)a(e,t[n],o);return o}function v(e,t,o,n){var i,r,a,s,l,m=c(e);if(!n&&1===m.length){if(r=m[0]=m[0].slice(0),r.length>2&&"ID"===(a=r[0]).type&&9===t.nodeType&&!D&&P.relative[r[1].type]){if(!(t=P.find.ID(a.matches[0].replace(fe,be),t)[0]))return o;e=e.slice(r.shift().value.length)}for(i=ce.needsContext.test(e)?0:r.length;i--&&(a=r[i],!P.relative[s=a.type]);)if((l=P.find[s])&&(n=l(a.matches[0].replace(fe,be),ue.test(r[0].type)&&t.parentNode||t))){if(r.splice(i,1),!(e=n.length&&u(r)))return X.apply(o,J.call(n,0)),o;break}}return w(e,m)(n,t,D,o,ue.test(e)),o}function _(){}var E,T,P,S,N,w,I,C,R,y,L,D,G,x,O,A,k,U="sizzle"+-new Date,V=e.document,W={},M=0,F=0,H=n(),j=n(),B=n(),$=typeof t,q=1<<31,z=[],K=z.pop,X=z.push,J=z.slice,Y=z.indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(this[t]===e)return t;return-1},Q="[\\x20\\t\\r\\n\\f]",Z="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ee=Z.replace("w","w#"),te="\\["+Q+"*("+Z+")"+Q+"*(?:([*^$|!~]?=)"+Q+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ee+")|)|)"+Q+"*\\]",oe=":("+Z+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+te.replace(3,8)+")*)|.*)\\)|)",ne=RegExp("^"+Q+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Q+"+$","g"),ie=RegExp("^"+Q+"*,"+Q+"*"),re=RegExp("^"+Q+"*([\\x20\\t\\r\\n\\f>+~])"+Q+"*"),ae=RegExp(oe),se=RegExp("^"+ee+"$"),ce={ID:RegExp("^#("+Z+")"),CLASS:RegExp("^\\.("+Z+")"),NAME:RegExp("^\\[name=['\"]?("+Z+")['\"]?\\]"),TAG:RegExp("^("+Z.replace("w","w*")+")"),ATTR:RegExp("^"+te),PSEUDO:RegExp("^"+oe),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Q+"*(even|odd|(([+-]|)(\\d*)n|)"+Q+"*(?:([+-]|)"+Q+"*(\\d+)|))"+Q+"*\\)|)","i"),needsContext:RegExp("^"+Q+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Q+"*((?:-\\d)?\\d*)"+Q+"*\\)|)(?=[^-]|$)","i")},ue=/[\x20\t\r\n\f]*[+~]/,me=/^[^{]+\{\s*\[native code/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,de=/^(?:input|select|textarea|button)$/i,pe=/^h\d$/i,he=/'|\\/g,fe=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,be=function(e,t){var o="0x"+t-65536;return o!==o?t:0>o?String.fromCharCode(o+65536):String.fromCharCode(55296|o>>10,56320|1023&o)};try{J.call(V.documentElement.childNodes,0)[0].nodeType}catch(Ge){J=function(e){for(var t,o=[];t=this[e++];)o.push(t);return o}}N=a.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},R=a.setDocument=function(e){var n=e?e.ownerDocument||e:V;return n!==y&&9===n.nodeType&&n.documentElement?(y=n,L=n.documentElement,D=N(n),W.tagNameNoComments=r(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),W.attributes=r(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),W.getByClassName=r(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),W.getByName=r(function(e){e.id=U+0,e.innerHTML="<a name='"+U+"'></a><div name='"+U+"'></div>",L.insertBefore(e,L.firstChild);var t=n.getElementsByName&&n.getElementsByName(U).length===2+n.getElementsByName(U+0).length;return W.getIdNotName=!n.getElementById(U),L.removeChild(e),t}),P.attrHandle=r(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==$&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},W.getIdNotName?(P.find.ID=function(e,t){if(typeof t.getElementById!==$&&!D){var o=t.getElementById(e);return o&&o.parentNode?[o]:[]}},P.filter.ID=function(e){var t=e.replace(fe,be);return function(e){return e.getAttribute("id")===t}}):(P.find.ID=function(e,o){if(typeof o.getElementById!==$&&!D){var n=o.getElementById(e);return n?n.id===e||typeof n.getAttributeNode!==$&&n.getAttributeNode("id").value===e?[n]:t:[]}},P.filter.ID=function(e){var t=e.replace(fe,be);return function(e){var o=typeof e.getAttributeNode!==$&&e.getAttributeNode("id");return o&&o.value===t}}),P.find.TAG=W.tagNameNoComments?function(e,o){return typeof o.getElementsByTagName!==$?o.getElementsByTagName(e):t}:function(e,t){var o,n=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;o=r[i++];)1===o.nodeType&&n.push(o);return n}return r},P.find.NAME=W.getByName&&function(e,o){return typeof o.getElementsByName!==$?o.getElementsByName(name):t},P.find.CLASS=W.getByClassName&&function(e,o){return typeof o.getElementsByClassName===$||D?t:o.getElementsByClassName(e)},x=[],G=[":focus"],(W.qsa=o(n.querySelectorAll))&&(r(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||G.push("\\["+Q+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||G.push(":checked")}),r(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&G.push("[*^$]="+Q+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||G.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),G.push(",.*:")})),(W.matchesSelector=o(O=L.matchesSelector||L.mozMatchesSelector||L.webkitMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&r(function(e){W.disconnectedMatch=O.call(e,"div"),O.call(e,"[s!='']:x"),x.push("!=",oe)}),G=RegExp(G.join("|")),x=RegExp(x.join("|")),A=o(L.contains)||L.compareDocumentPosition?function(e,t){var o=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(o.contains?o.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},k=L.compareDocumentPosition?function(e,t){var o;return e===t?(I=!0,0):(o=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&o||e.parentNode&&11===e.parentNode.nodeType?e===n||A(V,e)?-1:t===n||A(V,t)?1:0:4&o?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var o,i=0,r=e.parentNode,a=t.parentNode,l=[e],c=[t];if(e===t)return I=!0,0;if(!r||!a)return e===n?-1:t===n?1:r?-1:a?1:0;if(r===a)return s(e,t);for(o=e;o=o.parentNode;)l.unshift(o);for(o=t;o=o.parentNode;)c.unshift(o);for(;l[i]===c[i];)i++;return i?s(l[i],c[i]):l[i]===V?-1:c[i]===V?1:0},I=!1,[0,0].sort(k),W.detectDuplicates=I,y):y},a.matches=function(e,t){return a(e,null,null,t)},a.matchesSelector=function(e,t){if((e.ownerDocument||e)!==y&&R(e),t=t.replace(/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,"='$1']"),!(!W.matchesSelector||D||x&&x.test(t)||G.test(t)))try{var o=O.call(e,t);if(o||W.disconnectedMatch||e.document&&11!==e.document.nodeType)return o}catch(T){}return a(t,y,null,[e]).length>0},a.contains=function(e,t){return(e.ownerDocument||e)!==y&&R(e),A(e,t)},a.attr=function(e,t){var o;return(e.ownerDocument||e)!==y&&R(e),D||(t=t.toLowerCase()),(o=P.attrHandle[t])?o(e):D||W.attributes?e.getAttribute(t):((o=e.getAttributeNode(t))||e.getAttribute(t))&&!0===e[t]?t:o&&o.specified?o.value:null},a.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},a.uniqueSort=function(e){var t,o=[],n=1,i=0;if(I=!W.detectDuplicates,e.sort(k),I){for(;t=e[n];n++)t===e[n-1]&&(i=o.push(n));for(;i--;)e.splice(o[i],1)}return e},S=a.getText=function(e){var t,o="",n=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)o+=S(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[n];n++)o+=S(t);return o},P=a.selectors={cacheLength:50,createPseudo:i,match:ce,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(fe,be),e[3]=(e[4]||e[5]||"").replace(fe,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var t,o=!e[5]&&e[2];return ce.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:o&&ae.test(o)&&(t=c(o,!0))&&(t=o.indexOf(")",o.length-t)-o.length)&&(e[0]=e[0].slice(0,t),e[2]=o.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(fe,be).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=H[e+" "];return t||(t=RegExp("(^|"+Q+")"+e+"("+Q+"|$)"))&&H(e,function(e){return t.test(e.className||typeof e.getAttribute!==$&&e.getAttribute("class")||"")})},ATTR:function(e,t,o){return function(n){var i=a.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===o:"!="===t?i!==o:"^="===t?o&&0===i.indexOf(o):"*="===t?o&&i.indexOf(o)>-1:"$="===t?o&&i.slice(-o.length)===o:"~="===t?(" "+i+" ").indexOf(o)>-1:"|="===t&&(i===o||i.slice(0,o.length+1)===o+"-"))}},CHILD:function(e,t,o,n,i){var r="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,o,l){var c,u,m,g,d,p,h=r!==a?"nextSibling":"previousSibling",f=t.parentNode,b=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(f){if(r){for(;h;){for(m=t;m=m[h];)if(s?m.nodeName.toLowerCase()===b:1===m.nodeType)return!1;p=h="only"===e&&!p&&"nextSibling"}return!0}if(p=[a?f.firstChild:f.lastChild],a&&v){for(u=f[U]||(f[U]={}),c=u[e]||[],d=c[0]===M&&c[1],g=c[0]===M&&c[2],m=d&&f.childNodes[d];m=++d&&m&&m[h]||(g=d=0)||p.pop();)if(1===m.nodeType&&++g&&m===t){u[e]=[M,d,g];break}}else if(v&&(c=(t[U]||(t[U]={}))[e])&&c[0]===M)g=c[1];else for(;(m=++d&&m&&m[h]||(g=d=0)||p.pop())&&((s?m.nodeName.toLowerCase()!==b:1!==m.nodeType)||!++g||(v&&((m[U]||(m[U]={}))[e]=[M,g]),m!==t)););return(g-=i)===n||0==g%n&&g/n>=0}}},PSEUDO:function(e,t){var o,n=P.pseudos[e]||P.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return n[U]?n(t):n.length>1?(o=[e,e,"",t],P.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,o){for(var i,r=n(e,t),a=r.length;a--;)i=Y.call(e,r[a]),e[i]=!(o[i]=r[a])}):function(e){return n(e,0,o)}):n}},pseudos:{not:i(function(e){var t=[],o=[],n=w(e.replace(ne,"$1"));return n[U]?i(function(e,t,o,i){for(var r,a=n(e,null,i,[]),s=e.length;s--;)(r=a[s])&&(e[s]=!(t[s]=r))}):function(e,i,r){return t[0]=e,n(t,null,r,o),!o.pop()}}),has:i(function(e){return function(t){return a(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:i(function(e){return se.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(fe,be).toLowerCase(),function(t){var o;do{if(o=D?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return(o=o.toLowerCase())===e||0===o.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var o=e.location&&e.location.hash;return o&&o.slice(1)===t.id},root:function(e){return e===L},focus:function(e){return e===y.activeElement&&(!y.hasFocus||y.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!P.pseudos.empty(e)},header:function(e){return pe.test(e.nodeName)},input:function(e){return de.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,o){return[0>o?o+t:o]}),even:l(function(e,t){for(var o=0;t>o;o+=2)e.push(o);return e}),odd:l(function(e,t){for(var o=1;t>o;o+=2)e.push(o);return e}),lt:l(function(e,t,o){for(var n=0>o?o+t:o;--n>=0;)e.push(n);return e}),gt:l(function(e,t,o){for(var n=0>o?o+t:o;t>++n;)e.push(n);return e})}};for(E in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})P.pseudos[E]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(E);for(E in{submit:!0,reset:!0})P.pseudos[E]=function(e){return function(t){var o=t.nodeName.toLowerCase();return("input"===o||"button"===o)&&t.type===e}}(E);w=a.compile=function(e,t){var o,n=[],i=[],r=B[e+" "];if(!r){for(t||(t=c(e)),o=t.length;o--;)r=h(t[o]),r[U]?n.push(r):i.push(r);r=B(e,f(i,n))}return r},P.pseudos.nth=P.pseudos.eq,P.filters=_.prototype=P.pseudos,P.setFilters=new _,R(),a.attr=le.attr,le.find=a,le.expr=a.selectors,le.expr[":"]=le.expr.pseudos,le.unique=a.uniqueSort,le.text=a.getText,le.isXMLDoc=a.isXML,le.contains=a.contains}(e);var Oe=/Until$/,Ae=/^(?:parents|prev(?:Until|All))/,ke=/^.[^:#\[\.,]*$/,Ue=le.expr.match.needsContext,Ve={children:!0,contents:!0,next:!0,prev:!0};le.fn.extend({find:function(e){var t,o,n,i=this.length;if("string"!=typeof e)return n=this,this.pushStack(le(e).filter(function(){for(t=0;i>t;t++)if(le.contains(n[t],this))return!0}));for(o=[],t=0;i>t;t++)le.find(e,this[t],o);return o=this.pushStack(i>1?le.unique(o):o),o.selector=(this.selector?this.selector+" ":"")+e,o},has:function(e){var t,o=le(e,this),n=o.length;return this.filter(function(){for(t=0;n>t;t++)if(le.contains(this,o[t]))return!0})},not:function(e){return this.pushStack(m(this,e,!1))},filter:function(e){return this.pushStack(m(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?Ue.test(e)?le(e,this.context).index(this[0])>=0:le.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var o,n=0,i=this.length,r=[],a=Ue.test(e)||"string"!=typeof e?le(e,t||this.context):0;i>n;n++)for(o=this[n];o&&o.ownerDocument&&o!==t&&11!==o.nodeType;){if(a?a.index(o)>-1:le.find.matchesSelector(o,e)){r.push(o);break}o=o.parentNode}return this.pushStack(r.length>1?le.unique(r):r)},index:function(e){return e?"string"==typeof e?le.inArray(this[0],le(e)):le.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var o="string"==typeof e?le(e,t):le.makeArray(e&&e.nodeType?[e]:e),n=le.merge(this.get(),o);return this.pushStack(le.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),le.fn.andSelf=le.fn.addBack,le.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return le.dir(e,"parentNode")},parentsUntil:function(e,t,o){return le.dir(e,"parentNode",o)},next:function(e){return u(e,"nextSibling")},prev:function(e){return u(e,"previousSibling")},nextAll:function(e){return le.dir(e,"nextSibling")},prevAll:function(e){return le.dir(e,"previousSibling")},nextUntil:function(e,t,o){return le.dir(e,"nextSibling",o)},prevUntil:function(e,t,o){return le.dir(e,"previousSibling",o)},siblings:function(e){return le.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return le.sibling(e.firstChild)},contents:function(e){return le.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:le.merge([],e.childNodes)}},function(e,t){le.fn[e]=function(o,n){var i=le.map(this,t,o);return Oe.test(e)||(n=o),n&&"string"==typeof n&&(i=le.filter(n,i)),i=this.length>1&&!Ve[e]?le.unique(i):i,this.length>1&&Ae.test(e)&&(i=i.reverse()),this.pushStack(i)}}),le.extend({filter:function(e,t,o){return o&&(e=":not("+e+")"),1===t.length?le.find.matchesSelector(t[0],e)?[t[0]]:[]:le.find.matches(e,t)},dir:function(e,o,n){for(var i=[],r=e[o];r&&9!==r.nodeType&&(n===t||1!==r.nodeType||!le(r).is(n));)1===r.nodeType&&i.push(r),r=r[o];return i},sibling:function(e,t){for(var o=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&o.push(e);return o}});var We="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Me=RegExp("<(?:"+We+")[\\s/>]","i"),Fe=/^\s+/,He=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,je=/<([\w:]+)/,Be=/<tbody/i,$e=/<|&#?\w+;/,qe=/<(?:script|style|link)/i,ze=/^(?:checkbox|radio)$/i,Ke=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^$|\/(?:java|ecma)script/i,Je=/^true\/(.*)/,Ye={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:le.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Qe=g(K),Ze=Qe.appendChild(K.createElement("div"));Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td,le.fn.extend({text:function(e){return le.access(this,function(e){return e===t?le.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(le.isFunction(e))return this.each(function(t){le(this).wrapAll(e.call(this,t))});if(this[0]){var t=le(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return le.isFunction(e)?this.each(function(t){le(this).wrapInner(e.call(this,t))}):this.each(function(){
var t=le(this),o=t.contents();o.length?o.wrapAll(e):t.append(e)})},wrap:function(e){var t=le.isFunction(e);return this.each(function(o){le(this).wrapAll(t?e.call(this,o):e)})},unwrap:function(){return this.parent().each(function(){le.nodeName(this,"body")||le(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var o,n=0;null!=(o=this[n]);n++)(!e||le.filter(e,[o]).length>0)&&(t||1!==o.nodeType||le.cleanData(_(o)),o.parentNode&&(t&&le.contains(o.ownerDocument,o)&&f(_(o,"script")),o.parentNode.removeChild(o)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&le.cleanData(_(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&le.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return le.clone(this,e,t)})},html:function(e){return le.access(this,function(e){var o=this[0]||{},n=0,i=this.length;if(e===t)return 1===o.nodeType?o.innerHTML.replace(/ jQuery\d+="(?:null|\d+)"/g,""):t;if(!("string"!=typeof e||qe.test(e)||!le.support.htmlSerialize&&Me.test(e)||!le.support.leadingWhitespace&&Fe.test(e)||Ye[(je.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(He,"<$1></$2>");try{for(;i>n;n++)o=this[n]||{},1===o.nodeType&&(le.cleanData(_(o,!1)),o.innerHTML=e);o=0}catch(K){}}o&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return le.isFunction(e)||"string"==typeof e||(e=le(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,o=this.parentNode;o&&(le(this).remove(),o.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,o,n){e=te.apply([],e);var i,r,a,s,l,c,u=0,m=this.length,g=this,f=m-1,b=e[0],v=le.isFunction(b);if(v||!(1>=m||"string"!=typeof b||le.support.checkClone)&&Ke.test(b))return this.each(function(i){var r=g.eq(i);v&&(e[0]=b.call(this,i,o?r.html():t)),r.domManip(e,o,n)});if(m&&(c=le.buildFragment(e,this[0].ownerDocument,!1,this),i=c.firstChild,1===c.childNodes.length&&(c=i),i)){for(o=o&&le.nodeName(i,"tr"),s=le.map(_(c,"script"),p),a=s.length;m>u;u++)r=c,u!==f&&(r=le.clone(r,!0,!0),a&&le.merge(s,_(r,"script"))),n.call(o&&le.nodeName(this[u],"table")?d(this[u],"tbody"):this[u],r,u);if(a)for(l=s[s.length-1].ownerDocument,le.map(s,h),u=0;a>u;u++)r=s[u],Xe.test(r.type||"")&&!le._data(r,"globalEval")&&le.contains(l,r)&&(r.src?le.ajax({url:r.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):le.globalEval((r.text||r.textContent||r.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,"")));c=i=null}return this}}),le.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){le.fn[e]=function(e){for(var o,n=0,i=[],r=le(e),a=r.length-1;a>=n;n++)o=n===a?this:this.clone(!0),le(r[n])[t](o),oe.apply(i,o.get());return this.pushStack(i)}}),le.extend({clone:function(e,t,o){var n,i,r,a,s,l=le.contains(e.ownerDocument,e);if(le.support.html5Clone||le.isXMLDoc(e)||!Me.test("<"+e.nodeName+">")?r=e.cloneNode(!0):(Ze.innerHTML=e.outerHTML,Ze.removeChild(r=Ze.firstChild)),!(le.support.noCloneEvent&&le.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||le.isXMLDoc(e)))for(n=_(r),s=_(e),a=0;null!=(i=s[a]);++a)n[a]&&v(i,n[a]);if(t)if(o)for(s=s||_(e),n=n||_(r),a=0;null!=(i=s[a]);a++)b(i,n[a]);else b(e,r);return n=_(r,"script"),n.length>0&&f(n,!l&&_(e,"script")),n=s=i=null,r},buildFragment:function(e,t,o,n){for(var i,r,a,s,l,c,u,m=e.length,d=g(t),p=[],h=0;m>h;h++)if((r=e[h])||0===r)if("object"===le.type(r))le.merge(p,r.nodeType?[r]:r);else if($e.test(r)){for(s=s||d.appendChild(t.createElement("div")),l=(je.exec(r)||["",""])[1].toLowerCase(),u=Ye[l]||Ye._default,s.innerHTML=u[1]+r.replace(He,"<$1></$2>")+u[2],i=u[0];i--;)s=s.lastChild;if(!le.support.leadingWhitespace&&Fe.test(r)&&p.push(t.createTextNode(Fe.exec(r)[0])),!le.support.tbody)for(r="table"!==l||Be.test(r)?"<table>"!==u[1]||Be.test(r)?0:s:s.firstChild,i=r&&r.childNodes.length;i--;)le.nodeName(c=r.childNodes[i],"tbody")&&!c.childNodes.length&&r.removeChild(c);for(le.merge(p,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=d.lastChild}else p.push(t.createTextNode(r));for(s&&d.removeChild(s),le.support.appendChecked||le.grep(_(p,"input"),E),h=0;r=p[h++];)if((!n||-1===le.inArray(r,n))&&(a=le.contains(r.ownerDocument,r),s=_(d.appendChild(r),"script"),a&&f(s),o))for(i=0;r=s[i++];)Xe.test(r.type||"")&&o.push(r);return s=null,d},cleanData:function(e,t){for(var o,n,i,r,a=0,s=le.expando,l=le.cache,c=le.support.deleteExpando,u=le.event.special;null!=(o=e[a]);a++)if((t||le.acceptData(o))&&(i=o[s],r=i&&l[i])){if(r.events)for(n in r.events)u[n]?le.event.remove(o,n):le.removeEvent(o,n,r.handle);l[i]&&(delete l[i],c?delete o[s]:typeof o.removeAttribute!==z?o.removeAttribute(s):o[s]=null,Z.push(i))}}});var et,tt,ot,nt=/alpha\([^)]*\)/i,it=/opacity\s*=\s*([^)]*)/,rt=/^(top|right|bottom|left)$/,at=/^(none|table(?!-c[ea]).+)/,st=/^margin/,lt=RegExp("^("+ce+")(.*)$","i"),ct=RegExp("^("+ce+")(?!px)[a-z%]+$","i"),ut=RegExp("^([+-])=("+ce+")","i"),mt={BODY:"block"},gt={position:"absolute",visibility:"hidden",display:"block"},dt={letterSpacing:0,fontWeight:400},pt=["Top","Right","Bottom","Left"],ht=["Webkit","O","Moz","ms"];le.fn.extend({css:function(e,o){return le.access(this,function(e,o,n){var i,r,a={},s=0;if(le.isArray(o)){for(r=tt(e),i=o.length;i>s;s++)a[o[s]]=le.css(e,o[s],!1,r);return a}return n!==t?le.style(e,o,n):le.css(e,o)},e,o,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:P(this))?le(this).show():le(this).hide()})}}),le.extend({cssHooks:{opacity:{get:function(e,t){if(t){var o=ot(e,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":le.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,o,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,a,s,l=le.camelCase(o),c=e.style;if(o=le.cssProps[l]||(le.cssProps[l]=T(c,l)),s=le.cssHooks[o]||le.cssHooks[l],n===t)return s&&"get"in s&&(r=s.get(e,!1,i))!==t?r:c[o];if(a=typeof n,"string"===a&&(r=ut.exec(n))&&(n=(r[1]+1)*r[2]+parseFloat(le.css(e,o)),a="number"),!(null==n||"number"===a&&isNaN(n)||("number"!==a||le.cssNumber[l]||(n+="px"),le.support.clearCloneStyle||""!==n||0!==o.indexOf("background")||(c[o]="inherit"),s&&"set"in s&&(n=s.set(e,n,i))===t)))try{c[o]=n}catch(Z){}}},css:function(e,o,n,i){var r,a,s,l=le.camelCase(o);return o=le.cssProps[l]||(le.cssProps[l]=T(e.style,l)),s=le.cssHooks[o]||le.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,n)),a===t&&(a=ot(e,o,i)),"normal"===a&&o in dt&&(a=dt[o]),""===n||n?(r=parseFloat(a),!0===n||le.isNumeric(r)?r||0:a):a},swap:function(e,t,o,n){var i,r,a={};for(r in t)a[r]=e.style[r],e.style[r]=t[r];i=o.apply(e,n||[]);for(r in t)e.style[r]=a[r];return i}}),e.getComputedStyle?(tt=function(t){return e.getComputedStyle(t,null)},ot=function(e,o,n){var i,r,a,s=n||tt(e),l=s?s.getPropertyValue(o)||s[o]:t,c=e.style;return s&&(""!==l||le.contains(e.ownerDocument,e)||(l=le.style(e,o)),ct.test(l)&&st.test(o)&&(i=c.width,r=c.minWidth,a=c.maxWidth,c.minWidth=c.maxWidth=c.width=l,l=s.width,c.width=i,c.minWidth=r,c.maxWidth=a)),l}):K.documentElement.currentStyle&&(tt=function(e){return e.currentStyle},ot=function(e,o,n){var i,r,a,s=n||tt(e),l=s?s[o]:t,c=e.style;return null==l&&c&&c[o]&&(l=c[o]),ct.test(l)&&!rt.test(o)&&(i=c.left,r=e.runtimeStyle,a=r&&r.left,a&&(r.left=e.currentStyle.left),c.left="fontSize"===o?"1em":l,l=c.pixelLeft+"px",c.left=i,a&&(r.left=a)),""===l?"auto":l}),le.each(["height","width"],function(e,o){le.cssHooks[o]={get:function(e,n,i){return n?0===e.offsetWidth&&at.test(le.css(e,"display"))?le.swap(e,gt,function(){return I(e,o,i)}):I(e,o,i):t},set:function(e,t,n){var i=n&&tt(e);return N(e,t,n?w(e,o,n,le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,i),i):0)}}}),le.support.opacity||(le.cssHooks.opacity={get:function(e,t){return it.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var o=e.style,n=e.currentStyle,i=le.isNumeric(t)?"alpha(opacity="+100*t+")":"",r=n&&n.filter||o.filter||"";o.zoom=1,(t>=1||""===t)&&""===le.trim(r.replace(nt,""))&&o.removeAttribute&&(o.removeAttribute("filter"),""===t||n&&!n.filter)||(o.filter=nt.test(r)?r.replace(nt,i):r+" "+i)}}),le(function(){le.support.reliableMarginRight||(le.cssHooks.marginRight={get:function(e,o){return o?le.swap(e,{display:"inline-block"},ot,[e,"marginRight"]):t}}),!le.support.pixelPosition&&le.fn.position&&le.each(["top","left"],function(e,o){le.cssHooks[o]={get:function(e,n){return n?(n=ot(e,o),ct.test(n)?le(e).position()[o]+"px":n):t}}})}),le.expr&&le.expr.filters&&(le.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!le.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||le.css(e,"display"))},le.expr.filters.visible=function(e){return!le.expr.filters.hidden(e)}),le.each({margin:"",padding:"",border:"Width"},function(e,t){le.cssHooks[e+t]={expand:function(o){for(var n=0,i={},r="string"==typeof o?o.split(" "):[o];4>n;n++)i[e+pt[n]+t]=r[n]||r[n-2]||r[0];return i}},st.test(e)||(le.cssHooks[e+t].set=N)});var ft=/\[\]$/,bt=/^(?:submit|button|image|reset|file)$/i,vt=/^(?:input|select|textarea|keygen)/i;le.fn.extend({serialize:function(){return le.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=le.prop(this,"elements");return e?le.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!le(this).is(":disabled")&&vt.test(this.nodeName)&&!bt.test(e)&&(this.checked||!ze.test(e))}).map(function(e,t){var o=le(this).val();return null==o?null:le.isArray(o)?le.map(o,function(e){return{name:t.name,value:e.replace(/\r?\n/g,"\r\n")}}):{name:t.name,value:o.replace(/\r?\n/g,"\r\n")}}).get()}}),le.param=function(e,o){var n,i=[],r=function(e,t){t=le.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(o===t&&(o=le.ajaxSettings&&le.ajaxSettings.traditional),le.isArray(e)||e.jquery&&!le.isPlainObject(e))le.each(e,function(){r(this.name,this.value)});else for(n in e)y(n,e[n],o,r);return i.join("&").replace(/%20/g,"+")},le.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){le.fn[t]=function(e,o){return arguments.length>0?this.on(t,null,e,o):this.trigger(t)}}),le.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var _t,Et,Tt=le.now(),Pt=/\?/,St=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,wt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,It=/^(?:GET|HEAD)$/,Ct=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Rt=le.fn.load,yt={},Lt={},Dt="*/".concat("*");try{Et=X.href}catch($t){Et=K.createElement("a"),Et.href="",Et=Et.href}_t=Ct.exec(Et.toLowerCase())||[],le.fn.load=function(e,o,n){if("string"!=typeof e&&Rt)return Rt.apply(this,arguments);var i,r,a,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),le.isFunction(o)?(n=o,o=t):o&&"object"==typeof o&&(a="POST"),s.length>0&&le.ajax({url:e,type:a,dataType:"html",data:o}).done(function(e){r=arguments,s.html(i?le("<div>").append(le.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){s.each(n,r||[e.responseText,t,e])}),this},le.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){le.fn[t]=function(e){return this.on(t,e)}}),le.each(["get","post"],function(e,o){le[o]=function(e,n,i,r){return le.isFunction(n)&&(r=r||i,i=n,n=t),le.ajax({url:e,type:o,dataType:r,data:n,success:i})}}),le.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et,type:"GET",isLocal:wt.test(_t[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":le.parseJSON,"text xml":le.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?G(G(e,le.ajaxSettings),t):G(le.ajaxSettings,e)},ajaxPrefilter:L(yt),ajaxTransport:L(Lt),ajax:function(e,o){function n(e,o,n,i){var r,m,v,_,T,S=o;2!==E&&(E=2,l&&clearTimeout(l),u=t,s=i||"",P.readyState=e>0?4:0,n&&(_=x(g,P,n)),e>=200&&300>e||304===e?(g.ifModified&&(T=P.getResponseHeader("Last-Modified"),T&&(le.lastModified[a]=T),(T=P.getResponseHeader("etag"))&&(le.etag[a]=T)),204===e?(r=!0,S="nocontent"):304===e?(r=!0,S="notmodified"):(r=O(g,_),S=r.state,m=r.data,v=r.error,r=!v)):(v=S,(e||!S)&&(S="error",0>e&&(e=0))),P.status=e,P.statusText=(o||S)+"",r?h.resolveWith(d,[m,S,P]):h.rejectWith(d,[P,S,v]),P.statusCode(b),b=t,c&&p.trigger(r?"ajaxSuccess":"ajaxError",[P,g,r?m:v]),f.fireWith(d,[P,S]),c&&(p.trigger("ajaxComplete",[P,g]),--le.active||le.event.trigger("ajaxStop")))}"object"==typeof e&&(o=e,e=t),o=o||{};var i,r,a,s,l,c,u,m,g=le.ajaxSetup({},o),d=g.context||g,p=g.context&&(d.nodeType||d.jquery)?le(d):le.event,h=le.Deferred(),f=le.Callbacks("once memory"),b=g.statusCode||{},v={},_={},E=0,T="canceled",P={readyState:0,getResponseHeader:function(e){var t;if(2===E){if(!m)for(m={};t=Nt.exec(s);)m[t[1].toLowerCase()]=t[2];t=m[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===E?s:null},setRequestHeader:function(e,t){var o=e.toLowerCase();return E||(e=_[o]=_[o]||e,v[e]=t),this},overrideMimeType:function(e){return E||(g.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>E)for(t in e)b[t]=[b[t],e[t]];else P.always(e[P.status]);return this},abort:function(e){var t=e||T;return u&&u.abort(t),n(0,t),this}};if(h.promise(P).complete=f.add,P.success=P.done,P.error=P.fail,g.url=((e||g.url||Et)+"").replace(/#.*$/,"").replace(/^\/\//,_t[1]+"//"),g.type=o.method||o.type||g.method||g.type,g.dataTypes=le.trim(g.dataType||"*").toLowerCase().match(ue)||[""],null==g.crossDomain&&(i=Ct.exec(g.url.toLowerCase()),g.crossDomain=!(!i||i[1]===_t[1]&&i[2]===_t[2]&&(i[3]||("http:"===i[1]?80:443))==(_t[3]||("http:"===_t[1]?80:443)))),g.data&&g.processData&&"string"!=typeof g.data&&(g.data=le.param(g.data,g.traditional)),D(yt,g,o,P),2===E)return P;c=g.global,c&&0==le.active++&&le.event.trigger("ajaxStart"),g.type=g.type.toUpperCase(),g.hasContent=!It.test(g.type),a=g.url,g.hasContent||(g.data&&(a=g.url+=(Pt.test(a)?"&":"?")+g.data,delete g.data),!1===g.cache&&(g.url=St.test(a)?a.replace(St,"$1_="+Tt++):a+(Pt.test(a)?"&":"?")+"_="+Tt++)),g.ifModified&&(le.lastModified[a]&&P.setRequestHeader("If-Modified-Since",le.lastModified[a]),le.etag[a]&&P.setRequestHeader("If-None-Match",le.etag[a])),(g.data&&g.hasContent&&!1!==g.contentType||o.contentType)&&P.setRequestHeader("Content-Type",g.contentType),P.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+("*"!==g.dataTypes[0]?", "+Dt+"; q=0.01":""):g.accepts["*"]);for(r in g.headers)P.setRequestHeader(r,g.headers[r]);if(g.beforeSend&&(!1===g.beforeSend.call(d,P,g)||2===E))return P.abort();T="abort";for(r in{success:1,error:1,complete:1})P[r](g[r]);if(u=D(Lt,g,o,P)){P.readyState=1,c&&p.trigger("ajaxSend",[P,g]),g.async&&g.timeout>0&&(l=setTimeout(function(){P.abort("timeout")},g.timeout));try{E=1,u.send(v,n)}catch(ge){if(!(2>E))throw ge;n(-1,ge)}}else n(-1,"No Transport");return P},getScript:function(e,o){return le.get(e,t,o,"script")},getJSON:function(e,t,o){return le.get(e,t,o,"json")}}),le.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return le.globalEval(e),e}}}),le.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),le.ajaxTransport("script",function(e){if(e.crossDomain){var o,n=K.head||le("head")[0]||K.documentElement;return{send:function(t,i){o=K.createElement("script"),o.async=!0,e.scriptCharset&&(o.charset=e.scriptCharset),o.src=e.url,o.onload=o.onreadystatechange=function(e,t){(t||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),o=null,t||i(200,"success"))},n.insertBefore(o,n.firstChild)},abort:function(){o&&o.onload(t,!0)}}}});var Gt=[],xt=/(=)\?(?=&|$)|\?\?/;le.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gt.pop()||le.expando+"_"+Tt++;return this[e]=!0,e}}),le.ajaxPrefilter("json jsonp",function(o,n,i){var r,a,s,l=!1!==o.jsonp&&(xt.test(o.url)?"url":"string"==typeof o.data&&!(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&xt.test(o.data)&&"data");return l||"jsonp"===o.dataTypes[0]?(r=o.jsonpCallback=le.isFunction(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,l?o[l]=o[l].replace(xt,"$1"+r):!1!==o.jsonp&&(o.url+=(Pt.test(o.url)?"&":"?")+o.jsonp+"="+r),o.converters["script json"]=function(){return s||le.error(r+" was not called"),s[0]},o.dataTypes[0]="json",a=e[r],e[r]=function(){s=arguments},i.always(function(){e[r]=a,o[r]&&(o.jsonpCallback=n.jsonpCallback,Gt.push(r)),s&&le.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Ot,At,kt=0,Ut=e.ActiveXObject&&function(){var e;for(e in Ot)Ot[e](t,!0)};le.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&A()||k()}:A,At=le.ajaxSettings.xhr(),le.support.cors=!!At&&"withCredentials"in At,(At=le.support.ajax=!!At)&&le.ajaxTransport(function(o){if(!o.crossDomain||le.support.cors){var n;return{send:function(i,r){var a,s,l=o.xhr();if(o.username?l.open(o.type,o.url,o.async,o.username,o.password):l.open(o.type,o.url,o.async),o.xhrFields)for(s in o.xhrFields)l[s]=o.xhrFields[s];o.mimeType&&l.overrideMimeType&&l.overrideMimeType(o.mimeType),o.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(Q){}l.send(o.hasContent&&o.data||null),n=function(e,i){var s,c,u,m;try{if(n&&(i||4===l.readyState))if(n=t,a&&(l.onreadystatechange=le.noop,Ut&&delete Ot[a]),i)4!==l.readyState&&l.abort();else{m={},s=l.status,c=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(m.text=l.responseText);try{u=l.statusText}catch(te){u=""}s||!o.isLocal||o.crossDomain?1223===s&&(s=204):s=m.text?200:404}}catch(oe){i||r(-1,oe)}m&&r(s,u,m,c)},o.async?4===l.readyState?setTimeout(n):(a=++kt,Ut&&(Ot||(Ot={},le(e).unload(Ut)),Ot[a]=n),l.onreadystatechange=n):n()},abort:function(){n&&n(t,!0)}}}});var Vt,Wt,Mt=/^(?:toggle|show|hide)$/,Ft=RegExp("^(?:([+-])=|)("+ce+")([a-z%]*)$","i"),Ht=/queueHooks$/,jt=[F],Bt={"*":[function(e,t){var o,n,i=this.createTween(e,t),r=Ft.exec(t),a=i.cur(),s=+a||0,l=1,c=20;if(r){if(o=+r[2],"px"!==(n=r[3]||(le.cssNumber[e]?"":"px"))&&s){s=le.css(i.elem,e,!0)||o||1;do{l=l||".5",s/=l,le.style(i.elem,e,s+n)}while(l!==(l=i.cur()/a)&&1!==l&&--c)}i.unit=n,i.start=s,i.end=r[1]?s+(r[1]+1)*o:o}return i}]};le.Animation=le.extend(W,{tweener:function(e,t){le.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var o,n=0,i=e.length;i>n;n++)o=e[n],Bt[o]=Bt[o]||[],Bt[o].unshift(t)},prefilter:function(e,t){t?jt.unshift(e):jt.push(e)}}),le.Tween=H,H.prototype={constructor:H,init:function(e,t,o,n,i,r){this.elem=e,this.prop=o,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=r||(le.cssNumber[o]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var t,o=H.propHooks[this.prop];return this.pos=t=this.options.duration?le.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),o&&o.set?o.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=le.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){le.fx.step[e.prop]?le.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[le.cssProps[e.prop]]||le.cssHooks[e.prop])?le.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},le.each(["toggle","show","hide"],function(e,t){var o=le.fn[t];le.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(j(t,!0),e,n,i)}}),le.fn.extend({fadeTo:function(e,t,o,n){return this.filter(P).css("opacity",0).show().end().animate({opacity:t},e,o,n)},animate:function(e,t,o,n){var i=le.isEmptyObject(e),r=le.speed(t,o,n),a=function(){var t=W(this,le.extend({},e),r);a.finish=function(){t.stop(!0)},(i||le._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===r.queue?this.each(a):this.queue(r.queue,a)},stop:function(e,o,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=o,o=e,e=t),o&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",r=le.timers,a=le._data(this);if(o)a[o]&&a[o].stop&&i(a[o]);else for(o in a)a[o]&&a[o].stop&&Ht.test(o)&&i(a[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(n),t=!1,r.splice(o,1));(t||!n)&&le.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,o=le._data(this),n=o[e+"queue"],i=o[e+"queueHooks"],r=le.timers,a=n?n.length:0;for(o.finish=!0,le.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;a>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete o.finish})}}),le.each({slideDown:j("show"),slideUp:j("hide"),slideToggle:j("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){le.fn[e]=function(e,o,n){return this.animate(t,e,o,n)}}),le.speed=function(e,t,o){var n=e&&"object"==typeof e?le.extend({},e):{complete:o||!o&&t||le.isFunction(e)&&e,duration:e,easing:o&&t||t&&!le.isFunction(t)&&t};return n.duration=le.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in le.fx.speeds?le.fx.speeds[n.duration]:le.fx.speeds._default,(null==n.queue||!0===n.queue)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){le.isFunction(n.old)&&n.old.call(this),n.queue&&le.dequeue(this,n.queue)},n},le.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},le.timers=[],le.fx=H.prototype.init,le.fx.tick=function(){var e,o=le.timers,n=0;for(Vt=le.now();o.length>n;n++)(e=o[n])()||o[n]!==e||o.splice(n--,1);o.length||le.fx.stop(),Vt=t},le.fx.timer=function(e){e()&&le.timers.push(e)&&le.fx.start()},le.fx.interval=13,le.fx.start=function(){Wt||(Wt=setInterval(le.fx.tick,le.fx.interval))},le.fx.stop=function(){clearInterval(Wt),Wt=null},le.fx.speeds={slow:600,fast:200,_default:400},le.fx.step={},le.expr&&le.expr.filters&&(le.expr.filters.animated=function(e){return le.grep(le.timers,function(t){return e===t.elem}).length}),le.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){le.offset.setOffset(this,e,t)});var o,n,i={top:0,left:0},r=this[0],a=r&&r.ownerDocument;return a?(o=a.documentElement,le.contains(o,r)?(typeof r.getBoundingClientRect!==z&&(i=r.getBoundingClientRect()),n=B(a),{top:i.top+(n.pageYOffset||o.scrollTop)-(o.clientTop||0),left:i.left+(n.pageXOffset||o.scrollLeft)-(o.clientLeft||0)}):i):void 0},le.offset={setOffset:function(e,t,o){var n=le.css(e,"position");"static"===n&&(e.style.position="relative");var i,r,a=le(e),s=a.offset(),l=le.css(e,"top"),c=le.css(e,"left"),u=("absolute"===n||"fixed"===n)&&le.inArray("auto",[l,c])>-1,m={},g={};u?(g=a.position(),i=g.top,r=g.left):(i=parseFloat(l)||0,r=parseFloat(c)||0),le.isFunction(t)&&(t=t.call(e,o,s)),null!=t.top&&(m.top=t.top-s.top+i),null!=t.left&&(m.left=t.left-s.left+r),"using"in t?t.using.call(e,m):a.css(m)}},le.fn.extend({position:function(){if(this[0]){var e,t,o={top:0,left:0},n=this[0];return"fixed"===le.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),le.nodeName(e[0],"html")||(o=e.offset()),o.top+=le.css(e[0],"borderTopWidth",!0),o.left+=le.css(e[0],"borderLeftWidth",!0)),{top:t.top-o.top-le.css(n,"marginTop",!0),left:t.left-o.left-le.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||K.documentElement;e&&!le.nodeName(e,"html")&&"static"===le.css(e,"position");)e=e.offsetParent;return e||K.documentElement})}}),le.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,o){var n=/Y/.test(o);le.fn[e]=function(i){return le.access(this,function(e,i,r){var a=B(e);return r===t?a?o in a?a[o]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(n?le(a).scrollLeft():r,n?r:le(a).scrollTop()):e[i]=r,t)},e,i,arguments.length,null)}}),le.each({Height:"height",Width:"width"},function(e,o){le.each({padding:"inner"+e,content:o,"":"outer"+e},function(n,i){le.fn[i]=function(i,r){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===r?"margin":"border");return le.access(this,function(o,n,i){var r;return le.isWindow(o)?o.document.documentElement["client"+e]:9===o.nodeType?(r=o.documentElement,Math.max(o.body["scroll"+e],r["scroll"+e],o.body["offset"+e],r["offset"+e],r["client"+e])):i===t?le.css(o,n,s):le.style(o,n,i,s)},o,a?i:t,a,null)}})}),e.jQuery=e.$=le,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return le})}(window);var j$=jQuery.noConflict(),global={isdebugversion_showengineselection:!1,isdebugversion:!1,isdebugversionwebrtc:!1,isdebugengine:!1,linmacnsengine:!0,winlinmacnsengine:!1,deviceType:"-1",autoServerDeployVersion:!1,lastautoprovserver:"",checkforautoprov:!0,flagWaitforautoprov:!1,code_version:17,config_version:1,versionstr:"3.0.0130",minimumserviceversion:24,maximumserviceversion:20,useengine:"",useengineclicked_cache:0,last_useengine:"",ENGINE_WEBPHONE:"java",ENGINE_WEBRTC:"webrtc",ENGINE_SERVICE:"ns",ENGINE_FLASH:"flash",ENGINE_APP:"app",webrtcavailable:-1,engineselecttime:0,engineselectstage:-1,ENGINE_DELAY:1e3,iscurrengineworking:!1,isfirststart:!1,recwsload:0,usuk:"",predefLoglevel:5,logs:"",nrofrecentstodisplay:10,closeCallAtivity:!1,nrOfCallfunctionsToDisplay:5,pagewasrefreshed:!0,ringstart_time:0,callstart_time:0,wasSettModified:!1,wasCtModified:!1,wasChModified:!1,autoprovsrv_1:"https://www.webvoipphone.com/psettings/",autoprovsrv_2:"https://www.mizu-voip.com/phonesettings/",ctlist:[],chlist:[],aclist:[],recentlist:[],searchctlist:[],reloadcontactsaftersync:!1,refreshrecents:!1,readcallhistoryforrecents:!0,isencrypted:0,audio_rec_device_list:"",audio_play_device_list:"",audio_ring_device_list:"",audio_devices_loaded:!1,audio_rec_curr_device:"",audio_play_curr_device:"",audio_ring_curr_device:"",video_rec_device_list:"",video_rec_curr_device:"",usestorage:!0,phonestarted:0,service_last_life_signal:0,useajax_forservice:!1,serviceStatusPollTimer:null,STORAGE_AUTO:0,STORAGE_COOKIE:1,STORAGE_LOCAL:2,ACCOUNTS_FILENAME:"wp_accounts",CONTACTS_FILENAME:"wp_contacts",SALT:"q8fgdahp9",SALT2:"vm1nye8ur2w",WIN_SOFTPHONE_URL:"http://127.0.0.1:18420",NATIVE_PLUGIN_URL:"ws://127.0.0.1:18520/msstwebsock",NATIVE_PLUGIN_URL_SECURE2:"",NATIVE_PLUGIN_URL_SECURE:"wss://ns3.webvoipphone.com:10443/msstwebsock",ENABLE_JAVA_URL:"http://java.com/en/download/help/enable_browser.xml",INSTALL_JAVA_URL:"http://www.java.com/download/",NATIVE_PLUGIN_LINMAC_URL_SECURE:"wss://ns3.webvoipphone.com:19433",ec_apikey:"aJ6aqK4Nah3hnP7aht",ec_autoprov:"gJa6B2oa5Nx3Kya8n",wssupported:!1,httpmehod:"",currhttpmehodworking:!1,File:null,domloaded:!1,loglevel:1,incommingCall:!1,acceptReject:!1,checkIfInCall:!1,checkIfCallActive:!1,callTypeInOut:"",lastRingEvenet:"",hangupPressedCount:0,maintimerid:null,polltimerid:null,worktimer:null,httpkatimer:0,initcalled:!1,callName:"",credit:"",creditRequestIval:100,CREDIT_REQUEST_IVAL_DEFVAL:12e3,creditRequestTimer:0,apppletloaded:!1,presenceHM:{},waitforpresence:0,presence_started:!1,last_used_engine_cache:"",haschat:3,applet_started:!1,speakerState:!0,bluetoothState:!0,lastcalldetails:"",lastcallduration:0,isfirstwsu:!0,wsuser_succeded:!1,notifs:[],intentsettings:[],intentctdetails:[],intentcall:[],intentaddeditct:[],intentchdetails:[],intentmsg:[],intentbrowser:[],intentstartpage:[],intentfiletransfer:[],intentsmscodeverify:[],rating:"",httpreqasynccallback:null,bwanswercallback:null,bwanswerfilename:null,bwanswerINCNUMBER:0,dispSaveSettMsg:0,showratewhiletype_cache:0,nsupdatepending:!1,isDialpadStarted:!1,isCallStarted:!1,isContactslistStarted:!1,isContactdetailsStarted:!1,isCallhistorylistStarted:!1,isCallhistorydetailsStarted:!1,isSettingsStarted:!1,isAddeditcontactStarted:!1,isMessagelistStarted:!1,isMessageStarted:!1,isInternalbrowserStarted:!1,isStartpageStarted:!1,isLogviewStarted:!1,isNewuserStarted:!1,isSmscodeverifyStarted:!1,isFiletransferStarted:!1,isFiltersStarted:!1,isAccountsStarted:!1,isExtra1Started:!1,isExtra2Started:!1,isExtra3Started:!1,isExtra4Started:!1,isExtra5Started:!1,alreadyCalledNrs:"",contactExists:!0,contactExistsNr:"",authenticated_displayed:!1,favafone_autologin:!1,aline:1,acallcount:0,onloaded_called:!1,wploaded:!1,ep:[],lnstat:[],redialof:!1,redialhideevt:!1,lastcallcdr:"",reqid:0,sendwsuserjsonp:!1,callhistoryfilter:-1,webrtcpermissionaccepted:!1,isconfcall:!1,sessionid:-1,dispregfailed:0,onunregistered_flag:!1,onunload_flag:!1,handlesett_finished:!1,dploadingdisplayed:!1,telsearchname:"",pres_set_at_start:!1,laststarttick:0,pres_unreg_called:!1,presenceinterval:72e4,msg_presence_timer:0,startendelayed_wascalled:!1,sipaccounts:[],waiting_conf_numbers:"",isconfroom_call:!1,checkpres_callback:[],active_incoming_call:!1,android_aletrnatebrowserurl_DEF:"https://play.google.com/store/apps/details?id=com.android.chrome",testmessagevalidity:3,last_event:"",wsl_uk_rec:!1,wsl_us_rec:!1,canfailover_gateway:!0,failover_gateway:!0,aua_handled:!1,stacknotstarted_time:0,stacknotstarted_retry:!1,dontshowdiscreason:!1,cansetuseengine:!1,lastconfroom:"",nostun:!1,noturn:!1,isvideocall:!1,lastpermreq:0,dontshow_closecall:!1,chrome_ss_plugin_url:"https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk",printwad_called:!1,custmenusL:[],bname_charcount:0,selected_apikey:"",dontclosecurrpopup:!1,last_presence_enabled:!1,currcallnumber:"",isfirstcall:!0,confanswer_received:!1,calltransf_completed:!1,flagclientreset:!1,phonestarttick:-1,httpheaderslogged:!1,onregisteredcalled:!1,flag_delsett:0,resetsett_handled:!1,apistartstate:0,apistarttick:0,wnotstartedsession:!1,flagnsreconnect:!1,colorizelog:0,webrtclastregsent:0,webrtcregtimer_exec:0,wsload_type:-1,webrtc_regstate:-1,addauser_header:!1,fcmstate:-1,fcmtoken:"",fcmIsEnabled:-1,decideusuk_finished:!1,wsc_contimeout:0,wsc_reqtimeout:0,add_recall_header:!1,domloaded_tick:0,last_ns_ws_succwss:0,callPageStatusCachePerLine:{},autoacceptsipheader:"",localforage_last_cb:null,last_wsu_tick:0,pingpong:0,ever_received_pong:!1,sipunicoderewritefrom:"",sipunicoderewriteto:"",firstregister_sessiontick:0,bothpartyhold:!1,
firefoxholdcount:0,isholdresume:!1,isresume:!1,holdresumecount:0,win_nsplugin_filename:"WebPhoneService_Install.exe",mac_nsplugin_filename:"webphone_ns_mac.zip",lin32_nsplugin_filename:"webphone_ns_lin32.zip",lin32arm_nsplugin_filename:"webphone_ns_lin32arm.zip",lin64_nsplugin_filename:"webphone_ns_lin64.zip",lin64arm_nsplugin_filename:"webphone_ns_lin64arm.zip",enstarteddisplayed:!1,usemutemutiline:!1,nuiswebpage:null,minimumservicebuild:0,last_good_status:"",display_last_status:!1,minten:!1,mto:"",last_transfer_tick:0,dontSendSignaling:!1,dontSendSignalingTimer:0,isappenginestarted:!1,smsCodeUser:""},common=function(){function ClassSipAccounts(){this.serveraddress,this.username,this.password,this.ival,this.enabled,this.ismain,this.callerid,this.displayname,this.proxyaddress,this.realm}function ReceiveNotifications(e){try{if(isNull(e)&&(e=""),e=Trim(e),0===e.length||e.indexOf(notsep)===e.lastIndexOf(notsep)&&e.indexOf(notsep2)===e.lastIndexOf(notsep2))CleanNotifications(e);else if(e.indexOf(notsep)!==e.lastIndexOf(notsep)){var t=e.split(notsep);if(!isNull(t)&&t.length>0)for(var o=0;o<t.length;o++)isNull(t[o])||CleanNotifications(t[o])}else if(e.indexOf(notsep2)!==e.lastIndexOf(notsep2)){var t=e.split(notsep2);if(!isNull(t)&&t.length>0)for(var o=0;o<t.length;o++)isNull(t[o])||CleanNotifications(t[o])}else CleanNotifications(e)}catch(n){PutToDebugLogException(2,"common: ReceiveNotifications",n)}}function CleanNotifications(e){try{isNull(e)&&(e=""),e=e.replace("WPNOTIFICATION,",""),!1===global.iscurrengineworking&&(getuseengine()===global.ENGINE_SERVICE?(e.indexOf("STATUS")>=0&&e.indexOf("STOP")<0||e.indexOf("START")>=0)&&(global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")):(global.iscurrengineworking=!0,SaveParameter("lastsessionsuccess","2")));var t=e.indexOf(notsep);if(t>0&&(e=e.substring(0,t)),t=e.indexOf(notsep2),t>0&&(e=e.substring(0,t)),e=e.replace("EOFLINE",""),e=Trim(e),e.indexOf("DISPLAY")>0)return e=Trim(e.replace("DISPLAY","")),PutToDebugLog(1,e),void ShowToast(e);0===e.indexOf("LOG")?PutToDebugLog(3,e):!0===IsWindowsSoftphone()||getuseengine()===global.ENGINE_WEBPHONE||getuseengine()===global.ENGINE_SERVICE?PutToDebugLog(1,e,"NOTIFICATION,"):PutToDebugLog(1,e)}catch(o){PutToDebugLogException(2,"common: CleanNotifications",o)}}function GetLogTimeStamp(){var e=new Date,t=e.getHours(),o=e.getMinutes(),n=e.getSeconds(),i=e.getMilliseconds();return t<10&&(t="0"+t),o<10&&(o="0"+o),n<10&&(n="0"+n),i<10?i="00"+i:i<100&&(i="0"+i),"["+t+":"+o+":"+n+"."+i+"] "}function PutToDebugLog(e,t,o){logcount++,checkloglvl++;try{if(checkloglvl>2&&(checkloglvl=0,global.loglevel=GetLogLevel()),isNull(me1)){var n=[];n.push("t"),n.push("r"),n.push("i"),n.push("a"),n.push("l "),n.push("e"),n.push("x"),n.push("p"),n.push("i"),n.push("r"),n.push("e"),n.push("d"),me1=n.join(""),n=[],n.push("t"),n.push("r"),n.push("i"),n.push("a"),n.push("l "),n.push("session "),n.push("time"),n.push("out"),me2=n.join(""),n=[],n.push("l"),n.push("i"),n.push("c"),n.push("e"),n.push("n"),n.push("s"),n.push("e"),n.push(" "),n.push("e"),n.push("r"),n.push("r"),n.push("o"),n.push("r"),me3=n.join(""),n=[],n.push("t"),n.push("r"),n.push("i"),n.push("a"),n.push("l "),n.push("v"),n.push("e"),n.push("r"),n.push("s"),n.push("i"),n.push("o"),n.push("n"),n.push(" "),n.push("n"),n.push("e"),n.push("e"),n.push("d"),n.push(" "),n.push("r"),n.push("e"),n.push("s"),n.push("t"),n.push("a"),n.push("r"),n.push("t"),me4=n.join(""),n=[],n.push("s"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push(" "),n.push("i"),n.push("s"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("e"),n.push("n"),n.push("a"),n.push("b"),n.push("l"),n.push("e"),n.push("d"),me5=n.join("")}if(logfirstrun||logcount>160){logcount=0;var i=logfirstrun;logfirstrun=!1,global.loglevel=GetLogLevel();return LogWebphoneInfo("\r\n",e,t),void(!0===i&&LogConfig())}var n="",r=0;if(isNull(t)||isNull(e))return;if(IsNumber(e))r=e,n=t;else{if(!IsNumber(t))return;r=t,n=e}if(n.indexOf("Stack not started")>=0&&(global.stacknotstarted_time=GetTickCount()),n.indexOf("=wsuser")>0&&n.indexOf("authpwd=")>0){var a=n.substring(0,n.indexOf("authpwd="));n=n.substring(n.indexOf("authpwd=")),n=n.indexOf("&")>0?n.substring(n.indexOf("&")+1):"",n=a+n}if(lastlogmsg===n)return;if(lastlogmsg=n,(global.useengine===global.ENGINE_WEBPHONE||global.useengine===global.ENGINE_SERVICE)&&((n.indexOf(me1)>=0||n.indexOf(me2)>=0||n.indexOf(me3)>=0||n.indexOf(me4)>=0)&&(lmsg=n,lm=!0),(n.indexOf(me1)>=0||n.indexOf(me3)>=0||n.indexOf(me5)>=0)&&getuseengine()===global.ENGINE_SERVICE&&!1===srvinst_offered)){if(0===GetParameterInt("nsupdate",-1))return PutToDebugLog(1,"ERROR, NS update failed second time, prompt user to send logs"),void(!0===IsSDK()?AlertDialog("ERROR","Please contact support and send logs from browser console"):AlertDialog("ERROR","Please contact support and send logs from Menu -> Help -> Logs"));if(srvinst_offered=!0,setTimeout(function(){srvinst_offered=!1},18e4),!1===Te()){var s=n;WinAPI("extcmd_version",function(e){try{if(isNull(e)||e.indexOf("ERROR:")>=0)return;var t=-1,o=e.toString(),n=o.indexOf("version:");n>0&&(o=o.substring(n+8)),n=o.indexOf("eov"),n>0&&(o=o.substring(0,n)),o=Trim(o),!isNull(o)&&IsNumber(o)&&(t=StrToInt(o)),t>0&&(SaveParameter("srvupgrade_currversion",t),global.maximumserviceversion>0&&t>=global.maximumserviceversion?AlertDialog("ERROR",s):setTimeout(function(){SaveParameter("nsupdate","0");try{console&&console.log&&console.log(2,"EVENT, common: PutToDebugLog, service upgrade needed: "+GetMinServiceVersion().toString())}catch(e){}EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0},1))}catch(i){console.log("ERROR, catch on PutToDebugLog: extcmd_version"+i)}})}}!0===lm&&n.toLowerCase().indexOf("engine")<0&&(n=lmsg,r=1);try{webphone_api.onEventCb("log",n,null)}catch(d){}try{webphone_api.onLogCb(n)}catch(d){}sendlogstoandroid<0&&(sendlogstoandroid=IsCExt());try{sendlogstoandroid>0&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&null!==AndroidWebphoneJsInterface.jstoandroidPutToDebugLog&&AndroidWebphoneJsInterface.jstoandroidPutToDebugLog(r.toString(),n)}catch(d){}if(global.useengine===global.ENGINE_WEBRTC&&n.toLowerCase().indexOf("failed to find transport")>=0&&(isNull(console)||isNull(console.log)||console.log("detected in Log: failed to find transport"),webphone_api.flagrestartwebrtc=!0,webrtcapi_public.ReStart(0,!0)),n.indexOf("STOP")>0&&(r=2),!0===global.redialhideevt&&console&&console.log&&console.log("webphone: event dropped_1 redialonfail: "+n),1===r&&n.indexOf("param platform")<0&&!1===global.redialhideevt&&("undefined"!=typeof notifications_public&&null!==notifications_public?notifications_public.ProcessNotifications(n):console&&console.log&&console.log("ERROR, common PutToDebugLog notifications_public is not defined")),r>global.loglevel)return;void 0!==o&&null!==o&&(n=o+n),n=ReplaceAll(n,"EOFLINE","\r\n");var l=GetLogTimeStamp();if(global.logs=global.logs+l+n+"&#10;",global.logs.length>6e5){var c=global.logs.substring(0,1e4);global.logs=c+global.logs.substring(3e5)}try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(d){}if(l="webphone: "+l,global.deviceType>0||navigator.userAgent.toLowerCase().indexOf("firefox")>-1||navigator.userAgent.toLowerCase().indexOf("chrome")>-1)if(n.indexOf("ERROR")>-1&&global.colorizelog>0)try{console.error(l+n+" ")}catch(p){}else if(n.length>1e3)for(var u=0;n.length>0&&!(++u>15);){var m=n.length;m>1e3&&(m=1e3);var g=n.substring(0,m);n=n.substring(m),u>1&&(l="\t"+l);try{g=ReplaceAll(g,"\r\n","\r\n\t")}catch(h){}try{console.log(l+g+" ")}catch(f){}}else if(n.length>140&&n.length<400&&(n.indexOf("http:")>=0||n.indexOf("https:")>=0))for(var u=0;n.length>0&&!(++u>5);){var m=n.length;m>140&&(m=140);var g=n.substring(0,m);n=n.substring(m),u>1&&(l="\t"+l);try{g=ReplaceAll(g,"\r\n","\r\n\t")}catch(h){}try{console.log(l+g+" ")}catch(f){}}else try{console.log(l+n+" ")}catch(f){}else if(n.length>1e3)for(var u=0;n.length>0&&!(++u>15);){var m=n.length;m>1e3&&(m=1e3);var g=n.substring(0,m);n=n.substring(m),u>1&&(l="\t"+l);try{g=ReplaceAll(g,"\r\n","\r\n\t")}catch(b){}try{isNull(console)||isNull(console.log)||console.log(l+g+" ")}catch(v){}}else if(n.length>140&&n.length<400&&(n.indexOf("http:")>=0||n.indexOf("https:")>=0))for(var u=0;n.length>0&&!(++u>5);){var m=n.length;m>140&&(m=140);var g=n.substring(0,m);n=n.substring(m),u>1&&(l="\t"+l);try{g=ReplaceAll(g,"\r\n","\r\n\t")}catch(b){}try{isNull(console)||isNull(console.log)||console.log(l+g+" ")}catch(v){}}else try{isNull(console)||isNull(console.log)||console.log(l+n+" ")}catch(v){}}catch(d){alert(d)}}function PutToDebugLogSpecial(e,t,o,n){function i(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){alert("ERROR, common: IsNumberInner"+t)}return!1}try{if(splevel<1){splevel=global.loglevel;var r=StrToInt(GetParameter("loglevel"));!isNull(r)&&i(r)&&r>splevel&&r<1e3&&(splevel=r),r=webphone_api.parameters.loglevel,!isNull(r)&&i(r)&&r>splevel&&r<1e3&&(splevel=r)}if(splevel<0&&(splevel=2),!isNull(e)&&i(e)&&e>splevel)return;if(void 0===t||null===t)return;o=void 0!==o&&null!==o&&!1!==o,void 0!==n&&null!==n||(n="");var a=GetLogTimeStamp();global.logs=global.logs+a+t+" "+n+"&#10;";try{if("false"==webphone_api.parameters.logtoconsole||0==webphone_api.parameters.logtoconsole)return}catch(s){}if(t="webphone: "+a+t+" "+n,!0===o&&global.colorizelog>0)try{console.error(t)}catch(l){}else try{console.log(t)}catch(l){}}catch(s){alert("PutToDebugLogSpecial"+s)}}function LogConfig(){function e(e){try{return void 0===e||null===e?"":(e=e.toLowerCase(),"undefined"==typeof t[e]||null===t[e]?"":t[e])}catch(o){}return""}try{PutToDebugLog(5,"built in Config parameters: ");var t=mwphonecfg.getAll(),o=e("loglevel");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_loglevel: "+o);var o=e("autotransportdetect");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_autotransportdetect: "+o);var o=e("cfgusetunneling");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_cfgusetunneling: "+o);var o=e("useencryption");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_useencryption: "+e("useencryption"));var o=e("upperserverfromuser");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_upperserverfromuser: "+o);var o=e("allowsimpleudpencrypt");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_allowsimpleudpencrypt: "+o);var o=e("cantryudpdirectep");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_cantryudpdirectep: "+o);var o=e("featureset");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_featureset: "+e("featureset"));var o=e("brandid");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_brandid: "+e("brandid"));var o=e("enabledirectcalls");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_enabledirectcalls: "+e("enabledirectcalls"));var o=e("enabledirectcallstolan");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_enabledirectcallstolan: "+e("enabledirectcallstolan"));var o=e("colortheme");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_colortheme: "+e("colortheme"));var o=e("actionbarhideicon");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_actionbarhideicon: "+e("actionbarhideicon"));var o=e("usemizuwebrtcgateway");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_usemizuwebrtcgateway: "+e("usemizuwebrtcgateway"));var o=e("deploydate");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_deploydate: "+e("deploydate"));var o=e("useg729");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_useg729: "+e("useg729"));var o=e("hidedomaininput");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_hidedomaininput: "+e("hidedomaininput"));var o=e("usestun");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_usestun: "+e("usestun"));var o=e("serveraddress");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_serveraddress: "+e("serveraddress"));var o=e("userport");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_userport: "+e("userport"));var o=e("voicemail");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_voicemail: "+e("voicemail"));var o=e("needapikey");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_needapikey: "+e("needapikey"));var o=e("firstdeploydate");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_firstdeploydate: "+e("firstdeploydate"));var o=e("lastdeploydate");!isNull(o)&&o.length>0&&PutToDebugLog(5,"cfg_lastdeploydate: "+e("lastdeploydate")),PutToDebugLog(5,"built in Config parameters: END")}catch(n){alert("LogConfig: "+n)}}function LogWebphoneInfo(e,t,o){try{var n=GetWebphoneInfo(e);if(!isNull(n)&&n.length>0&&(PutToDebugLog(3,n),PutToDebugLog(3,"Location: "+window.location.href+e)),isNull(t)||isNull(o)||PutToDebugLog(t,o),global.loglevel<2&&"undefined"!=typeof console&&null!==console&&"undefined"!=typeof console.log&&null!==console.log&&!1===basicinfologged)return"false"!=webphone_api.parameters.logtoconsole&&0!=webphone_api.parameters.logtoconsole&&(console.log(n),console.log("Location: "+window.location.href+e)),void(basicinfologged=!0);if(!isNull(webphone_api.parameters)){PutToDebugLog(5,"webphone_api.parameters: ");for(var i in webphone_api.parameters)if(!isNull(i)){var r=webphone_api.parameters[i];(!IsNumber(r)||i.indexOf("username")||i.indexOf("sipusername")>=0)&&(r="'"+r+"'"),PutToDebugLog(5,i+": "+r+",")}PutToDebugLog(5,"webphone_api.parameters: END")}}catch(a){alert("LogWebphoneInfo: "+a)}}function GetWebphoneInfo(e,t){var o="";try{isNull(e)&&(e=""),o="About:",o+=e,o=o+"Brand: "+GetBrandName()+" Version: "+GetVersionStr()+" ("+global.code_version+")",!isNull(t)&&t.length>0&&(o=o+"Problem description: "+t+e);var n=platform.name,i=platform.version;(isNull(n)||"Android"===GetOs())&&(n=GetBrowser()),isNull(i)&&(i=GetBrowserVersion());var r="",a=new Date;if(!isNull(a)){var s=a.getMonth()+1;r=a.getFullYear()+"/"+s+"/"+a.getDate()}var l=IsWebphoneInIframe(),c="; isiframe: "+l.toString();!0===l&&(c=e+c+"; iframeParentLocation: "+GetParentIframeUrl());var u=platform.os;(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(u="iOS"),o=o+"; Build date: "+GetConfig("lastdeploydate"),o=o+"; OS: "+u+"; voipen: "+getuseengine()+"; date: "+r+c+e,o=o+"Browser: "+n+" "+i,o=o+"; Bengine: "+platform.layout,o=o+"; GetBrowser: "+GetBrowser()+"; Bver: "+GetBrowserVersion()+"; GetOs: "+GetOs();var m="";if(global.phonestarttick>0){var g=Math.floor((GetTickCount()-global.phonestarttick)/1e3),d=Math.floor(g/60);g%=60,g<10&&(g="0"+g),m=d+":"+g}o=o+"; Uptime: "+m;var p=GetLogLevel();void 0!==p&&null!==p||(p=""),p=p.toString(),o=o+"; loglevel: "+p;var h=!1;!0===IsSDK()&&(h=!0);try{o=o+"; Used as SDK: "+h.toString()}catch(f){}return o}catch(b){alert("GetWebphoneInfo: "+b)}return""}function xml_to_string(e){try{if(e.xml)return e.xml;if(XMLSerializer){return(new XMLSerializer).serializeToString(e)}return""}catch(t){PutToDebugLogException(2,"common: xml_to_string",t)}}function PutToDebugLogException(e,t,o){try{var n="";if(isNull(t)||isNull(e))return;void 0===o||null===o?PutToDebugLog(e,"ERROR, catch on "+t+" unknown exception"):("undefined"!=typeof o.message&&null!==o.message&&o.message.length>0&&(n=n+" ("+o.message+") "),"undefined"!=typeof o.fileName&&null!==o.fileName&&o.fileName.length>0&&(n=n+" class: "+o.fileName),"undefined"!=typeof o.lineNumber&&null!==o.lineNumber&&o.fileName.lineNumber>0&&(n=n+": "+o.lineNumber),PutToDebugLog(e,"ERROR, catch on "+t+" "+o+n)),(!0===global.usestorage||Strl(90))&&t.indexOf("There is an error in")>=0&&ShowToast("ERROR, "+t+o+n,8e3)}catch(i){}}function PutToDebugLogWarning(e,t,o){try{var n="";if(isNull(t)||isNull(e))return;void 0===o||null===o?PutToDebugLog(e,"WARNING, catch on "+t+" unknown exception"):("undefined"!=typeof o.message&&null!==o.message&&o.message.length>0&&(n=n+" ("+o.message+") "),"undefined"!=typeof o.fileName&&null!==o.fileName&&o.fileName.length>0&&(n=n+" class: "+o.fileName),"undefined"!=typeof o.lineNumber&&null!==o.lineNumber&&o.fileName.lineNumber>0&&(n=n+": "+o.lineNumber),PutToDebugLog(e,"WARNING, catch on "+t+" "+o+n))}catch(i){}}function ReplaceAll(e,t,o){try{return isNull(e)||isNull(t)||isNull(o)?(PutToDebugLogSpecial(2,"ERROR, common ReplaceAll null value",!0,""),""):(e=e.toString(),e.split(t).join(o))}catch(n){PutToDebugLogSpecial(2,"ERROR, ReplaceAll: ",!0,n)}return""}function Trim(e){try{return isNull(e)||e.lenght<1?"":(e=e.toString(),e.replace(/^\s+|\s+$/g,""))}catch(t){PutToDebugLogSpecial(2,"ERROR, common: Trim",!0,t)}return e}function EscapeRegExp(e){try{return isNull(e)||e.lenght<1?(PutToDebugLog(3,"ERROR, common EscapeRegExp null value"),""):e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}catch(t){PutToDebugLogException(2,"common: EscapeRegExp",t)}return""}function IsNumber(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){PutToDebugLogSpecial(2,"ERROR, common: IsNumber",!0,t)}return!1}function IsNumeric(e,t){try{if(void 0===e||null==e)return!1;e=e.toString(),e=e.replace(/\s+/g,"");var o=e.split("");if(isNull(o)||o.length<1)return!1;var n=[];if(void 0!==t&&null!==t&&t.length>0){n=t.split(","),void 0!==n&&null!==n||(n=[]);for(var i=0;i<n.length;)"undefined"==typeof n[i]||null===n[i]||1!==n[i].length?n.splice(i,1):i++}if(void 0!==n&&null!==n||(n=[]),n.length>0){for(var r=0;r<o.length;r++)if((o[r]<"0"||o[r]>"9")&&n.indexOf(o[r])<0)return!1}else for(var r=0;r<o.length;r++)if(o[r]<"0"||o[r]>"9")return!1;return!0}catch(a){PutToDebugLogSpecial(2,"ERROR, common: IsNumeric",!0,a)}return!1}function StrToInt(e){try{return isNull(e)||!IsNumber(e)?null:(e=ReplaceAll(e," ",""),parseInt(e,10))}catch(t){PutToDebugLogException(2,"common: StrToInt",t)}return null}function StrToIntDef(e,t){try{return isNull(e)||!IsNumber(e)?t:(e=ReplaceAll(e," ",""),parseInt(e,10))}catch(o){PutToDebugLogException(2,"common: StrToIntDef",o)}return t}function StrToIntPx(e){try{return isNull(e)?0:(e=ReplaceAll(e," ",""),parseInt(e,10))}catch(t){PutToDebugLogException(2,"common: StrToIntPx",t)}return 0}function StrIsUpperCase(e){try{if(isNull(e))return!1;for(var t=!0,o=0,n=0;n<e.length;n++)if(o=e.charCodeAt(n),!(isNull(o)||o<65||o>90&&o<97||o>122)){var i=e.charAt(n);if(i===i.toLowerCase()){t=!1;break}}return t}catch(r){PutToDebugLogException(2,"common: StrIsUpperCase",r)}return!1}function GetDeviceWidth(){try{return Math.floor(j$("#phone_app_main_container").width())}catch(e){PutToDebugLogException(2,"common: GetDeviceWidth",e)}}function GetDeviceHeight(){try{return Math.floor(j$("#phone_app_main_container").height())}catch(e){PutToDebugLogException(2,"common: GetDeviceHeight",e)}}function IsWindowsSoftphone(){try{if(!0===isPlatformSet)return isWindows;var e=window.location.href;if(isNull(e)||e.length<1)return isPlatformSet=!0,isWindows;if(e=Trim(e),e.indexOf("platform")>0&&e.indexOf("windesktop")>0)return isPlatformSet=!0,isWindows=!0}catch(t){PutToDebugLogException(2,"common: IsWindowsSoftphone",t)}return isWindows}function DeviceType(){return global.deviceType}function DEVICE_WEBPHONE(){return CONST_DEVICE_WEBPHONE}function DEVICE_WIN_SOFTPHONE(){return CONST_DEVICE_WIN_SOFTPHONE}function DEVICE_ANDROID(){return CONST_DEVICE_ANDROID}function DEVICE_IPHONE(){return CONST_DEVICE_IPHONE}function DEVICE_BB(){return CONST_DEVICE_BB}function DEVICE_WP(){return CONST_DEVICE_WP}function isNull(e){try{return void 0===e||null===e}catch(t){PutToDebugLogSpecial(2,"ERROR,common: isNull",!0,t)}return!0}function IsFunction(e){try{if("function"===Object.prototype.toString.call(e).slice(8,-1).toLowerCase())return!0}catch(t){PutToDebugLogSpecial(2,"ERROR,common: IsFunction",!0,t)}return!1}function getBgColor(e){try{var t="#000000";if(j$(e).length>0){var o=j$(e).css("background-color"),n=o.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);!isNull(n)&&n.length>0&&delete n[0];for(var i=1;i<=3;++i)n[i]=parseInt(n[i]).toString(16),1==n[i].length&&(n[i]="0"+n[i]);t="#"+n.join("")}return t}catch(r){PutToDebugLogException(2,"common: getBgColor",r)}return"#000000"}function getElementColor(e){try{var t="#000000";if(j$(e).length>0){var o=j$(e).css("color"),n=o.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete n[0];for(var i=1;i<=3;++i)n[i]=parseInt(n[i]).toString(16),1==n[i].length&&(n[i]="0"+n[i]);t="#"+n.join("")}return t}catch(r){PutToDebugLogException(2,"common: getElementColor",r)}return"#000000"}function AlertDialog(e,t,o,n){try{if(isNull(t)&&(t=""),isNull(e)&&(e=""),t=t.replace("[BRAND]",GetBrandName()),!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(t,e)}catch(r){PutToDebugLogException(2,"There is an error in ondisplay() callback 1",r)}try{webphone_api.onEventCb("display",e+","+t,e)}catch(r){PutToDebugLogException(2,"There is an error in onEvent() callback 5",r)}if(!1===GetParameterBool("showtoasts",!0))return void o();var i=t;i===stringres.get("app_en_warning")&&(i=stringres.get("app_en_warning_short")),PutToDebugLog(1,"EVENT,"+i),!0===IsSDK()?setTimeout(function(){try{AlertDialogSDK(e,t,o)}catch(r){PutToDebugLogException(2,"common: AlertDialog - SDK",r)}},100):setTimeout(function(){try{AlertDialogDelayed(e,t,o,n)}catch(r){PutToDebugLogException(2,"common: AlertDialog - Delayed",r)}},100)}catch(r){PutToDebugLogException(2,"common: AlertDialog",r)}}function AlertDialogDelayed(e,t,o,n){try{o=o||function(){};var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220,isNull(n)&&(n=stringres.get("btn_close"));var r='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+e+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span style="-ms-user-select: text; -moz-user-select: text; -khtml-user-select: text; -webkit-user-select: text;  user-select: text;"> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_alert_ok" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+n+"</a></div></div>";j$.mobile.activePage.append(r).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e+100&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_adialog_alert_ok").off("click"),o(!1)}}),j$("#btn_adialog_alert_ok").on("click",function(){o&&"function"==typeof o&&(o(!0),o=function(){})})}catch(a){PutToDebugLogException(2,"common: AlertDialog",a)}}function ShowToast(e,t,o){try{(isNull(t)||!IsNumber(t)&&e.length>75)&&(t=e.length-75,t=3e3+t),setTimeout(function(){ShowToastDelayed(e,t,o)},100)}catch(n){PutToDebugLogSpecial(2,"common: ShowToastF",!0,n)}}function ShowToastDelayed(e,t,o){try{if(o=o||function(){},!isNull(webphone_api.displaycb)||"function"==typeof webphone_api.displaycb)try{webphone_api.onDisplayCb(e,"")}catch(r){PutToDebugLogException(2,"There is an error in ondisplay() callback 2",r)}try{webphone_api.onEventCb("display",","+e,null)}catch(r){PutToDebugLogException(2,"There is an error in onEvent() callback 6",r)}if(!1===GetParameterBool("showtoasts",!0))return void o();if(!0===IsSDK())return void ShowToastSDK(e,t);if(!isNull(e)&&!0===global.isSettingsStarted&&e.toLowerCase().indexOf("register")>=0&&e.toLowerCase().indexOf("failed")>0)return;var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220;var i='<div data-role="popup" style="padding: .5em;" class="ui-content toastPopup" data-overlay-theme="b" data-transition="fade" data-theme="a" style="max-width:'+n+'px"><span> '+e+" </span></div>";j$.mobile.activePage.append(i).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".toastPopup").popup("close")}),j$.mobile.activePage.find(".toastPopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),o()}}),isNull(t)&&(t=3e3),t>0&&setTimeout(function(){j$.mobile.activePage.find(".toastPopup").popup("close")},t)}catch(r){PutToDebugLogSpecial(2,"common: ShowToast",!0,r)}}function UsePresence2(){try{if(!1===Glpr())return!1;var e=0,t=GetParameterInt("enablepresence",0),o=GetParameterInt("enablepresence2",0);if(IsNumber(t)&&StrToInt(t)>0&&(e=StrToInt(t)),IsNumber(o)&&StrToInt(o)>0&&(e=StrToInt(o)),isNull(enablepres_httpapi)&&(enablepres_httpapi=GetParameterInt("enablepres_httpapi",1),enablepres_javaapi=GetParameterInt("enablepres_javaapi",1),enablepres_webrtc=GetParameterInt("enablepres_webrtc",1)),e<1)return!1;if(e>1)return!0;if(1===e){if(!1===global.usestorage&&!1===Strl(90))return!1;if(enablepres_httpapi<1&&enablepres_javaapi<1&&enablepres_webrtc<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_1"),errmsgdisp=!0),!1;if(getuseengine()===global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_2"),errmsgdisp=!0),!1;if((!0===IsWindowsSoftphone()||getuseengine()===global.ENGINE_WEBPHONE||getuseengine()===global.ENGINE_SERVICE)&&enablepres_javaapi<1&&enablepres_httpapi<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_3"),errmsgdisp=!0),!1;if(getuseengine()===global.ENGINE_WEBRTC&&enablepres_webrtc<1&&enablepres_httpapi>0){if(GetHttpAPIKey().length<1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_4"),errmsgdisp=!0),!1}else if(enablepres_httpapi>0&&enablepres_javaapi<1&&enablepres_webrtc<1){if(!1===GetConfigBool("usingmizuserver",!1)&&GetConfigInt("cfgusetunneling",0)<1&&!1===GetConfigBool("useencryption",!1)&&!1===IsMizuWebRTCGateway())return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_5"),errmsgdisp=!0),!1}else{if(getuseengine()===global.ENGINE_WEBRTC&&global.recwsload>1)return!1===errmsgdisp&&(PutToDebugLog(2,"ERROR, common Presence disabled_6 high webrtc load"),errmsgdisp=!0),!1;if(!0===IsSDK()&&(!0===IsMizuWebRTCGateway()||!0===IsMizuWebRTCEmbeddedServer()||!0===IsMizuServer()))return!1}return!0}}catch(n){PutToDebugLogException(2,"common: UsePresence2",n)}return!1}function GetPresenceServer2(){try{if(!UsePresence2())return"";var e=-1,t=GetParameter("mainaport"),o=GetParameter("mainaporttls"),n="";if(!0===IsMizuWebRTCEmbeddedServer()){var i=GetWebrtcSrvAddr();!isNull(i)&&i.length>0&&(i=NormalizeInput(i,0),e=i.indexOf("/"),e>0&&(i=i.substring(0,e)),e=i.indexOf(":"),e>0&&(i=i.substring(e+1)),!isNull(i)&&IsNumber(i)&&(n=i))}if(!0===GetConfigBool("usingmizuserver",!1)){var r=GetParameter2("serveraddress_user");return(isNull(r)||r.length<2)&&(r=GetParameter2("serveraddress")),(IsIPAddrress(r)||!1===IsHttps())&&t.length>0?(e=r.indexOf(":"),e>0&&(r=r.substring(0,e)),r="http://"+r+":"+t):((isNull(n)||n.length<1)&&(n=o),!isNull(n)&&n.length>0&&(e=r.indexOf(":"),e>0&&(r=r.substring(0,e)),r="https://"+r+":"+n)),r}if(GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1)){var r=GetParameter2("tunnelserveraddress");return(IsIPAddrress(r)||!1===IsHttps())&&t.length>0?(e=r.indexOf(":"),e>0&&(r=r.substring(0,e)),r="http://"+r+":"+t):((isNull(n)||n.length<1)&&(n=o),!isNull(n)&&n.length>0&&(e=r.indexOf(":"),e>0&&(r=r.substring(0,e)),r="https://"+r+":"+n)),r}if(getuseengine()!==global.ENGINE_WEBRTC&&getuseengine()!==global.ENGINE_FLASH&&(r=GetServerForHttpReq(),!isNull(r)&&r.length>0))return r;var a=0,s=GetParameterInt("enablepresence",0),l=GetParameterInt("enablepresence2",0);if(IsNumber(s)&&StrToInt(s)>0&&(a=StrToInt(s)),IsNumber(l)&&StrToInt(l)>0&&(a=StrToInt(l)),!0===IsMizuWebRTCGateway()||2===a){var c="";return c=!0===PreferWss()||!0===IsHttps()?StrDc(wips_uk,alsvkey):StrDc(wip_uk,alsvkey),c=NormalizeInput(c,0),e=c.indexOf("/"),e>0&&(c=c.substring(0,e)),c=Trim(c),c=!0===PreferWss()||!0===IsHttps()?"https://"+c:"http://"+c}}catch(u){PutToDebugLogException(2,"common: GetPresenceServer2",u)}return""}function PresenceVerifyuser2(e){try{if(isNull(e)||e.length<1)return;var t="http://";IsHttps()&&(t="https://");var o=GetPresenceServer2();if(o.indexOf("://")>0&&(t=""),isNull(o)||o.length<2)return void PutToDebugLog(3,"ERROR, PresenceVerifyuser2 invalid server");var n=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(n="1568108399");UriParser(t+o+"/?apientry=verifyuser&authkey="+n+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&userlist="+e,"","","","","presence_verify")}catch(i){PutToDebugLogException(2,"common: PresenceVerifyuser2",i)}}function PresenceGet2(e){try{if(isNull(e)||e.length<1)return;if(e=e.replace(" ",""),isNull(pgstart_timer)||clearTimeout(pgstart_timer),pgstart_timer=null,(getuseengine().length<1||global.phonestarted<3)&&pgmaxloop<120)return pgmaxloop++,void(pgstart_timer=setTimeout(function(){PresenceGet2(e)},1e3));pgmaxloop=0;var t="",o=GetHttpAPIKey();if(GetPresenceServer2().indexOf("rtc.mizu-voip.com:2443")>=0&&(o="1568108399"),!0===GetConfigBool("usingmizuserver",!1)||GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1)||IsMizuWebRTCGateway()){var n="http://";IsHttps()&&(n="https://");var i=GetPresenceServer2();if(i.indexOf("://")>0&&(n=""),!isNull(i)&&i.length>2){var r="1";!0===first_presence_req&&(r="0",first_presence_req=!1);var a="";GetParameter("upperserver").length>0&&(a=GetParameter("upperserver")),t=n+i+"/mvapireq/?apientry=presence_get&authkey="+o+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&ptype="+r+"&domain="+a+"&userlist="+e}}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&t.length>0&&UriParser(t,"","","","","presence_get"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===global.ENGINE_WEBRTC&&webrtcapi_public.PresenceGet(e),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===global.ENGINE_SERVICE?WinAPI("API_CheckPresence",null,e):getuseengine()===global.ENGINE_WEBPHONE&&webphone_public.CheckPresence(e))}catch(s){PutToDebugLogException(2,"common: PresenceGet2",s)}}function PresenceSet2(){try{var e="",t=GetParameter("presencestatus");if(!0===GetConfigBool("usingmizuserver",!1)||GetConfigInt("cfgusetunneling",0)>0&&!0===GetConfigBool("useencryption",!1)){var o="http://";IsHttps()&&(o="https://");var n=GetPresenceServer2();n.indexOf("://")>0&&(o="");var i=GetHttpAPIKey();GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(i="1568108399"),!isNull(n)&&n.length>2&&(e=o+n+"/mvapireq/?apientry=presence_set&authkey="+i+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&pstatus="+t)}!isNull(enablepres_httpapi)&&enablepres_httpapi>0&&e.length>0&&UriParser(e,"","","","","presence_set"),!isNull(enablepres_webrtc)&&enablepres_webrtc>0&&getuseengine()===global.ENGINE_WEBRTC&&webrtcapi_public.PresenceSet(t),!isNull(enablepres_javaapi)&&enablepres_javaapi>0&&(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===global.ENGINE_SERVICE?WinAPI("API_SetPresenceStatus",null,t):getuseengine()===global.ENGINE_WEBPHONE&&webphone_public.SetPresenceStatus(t))}catch(r){PutToDebugLogException(2,"common: PresenceSet2",r)}}function SaveReceivedPresence2(e,t){try{if(isNull(e)||e.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 number is NULL: "+e);if(isNull(t)||t.length<1)return void PutToDebugLog(3,"ERROR, SaveReceivedPresence2 status is NULL: "+t);e=Trim(e),e=e.toLowerCase(),t=Trim(t),t=t.toLowerCase(),"notexists"===t&&(t="not exists");var o=!1,n="-1"
;if("open"===t||"online"===t||"reachable"===t||"available"===t||"call me"===t||"registered"===t)n="5",common.UpdateContactLastActive(e),o=!0;else if("dnd"===t||"busy"===t||"speaking"===t)n="4",o=!0;else if("pending"===t||"forwarding"===t)n="3",o=!0;else if("away"===t||"idle"===t)n="2",o=!0;else if("invisible"===t)n="1",o=!0;else if("closed"===t||"close"===t||"unreachable"===t||"offline"===t||"unregistered"===t)n="0",o=!0;else{if("unknown"!==t&&"not set"!==t&&"not exists"!==t)return"-2";n="-1",o=!0}var i=GetTickCount().toString();if(global.presenceHM[e]=[],global.presenceHM[e][PRES_STATUS]=n,global.presenceHM[e][PRES_TIME]=i,!1===o&&PutToDebugLog(3,"ERROR, SaveReceivedPresence2 invalid status: "+t),!isNull(global.checkpres_callback)&&global.checkpres_callback.length>0){var r=global.checkpres_callback.pop();r&&"function"==typeof r&&r(e,t)}return n}catch(a){PutToDebugLogException(2,"common: SaveReceivedPresence2",a)}return"-1"}function StartPresence2(){try{if(!UsePresence2())return;if(!0===global.presence_started)return;if(isNull(startpres_timer)||clearTimeout(startpres_timer),startpres_timer=null,(getuseengine().length<1||global.phonestarted<3)&&spmaxloop<120)return spmaxloop++,void(startpres_timer=setTimeout(function(){StartPresence2()},1e3));spmaxloop=0,global.presence_started=!0,PutToDebugLog(2,"EVENT, common StartPresence2");var e=GetParameterInt("verifyuser",0),t=GetAllContactsNumbersSipuris();isNull(t)&&(t=""),t.length>0&&(t=ReplaceAll(t," ",""),t=ReplaceAll(t,"-",""),t=ReplaceAll(t,"(",""),t=ReplaceAll(t,")","")),t.length>0&&(GetParameter("devicetype")!==DEVICE_WIN_SOFTPHONE()&&getuseengine()!==global.ENGINE_SERVICE||WinAPI("API_PushContactlist",null,t),getuseengine()===global.ENGINE_WEBPHONE&&webphone_public.PushContactlist(t)),global.isdebugversion||e<1||GetTickCount()-e>2592e6?(PutToDebugLog(2,"EVENT, common StartPresence2 verifyuser"),PresenceVerifyuser2(t),SaveParameter("verifyuser",GetTickCount())):PresenceGet2(GetParameter("srvcontacts"))}catch(o){PutToDebugLogException(2,"common: StartPresence2",o)}}function PresenceProcessUserlist2(e,t){try{if(isNull(e)||e.length<1)return;if(e=e.toString(),e.toLowerCase().indexOf("error")>=0||e.toLowerCase().indexOf("auserlist:")<0&&e.toLowerCase().indexOf("puserlist:")<0)return void PutToDebugLog(2,"ERROR, PresenceProcessUserlist2: "+e);var o=e;!isNull(o)&&o.length>500&&(o=o.substring(0,500)),PutToDebugLog(4,"EVENT, PresenceProcessUserlist2: "+o);var n=e.indexOf("auserlist:");n<1&&(n=e.indexOf("puserlist:")),n>0&&(e=Trim(e.substring(n+10,e.length)));var i=e.split(",");if(isNull(i)||i.length<1)return;var r=GetParameter("srvcontacts"),a=r.split(",");isNull(a)&&(a=[]);for(var s=0;s<i.length;s++){var l=i[s];if(!(isNull(l)||l.length<1||l.indexOf(":")<0)){var c=Trim(l.substring(0,l.indexOf(":"))),u=Trim(l.substring(l.indexOf(":")+1));u=u.toLowerCase();var m=SaveReceivedPresence2(c,u);dialpad_public.PopulateListRecents(),!0===global.isContactdetailsStarted&&contactdetails_public.PopulateData(),!0===global.isMessageStarted&&message_public.DisplayPresence(m);for(var g=!0,d=0;d<a.length;d++)if(!isNull(a[d])&&a[d]===c){g=!1;break}g&&a.push(c)}}var p="";if(!isNull(a)&&a.length>0)for(var s=0;s<a.length;s++)isNull(a[s])||Trim(a[s]).length<1||(p.length>0&&(p+=","),p+=a[s]);SaveParameter("srvcontacts",p),global.waitforpresence=0}catch(h){PutToDebugLogException(2,"common: PresenceProcessUserlist2",h)}}function PresenceSelector(e,t){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,PutToDebugLog(2,"EVENT, PresenceSelector called from: "+e);var n=GetParameter("presencestatus");(isNull(n)||n.length<1)&&(n="Online",SaveParameter("presencestatus",n));var i="",r="",a="",s="",l="";"Online"===n?i='checked="checked"':"Away"===n?r='checked="checked"':"DND"===n?a='checked="checked"':"Invisible"===n?s='checked="checked"':"Offline"===n&&(l='checked="checked"');var c='<form><fieldset data-role="controlgroup"><input name="presence_sel" id="radio_online" value="on" '+i+' type="radio"><label for="radio_online">'+stringres.get("presence_stat_online")+'</label><input name="presence_sel" id="radio_away" value="on" '+r+' type="radio"><label for="radio_away">'+stringres.get("presence_stat_away")+'</label><input name="presence_sel" id="radio_dnd" value="on" '+a+' type="radio"><label for="radio_dnd">'+stringres.get("presence_stat_dnd")+'</label><input name="presence_sel" id="radio_invisible" value="on" '+s+' type="radio"><label for="radio_invisible">'+stringres.get("presence_stat_invisible")+'</label><input name="presence_sel" id="radio_offline" value="on" '+l+' type="radio"><label for="radio_offline">'+stringres.get("presence_stat_offline")+"</label></fieldset></form>",u='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("presence_title")+'</h1></div><div role="main" class="ui-content">'+c+"</div></div>";t=t||function(){},j$.mobile.activePage.append(u).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),t()}}),j$(":radio").on("change",function(e){j$.mobile.activePage.find(".messagePopup").popup("close");var t=j$(this).attr("id");if(!(isNull(t)||t.length<1)){var o=t.indexOf("_");o>0&&o<t.length&&(t=t.substring(o+1)),PutToDebugLog(2,"EVENT, PresenceSelector USER selected: "+t),SetSelectedPresence(t)}})}catch(m){PutToDebugLogException(2,"common: PresenceSelector",m)}}function SetSelectedPresence(e,t){try{(isNull(e)||e.length<1)&&(e=GetParameter("presencestatus"),PutToDebugLog(2,"WARNING, SetSelectedPresence invalid status: "+e)),PutToDebugLog(3,"EVENT, SetSelectedPresence status: "+e+"; allow unregister: "+t),e=Trim(e.toLowerCase());var o='<img src="'+GetElementSource()+'images/presence_green.png" />';"offline"===e?(o='<img src="'+GetElementSource()+'images/presence_grey.png" />',SaveParameter("presencestatus","Offline"),!1!==t&&global.phonestarted>2&&(global.pres_unreg_called=!0,PutToDebugLog(2,"EVENT, mlogic API_Unregister SetSelectedPresence Offline"),webphone_api.unregister())):"invisible"===e?(o='<img src="'+GetElementSource()+'images/presence_white.png" />',SaveParameter("presencestatus","Invisible"),!0===global.pres_unreg_called&&global.phonestarted<3&&!0===NeedRegister()&&(global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence invisible"),webphone_api.register())):"away"===e?(o='<img src="'+GetElementSource()+'images/presence_yellow.png" />',SaveParameter("presencestatus","Away"),!0===global.pres_unreg_called&&global.phonestarted<3&&!0===NeedRegister()&&(global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence away"),webphone_api.register())):"dnd"===e?(o='<img src="'+GetElementSource()+'images/presence_red.png" />',SaveParameter("presencestatus","DND"),!0===global.pres_unreg_called&&global.phonestarted<3&&!0===NeedRegister()&&(global.pres_unreg_called=!1,PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence dnd"),webphone_api.register())):"online"===e&&(o='<img src="'+GetElementSource()+'images/presence_green.png" />',SaveParameter("presencestatus","Online"),!0===global.pres_unreg_called&&global.phonestarted<3&&!0===NeedRegister()&&(PutToDebugLog(2,"EVENT, mlogic API_Register SetSelectedPresence online"),webphone_api.register(),global.pres_unreg_called=!1));var n=document.getElementById("dialpad_presence"),i=document.getElementById("contactslist_presence"),r=document.getElementById("callhistorylist_presence");isNull(n)||(n.innerHTML=o,setTimeout(function(){"undefined"!=typeof dialpad_public&&null!==dialpad_public&&dialpad_public.MeasureDialPad()},10)),isNull(i)||(i.innerHTML=o,setTimeout(function(){"undefined"!=typeof contactslist_public&&null!==contactslist_public&&contactslist_public.MeasureContacslist()},10)),isNull(r)||(r.innerHTML=o,setTimeout(function(){"undefined"!=typeof callhistorylist_public&&null!==callhistorylist_public&&callhistorylist_public.MeasureCallhistorylist()},10)),global.phonestarted>2&&PresenceSet2()}catch(a){PutToDebugLogException(2,"common: SetSelectedPresence",a)}}function HelpWindow(e,t){try{if(60===GetConfigInt("brandid",-1))return void AboutWindow();var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220;var n="",i='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',r=ReplaceAll(stringres.get("help_text"),"[BRANDNAME]",GetBrandName()),a=GetBrandName();"cryptphone"!==a.toLowerCase()&&a.toLowerCase().indexOf("mizu")<0&&(r=ReplaceAll(stringres.get("help_text_custom"),"[BRANDNAME]",GetBrandName())),2===GetParameterInt("brandid",-1)&&(r=ReplaceAll('Contact GMSDIALER support:<br /><br /><a href="mailto:support@gmstechuk.com">support@gmstechuk.com</a>',"[BRANDNAME]",GetBrandName()));var s="";!0!==GetParameterBool("customizedversion",!0)&&!0===global.usestorage&&(s='<li id="#item_help"><a href="http://www.mizu-voip.com/Portals/0/Files/Webphone_Documentation.pdf" target="_blank">[ITEMTITLE]</a></li>',s=s.replace("[ITEMTITLE]",GetBrandName()+" "+stringres.get("help_help")),n+=s,s="");var l=GetParameter2("webcallme");!1!==IsWindowsSoftphone()||isNull(l)||1!==l.length||"0"===l||(s=i.replace("[ITEMID]","#item_webcallme"),s=s.replace("[ITEMTITLE]",stringres.get("menu_webcallme")),n+=s,s=""),1===GetLogLevel()?(s=i.replace("[ITEMID]","#item_enablelog"),s=s.replace("[ITEMTITLE]",stringres.get("help_enablelog")),n+=s,s=""):(s=i.replace("[ITEMID]","#item_logwindow"),s=s.replace("[ITEMTITLE]",stringres.get("help_logwindow")),n+=s,s=""),s=i.replace("[ITEMID]","#item_reconnect"),s=s.replace("[ITEMTITLE]",stringres.get("menu_reconnect")),n+=s,s="";global.usestorage&&(s=i.replace("[ITEMID]","#item_upgrade"),s=s.replace("[ITEMTITLE]",stringres.get("btn_upgrade")),n+=s,s=""),s=i.replace("[ITEMID]","#item_about"),s=s.replace("[ITEMTITLE]",stringres.get("help_about")),n+=s,s="";var c='<div id="help_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("menu_help")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="help_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+n+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";t=t||function(){},j$.mobile.activePage.append(c).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#help_window_ul").off("click","li"),t()}}),j$("#help_window_ul").on("click","li",function(e){var t=j$(this).attr("id");"#item_help"===t&&(j$("#help_window").popup("close"),AlertDialog(GetBrandName()+" "+stringres.get("help_help"),r)),j$("#help_window").on("popupafterclose",function(e){if(j$("#help_window").off("popupafterclose"),"#item_proversion"===t)UpgradeToProVersion();else if("#item_upgrade"===t)Opu();else if("#item_loging"===t)LogWindow();else if("#item_rate"===t)alert("not implemented yet");else if("#item_about"===t)AboutWindow();else if("#item_webcallme"===t)GenerateWebcallmeLink();else if("#item_reconnect"===t)global.authenticated_displayed=!1,common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_Restart",null):common.getuseengine()===global.ENGINE_WEBPHONE?wpa.webphone.Restart():(plhandler.Start(webphone_api.parameters,!1),plhandler_public.Stop(!0),setTimeout(function(){webphone_api.startInner()},1500));else if("#item_enablelog"===t){var o=GetLogLevel();o<global.predefLoglevel&&(o=global.predefLoglevel),SaveParameter("loglevel",o.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),global.loglevel=o}else"#item_logwindow"===t&&j$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(u){PutToDebugLogException(2,"common: HelpWindow",u)}}function GenerateWebcallmeLink(){var e=window.location.href;try{if(isNull(e))return;e=Trim(e);var t=e.indexOf("?");t>0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>0&&(e=e.substring(0,t)),e=Trim(e),e+="?wp_serveraddress=YOURSIPDOMAIN&wp_username=USERNAME&wp_password=PASSWORD&wp_callto=CALLEDNUMBER";var o=GetParameter("serveraddress_user"),n=GetSipusername();e=e.replace("YOURSIPDOMAIN",o),e=e.replace("USERNAME","webcallme"),e=e.replace("PASSWORD","webcallme"),e=e.replace("CALLEDNUMBER",n);var i=stringres.get("webcallme_msg")+":";i=i+'<br /><br /><textarea id="webcallme_textarea" class="noshadow" data-theme="a">'+e+"</textarea>",AlertDialog(stringres.get("menu_webcallme"),i)}catch(r){PutToDebugLogException(2,"common: GenerateWebcallmeLink",r)}}function AboutWindow(){try{if("warble"===GetBrandName().toLowerCase())return void OpenWebURL("https://support.warbleapp.com","");var e=GetBrandName();60===GetConfigInt("brandid",-1)&&(e="VoIPMuchPhone");var t=stringres.get("help_about")+" "+e,o="",n=[];n.push("m"),n.push("i"),n.push("z"),n.push("u"),n.push("-"),n.push("v"),n.push("o"),n.push("i"),n.push("p");var i=n.join("");!isNull(e)&&e.length>0&&(o=o+e+" "+GetVersionStr());var r=GetConfig("homepage");if(!isNull(r)&&r.length>0){var a=r.indexOf(",");a>0&&(r=Trim(r.substring(0,a))),o=o+'<div class="about_item"><a href="'+r+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+r+"')\">"+stringres.get("about_homepage")+"</a></div>"}else if(global.usestorage){var n="http://www."+i+".com/Software/WebPhone.aspx";o=o+'<div class="about_item"><a href="'+n+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+n+"')\">"+stringres.get("about_homepage")+"</a></div>"}var s=GetConfig("supporturl");if(!isNull(s)&&s.length>0)o=o+'<div class="about_item"><a href="'+s+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+s+"')\">"+stringres.get("about_support")+"</a></div>";else{var l=GetConfig("supportmail");!isNull(l)&&l.length>0?o=o+'<div class="about_item"><a href="mailto:'+l+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+l+"')\">"+stringres.get("about_support")+"</a></div>":global.usestorage&&(l="support@"+i+".com",o=o+'<div class="about_item"><a href="mailto:'+l+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+l+"')\">"+stringres.get("about_support")+"</a></div>")}var c=GetConfig("logo");!isNull(c)&&c.length>2&&(c.toLowerCase().indexOf(".jpg")>0||c.toLowerCase().indexOf(".jpeg")>0||c.toLowerCase().indexOf(".png")>0||c.toLowerCase().indexOf(".gif")>0)&&(o=o+'<br /><img src="'+GetElementSource()+"images/"+c+'" style="border: 0;">');var u=GetConfig("companyname"),m=new Date,g=m.getFullYear();if(!isNull(u)&&u.length>0)o=o+'<div class="about_item2"><i>'+stringres.get("about_copyright")+" "+g+" "+u+"<br />"+stringres.get("about_copyright2")+"</i></div>";else if(global.usestorage){var d=[];d.push("M"),d.push("i"),d.push("z"),d.push("u"),d.push("t"),d.push("e"),d.push("c"),d.push("h "),d.push("S"),d.push("R"),d.push("L"),u=d.join(""),o=o+'<div class="about_item2"><i>'+stringres.get("about_copyright")+" "+g+" "+u+"<br />"+stringres.get("about_copyright2")+"</i></div>"}var p=GetConfig("licenseurl");o=!isNull(p)&&p.length>0?o+'<div class="about_item2"><a href="'+p+'" target="_blank" onclick="common_public.OpenLinkInExternalBrowser(\''+p+"')\">"+stringres.get("about_license")+"</a></div>":o+'<div class="about_item2"><a href="javascript:;" onclick="common_public.LicenseAgreementWindow()">'+stringres.get("about_license")+"</a></div>",IsWindowsSoftphone()&&"true"==GetConfig("needactivation")&&!1===CanShowLicKeyInput()&&(o=o+'<div class="about_item2"><i>'+stringres.get("activated")+"</i></div>"),AlertDialog(t,o)}catch(h){PutToDebugLogException(2,"common: AboutWindow",h)}}function Opu(){try{var e=[];e.push("h"),e.push("t"),e.push("t"),e.push("p"),e.push("s"),e.push(":"),e.push("/"),e.push("/"),e.push("w"),e.push("w"),e.push("w"),e.push("."),e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("."),e.push("c"),e.push("o"),e.push("m"),e.push("/"),e.push("S"),e.push("u"),e.push("p"),e.push("p"),e.push("o"),e.push("r"),e.push("t"),e.push("/"),e.push("W"),e.push("e"),e.push("b"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("p"),e.push("r"),e.push("i"),e.push("c"),e.push("i"),e.push("n"),e.push("g"),e.push("."),e.push("a"),e.push("s"),e.push("p"),e.push("x");OpenWebURL(e.join(""),"")}catch(t){PutToDebugLogException(2,"common: Abs",t)}}function LicenseAgreementWindow(){try{var e=GetConfig("companyname"),t=GetConfig("brandname");if((isNull(e)||e.length<2)&&global.usestorage){var o=[];o.push("M"),o.push("i"),o.push("z"),o.push("u"),o.push("t"),o.push("e"),o.push("c"),o.push("h "),o.push("S"),o.push("R"),o.push("L"),e=o.join("")}(isNull(e)||e.length<2)&&(e=t);var n="";n=!0===global.usestorage||Strl(60)?ReplaceAll(stringres.get("dlg_about_msg"),"[BRANDNAME]",t):ReplaceAll(stringres.get("dlg_about_msg2"),"[BRANDNAME]",t),n=ReplaceAll(n,"[APPVERSION]",GetVersionStr());var i=e;(isNull(i)||i.length<2)&&(i=t),n=ReplaceAll(n,"[COMPANY]",i),j$.mobile.activePage.find(".messagePopup").popup("close"),setTimeout(function(){AlertDialog(stringres.get("about_license"),n.toString())},200)}catch(r){PutToDebugLogException(2,"common: LicenseAgreementWindow",r)}}function LogWindow(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220;var o="",n='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',i="";1!==GetParameterInt("loglevel",1)?(i=n.replace("[ITEMID]","#item_stoplog"),i=i.replace("[ITEMTITLE]",stringres.get("help_stoplog")),o+=i,i="",i=n.replace("[ITEMID]","#item_sendlog"),i=i.replace("[ITEMTITLE]",stringres.get("help_sendlog")),o+=i,i=""):(i=n.replace("[ITEMID]","#item_startlog"),i=i.replace("[ITEMTITLE]",stringres.get("help_startlog")),o+=i,i="");var r='<div id="log_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("help_loging")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="log_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+o+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";e=e||function(){},j$.mobile.activePage.append(r).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#log_window_ul").off("click","li"),e()}}),j$("#log_window_ul").on("click","li",function(e){var t=j$(this).attr("id");j$("#log_window").on("popupafterclose",function(e){if(j$("#log_window").off("popupafterclose"),"#item_startlog"===t){var o=GetLogLevel();o<global.predefLoglevel&&(o=global.predefLoglevel),SaveParameter("loglevel",o.toString()),SaveParameter("jsscriptevent","3"),webphone_api.setparameter("jsscriptevent","3"),global.loglevel=o}else"#item_stoplog"===t?(SaveParameter("loglevel","1"),SaveParameter("jsscriptevent","2"),webphone_api.setparameter("jsscriptevent","2"),global.loglevel=1,j$("#log_text").html("")):"#item_sendlog"===t&&j$.mobile.changePage("#page_logview",{transition:"pop",role:"page"})})})}catch(a){PutToDebugLogException(2,"common: LogWindow",a)}}function UpgradeToProVersion(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220;var o='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("help_proversion")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+stringres.get("proversion_content_text")+' </span><br /><button id="btn_buynow">Buy now</button><br />'+stringres.get("license_key")+': <input type="text" id="proversion_input" name="setting_item" data-theme="a" placeholder="'+stringres.get("enter_license_key")+'" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_upgrade" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_activate")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_close")+"</a></div></div>";e=e||function(){},j$.mobile.activePage.append(o).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_upgrade").off("click"),e()}}),j$("#btn_upgrade").on("click",function(){var e=document.getElementById("proversion_input").value;if(isNull(e)||Trim(e).length<1)return void ShowToast("Invalid license key.");e=Trim(e),WinAPI("API_EnterLicKey",function(e){},e),setTimeout(function(){canshowlickeyinput=null,CanShowLicKeyInput()},1e4)}),j$("#btn_buynow").on("click",function(){OpenLinkInExternalBrowser("http://www.mizu-voip.com/Support/Store.aspx")})}catch(n){PutToDebugLogException(2,"common: UpgradeToProVersion",n)}}function GetTickCount(){try{return(new Date).getTime()}catch(e){PutToDebugLogSpecial(2,"common: GetTickCount",!0,e)}return 0}function HoverCalc(e,t){try{var o=e,n=e.indexOf("#");if(n>=0&&(e=e.substring(n+1)),6===e.length){var i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);i+t>255?i-=t:i+t<0?i-=t:i+=t,r+t>255?r-=t:r+t<0?r-=t:r+=t,a+t>255?a-=t:a+t<0?a-=t:a+=t,i=i.toString(16),r=r.toString(16),a=a.toString(16),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),e="#"+i+r+a}else{if(3!==e.length)return o;var i=parseInt(e.substring(0,1),16),r=parseInt(e.substring(1,2),16),a=parseInt(e.substring(2,3),16);i+t>255?i-=t:i+t<0?i-=t:i+=t,r+t>255?r-=t:r+t<0?r-=t:r+=t,a+t>255?a-=t:a+t<0?a-=t:a+=t,i=i.toString(16),r=r.toString(16),a=a.toString(16),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),e="#"+i+r+a}return e}catch(s){PutToDebugLogException(2,"common: HoverCalc",s)}return""}function IsIeLocal(){try{if(!0===lf_isconfigured)return isielocal;lf_isconfigured=!0;var e=GetBrowser();if(isNull(e))return;e=e.toLowerCase();var t=window.location.href;if(isNull(t))return;t=t.toLowerCase(),t=Trim(t),"msie"===e&&t.indexOf("http")<0&&t.indexOf("https")<0&&(isielocal=!0,PutToDebugLog(2,"EVENT, common: IsIeLocalFilesystem: IE from local file system"))}catch(o){PutToDebugLogException(2,"common: IsIeLocal",o)}return isielocal}function IsIeVersion(e){try{if(isNull(e))return!1;var t=navigator.userAgent,o=t.match(/MSIE\s?(\d+)(?:\.(\d+))?/i);if(!isNull(o)&&!isNull(o[0])&&o[0].indexOf(e)>=0)return!0}catch(n){PutToDebugLogException(2,"common: IsIeVersion",n)}return!1}function GetBrowser(){try{if(isNull(browserName)||isNull(browserName2)){var e=navigator.userAgent.toLowerCase();-1!==e.indexOf("edge")?(browserName="Edge",browserName2="Edge"):-1!==e.indexOf("msie")&&-1===e.indexOf("opera")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("trident")||-1!==e.indexOf("Trident")?(browserName="MSIE",browserName2="MSIE"):-1!==e.indexOf("iphone")?(browserName2=-1!==e.indexOf("fxios")||-1!==e.indexOf("firefox")?"Firefox":-1!==e.indexOf("crios")||-1!==e.indexOf("chrome")?"Chrome":"iPhone",browserName="Netscape Family"):-1!==e.indexOf("firefox")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Firefox"):-1!==e.indexOf("chrome")?(browserName="Netscape Family",browserName2="Chrome","Android"===GetOs()&&(e=e.replace("mozilla/",""),browserName2=e.match(/\/\d\.\d /i)?"AndroidNative":"Chrome")):-1!==e.indexOf("safari")?(browserName="Netscape Family",browserName2="Safari"):-1!==e.indexOf("mozilla")&&-1===e.indexOf("opera")?(browserName="Netscape Family",browserName2="Other"):-1!==e.indexOf("opera")?(browserName="Netscape Family",browserName2="Opera"):(browserName="?",browserName2="unknown")}}catch(t){PutToDebugLogException(2,"common: GetBrowser",t)}return browserName2}function GetBrowserVersion(){try{if(browserversion>0)return browserversion;var e=GetBrowser(),t=navigator.userAgent.toLowerCase();if("Chrome"===e){var o=t.indexOf("chrome");o>0&&(t=t.substring(o+6)),isNull(t)||(t=t.replace("/","")),o=t.indexOf("."),o>0&&(t=t.substring(0,o)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("Firefox"===e){var o=t.indexOf("firefox");o>0&&(t=t.substring(o+7)),isNull(t)||(t=t.replace("/","")),o=t.indexOf("."),o>0&&(t=t.substring(0,o)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("Safari"===e||"iPhone"===e){var o=t.indexOf("version");o>0?t=t.substring(o+7):t.indexOf("_")>0&&(t=t.substring(0,t.indexOf("_")),t=Trim(t),t=t.substring(t.lastIndexOf(" "))),isNull(t)||(t=t.replace("/","")),o=t.indexOf("."),o>0&&(t=t.substring(0,o)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}else if("MSIE"===e){var n=window.navigator.userAgent,i=n.indexOf("MSIE ");i>0&&(browserversion=parseInt(n.substring(i+5,n.indexOf(".",i)),10));var r=n.indexOf("Trident/");if(r>0){var a=n.indexOf("rv:");browserversion=parseInt(n.substring(a+3,n.indexOf(".",a)),10)}var s=n.indexOf("Edge/");s>0&&(browserversion=parseInt(n.substring(s+5,n.indexOf(".",s)),10))}else if("Edge"===e){var o=t.indexOf("edge");o>0&&(t=t.substring(o+4)),isNull(t)||(t=t.replace("/","")),o=t.indexOf("."),o>0&&(t=t.substring(0,o)),isNull(t)||(t=Trim(t),IsNumber(t)&&(browserversion=StrToInt(t)))}!isNull(browserversion)&&IsNumber(browserversion)||(browserversion=-1),PutToDebugLog(2,"EVENT, common: GetBrowserVersion Detected browser version: "+browserversion)}catch(l){PutToDebugLogException(2,"common: GetBrowserVersion",l)}return browserversion}function IsARM(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("arm")>=0&&e.indexOf("x86")<0)return!0}catch(t){PutToDebugLogException(2,"common: IsARM",t)}return!1}function Is64BitBrowser(){try{var e=navigator.userAgent.toLowerCase();return"Firefox"===GetBrowser()&&e.indexOf("x64")>0&&!0,!(e.indexOf("64")<0)}catch(t){PutToDebugLogException(2,"common: Is64BitBrowser",t)}return!1}function GetOs(){var e="";try{if(!isNull(curros)&&curros.length>0)return curros;if(e=platform.os,isNull(e)||(e=e.toString()),isNull(e)||e.length<1)return curros;e=e.toLowerCase(),curros=e.indexOf("windows")>=0?"Windows":e.indexOf("mac")>=0||e.indexOf("os x")>=0?"Mac":e.indexOf("centos")>-1||e.indexOf("debian")>-1||e.indexOf("fedora")>-1||e.indexOf("gentoo")>-1||e.indexOf("ubuntu")>-1||e.indexOf("linux mint")>-1||e.indexOf("red hat")>-1||e.indexOf("suse")>-1||e.indexOf("linux")>-1||e.indexOf("x11")>-1?"Linux":e.indexOf("ios")>-1?"iOS":e.indexOf("android")>-1?"Android":Trim(e),(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(curros="iOS")}catch(t){PutToDebugLogException(2,"common: GetOs",t)}return curros}function PickContact(e,t){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220;var n=GetDeviceHeight();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.5):250;for(var i="",r=0;r<global.ctlist.length;r++){var a=global.ctlist[r];if(!(isNull(a)||a.length<1)){var s=a[CT_NAME];if(isNull(s)||s.length<1){var l=c[CT_NUMBER];if(isNull(l)||l.length<1||isNull(l[0])||l[0].length<1)continue;s=l[0]}var c='<li id="pickcontact_'+r+'"><a data-rel="back">'+s+"</a></li>";i+=c}}var u='<div id="pickcontact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; min-width: "+Math.floor(.6*o)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("pick_ct")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontact_ul" data-role="listview" data-inset="true" data-icon="false" data-filter="true" data-filter-placeholder="Search Contacts" data-autodividers="true" style="margin: 0; max-height: '+n+'px;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";t=t||function(){},j$.mobile.activePage.append(u).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#pickcontact_ul").off("click","li"),t()}}),j$("#pickcontact_ul").on("click","li",function(t){var o=j$(this).attr("id"),n="",i=o.indexOf("_");if(i<2)return void PutToDebugLog(2,"ERROR, common PickContact OnListItemClick invalid id: "+o);n=Trim(o.substring(i+1));var r=global.ctlist[n];if(isNull(r)||r.length<1)return void PutToDebugLog(3,"ERROR, PickContact ctentry is NULL");var a=r[CT_NUMBER];j$("#pickcontact_popup").on("popupafterclose",function(t){if(j$("#pickcontact_popup").off("popupafterclose"),1===a.length)return void e(a[0],r[CT_NAME]);PickContactNumber(n,e)})})}catch(m){PutToDebugLogException(2,"common: PickContact",m)}}function PickContactNumber(e,t,o){try{if(!t||"function"!=typeof t)return void PutToDebugLog(2,"ERROR, PickContactNumber callback is NULL");var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220;var i=global.ctlist[e];if(isNull(i)||i.length<1)return void PutToDebugLog(3,"ERROR, PickContactNumber ctentry is NULL");for(var r=i[CT_NUMBER],a="",s=0;s<r.length;s++)if(!(isNull(r[s])||r[s].length<1)){var l='<li id="pickcontactnumber_'+s+'"><a data-rel="back">'+r[s]+"</a></li>";a+=l}
var c='<div id="pickcontactnumber_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+i[CT_NAME]+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontactnumber_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+a+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";o=o||function(){},j$.mobile.activePage.append(c).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#pickcontactnumber_ul").off("click","li"),o()}}),j$("#pickcontactnumber_ul").on("click","li",function(e){var o=j$(this).attr("id"),n="",a=o.indexOf("_");if(a<2)return void PutToDebugLog(2,"ERROR, common PickContactNumber OnListItemClick invalid nrid: "+o);n=Trim(o.substring(a+1)),j$("#pickcontactnumber_popup").on("popupafterclose",function(e){j$("#pickcontactnumber_popup").off("popupafterclose"),t(r[n],i[CT_NAME])})})}catch(u){PutToDebugLogException(2,"common: PickContactNumber",u)}}function NormalizeNumber(e){try{if(isNull(e))return"";if(e=Trim(e),e=NormalizeInput(e,0),!IsWindowsSoftphone()&&(getuseengine()===global.ENGINE_WEBRTC||getuseengine()===global.ENGINE_FLASH)){var t=GetParameter2("techprefix");(!isNull(t)||t.length>0)&&(t=Trim(t),e=t+e)}if(0==GetParameterInt("normalizenumber",-1))return ApplyFilters(e);if(e.length<6||e.length>20)return ApplyFilters(e);var o=GetSipusername();if(!isNull(o)&&o.length>0&&o!==NormalizeInput2(o,1))return ApplyFilters(e);for(var n=0,i=0;i<e.length;i++)e.charAt(i)>="0"&&e.charAt(i)<="9"&&n++;if(n<5)return ApplyFilters(e);for(var i=0;i<e.length;i++)if(e.charAt(i)>="a"&&e.charAt(i)<="z"||e.charAt(i)>="A"&&e.charAt(i)<="Z"||"@"==e.charAt(i))return ApplyFilters(e);for(var r="",i=0;i<e.length;i++)(e.charAt(i)>="0"&&e.charAt(i)<="9"||"*"==e.charAt(i)||","==e.charAt(i)||"#"==e.charAt(i)||0==i&&"+"==e.charAt(i))&&(r+=e.charAt(i));return ApplyFilters(e)}catch(a){PutToDebugLogException(2,"common: NormalizeNumber",a)}return ApplyFilters(e)}function NormalizeInput(e,t){try{var o=e;return isNull(o)?"":(o=o.toString(),o=Trim(o),t<1&&(o=ReplaceAll(o,"WSS://",""),o=ReplaceAll(o,"wss://",""),o=ReplaceAll(o,"WSS:",""),o=ReplaceAll(o,"wss:",""),o=ReplaceAll(o,"WS://",""),o=ReplaceAll(o,"ws://",""),o=ReplaceAll(o,"WS:",""),o=ReplaceAll(o,"ws:","")),o=ReplaceAll(o,"SIP:",""),o=ReplaceAll(o,"sip:",""),o=ReplaceAll(o,"SIPS:",""),o=ReplaceAll(o,"sips:",""),o=ReplaceAll(o,"UDP:",""),o=ReplaceAll(o,"udp:",""),o=ReplaceAll(o,"TCP:",""),o=ReplaceAll(o,"tcp:",""),o=ReplaceAll(o,"URL:",""),o=ReplaceAll(o,"url:",""),o=ReplaceAll(o,"TEL:",""),o=ReplaceAll(o,"tel:",""),o=ReplaceAll(o,"HTTPS://",""),o=ReplaceAll(o,"https://",""),o=ReplaceAll(o,"HTTPS:",""),o=ReplaceAll(o,"https:",""),o=ReplaceAll(o,"HTTP://",""),o=ReplaceAll(o,"http://",""),o=ReplaceAll(o,"HTTP:",""),o=ReplaceAll(o,"http:",""),o=ReplaceAll(o,"'",""),o=ReplaceAll(o,'"',""))}catch(n){PutToDebugLogException(2,"common: NormalizeInput",n)}return e}function NormalizeInput2(e,t){try{var o=e;if(isNull(o))return"";o=o.toString(),o=Trim(o),o=NormalizeInput(o,0);var n=o.split("");if(isNull(n)||n.length<1)return e;if(t<1){for(var i=0;i<n.length;i++)n[i]>="0"&&n[i]<="9"||(n[i]="");return n.join("")}if(1===t){for(var i=0;i<n.length;i++)n[i]>="0"&&n[i]<="9"||n[i]>="A"&&n[i]<="Z"||n[i]>="a"&&n[i]<="z"||"_"===n[i]||"."===n[i]||"-"===n[i]||(n[i]="_");return n.join("")}if(2===t){for(var i=0;i<n.length;i++)n[i]>="0"&&n[i]<="9"||n[i]>="A"&&n[i]<="Z"||n[i]>="a"&&n[i]<="z"||"_"===n[i]||"."===n[i]||"-"===n[i]||" "===n[i]||(n[i]="_");return n.join("")}for(var i=0;i<n.length;i++)n[i]>="0"&&n[i]<="9"||n[i]>="A"&&n[i]<="Z"||n[i]>="a"&&n[i]<="z"||"_"===n[i]||"."===n[i]||"-"===n[i]||" "===n[i]||"+"===n[i]||":"===n[i]||"@"===n[i]||(n[i]="_");return n.join("")}catch(r){PutToDebugLogException(2,"common: NormalizeInput2",r)}return e}function PasswordStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var t=0;t<e.length;t++)if(e.charCodeAt(t)<33||e.charCodeAt(t)>126||"'"===e.charAt(t)||'"'===e.charAt(t)||"<"===e.charAt(t)||">"===e.charAt(t))return!1}catch(o){PutToDebugLogException(2,"common: PasswordStringIsValidForServer",o)}return!0}function UsernameStringIsValidForServer(e){try{if(isNull(e)||e.length<1)return!1;for(var t=0;t<e.length;t++)if(!(e.charAt(t)>="0"&&e.charAt(t)<="9"||e.charAt(t)>="a"&&e.charAt(t)<="z"||e.charAt(t)>="A"&&e.charAt(t)<="Z"||"#"===e.charAt(t)||"*"===e.charAt(t)||"("===e.charAt(t)||")"===e.charAt(t)||"["===e.charAt(t)||"]"===e.charAt(t)||"{"===e.charAt(t)||"}"===e.charAt(t)||"+"===e.charAt(t)||"."===e.charAt(t)||","===e.charAt(t)||"/"===e.charAt(t)||"\\"===e.charAt(t)||"_"===e.charAt(t)||"-"===e.charAt(t)||"^"===e.charAt(t)||"~"===e.charAt(t)||"!"===e.charAt(t)))return!1}catch(o){PutToDebugLogException(2,"common: UsernameStringIsValidForServer",o)}return!0}function ApplyFilters(e){try{if(isNull(e))return"";e=Trim(e),PutToDebugLog(4,"EVENT, normalized number: "+e);var t=GetParameter("filters");if(isNull(t)||t.length<3)return e;var o=t.split(";");if(isNull(o)||o.length<1)return e;for(var n=0;n<o.length;n++)if(!isNull(o[n])){var i=o[n].split(",");if(!isNull(i)&&4===i.length){var r="",a="",s=-1,l=-1;try{if(r=i[F_WHAT],a=i[F_WITH],isNull(r)&&(r=""),isNull(a)&&(a=""),r.length<1&&a.length<1)continue;!isNull(i[F_MIN])&&IsNumber(i[F_MIN])&&(s=StrToInt(i[F_MIN])),!isNull(i[F_MAX])&&IsNumber(i[F_MAX])&&(l=StrToInt(i[F_MAX])),0!==r.length&&0!==e.indexOf(r)||(s<0&&l<0?e=e.replace(r,a):s<0&&l>0&&e.length<=l?e=e.replace(r,a):l<0&&s>0&&e.length>s?e=e.replace(r,a):s>=0&&l>0&&l>=s&&e.length>=s&&e.length<=l&&(e=e.replace(r,a)))}catch(c){continue}}}PutToDebugLog(4,"EVENT, filtered number: "+e)}catch(u){PutToDebugLogException(2,"common: ApplyFilters",u)}return e}function InitializeSettings(){try{PutToDebugLog(2,"EVENT, common: InitializeSettings called");var e="",t="2";!isNull(GetConfig("upperserverfromuser"))&&GetConfig("upperserverfromuser").length>0&&(t=Trim(GetConfig("upperserverfromuser"))),SettingItem("upperserverfromuser",t,"-1",GROUP_NOGROUP,"","","1","2"),"9999"!==GetConfig("brandid")&&(!1===RequestUserServerInput(t)&&!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(e=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress_user",e,"8",GROUP_LOGIN,"","","1","")),SettingItem("serveraddress_orig","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("upperserver","","-1","-1","","","1",""),SettingItem("sipusername","","1",GROUP_LOGIN,"","","1",""),SettingItem("password","","1",GROUP_LOGIN,"","","1",""),SettingItem("settlevelbasic","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("submenu_sipsettings","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_media","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_video","","6",GROUP_MEDIA,"","","1",""),SettingItem("submenu_calldivert","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_general","","6",GROUP_MAIN,"","","1",""),SettingItem("submenu_profile","","6",GROUP_MAIN,"","","1",""),SettingItem("advancedloginsettings2","","6",GROUP_SIP,"","","1",""),SettingItem("submenu_integrate","","6",GROUP_GENERAL,"","","1",""),SettingItem("submenu_screenshare","","6",GROUP_MEDIA,"","","1","");var o="true";!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(o=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",o,"-1",GROUP_NOGROUP,"","","1","true");var n="1";!isNull(GetConfig("autoprovisioning"))&&GetConfig("autoprovisioning").length>0&&(n=Trim(GetConfig("autoprovisioning"))),!0!==n&&"true"!==n||(n="1"),!1!==n&&"false"!==n||(n="0"),SettingItem("autoprovisioning",n,"-1",GROUP_NOGROUP,"","","1","1");var i="Server";!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(i=Trim(GetConfig("server_label"))),SettingItem("server_label",i,"-1",GROUP_NOGROUP,"","","1","Server");var r="false";!isNull(GetConfig("serverinputisupperserver"))&&GetConfig("serverinputisupperserver").length>0&&(r=Trim(GetConfig("serverinputisupperserver"))),SettingItem("serverinputisupperserver",r,"-1",GROUP_NOGROUP,"","","1","false");var a="";!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(a=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",a,"-1",GROUP_NOGROUP,"","","1","");var s="";!isNull(GetConfig("webrtcserveraddress"))&&GetConfig("webrtcserveraddress").length>0&&(s=Trim(GetConfig("webrtcserveraddress"))),SettingItem("webrtcserveraddress",s,"-1",GROUP_NOGROUP,"","","1","");var l="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(l=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",l,"-1",GROUP_NOGROUP,"","","1","");var c="";!isNull(GetConfig("realm"))&&GetConfig("realm").length>0&&(c=Trim(GetConfig("realm"))),SettingItem("realm",c,"1",GROUP_SIP,"","","1","");var u="1";!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(u=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",u,"-1",GROUP_NOGROUP,"","","1","1");var m="";!isNull(GetConfig("apiv2md5salt"))&&GetConfig("apiv2md5salt").length>0&&(m=Trim(GetConfig("apiv2md5salt"))),SettingItem("apiv2md5salt",m,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("displaypopupdirectcalls","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("register","1","2",GROUP_SIP,stringres.get("register__no")+","+stringres.get("register__auto")+","+stringres.get("register__yes"),"0,1,2","1","1"),SettingItem("registerinterval","180","1",GROUP_SIP,"","","1","180"),SettingItem("cfgnetworkspeed","0","2",GROUP_MEDIA,"Auto guess,Slow (< 20 KBits on GPRS or 3G),Normal (20 - 60 kbits),Fast (> 60 KBits)","0,1,2,3","1","0"),SettingItem("prefcodec","","3",GROUP_NOGROUP,"","","1",""),SettingItem("dtmfmode","2","2",GROUP_SIP,stringres.get("dtmfmode_op_0")+","+stringres.get("dtmfmode_op_1")+","+stringres.get("dtmfmode_op_2")+","+stringres.get("dtmfmode_op_3")+","+stringres.get("dtmfmode_op_4")+","+stringres.get("dtmfmode_op_5")+","+stringres.get("dtmfmode_op_6"),"0,1,2,3,4,5,6","1","2"),SettingItem("audiorecorder","1","2",GROUP_MEDIA,"Default,Auto guess, Mic,Voice call,Voice downlink,Voice uplink,Voice communication","0,1,2,3,4,5,6","1","1"),SettingItem("audioplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call","-2147483648,4,3,5,2,1,0","1","-2147483648"),SettingItem("speakerphoneplayer","-2147483648","2",GROUP_MEDIA,"Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call,No change","-2147483648,4,3,5,2,1,0,6","1","-2147483648"),SettingItem("speakerphoneoutput","0","2",GROUP_MEDIA,"Auto guess,Speaker,Speaker and mode,VoIP,Bluetooth,Normal,Mode only,No changes","0,1,2,3,4,5,6,7","1","0"),SettingItem("autousebluetooth","0","2",GROUP_MEDIA,"Guess,No,Yes","0,1,2","1","0"),SettingItem("playring","2","2",GROUP_MEDIA,stringres.get("playring__no")+","+stringres.get("playring__incoming")+","+stringres.get("playring__both"),"0,1,2","1","2"),SettingItem("volumein","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("volumeout","50","4",GROUP_MEDIA,"","","1","50"),SettingItem("agc","3","2",GROUP_MEDIA,stringres.get("agc__disabled")+","+stringres.get("agc__for_redcording")+","+stringres.get("agc__both_for_recording_and_playback")+","+stringres.get("agc__guess"),"0,1,2,3","1","3"),SettingItem("aec","1","8",GROUP_MEDIA,"No,Yes except if headset is guessed,Yes if supported,Forced yes even if not supported (might result in unexpected errors)","0,1,2,3","1","1"),SettingItem("denoise","3","2",GROUP_MEDIA,stringres.get("denoise__disabled")+","+stringres.get("denoise__recording")+","+stringres.get("denoise__both")+","+stringres.get("denoise__auto"),"0,1,2,3","1","3"),SettingItem("plc","1","2",GROUP_MEDIA,stringres.get("plc__no")+","+stringres.get("plc__auto")+","+stringres.get("plc__yes"),"0,1,2","1","1"),SettingItem("silencesupress","-1","2",GROUP_MEDIA,stringres.get("silencesupress__auto")+","+stringres.get("silencesupress__no")+","+stringres.get("silencesupress__yes"),"-1,0,1","1","-1"),SettingItem("hardwaremedia","0","2",GROUP_MEDIA,stringres.get("hardwaremedia__auto")+","+stringres.get("hardwaremedia__no")+","+stringres.get("hardwaremedia__yes"),"0,1,2","1","0"),SettingItem("mediaencryption","0","2",GROUP_MEDIA,stringres.get("mediaencryption__no")+","+stringres.get("mediaencryption__auto")+","+stringres.get("mediaencryption__srtp"),"0,1,2","1","0"),SettingItem("setqos","0","2",GROUP_MEDIA,stringres.get("setqos__auto")+","+stringres.get("setqos__no")+","+stringres.get("setqos__yes"),"0,1,2","1","0"),SettingItem("codecframecount","0","2",GROUP_MEDIA,stringres.get("codecframecount_auto")+",1,2,3,4,5,6","0,1,2,3,4,5,6","1","0"),SettingItem("doublesendrtp","0","2",GROUP_MEDIA,stringres.get("doublesendrtp__no")+","+stringres.get("doublesendrtp__yes"),"0,1","1","0"),SettingItem("ringtimeout","90000","1",GROUP_SIP,"","","1","90000"),SettingItem("calltimeout","10800000","1",GROUP_SIP,"","","1","10800000"),SettingItem("displaynotification","2","2",GROUP_GENERAL,"Never,On event,Always","0,1,2","1","2");var g="false";!isNull(GetConfig("hasvolume"))&&GetConfig("hasvolume").length>0&&(g=Trim(GetConfig("hasvolume"))),SettingItem("displayvolumecontrols",g,"0",GROUP_GENERAL,"","","1",g),SettingItem("displayaudiodevice","false","0",GROUP_GENERAL,"","","1","false"),SettingItem("use_fast_ice","1","2",GROUP_SIP,stringres.get("use_fast_ice__no")+","+stringres.get("use_fast_ice__auto")+","+stringres.get("use_fast_ice__yes")+","+stringres.get("use_fast_ice__always"),"0,1,2,3","1","1"),SettingItem("use_stun","1","2",GROUP_SIP,stringres.get("use_stun__force")+","+stringres.get("use_stun__no")+","+stringres.get("use_stun__stable_nat")+","+stringres.get("use_stun__all_symetric")+","+stringres.get("use_stun__always")+","+stringres.get("use_stun__public_ip"),"-1,0,1,2,3,4","1","1"),SettingItem("prack","false","0",GROUP_SIP,"","","1","false"),SettingItem("localip","","1",GROUP_SIP,"","","1",""),SettingItem("signalingport","","1",GROUP_SIP,"","","1",""),SettingItem("rtpport","","1",GROUP_SIP,"","","1","");var d="2";!isNull(GetConfig("earlymedia"))&&GetConfig("earlymedia").length>0&&(d=Trim(GetConfig("earlymedia"))),SettingItem("earlymedia",d,"2",GROUP_SIP,stringres.get("earlymedia__no")+","+stringres.get("earlymedia__reserved")+","+stringres.get("earlymedia__auto")+","+stringres.get("earlymedia__just_early")+","+stringres.get("earlymedia__null_packets")+","+stringres.get("earlymedia__yes")+","+stringres.get("earlymedia__always_force"),"0,1,2,3,4,5,6","1",d),SettingItem("jittersize","3","2",GROUP_MEDIA,stringres.get("jittersize__no")+","+stringres.get("jittersize__esmall")+","+stringres.get("jittersize__small")+","+stringres.get("jittersize__normal")+","+stringres.get("jittersize__big")+","+stringres.get("jittersize__ebig")+","+stringres.get("jittersize__max"),"0,1,2,3,4,5,6","1","3"),SettingItem("proxyaddress","","1",GROUP_SIP,"","","1",""),SettingItem("username","","1",GROUP_SIP,"","","1",""),SettingItem("displayname","","1",GROUP_SIP,"","","1",""),SettingItem("email","","1",GROUP_GENERAL,"","","1",""),SettingItem("chatsms","0","2",GROUP_SIP,stringres.get("chatsms__auto_guess_or_ask")+","+stringres.get("chatsms__sms_only")+","+stringres.get("chatsms__chat_only")+","+stringres.get("chatsms__disable"),"0,1,2,3","1","0"),SettingItem("savetocontacts","1","2",GROUP_GENERAL,stringres.get("savetocontacts__no")+","+stringres.get("savetocontacts__ask")+","+stringres.get("savetocontacts__yes"),"0,1,2","1","1"),SettingItem("call_access","","7",GROUP_GENERAL,"","","1","");var p="-1";!isNull(GetConfig("transfertype"))&&GetConfig("transfertype").length>0&&(p=Trim(GetConfig("transfertype"))),SettingItem("transfertype",p,"2",GROUP_CALLDIVERT,stringres.get("transfertype__auto")+","+stringres.get("transfertype__unattended")+","+stringres.get("transfertype__withhold")+","+stringres.get("transfertype__attanded"),"-1,1,6,5","1",p),SettingItem("callforwardonbusy","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("rejectonvoipbusy","3","2",GROUP_CALLDIVERT,"Auto,Reject calls,Allow calls,Forward calls","3,0,1,2","1","3"),SettingItem("rejectonphonebusy","0","2",GROUP_CALLDIVERT,"Reject calls,Allow calls,Forward calls","0,1,2","1","0");var h="";!isNull(GetConfig("voicemailnum"))&&GetConfig("voicemailnum").length>0&&(h=Trim(GetConfig("voicemailnum"))),SettingItem("voicemailnum",h,"1",GROUP_CALLDIVERT,"","","1","");var f="2";!isNull(GetConfig("voicemail"))&&GetConfig("voicemail").length>0&&(f=Trim(GetConfig("voicemail"))),SettingItem("voicemail",f,"2",GROUP_CALLDIVERT,"Disabled,Only if NOTIFY is received,Auto-detect if SUBSCRIBE is needed,Subscribe for voicemail after registration,Subscribe for voicemail on startup","0,1,2,3,4","1","false"),SettingItem("techprefix","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("startonboot","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos","true","0",GROUP_GENERAL,"","","1","true"),SettingItem("startwithos_was_sent","false","-1",GROUP_NOGROUP,"","","1","false");var b="1";global.isdebugversion?(SettingItem("loglevel","5","0",GROUP_GENERAL,"","","1","1"),global.loglevel=5):(!isNull(webphone_api.parameters.loglevel)&&1===webphone_api.parameters.loglevel.length&&IsNumber(webphone_api.parameters.loglevel)&&(b=Trim(webphone_api.parameters.loglevel.length)),SettingItem("loglevel",b,"0",GROUP_GENERAL,"","","1","1")),SettingItem("loglevel_dbg",b,"1",GROUP_GENERAL,"","","1","1"),SettingItem("code_version","1","-1",GROUP_NOGROUP,"","","1","1");var v="";!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(v=Trim(GetConfig("brandname"))),SettingItem("brandname",v,"-1",GROUP_NOGROUP,"","","1","");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(v=Trim(GetConfig("brandid"))),SettingItem("brandid","","-1",GROUP_NOGROUP,"","","1","");var _="";!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(_=Trim(GetConfig("companyname"))),SettingItem("companyname",_,"-1",GROUP_NOGROUP,"","","1","");var E="";!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(E=Trim(GetConfig("newuser"))),SettingItem("newuser",E,"-1",GROUP_NOGROUP,"","","1","");var T="";!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(T=Trim(GetConfig("homepage"))),SettingItem("homepage",T,"-1",GROUP_NOGROUP,"","","1","");var P="";!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(P=Trim(GetConfig("accounturi"))),SettingItem("accounturi",P,"-1",GROUP_NOGROUP,"","","1","");var S="";!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(S=Trim(GetConfig("recharge"))),SettingItem("recharge",S,"-1",GROUP_NOGROUP,"","","1","");var N="";!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(N=Trim(GetConfig("p2p"))),SettingItem("p2p",N,"1",GROUP_CALLDIVERT,"","","1","");var w="";!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(w=Trim(GetConfig("callback"))),SettingItem("callback",w,"1",GROUP_CALLDIVERT,"","","1","");var I="";!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(I=Trim(GetConfig("sms"))),SettingItem("sms",I,"1",GROUP_CALLDIVERT,"","","1","");var C="";!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(C=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",C,"-1",GROUP_NOGROUP,"","","1","");var R="";!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(R=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",R,"1",GROUP_CALLDIVERT,"","","1","");var y="";!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(y=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",y,"1",GROUP_CALLDIVERT,"","","1","");var L="";!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(L=Trim(GetConfig("supportmail"))),SettingItem("supportmail",L,"-1",GROUP_NOGROUP,"","","1","");var D="";!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(D=Trim(GetConfig("supporturl"))),SettingItem("supporturl",D,"-1",GROUP_NOGROUP,"","","1","");var G=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(G=Trim(GetConfig("header"))),G.length<1&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(G=GetConfig("headertext")),SettingItem("header",G,"-1",GROUP_NOGROUP,"","","1","");var x="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&(x=Trim(GetConfig("footer"))),x.length<1&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&(x=GetConfig("footertext")),SettingItem("footer",x,"-1",GROUP_NOGROUP,"","","1","");var O="";!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(O=Trim(GetConfig("logo"))),SettingItem("logo",O,"-1",GROUP_NOGROUP,"","","1","");var A="";!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(A=Trim(GetConfig("version"))),SettingItem("version",A,"-1",GROUP_NOGROUP,"","","1","");var k="";!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(k=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",k,"-1",GROUP_NOGROUP,"","","1","");var U="";!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(U=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",U,"-1",GROUP_NOGROUP,"","","1","");var V="";!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(V=Trim(GetConfig("advertisement"))),SettingItem("advertisement",V,"-1",GROUP_NOGROUP,"","","1","");var W="";!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(W=Trim(GetConfig("helpurl"))),SettingItem("helpurl",W,"-1",GROUP_NOGROUP,"","","1","");var M="";!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(M=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",M,"-1",GROUP_NOGROUP,"","","1","");var F="";!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(F=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",F,"-1",GROUP_NOGROUP,"","","1","");var H="";!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(H=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",H,"-1",GROUP_NOGROUP,"","","1","");var j="0";!isNull(GetConfig("enablepresence"))&&GetConfig("enablepresence").length>0&&(j=Trim(GetConfig("enablepresence"))),SettingItem("enablepresence",j,"-1",GROUP_NOGROUP,"","","1","0"),SettingItem("presencestatus","Online","2",GROUP_PROFILE,"Online,Away,DND,Invisible,Offline","Online,Away,DND,Invisible,Offline","1","Online"),SettingItem("numexistscalled","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("servercontacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("verifyuser","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvcontacts","","-1",GROUP_NOGROUP,"","","1","0");var B="false";!isNull(GetConfig("contacttoggle"))&&GetConfig("contacttoggle").length>0&&(B=Trim(GetConfig("contacttoggle"))),SettingItem("contacttoggle",B,"-1",GROUP_NOGROUP,"","","1","false"),SettingItem("last_callback_nr","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("callback_mode","0","2",GROUP_CALLDIVERT,"No,Ask,On no internet,On no WIFI,Always","0,1,2,3,4","1","0"),SettingItem("accounts","","5",GROUP_SIP,"","","1",""),SettingItem("reset_settings","","8",GROUP_GENERAL,"","","1","");var $="false";!isNull(GetConfig("voicerecording"))&&GetConfig("voicerecording").length>0&&("true"==$||"false"==$)&&($=Trim(GetConfig("voicerecording"))),SettingItem("voicerecording",$,"0",GROUP_GENERAL,"","","1",$),SettingItem("ringtone","","8",GROUP_GENERAL,"Ringtone1,Ringtone2,Ringtone3","0,1,2","1",""),SettingItem("changesptoring","2","2",GROUP_SIP,stringres.get("changesptoring__nothing")+","+stringres.get("changesptoring__disp_ringing")+","+stringres.get("changesptoring__start_media")+","+stringres.get("changesptoring__start_media_disp"),"0,1,2,3","1","2");var q="-1";isNull(GetConfig("transport"))||(q=GetConfigInt("transport",-1)),SettingItem("transport",q.toString(),"2",GROUP_SIP,"Auto,UDP,TCP,TLS","-1,0,1,2","1",q.toString()),SettingItem("defmute","0","2",GROUP_SIP,stringres.get("defmute__both")+","+stringres.get("defmute__speakers_only")+","+stringres.get("defmute__mic_only"),"0,1,2","1","2"),SettingItem("automute","0","2",GROUP_CALLDIVERT,stringres.get("automute__no")+","+stringres.get("automute__incoming")+","+stringres.get("automute__outgoing")+","+stringres.get("automute__both")+","+stringres.get("automute__other_line"),"0,1,2,3,4","1","0"),SettingItem("autohold","0","2",GROUP_CALLDIVERT,stringres.get("autohold__no")+","+stringres.get("autohold__incoming")+","+stringres.get("autohold__outgoing")+","+stringres.get("autohold__both")+","+stringres.get("autohold__other_line"),"0,1,2,3,4","1","0"),SettingItem("customsipheader","","1",GROUP_SIP,"","","1",""),SettingItem("sendrtponmuted","false","0",GROUP_SIP,"","","1","false"),SettingItem("capabilityrequest","false","0",GROUP_SIP,"","","1","false"),SettingItem("devtest","0,0,0,0,0,0,0,0,0","8",GROUP_SIP,"","","1","0,0,0,0,0,0,0,0,0"),SettingItem("enableaudio","true","0",GROUP_CALLDIVERT,"","","1","true"),SettingItem("settobasefunctionality","true","8",GROUP_MAIN,"","","1","true"),SettingItem("dialerintegration","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("screenrotation","0","2",GROUP_GENERAL,"Auto,No,Yes","0,1,2","1","0"),SettingItem("audiobufferlength","-1","1",GROUP_MEDIA,"","","1","-1"),SettingItem("keepaliveival","28000","1",GROUP_SIP,"","","1","28000"),SettingItem("cpualwayspartiallock","false","0",GROUP_GENERAL,"","","1","false"),SettingItem("disablewbforpstn","1","2",GROUP_MEDIA,"No,Yes (check on first call),Yes (check always)","0,1,2","1","1"),SettingItem("storecallhistory","1","2",GROUP_GENERAL,"Local + Native,Local,Native,No history","0,1,2,3","1","1"),SettingItem("keepdeviceawakeincall","2","2",GROUP_GENERAL,"No,Basic only,Auto,Full then partial,Always full","0,1,2,3,4","1","2"),SettingItem("speakermode","0","2",GROUP_MEDIA,stringres.get("speakermode__auto")+","+stringres.get("speakermode__never")+","+stringres.get("speakermode__always"),"0,1,2","1","0"),SettingItem("focusaudio","1","2",GROUP_MEDIA,"Auto guess,No,Yes","0,1,2","1","1"),SettingItem("useroutingapi","0","2",GROUP_MEDIA,"Auto,No,Yes","0,1,2","1","0"),SettingItem("integrateifwifionly","false","0",GROUP_INTEGRATE,"","","1","false"),SettingItem("nativefilterallow","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("nativefilterblock","","1",GROUP_INTEGRATE,"","","1",""),SettingItem("companyname","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("supportpageuri","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("proversioncallcount","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("magicnumber",SETT_MAGIC_NUMBER,"-1",GROUP_NOGROUP,"","","1",SETT_MAGIC_NUMBER),SettingItem("upgradesettfromdatabase","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("cfgvideo","4","2",GROUP_VIDEO,"Never,On Request,Ask,Autoaccept,Always","2,4,6,8,10","1","4"),SettingItem("video_profile","0","2",GROUP_VIDEO,"Auto,Low,Medium,High,Ultra,Extra","0,4,6,8,10,15","1","0"),SettingItem("cust_lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("lastautoprov","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("loglastusage","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("callfunctionsbtnusage","10,0,5,9,8,10,12,1,3,-2","-1",GROUP_NOGROUP,"","","1"),SettingItem("redial","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("vibrate","0","2",GROUP_GENERAL,"Auto,Never,Always","0,1,2","1","0"),SettingItem("video_fps","0","1",GROUP_VIDEO,"","","1","0"),SettingItem("setfinalcodec","1","2",GROUP_MEDIA,stringres.get("setfinalcodec__never")+","+stringres.get("setfinalcodec__auto")+","+stringres.get("setfinalcodec__multiple_codec")+","+stringres.get("setfinalcodec__always"),"0,1,2,3","1","1"),SettingItem("use_rport","1","2",GROUP_SIP,stringres.get("use_rport__no")+","+stringres.get("use_rport__simmetric_nat")+","+stringres.get("use_rport__always")+","+stringres.get("use_rport__public_ip")+","+stringres.get("use_rport__request"),"0,1,2,3,9","1","1"),SettingItem("natopenpackets","2","1",GROUP_SIP,"","","1","2"),SettingItem("video_accept_checkbox","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webrtc_successfulcalls","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("wasrated","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("lastratedate","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("hidemyidentity","false","0",GROUP_SIP,"","","1","false"),SettingItem("last_transfer_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_conference_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_forward_number","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("validprovisioning","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("jsscriptevent","2","-1",GROUP_NOGROUP,"","","1","2"),SettingItem("devicetype",""+DEVICE_WEBPHONE(),"-1",GROUP_NOGROUP,"","","1",""+DEVICE_WEBPHONE()),SettingItem("extraoption","","1",GROUP_GENERAL,"","","1",""),SettingItem("enginepriority_java","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_webrtc","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_ns","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_flash","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_app","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_p2p","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_accessnum","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_nativedial","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("enginepriority_otherbrowser","2","2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2"),SettingItem("engineoldavailable_java","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_webrtc","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_ns","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_flash","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_app","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_p2p","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_accessnum","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("engineoldavailable_nativedial","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("lastusedengine","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("ignoreengineselect","false","-1",GROUP_NOGROUP,"","","1","false");var z="";!isNull(GetConfig("pc_alternatebrowserurl"))&&GetConfig("pc_alternatebrowserurl").length>0&&(z=Trim(GetConfig("pc_alternatebrowserurl"))),SettingItem("pc_alternatebrowserurl",z,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("lccnr","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("vdnr","0","-1",GROUP_NOGROUP,"","","1","0");var K=""
;!isNull(GetConfig("ios_nativedialerurl"))&&GetConfig("ios_nativedialerurl").length>0&&(K=Trim(GetConfig("ios_nativedialerurl"))),SettingItem("ios_nativedialerurl",K,"-1",GROUP_NOGROUP,"","","1","");var X="";!isNull(GetConfig("android_nativedialerurl"))&&GetConfig("android_nativedialerurl").length>0&&(X=Trim(GetConfig("android_nativedialerurl"))),SettingItem("android_nativedialerurl",X,"-1",GROUP_NOGROUP,"","","1","");var J="";!isNull(GetConfig("showsynccontactsmenu"))&&GetConfig("showsynccontactsmenu").length>0&&(J=Trim(GetConfig("showsynccontactsmenu"))),SettingItem("showsynccontactsmenu",J,"-1",GROUP_NOGROUP,"","","1","");var Y="";!isNull(GetConfig("accessnumber"))&&GetConfig("accessnumber").length>0&&(Y=Trim(GetConfig("accessnumber"))),SettingItem("accessnumber",Y,"-1",GROUP_NOGROUP,"","","1","");var Q="0";!isNull(GetConfig("colortheme"))&&GetConfig("colortheme").length>0&&(Q=Trim(GetConfig("colortheme"))),SettingItem("theme",Q,"2",GROUP_GENERAL,"Webphone,Light Blue,Light Green,Light Orange,Light Purple,Dark Red,Yellow,Blue,Purple,Turquoise,Light Skin,Green Orange,Custom 1,Custom 2,Custom 3,Custom 4,Custom 5","0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,18,19","1","0");var Z="-1";!isNull(GetConfig("useloginpage"))&&GetConfig("useloginpage").length>0&&(Z=Trim(GetConfig("useloginpage"))),SettingItem("useloginpage",Z,"-1",GROUP_NOGROUP,"","","1","-1");var ee="4";!isNull(GetConfig("featureset"))&&GetConfig("featureset").length>0&&(ee=Trim(GetConfig("featureset"))),SettingItem("featureset",ee,"-1",GROUP_NOGROUP,"","","1",ee),SettingItem("wsusers","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("mainconfigs","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("notifications2","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("canshowlickeyinput","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("normalizenumber","-1","2",GROUP_CALLDIVERT,stringres.get("normalizenumber__auto")+","+stringres.get("normalizenumber__no")+","+stringres.get("normalizenumber__yes"),"-1,0,1","1","-1");var te="";!isNull(GetConfig("callforwardonbusy"))&&GetConfig("callforwardonbusy").length>0&&(te=Trim(GetConfig("callforwardonbusy"))),SettingItem("callforwardonbusy",te,"1",GROUP_CALLDIVERT,"","","1","");var oe="";!isNull(GetConfig("callforwardonnoanswer"))&&GetConfig("callforwardonnoanswer").length>0&&(oe=Trim(GetConfig("callforwardonnoanswer"))),SettingItem("callforwardonnoanswer",oe,"1",GROUP_CALLDIVERT,"","","1","");var ne="15";!isNull(GetConfig("callforwardonnoanswertimeout"))&&GetConfig("callforwardonnoanswertimeout").length>0&&(ne=Trim(GetConfig("callforwardonnoanswertimeout"))),SettingItem("callforwardonnoanswertimeout",ne,"1",GROUP_CALLDIVERT,"","","1","");var ie="";!isNull(GetConfig("callforwardalways"))&&GetConfig("callforwardalways").length>0&&(ie=Trim(GetConfig("callforwardalways"))),SettingItem("callforwardalways",ie,"1",GROUP_CALLDIVERT,"","","1","");var re="";!isNull(GetConfig("calltransferalways"))&&GetConfig("calltransferalways").length>0&&(re=Trim(GetConfig("calltransferalways"))),SettingItem("calltransferalways",re,"1",GROUP_CALLDIVERT,"","","1","");var ae="0";!isNull(GetConfig("autoignore"))&&GetConfig("autoignore").length>0&&(ae=Trim(GetConfig("autoignore"))),SettingItem("autoignore",ae,"2",GROUP_CALLDIVERT,stringres.get("autoignore__dont")+","+stringres.get("autoignore__silently")+","+stringres.get("autoignore__reject"),"0,1,2","1","0");var se="false";!isNull(GetConfig("autoaccept"))&&GetConfig("autoaccept").length>0&&(se=Trim(GetConfig("autoaccept"))),SettingItem("autoaccept",se,"0",GROUP_CALLDIVERT,"","","1","false"),SettingItem("filters","","5",GROUP_CALLDIVERT,"","","1",""),SettingItem("blocked_contacts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("usemizutlsproxy","1","-1",GROUP_NOGROUP,"No,Auto,Yes","0,1,2","1",""),SettingItem("usemizutlsproxy_userreload","","-1",GROUP_NOGROUP,"","0,1,2","1",""),SettingItem("notification_count2","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("autostart","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("displaypeerdetails","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("rejectonbusy","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("voicerecupload","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsessionsuccess","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("codec","-1","3",GROUP_MEDIA,"Optimal,PCMU,PCMA,GSM,iLBC,SPEEX,SPEEX-WB,G.729,Opus,OpusWB,OpusUWB","-1,1,2,3,4,5,6,8,10,11,13","1","-1"),GetCodecsFromApiParam(),SettingItem("videocodec","-1","3",GROUP_MEDIA,"Optimal,H264,VP8,VP9","-1","1","-1"),SettingItem("use_h264","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp8","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("use_vp9","true","0",GROUP_MEDIA,"","","1","true"),SettingItem("blacklist","","1",GROUP_CALLDIVERT,"","","1",""),SettingItem("sel_rtc_audio_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_audio_out","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("sel_rtc_video_in","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1");var le=GetConfigInt("conferencetype",1);SettingItem("conferencetype",le.toString(),"2",GROUP_CALLDIVERT,stringres.get("conferencetype__disabled")+","+stringres.get("conferencetype__auto")+","+stringres.get("conferencetype__native")+","+stringres.get("conferencetype__server")+","+stringres.get("conferencetype__3way")+","+stringres.get("conferencetype__cr_msg_ref")+","+stringres.get("conferencetype__cr_msg")+","+stringres.get("conferencetype__cr_ref"),"0,1,2,3,4,5,6,7","1",le.toString()),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1","");var ce="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&(ce=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",ce,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var ue="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&(ue=Trim(GetConfig("video"))),SettingItem("video",ue,"2",GROUP_MEDIA,stringres.get("video__auto")+","+stringres.get("video__disable")+","+stringres.get("video__enable")+","+stringres.get("video__force"),"-1,0,1,2","1","1");var me="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(me=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",me,"1",GROUP_MEDIA,"","","1","0");var ge="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(ge=Trim(GetConfig("video_width"))),SettingItem("video_width",ge,"1",GROUP_MEDIA,"","","1","640");var de="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(de=Trim(GetConfig("video_height"))),SettingItem("video_height",de,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var pe="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(pe=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(pe="false"),SettingItem("has_video",pe,"1",GROUP_MEDIA,"","","1",pe),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var he="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(he=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",he,"2",GROUP_CALLDIVERT,stringres.get("transfwithreplace__auto")+","+stringres.get("transfwithreplace__no")+","+stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("acceptcall_onsharedevice","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6");var fe="1";!isNull(GetConfig("multilinegui"))&&GetConfig("multilinegui").length>0&&(fe=Trim(GetConfig("multilinegui"))),SettingItem("multilinegui",fe,"-1",GROUP_NOGROUP,"","","1",fe),SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("autosrvupgrade","1","-1",GROUP_NOGROUP,"","","1","1"),SettingItem("srvupgrade_count","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("srvupgrade_version","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("srvupgrade_currversion","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srvupgrade_currversion_extcmd_test","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_exe_version","0","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("srv_java_version","0","-1",GROUP_NOGROUP,"","","1","-1");var be="1";0==GetConfigBool("useaudiodevicerecord",!0)&&(be="0"),SettingItem("checkmicrophone",be,"-1",GROUP_NOGROUP,"","","1",be),SettingItem("fasthold","0","-1",GROUP_NOGROUP,"","","1","-1");SettingItem("calldivertchecksum",Md5Hash(te+oe+ie+ne),"-1",GROUP_NOGROUP,"","","1",""),SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("muteholdalllines","0","-1",GROUP_NOGROUP,"","","1","0");var ve="1";!isNull(GetConfig("allowcallredirect"))&&GetConfig("allowcallredirect").length>0&&(ve=Trim(GetConfig("allowcallredirect"))),SettingItem("allowcallredirect",ve,"-1",GROUP_NOGROUP,"","","1",ve);var _e="1";!isNull(GetConfig("playdtmfsound"))&&GetConfig("playdtmfsound").length>0&&(_e=Trim(GetConfig("playdtmfsound"))),SettingItem("playdtmfsound",_e,"-1",GROUP_NOGROUP,"","","1",_e);var Ee="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(Ee="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(Ee=Trim(GetConfig("language"))),SettingItem("language",Ee,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en"),SettingItem("chrome_local_alert_displayed","false","-1",GROUP_NOGROUP,"","","1","false");var Te=GetConfig("telsearchurl");!isNull(Te)&&Te.length>0&&SettingItem("telsearchkey","3606e399f2ec49f31831949efba6daf1","1",GROUP_GENERAL,"","","1","3606e399f2ec49f31831949efba6daf1");var Pe="1";!isNull(GetConfig("screensharing"))&&GetConfig("screensharing").length>0&&(Pe=Trim(GetConfig("screensharing"))),SettingItem("screensharing",Pe,"-1",GROUP_NOGROUP,"","","1",Pe),SettingItem("extraregisteraccounts","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lastsucc","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enproblem","0","-1",GROUP_NOGROUP,"","","1","0");var Se="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&(Se=Trim(GetConfig("audio_bandwidth"))),SettingItem("audio_bandwidth",Se,"1",GROUP_MEDIA,"","","1","0");var Ne="1";!isNull(GetConfig("enablepres_httpapi"))&&GetConfig("enablepres_httpapi").length>0&&(Ne=Trim(GetConfig("enablepres_httpapi"))),SettingItem("enablepres_httpapi",Ne,"-1",GROUP_NOGROUP,"","","1","1");var we="1";!isNull(GetConfig("enablepres_javaapi"))&&GetConfig("enablepres_javaapi").length>0&&(we=Trim(GetConfig("enablepres_javaapi"))),SettingItem("enablepres_javaapi",we,"-1",GROUP_NOGROUP,"","","1","1");var Ie="1";!isNull(GetConfig("enablepres_webrtc"))&&GetConfig("enablepres_webrtc").length>0&&(Ie=Trim(GetConfig("enablepres_webrtc"))),SettingItem("enablepres_webrtc",Ie,"-1",GROUP_NOGROUP,"","","1","1");var Ce="1";!isNull(GetConfig("incomingcallpopup"))&&GetConfig("incomingcallpopup").length>0&&(Ce=Trim(GetConfig("incomingcallpopup"))),SettingItem("incomingcallpopup",Ce,"2",GROUP_GENERAL,stringres.get("incomingcallpopup__no")+","+stringres.get("incomingcallpopup__auto")+","+stringres.get("incomingcallpopup__yes")+","+stringres.get("incomingcallpopup__always"),"0,1,2,3","1","1"),SettingItem("wpfirststart","true","-1",GROUP_NOGROUP,"","","1","true"),SettingItem("useragent","","-1",GROUP_NOGROUP,"","","1","");var Re="1";!isNull(GetConfig("allowsipuriasusername"))&&GetConfig("allowsipuriasusername").length>0&&(Re=Trim(GetConfig("allowsipuriasusername")));var ye=GetConfigInt("enabledirectcalls",-5);ye>=0&&(Re=ye.toString()),SettingItem("allowsipuriasusername",Re,"-1",GROUP_NOGROUP,"","","1","0");var Le="0";!isNull(GetConfig("beeponconnect"))&&GetConfig("beeponconnect").length>0&&(Le=Trim(GetConfig("beeponconnect"))),SettingItem("beeponconnect",Le,"-1",GROUP_NOGROUP,"","","1","0");var De="0";!isNull(GetConfig("disablepopups"))&&GetConfig("disablepopups").length>0&&(De=Trim(GetConfig("disablepopups"))),SettingItem("disablepopups",De,"-1",GROUP_NOGROUP,"","","1",De);var Ge="true";!isNull(GetConfig("showtoasts"))&&GetConfig("showtoasts").length>0&&(Ge=Trim(GetConfig("showtoasts"))),SettingItem("showtoasts",Ge,"-1",GROUP_NOGROUP,"","","1","true"),SettingItem("isfirstcallfwd","true","-1",GROUP_NOGROUP,"","","1","true");var xe="0";!isNull(GetConfig("beeponincoming"))&&GetConfig("beeponincoming").length>0&&(xe=Trim(GetConfig("beeponincoming"))),SettingItem("beeponincoming",xe,"0",GROUP_GENERAL,"","","1","0");var Oe="2";!isNull(GetConfig("flash"))&&GetConfig("flash").length>0&&(Oe=Trim(GetConfig("flash"))),SettingItem("flash",Oe,"0",GROUP_GENERAL,"","","1","2");var Ae="1";!isNull(GetConfig("importonlywithnum"))&&GetConfig("importonlywithnum").length>0&&(Ae=Trim(GetConfig("importonlywithnum"))),SettingItem("importonlywithnum",Ae,"2",GROUP_GENERAL,stringres.get("importonlywithnum__no")+","+stringres.get("importonlywithnum__yes"),"0,1","1","1");var ke="2";!isNull(GetConfig("videomode"))&&GetConfig("videomode").length>0&&(ke=Trim(GetConfig("importonlywithnum"))),SettingItem("videomode",ke,"2",GROUP_MEDIA,stringres.get("videomode__always")+","+stringres.get("videomode__noask")+","+stringres.get("videomode__askonce")+","+stringres.get("videomode__alwaysask")+","+stringres.get("videomode__disable"),"1,2,3,4,5","1","2");var Ue="2";!isNull(GetConfig("sscontrol"))&&GetConfig("sscontrol").length>0&&(Ue=Trim(GetConfig("sscontrol"))),SettingItem("sscontrol",Ue,"0",GROUP_SCRSHARE,"","","1","2");var Ve="2";!isNull(GetConfig("ssscroll"))&&GetConfig("ssscroll").length>0&&(Ve=Trim(GetConfig("ssscroll"))),SettingItem("ssscroll",Ve,"0",GROUP_SCRSHARE,"","","1","2");var We="1";!isNull(GetConfig("sstop"))&&GetConfig("sstop").length>0&&(We=Trim(GetConfig("sstop"))),SettingItem("sstop",We,"0",GROUP_SCRSHARE,"","","1","1");var Me="2";!isNull(GetConfig("ssquality"))&&GetConfig("ssquality").length>0&&(Me=Trim(GetConfig("ssquality"))),SettingItem("ssquality",Me,"2",GROUP_SCRSHARE,stringres.get("ssquality__low")+","+stringres.get("ssquality__medium")+","+stringres.get("ssquality__high"),"1,2,3","1","2");var Fe="";!isNull(GetConfig("bundlepolicy"))&&GetConfig("bundlepolicy").length>0&&(Fe=Trim(GetConfig("bundlepolicy"))),SettingItem("bundlepolicy",Fe,"-1",GROUP_NOGROUP,"","","1",Fe);var He="";!isNull(GetConfig("icecandidatepoolsize"))&&GetConfig("icecandidatepoolsize").length>0&&(He=Trim(GetConfig("icecandidatepoolsize"))),SettingItem("icecandidatepoolsize",He,"-1",GROUP_NOGROUP,"","","1",He);var je="";!isNull(GetConfig("icetransportpolicy"))&&GetConfig("icetransportpolicy").length>0&&(je=Trim(GetConfig("icetransportpolicy"))),SettingItem("icetransportpolicy",je,"-1",GROUP_NOGROUP,"","","1",je);var Be="0";!isNull(GetConfig("displayvideodevice"))&&GetConfig("displayvideodevice").length>0&&(Be=Trim(GetConfig("displayvideodevice"))),SettingItem("displayvideodevice",Be,"-1",GROUP_NOGROUP,"","","1",Be);var $e="30000";!isNull(GetConfig("wskeepaliveival"))&&GetConfig("wskeepaliveival").length>0&&($e=Trim(GetConfig("wskeepaliveival"))),SettingItem("wskeepaliveival",$e,"-1",GROUP_NOGROUP,"","","1",$e);var qe="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(qe=Trim(GetConfig("enableblf"))),SettingItem("enableblf",qe,"-1",GROUP_SIP,"","","1",qe);var ze="";!isNull(GetConfig("profilestatustext"))&&GetConfig("profilestatustext").length>0&&(ze=Trim(GetConfig("profilestatustext"))),SettingItem("profilestatustext",ze,"1",GROUP_PROFILE,"","","1",ze);var Ke="0";!isNull(GetConfig("share_location"))&&GetConfig("share_location").length>0&&(Ke=Trim(GetConfig("share_location"))),SettingItem("share_location",Ke,"2",GROUP_PROFILE,stringres.get("share_location__no")+","+stringres.get("share_location__yes"),"0,1","1",Ke);var Xe="";!isNull(GetConfig("profilepicture"))&&GetConfig("profilepicture").length>0&&(Xe=Trim(GetConfig("profilepicture"))),SettingItem("profilepicture",Xe,"1",GROUP_PROFILE,"","","1",Xe),SettingItem("profilehistory","","-1",GROUP_NOGROUP,"","","1","");var Je="1";!isNull(GetConfig("p2psignaling"))&&GetConfig("p2psignaling").length>0&&(Je=Trim(GetConfig("p2psignaling"))),SettingItem("p2psignaling",Je,"-1",GROUP_NOGROUP,"","","1",Je),SettingItem("nsupdate","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("lastwpapixxx","","-1",GROUP_NOGROUP,"","","1","");var Ye="1";!isNull(GetConfig("androidspeaker"))&&GetConfig("androidspeaker").length>0&&(Ye=Trim(GetConfig("androidspeaker"))),SettingItem("androidspeaker",Ye,"2",GROUP_MEDIA,stringres.get("androidspeaker__def")+","+stringres.get("androidspeaker__before_fcall")+","+stringres.get("androidspeaker__after_fcall")+","+stringres.get("androidspeaker__atstart"),"0,1,2,3","1",Ye),msg=[],msg.push("w"),msg.push("s"),msg.push("s"),msg.push(":"),msg.push("/"),msg.push("/"),msg.push("d"),msg.push("e"),msg.push("m"),msg.push("o"),msg.push("s"),msg.push("."),msg.push("k"),msg.push("a"),msg.push("a"),msg.push("z"),msg.push("i"),msg.push("n"),msg.push("g"),msg.push("."),msg.push("c"),msg.push("o"),msg.push("m"),msg.push("/"),msg.push("e"),msg.push("c"),msg.push("h"),msg.push("o"),msg.push(","),msg.push("w"),msg.push("s"),msg.push("s"),msg.push(":"),msg.push("/"),msg.push("/"),msg.push("e"),msg.push("c"),msg.push("h"),msg.push("o"),msg.push("."),msg.push("w"),msg.push("e"),msg.push("b"),msg.push("s"),msg.push("o"),msg.push("c"),msg.push("k"),msg.push("e"),msg.push("t"),msg.push("."),msg.push("o"),msg.push("r"),msg.push("g"),msg.push(","),msg.push("w"),msg.push("s"),msg.push("s"),msg.push(":"),msg.push("/"),msg.push("/"),msg.push("w"),msg.push("e"),msg.push("b"),msg.push("s"),msg.push("o"),msg.push("c"),msg.push("k"),msg.push("e"),msg.push("t"),msg.push("s"),msg.push("t"),msg.push("e"),msg.push("s"),msg.push("t"),msg.push("."),msg.push("c"),msg.push("o"),msg.push("m"),msg.push(":"),msg.push("4"),msg.push("4"),msg.push("3"),msg.push("/"),msg.push("s"),msg.push("e"),msg.push("r"),msg.push("v"),msg.push("i"),msg.push("c"),msg.push("e"),msg.push(","),msg.push("w"),msg.push("s"),msg.push("s"),msg.push(":"),msg.push("/"),msg.push("/"),msg.push("l"),msg.push("i"),msg.push("b"),msg.push("w"),msg.push("e"),msg.push("b"),msg.push("s"),msg.push("o"),msg.push("c"),msg.push("k"),msg.push("e"),msg.push("t"),msg.push("s"),msg.push("."),msg.push("o"),msg.push("r"),msg.push("g");var Qe=msg.join("");SettingItem("wstestservers",Qe,"-1",GROUP_NOGROUP,"","","1",Qe),SettingItem("lastgood_wstest","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("domaintoip_cache","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_clientreset","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("last_clientresetall","-1","-1",GROUP_NOGROUP,"","","1","-1");var Ze="1";!isNull(GetConfig("alwaysallowlowcodec"))&&GetConfig("alwaysallowlowcodec").length>0&&(Ze=Trim(GetConfig("alwaysallowlowcodec"))),SettingItem("alwaysallowlowcodec",Ze,"2",GROUP_MEDIA,stringres.get("alwaysallowlowcodec__never")+","+stringres.get("alwaysallowlowcodec__auto")+","+stringres.get("alwaysallowlowcodec__always"),"0,1,2","1",Ze);var et="90";!isNull(GetConfig("keeprecfiles"))&&GetConfig("keeprecfiles").length>0&&(et=Trim(GetConfig("keeprecfiles"))),SettingItem("keeprecfiles",et,"1",GROUP_GENERAL,"","","1",et);var tt="0";!isNull(GetConfig("sipprotocol"))&&GetConfig("sipprotocol").length>0&&(tt=Trim(GetConfig("sipprotocol"))),SettingItem("sipprotocol",tt,"-1",GROUP_NOGROUP,"","","1",tt),SettingItem("resetsettings","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("wphoneappurl","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("needunregister","true","-1",GROUP_NOGROUP,"","","1","true");var ot="-1";!isNull(GetConfig("holdtype"))&&GetConfig("holdtype").length>0&&(ot=Trim(GetConfig("holdtype"))),SettingItem("holdtype",ot,"2",GROUP_CALLDIVERT,stringres.get("holdtype__never")+","+stringres.get("holdtype__auto")+","+stringres.get("holdtype__no")+","+stringres.get("holdtype__notused")+","+stringres.get("holdtype__hold")+","+stringres.get("holdtype__otherparty")+","+stringres.get("holdtype__both"),"-2,-1,0,1,2,3,4","1",ot);var nt="0";!isNull(GetConfig("colorizelog"))&&GetConfig("colorizelog").length>0&&(nt=Trim(GetConfig("colorizelog"))),SettingItem("colorizelog",nt,"-1",GROUP_NOGROUP,"","","1",nt);var it="1";!isNull(GetConfig("forcereregister"))&&GetConfig("forcereregister").length>0&&(it=Trim(GetConfig("forcereregister"))),SettingItem("forcereregister",it,"-1",GROUP_NOGROUP,"","","1",it);var rt="0";!isNull(GetConfig("enablepush"))&&GetConfig("enablepush").length>0&&(rt=Trim(GetConfig("enablepush"))),SettingItem("enablepush",rt,"2",GROUP_GENERAL,stringres.get("enablepush__auto")+","+stringres.get("enablepush__no")+","+stringres.get("enablepush__yes"),"-1,0,1","1",rt);var at="-1";!isNull(GetConfig("callreceiver"))&&GetConfig("callreceiver").length>0&&(at=Trim(GetConfig("callreceiver"))),SettingItem("callreceiver",at,"-1",GROUP_NOGROUP,stringres.get("callreceiver__auto")+","+stringres.get("callreceiver__noincoming")+","+stringres.get("callreceiver__enablewhilerunning")+","+stringres.get("callreceiver__enablebackgroud"),"-1,0,1,2","1",at),SettingItem("appinstalltime",GetTickCount().toString(),"-1",GROUP_NOGROUP,"","","1",GetTickCount().toString()),SettingItem("lastincalltime","0","-1",GROUP_NOGROUP,"","","1","0");var qe="1";!isNull(GetConfig("enableblf"))&&GetConfig("enableblf").length>0&&(qe=Trim(GetConfig("enableblf"))),SettingItem("enableblf",qe,"2",GROUP_SIP,stringres.get("enableblf__no")+","+stringres.get("enableblf__auto")+","+stringres.get("enableblf__always")+","+stringres.get("enableblf__must"),"0,1,2,3","1",qe),SettingItem("firststart_webrtc","true","-1",GROUP_NOGROUP,"","","1","true");var st="2";!isNull(GetConfig("dropsameoldcall"))&&GetConfig("dropsameoldcall").length>0&&(st=Trim(GetConfig("dropsameoldcall"))),SettingItem("dropsameoldcall",st,"2",GROUP_CALLDIVERT,stringres.get("dropsameoldcall__no")+","+stringres.get("dropsameoldcall__requested")+","+stringres.get("dropsameoldcall__reqvideo")+","+stringres.get("dropsameoldcall__forall"),"0,1,2,3","1",st),SettingItem("wseverconnected","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("sortcontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("filtercontacts","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("lastfilterval","0","-1",GROUP_NOGROUP,"","","1","0");var lt="";!isNull(GetConfig("serveraddressbook_url"))&&GetConfig("serveraddressbook_url").length>0&&(lt=Trim(GetConfig("serveraddressbook_url"))),SettingItem("serveraddressbook_url",lt,"-1",GROUP_NOGROUP,"","","1",lt);var ct="0";!isNull(GetConfig("serveraddressbook_sync"))&&GetConfig("serveraddressbook_sync").length>0&&(ct=Trim(GetConfig("serveraddressbook_sync"))),SettingItem("serveraddressbook_sync",ct,"-1",GROUP_NOGROUP,"","","1",ct),SettingItem("serveraddressbook_status","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("last_good_webrtc_gw","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("last_login_failed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("startpage_disp_count","0","-1",GROUP_NOGROUP,"","","1","0");var ut="false";!isNull(GetConfig("mustconnect"))&&GetConfig("mustconnect").length>0&&(ut=Trim(GetConfig("mustconnect"))),SettingItem("mustconnect",ut,"-1",GROUP_NOGROUP,"","","1",ut),SettingItem("reloadalertdisplayed","false","-1",GROUP_NOGROUP,"","","1","false");var mt="1";!isNull(GetConfig("networkchecks"))&&GetConfig("networkchecks").length>0&&(mt=Trim(GetConfig("networkchecks"))),SettingItem("networkchecks",mt,"-1",GROUP_NOGROUP,"","","1",mt);var gt="0";!isNull(GetConfig("qrcode_login"))&&GetConfig("qrcode_login").length>0&&(gt=Trim(GetConfig("qrcode_login"))),SettingItem("qrcode_login",gt,"-1",GROUP_NOGROUP,"","","1",gt);var dt="2000";!isNull(GetConfig("icetimeout"))&&GetConfig("icetimeout").length>0&&(dt=Trim(GetConfig("icetimeout"))),SettingItem("icetimeout",dt,"1",GROUP_SIP,"","","1",dt);var pt="1";!isNull(GetConfig("normalize_contact"))&&GetConfig("normalize_contact").length>0&&(pt=Trim(GetConfig("normalize_contact"))),SettingItem("normalize_contact",pt,"1",GROUP_SIP,"","","1",pt);var ht="300";!isNull(GetConfig("nspollinterval"))&&GetConfig("nspollinterval").length>0&&(ht=Trim(GetConfig("nspollinterval"))),SettingItem("nspollinterval",ht,"-1",GROUP_NOGROUP,"","","1",ht),SettingItem("cache_audio_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_device_list","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_play_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_audio_ring_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("cache_video_rec_curr_device","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("lnsengine","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("cancelonnsdownload","0","-1",GROUP_NOGROUP,"","","1","0");var ft="0";!isNull(GetConfig("autogenpassword"))&&GetConfig("autogenpassword").length>0&&(ft=Trim(GetConfig("autogenpassword"))),SettingItem("autogenpassword",ft,"-1",GROUP_NOGROUP,"","","1",ft);var bt="2";!isNull(GetConfig("appengine_startat"))&&GetConfig("appengine_startat").length>0&&(bt=Trim(GetConfig("appengine_startat"))),SettingItem("appengine_startat",bt,"-1",GROUP_NOGROUP,"","","1",bt);var vt="";!isNull(GetConfig("customautoprov_url"))&&GetConfig("customautoprov_url").length>0&&(vt=Trim(GetConfig("customautoprov_url"))),SettingItem("customautoprov_url",vt,"-1",GROUP_NOGROUP,"","","1",vt);var _t="1";!isNull(GetConfig("customautoprov_when"))&&GetConfig("customautoprov_when").length>0&&(_t=Trim(GetConfig("customautoprov_when"))),SettingItem("customautoprov_when",_t,"-1",GROUP_NOGROUP,"","","1",_t);var Et="1";!isNull(GetConfig("customautoprov_repeat"))&&GetConfig("customautoprov_repeat").length>0&&(Et=Trim(GetConfig("customautoprov_repeat"))),SettingItem("customautoprov_repeat",Et,"-1",GROUP_NOGROUP,"","","1",Et),SettingItem("custautoprov_exectimes","0","-1",GROUP_NOGROUP,"","","1","0"),58===GetConfigInt("brandid",-1)&&(SaveParameter("dtmfmode","1"),SaveParameter("aec","0"),SaveParameter("agc","0"),SaveParameter("silencesupress","0"),SaveParameter("voicemailnum","*97")),SaveParameter("code_version",global.code_version)}catch(Tt){PutToDebugLogException(2,"common: InitializeSettings",Tt)}}function DoVersioning(){try{var e=GetParameterInt("code_version",0);if(PutToDebugLog(2,"EVENT, common: DoVersioning called, oldversion: "+e),!isNull(e)&&IsNumber(e)||(e=0),e<global.code_version){if(GetConfig("autoprovisioning").length<1||"0"===GetConfig("autoprovisioning")||"false"===GetConfig("autoprovisioning")||!1===GetConfig("autoprovisioning")){var t=GetParameter("customizedversion");!isNull(GetConfig("customizedversion"))&&GetConfig("customizedversion").length>0&&(t=Trim(GetConfig("customizedversion"))),SettingItem("customizedversion",t,"-1",GROUP_NOGROUP,"","","1","true");var o=GetParameter("serveraddress");!isNull(GetConfig("serveraddress"))&&GetConfig("serveraddress").length>0&&(o=Trim(GetConfig("serveraddress"))),SettingItem("serveraddress",o,"-1",GROUP_NOGROUP,"","","1","");var n=GetParameter("server_label");!isNull(GetConfig("server_label"))&&GetConfig("server_label").length>0&&(n=Trim(GetConfig("server_label"))),SettingItem("server_label",n,"-1",GROUP_NOGROUP,"","","1","Server");var i=GetParameter("showserverinput");!isNull(GetConfig("showserverinput"))&&GetConfig("showserverinput").length>0&&(i=Trim(GetConfig("showserverinput"))),SettingItem("showserverinput",i,"-1",GROUP_NOGROUP,"","","1","1");var r=GetParameter("brandname");!isNull(GetConfig("brandname"))&&GetConfig("brandname").length>0&&(r=Trim(GetConfig("brandname"))),SettingItem("brandname",r,"-1",GROUP_NOGROUP,"","","1","");var a=GetParameter("brandid");!isNull(GetConfig("brandid"))&&GetConfig("brandid").length>0&&(r=Trim(GetConfig("brandid"))),SettingItem("brandid",a,"-1",GROUP_NOGROUP,"","","1","");var s=GetParameter("companyname");!isNull(GetConfig("companyname"))&&GetConfig("companyname").length>0&&(s=Trim(GetConfig("companyname"))),SettingItem("companyname",s,"-1",GROUP_NOGROUP,"","","1","");var l=GetParameter("newuser");!isNull(GetConfig("newuser"))&&GetConfig("newuser").length>0&&(l=Trim(GetConfig("newuser"))),SettingItem("newuser",l,"-1",GROUP_NOGROUP,"","","1","");var c=GetParameter("homepage");!isNull(GetConfig("homepage"))&&GetConfig("homepage").length>0&&(c=Trim(GetConfig("homepage"))),SettingItem("homepage",c,"-1",GROUP_NOGROUP,"","","1","");var u=GetParameter("accounturi");!isNull(GetConfig("accounturi"))&&GetConfig("accounturi").length>0&&(u=Trim(GetConfig("accounturi"))),SettingItem("accounturi",u,"-1",GROUP_NOGROUP,"","","1","");var m=GetParameter("recharge");!isNull(GetConfig("recharge"))&&GetConfig("recharge").length>0&&(m=Trim(GetConfig("recharge"))),SettingItem("recharge",m,"-1",GROUP_NOGROUP,"","","1","");var g=GetParameter("p2p");!isNull(GetConfig("p2p"))&&GetConfig("p2p").length>0&&(g=Trim(GetConfig("p2p"))),SettingItem("p2p",g,"1",GROUP_CALLDIVERT,"","","1","");var d=GetParameter("callback");!isNull(GetConfig("callback"))&&GetConfig("callback").length>0&&(d=Trim(GetConfig("callback"))),SettingItem("callback",d,"1",GROUP_CALLDIVERT,"","","1","");var p=GetParameter("sms");!isNull(GetConfig("sms"))&&GetConfig("sms").length>0&&(p=Trim(GetConfig("sms"))),SettingItem("sms",p,"1",GROUP_CALLDIVERT,"","","1","");var h=GetParameter("sms_recieve");!isNull(GetConfig("sms_recieve"))&&GetConfig("sms_recieve").length>0&&(h=Trim(GetConfig("sms_recieve"))),SettingItem("sms_recieve",h,"-1",GROUP_NOGROUP,"","","1","");var f=GetParameter("creditrequest");!isNull(GetConfig("creditrequest"))&&GetConfig("creditrequest").length>0&&(f=Trim(GetConfig("creditrequest"))),SettingItem("creditrequest",f,"1",GROUP_CALLDIVERT,"","","1","");var b=GetParameter("ratingrequest");!isNull(GetConfig("ratingrequest"))&&GetConfig("ratingrequest").length>0&&(b=Trim(GetConfig("ratingrequest"))),SettingItem("ratingrequest",b,"1",GROUP_CALLDIVERT,"","","1","");var v=GetParameter("supportmail");!isNull(GetConfig("supportmail"))&&GetConfig("supportmail").length>0&&(v=Trim(GetConfig("supportmail"))),SettingItem("supportmail",v,"-1",GROUP_NOGROUP,"","","1","");var _=GetParameter("supporturl");!isNull(GetConfig("supporturl"))&&GetConfig("supporturl").length>0&&(_=Trim(GetConfig("supporturl"))),SettingItem("supporturl",_,"-1",GROUP_NOGROUP,"","","1","");var E=GetParameter("header");!isNull(GetConfig("header"))&&GetConfig("header").length>0&&(E=Trim(GetConfig("header"))),E.length<1&&!isNull(GetConfig("headertext"))&&GetConfig("headertext").length>0&&(E=GetConfig("headertext")),SettingItem("header",E,"-1",GROUP_NOGROUP,"","","1","");var T="";!isNull(GetConfig("footer"))&&GetConfig("footer").length>0&&(T=Trim(GetConfig("footer"))),T.length<1&&!isNull(GetConfig("footertext"))&&GetConfig("footertext").length>0&&(T=GetConfig("footertext")),SettingItem("footer",T,"-1",GROUP_NOGROUP,"","","1","");var P=GetParameter("logo");!isNull(GetConfig("logo"))&&GetConfig("logo").length>0&&(P=Trim(GetConfig("logo"))),SettingItem("logo",P,"-1",GROUP_NOGROUP,"","","1","");var S=GetParameter("version")
;!isNull(GetConfig("version"))&&GetConfig("version").length>0&&(S=Trim(GetConfig("version"))),SettingItem("version",S,"-1",GROUP_NOGROUP,"","","1","");var N=GetParameter("messagedisplay");!isNull(GetConfig("messagedisplay"))&&GetConfig("messagedisplay").length>0&&(N=Trim(GetConfig("messagedisplay"))),SettingItem("messagedisplay",N,"-1",GROUP_NOGROUP,"","","1","");var w=GetParameter("messagepopup");!isNull(GetConfig("messagepopup"))&&GetConfig("messagepopup").length>0&&(w=Trim(GetConfig("messagepopup"))),SettingItem("messagepopup",w,"-1",GROUP_NOGROUP,"","","1","");var I=GetParameter("advertisement");!isNull(GetConfig("advertisement"))&&GetConfig("advertisement").length>0&&(I=Trim(GetConfig("advertisement"))),SettingItem("advertisement",I,"-1",GROUP_NOGROUP,"","","1","");var C=GetParameter("helpurl");!isNull(GetConfig("helpurl"))&&GetConfig("helpurl").length>0&&(C=Trim(GetConfig("helpurl"))),SettingItem("helpurl",C,"-1",GROUP_NOGROUP,"","","1","");var R=GetParameter("licenseurl");!isNull(GetConfig("licenseurl"))&&GetConfig("licenseurl").length>0&&(R=Trim(GetConfig("licenseurl"))),SettingItem("licenseurl",R,"-1",GROUP_NOGROUP,"","","1","");var y=GetParameter("extramenuurl");!isNull(GetConfig("extramenuurl"))&&GetConfig("extramenuurl").length>0&&(y=Trim(GetConfig("extramenuurl"))),SettingItem("extramenuurl",y,"-1",GROUP_NOGROUP,"","","1","");var L=GetParameter("extramenutxt");!isNull(GetConfig("extramenutxt"))&&GetConfig("extramenutxt").length>0&&(L=Trim(GetConfig("extramenutxt"))),SettingItem("extramenutxt",L,"-1",GROUP_NOGROUP,"","","1","")}if(e<12){var D=GetParameter("username"),G=GetParameter("password"),x=GetParameter("serveraddress_orig"),O=GetParameter("serveraddress_user"),A=GetParameter("proxyaddress"),k=GetParameter("sipusername"),U=GetParameter("displayname"),V=GetParameter("email"),W=GetParameter("voicemailnum"),M=GetParameter("callforwardonbusy"),F=GetParameter("wsusers");for(var H in settmap)delete settmap[H];PutToDebugLog(2,"WARNING, DoVersioning, Initializesettings, because older version"),HandleSettings("","",function(){}),SaveParameter("username",D),SaveParameter("password",G),SaveParameter("serveraddress_orig",x),SaveParameter("serveraddress_user",O),SaveParameter("proxyaddress",A),SaveParameter("sipusername",k),SaveParameter("displayname",U),SaveParameter("email",V),SaveParameter("voicemailnum",W),SaveParameter("callforwardonbusy",M),SaveParameter("wsusers",F)}if(e<13){var j="";!isNull(GetConfig("rtmpserveraddress"))&&GetConfig("rtmpserveraddress").length>0&&(j=Trim(GetConfig("rtmpserveraddress"))),SettingItem("rtmpserveraddress",j,"-1",GROUP_NOGROUP,"","","1",""),SettingItem("audiodevices","","8",GROUP_MEDIA,"","","1",""),SettingItem("autoaction","0","-1",GROUP_NOGROUP,"","","1","0"),SettingItem("webcallme","1","-1",GROUP_NOGROUP,"","","1","1");var B="";!isNull(GetConfig("callbacknumber"))&&GetConfig("callbacknumber").length>0&&(B=Trim(GetConfig("callbacknumber"))),SettingItem("callbacknumber",B,"1",GROUP_CALLDIVERT,"","","1",""),SettingItem("received_confrooms","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("iswebrtcuppersrvfromuser","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("java_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("ns_worked","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("webrtc_worked","false","-1",GROUP_NOGROUP,"","","1","false");var $="-1";!isNull(GetConfig("video"))&&GetConfig("video").length>0&&($=Trim(GetConfig("video"))),SettingItem("video",$,"2",GROUP_MEDIA,stringres.get("video__auto")+","+stringres.get("video__disable")+","+stringres.get("video__enable")+","+stringres.get("video__force"),"-1,0,1,2","1","1");var q="0";!isNull(GetConfig("video_bandwidth"))&&GetConfig("video_bandwidth").length>0&&(q=Trim(GetConfig("video_bandwidth"))),SettingItem("video_bandwidth",q,"1",GROUP_MEDIA,"","","1","0");var z="640";!isNull(GetConfig("video_width"))&&GetConfig("video_width").length>0&&(z=Trim(GetConfig("video_width"))),SettingItem("video_width",z,"1",GROUP_MEDIA,"","","1","640");var K="480";!isNull(GetConfig("video_height"))&&GetConfig("video_height").length>0&&(K=Trim(GetConfig("video_height"))),SettingItem("video_height",K,"1",GROUP_MEDIA,"","","1","480"),SettingItem("androidchromedisplayed","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("conf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("transf_engineswitcheoffered","false","-1",GROUP_NOGROUP,"","","1","false"),SettingItem("filterchatduplicates","true","-1",GROUP_NOGROUP,"","","1","true");var X="true";!isNull(GetConfig("has_video"))&&GetConfig("has_video").length>0&&(X=Trim(GetConfig("has_video"))),"0"===GetParameter2("video")&&(X="false"),SettingItem("has_video",X,"1",GROUP_MEDIA,"","","1",X),SettingItem("sendchatonenter","true","0",GROUP_GENERAL,"","","1","true");var J="-1";!isNull(GetConfig("transfwithreplace"))&&GetConfig("transfwithreplace").length>0&&(J=Trim(GetConfig("transfwithreplace"))),SettingItem("transfwithreplace",J,"2",GROUP_CALLDIVERT,stringres.get("transfwithreplace__auto")+","+stringres.get("transfwithreplace__no")+","+stringres.get("transfwithreplace__yes"),"-1,0,1","1","-1"),SettingItem("showratewhiletype_minlenth","3","-1",GROUP_NOGROUP,"","","1","3"),SettingItem("showratewhiletype_maxlenth","6","-1",GROUP_NOGROUP,"","","1","6")}if(e<14&&(SettingItem("enginechecksum","","-1",GROUP_NOGROUP,"","","1",""),SettingItem("redialonfail","1","-1",GROUP_NOGROUP,"","","1","1")),e<15){var Y="1";0==GetConfigBool("useaudiodevicerecord",!0)&&(Y="0"),SettingItem("checkmicrophone",Y,"-1",GROUP_NOGROUP,"","","1",Y),SettingItem("calldivertsuccess","-1","-1",GROUP_NOGROUP,"","","1","-1"),SettingItem("enginepriority_otherbrowser",GetParameter("enginepriority_otherbrowser"),"2",GROUP_SIP,"Disabled,Lower,Default,Higher,Highest,Force","0,1,2,3,4,5","1","2")}if(e<16){var Q="en";"rigitel"===GetConfig("brandname").toLowerCase()&&(Q="de"),isNull(GetConfig("language"))||2!==GetConfig("language").length||(Q=Trim(GetConfig("language"))),SettingItem("language",Q,"2",GROUP_GENERAL,"English,German,Hungarian,Portuguese","en,de,hu,pt","1","en");var Z=GetParameter("extraregisteraccounts");isNull(Z)&&(Z=""),SettingItem("extraregisteraccounts",Z,"-1",GROUP_NOGROUP,"","","1","");var ee="0";!isNull(GetConfig("audio_bandwidth"))&&GetConfig("audio_bandwidth").length>0&&(ee=Trim(GetConfig("audio_bandwidth"))),SettingItem("audio_bandwidth",ee,"1",GROUP_MEDIA,"","","1","0")}e<18&&SettingItem("normalizenumber",GetParameterInt("normalizenumber",-1).toString(),"2",GROUP_CALLDIVERT,stringres.get("normalizenumber__auto")+","+stringres.get("normalizenumber__no")+","+stringres.get("normalizenumber__yes"),"-1,0,1","1","-1")}SaveParameter("code_version",global.code_version)}catch(te){PutToDebugLogException(2,"_settings: DoVersioning",te)}}function SettingItem(e,t,o,n,i,r,a,s,l){try{if(isNull(e))return void PutToDebugLog(2,"WARNING, _settings: SettingItem invalid setting: "+e+", "+t+", "+o+", "+n+", "+i+", "+r+", "+a+", "+s);"DEF"===t?t=s:"NULL"===t&&(t="");var c=[];c[SETT_VALUE]=t,c[SETT_TYPE]=o,c[SETT_GROUP]=n,c[SETT_ALLNAMES]=i,c[SETT_ALLVALUES]=r,c[SETT_ISDEFAULT]=a,c[SETT_DEF_VALUE]=s,!0===l?settmap2[e]=c:settmap[e]=c}catch(u){PutToDebugLogException(2,"common: SettingItem",u)}}function ParamAsBool(e){try{if(isNull(e)||e.length<1)return!1;if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return!1;if(e.indexOf("true")>=0)return!0;if(IsNumber(e)){if(StrToInt(e)>0)return!0}}catch(t){PutToDebugLogException(2,"common: ParamAsBool",t)}return!1}function ParamAsInt(e,t){try{if(isNull(e)||e.length<1)return!isNull(t)&&IsNumber(t)?StrToInt(t):t;if(e=e.toString(),e=e.toLowerCase(),e.indexOf("false")>=0)return 0;if(e.indexOf("true")>=0)return 1;if(IsNumber(e))return StrToInt(e)}catch(o){PutToDebugLogException(2,"common: ParamAsInt",o)}return e}function GetParameter2(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLogSpecial(2,"WARNING, common: GetParameter2 no input param",!0,""),"";var o=webphone_api.parameters[e];return isNull(o)&&(o=GetParameter(e,t)),isNull(o)&&(o=""),o=o.toString(),0===o.indexOf("encrypted__3__")&&(o=StrDc(o,GetPassphrase())),"NULL"===o&&(o=""),isNull(o)&&(o=""),Trim(o)}catch(n){PutToDebugLogSpecial(2,"ERROR, common: GetParameter2",!0,n)}return""}function GetParameter(e,t){var o=0;try{if(isNull(e)||e.length<1)return o=2,PutToDebugLogSpecial(2,"WARNING, common: GetParameter no input param",!1,""),"";if((isNull(settmap2)||isNull(settmap2.magicnumber))&&"loglevel"!==e)return o=8,PutToDebugLogSpecial(6,"EVENT, common GetParameter no settings: "+e,!1,""),"";if(o=9,!(e in settmap2))return"";var n=settmap2[e];"serveraddress"===e&&(n[SETT_VALUE]=StripServeraddress(n[SETT_VALUE])),"username"!==e&&"sipusername"!==e||0===GetParameterInt("allowsipuriasusername",0)&&(n[SETT_VALUE]=StripUsername(n[SETT_VALUE]));var i;return i=isNull(t)||!0!==t?n[SETT_VALUE]:n[SETT_DEF_VALUE],o=10,isNull(i)||(i=i.toString(),0===i.indexOf("encrypted__3__")&&(i=StrDc(i,GetPassphrase()))),i}catch(r){PutToDebugLogSpecial(2,"common: GetParameter ("+o+"), parameter: "+e,!0,r)}return""}function ParameterIsDefault(e){try{if(isNull(e)||e.length<1)return 2,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no input param",!1,""),!1;if(isNull(settmap)||isNull(settmap.magicnumber))return 8,PutToDebugLogSpecial(2,"WARNING, common: ParameterIsDefault no settings param: "+e,!1,""),!1;if(9,!(e in settmap))return!1;return"1"===settmap[e][SETT_ISDEFAULT]}catch(t){PutToDebugLogSpecial(2,"ERROR, common: ParameterIsDefault",!0,t)}return!1}function GetParameterInt(e,t){function o(e){try{return void 0!==e&&null!=e&&(e=e.toString(),!(null==(e=e.replace(/\s+/g,""))||e.length<1)&&!isNaN(e))}catch(t){alert("ERROR, common: IsNumberInnerInt"+t)}return!1}try{if(isNull(t)||!o(t))return PutToDebugLogSpecial(3,"ERROR, GetParameterInt invalid default value",!0,""),-1e6;var n=GetParameter(e);if(isNull(n)||(n=n.toString()),!isNull(n)&&n.length>0){var i=null;return n=n.toLowerCase(),"true"===n||"yes"===n?i=1:"false"===n||"no"===n?i=0:o(Trim(n))&&(i=StrToInt(n)),isNull(i)?t:i}}catch(r){PutToDebugLogSpecial(2,"ERROR, common: GetParameterInt parameter: "+e,!0,r)}return t}function GetParameterBool(e,t){try{if(isNull(t)||"true"!==t.toString()&&"false"!==t.toString())return PutToDebugLog(3,"ERROR, GetParameterBool invalid default value"),"invalidbool";var o=GetParameter(e);if(!isNull(o)){var n=null;return o=o.toString(),o=o.toLowerCase(),"true"===o||"1"===o||"yes"===o?n=!0:"false"!==o&&"0"!==o&&"no"!==o||(n=!1),isNull(n)?t:n}}catch(i){PutToDebugLogException(3,"common: GetParameterBool parameter: "+e,i)}return t}function SaveParameter(e,t,o){try{if(isNull(e)||e.length<1)return PutToDebugLog(3,"WARNING, common: SaveParameter no input param"),!1;if(isNull(settmap))return PutToDebugLog(2,"WARNING, common: SaveParameter no settings"),!1;if(e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===t||"YOURSIPSERVER.COM"===t||"SIPSERVER"===t||"VOIPSERVER"===t||"SERVERADDRESS"===t)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===t||"SIPUSERNAME"===t)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===t||"SIPPASSWORD"===t||"SIPASSWORD"===t)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===t||"CALLTO"===t))return!1;if("lastsessionsuccess"===e&&GetParameter("lastsessionsuccess")===t)return;if(isNull(t)||(t=t.toString()),isNull(t)||0!==t.indexOf("encrypted__3__")||(t=StrDc(t,GetPassphrase())),"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress"),"webrtcserveraddress"===e)webphone_api.parameters.webrtcserveraddress=t,selectedwserver="";else{if("callto"===e)return webphone_api.parameters.callto=t,!0;if(("username"===e||"sipusername"===e)&&!isNull(t)&&t.indexOf("@")>0){if(0===GetParameterInt("allowsipuriasusername",0)){var n=settmap.serveraddress_user;n[SETT_VALUE]=Trim(t.substring(t.indexOf("@")+1)),settmap.serveraddress_user=n}}else if(e===Ssidcode()&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_1: "+t),!isNull(t)&&t.length>0&&unlockcodetricktogled<1)){var i=StrDc(unlockcodetrick,alsvkey);PutToDebugLog(2,"EVENT,"+Ssidcode()+"_2: "+i),Trim(t)===i&&(PutToDebugLog(2,"EVENT,"+Ssidcode()+"_3: "+t),unlockcodetricktogled=1)}}var r;if(e in settmap2){var a="0";r=settmap2[e],"DEF"===t?(t=r[SETT_DEF_VALUE],a="1"):"NULL"===t&&(t=""),r[SETT_VALUE]=t,r[SETT_ISDEFAULT]=a,settmap2[e]=r,global.wasSettModified=!0}else SettingItem(e,t,"-1","-1","","","0",t,!0),global.wasSettModified=!0;if(!0!==o)if(r=null,e in settmap){var a="0";r=settmap[e],"DEF"===t?(t=r[SETT_DEF_VALUE],a="1"):"NULL"===t&&(t=""),r[SETT_VALUE]=t,r[SETT_ISDEFAULT]=a,settmap[e]=r,global.wasSettModified=!0}else SettingItem(e,t,"-1","-1","","","0",t),global.wasSettModified=!0;return"extraregisteraccounts"===e&&ParseSipAccounts(),!0}catch(s){PutToDebugLogException(3,"common: SaveParameter",s)}return!1}function Ssidcode(){if(null!==ssidcode_string)return ssidcode_string;var e=[];return e.push("s"),e.push("s"),e.push("i"),e.push("d"),e.push("c"),e.push("o"),e.push("d"),e.push("e"),ssidcode_string=e.join("")}function GetConfig(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLog(3,"WARNING, common: GetConfig no input param"),"";isNull(t)&&(t=!0);var o=mwphonecfg.get(e);return isNull(o)?(PutToDebugLog(3,"WARNING, common: GetConfig value is NULL"),""):(t&&GetPassphrase().length>0&&(o=StrDc(o,GetPassphrase())),"serveraddress"===e&&(o=StripServeraddress(o)),"username"!==e&&"sipusername"!==e||(o=StripUsername(o)),o)}catch(n){PutToDebugLogException(3,"common: GetConfig",n)}return""}function GetConfigInt(e,t){try{if(isNull(t)||!IsNumber(t))return PutToDebugLog(3,"ERROR, GetConfigInt invalid default value"),-1e6;var o=GetConfig(e);if(!isNull(o)&&o.length>0){var n=null;return o=o.toLowerCase(),"true"===o||"yes"===o?n=1:"false"===o||"no"===o?n=0:IsNumber(Trim(o))&&(n=StrToInt(o)),isNull(n)?t:n}}catch(i){PutToDebugLogException(3,"common: GetConfigInt parameter: "+e,i)}return t}function GetConfigBool(e,t){try{if(isNull(t)||"true"!==t.toString()&&"false"!==t.toString())return PutToDebugLog(3,"ERROR, GetParameterBool invalid default value"),"invalidbool";var o=GetConfig(e);if(!isNull(o)){var n=null;return"true"===o.toLowerCase()||"1"===o||"yes"===o.toLowerCase()?n=!0:"false"!==o.toLowerCase()&&"0"!==o&&"no"!==o.toLowerCase()||(n=!1),isNull(n)?t:n}}catch(i){PutToDebugLogException(3,"common: GetConfigBool parameter: "+e,i)}return t}function SaveSettingsFile(e,t){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveSettingsFile do not save because preferred_storage is 0"),void t(!0);if(global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return PutToDebugLog(2,"EVENT, SaveSettingsFile DO NOT SAVE, flag delsett is: "+global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1)),void t(!0);if(!t||"function"!=typeof t)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: SaveSettingsFile filename is NULL"),t(!1),!1;if(isNull(settmap)||isNull(settmap.magicnumber))return PutToDebugLog(2,"ERROR, common: SaveSettingsFile no setings to be saved"),t(!1),!1;global.dispSaveSettMsg++,global.dispSaveSettMsg<3&&PutToDebugLog(2,"EVENT, SaveSettingsFile filename: "+e);var o="",n="";if(!0===GetParameterBool("serverinputisupperserver",!1)){var i=GetParameter("upperserver"),r=GetParameter("serveraddress_user");if((i.length<0||r.indexOf(".")>0)&&ShowServerInput()){var a=GetConfigInt("upperserverfromuser",2),s=GetConfig("upperserver");a<2&&s.length>0?SaveParameter("upperserver",s):SaveParameter("upperserver",r),global.wasSettModified=!1}}for(var l in settmap)if(!(isNull(l)||l.length<1)&&"clientreset"!==l&&"clientresetall"!==l){var c=settmap[l];o=o+l+";"+c[SETT_VALUE]+";"+c[SETT_TYPE]+";"+c[SETT_GROUP]+";"+c[SETT_ALLNAMES]+";"+c[SETT_ALLVALUES]+";"+c[SETT_ISDEFAULT]+";"+c[SETT_DEF_VALUE]+"\r\n","username"!==l&&"sipusername"!==l&&"password"!==l&&"serveraddress_user"!==l&&"serveraddress_orig"!==l&&"upperserver"!==l&&"loglevel"!==l&&"code_version"!==l&&"lastusedengine"!==l||(n=n+l+";"+c[SETT_VALUE]+"\r\n")}if(global.dispSaveSettMsg<3&&PutToDebugLog(2,"EVENT, SaveSettingsFile save coockie backup = "+n),isNull(global.File))return PutToDebugLog(2,"EVENT, SaveSettingsFile File handling module not loaded yet"),t(!1),!1;global.File.SaveFile(e+"_backup",n,global.STORAGE_COOKIE,function(e){global.dispSaveSettMsg<3&&PutToDebugLog(3,"EVENT, SaveSettingsFile save coockie backup: "+e.toString())}),IsWindowsSoftphone()?ApiWinSaveFile(e,o,function(e){t(!0)}):global.File.SaveFile(e,o,global.STORAGE_LOCAL,function(e){t(!0)})}catch(u){PutToDebugLogException(2,"common: SaveSettingsFile",u)}}function ReadSettingsFile(e,t){try{if(PutToDebugLogSpecial(3,"EVENT, common ReadSettingsFile called; filename: "+e,!1,""),!t||"function"!=typeof t)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile callback not defined");if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, common: ReadSettingsFile filename is NULL");if(isNull(global.File))return PutToDebugLog(2,"ERROR, ReadSettingsFile File handling module not loaded yet"),t(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===settdeleted&&(settdeleted=!0,global.File.DeleteAllCookies(),global.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file resetsettings: "+GetActiveAccSettingsFilename()+" result: "+e)})),PutToDebugLog(2,"EVENT, ReadSettingsFile not read because resetsettings"),InitializeSettings(),t(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(e,function(o){o+="",(isNull(o)||Trim(o).length<2||"null"==o)&&(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content WinApi"),global.File.ReadFile(e+"_backup",global.STORAGE_COOKIE,function(o){(isNull(o)||Trim(o).length<1)&&(o=""),PutToDebugLog(2,"READ contentfromcookie WinApi = "+HideClearPassword(o)),HandleSettings("",e,t);var n=o.split("\r\n");(isNull(n)||n.length<1)&&(n=[]);for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<2||n[i].indexOf(";")<0)){var r=n[i].indexOf(";");if(!(r<1)){var a=Trim(n[i].substring(0,r)),s=Trim(n[i].substring(r+1));SaveParameter(a,s)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie WinApi: "+o)})),HandleSettings(o,e,t)}):global.File.ReadFile(e,global.STORAGE_LOCAL,function(o){isNull(o)||Trim(o).length<1?(PutToDebugLog(4,"EVENT, common: ReadSettingsFile no content"),global.File.ReadFile(e+"_backup",global.STORAGE_COOKIE,function(o){(isNull(o)||Trim(o).length<1)&&(o=""),PutToDebugLog(2,"READ contentfromcookie = "+HideClearPassword(o)),HandleSettings("",e,t);var n=o.split("\r\n");(isNull(n)||n.length<1)&&(n=[]);for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<2||n[i].indexOf(";")<0)){var r=n[i].indexOf(";");if(!(r<1)){var a=Trim(n[i].substring(0,r)),s=Trim(n[i].substring(r+1));"lastusedengine"===a?s.length>0&&(SaveParameter(a,s),global.last_used_engine_cache=s):SaveParameter(a,s)}}PutToDebugLog(2,"EVENT, common: ReadSettingsFile important settings restored from cookie: "+HideClearPassword(o))})):HandleSettings(o,e,t)})}catch(o){PutToDebugLogException(2,"common: ReadSettingsFile",o)}}function ClientReset(e,t,o,n){try{if(!0===global.flagclientreset)return;if((isNull(o)||o.length<1)&&(o=!0===IsSDK()?GetSettFilenameSDK():GetActiveAccSettingsFilename()),!0===n){global.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),global.chlist=[],global.recentlist=[];var i=GetParameter("messagefiles");if(!isNull(i)){for(var r=i.split(","),a=0;a<r.length;a++)if(!(isNull(r[a])||r[a].length<3)){var s=r[a].indexOf("[#");s>0&&(r[a]=r[a].substring(0,s)),global.File.DeleteFile(r[a],function(e){PutToDebugLog(3,"EVENT, ClientReset DeleteFile: "+r[a]+" status: "+e.toString())})}SaveParameter("messagefiles","")}var l=GetConfig("brandid");(isNull(l)||l.length<1||"-1"==l)&&(l=GetBrandName().toLowerCase()),global.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, ClientReset delete accounts file result: "+e)}),global.aclist=[],global.File.DeleteFile(global.CONTACTS_FILENAME+l,function(e){PutToDebugLog(2,"EVENT, ClientReset delete contacts file result: "+e)}),global.ctlist=[]}!isNull(o)&&o.length>0&&(global.flagclientreset=!0,global.flag_delsett=1,global.File.DeleteAllCookies(),global.File.DeleteFile(filename,function(o){PutToDebugLog(2,"EVENT, ClientReset delete settings file result: "+o),global.flag_delsett=0,HandleSettings("","",function(){}),global.flagclientreset=!1,SaveParameter("last_clientreset",e),SaveParameter("last_clientresetall",t),!1===IsSDK()&&OpenSettings(!0,1)}))}catch(c){PutToDebugLogException(2,"common: ClientReset",c)}}function HandleSettings(e,t,o){try{if(PutToDebugLogSpecial(1,"EVENT,HandleSettings",!1,""),isNull(settmap))settmap={};else for(var n in settmap)delete settmap[n];if(isNull(settmap2))settmap2={};else for(var n in settmap2)delete settmap2[n];InitializeSettings();var i=mwphonecfg.getAll();if(!isNull(i)){PutToDebugLog(3,"EVENT,HandleSettings cfg");for(var r in i)if(!(isNull(r)||r.length<1||r.indexOf("overwrite_")>=0)){var a=i[r];"NULL"===a&&(a=""),SaveParameter(r,a)}}var s=e.split("\r\n");if(isNull(s)||s.length<1)PutToDebugLog(2,"ERROR, common: ParseSettingsReadFromFile empty content");else if(e.indexOf("magicnumber")<0&&e.length>30)PutToDebugLog(3,"ERROR, common ParseSettingsReadFromFile settings file is corrupt"),global.File.DeleteAllCookies(),global.File.DeleteFile(t,function(e){PutToDebugLog(2,"EVENT, ParseSettingsReadFromFile delete settings file result: "+e)});else{PutToDebugLog(3,"EVENT,HandleSettings file");for(var l=!1,c=!1,u="",m="",g="",d="",p="",h="",f=-1,b=-1,v=0;v<s.length;v++)if(!(isNull(s[v])||s[v].length<2||s[v].indexOf(";")<0)){var _=s[v].split(";");isNull(_)||8!==_.length||("serveraddress"===_[0]&&(u=_[1]),"webrtcserveraddress"===_[0]&&(m=_[1]),"upperserver"===_[0]&&(g=_[1]),"proxyaddress"===_[0]&&(d=_[1]),"lastsettcrc"===_[0]&&(p=_[1]),"last_clientreset"===_[0]&&IsNumber(_[1])&&(f=StrToInt(_[1])),"last_clientresetall"===_[0]&&IsNumber(_[1])&&(b=StrToInt(_[1])))}!isNull(webphone_api.parameters.last_clientreset)&&IsNumber(webphone_api.parameters.last_clientreset)&&(f=StrToInt(webphone_api.parameters.last_clientreset)),!isNull(webphone_api.parameters.last_clientresetall)&&IsNumber(webphone_api.parameters.last_clientresetall)&&(b=StrToInt(webphone_api.parameters.last_clientresetall));var E=-1,T=-1;if(!isNull(webphone_api.parameters.clientreset)&&IsNumber(webphone_api.parameters.clientreset)&&(E=StrToInt(webphone_api.parameters.clientreset)),!isNull(webphone_api.parameters.clientresetall)&&IsNumber(webphone_api.parameters.clientresetall)&&(T=StrToInt(webphone_api.parameters.clientresetall)),T>b&&(ClientReset(E,T,t,!0),l=!0),E>f&&(ClientReset(E,T,t,!1),l=!0),!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>0&&(u=webphone_api.parameters.serveraddress),!isNull(webphone_api.parameters.webrtcserveraddress)&&webphone_api.parameters.webrtcserveraddress.length>0&&(m=webphone_api.parameters.webrtcserveraddress),!isNull(webphone_api.parameters.upperserver)&&webphone_api.parameters.upperserver.length>0&&(g=webphone_api.parameters.upperserver),!isNull(webphone_api.parameters.proxyaddress)&&webphone_api.parameters.proxyaddress.length>0&&(d=webphone_api.parameters.proxyaddress),isNull(u)&&(u=""),isNull(m)&&(m=""),isNull(g)&&(g=""),isNull(d)&&(d=""),isNull(p)&&(p=""),h=Md5Hash(u+m+g+d),p.length>0&&!isNull(h)&&h!==p&&(c=!0,PutToDebugLog(2,"WARNING, HandleSettings: key settings changed, omit them from local storage")),setTimeout(function(){SaveParameter("lastsettcrc",h)},500),!1===l)for(var P="",S="",N="",w="",I="",C="",R="",y="",L=0;L<s.length;L++)if(!(isNull(s[L])||s[L].length<2||s[L].indexOf(";")<0)){var D=s[L].split(";");isNull(D)?PutToDebugLog(2,"WARNING, common ReadSettingsFile can't parse setting: "+s[L]):8===D.length||"get"===D[0]||"getAll"===D[0]?(P=D[0],(!0!==c||"serveraddress"!==P&&"serveraddress_orig"!==P&&"serveraddress_user"!==P&&"webrtcserveraddress"!==P&&"upperserver"!==P&&"proxyaddress"!==P&&"realm"!==P&&"lastsettcrc"!==P)&&(S=D[1],N=D[2],w=D[3],I=D[4],C=D[5],R=D[6],y=D[7],SettingItem(P,S,N,w,I,C,R,y),"loglevel"===P&&SettingItem(P,S,N,w,I,C,R,y,!0),P="",S="",N="",w="",I="",C="",R="",y="")):PutToDebugLog(2,"WARNING, common ReadSettingsFile broken or invalid setting after parse; length: "+D.length)}}if(!isNull(i))for(var r in i)if(!(isNull(r)||r.length<1||r.indexOf("overwrite_")<0)){r=r.replace("overwrite_","");var a=i[r];"NULL"===a&&(a=""),SaveParameter(r,a)}for(var n in settmap)isNull(n)||n.length<1||(settmap2[n]=settmap[n]);if(!isNull(webphone_api.parameters)){for(var n in webphone_api.parameters)if(!(isNull(n)||n.length<1||"codec"===n)){var S=webphone_api.parameters[n];if(isNull(S)&&(S=""),"object"==typeof S)try{S=JSON.stringify(S)}catch(O){}S=isNull(S)?"":S.toString(),S.length<1||0===n.indexOf("ucfg_")&&!isNull(GetParameter(n))&&GetParameter(n).length>0||(n=n.replace("ucfg_",""),"NULL"===S&&(S=""),"webrtcserver"!==n&&"webrtcaddress"!==n&&"rtcserver"!==n&&"rtcaddress"!==n||(n="webrtcserveraddress"),"loglevel"===n?!isNull(StrToInt(S))&&StrToInt(S)>1&&SaveParameter(n,S,!0):SaveParameter(n,S,!0),"username"!==n||"undefined"!=typeof webphone_api.parameters.sipusername&&null!==webphone_api.parameters.sipusername?"sipusername"!==n||"undefined"!=typeof webphone_api.parameters.username&&null!==webphone_api.parameters.username||SaveParameter("username",S,!0):SaveParameter("sipusername",S,!0))}var G=webphone_api.parameters.serveraddress;!isNull(G)&&G.length>1&&(SaveParameter("serveraddress",G,!0),SaveParameter("serveraddress_user",G,!0),SaveParameter("serveraddress_orig",G,!0)),GetCodecsFromApiParam()}GetSettingsFromUrl();var x=GetParameter("serveraddress");return!isNull(x)&&x.length>0&&SaveParameter("serveraddress",NormalizeInput(x,0)),x=GetParameter("serveraddress_user"),!isNull(x)&&x.length>0&&SaveParameter("serveraddress_user",NormalizeInput(x,0)),x=GetParameter("serveraddress_orig"),!isNull(x)&&x.length>0&&SaveParameter("serveraddress_orig",NormalizeInput(x,0)),x=GetParameter("webrtcserveraddress"),!isNull(x)&&x.length>0&&SaveParameter("webrtcserveraddress",NormalizeInput(x,0)),x=GetParameter("turnserveraddress"),!isNull(x)&&x.length>0&&SaveParameter("turnserveraddress",NormalizeInput(x,0)),x=GetParameter("sipusername"),!isNull(x)&&x.length>0&&SaveParameter("sipusername",NormalizeInput(x,0)),x=GetParameter("username"),!isNull(x)&&x.length>0&&SaveParameter("username",NormalizeInput(x,0)),SetLanguage(),SetCurrTheme(),HandleScurlSetparameters(),ParseSipAccounts(),void o(!0)}catch(A){PutToDebugLog(2,"EVENT, common: HandleSettings er1")}HandleScurlSetparameters(),ParseSipAccounts(),o(!1)}function GetSettingsFromUrl(){var e=!1;try{var t=window.location.href,o="",n="",i="";if(isNull(t)||t.length<1)return;t=decodeURIComponent(t),t=Trim(t),PutToDebugLog(3,"EVENT, GetSettingsFromUrl url: "+t);var r=t.indexOf("?");if(r<0)return;t=t.substring(r+1,t.length),r=t.indexOf("#page_"),r>0&&(t=t.substring(0,r));for(var a=0;t.length>3&&a<100;){a++,r=t.indexOf("&"),r<0&&(r=t.length);var s=t.substring(0,r);if(t=t.substring(r,t.length),0===t.indexOf("&")&&(t=t.substring(1,t.length)),!(isNull(s)||s.length<1))if(s=Trim(s),(r=s.indexOf("="))<1)PutToDebugLog(3,"EVENT, GetSettingsFromUrl invalid settings: "+s);else{var l=Trim(s.substring(0,r)),c=Trim(s.substring(r+1,s.length));c=StrDc(c,"1AzbNh5FdLT9m"),"platform"!==l||"windesktop"!==c?0===l.indexOf("wp_")&&((l.indexOf("serveraddres")>0||l.indexOf("username")>0||l.indexOf("sipusername")>0||l.indexOf("password")>0)&&(global.sipaccounts=[],SaveSipAccounts()),l=l.substring(l.indexOf("wp_")+3,l.length),"brandnamestr"===l&&c.length>0?l="brandname":"resetsettings"===l&&c.length>0&&("1"===c.toLowerCase()||"true"===c.toLowerCase())?e=!0:"serveraddress"===l&&c.length>0&&(SaveParameter("iswebrtcuppersrvfromuser","true",!0),SaveParameter("serveraddress_user",Trim(c),!0),SaveParameter("serveraddress_orig",Trim(c),!0)),"video"===l&&!0===CanIUseWebRTC()&&(PutToDebugLog(2,"WARNING, Enginepriority_WebRTC is set manually to 4 because video is forced"),SaveParameter("enginepriority_webrtc","4")),"callto"===l&&!isNull(c)&&c.length>0?o=c:"sendchat"===l&&!isNull(c)&&c.length>0?n=c:"to"===l&&!isNull(c)&&c.length>0?i=c:SaveParameter(l,Trim(c),!0)):(l="devicetype",c=""+DEVICE_WIN_SOFTPHONE(),SaveParameter(l,c,!0))}}if(!0===e)return PutToDebugLog(2,"EVENT, mlogic Delsettings GetSettingsFromUrl"),void webphone_api.delsettings(2);(isNull(o)||o.length<1)&&(o=GetParameter("callto")),!isNull(o)&&o.length>0&&!1===autocall_called&&(autocall_called=!0,global.aua_handled=!0,setTimeout(function(){3===GetParameterInt("autoaction",0)?(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction video call to: "+o),PutToDebugLog(2,"EVENT, mlogic API_VideoCall GetSettingsFromUrl"),webphone_api.videocall(decodeURIComponent(o))):(PutToDebugLog(2,"EVENT,GetSettingsFromUrl initiate autoaction call to: "+o),PutToDebugLog(2,"EVENT, mlogic API_Call GetSettingsFromUrl"),webphone_api.call(decodeURIComponent(o)))},200)),!isNull(n)&&n.length>0&&!isNull(i)&&i.length>0&&!1===sendchat_called&&(sendchat_called=!0,global.aua_handled=!0,setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_SendChat GetSettingsFromUrl"),webphone_api.sendchat(decodeURIComponent(i),decodeURIComponent(n))},200))}catch(u){PutToDebugLogException(2,"common: GetSettingsFromUrl",u)}}function GetOverWriteSettings(){try{var e=mwphonecfg.getAll();if(isNull(e))return;for(var t in e)isNull(t)||t.length<1||t.indexOf("overwrite_")<0||(t=t.replace("overwrite_",""),SaveParameter(t,e[t]))}catch(o){PutToDebugLogException(2,"common: GetOverWriteSettings",o)}}function OpenSettings(e,t){try{3===t&&(common.getuseengine()===global.ENGINE_SERVICE||common.getuseengine()===global.ENGINE_WEBPHONE)||8===t?PutToDebugLog(2,"EVENT, mlogic OpenSettings: "+t):(PutToDebugLog(2,"EVENT, mlogic API_Unregister OpenSettings: "+t),webphone_api.unregister(),PutToDebugLog(2,"EVENT, mlogic API_Stop OpenSettings: "+t),webphone_api.stop()),!1===IsSDK()&&(isNull(e)||!0!==e||(global.intentsettings[0]="startedfrom=app"),void 0!==j$&&null!==j$&&"undefined"!=typeof j$.mobile&&null!==j$.mobile&&j$.mobile.changePage("#page_settings",{transition:"pop",role:"page"})),IsWindowsSoftphone()||"Android"===GetOs()||setTimeout(function(){ChooseEngineLogic(function(){PutToDebugLog(3,"ChooseEngineLogic called on goind to settings page")},!1)},350)}catch(o){PutToDebugLogException(2,"common: OpenSettings",o)}}function GetIntentParam(e,t){try{if(isNull(e)||isNull(t))return"";if(t=Trim(t),e.length<1||t.length<1)return"";for(var o=0;o<e.length;o++)if(!isNull(e[o])&&0===e[o].indexOf(t)&&e[o].indexOf("=")>0){var n=e[o].substring(e[o].indexOf("=")+1);return Trim(n)}}catch(i){PutToDebugLogException(2,"common: GetIntentParam",i)}return""}function SaveContactsFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveContactsFile do not save because preferred_storage is 0"),void e(!0);if(global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveContactsFile DO NOT SAVE, flag delsett is: "+global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveContactsFile callback not defined");if(isNull(global.ctlist))return PutToDebugLog(2,"EVENT, SaveContactsFile no contacts to be saved"),e(!1),!1;if(isNull(global.File))return PutToDebugLog(2,"EVENT, SaveContactsFile File handling module not loaded yet"),e(!1),!1;for(var t="",o=null,n=0;n<global.ctlist.length;n++)if(o=global.ctlist[n],!isNull(o)){var i=o[CT_EMAIL],r=o[CT_ADDRESS],a=o[CT_NOTES],s=o[CT_WEBSITE],l=o[CT_LASTACTIVE],c=o[CT_ISFROMSYNC];isNull(i)&&(i=""),isNull(r)&&(r=""),isNull(a)&&(a=""),isNull(s)&&(s=""),
(isNull(l)||l.length<1||!1===IsNumber(l))&&(l="0"),(isNull(c)||c.length<1||!1===IsNumber(c))&&(c="1"),t=t+o[CT_NAME]+",[",t=t+o[CT_NUMBER].join(";")+"],[",t=t+o[CT_PTYPE].join(";")+"],",t=t+o[CT_USAGE]+","+o[CT_LASTMODIF]+","+o[CT_DELFLAG]+","+o[CT_FAV]+","+i+","+r+","+a+","+s+","+l+","+c+"\r\n"}var u=GetConfig("brandid");(isNull(u)||u.length<1||"-1"==u)&&(u=GetBrandName().toLowerCase()),IsWindowsSoftphone()?ApiWinSaveFile(global.CONTACTS_FILENAME+u,t,function(t){global.wereCtModified=!1,e(!0)}):global.File.SaveFile(global.CONTACTS_FILENAME+u,t,global.STORAGE_LOCAL,function(t){global.wereCtModified=!1,e(t)})}catch(m){PutToDebugLogException(2,"common: SaveContactsFile",m)}}function ReadContactsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadContactsFile callback not defined");if(isNull(global.File))return PutToDebugLog(2,"EVENT, ReadContactsFile File handling module not loaded yet"),e(!1),!1;var t=GetConfig("brandid");if((isNull(t)||t.length<1||"-1"==t)&&(t=GetBrandName().toLowerCase()),!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===contactsdeleted&&(contactsdeleted=!0,global.File.DeleteFile(global.CONTACTS_FILENAME+t,function(e){PutToDebugLog(2,"EVENT, delete contacts file resetsettings result: "+e)}),global.ctlist=[]),PutToDebugLog(2,"EVENT, ReadContactsFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(global.CONTACTS_FILENAME+t,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content WinApi"),e(!1),!1;ParseContactsReadFromFile(t,!0,e)}):global.File.ReadFile(global.CONTACTS_FILENAME+t,global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadContactsFile no content"),e(!1),!1;ParseContactsReadFromFile(t,!0,e)})}catch(o){PutToDebugLogException(2,"common: ReadContactsFile",o)}}function ParseContactsReadFromFile(e,t,o){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsReadFromFile empty content"),o(!1),!1;if(!0===t&&!isNull(global.ctlist))for(var i in global.ctlist)delete global.ctlist[i];for(var r="",a="",s=0;s<n.length;s++)if(isNull(n[s])||n[s].length<2||n[s].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact (1): "+n[s]);else if(r=n[s].split(","),a="",a=r[CT_NUMBER],isNull(a)||a.length<2||a.indexOf("[")<0)PutToDebugLog(2,"EVENT, common ParseContactsReadFromFile broken or invalid contact: (2)"+n[s]);else{a=a.substring(1,a.length-1);var l=a.split(";");if(isNull(l)&&(l=[]),a="",a=r[CT_PTYPE],isNull(a)||a.length<2||a.indexOf("[")<0)PutToDebugLog(2,"WARNING, common ParseContactsReadFromFile broken or invalid contact: (3)"+n[s]);else{a=a.substring(1,a.length-1);var c=a.split(";");isNull(c)&&(c=[]);var u=r[CT_EMAIL],m=r[CT_ADDRESS],g=r[CT_NOTES],d=r[CT_WEBSITE],p="0";r.length>CT_LASTACTIVE&&(p=r[CT_LASTACTIVE]);var h="1";r.length>CT_ISFROMSYNC&&(h=r[CT_ISFROMSYNC]),isNull(u)&&(u=""),isNull(m)&&(m=""),isNull(g)&&(g=""),isNull(d)&&(d="");var f=[];f[CT_NAME]=r[CT_NAME],f[CT_NUMBER]=l,f[CT_PTYPE]=c,f[CT_USAGE]=r[CT_USAGE],f[CT_LASTMODIF]=r[CT_LASTMODIF],f[CT_DELFLAG]=r[CT_DELFLAG],f[CT_FAV]=r[CT_FAV],f[CT_EMAIL]=u,f[CT_ADDRESS]=m,f[CT_NOTES]=g,f[CT_WEBSITE]=d,f[CT_LASTACTIVE]=p,f[CT_ISFROMSYNC]=h,global.ctlist.push(f)}}SortContacts(),o(!0)}catch(b){PutToDebugLogException(2,"common: ParseContactsReadFromFile",b)}}function ParseContactsFromServer(e,t,o){try{var n=e.split("\r\n");if(isNull(n)||n.length<1)return PutToDebugLog(2,"ERROR, common: ParseContactsFromServer empty content"),o(!1),!1;if(!0===t&&!isNull(global.ctlist))for(var i in global.ctlist)delete global.ctlist[i];for(var r="",a=0;a<n.length;a++)if(isNull(n[a])||n[a].length<2||n[a].indexOf(",")<0)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+a.toString()+"] (1): "+n[a]);else if(r=n[a].split(","),isNull(r)||r.length<7)PutToDebugLog(2,"EVENT, common ParseContactsFromServer broken or invalid contact ["+a.toString()+"] (2): "+n[a]);else{var s=r[0];isNull(s)&&(s=""),s=Trim(s);for(var l=[],c=[],u=1;u<=5;){var m=r[u];!isNull(m)&&m.length>0&&(m=ReplaceAll(m," ",""),m=ReplaceAll(m,"-",""),m=ReplaceAll(m,"(",""),m=ReplaceAll(m,")",""),l.indexOf(m)<0&&(l.push(r[u]),!0===IsNumeric(r[u],"+")&&r[u].length>6?c.push("phone"):c.push("sip"))),u++}var g=[];g[CT_NAME]=s,g[CT_NUMBER]=l,g[CT_PTYPE]=c,g[CT_USAGE]="0",g[CT_LASTMODIF]="0",g[CT_DELFLAG]="0",g[CT_FAV]="0",g[CT_EMAIL]="",g[CT_ADDRESS]="",g[CT_NOTES]="",g[CT_WEBSITE]="",g[CT_LASTACTIVE]="0",g[CT_ISFROMSYNC]="1",global.ctlist.push(g)}SortContacts(),o(!0)}catch(d){PutToDebugLogException(2,"common: ParseContactsFromServer",d)}}function GetContacts(e){try{isNull(global.ctlist)||global.ctlist.length<1||common.GetParameter("lastfilterval")!==common.GetParameter("filtercontacts")?ReadContactsFile(function(t){SortContacts(),e&&e(t)}):global.wasCtModified?(SortContacts(),e&&e(!0)):e&&e(!0)}catch(t){PutToDebugLogException(2,"common: GetContacts",t)}}function SortContacts(){try{var e=GetParameterInt("sortcontacts",0);0===e?global.ctlist.sort(function(e,t){return e[CT_NAME].toLowerCase()<t[CT_NAME].toLowerCase()?-1:e[CT_NAME].toLowerCase()>t[CT_NAME].toLowerCase()?1:0}):1===e?global.ctlist.sort(function(e,t){return StrToInt(e[CT_USAGE])<StrToInt(t[CT_USAGE])?1:StrToInt(e[CT_USAGE])>StrToInt(t[CT_USAGE])?-1:0}):2===e&&global.ctlist.sort(function(e,t){for(var o=0,n=0,i=0;i<e[CT_NUMBER].length;i++){var r=global.presenceHM[e[CT_NUMBER][i]];if(!isNull(r)&&"5"===r[PRES_STATUS]){o=5;break}}for(var a=0;a<t[CT_NUMBER].length;a++){var s=global.presenceHM[e[CT_NUMBER][a]];if(!isNull(s)&&"5"===s[PRES_STATUS]){n=5;break}}return o<n?1:o>n?-1:0})}catch(t){PutToDebugLogException(2,"common: SortContacts",t)}}function UpdateContactLastActive(e){try{if(isNull(e)||e.length<1)return;var t=GetContactIdFromNumber(e);if(t>=0){var o=global.ctlist[t];o[CT_LASTACTIVE]=GetTickCount().toString(),global.ctlist[t]=o}}catch(n){PutToDebugLogException(2,"common: UpdateContactLastActive",n)}}function GetContactIdFromNumber(e){var t=-1;try{if(isNull(e)||Trim(e).length<1||isNull(global.ctlist)||global.ctlist.length<1)return-1;e=Trim(e.replace("+",""));var o=e;o.length>4&&(o=Trim(o.substring(1))),o.length>4&&"0"===o.charAt(0)&&(o=Trim(o.substring(1)));var n=o;n=n.replace("-",""),n=n.replace(" ",""),n=n.replace("(",""),n=n.replace(")",""),n=Trim(n);for(var i=0;i<global.ctlist.length;i++){var r=global.ctlist[i];if(!isNull(r)){var a=r[CT_NUMBER];if(!isNull(a))for(var s=0;s<a.length;s++)if(!isNull(a[s])&&(a[s].indexOf(e)>-1||a[s].indexOf(o)>-1||a[s].indexOf(n)>-1)){t=i;break}}}}catch(l){PutToDebugLogException(2,"common: GetContactIdFromNumber",l)}return t}function GetContactNameFromNumber(e){var t=e;try{if(isNull(e)||Trim(e).length<1)return"";if(isNull(global.ctlist)||global.ctlist.length<1)return e;e=Trim(e),e=e.replace("-",""),e=e.replace(" ",""),e=e.replace("(",""),e=e.replace(")","");for(var o=!1,n=0;n<global.ctlist.length;n++){var i=global.ctlist[n];if(!isNull(i)){var r=i[CT_NUMBER];if(!isNull(r))for(var a=0;a<r.length;a++)if(!isNull(r[a])&&r[a]===e){t=i[CT_NAME],o=!0;break}}}if(!1===o)for(var n=0;n<global.ctlist.length;n++){var i=global.ctlist[n];if(!isNull(i)){var r=i[CT_NUMBER];if(!isNull(r))for(var a=0;a<r.length;a++)if(!isNull(r[a])&&(r[a].length>6&&e.length>5&&r[a].indexOf(e)>=0||r[a].length>5&&e.length>6&&e.indexOf(r[a])>=0||e==="+"+r[a]||e==="00"+r[a]||r[a]==="+"+e||r[a]==="00"+e)){t=i[CT_NAME],o=!0;break}}}}catch(s){PutToDebugLogException(2,"common: GetContactNameFromNumber",s)}return t}function ContactExists(e,t){try{if(isNull(global.ctlist)||global.ctlist.length<1)return!1;isNull(e)&&(e=""),e=Trim(e),isNull(t)&&(t=""),t=Trim(t);var o=!1,n=!1;if(e.length>0&&(o=!0),t.length>0&&(n=!0),(isNull(e)||e.length<1)&&(isNull(t)||t.length<1)||!1===o&&!1===n)return PutToDebugLog(2,"ERROR, ContactExists invalid name and number"),!1;for(var i=0;i<global.ctlist.length;i++){var r=global.ctlist[i];if(!(isNull(r)||r.length<4)){if(!0===o&&r[CT_NAME]===e)return!0;if(!0===n){var a=r[CT_NUMBER];if(isNull(a)||a.length<1)continue;for(var s=0;s<a.length;s++)if(a[s]===t)return!0}}}}catch(l){PutToDebugLogException(2,"common: ContactExists",l)}return!1}function SaveCallhistoryFile(e){try{if(0===GetPreferredStorage())return PutToDebugLog(2,"EVENT, SaveCallhistoryFile do not save because preferred_storage is 0"),void e(!0);if(global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveCallhistoryFile DO NOT SAVE, flag delsett is: "+global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveCallhistoryFile callback not defined");if(isNull(global.chlist))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile no contacts to be saved"),e(!1),!1;if(isNull(global.File))return PutToDebugLog(2,"EVENT, SaveCallhistoryFile File handling module not loaded yet"),e(!1),!1;for(var t="",o=null,n=0;n<global.chlist.length;n++)if(o=global.chlist[n],!isNull(o)){var i="";o.length>6&&(i=o[CH_REASON]),t.length>3&&(t+="\r\n"),t=t+o[CH_TYPE]+","+o[CH_NAME]+","+o[CH_NUMBER]+","+o[CH_DATE]+","+o[CH_DURATION]+","+o[CH_RECORDING]+","+i}IsWindowsSoftphone()?ApiWinSaveFile(GetActiveAccCallhistoryFilename(),t,function(t){global.wasChModified=!1,e(!0)}):global.File.SaveFile(GetActiveAccCallhistoryFilename(),t,global.STORAGE_LOCAL,function(t){global.wasChModified=!1,e(t)})}catch(r){PutToDebugLogException(2,"common: SaveCallhistoryFile",r)}}function ReadCallhistoryFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile callback not defined");if(isNull(global.File))return PutToDebugLog(2,"EVENT, ReadCallhistoryFile File handling module not loaded yet"),e(!1),!1;if(!0===webphone_api.parameters.resetsettings||"true"===webphone_api.parameters.resetsettings)return!1===callhdeleted&&(callhdeleted=!0,global.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file resetsettings: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),global.chlist=[],global.recentlist=[]),PutToDebugLog(2,"EVENT, ReadCallhistoryFile not read because resetsettings"),e(!0),!0;IsWindowsSoftphone()?ApiWinLoadFile(GetActiveAccCallhistoryFilename(),function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content WinApi"),e(!1),!1;ParseCallhistoryReadFromFile(t,e)}):global.File.ReadFile(GetActiveAccCallhistoryFilename(),global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1)return PutToDebugLog(2,"EVENT, common: ReadCallhistoryFile no content"),e(!1),!1;ParseCallhistoryReadFromFile(t,e)})}catch(t){PutToDebugLogException(2,"common: ReadCallhistoryFile",t)}}function ParseCallhistoryReadFromFile(e,t){try{var o=e.split("\r\n");if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, common: ReadCallhistoryFile empty content"),t(!1),!1;if(!isNull(global.chlist))for(var n in global.chlist)delete global.chlist[n];for(var i=null,r=0;r<o.length;r++)isNull(o[r])||o[r].length<2||o[r].indexOf(",")<0?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact (1): "+o[r]):(i=o[r].split(","),isNull(i)||i.length<2?PutToDebugLog(2,"WARNING, common ReadCallhistoryFile broken or invalid contact: (2)"+o[r]):(i.length<7&&i.push(""),global.chlist.push(i)));t(!0)}catch(a){PutToDebugLogException(2,"common: ParseCallhistoryReadFromFile",a)}}function StartMsg(e,t,o){try{e=NormalizeNumber(e);var n="",i=GetParameter("sms"),r=GetParameter("chatsms");if(!isNull(i)&&i.length>0)if("1"===r)n="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+n+"; number: "+e+"; fromclass: "+o+" (1)"),StartMsgActivity(e,t,n,o);else if("2"===r)n="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+n+"; number: "+e+"; fromclass: "+o+" (2)"),StartMsgActivity(e,t,n,o);else{var a=e;a.indexOf("+")>=0&&(a=a.substring(a.indexOf("+")+1,a.length)),IsNumber(a)&&a.length>6&&a.length<20?(n="sms",PutToDebugLog(4,"EVENT, StartMsg called action: "+n+"; number: "+e+"; fromclass: "+o+" (3)"),StartMsgActivity(e,t,n,o)):(n="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+n+"; number: "+e+"; fromclass: "+o+" (4)"),StartMsgActivity(e,t,n,o))}else n="chat",PutToDebugLog(4,"EVENT, StartMsg called action: "+n+"; number: "+e+"; fromclass: "+o+" (5)"),StartMsgActivity(e,t,n,o)}catch(s){PutToDebugLogException(2,"common: StartMsg",s)}}function ChooseChatOrSms(e,t,o,n){try{var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var r="",a='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',s="";s=a.replace("[ITEMID]","#item_chat"),s=s.replace("[ITEMTITLE]",stringres.get("chat")),r+=s,s="",s=a.replace("[ITEMID]","#item_sms"),s=s.replace("[ITEMTITLE]",stringres.get("sms")),r+=s,s="";var l='<div id="chatsms_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+"px; min-width: "+Math.floor(.6*i)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("chat_sms_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="chatsms_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+r+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";n=n||function(){},j$.mobile.activePage.append(l).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#chatsms_ul").off("click","li"),n()}});var c="";j$("#chatsms_ul").on("click","li",function(n){var i=j$(this).attr("id");"#item_chat"===i&&(c="chat"),"#item_sms"===i&&(c="sms"),j$("#chatsms_popup").on("popupafterclose",function(n){j$("#chatsms_popup").off("popupafterclose"),PutToDebugLog(5,"EVENT, ChooseChatOrSms: action: "+c+"; number: "+e+"; fromclass: "+o+"; msg: "+t),StartMsgActivity(e,t,c,o)})})}catch(u){PutToDebugLogException(2,"common: ChooseChatOrSms",u)}}function StartMsgActivity(e,t,o,n){try{if("_messagelist"!==n&&(isNull(e)||e.length<1)){var i=GetParameter("messagefiles");isNull(i)||i.length<3?(isNull(t)&&(t=""),global.intentmsg[0]="action="+o,global.intentmsg[1]="to="+e,global.intentmsg[2]="message="+t,j$.mobile.changePage("#page_message",{transition:"slide",role:"page"})):j$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}else isNull(t)&&(t=""),global.intentmsg[0]="action="+o,global.intentmsg[1]="to="+e,global.intentmsg[2]="message="+t,j$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}catch(r){PutToDebugLogException(2,"common: StartMsgActivity",r)}}function OpenLinkInExternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&(PutToDebugLog(2,"EVENT, OpenLinkInExternalBrowser: "+e),WinAPI("API_BrowserOpenExtern",null,e))}catch(t){PutToDebugLogException(2,"common: OpenLinkInExternalBrowser",t)}}function OpenLinkInInternalBrowser(e){try{!isNull(e)&&e.length>0&&GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()&&WinAPI("API_BrowserOpen",null,e)}catch(t){PutToDebugLogException(2,"common: OpenLinkInInternalBrowser",t)}}function OpenWebURL(e,t,o){try{if(isNull(e)||e.length<3)return void PutToDebugLog(2,"WARNING, common OpenWebURL no url passed");var n=GetSipusername(),i=GetParameter("password"),r="",a="",s="",l="",c="",u="",m="",g=RandomInt(1e4,9999999).toString();return s=Md5Hash("C8y5:"+n+":"+i+":"+g),l=Md5Hash(n+":"+i),c=Md5Hash(n+":"+i+":"+g),u=Md5Hash("rD58s:"+n+":"+i+":"+g),m=Md5Hash("ck5Gp"+n+i+GetParameter("apiv2md5salt")+g),1===GetParameter("brandid")&&(r=Md5Hash("C8y5:"+n+":"+i+":8294032567")),e.indexOf("mvapireq")>0&&(n=encodeURIComponent(n),i=encodeURIComponent(i),r=encodeURIComponent(r),a=encodeURIComponent(a),s=encodeURIComponent(s),l=encodeURIComponent(l),c=encodeURIComponent(c),g=encodeURIComponent(g),u=encodeURIComponent(u),m=encodeURIComponent(m)),e=Trim(e),e=e.replace("[USERNAME]",n),e=e.replace("USERNAME",n),e=e.replace("USRNAME",n),e=e.replace("[PASSWORD]",i),e=e.replace("PASSWORD",i),e=e.replace("PWD",i),e=e.replace("[MD5AUTH]",r),e=e.replace("[SHA1HASH]",a),e=e.replace("SHA1CHECKSUM",a),e=e.replace("MD5WEB",s),e=e.replace("MD5SIMPLE",l),e=e.replace("MD5NORMAL",c),e=e.replace("MD5SALT",g),e=e.replace("MD5CHECKSUM",u),e=e.replace("MD5VALUE",m),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),Trim(e.toLowerCase()).indexOf("http")<0&&t!==stringres.get("np_download")&&(e="http://"+e),!1!==o&&(IsHttps()&&e.indexOf("https:")<0&&(e=GetTlsProxyUrl(e)),PutToDebugLog(3,"EVENT, OpenWebURL = "+e),global.intentbrowser[0]="url="+e,global.intentbrowser[1]="lastpage="+j$.mobile.activePage.attr("id"),isNull(t)&&(t=""),global.intentbrowser[2]="title="+t,j$.mobile.changePage("#page_internalbrowser",{transition:"pop",role:"page"})),e}catch(d){PutToDebugLogException(2,"common: OpenWebURL",d)}return e}function Md5Hash(e){var t="";try{return isNull(e)||Trim(e).length<1?(PutToDebugLog(2,"EVENT, common: Md5Hash string to hash is NULL"),""):(t=Md5Lib(e),isNull(t)&&(t=""),t)}catch(o){PutToDebugLogException(2,"common: Md5Hash",o)}return""}function Md5Lib(e){function t(e,t){var o=e[0],s=e[1],l=e[2],c=e[3];o=n(o,s,l,c,t[0],7,-680876936),c=n(c,o,s,l,t[1],12,-389564586),l=n(l,c,o,s,t[2],17,606105819),s=n(s,l,c,o,t[3],22,-1044525330),o=n(o,s,l,c,t[4],7,-176418897),c=n(c,o,s,l,t[5],12,1200080426),l=n(l,c,o,s,t[6],17,-1473231341),s=n(s,l,c,o,t[7],22,-45705983),o=n(o,s,l,c,t[8],7,1770035416),c=n(c,o,s,l,t[9],12,-1958414417),l=n(l,c,o,s,t[10],17,-42063),s=n(s,l,c,o,t[11],22,-1990404162),o=n(o,s,l,c,t[12],7,1804603682),c=n(c,o,s,l,t[13],12,-40341101),l=n(l,c,o,s,t[14],17,-1502002290),s=n(s,l,c,o,t[15],22,1236535329),o=i(o,s,l,c,t[1],5,-165796510),c=i(c,o,s,l,t[6],9,-1069501632),l=i(l,c,o,s,t[11],14,643717713),s=i(s,l,c,o,t[0],20,-373897302),o=i(o,s,l,c,t[5],5,-701558691),c=i(c,o,s,l,t[10],9,38016083),l=i(l,c,o,s,t[15],14,-660478335),s=i(s,l,c,o,t[4],20,-405537848),o=i(o,s,l,c,t[9],5,568446438),c=i(c,o,s,l,t[14],9,-1019803690),l=i(l,c,o,s,t[3],14,-187363961),s=i(s,l,c,o,t[8],20,1163531501),o=i(o,s,l,c,t[13],5,-1444681467),c=i(c,o,s,l,t[2],9,-51403784),l=i(l,c,o,s,t[7],14,1735328473),s=i(s,l,c,o,t[12],20,-1926607734),o=r(o,s,l,c,t[5],4,-378558),c=r(c,o,s,l,t[8],11,-2022574463),l=r(l,c,o,s,t[11],16,1839030562),s=r(s,l,c,o,t[14],23,-35309556),o=r(o,s,l,c,t[1],4,-1530992060),c=r(c,o,s,l,t[4],11,1272893353),l=r(l,c,o,s,t[7],16,-155497632),s=r(s,l,c,o,t[10],23,-1094730640),o=r(o,s,l,c,t[13],4,681279174),c=r(c,o,s,l,t[0],11,-358537222),l=r(l,c,o,s,t[3],16,-722521979),s=r(s,l,c,o,t[6],23,76029189),o=r(o,s,l,c,t[9],4,-640364487),c=r(c,o,s,l,t[12],11,-421815835),l=r(l,c,o,s,t[15],16,530742520),s=r(s,l,c,o,t[2],23,-995338651),o=a(o,s,l,c,t[0],6,-198630844),c=a(c,o,s,l,t[7],10,1126891415),l=a(l,c,o,s,t[14],15,-1416354905),s=a(s,l,c,o,t[5],21,-57434055),o=a(o,s,l,c,t[12],6,1700485571),c=a(c,o,s,l,t[3],10,-1894986606),l=a(l,c,o,s,t[10],15,-1051523),s=a(s,l,c,o,t[1],21,-2054922799),o=a(o,s,l,c,t[8],6,1873313359),c=a(c,o,s,l,t[15],10,-30611744),l=a(l,c,o,s,t[6],15,-1560198380),s=a(s,l,c,o,t[13],21,1309151649),o=a(o,s,l,c,t[4],6,-145523070),c=a(c,o,s,l,t[11],10,-1120210379),l=a(l,c,o,s,t[2],15,718787259),s=a(s,l,c,o,t[9],21,-343485551),e[0]=g(o,e[0]),e[1]=g(s,e[1]),e[2]=g(l,e[2]),e[3]=g(c,e[3])}function o(e,t,o,n,i,r){return t=g(g(t,e),g(n,r)),g(t<<i|t>>>32-i,o)}function n(e,t,n,i,r,a,s){return o(t&n|~t&i,e,t,r,a,s)}function i(e,t,n,i,r,a,s){return o(t&i|n&~i,e,t,r,a,s)}function r(e,t,n,i,r,a,s){return o(t^n^i,e,t,r,a,s)}function a(e,t,n,i,r,a,s){return o(n^(t|~i),e,t,r,a,s)}function s(e){txt="";var o,n=e.length,i=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=e.length;o+=64)t(i,l(e.substring(o-64,o)));e=e.substring(o-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<e.length;o++)r[o>>2]|=e.charCodeAt(o)<<(o%4<<3);if(r[o>>2]|=128<<(o%4<<3),o>55)for(t(i,r),o=0;o<16;o++)r[o]=0;return r[14]=8*n,t(i,r),i}function l(e){var t,o=[];for(t=0;t<64;t+=4)o[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return o}function c(e){for(var t="",o=0;o<4;o++)t+=d[e>>8*o+4&15]+d[e>>8*o&15];return t}function u(e){for(var t=0;t<e.length;t++)e[t]=c(e[t]);return e.join("")}function m(e){return u(s(e))}function g(e,t){return e+t&4294967295}function g(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}try{var d="0123456789abcdef".split("");return m("hello"),m(e)}catch(p){PutToDebugLogException(2,"common: Md5Lib",p)}return""}function UriParser(e,t,o,n,i,r){try{if(isNull(e)||Trim(e).length<1)return void PutToDebugLog(2,"WARNING, common: UriParser uri is NULL");var a=GetSipusername(),s=GetParameter("password"),l="";!isNull(s)&&s.length>0&&(l=Md5Hash(s));var c="",u="",m="",g="",d="",p="",h=RandomInt(1e4,9999999).toString();u=Md5Hash("C8y5:"+a+":"+s+":"+h),m=Md5Hash(a+":"+s),g=Md5Hash(a+":"+s+":"+h),d=Md5Hash("rD58s:"+a+":"+s+":"+h),p=Md5Hash("ck5Gp"+a+s+GetParameter("apiv2md5salt")+h),0===Trim(e).indexOf("*")&&(e=e.substring(1));var f=e,b=f.indexOf("authpwd=");if(b>0&&GetLogLevel()<5){var v=f.substring(0,b+8);f=f.substring(b+8),b=f.indexOf("&"),b<0&&(b=f.length),f=f.substring(b),f=v+"*****"+f}PutToDebugLog(3,"EVENT, uri = "+f),e.indexOf("mvapireq")>0&&(a=encodeURIComponent(a),s=encodeURIComponent(s),l=encodeURIComponent(l),t=encodeURIComponent(t),o=encodeURIComponent(o),n=encodeURIComponent(n),c=encodeURIComponent(c),u=encodeURIComponent(u),m=encodeURIComponent(m),g=encodeURIComponent(g),h=encodeURIComponent(h),d=encodeURIComponent(d),p=encodeURIComponent(p)),e=Trim(e),e=e.replace("[USERNAME]",a),e=e.replace("USERNAME",a),e=e.replace("USRNAME",a),e=e.replace("[PASSWORD]",s),e=e.replace("PASSWORD",s),e=e.replace("PWD",s),e=e.replace("[MD5AUTH]",l),e=e.replace("MD5AUTH",l),e=e.replace("[PIN]",t),e=e.replace("PINCODE",t),e=e.replace("[ANUM]",o),e=e.replace("ANUM",o),e=e.replace("MYNUMBER",o),e=e.replace("PHONE1",o),e=e.replace("PREFIX_OR_NUMBER",o),e=e.replace("CALLEDNUMBER",o),e=e.replace("[CALLBACKNR]",GetParameter("callbacknumber")),e=e.replace("CALLBACKNR",GetParameter("callbacknumber")),e=e.replace("[BNUM]",n),e=e.replace("BNUM",n),e=e.replace("PHONE2",n),e=e.replace("TARGETMOBILE",n),e=e.replace("[TXT]",i),e=e.replace("TEXT",i),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("[SHA1HASH]",c),e=e.replace("SHA1CHECKSUM",c),e=e.replace("MD5WEB",u),e=e.replace("MD5SIMPLE",m),e=e.replace("MD5NORMAL",g),e=e.replace("MD5SALT",h),e=e.replace("SALT",h),e=e.replace("MD5CHECKSUM",d),e=e.replace("MD5VALUE",p),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var _=GetParameter("upperserver");if((isNull(_)||_.length<1)&&(_=GetWebrtcUpperServer()),e=e.replace("UPPERSERVER",_),e=e.replace("SERVERAPIKEY",GetConfig("serverapikey")),e=e.replace("KEY",GetConfig("serverapikey")),e.indexOf("tel.search")>0){var E=GetParameter2("telsearchkey");isNull(E)&&(E=""),e=e.replace("TELSEARCHKEY",E)}Trim(e.toLowerCase()).indexOf("http")<0&&(e="http://"+e);var f=e,b=f.indexOf("authpwd=");if(b>0){var v=f.substring(0,b+8);f=f.substring(b+8),b=f.indexOf("&"),b<0&&(b=f.length),f=f.substring(b),f=v+"*****"+f}if(PutToDebugLog(5,"EVENT,httpRequestUri = "+f+";   action = "+r),"return_uri"===r)return e;var T=!1,P="";e.indexOf("[POST]")>0?(T=!0,P=e.substring(e.indexOf("[POST]")+6),e=e.substring(0,e.indexOf("[POST]"))):(P=GetUrlParamVal(e,"POSTDATA"),!isNull(P)&&P.length>2&&(T=!0,e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?"))))),!1===global.isdebugversion&&!1===T&&"true"===GetConfig("usingmizuserver")&&e.indexOf("mvapireq")>0&&(e=McrfsEnc(e,r)),HttpRequest(e,r,T,P)}catch(S){PutToDebugLogException(2,"common: UriParser",S)}}function McrfsEnc(e,t){try{if(isNull(e)||e.length<1)return e;var o=e,n=o.indexOf("?");if(n<0)return o;o=o+"&reqid="+GetReqId();var i=o.substring(n+1);o=o.substring(0,n+1);var r="",a="",s=i.split("&");if(!isNull(s)&&s.length>0){i="";for(var l=0;l<s.length;l++)if(!isNull(s[l])){var c=s[l].indexOf("=");if(!(c<1)){var u=s[l].substring(0,c+1),m=s[l].substring(c+1);i.length>0&&(i+="&"),i=i+u+encodeURIComponent(m),"authkey="===u||"authid="===u||"authpwd="===u?(a.length>0&&(a+="&"),a=a+u+encodeURIComponent(m)):(r.length>0&&(r+="&"),r=r+u+encodeURIComponent(m))}}}var g=StrEc(i,global.ec_apikey,!0);if(i===StrDc("mcrfs_"+g,global.ec_apikey,!0))return o=o+"mcrfs="+g,PutToDebugLog(5,"EVENT,httpRequestUri ENC All = "+o+";   action = "+t),o;if(!isNull(a)&&a.length>0){var d=StrEc(a,global.ec_apikey,!0);if(a===StrDc("mcrfs_"+d,global.ec_apikey,!0))return!isNull(r)&&r.length>0&&(o=o+r+"&"),o=o+"mcrfs="+d,PutToDebugLog(5,"EVENT,httpRequestUri ENC main = "+o+";   action = "+t),o}}catch(p){PutToDebugLogException(2,"common: McrfsEnc",p)}return e}function ConfigureRequestEngine(e,t,o){try{if(e&&("jsonp"===global.httpmehod||"ws"===global.httpmehod))return void ReConfigureRequestEngine(e);if(!1===e&&t.indexOf("mvapireq")<1&&t.indexOf("mcrfs=")<1&&"ws"===global.httpmehod)return GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===global.ENGINE_SERVICE?void(global.httpmehod="win"):void(global.httpmehod="jsonp");if(t.indexOf("mvapireq")>=0||t.indexOf("mcrfs=")>=0&&getuseengine()===global.ENGINE_WEBRTC)return void(global.httpmehod="ws");if(global.httpmehod.length>0)return;return"waitforparameters"===o?void(global.httpmehod="cors"):(("true"===GetConfig("usingmizuserver")||IsMizuServer())&&window.WebSocket&&!0!==e&&(global.wssupported=!0),!0===global.wssupported?void(global.httpmehod="ws"):GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===global.ENGINE_SERVICE?void(global.httpmehod="win"):getuseengine()===global.ENGINE_WEBPHONE?void(global.httpmehod="java"):"true"===GetConfig("usingmizuserver")||!isNull(t)&&t.indexOf("xautoprov")>=0?void(global.httpmehod="cors"):void(global.httpmehod="jsonp"))}catch(n){PutToDebugLogException(2,"common: ConfigureRequestEngine",n)}}function ReConfigureRequestEngine(e){try{if(!1===global.currhttpmehodworking&&"ws"===global.httpmehod&&CheckInternetConnectionWS(),!0===e)return void(global.httpmehod="cors");if(!0===global.currhttpmehodworking)return;GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()?"win"===global.httpmehod?!0===global.wssupported&&(global.httpmehod="ws"):"ws"===global.httpmehod&&getuseengine()===global.ENGINE_WEBPHONE?global.httpmehod="java":"ws"===global.httpmehod||"java"===global.httpmehod?global.httpmehod="cors":"cors"===global.httpmehod?global.httpmehod="jsonp":global.httpmehod="win":"ws"===global.httpmehod?getuseengine()===global.ENGINE_WEBPHONE?global.httpmehod="java":getuseengine()===global.ENGINE_SERVICE?global.httpmehod="win":global.httpmehod="cors":"java"===global.httpmehod||"win"===global.httpmehod?global.httpmehod="cors":"cors"===global.httpmehod&&(global.httpmehod="jsonp"),PutToDebugLog(4,"EVENT, common:ReConfigureRequestEngine called. HTTP method: "+global.httpmehod)}catch(t){PutToDebugLogException(2,"common: ReConfigureRequestEngine",t)}}function HttpRequest(e,t,o,n){var i=0;try{if(isNull(n)&&(n=""),"downloadcontacts"===t&&"cors"!==global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors downloadcontacts");var r=CORSRequest(e,t,o,n);return void(!1===r&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available downloadcontacts; retry with other method"),ReConfigureRequestEngine(),HttpRequest(e,t,o,n)))}if(ConfigureRequestEngine(o,e,t),setTimeout(function(){ReConfigureRequestEngine(o)},3500),isNull(o)||!0!==o||"post",i=1,"telsearchname"===t){PutToDebugLog(2,"EVENT, HttpRequest method: cors telsearchname");var r=CORSRequest(e,t,o,n);return void(!1===r&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available telsearchname"),ReConfigureRequestEngine(),HttpRequest(e,t,o,n)))}if(i=2,50===GetConfigInt("brandid",-1)&&(global.httpmehod="win"),"win"===global.httpmehod){if(i=10,PutToDebugLog(2,"EVENT, HttpRequest method: win"),e=e.replace("[POST]",""),(isNull(n)||n.length<1)&&(n="data=dummy"),50===GetConfigInt("brandid",-1))return void WinAPI("API_HTTPReqAsyncFavafone",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsyncFavafone returned (4): "+e+" waiting for response in notifications")},e,n);i=11,WinAPI("API_HTTPReqAsync",function(e){PutToDebugLog(2,"EVENT, common: API_HTTPReqAsync returned (4): "+e+" waiting for response in notifications")},e,n)}else if("ws"===global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: ws");var r=WSRequest(e,t,o);!1===r&&(i=20,PutToDebugLog(2,"WARNING, HttpRequest method: ws not available"),ReConfigureRequestEngine(),i=21,HttpRequest(e,t,o,n))}else if("java"===global.httpmehod)PutToDebugLog(2,"EVENT, HttpRequest method: java"),i=25,webphone_handle.API_HTTPReqAsync(e,n),i=26;else if("cors"===global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: cors"),i=30;var r=CORSRequest(e,t,o,n);i=31,!1===r&&(PutToDebugLog(2,"WARNING, HttpRequest method: cors not available"),ReConfigureRequestEngine(),i=32,HttpRequest(e,t,o,n))}else if("jsonp"===global.httpmehod){PutToDebugLog(2,"EVENT, HttpRequest method: jsonp"),i=40;var a=decodeURIComponent(e);if(a=encodeURIComponent(a),a.toLowerCase().indexOf("wsuser")>0||a.toLowerCase().indexOf("wsload")>0)return PutToDebugLog(2,"WARNING, will not send wsuser/wsload over jsonp"),void(global.sendwsuserjsonp=!0);i=41;var s="http://";IsHttps()&&(s="https://"),a.toLowerCase().indexOf("wsuser")>0&&(s="https://");var l="rtc.mizu-voip.com";if("us"===global.usuk&&(l="usrtcx.webvoipphone.com"),i=42,IsMizuServer()&&global.usuk.length<1&&(a.toLowerCase().indexOf("wsuser")<0||a.toLowerCase().indexOf("wsload")<0))if(i=45,GetParameter("webrtcserveraddress").length>3){l=GetParameter("webrtcserveraddress");var c=l.indexOf("://");c>=0&&(l=l.substring(c+3)),c=l.indexOf("/"),c>0&&(l=l.substring(0,c))}else GetConfig("serveraddress").length>1?l=GetConfig("serveraddress"):!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.serveraddress)&&webphone_api.parameters.serveraddress.length>1&&(l=Trim(webphone_api.parameters.serveraddress),l=NormalizeInput(l,0),l.indexOf(":")>0&&(l=l.substring(0,l.indexOf(":"))));i=46,IsHttps()&&IsIPAddrress(l)&&jsonpmaxloop<3&&(jsonpmaxloop++,ReConfigureRequestEngine(o),HttpRequest(e,t,o,n)),jsonpmaxloop=0,i=50;var u=GetConfig("mainaport");!isNull(u)&&u.length>0&&(l.indexOf(":")>0&&(l=l.substring(0,l.indexOf(":"))),l+=u);var m=s+l+"/mvapireq/jppget?url="+a+"&callback=?";PutToDebugLog(4,"EVENT, jsonpurl: "+m),i=51,j$.getJSON(m,function(e){var o="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest jsonp response is NULL"):o=e.contents,HttpResponseHandler(o,t)})}else PutToDebugLog(2,"ERROR, common: HttpRequest NO supported http request method");i=59}catch(g){PutToDebugLogException(2,"common: HttpRequest ("+i.toString()+")",g);try{"creditrequest"===t&&(global.creditRequestIval<3e4?global.creditRequestIval=2*global.creditRequestIval:global.creditRequestIval=global.CREDIT_REQUEST_IVAL_DEFVAL)}catch(d){}}}function CORSRequest(e,t,o,n){try{var i="GET";o&&(i="POST"),e=e.replace("[POST]","");var r=new XMLHttpRequest;if(PutToDebugLog(2,"EVENT, CORSRequest url: "+e+"; action: "+t+"; ispost: "+o+"; postdata: "+n),"withCredentials"in r)r.open(i,e,!0);else{if("undefined"==typeof XDomainRequest)return r=null,PutToDebugLog(2,"ERROR, common: CORSRequest, CORS not supported"),global.httpmehod="jsonp",!1;r=new XDomainRequest,r.open(i,e)}var a=0
;r.onload=function(){try{if(PutToDebugLog(4,"EVENT, CORSRequest.onload"),a=19,!1===global.httpheaderslogged&&r.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 1: "+r.getAllResponseHeaders())}var e=r.responseText,o="";o=!isNull(e)&&e.length>250?e.substring(0,250)+"....":e,isNull(o)&&(o="NULL"),a=20,PutToDebugLog(2,"EVENT, CORSRequest response: "+o);return a=21,isNull(e)||e.length<1?(a=23,PutToDebugLog(2,"ERROR, CORSRequest response is NULL"),!1):(HttpResponseHandler(e,t),e)}catch(n){PutToDebugLogException(2,"common: CORSRequest.onload inner ("+a+")",n)}},r.onerror=function(e){var t="";isNull(e)||(t=e.toString(),isNull(e.target)||(t=isNull(e.target.status)?t+" "+e.target.toString():t+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: CORSRequest: onerror: "+t)};var s=reqtimeout;!0===o&&(s+=2e3),e.indexOf("xautoprov")>=0&&(s+=15e3),r.timeout=s,r.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: CORSRequest: Timeout")},o?(isNull(n)&&(n=""),n=Trim(n),0===n.indexOf("?")&&(n=n.replace("?","")),r.send(n)):r.send()}catch(l){PutToDebugLogException(2,"common: CORSRequest",l)}}function ResetWsapisocket(e){try{isNull(e)&&(e=""),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, ResetWsapisocket, close from: "+e),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null))}catch(t){PutToDebugLogException(2,"common: ResetWsapisocket",t)}wsapisocket=null}function WSAPIRequest(e,t,o,n){try{if(!n||"function"!=typeof n)return void PutToDebugLog(2,"ERROR, common.WSAPIRequest websocketNS callback is NULL");if(!1===Glsp())return void PutToDebugLog(2,"WARNING, WSAPIRequest websocketNS do not send");if(!isNull(o)&&(o=Trim(o),0===o.indexOf("API_")&&"API_Poll"!==o&&"API_Stop"!==o)){srv_cb.push(n),srv_apiname.push(o.toLowerCase());var i="";if(!isNull(t)&&t.indexOf("param1=")>0){var r=ReplaceAll(t,"BOFLINE","");r=ReplaceAll(r,"EOFLINE","");var a=r.substring(r.indexOf("param1=")+7),s="";a.indexOf("param2=")>=0?(s=a.substring(a.indexOf("param2=")+7),s=s.indexOf("param3=")>=0?s.substring(0,s.indexOf("param3=")):s.substring(0,s.indexOf("EOFCOMMAND")),s=Trim(s),a=a.substring(0,a.indexOf("param2=")),a=Trim(a)):(a=a.substring(0,a.indexOf("EOFCOMMAND")),a=Trim(a)),i=a+s}srv_params.push(i)}if(!0===TestNSPolling()&&(global.useajax_forservice=!0),wsapimaxloop>15&&!IsMacLin()&&!IsWinMacLinNsTest()&&(global.useajax_forservice=!0),!0===global.useajax_forservice||"API_Poll"===o)WSAPIReqHTTP(e,t,n);else if(!0===global.flagnsreconnect&&(PutToDebugLog(2,"EVENT,WSAPIReconnect websocketNS because engine was stopped"),global.flagnsreconnect=!1,void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null),void 0===wsapisocket||null===wsapisocket){var l=global.NATIVE_PLUGIN_URL;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(l=global.NATIVE_PLUGIN_URL_SECURE),!0===NSMacLinEnabled()&&(l=global.NATIVE_PLUGIN_LINMAC_URL_SECURE),"API_Poll"!==o&&"API_Stop"!==o&&"API_HTTPKeepAlive"!==o&&(wsapi_method.push(e),wsapi_data.push(t),wsapi_cb.push(n)),WSAPIConnect(l,e,t,n)}else{if((!1===wsapiready||wsapi_method.length>0)&&"API_Poll"!==o&&"API_Stop"!==o&&"API_HTTPKeepAlive"!==o){wsapi_method.push(e),wsapi_data.push(t),wsapi_cb.push(n);var c=t;return isNull(c)&&(c=""),c.length>100&&(c=c.substring(0,99)),!0===wsapiready&&wsapi_method.length>0&&HandleWsapiQueue(),void PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: Websocket not ready: "+wsapiready+"("+wsapi_method.length+"): "+c)}if("API_Start"!==o&&"API_SetParameters"!==o&&"API_Poll"!==o&&"API_Stop"!==o&&global.apistartstate<2&&global.apistarttick>0&&GetTickCount()-global.apistarttick<3e3){wsapi_method.push(e),wsapi_data.push(t),wsapi_cb.push(n);var c=t;return isNull(c)&&(c=""),c.length>100&&(c=c.substring(0,99)),void PutToDebugLog(2,"EVENT, WSAPIRequest websocketNS cached for later execution: no API_Start feedback: "+c)}PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS SEND data: "+t),void 0!==wsapisocket&&null!==wsapisocket||PutToDebugLog(2,"ERROR, _common: WSAPIRequest websocketNS wsapisocket is NULL 1"),wsapisocket.send(t),wsapisocket.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS, received data is NULL");window.webphone_pollstatus=!1;var o=ArrayBufferToString(t);o.indexOf("WPNOTIFICATION,")>=0&&!0===global.cansetuseengine&&(global.useengine=global.ENGINE_SERVICE,global.cansetuseengine=!1),ProcessServiceReqResponse(o,n)}}}catch(u){PutToDebugLogException(2,"common: WSAPIRequest websocketNS",u)}}function WSAPIHandleReConnect(){try{WinAPI("extcmd_version",function(e){isNull(e)||e.indexOf("ERROR:")>=0||(global.last_ns_ws_succwss=GetTickCount())}),setTimeout(function(){global.last_ns_ws_succwss<1||GetTickCount()-global.last_ns_ws_succwss>1200?(common.PutToDebugLog(2,"ERROR, exec WSAPIReConnect from timer (1)"),WSAPIReConnect()):!0===webphone_api.isincall()?(common.PutToDebugLog(2,"ERROR, exec WSAPIReConnect from timer (2) incall"),WSAPIReConnect()):WinAPI("API_Start2",function(e){PutToDebugLog(2,"EVENT, exec API_Start2 because NS engine is not responsive: answer: "+e)})},1e3)}catch(e){PutToDebugLogException(2,"common: WSAPIHandleReConnect",e)}}function WSAPIReConnect(){try{wsar_count++;var e=GetTickCount();if(e-wsar_lastcalled<100)return;if(wsar_lastcalled=e,(!0===wsa_ever_connected&&wsar_count<150||wsar_count<50)&&null===wsar_timer){wsar_delay>2e3&&getuseengine()===global.ENGINE_SERVICE&&global.phonestarted>1&&(PutToDebugLog(1,"STATUS,"+stringres.get("ns_engine_unreachable")),global.display_last_status=!0),wsar_delay<32e3&&(wsar_delay*=2);return PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS after: "+(wsar_delay/1e3).toString()+" sec"),wsar_timer=setTimeout(function(){wsar_delay>3e4?(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS whole SIPStack restart"),WSAPIConnect(wsapi_reconnect_address,"","",function(){})):(PutToDebugLog(2,"EVENT, WSAPIReConnect websocketNS reconnecting..."),WSAPIConnect(wsapi_reconnect_address,"","",function(){})),isNull(wsar_timer)||clearTimeout(wsar_timer),wsar_timer=null},wsar_delay),wsar_delay<10&&(wsar_delay=500),!0}}catch(t){PutToDebugLogException(2,"common: WSAPIReConnect websocketNS",t)}}function WSAPIConnect(e,t,o,n){try{0!==e.indexOf("ws")&&(e="ws://"+e),PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS url: "+e),wsapi_reconnect_address=e,wsapiskt_closedmanually=!1;var i=!1;0===e.toLowerCase().indexOf("wss:")&&(i=!0);var r=!1;if(!1===TestNSPolling()){try{PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (1)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (1)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0,global.cansetuseengine=!0}catch(a){PutToDebugLogException(2,"common: WSAPIConnect websocketNS failed to connect to: "+e,a)}if(!1===r&&!1===i){e=global.NATIVE_PLUGIN_URL_SECURE;try{PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (2)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (2)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen=null,wsapisocket.onclose=null,wsapisocket.onerror=null),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError,r=!0}catch(s){PutToDebugLogException(2,"WSAPIConnect failed to connect on 2nd attempt to (on SECURE connection) : "+e,s)}}}if(!1===r)return void(IsMacLin()||IsWinMacLinNsTest()||(WSAPIReqHTTP(t,o,n),global.useajax_forservice=!0));(isNull(wsapisocket)||!1===r)&&(PutToDebugLog(3,"EVENT, common: WSAPIConnect websocketNS create socket (3)"),void 0!==wsapisocket&&null!==wsapisocket&&(wsapisocket.close&&(PutToDebugLog(2,"EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (3)"),wsapiskt_closedmanually=!0,wsapisocket.close()),wsapisocket.onopen&&(wsapisocket.onopen=null),wsapisocket.onclose&&(wsapisocket.onclose=null),wsapisocket.onerror&&(wsapisocket.onerror=null)),wsapisocket=null,wsapisocket=new WebSocket(e,"api"),wsapisocket.binaryType="arraybuffer",wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError),wsapisocket.onopen=WsapisktOnOpen,wsapisocket.onclose=WsapisktOnClose,wsapisocket.onerror=WsapisktOnError}catch(l){PutToDebugLogException(2,"common: WSAPIConnect websocketNS",l)}}function WsapisktOnOpen(){PutToDebugLog(2,"EVENT, common: WSAPIConnect.onopen websocketNS, connection ready"),wsapiready=!0,wsapimaxloop=0,wsa_ever_connected=!0,wsar_delay=1,global.display_last_status&&(global.display_last_status=!1,PutToDebugLog(2,"EVENT, Display last good status to hide Engine unreachable"),PutToDebugLog(1,"EVENT, "+global.last_good_status)),HandleWsapiQueue()}function WsapisktOnClose(){PutToDebugLog(2,"EVENT, common: WSAPIConnect.onclose websocketNS, connection closed"),wsapisocket=null,wsapiready=!1,!1===wsapiskt_closedmanually&&(PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose connection interrupted"),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onclose websocketNS, call WSAPIReConnect"),WSAPIReConnect())}function WsapisktOnError(){var e="";"undefined"!=typeof wserr&&null!==wserr&&(e=wserr.toString()),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, connection onerror: "+e),PutToDebugLog(2,"ERROR, common: WSAPIConnect.onerror websocketNS, call WSAPIReConnect"),WSAPIReConnect(),setTimeout(function(){void 0!==wsapisocket&&null!==wsapisocket&&!0===wsapiready&&(global.wnotstartedsession=!1)},1500),wsapiready=!1,wsapimaxloop++}function HandleWsapiQueue(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(!isNull(hwqueue_timer))return;hwqueue_timer=setInterval(function(){try{if(isNull(wsapi_data)||wsapi_data.length<1)return isNull(hwqueue_timer)||clearInterval(hwqueue_timer),hwqueue_timer=null,wsapi_method=[],wsapi_data=[],void(wsapi_cb=[]);if(void 0===wsapisocket||null===wsapisocket)return void PutToDebugLog(2,"WANING, _common: WSAPIRequest websocketNS HandleWsapiQueue wsapisocket is NULL 2");var e=wsapi_data[0],t="",o=e.indexOf("function=");if(o>0&&(t=e.substring(o+9),o=t.indexOf("EOFLINE"),t=o>0?t.substring(0,o):""),"API_Start"!==t&&"API_SetParameters"!==t&&global.apistartstate<2&&global.apistarttick>0&&GetTickCount()-global.apistarttick<3e3)return;e=wsapi_data.shift();var n=(wsapi_method.shift(),wsapi_cb.shift());PutToDebugLog(4,"EVENT, _common: WSAPIRequest websocketNS HandleWsapiQueue SEND data: "+e),wsapisocket.send(e),wsapisocket.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))return void PutToDebugLog(2,"ERROR, common: WSAPIRequest.onmessage websocketNS HandleWsapiQueue, received data is NULL");ProcessServiceReqResponse(ArrayBufferToString(t),n)}}catch(i){PutToDebugLogException(2,"common: HandleWsapiQueue Timer, skip all cached requests",i),wsapi_method=[],wsapi_data=[],wsapi_cb=[]}},60)}catch(e){PutToDebugLogException(2,"common: HandleWsapiQueue",e)}}function WSAPIReqHTTP(e,t,o){try{if(isNull(wreqhttp)||wreqhttp.length<1){wreqhttp=global.NATIVE_PLUGIN_URL;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(wreqhttp=global.NATIVE_PLUGIN_URL_SECURE),!0===NSMacLinEnabled()&&(wreqhttp=global.NATIVE_PLUGIN_LINMAC_URL_SECURE),wreqhttp=wreqhttp.toLowerCase(),wreqhttp=wreqhttp.replace("wss:","https:"),wreqhttp=wreqhttp.replace("ws:","http:"),wreqhttp=wreqhttp.replace("msstwebsock",""),PutToDebugLog(2,"EVENT, WSAPIReqHTTP url: "+wreqhttp)}PollServiceStatus(e,wreqhttp);var n="POST";"get"===e.toLowerCase()&&(n="GET"),j$.ajax({url:wreqhttp,data:t,timeout:2500,method:n}).done(function(e,t,n){if(PutToDebugLog(2,"EVENT, common: WSAPIReqHTTP response: "+e),isNull(e))return void PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP received data is NULL");ProcessServiceReqResponse(e,o)}).fail(function(e,t,o){PutToDebugLog(2,"ERROR, common: WSAPIReqHTTP ajax failed, status: "+t+"; error: "+o)})}catch(i){PutToDebugLogException(2,"common: WSAPIReqHTTP",i)}}function PollServiceStatus(e,t){try{if(!0!==global.useajax_forservice)return;if(!isNull(global.serviceStatusPollTimer))return;nspollinterval<1&&(nspollinterval=GetParameterInt("nspollinterval",300)),global.serviceStatusPollTimer=setInterval(function(){pollreqcount++,!0===TestNSPolling()&&PutToDebugLog(2,"EVENT, common: PollServiceStatus: send extcmd_poll; request sent count: "+pollreqcount),j$.ajax({url:t,data:"extcmd_poll",timeout:1e3,method:e.toUpperCase()}).done(function(e,t,o){isNull(e)&&(e="");var n=e.indexOf("APIRESULT:");n>0&&(e=e.substring(n+10),e.indexOf("nomessage")<0&&(n=e.indexOf("message:"))>0&&(e=Trim(e.substring(n+8)),webphonetojs(e)))}).fail(function(e,t,o){PutToDebugLog(2,"ERROR, common: PollServiceStatus ajax failed, status: "+t+"; error: "+o)})},nspollinterval)}catch(o){PutToDebugLogException(2,"common: WSAPIReqHTTP",o)}}function ProcessServiceReqResponse(e,t){var o=0;try{var n="";if(o=11,isNull(e)||e.length<1)return o=13,PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(1): "+e),t(null),t=null,"";if(e=e.replace("NORETRY",""),e.indexOf("webphone_api.")>=0&&(")"===e.charAt(e.length-1)||")"===e.charAt(e.length-2)&&";"===e.charAt(e.length-1)))return PutToDebugLog(2,"EVENT, common: ServiceResponse exec function received form websocket: "+e),void ExecFunction(e);if(e.indexOf("OK: pending")>=0)return void PutToDebugLog(2,"EVENT, common: ServiceResponse received pending, waiting for answer");if(e.indexOf("WPNOTIFICATION")>=0)return webphonetojs(e),!0;if(!(e.indexOf("APIREQUEST:")>=0))return PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(3): "+e),o=46,void 0!==t&&null!==t&&IsFunction(t)&&t(n),t=null,n;PutToDebugLog(4,"EVENT, common: ServiceResponse, received data(2): "+e),o=14;var i="",r="",a="";if(e.indexOf("APIRESULT:")>0&&(o=15,getuseengine()===global.ENGINE_SERVICE&&(global.service_last_life_signal=GetTickCount()),e.indexOf("RPARAM1")>0?(i=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("RPARAM1:")),e.indexOf("RPARAM2")>0?(r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("RPARAM2")),a=e.substring(e.indexOf("RPARAM2:")+8,e.indexOf("APIRESULT:"))):r=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("APIRESULT:")),n=e.substring(e.indexOf("APIRESULT:")+10,e.length)):(i=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("APIRESULT:")),n=e.substring(e.indexOf("APIRESULT:")+10,e.length))),o=18,isNull(i)?i="":(i=Trim(i),i=i.toLowerCase()),n=isNull(n)?"":Trim(n),o=19,50===GetConfigInt("brandid",-1)&&(isNull(r)&&(r=""),r=r.toLowerCase(),r.indexOf("ww.favafone")>0))return r.indexOf("countries-list")>0?HttpResponseHandler(n,"get_new_user_countrylist"):r.indexOf("registration-form")>0?HttpResponseHandler(n,"get_new_user_form_fields"):r.indexOf("create-account")>0&&HttpResponseHandler(n,"newuser_dynamic"),n;if(o=20,"api_poll"===i)o=21,webphonetojs(n),o=22;else{if(0!==i.indexOf("api_"))return n.indexOf("ERROR")>=0?(o=30,PutToDebugLog(2,"ERROR, "+n),o=31,t&&IsFunction(t)&&(o=32,t(n),t=null),""):"true"===n.toLowerCase()?(o=35,t(!0),t=null,!0):"false"===n.toLowerCase()?(o=36,t(!1),t=null,!1):IsNumber(n)?(o=37,t(StrToInt(n)),t=null,StrToInt(n)):n.indexOf("OK")>=0&&n.length<12?(o=40,t(!0),t=null,!0):(o=41,t(n),t=null,n);if(o=23,n.indexOf("ERROR")>=0)if(GetParameter("devicetype")===DEVICE_WIN_SOFTPHONE()||getuseengine()===global.ENGINE_SERVICE)n.indexOf("wphone")>0&&n.indexOf("not")>0&&n.indexOf("started")>0&&!1===global.wnotstartedsession&&global.apistartstate>0&&global.apistarttick>0&&GetTickCount()-global.apistarttick>3e3&&(global.wnotstartedsession=!0,PutToDebugLog(2,"WARNING, mlogic API_Sart because: wphone not started received"),WinAPI("API_Start",function(e){PutToDebugLog(2,"ERROR, API_Start because: wphone not started answer: "+e)}));else if("api_call"===i){o=24;var s=n.replace("ERROR","");s=s.replace(":",""),PutToDebugLog(1,"ERROR, "+s)}else o=25,PutToDebugLog(2,"ERROR, "+n);o=26;var l=null;if(!isNull(srv_cb)&&srv_cb.length>0){var c=r+a;!isNull(c)&&c.length>85&&(c=c.substring(0,85));for(var u=0;u<srv_apiname.length;u++)if(srv_apiname[u]===i){!isNull(srv_params[u])&&srv_params[u].length>85&&(srv_params[u]=srv_params[u].substring(0,85));var m=srv_params[u],g=c,d=m.indexOf("\r");if(d>0&&(m=m.substring(0,d)),m=Trim(m),d=g.indexOf("\r"),d>0&&(g=g.substring(0,d)),g=Trim(g),srv_params[u]===c||!isNull(m)&&m.length>0&&m===g){srv_apiname[u],l=srv_cb[u],isNull(l)||IsFunction(l)||(PutToDebugLog(2,"WARNING,ProcessServiceReqResponse callback is not a function: "+typeof l),l=null),srv_apiname.splice(u,1),srv_cb.splice(u,1),srv_params.splice(u,1);break}}}if(o=27,!isNull(l)&&IsFunction(l))return o=28,isNull(n)&&(o=102,n=""),o=103,n=n.toString(),o=104,"true"===n.toLowerCase()?(o=105,l(!0),o=106,!0):"false"===n.toLowerCase()?(o=107,l(!1),o=108,!1):n.toString&&IsNumber(n.toString().replace("OK:",""))?(o=109,l(StrToInt(n.toString().replace("OK:",""))),StrToInt(n.toString().replace("OK:",""))):n.indexOf("OK")>=0&&n.length<15?(o=110,l(!0),o=111,!0):(o=112,"function"==typeof l?l(n):PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a function ("+o+")"),o=113,n);var p="";p=isNull(l)?"NULL":l.toString(),PutToDebugLog(2,"WARNING, ProcessServiceResponse cb_tmp is not a function: "+p),o=29}o=45}catch(b){if(void 0!==b&&null!==b){var h=b.toString(),f="";if("undefined"!=typeof b.message&&null!==b.message&&(f=b.message),h.toLowerCase().indexOf("is not a function")>=0||f.toLowerCase().indexOf("is not a function")>=0)return void PutToDebugLog(2,"EVENT, common: ProcessServiceReqResponse ("+o.toString()+")"+h+" "+f)}PutToDebugLogException(2,"common: ProcessServiceReqResponse ("+o.toString()+")",b)}}function WSRequest(e,t,o){var n=0;try{if(isNull(wssocket)){PutToDebugLog(2,"EVENT, WSRequest need WsConnect websocketAPI, url: "+e),n=1;var i=GetWebrtcSrvAddr();if(n=2,isNull(i)||i.length<2){if(i=GetWp(),IsLocalServer(!0))return void PutToDebugLog(2,"ERROR, "+stringres.get("webrtc_local_sipserver")+" (1)")}else PutToDebugLog(2,"EVENT, WSRequest webrtcserveraddress found: "+i);if(i=i.replace("*",""),n=11,"true"===GetConfig("usingmizuserver")){n=12;var r=i.indexOf("/mfst");r>0&&(i=i.substring(0,r)),i+="/mvstwebsock"}if(i=i.replace("/mfstwebsock","/mvstwebsock"),ws_inurl.push(e),ws_action.push(t),ws_ispost.push(o),HandleQueueOverload(),IsMizuWebRTCGateway()&&!1===global.decideusuk_finished&&getuseengine()===global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT, WSRequest decideusuk not yet finished");PutToDebugLog(2,"EVENT, WSRequest call WsConnect websocketAPI"),WSConnect(e,t,o,i),n=17}else{if(!1===wsready||ws_inurl.length>0)return ws_inurl.push(e),ws_action.push(t),ws_ispost.push(o),HandleQueueOverload(),void PutToDebugLog(2,"EVENT, common.WSRequest request cached for later execution");var a=e;a=a.replace("mvapireq","mvstwebsock/mvapireq"),a=HandleApiKey(a),!isNull(a)&&a.indexOf("google.com")>0?PutToDebugLog(4,"EVENT, _common: WSRequest initialized"):PutToDebugLog(4,"EVENT, _common: WSRequest url: "+a);try{n=30,isNull(ws_action_sent)&&(ws_action_sent=[]),isNull(t)&&(t=""),ws_action_sent.push(t),void 0!==wssocket&&null!==wssocket||PutToDebugLog(2,"ERROR, _common: WSRequest wssocket is NULL 1"),global.wsc_reqtimeout=GetTickCount(),wssocket.send(a+"\r\n"),n=34}catch(s){PutToDebugLogWarning(3,"WARNING, common: WSRequest",s)}n=35}}catch(l){PutToDebugLogException(2,"common: WSRequest ("+n.toString()+")",l)}}function HandleQueueOverload(){try{var e=0,t=0;if(!isNull(ws_inurl)&&ws_inurl.length>0)for(;t<ws_inurl.length&&e<15;)"webrtcload"===ws_action[t]||"webrtccreateuser"===ws_action[t]?t++:(ws_inurl.splice(t,1),ws_action.splice(t,1),ws_ispost.splice(t,1),e++)}catch(o){PutToDebugLogException(2,"common: HandleQueueOverload",o)}}function WSConnect(e,t,o,n){var i=0;try{isNull(n)||n.length<2?PutToDebugLog(2,"ERROR, common: WSConnect websocketAPI address is NULL"):(i=2,0!==n.indexOf("ws")&&(n="ws://"+n),IsHttps()&&(n=n.replace("ws:","wss:")),n=n.toString(),PutToDebugLog(2,"EVENT, WSConnect websocketAPI address: "+n),global.wsc_contimeout=GetTickCount(),wsconnect_address=n,wssocket=new WebSocket(n,"api"),wssocket.binaryType="arraybuffer",i=5),wssocket.onopen=function(){global.wsc_contimeout=0,PutToDebugLog(2,"EVENT, common: WSConnect.onopen websocketAPI, connection ready"),SaveParameter("wseverconnected","true"),wsready=!0,HandleWsQueue()},wssocket.onclose=function(){PutToDebugLog(2,"EVENT, common: WSConnect.onclose websocketAPI, connection closed"),wssocket=null,wsready=!1},wssocket.onerror=function(e){var t="";isNull(e)||(t=e.toString()),PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, connection onerror: "+t),wsready=!1,wssocket=null,PutToDebugLog(2,"ERROR, common: WSConnect.onerror websocketAPI, call WSReConnect"),WSReConnect()},i=20,wssocket.onmessage=function(e){global.wsc_reqtimeout=0;var t=null;if(isNull(e)||(t=e.data),isNull(t))return void PutToDebugLog(2,"ERROR, common: WSConnect.onmessage websocketAPI, received data is NULL");var o="";isNull(ws_action_sent)||isNull(ws_action_sent[0])||(o=ws_action_sent.shift()),HttpResponseHandler(ArrayBufferToString(t),o)}}catch(r){PutToDebugLogException(2,"common: WSConnect websocketAPI ("+i.toString()+")",r)}}function WSReConnect(){try{if(++wsr_count<80&&null===wsr_timer){wsr_delay<32e3&&(wsr_delay*=2);return PutToDebugLog(2,"EVENT, WSReConnect websocketAPI after: "+(wsr_delay/1e3).toString()+" sec"),wsr_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, WSReConnect websocketAPI reconnecting..."),WSConnect("","","",wsconnect_address),isNull(wsr_timer)||clearTimeout(wsr_timer),wsr_timer=null},wsr_delay),wsr_delay<10&&(wsr_delay=500),!0}}catch(e){PutToDebugLogException(2,"common: WSReConnect websocketAPI",e)}}function HandleWsQueue(){try{if(isNull(ws_inurl)||ws_inurl.length<1)return;if(!isNull(hawsqueue_timer))return;hawsqueue_timer=setInterval(function(){if(isNull(ws_inurl)||ws_inurl.length<1)return isNull(hawsqueue_timer)||clearInterval(hawsqueue_timer),void(hawsqueue_timer=null);if(void 0===wssocket||null===wssocket)return void PutToDebugLog(2,"WARNING, _common: WSRequest HandleWsQueue wssocket is NULL 2");var e=ws_inurl.shift(),t=ws_action.shift();ws_ispost.shift();ws_action_sent.push(t),e=HandleApiKey(e),PutToDebugLog(4,"EVENT, _common: WSRequest HandleWsQueue SEND data: "+e),global.wsc_reqtimeout=GetTickCount(),wssocket.send(e+"\r\n")},200)}catch(e){PutToDebugLogException(2,"common: HandleWsQueue",e)}}function HandleApiKey(e){try{if(isNull(e))return e;var t=e,o=t.indexOf("mcrfs=");if(o>0&&(t=StrDc("mcrfs_"+t.substring(o+6),global.ec_apikey)),!isNull(global.selected_apikey)&&global.selected_apikey.length>0){var n=t.indexOf("authkey=");if(n>0){var i=t.substring(0,n+8),r="";t=t.substring(n+8),n=t.indexOf("&"),n>0&&(r=t.substring(n+1)),e=i+global.selected_apikey+r}o>0&&(e=e.substring(0,o+6)+StrEc(t,global.ec_apikey,!0))}else{if(t.indexOf("1568108399")>0)return e;if(t.indexOf("authkey=1568108345")>0&&"us"===global.usuk)t=t.replace("authkey=1568108345","authkey=1552303117"),e=o>0?e.substring(0,o+6)+StrEc(t,global.ec_apikey,!0):t;else if(t.indexOf("authkey=1552303117")>0&&"uk"===global.usuk)t=t.replace("authkey=1552303117","authkey=1568108345"),e=o>0?e.substring(0,o+6)+StrEc(t,global.ec_apikey,!0):t;else if(!isNull(wsconnect_address)&&wsconnect_address.length>3&&global.usuk.length>0){var a=0;if(wsuk_ip.length<1&&(wsuk_ip=StrDc(wip_uk,alsvkey),wsuk_domain=StrDc(wips_uk,alsvkey),wsus_ip=StrDc(wip_us,alsvkey),wsus_domain=StrDc(wips_us,alsvkey),o=-1,wsuk_ip=wsuk_ip.replace("ws://",""),o=wsuk_ip.lastIndexOf("/"),o>0&&(wsuk_ip=wsuk_ip.substring(0,o)),o=wsuk_ip.lastIndexOf(":"),o>0&&(wsuk_ip=wsuk_ip.substring(0,o)),wsus_ip=wsus_ip.replace("ws://",""),o=wsus_ip.lastIndexOf("/"),o>0&&(wsus_ip=wsus_ip.substring(0,o)),o=wsus_ip.lastIndexOf(":"),o>0&&(wsus_ip=wsus_ip.substring(0,o)),wsuk_domain=wsuk_domain.replace("wss://",""),o=wsuk_domain.lastIndexOf("/"),o>0&&(wsuk_domain=wsuk_domain.substring(0,o)),o=wsuk_domain.lastIndexOf(":"),o>0&&(wsuk_domain=wsuk_domain.substring(0,o)),wsus_domain=wsus_domain.replace("wss://",""),o=wsus_domain.lastIndexOf("/"),o>0&&(wsus_domain=wsus_domain.substring(0,o)),(o=wsus_domain.lastIndexOf(":"))>0&&(wsus_domain=wsus_domain.substring(0,o))),t.indexOf("authkey=1552303117")<0&&t.indexOf("authkey=1568108345")<0&&(wsconnect_address.indexOf(wsuk_ip)>=0||wsconnect_address.indexOf(wsuk_domain)>=0?a=1:(wsconnect_address.indexOf(wsus_ip)>=0||wsconnect_address.indexOf(wsus_domain)>=0)&&(a=2),a>0)){var s="";if(o=e.indexOf("mcrfs="),o>0&&(s=e.substring(0,e.indexOf("mcrfs=")+6)),(o=t.indexOf("authkey="))>0){var l=t.substring(0,o),c="";t=t.substring(o),o=t.indexOf("&"),o<0&&(o=t.length),o>0&&(c=t.substring(o)),isNull(c)&&(c="");var u="";u=1===a?"authkey=1568108345":"authkey=1552303117",t=l+u+c,e.indexOf("mcrfs=")>0&&(t=StrEc(t,global.ec_apikey,!0)),e=s+t}}}}}catch(m){PutToDebugLogException(2,"common: HandleApiKey",m)}return e}function HttpAsyncHandler(e){try{if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, HttpAsyncHandler notification is NULL");e=Trim(e),global.currhttpmehodworking=!0;var t="",o="";if("true"===GetConfig("usingmizuserver")){var n=e.indexOf("oenc1_");n>0&&(e=e.substring(n+6),e=StrDc(e,global.ec_apikey))}var n=e.indexOf("REQUEST:");if(n>0&&(o=e.substring(n+8,e.length),o=Trim(o)),(n=e.indexOf("RESULT:"))>=0){var i=e.indexOf("REQUEST:");i<1&&(i=e.length),t=e.substring(n+7,i),t=Trim(t),t.lastIndexOf(",")===t.length-1&&(t=Trim(t.substring(0,t.length-1)))}if(isNull(t)||t.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler response is NULL");if(isNull(o)||o.length<1)return void PutToDebugLog(2,"WARNING, HttpAsyncHandler request is NULL");if(o.indexOf("AUTOPROVISIONING")>=0){if(isNull(t)||!(t.toLowerCase().indexOf("endofautoprovisioning")>0))return void PutToDebugLog(2,"ERROR, HttpAsyncHandler autoprovidioning error: "+t);PutToDebugLog(2,"EVENT, HttpAsyncHandler autoprovidioning succeded: "+t),ParseAutoprovisioning(t),"false"===GetParameter("serverinputisupperserver")&&RestartPhone()}o.toLowerCase().indexOf("balance")>0||o.toLowerCase().indexOf("includecurrency")>0?HttpResponseHandler(t,"creditrequest"):o.toLowerCase().indexOf("rating")>0||o.toLowerCase().indexOf("tariffs")>0?HttpResponseHandler(t,"getrating"):o.toLowerCase().indexOf("=callback")>0?HttpResponseHandler(t,"callback"):o.toLowerCase().indexOf("=wsload")>0?HttpResponseHandler(t,"webrtcload"):o.toLowerCase().indexOf("srvct")>0?HttpResponseHandler(t,"downloadcontacts"):o.toLowerCase().indexOf("lastcalldetails")>0?HttpResponseHandler(t,"lastcalldetails"):o.toLowerCase().indexOf("wrtcload_uk")>0?HttpResponseHandler(t,"wrtcload_uk"):o.toLowerCase().indexOf("wrtcload_us")>0?HttpResponseHandler(t,"wrtcload_us"):o.toLowerCase().indexOf("scurl_displaypeerdetails")>0?HttpResponseHandler(t,"scurl_displaypeerdetails"):o.toLowerCase().indexOf("getconfroom")>0?HttpResponseHandler(t,"getconferenceroom"):o.toLowerCase().indexOf("waitforparameters")>0?HttpResponseHandler(t,"waitforparameters"):o.toLowerCase().indexOf("recharge")>0?HttpResponseHandler(t,"recharge"):o.toLowerCase().indexOf("tel.search.ch")>0?HttpResponseHandler(t,"telsearchname"):o.toLowerCase().indexOf("calldivert")>0?HttpResponseHandler(t,"calldivertapi"):o.toLowerCase().indexOf("presence_set")>0?HttpResponseHandler(t,"presence_set"):(o.toLowerCase().indexOf("get_custom_menu")>0||o.toLowerCase().indexOf("logincheck")>0)&&HttpResponseHandler(t,"get_custom_menu")}catch(r){PutToDebugLogException(2,"common: HttpAsyncHandler",r)}}function HttpResponseHandler(e,t){try{if(global.currhttpmehodworking=!0,!isNull(e)&&e.toString().indexOf("auth failed: wrong key")>=0){var o=e.toString();o=o.substring(0,o.indexOf("wrong key")+9)}if(isNull(e))return void PutToDebugLog(3,"ERROR, common: httpResponse is NULL");var n=e.toString(),i="";i=n.length>600?n.substring(0,600)+" ...":n;var r=n.toLowerCase();if(r.indexOf("wsuser")>=0||"webrtccreateuser"===t){var a=n;if(a.indexOf("DISPLAY")>0)return a=Trim(a.replace("DISPLAY","")),PutToDebugLog(1,a),void ShowToast(a);if(r.indexOf("ok:")>=0){var s=GetParameter("wsusers"),l=GetSipusername();if(webphone_api.iswebrtcengineworking=1,global.last_wsu_tick=GetTickCount(),l.length>0)s.indexOf(l)<0&&(s.length>0&&","!==s.charAt(s.length-1)&&(s+=","),s+=l,SaveParameter("wsusers",s));else{r.indexOf(" ")>0&&(r=Trim(r),l=r.substring(r.lastIndexOf(" ")+1),l=Trim(l),l.length>0&&s.indexOf(l)<0&&(s.length>0&&","!==s.charAt(s.length-1)&&(s+=","),s+=l,SaveParameter("wsusers",s)))}PutToDebugLog(3,"EVENT, common wsuser response: "+i),global.wsuser_succeded=!0}else PutToDebugLog(3,"ERROR, common wsuser failed, response: "+i);return}if(PutToDebugLog(3,"EVENT, common: httpResponse: "+i+"; action: "+t),isNull(t)||Trim(t).length<1)return void PutToDebugLog(2,"ERROR, common: HttpResponseHandler action is NULL");if("creditrequest"===t){var c=n.toLowerCase();if(c.indexOf("error")>=0&&50!==GetConfigInt("brandid",-1)||c.indexOf("postpaid")>=0||c.indexOf("invalid")>=0||c.indexOf("not found")>=0)global.creditRequestIval<3e4?global.creditRequestIval=2*global.creditRequestIval:global.creditRequestIval=global.CREDIT_REQUEST_IVAL_DEFVAL;else{if(50===GetConfigInt("brandid",-1)){var u=JSON.parse(n),m=u.data,g=u.error;if(!isNull(g)&&g.length>0)return void PutToDebugLog(2,"ERROR, Favafone creditrequest error: "+g);if(isNull(m))return void PutToDebugLog(3,"ERROR, Favafone creditrequest httpresponsehandler data is NULL");var d=m.balance,p=m.currency_sign;return d.length>0&&(global.credit="Credit: "+p+" "+d),void PutToDebugLog(4,"EVENT, Favafone received credit balance: "+global.credit)}n=n.replace("{",""),n=n.replace("}",""),n=ReplaceAll(n,'"',"");global.credit=""+n,global.credit.indexOf("Your credit is")>=0&&(global.credit=global.credit.replace("Your credit is","Credit:")),global.creditRequestIval=global.CREDIT_REQUEST_IVAL_DEFVAL}}else if("getrating"===t){if((n.toLowerCase().indexOf("error")>=0||n.indexOf("postpaid")>=0||n.indexOf("invalid")>=0||n.indexOf("not found")>=0)&&50!==GetConfigInt("brandid",-1))return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: Call, error: "+n);var h=n;if(50===GetConfigInt("brandid",-1)){var u=JSON.parse(n),f=u.data,g=u.error;if(!isNull(g)&&g.length>0)return void PutToDebugLog(2,"ERROR, Favafone getrating error: "+g);if(isNull(f)||isNull(f[0]))return void PutToDebugLog(3,"ERROR, Favafone getrating httpresponsehandler data is NULL");var b=f[0].voice_rate,v=f[0].description,p=f.currency_sign;if(b.length<1||"null"===b.toLowerCase())return void PutToDebugLog(2,"ERROR, Favafone getrating, rating request respose2: "+n);h=p+" "+b+" / min ("+v+")"}50!==GetConfigInt("brandid",-1)&&(h+=stringres.get("rating_minute")),ShowRatingWhyleType(h),global.rating=" ("+h+stringres.get("rating_minute")+")"}else if("get_custom_menu"===t)ProcessCustomMenu(n);else if("waitforparameters"===t)plhandler.ParseReceivedParameters(n);else if("presence_set"===t)HandleOfflineMessages(n);else if("webrtcload"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+n);var _=n.toLowerCase(),E=_.indexOf("ws load:");if(E>=0){if(_.indexOf("type:")>0){var T=_.substring(_.indexOf("type:")+5);T=Trim(T),!isNull(T)&&IsNumber(T)&&(global.wsload_type=StrToInt(T))}
_=_.substring(E+8),_=Trim(_);var P=-1;webphone_api.iswebrtcengineworking=1;try{P=parseInt(_,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var S=GetEngine("webrtc");if(S.serversupport_cache=P,SetEngine("webrtc",S),global.recwsload=P,P>2)if(P>3){if(!1===global.usestorage&&!1===Strl(60)&&getuseengine()===global.ENGINE_WEBRTC&&!0===CanIUseService()){SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var N=GetEngine("ns");N.clicked=2,SetEngine("ns",N),EngineSelect(1),PutToDebugLog(2,"WARNING, common wsload: offer ns engine because webrtc load is too high: "+P.toString()),EngineForcedInstall("ns",stringres.get("serviceengine_msg"),function(){webphone_api.startInner()})}}else setTimeout(function(){getuseengine()===global.ENGINE_WEBRTC&&(SaveParameter("enablepresence","0"),PutToDebugLog(2,"EVENT, disable presence because wsload is high: "+P.toString()))},5e3);else 2===P?global.presenceinterval=144e4:0===P&&(global.presenceinterval=36e4)}}else if("wrtcload_uk"===t||"wrtcload_us"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: webrtcload, error: "+n);var _=n.toLowerCase(),E=_.indexOf("ws load:");if(E>=0){var w=0;if(_.indexOf("pmsec:")>0){var I=_.substring(_.indexOf("pmsec:")+6);I=Trim(I),!isNull(I)&&IsNumber(I)&&(w=StrToInt(I))}_=_.substring(E+8),_=Trim(_);var P=-1;try{P=parseInt(_,10)}catch(A){PutToDebugLogException(2,"common: HttpResponseHandler parse webrtc load",A)}var C=GetParameter("last_good_webrtc_gw");"wrtcload_uk"===t?(wsl_uk=P,wsl_uk_time=GetTickCount()-w,isNull(C)||"uk"!==C||(wsl_uk_time-=15),global.wsl_uk_rec=!0):(wsl_us=P,wsl_us_time=GetTickCount()-w,isNull(C)||"us"!==C||(wsl_us_time-=15),global.wsl_us_rec=!0),DecideUsUk()}}else if("recharge"===t)n.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: recharge, error: "+n),ShowToast(n);else if("newuserreg"===t)newuser_public.HttpResponseHandler(n,t);else if("get_new_user_form_fields"===t||"newuser_dynamic"===t||"get_new_user_countrylist"===t)newuser_public.HttpResponseHandler(n,t);else if("verifysmscode"===t)smscodeverify_public.HttpResponseHandler(n,t);else if("phone2phone"===t)n.toLowerCase().indexOf("error")>=0&&PutToDebugLog(2,"ERROR, HttpResponseHandler action: phone2phone, error: "+n),ShowToast(n);else if("callback"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: callback, error: "+n);isNull(n)&&(n=""),n=Trim(n),ShowToast(n)}else if("presence_verify"===t||"presence_get"===t)PresenceProcessUserlist2(Trim(n),t);else if("downloadcontacts"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+n);ParseContactsFromServer(n,!1,function(e){e?(PutToDebugLog(1,"EVENT, "+stringres.get("sync_succeded")),PutToDebugLog(1,"EVENT, POPUP, "+stringres.get("sync_succeded")),global.reloadcontactsaftersync=!0):(PutToDebugLog(1,"ERROR, "+stringres.get("sync_failed")),PutToDebugLog(1,"EVENT, POPUP, "+stringres.get("sync_failed")))})}else if("lastcalldetails"===t)global.lastcalldetails=n;else if("additional_info"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+n);var R=n;R=ReplaceAll(R,"\r\n","<br>"),R=ReplaceAll(R,"\n","<br>"),isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, HttpResponseHandler Display additional call info: "+R),document.getElementById("page_call_additional_info").innerHTML=R)}else if("scurl_displaypeerdetails"===t){if(n.toLowerCase().indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+n);DisplayPeerDetails(n)}else if("getconferenceroom"===t)ConferenceRoomReceived(n);else if("webcontactsearch"===t)WebContactReceived(n);else if("telsearchname"===t)TelSearchNameReceived(n);else if("calldivertapi"===t){var y=n.toLowerCase();if(y.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+n);if(y.indexOf("ok")>=0){SaveParameter("calldivertsuccess","1");var L=GetParameter2("callforwardonbusy"),D=GetParameter2("callforwardonnoanswer"),G=GetParameter2("callforwardalways"),x=GetParameter2("callforwardonnoanswertimeout"),O=Md5Hash(L+D+G+x);SaveParameter("calldivertchecksum",O)}}else if("get_custom_menu"===t){var y=n.toLowerCase();if(y.indexOf("error")>=0)return void PutToDebugLog(2,"ERROR, HttpResponseHandler action: "+t+", error: "+n);ProcessCustomMenu(n)}}catch(k){PutToDebugLogException(2,"common: HttpResponseHandler",k)}}function WinAPI(e,t,o,n,i,r,a,s){try{if(t&&"function"==typeof t||(t=function(e){isNull(e)||(e=e.toString(),e.indexOf("OK:")>=0&&e.indexOf("wphone")>0&&e.indexOf("started")>0&&setTimeout(function(){global.phonestarted<2&&(global.phonestarted=2)},2e3)),PutToDebugLog(2,"EVENT, common: WinAPI NO callback specified; result: "+e)}),isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: WinAPI: apiname is NULL"),t(!1),!1;var l="BOFCOMMAND";l=l+"BOFLINEfunction="+e+"EOFLINE",!isNull(o)&&o.toString().length>0&&(o=Trim(o),l=l+"BOFLINEparam1="+o+"EOFLINE"),!isNull(n)&&n.toString().length>0&&(n=Trim(n),l=l+"BOFLINEparam2="+n+"EOFLINE"),!isNull(i)&&i.toString().length>0&&(i=Trim(i),l=l+"BOFLINEparam3="+i+"EOFLINE"),!isNull(r)&&r.toString().length>0&&(r=Trim(r),l=l+"BOFLINEparam4="+r+"EOFLINE"),!isNull(a)&&a.toString().length>0&&(a=Trim(a),l=l+"BOFLINEparam5="+a+"EOFLINE"),!isNull(s)&&s.toString().length>0&&(s=Trim(s),l=l+"BOFLINEparam6="+s+"EOFLINE"),l+="EOFCOMMAND";var c="";global.httpkatimer=GetTickCount(),IsWindowsSoftphone()?(c=AddJscommport(global.WIN_SOFTPHONE_URL)+c,PutToDebugLog(4,"EVENT, WinAPI windows url: "+c),WinSoftphoneHttpReq(c,"POST","data="+l,function(e){return t(e),e})):getuseengine()===global.ENGINE_SERVICE||!0===global.onunload_flag?WSAPIRequest("POST","data="+l,e,function(e){return t(e),e}):PutToDebugLog(2,"ERROR, common: winapi invalid engine/device: "+getuseengine()+"; apiname: "+e+"; data="+l)}catch(u){PutToDebugLogException(2,"common: WinAPI",u)}}function WinSoftphoneHttpReq(e,t,o,n){var i=0;try{var r="";if(isNull(o)||(r=o.length>300?o.substring(0,300)+"....":o),PutToDebugLog(2,"EVENT, WinSoftphoneHttpReq called "+t+" url: "+e+"; data: "+r),(isNull(t)||t.length<1)&&(i=1,PutToDebugLog(2,"WARNING, common: WinSoftphoneHttpReq: method not specified; fallback to GET"),t="GET"),i=2,isNull(o))return i=3,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: data is NULL "),cbexecuted=!0,n(null),"";i=4,o.indexOf("API_CallEOFLINE"),i=5,setTimeout(function(){if(i=6,!isNull(n)&&n&&"function"==typeof n)return i=7,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: manual Timeout"),n(null),n=null,""},reqtimeout+1e3);var a;window.XMLHttpRequest?(i=8,a=new XMLHttpRequest):(i=9,a=new ActiveXObject("Microsoft.XMLHTTP")),"get"===t.toLowerCase()?(i=10,a.open("GET",e+o,!0)):(a.open("POST",e,!0),i=11),a.onreadystatechange=function(){try{if(PutToDebugLog(4,"EVENT, WinSoftphoneHttpReq: xmlhttp.readyState: "+a.readyState+";  xmlhttp.status: "+a.status),i=19,4==a.readyState&&200==a.status){if(!1===global.httpheaderslogged&&a.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 2: "+a.getAllResponseHeaders())}var e=a.responseText,t="";t=!isNull(e)&&e.length>250?e.substring(0,250)+"....":e,isNull(t)&&(t="NULL"),i=20,PutToDebugLog(2,"EVENT, WinSoftphoneHttpReq response: "+t),cbexecuted=!0;var o="";if(i=21,isNull(e)||e.length<1)return i=23,isNull(n)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__1"):n(null),n=null,"";if(!(e.indexOf("APIREQUEST:")>=0))return i=42,isNull(n)?PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__3"):n(o),n=null,o;i=24;var r="",s="";if(e.indexOf("APIRESULT:")>0&&(i=25,e.indexOf("RPARAM1")>0?(r=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("RPARAM1:")),e.indexOf("RPARAM2")>0?(s=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("RPARAM2")),e.substring(e.indexOf("RPARAM2:")+8,e.indexOf("APIRESULT:"))):s=e.substring(e.indexOf("RPARAM1:")+8,e.indexOf("APIRESULT:")),o=e.substring(e.indexOf("APIRESULT:")+10,e.length)):(r=e.substring(e.indexOf("APIREQUEST:")+11,e.indexOf("APIRESULT:")),o=e.substring(e.indexOf("APIRESULT:")+10,e.length))),i=28,isNull(r)?r="":(r=Trim(r),r=r.toLowerCase()),o=isNull(o)?"":Trim(o),i=29,50===GetConfigInt("brandid",-1)&&(isNull(s)&&(s=""),s=s.toLowerCase(),s.indexOf("ww.favafone")>0))return s.indexOf("countries-list")>0?HttpResponseHandler(o,"get_new_user_countrylist"):s.indexOf("registration-form")>0?HttpResponseHandler(o,"get_new_user_form_fields"):s.indexOf("create-account")>0&&HttpResponseHandler(o,"newuser_dynamic"),o;if(isNull(n)&&PutToDebugLog(3,"EVENT, WinSoftphoneHttpReq inner_1 callback is null__2"),i=30,"api_poll"!==r){if(o.indexOf("ERROR")>=0){if(i=33,"api_call"===r){var l=o.replace("ERROR","");l=l.replace(":",""),PutToDebugLog(1,"ERROR, "+l)}else PutToDebugLog(2,"ERROR, "+o);return i=34,isNull(n)||n(null),n=null,""}return"true"===o.toLowerCase()?(isNull(n)||n(!0),n=null,!0):"false"===o.toLowerCase()?(isNull(n)||n(!1),n=null,!1):IsNumber(o)?(isNull(n)||n(StrToInt(o)),n=null,StrToInt(o)):o.indexOf("OK")>=0&&o.length<12?(i=37,isNull(n)||n(!0),n=null,!0):(isNull(n)||n(o),n=null,o)}i=31,webphonetojs(o),i=32,i=40,i=48}}catch(c){PutToDebugLogException(2,"common: WinSoftphoneHttpReq inner_1 ("+i+")",c)}},a.timeout=reqtimeout,a.ontimeout=function(e){if(!isNull(n)&&n&&"function"==typeof n)return i=49,PutToDebugLog(2,"ERROR, common: WinSoftphoneHttpReq: Timeout"),cbexecuted=!0,n(null),n=null,""},"get"===t.toLowerCase()?(o.length>0&&(o="?"+o),i=50,a.send()):(i=51,50===GetConfigInt("brandid",-1)&&PutToDebugLog(2,"EVENT, WinSoftphoneHttpReq SEND post request with data: "+o),a.send(o))}catch(s){PutToDebugLogException(2,"common: WinSoftphoneHttpReq ("+i+")",s)}}function GetNotifications2(){try{if(!0===nread)return;nread=!0;var e=GetParameter("notifications2");if(global.notifs=[],isNull(e)||e.length<10)return;var t=e.split(not_linesep);if(isNull(t)||t.length<1)return;for(var o=0;o<t.length;o++)if(!(isNull(t[o])||t[o].length<1||t[o].indexOf(",")<0)){var n=t[o].split(not_sep);isNull(n)||n.length<4||global.notifs.push(n)}}catch(i){PutToDebugLogException(2,"common: GetNotifications2",i)}}function SaveNotifications2(){var e="";try{if(!isNull(global.notifs)&&global.notifs.length>0)for(var t=0;t<global.notifs.length;t++)if(!(isNull(global.notifs[t])||global.notifs[t].length<1)){var o=global.notifs[t];isNull(o)||o.length<4||(e.length>0&&(e+=not_linesep),e=e+o[0]+not_sep+o[1]+not_sep+o[2]+not_sep+o[3])}SaveParameter("notifications2",e)}catch(n){PutToDebugLogException(2,"common: SaveNotifications2",n)}}function PutNotifications2(e,t,o,n){try{if(isNull(e)||!IsNumber(e))return void PutToDebugLog(4,"ERROR, common: PutNotifications2 invalid type");GetNotifications2(),isNull(t)&&(t=""),isNull(o)&&(o=""),(isNull(n)||!IsNumber(n)||n<1e3)&&(n=GetTickCount());var i=[];i[0]=e,i[1]=t,i[2]=o,i[3]=n.toString(),global.notifs.unshift(i),SaveNotifications2(),ShowNotifications2();var r=GetParameterInt("notification_count2",0);r<0&&(r=0),r++,SaveParameter("notification_count2",r)}catch(a){PutToDebugLogException(2,"common: PutNotifications2",a)}}function GetDateForNotifications(e){try{if(isNull(e)||!IsNumber(e)||e<1)return"";var t=new Date(e),o=t.getMinutes();o<10&&(o="0"+o);var n=t.getDate();n<10&&(n="0"+n);return month[t.getMonth()]+", "+n+" "+t.getHours()+":"+o}catch(i){PutToDebugLogException(2,"common: GetDateForNotifications",i)}return""}function ShowNotifications2(){try{if(GetNotifications2(),isNull(global.notifs)||global.notifs.length<1)return void HideNotificationsElements();for(var e="",t="",o="",n="",i='<li class="mlistitem"><a id="[PAGE]_notitem_[NOTID]" class="nt_anchor"><div class="nt_title">[TITLE]</div><div class="nt_desc">[DESC]</div><div class="nt_date">[DATE]</div></a><a id="[PAGE]_notmenu_[NOTID]" class="ui-btn ui-btn-inline ui-icon-delete nt_menu">'+stringres.get("hint_notif_clear")+"</a></li>",r=0;r<global.notifs.length;r++)if(!(isNull(global.notifs[r])||global.notifs[r].length<1)){var a=global.notifs[r],s=i;"0"===a[0]?(s=s.replace("[TITLE]",stringres.get("not_missed_call")+":"),s=s.replace("[DESC]",a[2])):"1"===a[0]&&(s=s.replace("[TITLE]",stringres.get("not_missed_chat")+":"),s=s.replace("[DESC]",a[2]));var l=StrToInt(a[3]);isNull(l)&&(l=0);var c=GetDateForNotifications(l);s=s.replace("[DATE]",c),s=ReplaceAll(s,"[NOTID]",r.toString()),e+=ReplaceAll(s,"[PAGE]","dialpad"),t+=ReplaceAll(s,"[PAGE]","contactslist"),o+=ReplaceAll(s,"[PAGE]","callhistorylist"),n+=ReplaceAll(s,"[PAGE]","message")}var u=GetParameterInt("notification_count2",0);e.length>0?(j$(".not_panel_title").html(stringres.get("not_panel_title")),j$(".not_close_btn").html(stringres.get("btn_close")),j$("#dialpad_notification_list").html(""),j$("#dialpad_notification_list").hasClass("ui-listview")&&j$("#dialpad_notification_list").append(e).listview("refresh"),u>0?(j$("#dialpad_not_counter").html(u),j$("#dialpad_not_counter").show()):(j$("#dialpad_not_counter").html(""),j$("#dialpad_not_counter").hide()),j$("#dialpad_not_btn").show(),j$("#contactslist_notification_list").html(""),j$("#contactslist_notification_list").hasClass("ui-listview")&&j$("#contactslist_notification_list").append(t).listview("refresh"),u>0?(j$("#contactslist_not_counter").html(u),j$("#contactslist_not_counter").show()):(j$("#contactslist_not_counter").html(""),j$("#contactslist_not_counter").hide()),j$("#contactslist_not_btn").show(),j$("#callhistorylist_notification_list").html(""),j$("#callhistorylist_notification_list").hasClass("ui-listview")&&j$("#callhistorylist_notification_list").append(o).listview("refresh"),u>0?(j$("#callhistorylist_not_counter").html(u),j$("#callhistorylist_not_counter").show()):(j$("#callhistorylist_not_counter").html(""),j$("#callhistorylist_not_counter").hide()),j$("#callhistorylist_not_btn").show(),j$("#messagelist_notification_list").html(""),j$("#messagelist_notification_list").hasClass("ui-listview")&&j$("#messagelist_notification_list").append(n).listview("refresh"),u>0?(j$("#messagelist_not_counter").html(u),j$("#messagelist_not_counter").show()):(j$("#messagelist_not_counter").html(""),j$("#messagelist_not_counter").hide()),j$("#messagelist_not_btn").show()):HideNotificationsElements()}catch(m){PutToDebugLogException(2,"common: ShowNotifications2",m)}}function HideNotificationsElements(){j$("#dialpad_notification_list").html(""),j$("#dialpad_not_counter").html(""),j$("#dialpad_not_counter").hide(),j$("#dialpad_not_btn").hide(),j$("#contactslist_notification_list").html(""),j$("#contactslist_not_counter").html(""),j$("#contactslist_not_counter").hide(),j$("#contactslist_not_btn").hide(),j$("#callhistorylist_notification_list").html(""),j$("#callhistorylist_not_counter").html(""),j$("#callhistorylist_not_counter").hide(),j$("#callhistorylist_not_btn").hide(),j$("#messagelist_notification_list").html(""),j$("#messagelist_not_counter").html(""),j$("#messagelist_not_counter").hide(),j$("#messagelist_not_btn").hide()}function HideCallNotifications2(){try{if(!isNull(global.notifs)||global.notifs.length>0){for(var e=0;e<global.notifs.length&&global.notifs.length>0;){var t=global.notifs[e];!isNull(t)&&t.length>0&&"0"===t[0]?global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(o){PutToDebugLogException(2,"common: HideCallNotifications2",o)}}function HideMessageNotifications2(){try{if(!isNull(global.notifs)||global.notifs.length>0){for(var e=0;e<global.notifs.length&&global.notifs.length>0;){var t=global.notifs[e];!isNull(t)&&t.length>0&&"1"===t[0]?global.notifs.splice(e,1):e++}SaveNotifications2()}ShowNotifications2()}catch(o){PutToDebugLogException(2,"common: HideMessageNotifications2",o)}}function NotificationOnClick2(e,t){try{if(isNull(e)||e.indexOf("notitem_")<0&&e.indexOf("notmenu_")<0)return void PutToDebugLog(4,"ERROR, common: NotificationOnClick2 invalid id: "+e);if(t){if(e=e.substring(e.indexOf("notmenu_")+8),isNull(e)||!IsNumber(e))return;var o=StrToInt(e);if(o>=0&&o<global.notifs.length)return global.notifs.splice(o,1),void ShowNotifications2()}else{if(e=e.substring(e.indexOf("notitem_")+8),isNull(e)||!IsNumber(e))return;var o=StrToInt(e);if(o>=0&&o<global.notifs.length){var n=global.notifs[o],i=n[0];"0"===i?j$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"1"===i&&j$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})}}}catch(r){PutToDebugLogException(2,"common: NotificationOnClick2",r)}}function PutNotifications(e,t,o){try{if(isNull(o)&&(o=!0),isNull(t))return void PutToDebugLog(2,"ERROR, common: PutNotifications number is NULL");var n=GetParameter("call_notifications"),i=GetParameter("message_notifications");if(n=isNull(n)?"":Trim(n),i=isNull(i)?"":Trim(i),o)if(n.length>2)if(IsNumber(n.charAt(0))){var r=StrToInt(n.charAt(0));n=n.replace(r.toString(),(r+1).toString())}else n="2 "+stringres.get("calls");else n=stringres.get("call_from")+": "+e+", "+t;else if(i.length>2)if(IsNumber(i.charAt(0))){var r=StrToInt(i.charAt(0));i=i.replace(r.toString(),(r+1).toString())}else i="2 "+stringres.get("messages");else i=stringres.get("message_from")+": "+e+", "+t;SaveParameter("call_notifications",n),SaveParameter("message_notifications",i),ShowNotifications()}catch(a){PutToDebugLogException(2,"common: PutNotifications",a)}}function ShowNotifications(){try{var e=GetParameter("call_notifications"),t=GetParameter("message_notifications"),o="";!isNull(e)&&e.length>2&&(o=e+"<br>"),o+=t,PutToDebugLog(2,"EVENT, ShowNotifications: "+o),j$("#dialpad_notification").html(o),j$("#contactslist_notification").html(o),j$("#callhistorylist_notification").html(o),j$("#messagelist_notification").html(o),!isNull(o)&&o.length>2?(j$("#msglist_title").hide(),j$("#messagelist_notification").show(),j$("#ctlist_title").hide(),j$("#contactslist_notification").show(),j$("#chlist_title").hide(),j$("#callhistorylist_notification").show(),j$("#dialpad_title").hide(),j$("#dialpad_notification").show()):(j$("#msglist_title").show(),j$("#messagelist_notification").hide(),j$("#ctlist_title").show(),j$("#contactslist_notification").hide(),j$("#chlist_title").show(),j$("#callhistorylist_notification").hide(),j$("#dialpad_title").show(),j$("#dialpad_notification").hide())}catch(n){PutToDebugLogException(2,"common: ShowNotifications",n)}}function HideCallNotifications(){try{SaveParameter("call_notifications","");var e=GetParameter("message_notifications");j$("#dialpad_notification").html(e),j$("#contactslist_notification").html(e),j$("#callhistorylist_notification").html(e),j$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(j$("#msglist_title").hide(),j$("#messagelist_notification").show(),j$("#ctlist_title").hide(),j$("#contactslist_notification").show(),j$("#chlist_title").hide(),j$("#callhistorylist_notification").show(),j$("#dialpad_title").hide(),j$("#dialpad_notification").show()):(j$("#msglist_title").show(),j$("#messagelist_notification").hide(),j$("#ctlist_title").show(),j$("#contactslist_notification").hide(),j$("#chlist_title").show(),j$("#callhistorylist_notification").hide(),j$("#dialpad_title").show(),j$("#dialpad_notification").hide())}catch(t){PutToDebugLogException(2,"common: HideCallNotifications",t)}}function HideMessageNotifications(){try{SaveParameter("message_notifications","");var e=GetParameter("call_notifications");j$("#dialpad_notification").html(e),j$("#contactslist_notification").html(e),j$("#callhistorylist_notification").html(e),j$("#messagelist_notification").html(e),!isNull(e)&&e.length>2?(j$("#msglist_title").hide(),j$("#messagelist_notification").show(),j$("#ctlist_title").hide(),j$("#contactslist_notification").show(),j$("#chlist_title").hide(),j$("#callhistorylist_notification").show(),j$("#dialpad_title").hide(),j$("#dialpad_notification").show()):(j$("#msglist_title").show(),j$("#messagelist_notification").hide(),j$("#ctlist_title").show(),j$("#contactslist_notification").hide(),j$("#chlist_title").show(),j$("#callhistorylist_notification").hide(),j$("#dialpad_title").show(),j$("#dialpad_notification").hide())}catch(t){PutToDebugLogException(2,"common: HideMessageNotifications",t)}}function HideAllNotifications(){try{SaveParameter("call_notifications",""),SaveParameter("message_notifications",""),j$("#dialpad_notification").html(""),j$("#contactslist_notification").html(""),j$("#callhistorylist_notification").html(""),j$("#messagelist_notification").html(""),j$("#msglist_title").show(),j$("#messagelist_notification").hide(),j$("#ctlist_title").show(),j$("#contactslist_notification").hide(),j$("#chlist_title").show(),j$("#callhistorylist_notification").hide(),j$("#dialpad_title").show(),j$("#dialpad_notification").hide()}catch(e){PutToDebugLogException(2,"common: HideAllNotifications",e)}}function NotificationOnClick(e){try{var t=GetParameter("call_notifications"),o=GetParameter("message_notifications");if(isNull(t)&&(t=""),isNull(o)&&(o=""),t.length<2&&o.length<2)return;if(t.length>2&&o.length<2)j$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"});else if(t.length<2&&o.length>2)j$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"});else{var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220;var i="",r='<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',a="";a=r.replace("[ITEMID]","#item_call_history"),a=a.replace("[ITEMTITLE]",stringres.get("callhistory")),i+=a,a="",a=r.replace("[ITEMID]","#item_message_history"),a=a.replace("[ITEMTITLE]",stringres.get("messagehistory")),i+=a,a="";var s='<div id="notification_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("goto")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="notifications_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+i+'</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";e=e||function(){},j$.mobile.activePage.append(s).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#notifications_ul").off("click","li"),e()}}),j$("#notifications_ul").on("click","li",function(e){var t=j$(this).attr("id");j$("#notification_popup").on("popupafterclose",function(e){j$("#notification_popup").off("popupafterclose"),"#item_call_history"===t?j$.mobile.changePage("#page_callhistorylist",{transition:"none",role:"page"}):"#item_message_history"===t&&j$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"})})})}}catch(l){PutToDebugLogException(2,"common: NotificationOnClick",l)}}function RestartPhone(){try{OpenSettings(!0,2),global.flagWaitforautoprov=!1,j$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),webphone_api.startInner()}catch(e){PutToDebugLogException(2,"common: RestartPhone",e)}}function ApiWinSaveFile(e,t,o){try{if(!o||"function"!=typeof o)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: filename is NULL"),o(!1),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFile: content is NULL"),o(!1),!1;t="BOFFILE"+t+"EOFFILE",e=Trim(e);WinSoftphoneHttpReq(AddJscommport(global.WIN_SOFTPHONE_URL)+"?extcmd_savedata="+e,"POST","data="+t,function(e){return o(e),e})}catch(n){PutToDebugLogException(2,"common: ApiWinSaveFile",n)}}function ApiWinLoadFile(e,t){try{if(!t||"function"!=typeof t)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile callback not defined"),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFile: filename is NULL"),t(null),!1;e=Trim(e);WinSoftphoneHttpReq(AddJscommport(global.WIN_SOFTPHONE_URL)+"?extcmd_loaddata="+e,"GET","",function(e){return isNull(e)||(e=StrDc(e,global.ec_apikey)),t(e),e})}catch(o){PutToDebugLogException(2,"common: ApiWinLoadFile",o)}}function ApiWinSaveFileNew(e,t,o,n){try{if(!o||"function"!=typeof o)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew callback not defined"),!1;var i=document.getElementById("EXTERNREQUESTELEM");if(isNull(i))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: html element: EXTERNREQUESTELEM is NULL"),o(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: filename is NULL"),o(!1),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common: ApiWinSaveFileNew: content is NULL"),o(!1),!1;t="BOFFILE"+t+"EOFFILEEOFCOMMAND",e=Trim(e);var r="";r=!isNull(n)&&n.length>0?n:"extcmd_savedata="+e,global.bwanswerINCNUMBER++,r=r+"&now="+global.bwanswerINCNUMBER.toString()+"\r\n",PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew cmd: "+r);var a=r+encodeURIComponent(t);return PutToDebugLog(2,"EVENT, common: ApiWinSaveFileNew encoded: "+a),i.innerHTML=a,o(!0),!0}catch(s){PutToDebugLogException(2,"common: ApiWinSaveFileNew",s)}}function bwanswer(e){try{if(PutToDebugLog(2,"ERROR, bwanswer called; answer: "+e),global.bwanswercallback&&"function"==typeof global.bwanswercallback)if(isNull(e)||e.length<1||e.indexOf("ERROR")>=0)global.bwanswercallback(null),global.bwanswercallback=null;else if(e.length>100||tempfile.length>10){if(tempfile=tempfile=e,tempfile.indexOf("EOFFILE")){var t=decodeURIComponent(tempfile);global.bwanswercallback(t),global.bwanswercallback=null}}else{var t=decodeURIComponent(e);global.bwanswercallback(t),global.bwanswercallback=null}else PutToDebugLog(2,"ERROR, bwanswer: bwanswercallback is NULL")}catch(o){PutToDebugLogException(2,"common: bwanswer",o)}}function ApiWinLoadFileNew(e,t){try{if(!t||"function"!=typeof t)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew callback not defined"),!1;var o=document.getElementById("EXTERNREQUESTELEM");if(isNull(o))return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: html element: EXTERNREQUESTELEM is NULL"),t(!1),!1;if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common: ApiWinLoadFileNew: filename is NULL"),t(null),!1;e=Trim(e),global.bwanswerINCNUMBER++;var n="extcmd_loaddata="+e+"&now="+global.bwanswerINCNUMBER.toString()+"\r\n";PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew cmd: "+n+"EOFCOMMAND"),global.bwanswercallback=t,o.innerHTML=n+"EOFCOMMAND",PutToDebugLog(2,"EVENT, common: ApiWinLoadFileNew  element.innerHTML: "+o.innerHTML)}catch(i){PutToDebugLogException(2,"common: ApiWinLoadFileNew",i)}}function Exit(){WinSoftphoneHttpReq(AddJscommport(global.WIN_SOFTPHONE_URL)+"?extcmd_exit=true","GET","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}function CallNumberProtocolHandler(e,t){try{if(isNull(e)||e.length<2||e.length>10)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid protocol: "+e);if(isNull(t)||t.length<1)return void PutToDebugLog(2,"ERROR, CallNumberProtocolHandler invalid number: "+t);var o=e+"://"+encodeURIComponent(t),n='<a href="'+o+'" id="make_native_call" style="display: none;">call</a>';j$("body").append(n),j$("#make_native_call").on("click",function(){var e=j$("#make_native_call").attr("href");j$("#make_native_call").remove(),window.location=e}),j$("#make_native_call").click(),ShowToast(stringres.get("native_call"))}catch(i){PutToDebugLogException(2,"common: CallNumberProtocolHandler",i)}}function EnterKeyPress(){try{return"page_dialpad"===j$.mobile.activePage.attr("id")?j$("#btn_call").click():"page_settings"===j$.mobile.activePage.attr("id")&&j$("#adialog_positive").click(),!0}catch(e){PutToDebugLogException(2,"common: EnterKeyPress",e)}return!1}function GetNrOfAcc(){try{if(!isNull(global.sipaccounts))return global.sipaccounts.length}catch(e){PutToDebugLogException(2,"common: GetNrOfAcc",e)}return 1}function SaveAccountsFile(e){try{if(global.flag_delsett>1||!0===GetParameterBool("resetsettings",!1))return void PutToDebugLog(2,"EVENT, SaveAccountsFile DO NOT SAVE, flag delsett is: "+global.flag_delsett.toString()+"; resetsettings is: "+GetParameterBool("resetsettings",!1));if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: SaveAccountsFile callback not defined");var t=GetAccountsFilename();if(isNull(global.aclist))return PutToDebugLog(2,"EVENT, SaveAccountsFile no accounts to be saved"),e(!1),!1;if(isNull(global.File))return PutToDebugLog(2,"EVENT, SaveAccountsFile File handling module not loaded yet"),e(!1),!1;for(var o="",n=null,i=0;i<global.aclist.length;i++)n=global.aclist[i],isNull(n)||(o.length>2&&(o+="\r\n"),o=o+n[AC_NAME]+","+n[AC_SIPUSERNAME]+","+n[AC_SETTFILE]+","+n[AC_CHFILE]+","+n[AC_ISACTIVE]);PutToDebugLog(2,"EVENT, acfile = "+o),IsWindowsSoftphone()&&(ApiWinSaveFile(t,o,function(t){e(!0)}),global.File.SaveFile(t,o,global.STORAGE_COOKIE,function(e){PutToDebugLog(2,"EVENT, SaveAccountsFile saved in cookie")})),global.File.SaveFile(t,o,global.STORAGE_LOCAL,function(t){e(t)})}catch(r){PutToDebugLogException(2,"common: SaveAccountsFile",r)}}function ReadAccountsFile(e){try{if(!e||"function"!=typeof e)return void PutToDebugLog(2,"ERROR, common: ReadAccountsFile callback not defined");var t=GetAccountsFilename();if(isNull(global.File))return PutToDebugLog(2,"ERROR, ReadAccountsFile File handling module not loaded yet"),e(!1),!1;IsWindowsSoftphone()?ApiWinLoadFile(t,function(o){isNull(o)||Trim(o).length<1?(PutToDebugLog(2,"WARNING, common: ReadAccountsFile no content WinApi"),global.File.ReadFile(t,global.STORAGE_COOKIE,function(t){if(isNull(t)||Trim(t).length<1){var o=[],n="Account"+GetSipusername(),i=Md5Hash(n+GetParameter("serveraddress_user")+GetSipusername()+global.SALT+GetParameter("password")+GetLocationPathName());o[AC_NAME]=n,o[AC_SIPUSERNAME]=GetSipusername(),o[AC_SETTFILE]=i,o[AC_CHFILE]=i+"_ch",o[AC_ISACTIVE]="true",global.aclist.push(o),PutToDebugLog(3,"EEVENT, common ReadAccountsFile(2) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(2) failed to saved")}),t=n+","+GetSipusername()+","+i+","+i+"_ch,true"}ParseAccountsReadFromFile(t,e)})):ParseAccountsReadFromFile(o,e)}):global.File.ReadFile(t,global.STORAGE_LOCAL,function(t){if(isNull(t)||Trim(t).length<1){var o=[],n=GetSipusername(),i="Account"+n,r=Md5Hash(i+GetParameter("serveraddress_user")+n+global.SALT+GetParameter("password")+GetLocationPathName());o[AC_NAME]=i,o[AC_SIPUSERNAME]=n,o[AC_SETTFILE]=r,o[AC_CHFILE]=r+"_ch",o[AC_ISACTIVE]="true",global.aclist.push(o),PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) saved successfully"):PutToDebugLog(3,"EVENT, common ReadAccountsFile(3) failed to saved")}),t=i+","+n+","+r+","+r+"_ch,true"}ParseAccountsReadFromFile(t,e)})}catch(o){PutToDebugLogException(2,"common: ReadAccountsFile",o)}}function ParseAccountsReadFromFile(e,t){try{var o=e.split("\r\n");if(isNull(o)||o.length<1)return PutToDebugLog(2,"ERROR, common: ParseAccountsReadFromFile empty content"),t(!1),!1;if(!isNull(global.aclist))for(var n in global.aclist)delete global.aclist[n]
;for(var i=!0,r=0;r<o.length;r++)if(isNull(o[r])||o[r].length<2||o[r].indexOf(",")<0||o[r].indexOf("true")<0&&o[r].indexOf("false")<0)PutToDebugLog(2,"WARNING, common ParseAccountsReadFromFile broken or invalid account (1): "+o[r]);else{i=!1;var a=o[r].split(",");global.aclist.push(a)}return i&&(PutToDebugLog(3,"ERROR, common ParseAccountsReadFromFile accounts is corrupt"),global.File.DeleteAllCookies(),global.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delsettings accounts result: "+e);var t=[],o="Account"+GetSipusername(),n=Md5Hash(o+GetParameter("serveraddress_user")+GetSipusername()+global.SALT+GetParameter("password")+GetLocationPathName());t[AC_NAME]=o,t[AC_SIPUSERNAME]=GetSipusername(),t[AC_SETTFILE]=n,t[AC_CHFILE]=n+"_ch",t[AC_ISACTIVE]="true",global.aclist.push(t),PutToDebugLog(3,"EEVENT, common ParseAccountsReadFromFile save new account file"),SaveAccountsFile(function(e){e?PutToDebugLog(3,"EVENT, common ParseAccountsReadFromFile Accounts file saved successfully"):PutToDebugLog(2,"ERROR, common ParseAccountsReadFromFile Accounts file save failed")})})),t(!0),!0}catch(s){PutToDebugLogException(2,"common: ParseAccountsReadFromFile",s)}}function GetActiveAccount(){try{if(isNull(global.aclist)||global.aclist.length<1)return PutToDebugLog(2,"WARNING, common GetActiveAccount no available accounts"),null;for(var e=0;e<global.aclist.length;e++)if(!(isNull(global.aclist[e])||global.aclist[e].length<2)){var t=global.aclist[e];if("true"===t[AC_ISACTIVE])return t}}catch(o){PutToDebugLogException(2,"common: GetActiveAccount",o)}return null}function GetActiveAccSettingsFilename(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccSettingsFilename cant get filename, probably doesn't exist"),""):isNull(e[AC_SETTFILE])||e[AC_SETTFILE].length<1?(PutToDebugLog(2,"ERROR, common GetActiveAccSettingsFilename no filename"),""):e[AC_SETTFILE]}catch(t){PutToDebugLogException(2,"common: GetActiveAccount",t)}return""}function GetActiveAccCallhistoryFilename(){try{var e=GetActiveAccSettingsFilename();return isNull(e)||e.length<1?"":e+"_ch"}catch(t){PutToDebugLogException(2,"common: GetActiveAccCallhistoryFilename",t)}return""}function GetActiveAccUsername(){try{var e=GetActiveAccount();return isNull(e)||e.length<2?(PutToDebugLog(2,"EVENT, common GetActiveAccUsername cant get active account"),""):isNull(e[AC_SIPUSERNAME])||e[AC_SIPUSERNAME].length<1?GetSipusername():e[AC_SIPUSERNAME]}catch(t){PutToDebugLogException(2,"common: GetActiveAccUsername",t)}return""}function GetAccountsFilename(){try{if(!isNull(sessionaccfilename)&&sessionaccfilename.length>0)return sessionaccfilename;var e=GetConfig("brandid");return(isNull(e)||e.length<1||"-1"==e)&&(e=GetBrandName().toLowerCase()),sessionaccfilename=global.ACCOUNTS_FILENAME+"_"+Md5Hash(GetLocationPathName()+e)}catch(t){PutToDebugLogException(2,"common: GetAccountsFilename",t)}return""}function GetLocationPathName(){try{if("false"==GetConfig("usepathinfilenames"))return"";if(!isNull(lpname)&&lpname.length>0)return lpname;var e=GetProfile();isNull(e)&&(e="");var t=location.href;isNull(t)&&(t=""),t=Trim(t),t=t.toLowerCase();var o=t.indexOf("file:");if(o>=0&&o<5){o=t.indexOf("?"),o>0&&(t=t.substring(0,o)),o=t.indexOf("#"),o>0&&(t=t.substring(0,o));var n="";o=t.lastIndexOf("/"),o>0&&(n=t.substring(o+1),t=t.substring(0,o),(isNull(n)||n.indexOf(".")>0)&&(n="")),lpname=t+n,isNull(lpname)&&(lpname=""),lpname=ReplaceAll(lpname,"/",""),e.length>0&&(lpname=lpname+"_"+e),PutToDebugLog(2,"EVENT, LPname local and profile: "+lpname)}else if(e.length>0){var i=location.hostname;isNull(i)&&(i=""),lpname=i+"_"+e,PutToDebugLog(2,"EVENT, LPname and profile: "+lpname)}else{var r=location.pathname;if(!isNull(r)&&r.length>0&&!isNull(location.protocol)&&("http:"===location.protocol.toLowerCase()||"https:"===location.protocol.toLowerCase())){r=Trim(r);var o=r.indexOf("/");if(0===o&&(r=r.substring(1)),(o=r.lastIndexOf("/"))>0){var a=r.substring(o);!isNull(a)&&a.indexOf(".")>0&&(r=r.substring(0,o))}o=r.lastIndexOf("?"),o>0&&(r=r.substring(0,o)),o=r.lastIndexOf("#"),o>0&&(r=r.substring(0,o)),r=ReplaceAll(r,"/",""),!isNull(r)&&r.length>0&&(lpname=Trim(r)),PutToDebugLog(2,"EVENT, LPname: "+lpname)}}return lpname}catch(s){PutToDebugLogException(2,"common: GetLocationPathName",s)}return""}function GetProfile(){try{if(!isNull(currprofile))return currprofile;currprofile="";var e=window.location.href;e=decodeURIComponent(e),e=e.toLowerCase();var t=e.indexOf("profile=");t>0&&(e=e.substring(t+8),t=e.indexOf("&"),t>0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>0&&(e=e.substring(0,t)),e=Trim(e),currprofile=e),currprofile.length<1&&!isNull(webphone_api.parameters)&&!isNull(webphone_api.parameters.profile)&&webphone_api.parameters.profile.length>0&&(currprofile=webphone_api.parameters.profile),currprofile.length<1&&!isNull(GetConfig("profile"))&&GetConfig("profile").length>0&&(currprofile=GetConfig("profile"))}catch(o){PutToDebugLogException(2,"common: GetProfile",o)}return currprofile}function GetSettFilenameSDK(){try{var e=Md5Hash("sdksettfilename"+GetLocationPathName()),t=GetConfig("brandid");return(isNull(t)||t.length<1||"-1"==t)&&(t=GetBrandName().toLowerCase()),e+=t}catch(o){PutToDebugLogException(2,"common: GetSettFilenameSDK",o)}return""}function Encrypt(e,t){try{if(isNull(t)||t.length<1||isNull(e))return PutToDebugLog(2,"ERROR, file: common no key or value"),null;for(var o="",n=0;n<t.length;n++)o+=t.charCodeAt(n).toString();var i=Math.floor(o.length/5),r=parseInt(o.charAt(i)+o.charAt(2*i)+o.charAt(3*i)+o.charAt(4*i)+o.charAt(5*i)),a=Math.ceil(t.length/2),s=Math.pow(2,31)-1;if(r<2)return PutToDebugLog(2,"ERROR, Algorithm cannot find a suitable hash. Please choose a different key. \nPossible considerations are to choose a more complex or longer key."),null;var l=Math.round(1e9*Math.random())%1e8;for(o+=l;o.length>10;)o=(parseInt(o.substring(0,10))+parseInt(o.substring(10,o.length))).toString();o=(r*o+a)%s;for(var c="",u="",n=0;n<e.length;n++)c=parseInt(e.charCodeAt(n)^Math.floor(o/s*255)),u+=c<16?"0"+c.toString(16):c.toString(16),o=(r*o+a)%s;for(l=l.toString(16);l.length<8;)l="0"+l;return u+=l}catch(m){PutToDebugLogException(2,"common: Encrypt",m)}return null}function Decrypt(e,t){try{if(isNull(e)||e.length<8)return PutToDebugLog(2,"ERROR, A salt value could not be extracted from the encrypted message because it's length is too short. The message cannot be decrypted."),null;if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a key with which to decrypt the message."),null;var o="",n=e.indexOf("almakorte_2_");n>=0&&(e=e.substring(n+12));for(var i=0;i<t.length;i++)o+=t.charCodeAt(i).toString();var r=Math.floor(o.length/5),a=parseInt(o.charAt(r)+o.charAt(2*r)+o.charAt(3*r)+o.charAt(4*r)+o.charAt(5*r)),s=Math.round(t.length/2),l=Math.pow(2,31)-1,c=parseInt(e.substring(e.length-8,e.length),16);for(e=e.substring(0,e.length-8),o+=c;o.length>10;)o=(parseInt(o.substring(0,10))+parseInt(o.substring(10,o.length))).toString();o=(a*o+s)%l;for(var u="",m="",i=0;i<e.length;i+=2)u=parseInt(parseInt(e.substring(i,i+2),16)^Math.floor(o/l*255)),m+=String.fromCharCode(u),o=(a*o+s)%l;return m}catch(g){PutToDebugLogException(2,"common: Decrypt",g)}return null}function B64Enc(e){try{if(isNull(e))return PutToDebugLog(2,"ERROR, B6 value could not be extracted"),null;if(e.length<1)return"";var t=e;return t=Base64.encode(t),t=ReplaceAll(t,"=","-"),t=ReplaceAll(t,"+","_"),t=ReplaceAll(t,"/",".")}catch(o){PutToDebugLogException(2,"common: B64Enc",o)}return e}function B64Dec(e){try{if(isNull(e))return"";if(e.indexOf("_BASE64_")<0)return e;var t=e.replace("_BASE64_","");return t=ReplaceAll(t,"-","="),t=ReplaceAll(t,"_","+"),t=ReplaceAll(t,".","/"),t=Base64.decode(t)}catch(o){PutToDebugLogException(2,"common: B64Dec",o)}return e}function StrEc(e,t,o){var n="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(2)"),null;if(e.length<1)return"";if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(2)"),null;for(var i=0,r=t.length,a=0,s=0;s<e.length;s++){a=e.charCodeAt(s)^t.charCodeAt(i),!0===o&&(a%=128)<0&&(a=95);n+=String.fromCharCode(a),i<r-1?i++:i=0}return n=Base64.encode(n),n=ReplaceAll(n,"=","-"),n=ReplaceAll(n,"+","_"),n=ReplaceAll(n,"/",".")}catch(l){PutToDebugLogException(2,"common: StrEc",l)}return null}function StrDc(e,t,o){var n="";try{if(isNull(e))return PutToDebugLog(2,"ERROR, A salt value could not be extracted(3)"),null;if(e.lenght<1)return e;if(isNull(t)||t.length<1)return PutToDebugLog(2,"ERROR, Please enter a correct key(3)"),e;if(e=e.toString(),e=Trim(e),0!==e.indexOf("encrypted")&&0!==e.indexOf("oenc1_")&&0!==e.indexOf("alenc1_")&&0!==e.indexOf("dcid_")&&0!==e.indexOf("wetrt_")&&0!==e.indexOf("mcrfs_"))return e;if(e=e.replace("oenc1_",""),e=e.replace("alenc1_",""),e=e.replace("dcid_",""),e=e.replace("wetrt_",""),e=e.replace("encrypted__3__",""),e=e.replace("encrypted__16__",""),e=e.replace("mcrfs_",""),e.indexOf("encrypted__4")>=0)return e=e.replace("encrypted__4__",""),e=Base64.decode(e);var i=e.indexOf("__");i>0&&(e=e.substring(i+2));i=e.indexOf("__"),i>=0&&(e.substring(0,i),e=e.substring(i+2)),e=ReplaceAll(e,"-","="),e=ReplaceAll(e,"_","+"),e=ReplaceAll(e,".","/"),e=Base64.decode(e);for(var r=0,a=t.length,s=0,l=0;l<e.length;l++){s=e.charCodeAt(l)^t.charCodeAt(r),!0===o&&(s%=128)<0&&(s=95);n+=String.fromCharCode(s),r<a-1?r++:r=0}return n}catch(c){PutToDebugLogException(2,"common: StrDc",c)}return null}function delsettings(e){try{if(isNull(e)||e<1)return void PutToDebugLog(4,"WARNING, delsettings invalid level parameter");if(PutToDebugLog(2,"EVENT, common delsettings called, level: "+e.toString()),e>2&&(e=2),global.flag_delsett=e,global.resetsett_handled=!0,2===e){global.File.DeleteFile(GetActiveAccCallhistoryFilename(),function(e){PutToDebugLog(2,"EVENT, delete call history file: "+GetActiveAccCallhistoryFilename()+" result: "+e)}),global.chlist=[],global.recentlist=[];var t=GetParameter("messagefiles");if(!isNull(t)){for(var o=t.split(","),n=0;n<o.length;n++)if(!(isNull(o[n])||o[n].length<3)){var i=o[n].indexOf("[#");i>0&&(o[n]=o[n].substring(0,i)),global.File.DeleteFile(o[n],function(e){PutToDebugLog(3,"EVENT, delsettings DeleteFile: "+o[n]+" status: "+e.toString())})}SaveParameter("messagefiles","")}var r=GetConfig("brandid");(isNull(r)||r.length<1||"-1"==r)&&(r=GetBrandName().toLowerCase()),global.File.DeleteFile(GetAccountsFilename(),function(e){PutToDebugLog(2,"EVENT, delete accounts file result: "+e)}),global.aclist=[],global.File.DeleteFile(global.CONTACTS_FILENAME+r,function(e){PutToDebugLog(2,"EVENT, delete contacts file result: "+e)}),global.ctlist=[]}global.File.DeleteAllCookies(),global.File.DeleteFile(GetActiveAccSettingsFilename(),function(e){PutToDebugLog(2,"EVENT, delete settings file: "+GetActiveAccSettingsFilename()+" result: "+e)}),settmap={},HandleSettings("","",function(){}),setTimeout(function(){global.flag_delsett=0,PutToDebugLog(2,"EVENT, delete settings flag delsett is reset to: 0")},250),OpenSettings(!0,3)}catch(a){PutToDebugLogException(2,"common: delsettings",a)}}function HideClearPassword(e){var t=e,o="";try{if(isNull(e))return PutToDebugLog(2,"WARNING, common: HideClearPassword textin is NULL"),"";var n=t.indexOf("password");if(n>0)return o=t.substring(0,n)+"password: *****",t=t.substring(n,t.length),n=t.indexOf("\r\n"),n<0&&(n=("password "+GetParameter("password")).length)>t.length&&(n=t.length-1),t=t.substring(n,t.length),o+=t}catch(i){PutToDebugLogException(2,"common: HideClearPassword",i)}return e}function UseCustomAutoprov(e){try{var t=GetParameter("customautoprov_url");if(isNull(t)||t.length<3)return!1;if(1==GetParameterInt("customautoprov_repeat",1)&&GetParameterInt("custautoprov_exectimes",0)>0)return!1;var o=GetParameterInt("customautoprov_when",1);return!(!0===e&&2==o||!1===e&&1==o)}catch(n){PutToDebugLogException(2,"common: UseCustomAutoprov",n)}return!1}function GetCustomAutoprov(e){try{var t=GetParameter("customautoprov_url");if(isNull(t)||t.length<5)return PutToDebugLog(2,"ERROR, GetCustomAutoprov invalid url"),void e("ERROR, GetCustomAutoprov invalid url");IsHttps()&&(t=t.replace("http:","https:")),t=UriParser(t,"","","","","return_uri"),PutToDebugLog(3,"EVENT, GetCustomAutoprov url: "+t),acploop++;var o=new XMLHttpRequest;if("withCredentials"in o)o.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetCustomAutoprov, CORS not supported"),void e("ERROR, GetCustomAutoprov CORS not supported callback");o=new XDomainRequest,o.open("GET",t)}var n=0;o.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetCustomAutoprov.onload"),n=19,!1===global.httpheaderslogged&&o.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, GetCustomAutoprov: HTTP request answer headers 3: "+o.getAllResponseHeaders())}var t=o.responseText;return n=20,PutToDebugLog(2,"EVENT, GetCustomAutoprov response: "+t),n=21,isNull(t)||t.length<1?(n=23,PutToDebugLog(2,"ERROR, GetCustomAutoprov response is NULL"),void e("")):void e(t)}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov.onload inner ("+n+")",i),e("ERROR, catch on: common: GetCustomAutoprov.onload inner ("+n+")")}},o.onerror=function(t){var o="";isNull(t)||(o=t.toString(),isNull(t.target)||(o=isNull(t.target.status)?o+" "+t.target.toString():o+" "+t.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: onerror: "+o),e("ERROR, common: GetCustomAutoprov: onerror FAILED")},o.timeout=9e3,o.ontimeout=function(t){PutToDebugLog(2,"ERROR, common: GetCustomAutoprov: Timeout"),e("ERROR, common: GetCustomAutoprov: ontimeout FAILED")},o.send()}catch(i){PutToDebugLogException(2,"common: GetCustomAutoprov",i),e("ERROR, common: GetCustomAutoprov: global failure")}}function RecAutoprovCustom(e){try{PutToDebugLog(3,"EVENT, RecAutoprovCustom: "+e);if(isNull(e)||Trim(e).length<=0||e.toLowerCase().indexOf("error")>=0&&e.length<160)return void PutToDebugLog(3,"ERROR, can't get custom autoprovisioning: "+e);if(e.indexOf("AUTOPROVISIONINGSTART")<0||e.indexOf("AUTOPROVISIONINGEND")<0)return void PutToDebugLog(3,"ERROR, custom autoprovisioning: no AUTOPROVISIONINGSTART and AUTOPROVISIONINGEND found: "+e);e=e.substring(e.indexOf("AUTOPROVISIONINGSTART")+21,e.indexOf("AUTOPROVISIONINGEND")),e=Trim(e);var t=e.split("\n");if(isNull(t)||t.length<1)return void PutToDebugLog(3,"ERROR, custom autoprovisioning invalid received data: "+e);var o=[];o.push("s"),o.push("e"),o.push("r"),o.push("v"),o.push("e"),o.push("r"),o.push("a"),o.push("d"),o.push("d"),o.push("r"),o.push("e"),o.push("s"),o.push("s");for(var n=o.join(""),i=0,r=0;r<t.length;r++)if(!(isNull(t[r])||t[r].length<3||t[r].indexOf(":")<1)){t[r]=Trim(t[r]);var a=Trim(t[r].substring(0,t[r].indexOf(":"))),s=Trim(t[r].substring(t[r].indexOf(":")+1));a=a.toLowerCase(),PutToDebugLog(5,"EVENT, custom autoprovisioning set: "+a+" = "+s),a!==n&&0!==Trim(a).indexOf(n)&&(SaveParameter(a,s),i++)}if(PutToDebugLog(2,"EVENT, RecAutoprovCustom number of configs received: "+i),i>1){var l=GetParameterInt("custautoprov_exectimes",0);l+=1,SaveParameter("custautoprov_exectimes",l.toString())}else PutToDebugLog(5,"WARNING, custom autoprovisioning probably failed because too few parameters found: "+i)}catch(c){PutToDebugLogException(2,"common: RecAutoprovCustom",c)}}function GetAutoprovisioning(e,t){try{if(getuseengine()!==global.ENGINE_WEBRTC&&getuseengine()!==global.ENGINE_FLASH)return PutToDebugLog(2,"ERROR, GetAutoprovisioning invalid engine: "+getuseengine()),void t("");(isNull(e)||e.length<1)&&(e=global.autoprovsrv_1);var o=GetParameter("serveraddress_user");if(isNull(o)||Trim(o).length<1)return PutToDebugLog(2,"ERROR, GetAutoprovisioning no serveraddress_user specified"),void t("ERROR, GetAutoprovisioning no serveraddress_user specified callback");e=e+o+".txt",IsHttps()&&(e=e.replace("http:","https:")),PutToDebugLog(3,"EVENT, GetAutoprovisioning url: "+e),aploop++;var n=new XMLHttpRequest;if("withCredentials"in n)n.open("GET",e,!0);else{if("undefined"==typeof XDomainRequest)return PutToDebugLog(2,"ERROR, common: GetAutoprovisioning, CORS not supported"),void t("ERROR, GetAutoprovisioning CORS not supported callback");n=new XDomainRequest,n.open("GET",e)}var i=0;n.onload=function(){try{if(PutToDebugLog(4,"EVENT, GetAutoprovisioning.onload"),i=19,!1===global.httpheaderslogged&&n.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 3: "+n.getAllResponseHeaders())}var e=n.responseText;return i=20,PutToDebugLog(2,"EVENT, GetAutoprovisioning response: "+e),i=21,isNull(e)||e.length<1?(i=23,PutToDebugLog(2,"ERROR, GetAutoprovisioning response is NULL"),void t("")):void t(e)}catch(o){PutToDebugLogException(2,"common: GetAutoprovisioning.onload inner ("+i+")",o),t("ERROR, catch on: common: GetAutoprovisioning.onload inner ("+i+")")}},n.onerror=function(e){var o="";isNull(e)||(o=e.toString(),isNull(e.target)||(o=isNull(e.target.status)?o+" "+e.target.toString():o+" "+e.target.status.toString())),PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: onerror: "+o),t("ERROR, common: GetAutoprovisioning: onerror FAILED")},n.timeout=9e3,n.ontimeout=function(e){PutToDebugLog(2,"ERROR, common: GetAutoprovisioning: Timeout"),t("ERROR, common: GetAutoprovisioning: ontimeout FAILED")},n.send()}catch(r){PutToDebugLogException(2,"common: GetAutoprovisioning",r),t("ERROR, common: GetAutoprovisioning: global failure")}}function ParseAutoprovisioning(e,t){try{!0===t?SaveParameter("cust_lastautoprov",GetTickCount().toString()):SaveParameter("lastautoprov",GetTickCount().toString()),e.lastIndexOf("EOFLINE")>0&&(e=ReplaceAll(e,"EOFLINE","\r\n")),SaveParameter("serveraddress_orig",GetAPparam("server",e)),SaveParameter("proxyaddress",GetAPparam("proxyserver",e)),SaveParameter("cfgusetunneling",GetAPparam("encryption",e)),SaveParameter("cfgusetunneling",GetAPparam("cfgusetunneling",e)),SaveParameter("techprefix",GetAPparam("techprefix",e)),SaveParameter("creditrequest",GetAPparam("creditrequest",e)),SaveParameter("ratingrequest",GetAPparam("ratingrequest",e)),SaveParameter("accounturi",GetAPparam("accounturi",e)),SaveParameter("newuser",GetAPparam("newuser",e)),SaveParameter("callback",GetAPparam("callback",e)),SaveParameter("p2p",GetAPparam("p2p",e)),SaveParameter("sms",GetAPparam("sms",e)),SaveParameter("brandname",GetAPparam("brandname",e)),SaveParameter("companyname",GetAPparam("companyname",e)),SaveParameter("homepage",GetAPparam("website",e)),SaveParameter("recharge",GetAPparam("recharge",e)),SaveParameter("brandtext",GetAPparam("brandtext",e)),SaveParameter("voicemail",GetAPparam("voicemail",e)),SaveParameter("voicemailnum",GetAPparam("voicemailnum",e)),SaveParameter("messagepopup",GetAPparam("messagepopup",e)),SaveParameter("messagedisplay",GetAPparam("messagedisplay",e)),SaveParameter("encryptionseries",GetAPparam("encryptionseries",e)),SaveParameter("directserveraddress",GetAPparam("directserveraddress",e)),SaveParameter("consoleaddress",GetAPparam("consoleaddress",e)),SaveParameter("httptunnelport",GetAPparam("httptunnelport",e)),SaveParameter("tcptunnelingport",GetAPparam("tcptunnelingport",e)),SaveParameter("rsakey_public_k",GetAPparam("rsakey_public_k",e)),SaveParameter("fastencryptkey",GetAPparam("fastencryptkey",e)),SaveParameter("autotransportdetect",GetAPparam("autotransportdetect",e)),SaveParameter("remotehttpport",GetAPparam("remotehttpport",e)),SaveParameter("encryptionmethod",GetAPparam("encryptionmethod",e)),SaveParameter("cantryudpdirectep",GetAPparam("cantryudpdirectep",e)),SaveParameter("usingmizuserver",GetAPparam("usingmizuserver",e)),SaveParameter("upperserver",GetAPparam("upperserver",e)),SaveParameter("serverinputisupperserver",GetAPparam("serverinputisupperserver",e)),SaveParameter("version",GetAPparam("version",e)),SaveParameter("header",GetAPparam("header",e)),SaveParameter("footer",GetAPparam("footer",e)),SaveParameter("logo",GetAPparam("logo",e)),SaveParameter("supportmail",GetAPparam("supportmail",e)),SaveParameter("supporturl",GetAPparam("supporturl",e)),SaveParameter("advertisement",GetAPparam("advertisement",e)),SaveParameter("helpurl",GetAPparam("helpurl",e)),SaveParameter("licenseurl",GetAPparam("licenseurl",e)),SaveParameter("extramenuurl",GetAPparam("extramenuurl",e)),SaveParameter("extramenutxt",GetAPparam("extramenutxt",e))}catch(o){PutToDebugLogException(2,"common: ParseAutoprovisioning",o)}}function GetAPparam(e,t){try{if(isNull(e)||e.length<1||isNull(t)||t.indexOf(e)<0)return"";var o=t.split("\r\n");if(isNull(o)||o.length<1)return"";for(var n=0;n<o.length;n++)if(!isNull(o[n])&&0===Trim(o[n]).indexOf(e+":")){var i=o[n].substring(o[n].indexOf(e+":")+e.length+1,o[n].length);return Trim(i)}}catch(r){PutToDebugLogException(2,"common: GetAPparam",r)}return""}function RandomInt(e,t){try{var o=t-e+1,n=Math.round(Math.random()*o)%o;return n+=Math.round(e)}catch(i){PutToDebugLogException(2,"common: RandomInt",i)}return 0}function RandomStr(e,t,o){try{if(isNull(e)||e<1)return"";isNull(t)&&(t=!1),isNull(o)&&(o=!1);var n=48;!1===o&&(n=65);for(var i="",r=0;r<5e3;r++){var a=RandomInt(n,122);if(!1===t?ASCII_NRLOWER.indexOf(a)>-1&&(i+=String.fromCharCode(a)):ASCII_ALL.indexOf(a)>-1&&(i+=String.fromCharCode(a)),i.length>=e)return i}return i}catch(s){PutToDebugLogException(2,"common: RandomStr",s)}return 0}function ShowModalLoader(e){try{j$("body").append('<div class="modalWindow"/>'),j$.mobile.loading("show",{text:e,textVisible:!0,theme:"b",html:""})}catch(t){PutToDebugLogException(2,"common: ShowModalLoader",t)}}function HideModalLoader(){try{j$(".modalWindow").remove(),j$.mobile.loading("hide")}catch(e){PutToDebugLogException(2,"common: HideModalLoader",e)}}function GetDefaultFontSize(e){var t=0;try{e=e||document.body;var o=document.createElement("span");return o.style.cssText="display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em",o.appendChild(document.createTextNode("M")),e.appendChild(o),t=o.offsetHeight,e.removeChild(o),isNull(t)&&(t=0),t}catch(n){PutToDebugLogException(2,"common: GetDefaultFontSize",n)}return 0}function ShowServerInput(){try{var e=GetParameter("showserverinput");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var t=webphone_api.parameters.serveraddress,o=GetConfig("serveraddress");return isNull(t)&&(t=""),isNull(o)&&(o=""),!(t.length>0||o.length>0)||"false"!==GetParameter("serverinputisupperserver")}}catch(n){PutToDebugLogException(2,"common: ShowServerInput",n)}return!1}function RequestUserServerInput(e){try{if(isNull(e)&&(e=GetParameter("upperserverfromuser")),"0"===e||"1"===e)return!1;if("3"===e)return!0;if("2"===e)return!!ShowServerInput()}catch(t){PutToDebugLogException(2,"common: RequestUserServerInput",t)}return!1}function GetAllContactsNumbersSipuris(){var e="";try{if(isNull(global.ctlist))return PutToDebugLog(2,"WARNING, common: GetAllContactsNumbersSipuris no numbers to return"),"";if(global.ctlist.length<1)return PutToDebugLog(2,"EVENT, common: GetAllContactsNumbersSipuris no numbers to return"),"";for(var t=0;t<global.ctlist.length;t++){var o=global.ctlist[t];if(!(isNull(o)||o.length<1)){var n=o[CT_NUMBER];if(!(isNull(n)||n.length<1))for(var i=0;i<n.length;i++)!isNull(n[i])&&n[i].length>0&&(e.length>0&&(e+=","),e+=n[i])}}return e}catch(r){PutToDebugLogException(2,"common: GetAllContactsNumbersSipuris",r)}return""}function SetDID(){try{if(sdcalled)return;sdt++,sdt>3&&(sdcalled=!0),setTimeout(function(){SetDID()},8e3);var e=RandomInt(1e4,99999999);WinAPI("API_SetDIDChange",null,e,Md5Hash("didchange"+e))}catch(t){PutToDebugLogException(2,"common: SetDIDX",t)}}function GtUc(){return unlockcodetrick}function GtUct(){return unlockcodetricktogled}function Hasesw(){return!isNull(alsv)&&alsv.length>0||!isNull(alsww)&&alsww.length>0}function Us(){return global.usestorage}function Alwr(){var e=!1;try{if(global.useengine!==global.ENGINE_WEBRTC||isNull(alswrt)||Trim(alswrt).length<1)return!0;var t=GetWebrtcSrvAddr();t=t.toLowerCase(),msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l"),msg.push("f"),msg.push("i"),msg.push("l"),msg.push("e");var o=msg.join("");msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l");var n=msg.join("");msg=[],msg.push("1"),msg.push("2"),msg.push("7"),msg.push("."),msg.push("0"),msg.push("."),msg.push("0"),msg.push("."),msg.push("1");var i=msg.join("");msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l"),msg.push("h"),msg.push("o"),msg.push("s"),msg.push("t");var r=msg.join(""),a=t.indexOf("//");if(a>0&&(t=t.substring(a+2,t.length)),a=t.indexOf("/"),a>0&&(t=t.substring(0,a)),a=t.indexOf(":"),a>0&&(t=t.substring(0,a)),t=t.replace("www.",""),isNull(t)||Trim(t).length<1)return!1;t=Trim(t);var s=StrDc(alswrt,alsvkey);if(!isNull(s)&&s.length>0){var l=s.split(",");if(!isNull(l)&&l.length>0)for(var c=0;c<l.length;c++)if(!(isNull(l[c])||l[c].length<1)){if(l[c]=Trim(l[c]),l[c]=l[c].toLowerCase(),t.indexOf(l[c])>=0){e=!0;break}if(l[c]===o&&!0===IsLocalFileSys()||l[c]===r&&(t.indexOf(i)>=0||t.indexOf(r)>=0)||l[c]===n&&(!0===IsLocalFileSys()||t.indexOf(i)>=0||t.indexOf(r)>=0)){e=!0;break}}}return e}catch(u){PutToDebugLogException(2,"common: Alwr",u)}return!1}function Awre(){if(!1===Alwr()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("w"),e.push("e"),e.push("b"),e.push("r"),e.push("t"),e.push("c"),e.push(" "),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var t=e.join("");setTimeout(function(){PutToDebugLog(1,t)},1881)}}function Alwm(){var e=!1;try{if(global.useengine!==global.ENGINE_WEBRTC)return!0;if((void 0===alsww||null==alsww||Trim(alsww).length<1)&&(void 0===malsx1||null==malsx1||44!==malsx1))return!1;if(isNull(alsww)||Trim(alsww).length<1)return!0;var t=GetParameter("aldm");if((isNull(t)||Trim(t).length<1)&&(t=window.location.href),isNull(t)||Trim(t).length<1)return!1;t=decodeURIComponent(t),t=t.toLowerCase(),msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l"),msg.push("f"),msg.push("i"),msg.push("l"),msg.push("e");var o=msg.join("");msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l");var n=msg.join("");msg=[],msg.push("1"),msg.push("2"),msg.push("7"),msg.push("."),msg.push("0"),msg.push("."),msg.push("0"),msg.push(".");var i=msg.join("");msg=[],msg.push("l"),msg.push("o"),msg.push("c"),msg.push("a"),msg.push("l"),msg.push("h"),msg.push("o"),msg.push("s"),msg.push("t");var r=msg.join(""),a=t.indexOf("//");if(a>0&&(t=t.substring(a+2,t.length)),a=t.indexOf("/"),a>0&&(t=t.substring(0,a)),a=t.indexOf(":"),a>0&&(t=t.substring(0,a)),t=t.replace("www.",""),isNull(t)||Trim(t).length<1)return!1;if(t=Trim(t),t.indexOf("localhost")>=0||t.indexOf("127.0.0.1")>=0)return!0;var s=StrDc(alsww,alsvkey);if(!isNull(s)&&s.length>0){var l=s.split(",");if(!isNull(l)&&l.length>0)for(var c=0;c<l.length;c++)if(!(isNull(l[c])||l[c].length<1)){if(l[c]=Trim(l[c]),l[c]=l[c].toLowerCase(),t.indexOf(l[c])>=0){e=!0;break}if(l[c]===o&&!0===IsLocalFileSys()||l[c]===r&&(t.indexOf(i)>=0||t.indexOf(r)>=0)||l[c]===n&&(!0===IsLocalFileSys()||t.indexOf(i)>=0||t.indexOf(r)>=0)){e=!0;break}}}return e}catch(u){PutToDebugLogException(2,"common: Alwm",u)}return!1}function Awe(){if(!1===Alwm()){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("W"),e.push("e"),e.push("b"),e.push("s"),e.push("e"),e.push("r"),e.push("v"),e.push("e"),e.push("r"),e.push(" "),e.push("n"),e.push("o"),e.push("t"),e.push(" "),e.push("a"),e.push("l"),e.push("l"),e.push("o"),e.push("w"),e.push("e"),e.push("d"),e.push("_"),e.push("1");var t=e.join("");setTimeout(function(){PutToDebugLog(1,t)},1881),setTimeout(function(){ShowToast(t)},1246)}}function Awb(){var e=Alwm();return!1===e&&Awe(),e=Alwr(),!1===e&&Awre(),e}function Awb2(){var e=Alwm();return!1===e&&Awe(),e}function CheckDID(e,t){var o=!1;try{if(isNull(e)||e.length<1)return!0!==t;e=e.toLowerCase();var n=e.indexOf(":");if(n>0&&(e=e.substring(0,n)),e=Trim(e),e.indexOf(".")<1)return!0;var i=[];i.push("l"),i.push("a"),i.push("n"),i.push("i"),i.push("p");var r=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("f"),i.push("i"),i.push("l"),i.push("e");var a=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l");var s=i.join("");i=[],i.push("1"),i.push("2"),i.push("7"),i.push("."),i.push("0"),i.push("."),i.push("0"),i.push("."),i.push("1");var l=i.join("");i=[],i.push("l"),i.push("o"),i.push("c"),i.push("a"),i.push("l"),i.push("h"),i.push("o"),i.push("s"),i.push("t");var c=i.join(""),u=[];u.push("w"),u.push("e"),u.push("b"),u.push("s"),u.push("e"),u.push("r"),u.push("v"),u.push("e"),u.push("r");var m=u.join("");if((void 0===alsv||null==alsv||Trim(alsv).length<1)&&(void 0===malsx1||null==malsx1||71!==malsx1))return!1;if(!(!isNull(alsv)&&alsv.length>0||!isNull(alsvir1)&&alsvir1.length>0||!isNull(alsvir2)&&alsvir2.length>0||!isNull(alsvir3)&&alsvir3.length>0))return!0!==t;var g=StrDc(alsv,alsvkey);if(!isNull(g)&&g.length>0){var d=g.split(",");if(!isNull(d)&&d.length>0){for(var p=0;p<d.length;p++)if(!(isNull(d[p])||d[p].length<1)&&(d[p]=Trim(d[p]),d[p]=d[p].toLowerCase(),m===d[p])){var h=e.indexOf("sip.");0===h&&(e=e.substring(h+4));var f=GetDomainFromURL(window.location.href);return!(isNull(f)||f.length<3)&&(f=f.toLowerCase(),f=Trim(f),h=f.indexOf("www."),0===h&&(f=f.substring(h+4)),e===f)}for(var p=0;p<d.length;p++)if(!(isNull(d[p])||d[p].length<1)){if(d[p]=Trim(d[p]),d[p]=d[p].toLowerCase(),e.indexOf(d[p])>=0){o=!0;break}if(d[p]===r&&IsLanIP(d[p])){o=!0;break}if(d[p]===a&&!0===IsLocalFileSys()||d[p]===c&&(e.indexOf(l)>=0||e.indexOf(c)>=0)||d[p]===s&&(!0===IsLocalFileSys()||e.indexOf(l)>=0||e.indexOf(c)>=0)){o=!0;break}}}}if(!isNull(alsvir1)&&Trim(alsvir1).length>2){var b=StrDc(alsvir1,alsvkey);b=Trim(b),b=b.toLowerCase(),0===e.indexOf(b)&&(o=!0)}if(!isNull(alsvir2)&&Trim(alsvir2).length>2){var v=StrDc(alsvir2,alsvkey);v=Trim(v),v=v.toLowerCase(),0===e.indexOf(v)&&(o=!0)}if(!isNull(alsvir3)&&Trim(alsvir3).length>2){var _=StrDc(alsvir3,alsvkey);_=Trim(_),_=_.toLowerCase(),0===e.indexOf(_)&&(o=!0)}}catch(E){PutToDebugLogException(2,"common: CheckDIDX",E)}return o}function Ch(){try{if(alsvu1.length<1&&alsvu2.length<1&&alsvu3.length<1)return!0;if(hua.length<1&&(hua=GetSipHeader("User-agent")),hsrv.length<1&&(hsrv=GetSipHeader("Server")),hsrvx.length<1&&(hsrvx=GetSipHeader("X-Server")),global.useengine!==global.ENGINE_WEBRTC)return!0;if(hua.length<1&&hsrv.length<1)return!1;hua=hua.toLowerCase(),hsrv=hsrv.toLowerCase(),hsrvx=hsrvx.toLowerCase();var e=alsvu1,t=alsvu2,o=alsvu3;isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(o)&&(o=""),e=StrDc(e,alsvkey),t=StrDc(t,alsvkey),o=StrDc(o,alsvkey),e=e.toLowerCase(),t=t.toLowerCase(),o=o.toLowerCase();var n=!1;if(hua.length>0&&(e.length>0&&hua.indexOf(e)>=0?n=!0:t.length>0&&hua.indexOf(t)>=0?n=!0:o.length>0&&hua.indexOf(o)>=0&&(n=!0)),hsrv.length>0&&(e.length>0&&hsrv.indexOf(e)>=0?n=!0:t.length>0&&hsrv.indexOf(t)>=0?n=!0:o.length>0&&hsrv.indexOf(o)>=0&&(n=!0)),hsrvx.length>0&&(e.length>0&&hsrvx.indexOf(e)>=0?n=!0:t.length>0&&hsrvx.indexOf(t)>=0?n=!0:o.length>0&&hsrvx.indexOf(o)>=0&&(n=!0)),(void 0===alsv||null==alsv||Trim(alsv).length<1)&&(void 0===malsx1||null==malsx1||71!==malsx1))return!1;if(!1===n&&!isNull(alsv)&&alsv.length>2){var i=GetParameter("serveraddress_user");(isNull(i)||i.length<2)&&(i=GetParameter("serveraddress")),n=CheckDID(i,!0)}return n}catch(r){PutToDebugLogException(2,"common: Ch",r)}return!0}function Loa(){if(lic_onlyandroidvideo<1)return!0;if(null===myLoaCachedvalueFrom){var e=[];e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push("e"),e.push("r"),e.push("e"),e.push("x"),e.push("t"),e.push("e"),e.push("n"),e.push("s"),e.push("i"),e.push("o"),e.push("n"),
e.push("="),e.push("3"),e.push("4"),e.push("5");var t=e.join("");e=[],e.push("A"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var o=e.join("");e=[],e.push("w"),e.push("e"),e.push("b"),e.push("v"),e.push("o"),e.push("i"),e.push("p"),e.push("p"),e.push("h"),e.push("o"),e.push("n"),e.push("e"),e.push("."),e.push("c"),e.push("o"),e.push("m");var n=e.join("");e=[],e.push("a"),e.push("r"),e.push("t"),e.push("c"),e.push("v"),e.push("i"),e.push("d"),e.push("e"),e.push("o"),e.push("c"),e.push("a"),e.push("l"),e.push("l");var i=e.join(""),r=window.location.href;myLoaCachedvalueFrom=!(GetOs()!==o||r.indexOf(n)<1||r.indexOf(i)<1||r.indexOf(t)<1)}return myLoaCachedvalueFrom}function Glsp(){var e=GetOs();e=e.toLowerCase();var t=[];t.push("w"),t.push("i"),t.push("n"),t.push("d"),t.push("o"),t.push("w"),t.push("s");var o=t.join("");t=[],t.push("m"),t.push("a"),t.push("c");var n=t.join("");t=[],t.push("l"),t.push("i"),t.push("n"),t.push("u"),t.push("x");var i=t.join("");return t=[],e===o||e===n||e===i||!(lic_smartphone<1)&&!(lic_smartphone<2&&lversion<2)}function Glv(){return lversion}function Glss(){return!(lic_screensharing<1)&&!(lic_screensharing<2&&lversion<2)}function Glbr(){return!(lic_balancerating<1)&&!(lic_balancerating<2&&lversion<2)}function Glop(){return!(lic_opus<1)&&!(lic_opus<2&&lversion<2)}function Glpr(){return!(lic_presence<1)&&!(lic_presence<2&&lversion<2)}function Glcr(){return!(lic_callrecord<1)&&!(lic_callrecord<2&&lversion<2)}function Glcf(){var e=[];return e.push("h"),e.push("a"),e.push("s"),e.push("c"),e.push("o"),e.push("n"),e.push("f"),e.push("e"),e.push("r"),e.push("e"),e.push("n"),e.push("c"),e.push("e"),!(!1===GetParameterBool(e.join(""),!0)||lic_conference<1||lic_conference<2&&lversion<2)}function Glft(){return!(lic_filetransfer<1)&&!(lic_filetransfer<2&&lversion<1)}function Glvd(){return!(lic_video<1)&&!(lic_video<2&&lversion<2)}function Glt(){return!(lic_transfer<1)&&!(lic_transfer<2&&lversion<1)}function Te(){try{var e=2016,t=11,o=10;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(s){return!0}try{t=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(s){return!0}try{o=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(s){return!0}if(e>2300)return!1;var n=new Date,i=n.getFullYear(),r=n.getMonth(),a=n.getDate();return r+=1,i>e||(i===e&&r>t||i===e&&r===t&&a>=o)}catch(s){PutToDebugLogException(2,"common: te",s)}return!0}function Te2(){try{var e=1008,t=11,o=1;e*=2;try{e=StrToInt(StrDc(usestoragetry2,alsvkey))}catch(l){return!0}try{t=StrToInt(StrDc(usestoragetrm2,alsvkey))}catch(l){return!0}if(e>2300)return!1;var n=new Date,i=n.getFullYear(),r=n.getMonth(),a=n.getDate();r+=1;var s=GetParameterInt("stgrnd",-1);return(s<0||s>27)&&(s=RandomInt(1,27),SaveParameter("stgrnd",s)),o=s,i>e||(i===e&&r>t||i===e&&r===t&&a>=o)}catch(l){PutToDebugLogException(2,"common: te2",l)}return!0}function Ted(){try{var e=2016,t=11,o=10;try{e=StrToInt(StrDc(usestoragetry,alsvkey))}catch(l){return!0}try{t=StrToInt(StrDc(usestoragetrm,alsvkey))}catch(l){return!0}try{o=StrToInt(StrDc(usestoragetrd,alsvkey))}catch(l){return!0}var n=new Date,i=n.getFullYear(),r=n.getMonth(),a=n.getDate();r+=1;var s=183;return s=2*s*(e-i),s+=30*(t-r),s+=o-a}catch(l){PutToDebugLogException(2,"common: ted",l)}return 0}function Strl(e){try{if(void 0!==e&&null!==e&&IsNumber(e)||(e=9,e*=10),Ted()<e){if(null===days_since_deploy){days_since_deploy=130;var t=GetConfig("lastdeploydate");if(!isNull(t)&&t.length>0&&t.indexOf("/")>0){var o=StrToIntDef(Trim(t.substring(0,t.indexOf("/"))),1);t=t.substring(t.indexOf("/")+1);var n=StrToIntDef(Trim(t.substring(0,t.indexOf("/"))),1);t=t.substring(t.indexOf("/")+1);var i=StrToIntDef(Trim(t.substring(0,t.indexOf(" "))),2018),r=new Date,a=r.getFullYear(),s=r.getMonth(),l=r.getDate();return s+=1,days_since_deploy=183,days_since_deploy=2*days_since_deploy*(a-i),days_since_deploy+=30*(s-o),!((days_since_deploy+=l-n)>e+10)}return!0}return!(days_since_deploy>e+10)}}catch(c){PutToDebugLogException(2,"common: strl",c)}return!1}function GetFp(){return StrDc(fip,alsvkey)}function GetWp(e){try{(isNull(e)||e.length<1)&&(e=global.usuk);var t="";return t=!0===BrowserRequiresHttps(!1)?"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wip_us,alsvkey):StrDc(wip_uk,alsvkey),t=t.replace("*","")}catch(o){PutToDebugLogException(2,"common: GetWp",o)}return""}function GetWpS(e){try{var t="";return t=isNull(e)||"uk"!==e&&"us"!==e?"us"===global.usuk?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey):"us"===e?StrDc(wips_us,alsvkey):StrDc(wips_uk,alsvkey),t=t.replace("*","")}catch(o){PutToDebugLogException(2,"common: GetWpS",o)}return""}function GetPassphrase(){try{return!isNull(pphe)&&pphe.length>0?pphe:(pphe=GetConfig("passphrase",!1),isNull(pphe)?"":(pphe.indexOf("dcid_")>=0&&(pphe=StrDc(pphe,alsvkey)),pphe))}catch(e){PutToDebugLogException(2,"common: GetPassphrase",e)}return""}function SvCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var t=e.join(""),o=GetParameter("serveraddress_user"),n=GetParameter("serveraddress_orig"),i=GetParameter("serveraddress");if(o.length>0&&o.toLowerCase().indexOf(t)||n.length>0&&n.toLowerCase().indexOf(t)||i.length>0&&i.toLowerCase().indexOf(t))return!0}catch(r){PutToDebugLogException(2,"common: SvCont",r)}return!1}function WbCont(){try{var e=[];e.push("m"),e.push("i"),e.push("z"),e.push("u"),e.push("-"),e.push("v"),e.push("o"),e.push("i"),e.push("p");var t=e.join(""),o=document.location.hostname;if(!isNull(o)&&o.length>2&&(o=o.toLowerCase(),o.indexOf(t)>=0))return!0}catch(n){PutToDebugLogException(2,"common: WbCont",n)}return!1}function IsServiceInstalled(e,t){function o(e){if(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onopen ML, connection ready: "+e),wready=!0,isNull(e))return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen ML websocket is NULL");if(e!==wsocket)return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen ML invalid websocket connection");e===wsocket&&(void 0!==wsocket&&null!==wsocket||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled ML wsocket is NULL"),wsocket.send("extcmd_test"));var t=GetEngine("ns");return t.isinstalled_cache=2,SetEngine("ns",t),ExecSrvInstalledCallback(!0),!0}function n(e){return PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onclose ML, connection closed: "+e),ExecSrvInstalledCallback(!1),!1}function i(e,t){var o="";if(!isNull(t))try{o=JSON.stringify(t)}catch(n){o=t.toString()}return PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onerror ML: "+e+": "+o),wready=!1,ExecSrvInstalledCallback(!1),!1}function r(e,t){var o=null;if(isNull(t)||isNull(t.data)||(o=ArrayBufferToString(t.data)),!isNull(wsocket)&&wsocket.close&&(wsocket.close(),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage ML websocket closed_1")),wsocket=null,!isNull(o)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage ML, received data: "+e+": "+o),o=o.toLowerCase(),o.indexOf("error")<0&&o.indexOf("extcmd_test")>=0)){var n=o.indexOf("apiresult:");if(n>0&&(o=o.substring(n+10)),!isNull(o)&&o.length>0)if(o.indexOf("version")<0)PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage ML, service upgrade needed(2): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0},5e3);else{var i=o.substring(o.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return ExecSrvInstalledCallback(!0),!0}function a(e){if(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onopen, connection ready: "+e),wready=!0,isNull(e))return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen websocket is NULL");if(e!==wsocket&&e!==wsocket2)return void PutToDebugLog(2,"ERROR, common: IsServiceInstalled.onopen invalid websocket connection");e===wsocket?(void 0!==wsocket&&null!==wsocket||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket is NULL"),wsocket.send("extcmd_test")):e===wsocket2&&(void 0!==wsocket2&&null!==wsocket2||PutToDebugLog(2,"ERROR, _common: IsServiceInstalled wsocket2 is NULL"),wsocket2.send("extcmd_test"));var t=GetEngine("ns");return t.isinstalled_cache=2,SetEngine("ns",t),ExecSrvInstalledCallback(!0),!0}function s(e){return PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onclose, connection closed: "+e),ExecSrvInstalledCallback(!1),!1}function l(e,t){var o="";if(!isNull(t))try{o=JSON.stringify(t)}catch(n){o=t.toString()}return PutToDebugLog(2,"EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onerror: "+e+": "+o),wready=!1,ExecSrvInstalledCallback(!1),!1}function c(e,t){var o=null;if(isNull(t)||isNull(t.data)||(o=ArrayBufferToString(t.data)),!isNull(wsocket)&&wsocket.close&&(wsocket.close(),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_1")),wsocket=null,!isNull(wsocket2)&&wsocket2.close&&(wsocket2.close(),PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage websocket closed_2")),wsocket2=null,2===e&&(global.NATIVE_PLUGIN_URL_SECURE=global.NATIVE_PLUGIN_URL_SECURE2),!isNull(o)&&(PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, received data: "+e+": "+o),o=o.toLowerCase(),o.indexOf("error")<0&&o.indexOf("extcmd_test")>=0)){var n=o.indexOf("apiresult:");if(n>0&&(o=o.substring(n+10)),!isNull(o)&&o.length>0)if(o.indexOf("version")<0)PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(2): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0},5e3);else{var i=o.substring(o.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return ExecSrvInstalledCallback(!0),!0}if(!0===IsWinMacLinNsTest())return e(!0),!0;try{if(e&&"function"==typeof e||(e=function(){}),"Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return e(!1),!1;if(void 0!==srvinstalled_callback&&null!==srvinstalled_callback||(srvinstalled_callback=[]),srvinstalled_callback.push(e),"0"===GetParameter2("enginepriority_ns")||"5"===GetParameter2("enginepriority_java")||"5"===GetParameter2("enginepriority_webrtc")||"5"===GetParameter2("enginepriority_flash")||"5"===GetParameter2("enginepriority_app")||"5"===GetParameter2("enginepriority_p2p")||"5"===GetParameter2("enginepriority_accessnum")||"5"===GetParameter2("enginepriority_nativedial"))return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of priority"),ExecSrvInstalledCallback(!1),!1;if(!0!==t){var u=GetLastUsedEngine(),m=GetParameterInt("enginepriority_ns",2);if(!isNull(u)&&u.length>0&&u!==global.ENGINE_SERVICE&&m<=2)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned FLASE because of priority2"),ExecSrvInstalledCallback(!1),!1}if(wready)return PutToDebugLog(2,"EVENT, IsServiceInstalled returned TRUE already checked"),ExecSrvInstalledCallback(!0),!0;if(lastCheckTick>0&&GetTickCount()-lastCheckTick<2e3)return;if(lastCheckTick=GetTickCount(),!0===NSMacLinEnabled()){try{var g=global.NATIVE_PLUGIN_LINMAC_URL_SECURE;try{PutToDebugLog(2,"EVENT, IsServiceInstalled ML url: "+g),wsocket&&wsocket.close&&wsocket.close(),wsocket=null,wsocket=new WebSocket(g,"api"),wsocket.binaryType="arraybuffer",f=!0}catch(v){PutToDebugLogException(2,"IsServiceInstalled ML failed to connect to: "+g,v)}wsocket.onopen=function(){o(wsocket)},wsocket.onclose=function(){n(1)},wsocket.onerror=function(e){i(1,e)},wsocket.onmessage=function(e){r(1,e)}}catch(_){return PutToDebugLogException(2,"common: ServiceInstalled ML",_),e&&"function"==typeof e&&e(!1),!1}return!0}var d=global.NATIVE_PLUGIN_URL,p="",h=!1;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(d=global.NATIVE_PLUGIN_URL_SECURE,p=global.NATIVE_PLUGIN_URL_SECURE2,h=!0);var f=!1;try{PutToDebugLog(2,"EVENT, IsServiceInstalled url: "+d),wsocket&&wsocket.close&&wsocket.close(),wsocket=null,wsocket=new WebSocket(d,"api"),wsocket.binaryType="arraybuffer",f=!0}catch(E){PutToDebugLogException(2,"IsServiceInstalled failed to connect to: "+d,E)}if(p.length>0)try{PutToDebugLog(2,"EVENT, IsServiceInstalled url2: "+p),wsocket2&&wsocket2.close&&wsocket2.close(),wsocket2=null,wsocket2=new WebSocket(p,"api"),wsocket2.binaryType="arraybuffer",f=!0}catch(E){PutToDebugLogException(2,"IsServiceInstalled failed to connect to_2: "+d,E)}if(!1===f&&!1===h){d=global.NATIVE_PLUGIN_URL_SECURE;try{wsocket&&wsocket.close&&wsocket.close(),wsocket=null,wsocket=new WebSocket(d,"api"),wsocket.binaryType="arraybuffer",f=!0}catch(T){PutToDebugLogException(2,"IsServiceInstalled failed to connect on 2nd attempt to (on SECURE connection) : "+d,T)}if(p.length>0)try{wsocket2&&wsocket2.close&&wsocket2.close(),wsocket2=null,wsocket2=new WebSocket(p,"api"),wsocket2.binaryType="arraybuffer",f=!0}catch(T){PutToDebugLogException(2,"IsServiceInstalled failed to connect on 2nd attempt to (on SECURE connection)_2 : "+d,T)}}if(!1===f){var b=global.NATIVE_PLUGIN_URL;!0===BrowserRequiresHttps(!1)&&(b=global.NATIVE_PLUGIN_URL_SECURE),b=b.toLowerCase(),b=b.replace("wss:","https:"),b=b.replace("ws:","http:"),b=b.replace("msstwebsock","extcmd_test"),PutToDebugLog(2,"EVENT, IsServiceInstalled try ajax, url: "+b),j$.ajax(b).done(function(e,t,o){if(wready=!0,PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax connected, status: "+t+"; msg: "+e),!isNull(e)&&(e=e.toLowerCase(),e.indexOf("error")<0)){var n=e.indexOf("apiresult:");if(n>0&&(e=e.substring(n+10)),!isNull(e)&&e.length>0)if(e.indexOf("version")<0)PutToDebugLog(2,"EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(1): "+GetMinServiceVersion().toString()),setTimeout(function(){EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0},5e3);else{var i=e.substring(e.indexOf("version")+7);isNull(i)&&(i=""),i=i.replace(":",""),i=Trim(i),i.indexOf(" ")>0&&(i=Trim(i.substring(0,i.indexOf(" ")))),!isNull(i)&&IsNumber(i)&&SaveParameter("srvupgrade_currversion_extcmd_test",i)}}return PutToDebugLog(2,"EVENT, common: IsServiceInstalled AJAX it is installed"),ExecSrvInstalledCallback(!0),!0}).fail(function(e,t,o){return wready=!1,PutToDebugLog(2,"EVENT, common: IsServiceInstalled ajax failed, status: "+t+"; error: "+o),ExecSrvInstalledCallback(!1),!1}),wsocket={}}isNull(wsocket2)&&(wsocket2={}),wsocket.onopen=function(){a(wsocket)},wsocket2.onopen=function(){a(wsocket2)},wsocket.onclose=function(){s(1)},wsocket2.onclose=function(){s(2)},wsocket.onerror=function(e){l(1,e)},wsocket2.onerror=function(e){l(2,e)},wsocket.onmessage=function(e){c(1,e)},wsocket2.onmessage=function(e){c(2,e)}}catch(_){return PutToDebugLogException(2,"common: ServiceInstalled",_),e&&"function"==typeof e&&e(!1),!1}}function ExecSrvInstalledCallback(e){try{if(void 0===srvinstalled_callback||null===srvinstalled_callback||srvinstalled_callback.length<1)return;for(;srvinstalled_callback.length>0;)try{var t=srvinstalled_callback.shift();if("function"!=typeof t||null===t)continue;t(e)}catch(o){PutToDebugLogException(2,"common: ExecSrvInstalledCallback inner while",o);continue}}catch(o){PutToDebugLogException(2,"common: ExecSrvInstalledCallback",o)}srvinstalled_callback=null,srvinstalled_callback=[]}function ServiceStartPolling(){try{if(stopPolling)return;PutToDebugLog(5,"EVENT, common: ServiceStartPolling"),IsServiceInstalled(function(e){global.phonestarted<3&&(!1===e?setTimeout(function(){ServiceStartPolling()},1e3):(SaveParameter("lastusedengine","ns"),webphone_api.startInner(),!1===IsSDK()&&j$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"})))},!0)}catch(e){PutToDebugLogException(2,"common: ServiceStartPolling",e)}}function ApplyParameters(e){try{if(!isNull(e)){var t;for(t in e)if(!isNull(t)&&t.length>0&&!isNull(e[t])){if("loglevel"===t&&!1===ParameterIsDefault("loglevel"))continue;var o=t;"aec"===o?o="aec_orig":"agc"===o?o="agc_orig":"denoise"===o?o="denoise_orig":"plc"===o?o="plc_orig":"sippassword"===o&&(o="password");var n=Trim(e[t]);0===n.indexOf("encrypted__3__")&&(n=StrDc(n,GetPassphrase())),webphone_api.setparameter(o,n),"serveraddress"===t?(SaveParameter("serveraddress_user",n),"true"===GetParameter("serverinputisupperserver")?SaveParameter("upperserver",n):SaveParameter("serveraddress_orig",n)):SaveParameter(t,n)}}}catch(i){PutToDebugLogException(2,"common: ApplyParameters",i)}}function GetEngineDisplayName(e){var t="";try{if(isNull(e)||e.length<1)return"";switch(e){case"java":t="Java";break;case"ns":t="NS - Service Plugin";break;case"webrtc":t="WebRTC";break;case"flash":t="Flash";break;case"app":t="App - Native Application";break;case"p2p":t="Phone to Phone";break;case"accessnum":t="Access Number";break;case"nativedial":t="Native Dialer";break;case"otherbrowser":t="Alternate Browser"}return t}catch(o){PutToDebugLogException(2,"common: GetEngineDisplayName",o)}return""}function ChooseEngineLogic2(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;if(isNull(e)||e.length<1)return void PutToDebugLog(2,"ERROR, ChooseEngineLogic2 invalid engine");if("java"===e)return void(IsJavaInstalled()<1&&InstallJavaPopup(!0));if("ns"!==e)return;var t=GetEngine("ns");t.isinstalled_cache<0?IsServiceInstalled(function(e){!1===e&&NPDownloadAndInstall()},!0):0===t.isinstalled_cache&&NPDownloadAndInstall()}catch(o){PutToDebugLogException(2,"common: ChooseEngineLogic2",o)}}function ChooseEngineLogic(e,t){try{if(PutToDebugLog(4,"EVENT, ChooseEngineLogic"),!1===Glsp())return void PutToDebugLog(2,"WARNING, ChooseEngineLogic wait");if(Glv()<=0&&"Chrome"===GetBrowser()){var o=[];o.push("E"),o.push("R"),o.push("R"),o.push("O"),o.push("R"),o.push(","),o.push(" "),o.push("T"),o.push("h"),o.push("e"),o.push(" "),o.push("B"),o.push("a"),o.push("s"),o.push("i"),o.push("c"),o.push(" "),o.push("v"),o.push("e"),o.push("r"),o.push("s"),o.push("i"),o.push("o"),o.push("n"),o.push(" "),o.push("o"),o.push("f"),o.push(" "),o.push("W"),o.push("e"),o.push("b"),o.push("p"),o.push("h"),o.push("o"),o.push("n"),o.push("e"),o.push(" "),o.push("d"),o.push("o"),o.push("e"),o.push("s"),o.push(" "),o.push("n"),o.push("o"),o.push("t"),o.push(" "),o.push("s"),o.push("u"),o.push("p"),o.push("p"),o.push("o"),o.push("r"),o.push("t"),o.push(" "),o.push("C"),o.push("h"),o.push("r"),o.push("o"),o.push("m"),o.push("e"),o.push(" "),o.push("b"),o.push("r"),o.push("o"),o.push("w"),o.push("s"),o.push("e"),o.push("r"),o.push("_");var n=o.join("");return setTimeout(function(){PutToDebugLog(1,n)},1400),setTimeout(function(){AlertDialog("",n)},2400),void e(!1)}var i="",r=GetSelectedEngine(),a=GetRecommendedEngine();if(!isNull(r)&&r.name===global.ENGINE_SERVICE&&-3===GetMinServiceVersion())return PutToDebugLog(2,"EVENT, ChooseEngineLogic: "+r.name+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString()),void e();if(!0===t){var s=GetSinglePossibleEngine();if(!isNull(r)&&r.name===global.ENGINE_APP||s===global.ENGINE_APP)return GetParameterInt("enginepriority_app",2)<1?void(!0===global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+stringres.get("only_app_engine1")),AlertDialog("Warning",stringres.get("only_app_engine1"))):(PutToDebugLog(1,"WARNING,"+stringres.get("only_app_engine2")),AlertDialog("Warning",stringres.get("only_app_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+global.ENGINE_APP),selected_engine=GetEngine(global.ENGINE_APP),void e());if(!isNull(r)&&r.name===global.ENGINE_SERVICE||s===global.ENGINE_SERVICE){var l=GetParameterInt("enginepriority_ns",2);return l<1?void("Windows"===GetOs()&&r.name===global.ENGINE_WEBPHONE?(PutToDebugLog(1,"WARNING,"+stringres.get("only_ns_engine3")),AlertDialog("Warning",stringres.get("only_ns_engine3"))):!0===global.usestorage||Strl(60)?(PutToDebugLog(1,"WARNING,"+stringres.get("only_ns_engine1")),AlertDialog("Warning",stringres.get("only_ns_engine1"))):(PutToDebugLog(1,"WARNING,"+stringres.get("only_ns_engine2")),AlertDialog("Warning",stringres.get("only_ns_engine2")))):(PutToDebugLog(2,"EVENT, Selected only possible engine: "+global.ENGINE_SERVICE),selected_engine=GetEngine(global.ENGINE_SERVICE),e(),void(5!==l&&IsServiceInstalled(function(e){!1===e&&(PutToDebugLog(2,"EVENT, common: ChooseEngineLogic, install service: "+GetMinServiceVersion().toString()),EngineForcedInstall("ns"))},!0)))}if(!isNull(r)&&r.name===global.ENGINE_WEBPHONE&&0==CanIUseApplet()&&s===global.ENGINE_WEBRTC&&GetParameterInt("enginepriority_java",2)>GetParameterInt("enginepriority_webrtc",2)+1)return void("Windows"===GetOs()?(PutToDebugLog(1,"WARNING,"+stringres.get("only_ns_engine3")),AlertDialog("Warning",stringres.get("only_ns_engine3"))):(PutToDebugLog(1,"WARNING,"+stringres.get("only_ns_engine4")),AlertDialog("Warning",stringres.get("only_ns_engine4"))))}var c=-1,u=-1,m="",g="",d="";!0!==IsSDK()&&(d=j$.mobile.activePage.attr("id"));var p=d.indexOf("page_");if(p>=0&&(d=d.substring(p+5)),isNull(r)||(c=r.pushlevel,m=r.name),isNull(a)||(u=a.pushlevel,g=a.name),PutToDebugLog(4,"EVENT, ChooseEngineLogic selected engine> "+m+" pushlevel: "+c),PutToDebugLog(4,"EVENT, ChooseEngineLogic recommended engine> "+g+" pushlevel: "+u),PutToDebugLog(4,"EVENT, ChooseEngineLogic active page: "+d),global.isdebugengine&&(c=3,u=3,m="ns",g="webrtc"),"Android"!==GetOs()&&"iOS"!==GetOs()||"app"===m&&(isNull(g)||g.length<1)&&(c=6),c<3&&u<3)return PutToDebugLog(4,"EVENT, ChooseEngineLogic return callback"),void e(!1);var h=GetNPLocation(),f='<a href="'+h+'" target="_blank" id="adialog_nativeplugin">'+stringres.get("nativeplugin")+"</a>";PutToDebugLog(5,"EVENT, common ChooseEngineLogic nplink: "+f);var b=stringres.get("ce_installnativeplugin");b=b.replace("[NATIVE_PLUGIN]",f);var v=!1,_=!1,E='Enable Java in your browser or enable from the settings( <a href="'+global.ENABLE_JAVA_URL+'" id="click_enable_java" target="_blank">How to enable Java ?</a>)',T='Install Java from <a href="'+global.INSTALL_JAVA_URL+'" id="click_install_java" target="_blank">here.</a>',P='<a href="'+GetNPLocation()+'" target="_blank" id="adialog_nativeplugin">Install '+stringres.get("nativeplugin")+"</a>",S="For best experience: ",N='<a href="javascript:;" id="click_use_webrtc" target="_blank">Use WebRTC.</a>',w='Use <a href="[BWURL]" id="click_use_alternatebrowser" target="_blank">alternate browser.</a>',I="",C='Use <a href="javascript:;" id="click_use_p2p">phone to phone</a> server initiated call.',R='Call <a href="javascript:;" id="click_use_accessnumber">access number</a> using native dialer.',y='<a href="javascript:;" id="click_use_internetexplorer">use Internet Explorer</a>';if("iOS"===GetOs()){var L=GetParameter("ios_nativedialerurl");if((isNull(L)||L.length<3)&&(L="https://itunes.apple.com/ro/app/mizuphone/id483685573"),i="",("Safari"===GetBrowser()||"iPhone"===GetBrowser())&&GetBrowserVersion()<11)i="&SmallCircle; "+stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+stringres.get("ce_native_ios2")+"</a><br /><br />";else{try{var D=platform.os;if(!isNull(D)&&D.length>0&&(D=Trim(D),D.indexOf(" ")>0)){D=D.substring(D.indexOf(" ")+1),D.indexOf(".")>0&&(D=D.substring(0,D.indexOf("."))),D=Trim(D);var G=StrToIntDef(D,-1);G>0&&G>=11&&(i="&SmallCircle; "+stringres.get("ce_native_ios_not_safari")+' <a href="javascript:;" id="click_use_app">'+stringres.get("ce_native_ios2")+"</a><br /><br />")}}catch(k){PutToDebugLogException(2,"common: ChooseEngineLogic inner iOS",k)}i.length<1&&(i="&SmallCircle; "+stringres.get("ce_native_ios_safari")+' <a href="javascript:;" id="click_use_app">'+stringres.get("ce_native_ios2")+"</a><br /><br />")}}else if("Android"===GetOs()){if(GetBrowserVersion()<40){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var x=GetConfig("android_aletrnatebrowserurl");(isNull(x)||x.length<5)&&(x=global.android_aletrnatebrowserurl_DEF),i=i+"&SmallCircle; "+stringres.get("ce_browser_install")+' <a href="'+x+'" target="_blank">'+stringres.get("ce_browser_alternate")+"</a>",i+="<br /><br />"}}else i=i+'&SmallCircle; <a href="javascript:;" id="click_use_webrtc">'+stringres.get("ce_usewebrtc")+"</a>",(global.recwsload<0||global.recwsload>2)&&(i=i+" "+stringres.get("ce_webrtcnot")),i+="<br /><br />";"app"===m&&GetParameterInt("enginepriority_app",2)>0&&(i=i+'&SmallCircle; <a href="javascript:;" id="click_use_app">'+stringres.get("ce_native_android")+"</a>")}else{if(3===c||4===c||5===c||6===c){if("java"===m){var O=IsJavaInstalled();0===O?(6===c&&(v=!0),"MSIE"===GetBrowser()&&(i=i+E+" OR "),i=i+T+"<br><br>"):1===O&&(6===c&&(v=!0),i=i+E+"<br><br>")}else if("ns"!==m||global.isdebugengine)if("otherbrowser"===m){var x="";x=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),w=w.replace("[BWURL]",x),i+=S,i=i+w+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"}else"p2p"===m?i=i+C+"<br><br>":"accessnum"===m&&(i=i+R+"<br><br>");else!isNull(selected_engine)&&selected_engine.isinstalled_cache<2?(6===c&&(v=!0),i=i+P+"<br><br>"):e(!1);"Edge"===GetBrowser()&&(i+=S,i=i+y+"<br><br>")}if(3===u||4===u||5===u||6===u){if(6===u&&(v=!0),3===u&&"settings"!==d)return void UserChooseEnginePopup(i,v,_,e);if("true"===GetParameter("ignoreengineselect"))return void UserChooseEnginePopup(i,v,_,e);var A=GetEngineDisplayName(m);if(I=A.length>0?I.replace("[ENGINE]",A):"",_=!0,"java"===g){var O=IsJavaInstalled();0===O?"MSIE"===GetBrowser()?(i+=S,i=i+E+" OR ",i=i+T+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"):(i+=S,i=i+T+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"):1===O&&(i+=S,i=i+E+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>")}else if("ns"===g)recommend_engine.isinstalled_cache<2&&(i+=S,i=i+P+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>");else if("webrtc"===g)i=i+N+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>";else if("app"===g){if(GetParameterInt("enginepriority_otherbrowser",2)>0){var x="";x=GetParameter("Windows"===GetOs()?"pc_alternatebrowserurl":"pc_alternatebrowserurl"),w=w.replace("[BWURL]",x),i+=S,i=i+w+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>"}}else"p2p"===g?i=i+C+"<br><br>":"accessnum"===g?i=i+R+"<br><br>":"nativedial"===g&&(i+='Direct call with <a href="javascript:;" id="click_use_nativedialer">native dialer</a>.<br><br>');"Edge"===GetBrowser()&&i.indexOf(y)<1&&(i+=S,i=i+y+"<br><br>")}}global.isdebugengine&&(I=I.replace("[ENGINE]","JAVA"),i=T+"<br><br>",i+=S,i=i+P+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>",i+=S,i=i+N+"<br>",I.length>0&&(i=i+I.replace("[ENGINE]",A)+"<br>"),i+="<br>",x=GetParameter("pc_alternatebrowserurl"),w=w.replace("[BWURL]",x),i+=S,i=i+w+"<br><br>",i=i+C+"<br><br>",i+=S,i=i+y+"<br><br>",v=!0,_=!1),UserChooseEnginePopup(i,v,_,e)}catch(U){PutToDebugLogException(2,"common: ChooseEngineLogic",U)}}function UserChooseEnginePopupSDK(e,t,o,n,i){try{PutToDebugLog(4,"EVENT, UserChooseEnginePopupSDK");var r=!1;if(isNull(e)||e.length<2)return void n(!1);var a='<span style="width: 100%; display: inline-block; background: #eeeeee; padding-top: 1.2em; padding-bottom: 1.2em;">',s="",l=e.split("<br><br>"),c=0;if(!isNull(l)&&l.length>0)for(var u=0;u<l.length;u++)isNull(l[u])||l[u].length<3||(s+='<div style="margin:0; padding:0; border:0; width:100%; height: .1em; clear:both; background: #dddddd;">\x3c!--//--\x3e</div>',s=s+a+"&nbsp;&nbsp;&nbsp;"+l[u]+"</span>",c++);else s=a+"&nbsp;&nbsp;&nbsp;"+e+"</span>";var m=stringres.get("choose_engine_title");c<2&&(m=stringres.get("choose_engine_title_single_engine")),s='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+s+"</div>";var g="";if(g='<div id="checkbox_ignore_container" style="width: 100%; background: #eeeeee; height: 3.5em; line-height: 3.5em; border-top: .1em solid #dddddd; border-bottom: .1em solid #dddddd; text-align: right;"><label for="checkbox_ignore">'+stringres.get("ce_dontask")+'&nbsp;&nbsp;</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox">&nbsp;&nbsp;&nbsp;</div>',!isNull(cemodal))return void cemodal.show();cemodal=picoModal({content:'<div id="ce_modal" class="pmodal_container" style="height: 100%;"><div id="ce_modal_header" class="pmodal_header">'+m+'</div><div id="ce_modal_content" class="pmodal_content"><div id="ce_modal_content_inner">'+s+"</div>"+g+'</div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+stringres.get("btn_close")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){try{var t=j$("#ce_modal").height()-j$("#ce_modal_header").height()-j$("#ce_modal_footer").height()-1;j$("#ce_modal_content").height(t),j$("#ce_modal_content_inner").height(t-j$("#checkbox_ignore_container").height()-5);var o=j$("#ce_modal_content_inner").height()-j$("#adialog_formattedmsg").height();j$("#adialog_formattedmsg").css("margin-top",o/2)}catch(n){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK afterShow",n)}}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),cemodal=null,(!1===r||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),r=!0,EngineSelect(1),n(!0))}),cemodal.show(),t&&j$("#ce_modal_footer").hide(),j$("#checkbox_ignore").on("change",function(e){j$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),j$("#click_use_alternatebrowser").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),j$("#click_enable_java").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),j$("#click_install_java").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),setTimeout(function(){InstallJavaPopup(!1)},400)}),j$("#adialog_nativeplugin").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("ns");e.clicked=2,SetEngine("ns",e),setTimeout(function(){NPDownloadAndInstall()},400);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}),j$("#click_use_webrtc").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!0,cemodal.close(),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSeengineprioritylect(1),n(!0)}),j$("#click_use_p2p").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1),n(!0)}),j$("#click_use_accessnumber").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1),n(!0)}),j$("#click_use_nativedialer").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close(),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),EngineSelect(1),n(!0)}),j$("#click_use_app").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,
cemodal.close(),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),j$("#click_use_internetexplorer").on("click",function(){r=!0,webphone_api.flagrestartwebrtc=!1,cemodal.close()}),j$("#btn_close_adialog").on("click",function(){PutToDebugLog(5,"EVENT, common UserChooseEngineSDK close on click"),cemodal.close(),(t||!1===r)&&(PutToDebugLog(3,"EVENT, UserChooseEngineSDK callback"),EngineSelect(1),r=!0,n(!0))})}catch(d){PutToDebugLogException(2,"common: UserChooseEnginePopupSDK",d)}}function UserChooseEnginePopup(e,t,o,n,i){try{PutToDebugLog(2,"EVENT, UserChooseEnginePopup message: "+e);var r=GetBrowserVersion();if("java"===GetSelectedEngineName()&&"Chrome"===GetBrowser()&&StrToIntDef(r,70)>webphone_api.getmaxchromeversionforjava()){PutToDebugLog(2,"EVENT,"+stringres.get("jnotsupported")+"_1"),e=stringres.get("jnotsupported");var a=GetConfig("pc_alternatebrowserurl");return!isNull(a)&&a.length>2&&(e=e+': <a href="'+a+'" target="_blank">'+a+"</a>"),AlertDialog("Warning",e),void n(!1)}var s=!1;if("true"===GetParameter("ignoreengineselect"))return void n(!1);if(isNull(e)||e.length<2)return void n(!1);if(1==IsSDK())return void UserChooseEnginePopupSDK(e,t,o,n,i);SaveParameter("enproblem","1"),PutToDebugLog(4,"EVENT, UserChooseEnginePopup");var l="",c=e.split("<br><br>"),u=0;if(!isNull(c)&&c.length>0)for(var m=0;m<c.length;m++)isNull(c[m])||c[m].length<3||(l+='<div class="separator_line_chooseengine">\x3c!--//--\x3e</div>',l=l+"<span>&nbsp;&nbsp;&nbsp;"+c[m]+"</span>",u++);else l="<span>&nbsp;&nbsp;&nbsp;"+e+"</span>";var g=stringres.get("choose_engine_title");u<2&&(g=stringres.get("choose_engine_title_single_engine")),l='<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">'+l+"</div>";var d="";o&&!t&&(d='<div id="checkbox_ignore_container"><label for="checkbox_ignore">'+stringres.get("ce_dontask")+'</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox"></div>');var p=GetDeviceWidth();(isNull(p)||p<10)&&(p=220);var h='<div data-role="popup" id="choose_engine" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+p+"px; width:"+p+"px; margin=0; float:left; height="+GetDeviceHeight()+'px;"><div data-role="header" data-theme="b" id="choose_engine_header"><h1 class="adialog_title" style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+g+'</h1></div><div role="main" id="choose_engine_container" class="ui-content adialog_content adialog_alert"><div id="choose_engine_top_section" style="margin: 0em;"><div id="chooseengine_spacer" style="display: inline-block; width: 100%;">&nbsp;</div>'+l+"</div>"+d+'</div><div data-role="footer" data-theme="b" class="adialog_footer" id="choose_engine_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_close")+"</a></div></div>";i=i||function(){},j$.mobile.activePage.append(h).trigger("create"),j$.mobile.activePage.find(".messagePopup").popup({beforeposition:function(){j$(".ui-popup-screen").off(),j$(this).css({width:window.innerWidth,height:window.innerHeight-10}),t&&j$("#choose_engine_footer").hide();var e=GetDeviceHeight()-j$("#choose_engine_header").height();j$("#choose_engine_footer").is(":visible")&&(e-=j$("#choose_engine_footer").height()),e=Math.floor(e),j$(".messagePopup .ui-content").height(e-Math.floor(.015*e)),j$(".messagePopup .ui-content").css({padding:0,margin:0,background:"#ffffff"})},afteropen:function(e,t){j$(this).parent().css({top:0,left:0,position:"absolute"});var o=j$("#choose_engine_container").height()-20;isNull(document.getElementById("checkbox_ignore_container"))||(o-=j$("#checkbox_ignore_container").height()),document.getElementById("choose_engine_top_section").style.height=o+"px";var n=o-j$("#adialog_formattedmsg").height();document.getElementById("chooseengine_spacer").style.height=Math.floor(n/2)+"px"}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),i(),(!1===s||"MSIE"===GetBrowser()&&IsJavaInstalled()<2||"flash"===GetSelectedEngineName())&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback onclose"),EngineSelect(1),s=!0,n(!0))}}),j$("#checkbox_ignore").on("change",function(e){j$(this).prop("checked")?SaveParameter("ignoreengineselect","true"):SaveParameter("ignoreengineselect","false")}),j$("#click_use_alternatebrowser").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close")}),j$("#click_enable_java").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e)}),j$("#click_install_java").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("java");e.clicked=2,SetEngine("java",e),j$("#choose_engine").on("popupafterclose",function(e){OpenSettings(!0,5),setTimeout(function(){InstallJavaPopup(!1)},400)})}),j$("#adialog_nativeplugin").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#choose_engine").on("popupafterclose",function(e){ResetEngineClicked();var t=GetEngine("ns");t.clicked=2,SetEngine("ns",t),setTimeout(function(){NPDownloadAndInstall()},400);var o=GetNPLocation();!isNull(o)&&o.length>0&&window.open(o)})}),j$("#click_use_webrtc").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!0,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("webrtc");e.clicked=2,SetEngine("webrtc",e),EngineSelect(1),n(!0)}),j$("#click_use_p2p").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("p2p");e.clicked=2,SetEngine("p2p",e),EngineSelect(1),n(!0)}),j$("#click_use_accessnumber").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("accessnum");e.clicked=2,SetEngine("accessnum",e),EngineSelect(1),n(!0)}),j$("#click_use_nativedialer").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("nativedial");e.clicked=2,SetEngine("nativedial",e),EngineSelect(1),n(!0)}),j$("#click_use_app").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close"),ResetEngineClicked();var e=GetEngine("app");e.clicked=2,SetEngine("app",e),StartAppEngine(!1,"")}),j$("#click_use_internetexplorer").on("click",function(){s=!0,webphone_api.flagrestartwebrtc=!1,j$.mobile.activePage.find(".messagePopup").popup("close")}),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common UserChooseEngine close on click"),(t||!1===s)&&(PutToDebugLog(3,"EVENT, UserChooseEngine callback"),EngineSelect(1),s=!0,n(!0))})}catch(f){PutToDebugLogException(2,"common: UserChooseEnginePopup",f)}}function AppEngineClick(){try{alert("AppEngineClick")}catch(e){PutToDebugLogException(2,"common: AppEngineClick",e)}}function ShowEngineOptionOnPage(e){try{if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return void e("","");if("true"===GetParameter("ignoreengineselect"))return void e("","");if(isNull(GetSelectedEngine())&&semaxloop<10)return setTimeout(function(){ShowEngineOptionOnPage(e)},500),void semaxloop++;semaxloop=0;var t=GetSelectedEngine(),o=GetRecommendedEngine(),n=-1,i=-1,r="",a="";isNull(t)||(n=t.pushlevel,r=t.name),isNull(o)||(i=o.pushlevel,a=o.name);var s="Engine is [XXX]. Click here if wish to use [YYY].",l="";global.useengine.length>0&&r.length>0&&global.useengine!==r&&2===n?(l=s.replace("[XXX]",GetEngineDisplayName(global.useengine)),l=l.replace("[YYY]",GetEngineDisplayName(r)),e(l,r)):global.useengine.length>0&&a.length>0&&global.useengine!==a&&2===i&&(l=s.replace("[XXX]",GetEngineDisplayName(global.useengine)),l=l.replace("[YYY]",GetEngineDisplayName(a)),e(l,a))}catch(c){PutToDebugLogException(2,"common: ShowEngineOptionOnPage",c)}e("","")}function GatewayFailower(e,t){try{if(gwround++,PutToDebugLog(2,"EVENT,GatewayCheck called: "+t+" ("+gwround+")"),getuseengine()!==global.ENGINE_WEBRTC)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not WebRTC ("+gwround+")");if(!1===global.canfailover_gateway)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because already failowered once in this session ("+gwround+")");if(!1===IsMizuWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway ("+gwround+")");isNull(fail_timer)||clearTimeout(fail_timer),fail_timer=null,e<0&&(e=8e3),PutToDebugLog(2,"EVENT,GatewayCheck started checking, delay: "+e.toString()+" ("+gwround+")"),global.canfailover_gateway=!1,fail_timer=setTimeout(function(){try{if("us"===global.usuk&&!1===global.wsl_uk_rec||"uk"===global.usuk&&!1===global.wsl_us_rec)return void PutToDebugLog(2,"EVENT,skip GatewayCheck because no answers for wsload, UK: "+global.wsl_uk_rec+"; US: "+global.wsl_us_rec+" ("+gwround+")");if(!1===IsMizuWebRTCGateway())return void PutToDebugLog(2,"EVENT,skip GatewayCheck because not Mwebrtc gateway from timer ("+gwround+")");if(isNull(global.usuk)||global.usuk.length<1)return void PutToDebugLog(2,"ERROR,skip GatewayCheck failower usuk NOT defined ("+gwround+")");var e=GetParameter("webrtcserveraddress");if(!isNull(e)&&e.length>3){var t=StrDc(wip_uk,alsvkey),o=StrDc(wips_uk,alsvkey),n=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);if(t.indexOf(e)>=0||o.indexOf(e)>=0||n.indexOf(e)>=0||i.indexOf(e)>=0)return void PutToDebugLog(2,"WARNING,GatewayCheck do NOT failower because gateway address is set manually ("+gwround+")")}!0===global.failover_gateway&&!0===NeedRegister()?(global.failover_gateway=!1,"uk"===global.usuk?global.usuk="us":global.usuk="uk",isNull(global.worktimer)||(clearTimeout(global.worktimer),global.worktimer=null),PutToDebugLog(2,"EVENT, mlogic API_Unregister GatewayCheck ("+gwround+")"),PutToDebugLog(2,"ERROR,GatewayCheck  failower to: "+global.usuk+" ("+gwround+")"),!isNull(wssocket)&&wssocket.close&&wssocket.close(),wssocket=null,PutToDebugLog(2,"EVENT, mlogic API_Start GatewayCheck ("+gwround+")"),webphone_api.start()):PutToDebugLog(2,"EVENT,skip GatewayCheck because failover_gateway: "+global.failover_gateway.toString()+"; NeedRegister: "+NeedRegister()+" ("+gwround+")")}catch(r){PutToDebugLogException(2,"common: GatewayCheck inner timer",r)}},e)}catch(o){PutToDebugLogException(2,"common: GatewayCheck",o)}}function CheckEngineFirstStart(e){try{if(isNull(isWebphoneFirstStart)&&(isWebphoneFirstStart=GetParameterBool("wpfirststart",!1)),!1===isWebphoneFirstStart)return;isWebphoneFirstStart=!1,isNull(cestimer)||clearTimeout(cestimer),cestimer=setTimeout(function(t){try{if(getuseengine()===global.ENGINE_WEBRTC&&webphone_api.iswebrtcengineworking<1&&!0===CanIUseService()){var o=StrToInt(GetParameter2("enginepriority_webrtc")),n=StrToInt(GetParameter2("enginepriority_ns"));if(o<5&&o<=n){IsCurrentEngineWorking(e,1,!0);var i=common.GetParameter2("serveraddress");(common.isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&(common.SaveParameter("serveraddress",""),i=common.GetParameter2("serveraddress_user"),(common.isNull(i)||i.length<2||"YOURSIPDOMAIN.COM"===i||"YOURSIPSERVER.COM"===i||"SIPSERVER"===i||"VOIPSERVER"===i||"SERVERADDRESS"===i)&&("undefined"!=typeof global.worktimer&&null!==global.worktimer&&clearTimeout(global.worktimer),global.worktimer=null))}}}catch(r){PutToDebugLogException(2,"common: CheckEngineFirstStart Inner Timer",r)}},4e3)}catch(t){PutToDebugLogException(2,"common: CheckEngineFirstStart",t)}}function IsCurrentEngineWorking(e,t,o){try{if((isNull(t)||!1===IsNumber(t))&&(t=25e3,GetTickCount()-lastcalledtick<2500))return;lastcalledtick=GetTickCount(),isNull(global.worktimer)||clearTimeout(global.worktimer),paramcache=e,global.iscurrengineworking=!1,lastengine_working_ok="",global.worktimer=setTimeout(function(e){try{if(HandleCalldivert(),"app"===getuseengine()||"p2p"===getuseengine()||"accessnum"===getuseengine()||"nativedial"===getuseengine()||"otherbrowser"===getuseengine())return;if(global.phonestarted>2&&(SaveParameter("wpfirststart","false"),PutToDebugLog(2,"EVENT, Save wpfirststart = false")),!1===global.iscurrengineworking){PutToDebugLog(3,"ERROR, common: IsCurrentEngineWorking "+getuseengine()+"> NOT WORKING no SIP signaling received from server");var t=GetEngine(global.useengine);EngineSelect(1),isNull(t)||("Linux"!==GetOs()&&"Mac"!==GetOs()||!1!==CanIUseService()||0!=CanIUseApplet())&&(t.failed=1,SetEngine(global.useengine,t));if(!1===GetParameterBool("wpfirststart",!0)){var n=GetSelectedEngineName();EngineSelect(1);var i=GetSelectedEngineName();if(n!==i){var r=GetParameterInt("enginepriority_"+n,2),a=GetParameterInt("enginepriority_"+i,2);if(n!==global.ENGINE_WEBRTC&&n!==global.ENGINE_SERVICE||i!==global.ENGINE_WEBRTC&&i!==global.ENGINE_SERVICE){if(i!==global.ENGINE_WEBRTC&&i!==global.ENGINE_SERVICE&&r>=a)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER or EQUAL from: "+n+"("+r.toString()+") to: "+i+"("+a.toString()+")")}else if(r>a)return void PutToDebugLog(2,"WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER from: "+n+"("+r.toString()+") to: "+i+"("+a.toString()+")")}}if(2===global.useengineclicked_cache||!0===o){global.useengineclicked_cache=1;var s=stringres.get("ce_ask_user"),l=GetSelectedEngineName();s=s.replace("[SELECTEDENGINE]",GetEngineDisplayName(l)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking: "+s),EngineSelect(1),ChooseEngineLogic(function(t){if(!1===t){var o=GetSelectedEngineName();if(s=s.replace("[RECOMMENDED]",GetEngineDisplayName(o)),PutToDebugLog(2,"WARNING, IsCurrentEngineWorking 2: "+s),isNull(l)||l.length<1||isNull(o)||o.length<1||l===o)return PutToDebugLog(2,"ERROR, IsCurrentEngineWorking invalid message to be displayed: "+s+" reset useengine"),global.useengine="",void plhandler.StartUp(e);if(!0!==confirm(s))return PutToDebugLog(2,"WARNING, user denied recommended engine failback"),void IsCurrentEngineWorking(e);PutToDebugLog(2,"EVENT, user confirmed recommended engine failback reset useengine"),global.useengine="",plhandler.StartUp(e)}else plhandler.StartUp(e)},!0)}else webphone_api.startInner(e)}else lastengine_started_ok=global.useengine,lastengine_working_ok=global.useengine,PutToDebugLog(3,"EVENT, this engine is working: "+global.useengine),"java"!==global.useengine&&"ns"!==global.useengine&&"webrtc"!==global.useengine||SaveParameter(global.useengine+"_worked","true"),"ns"===global.useengine&&HandleServiceBuildUpgrade(),setTimeout(function(){global.isencrypted=webphone_api.isencrypted()},3e3)}catch(c){PutToDebugLogException(2,"common: IsCurrentEngineWorking timer",c)}},t)}catch(n){PutToDebugLogException(2,"common: IsCurrentEngineWorking",n)}}function InstallJavaPopupSDK(e,t){try{if(PutToDebugLog(4,"EVENT, InstallJavaPopupSDK"),e&&window.open(global.INSTALL_JAVA_URL,"_blank"),!isNull(jinstallmodal))return void jinstallmodal.show();jinstallmodal=picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+stringres.get("java_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+stringres.get("java_install")+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_jsinst_adialog">'+stringres.get("btn_ok")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),jinstallmodal=null}),jinstallmodal.show(),j$("#btn_close_jsinst_adialog").on("click",function(){jinstallmodal.close()})}catch(o){PutToDebugLogException(2,"common: InstallJavaPopupSDK",o)}}function InstallJavaPopup(e,t){try{if(1==IsSDK())return void InstallJavaPopupSDK(e,t);PutToDebugLog(4,"EVENT, InstallJavaPopup");var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220;var n=stringres.get("java_install"),i='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("java_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+n+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+"</a></div></div>";t=t||function(){},j$.mobile.activePage.append(i).trigger("create"),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition")}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),t()}}),j$("#adialog_positive").on("click",function(t){e&&window.open(global.INSTALL_JAVA_URL,"_blank"),PutToDebugLog(5,"EVENT, common InstallJavaPopup ok click")})}catch(r){PutToDebugLogException(2,"common: InstallJavaPopup",r)}}function GetNPLocation(){var e="";try{if(e=GetConfig("nativepluginurl"),(isNull(e)||e.length<2)&&(e=GetParameter2("nativepluginurl")),!isNull(e)&&e.length>5)return PutToDebugLog(4,"EVENT, GetNPLocation service location(1): "+e),e;var e=webphone_api.getbasedir2();isNull(e)&&(e="");var t=GetConfig("nativepluginname");return"Mac"===GetOs()?t=GetConfig("nativepluginname_mac"):"Linux"===GetOs()&&(t=GetConfig("nativepluginname_linux")),(isNull(t)||t.length<3)&&(t=!0===NSMacLinEnabled()?"Mac"===GetOs()?global.mac_nsplugin_filename:!0===Is64BitBrowser()?!0===IsARM()?global.lin64arm_nsplugin_filename:global.lin64_nsplugin_filename:!0===IsARM()?global.lin32arm_nsplugin_filename:global.lin32_nsplugin_filename:global.win_nsplugin_filename),"/"!==e.charAt(e.length-1)&&(e+="/"),e=e+"native/"+t,PutToDebugLog(4,"EVENT, GetNPLocation doc location: "+location.href),PutToDebugLog(4,"EVENT, GetNPLocation service location: "+e),e}catch(o){PutToDebugLogException(2,"common: GetNPLocation",o)}return""}function NPDownloadAndInstallSDK(e,t){try{if(PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup displayed"),ServiceStartPolling(),!isNull(npmodal))return void npmodal.show();t=t||function(){};var o=stringres.get("np_install_msg"),n='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+stringres.get("np_install_why")+"</a>";"Linux"===GetOs()?(o=stringres.get("np_install_msg_lin"),(!0===global.usestorage||Strl(90))&&(o=o+"<br><br>"+n)):"Mac"===GetOs()&&(o=stringres.get("np_install_msg_mac"),(!0===global.usestorage||Strl(90))&&(o=o+"<br><br>"+n));var i='<button id="btn_np_negative">'+stringres.get("btn_cancel")+"</button>";!0===e&&(i=""),npmodal=picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+stringres.get("np_install_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+o+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_np_positive">'+stringres.get("btn_ok")+"</button>"+i+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),npmodal=null,PutToDebugLog(4,"EVENT, NPDownloadAndInstallSDK popup closed")}),npmodal.show(),j$("#btn_np_positive").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, common NPDownloadAndInstallSDK 1 ok"),lm=!1,!0===global.nsupdatepending&&(global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstallSDK"),webphone_api.start()),t("ok")}),j$("#btn_np_negative").on("click",function(){npmodal.close(),PutToDebugLog(5,"EVENT, settings NPDownloadAndInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1),stopPolling=!0,t("cancel")})}catch(r){PutToDebugLogException(2,"common: NPDownloadAndInstallSDK",r)}}function NPDownloadAndInstall(e,t){try{if(npclosehandled=!1,1==IsSDK())return void NPDownloadAndInstallSDK(e,t);PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup displayed"),ServiceStartPolling();var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,enginep.ns=enginep.ns+5e3;var n=stringres.get("np_install_msg"),i='<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">'+stringres.get("np_install_why")+"</a>";n=n+"<br><br>"+i,"Linux"===GetOs()?(n=stringres.get("np_install_msg_lin"),(!0===global.usestorage||Strl(90))&&(n=n+"<br><br>"+i)):"Mac"===GetOs()&&(n=stringres.get("np_install_msg_mac"),(!0===global.usestorage||Strl(90))&&(n=n+"<br><br>"+i));var r='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a>";!0===e&&(r="");var a='<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-dismissible="false" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("np_install_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+n+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+"</a>"+r+"</div></div>";t=t||function(){},j$.mobile.activePage.append(a).trigger("create"),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){!1===npclosehandled&&NPHandleCancel(),j$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, NPDownloadAndInstall popup closed")}}),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common NPDownloadAndInstall 1 ok"),npclosehandled=!0,lm=!1,setTimeout(function(){j$.mobile.activePage.find(".messagePopup").popup("close")},500),!0===global.nsupdatepending&&(global.nsupdatepending=!1,PutToDebugLog(2,"EVENT, mlogic API_Start NPDownloadAndInstall"),webphone_api.start()),setTimeout(function(){IsServiceInstalled(function(e){!1===e&&(PutToDebugLog(2,"WARNING, on NPDownloadAndInstall OK clikc, NS service is not reachable"),AlertDialog(stringres.get("warning"),stringres.get("np_install_warn")))},!0)},500),t("ok")}),j$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, settings NPDownloadAndInstall 1 cancel"),t("cancel"),NPHandleCancel(),setTimeout(function(){j$.mobile.activePage.find(".messagePopup").popup("close")},500)})}catch(s){PutToDebugLogException(2,"common: NPDownloadAndInstall",s)}}function NPHandleCancel(){npclosehandled=!0;var e=GetEngine("ns");e.clicked=0,SetEngine("ns",e),EngineSelect(1),stopPolling=!0,webphone_api.startInner()}function EngineForcedInstallSDK(e,t,o,n){function i(){if("java"===e)InstallJavaPopup(!0),n("ok");else if("ns"===e){n("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}}try{var r=!1;if(PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup displayed: "+e+"; message: "+t),n=n||function(){},!isNull(efmodal))return void efmodal.show();if(isNull(t)||t.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+stringres.get("jnotsupported")+"_2"),t=stringres.get("jnotsupported");var a=GetConfig("pc_alternatebrowserurl");!isNull(a)&&a.length>2&&(t=t+': <a href="'+a+'" target="_blank">'+a+"</a>"),r=!0}else t=stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",t=t.replace("[BRAND]",GetBrandName());t.indexOf(stringres.get("service_update"))>=0&&(t+='<br /><a id="efi_download_link" style="cursor:pointer; color:#3f8fcf;">Download NS -Service Plugin</a>');var s=stringres.get("btn_ok");e===global.ENGINE_SERVICE&&(s=stringres.get("btn_download"));var l='<button id="btn_ef_positive">'+s+"</button>";!0===o&&(l='<button id="btn_ef_negative">'+stringres.get("btn_cancel")+"</button>"+l),efmodal=picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+stringres.get("ce_alert_title")+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+t+'</div></div><div id="ce_modal_footer" class="pmodal_footer">'+l+"</div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},closeButton:!1,overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){j$("#efi_download_link").off("click"),e.destroy(),PutToDebugLog(4,"EVENT, EngineForcedInstallSDK popup closed"),efmodal=null}),efmodal.show(),j$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK link click"),i(),efmodal.close()}),j$("#btn_ef_positive").on("click",function(){efmodal.close(),!0!==r&&(PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 ok"),i())}),j$("#btn_ef_negative").on("click",function(){efmodal.close(),PutToDebugLog(5,"EVENT, common EngineForcedInstallSDK 1 cancel");var e=GetEngine("webrtc");e.clicked=0,SetEngine("webrtc",e),EngineSelect(1),stopPolling=!0,n("cancel")})}catch(c){PutToDebugLogException(2,"common: EngineForcedInstallSDK",c)}}function EngineForcedInstall(e,t,o,n){function i(){if("java"===e)InstallJavaPopup(!0),n("ok");else if("ns"===e){n("ok"),setTimeout(function(){NPDownloadAndInstall(!0)},450);var t=GetNPLocation();!isNull(t)&&t.length>0&&window.open(t)}setTimeout(function(){j$.mobile.activePage.find(".messagePopup").popup("close")},200)}try{if("ns"===e&&-3===GetMinServiceVersion())return void PutToDebugLog(2,"ERROR, EngineForcedInstall: "+e+"; install popup is disabled by minserviceversion: "+GetMinServiceVersion().toString());var r=!1;if(1==IsSDK())return void EngineForcedInstallSDK(e,t,o,n);PutToDebugLog(4,"EVENT, EngineForcedInstall popup displayed: "+e+"; message: "+t);var a=GetDeviceWidth();if(a=!isNull(a)&&IsNumber(a)&&a>100?Math.floor(a/1.2):220,isNull(t)||t.length<1)if("java"===e&&"Chrome"===GetBrowser()){PutToDebugLog(2,"EVENT,"+stringres.get("jnotsupported")+"_3"),t=stringres.get("jnotsupported");var s=GetConfig("pc_alternatebrowserurl");!isNull(s)&&s.length>2&&(t=t+': <a href="'+s+'" target="_blank">'+s+"</a>"),r=!0}else t=stringres.get("ce_alert_user")+" "+GetEngineDisplayName(e)+".",t=t.replace("[BRAND]",GetBrandName());var l=stringres.get("btn_ok");e===global.ENGINE_SERVICE&&(l=stringres.get("btn_download")),t.indexOf(stringres.get("service_update"))>=0&&(t+='<br /><a id="efi_download_link" style="cursor:pointer;">Download NS -Service Plugin</a>');var c='<a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+l+"</a>";!0===o&&(c='<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a>"+c);var u='<div data-role="popup" id="np_forcedinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+a+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title" style="margin-left: 2.2em;">'+stringres.get("ce_alert_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+t+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer">'+c+"</div></div>";n=n||function(){},j$.mobile.activePage.append(u).trigger("create"),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$("#efi_download_link").off("click"),j$(this).unbind("popupafterclose").remove(),PutToDebugLog(4,"EVENT, EngineForcedInstall popup closed")}}),j$("#efi_download_link").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall link click"),j$.mobile.activePage.find(".messagePopup").popup("close"),i()}),j$("#adialog_positive").on("click",function(e){!0!==r&&(PutToDebugLog(5,"EVENT, common EngineForcedInstall ok"),i())}),j$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, common EngineForcedInstall 1 cancel"),n("cancel"),NPHandleCancel(),setTimeout(function(){j$.mobile.activePage.find(".messagePopup").popup("close")},200)})}catch(m){PutToDebugLogException(2,"common: EngineForcedInstall",m)}}function GetAppEnProtocol(e){try{var t=GetConfig("app_protocol");if((isNull(t)||t.length<1)&&(t="webphone:"),t.indexOf(":")<1&&(t+=":"),t.indexOf("//")<1&&(t+="//"),"Mac"!==GetOs()&&"Linux"!==GetOs()||(t="sip://"),(isNull(t)||t.length<1)&&(t="webphone://"),t=t.toLowerCase(),!0===e){var o=GetParameter("callto");isNull(o)&&(o=""),o=Trim(o),t+=o}return t}catch(n){PutToDebugLogException(2,"common: GetAppEnProtocol",n)}return"webphone://"}function HandleProtocol(e){var t=0;try{if(PutToDebugLog(2,"EVENT, HandleProtocol called: "+e),!1===global.isdebugversion&&"iOS"!==GetOs()&&"Android"!==GetOs())return;t=1;var o=window.location;if(t=2,t=5,PutToDebugLog(2,"EVENT, HandleProtocol: "+e),"iOS"===GetOs())t=6,window.location=e;else if("Chrome"===GetBrowser()){var n=e;n=n.replace(":",""),n=n.replace("//",""),n=n.replace("\\","");var i=GetNativeDialerUrl(GetOs());i=i.toLowerCase();var r=i.indexOf("id=");r>0?(i=i.substring(r+3),r=i.indexOf("&"),r>0&&(i=i.substring(0,r)),r=i.indexOf("#"),r>0&&(i=i.substring(0,r)),i=Trim(i)):i="com.mizuvoip.mizudroid.app";var a=encodeURIComponent(GetNativeDialerUrl(GetOs())),s="intent://#Intent;scheme="+n+";package="+i+";S.browser_fallback_url="+a+";end";PutToDebugLog(2,"EVENT, HandleProtocol for Chrome in Android: "+s),window.location=s}else{t=7;var l=document.getElementById("loader")
;if(isNull(l))return PutToDebugLog(1,"ERROR, HandleProtocol loader iframe is NULL"),void ShowToast("ERROR, app loader is not defined.");l.src=e}t=11,o=GetNativeDialerUrl(GetOs()),t=14,PutToDebugLog(2,"EVENT, HandleProtocol fallbackLink: "+o),redirect_timer=setTimeout(function(){try{t=15,window.location=o,t=16}catch(e){PutToDebugLogException(2,"common: HandleProtocol inner timer second( "+t+" ), fallbackLink: "+o,e)}},3e3),t=17,clear_timer=setInterval(function(){try{t=18,protocolmaxloop++;var e=window.document.hasFocus();t=17,(!e||document.hidden||protocolmaxloop>100)&&(t=21,protocolmaxloop=0,isNull(clear_timer)||clearInterval(clear_timer),clear_timer=null,t=22,isNull(redirect_timer)||clearTimeout(redirect_timer),redirect_timer=null,t=23)}catch(o){PutToDebugLogException(2,"common: HandleProtocol inner timer( "+t+" )",o)}},200),t=24}catch(c){PutToDebugLogException(2,"common: HandleProtocol( "+t+" )",c)}}function Phone2Phone(e,t){try{var o=GetParameter("p2p");if(0!==Trim(o).indexOf("*"))return void OpenWebURL(o,stringres.get("p2p"));var n=GetDeviceWidth();n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,isNull(e)&&(e=""),isNull(t)&&(t="");var i='<div id="adialog_p2p" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("p2p")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+stringres.get("p2p_nra")+'</span><input type="text" id="phonea_input" name="phonea_input" value="'+e+'" data-theme="a" autocapitalize="off"/><span>'+stringres.get("p2p_nrb")+'</span><input type="text" id="phoneb_input" name="phoneb_input" value="'+t+'" data-theme="a" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(i).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click")}});var r=document.getElementById("phonea_input"),a=document.getElementById("phoneb_input");isNull(r)||r.focus(),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, _dialpad Phone2Phone 1 ok");var t=r.value,o=a.value;return isNull(t)||Trim(t).length<1?void ShowToast(stringres.get("p2p_err1")):(t=Trim(t),isNull(o)||Trim(o).length<1?void ShowToast(stringres.get("p2p_err2")):(o=Trim(o),void UriParser(GetParameter("p2p"),"",t,o,"","phone2phone")))}),j$("#adialog_negative").on("click",function(e){})}catch(s){PutToDebugLogException(2,"common: Phone2Phone",s)}}function AlertDialogSDK(e,t,o,n){try{if(!isNull(admodal))return void admodal.show();isNull(n)&&(n=stringres.get("btn_ok")),admodal=picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">'+e+'</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">'+t+'</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">'+n+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),admodal=null}),admodal.show(),j$("#btn_close_adialog").on("click",function(){admodal.close(),o&&"function"==typeof o&&(o(!0),o=null)})}catch(i){PutToDebugLogException(2,"common: AlertDialogSDK",i)}}function ShowToastSDK(e,t){try{if(!isNull(toastmodal))return void toastmodal.show();toastmodal=picoModal({content:'<div id="ce_modal" class="pmodal_container"><div id="ce_modal_content" class="modal_content" style="font-size: .8em; padding: .7em;"><div id="ce_modal_content_inner" style="margin-right: 1.6em;">'+e+"</div></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{padding:"0",margin:"0",border:".2em solid #d8d8d8",borderRadius:".5em",width:"auto",background:"#ffffff",fontFamily:"sans-serif"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),toastmodal=null}),toastmodal.show(),j$("#btn_close_adialog").on("click",function(){toastmodal.close()}),isNull(t)&&(t=3e3),t>0&&setTimeout(function(){isNull(toastmodal)||toastmodal.close()},t)}catch(o){PutToDebugLogSpecial(2,"common: ShowToastSDK",!0,o)}}function LcAc(e,t){try{if(IsWindowsSoftphone()||!global.usestorage)return!0;if(e&&isNull(lctmr))return lctmr=setTimeout(function(){lcsexp=!0},36e5),!0;var o=1;!0===SvCont()&&!0===WbCont()?o=5:!0===SvCont()?o=3:!0===WbCont()&&(o=2);if(lccsenr>15*o&&(lcsexp=!0),!0===t){var n=GetParameter("lccnr"),i=0;if(!isNull(n)&&n.length>0){n=Trim(n);try{i=StrToInt(n)}catch(u){PutToDebugLogException(2,"_call: convert to int",u)}var r=o;r>1&&(r/=2),r*=100,i>r?lcsexp=!0:(i++,lccsenr++,SaveParameter("lccnr",i.toString()))}else SaveParameter("lccnr","1")}if(lcsexp){var a=[];a.push("D"),a.push("e"),a.push("m"),a.push("o "),a.push("l"),a.push("i"),a.push("m"),a.push("i"),a.push("t "),a.push("r"),a.push("e"),a.push("a"),a.push("c"),a.push("h"),a.push("e"),a.push("d"),a.push(". "),a.push("P"),a.push("l"),a.push("e"),a.push("a"),a.push("s"),a.push("e "),a.push("r"),a.push("e"),a.push("s"),a.push("t"),a.push("a"),a.push("r"),a.push("t "),a.push("t"),a.push("h"),a.push("e "),a.push("b"),a.push("r"),a.push("o"),a.push("w"),a.push("s"),a.push("e"),a.push("r "),a.push("t"),a.push("o "),a.push("c"),a.push("o"),a.push("n"),a.push("t"),a.push("i"),a.push("n"),a.push("u"),a.push("e "),a.push("t"),a.push("e"),a.push("s"),a.push("t"),a.push("i"),a.push("n"),a.push("g"),a.push(". "),a.push("\n<br>"),a.push("C"),a.push("o"),a.push("n"),a.push("t"),a.push("a"),a.push("c"),a.push("t "),a.push("M"),a.push("i"),a.push("z"),a.push("u"),a.push("t"),a.push("e"),a.push("c"),a.push("h "),a.push("t"),a.push("o "),a.push("b"),a.push("u"),a.push("y "),a.push("a "),a.push("l"),a.push("i"),a.push("c"),a.push("e"),a.push("n"),a.push("s"),a.push("e"),a.push("d "),a.push("c"),a.push("o"),a.push("p"),a.push("y"),a.push(": "),a.push("s"),a.push("u"),a.push("p"),a.push("p"),a.push("o"),a.push("r"),a.push("t"),a.push("@"),a.push("m"),a.push("i"),a.push("z"),a.push("u"),a.push("-"),a.push("v"),a.push("o"),a.push("i"),a.push("p"),a.push("."),a.push("c"),a.push("o"),a.push("m");var s=a.join(""),l=[];l.push("D"),l.push("e"),l.push("m"),l.push("o");var c=l.join("");return setTimeout(function(){AlertDialog(c,s)},950),!1}}catch(u){PutToDebugLogException(2,"common: LcAc",u)}return!0}function GetServerForHttpReq(){var e="";try{e=GetParameter("serveraddress_user");var t=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||e.length>0&&e.indexOf(".")<1)&&!isNull(t)&&t.length>1&&(e=t),(isNull(e)||e.length<1)&&(e=GetParameter2("serveraddress"),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_user")),(isNull(e)||e.length<1)&&(e=GetParameter("serveraddress_orig")),(isNull(e)||e.length<1)&&(e=GetConfig("serveraddress")),GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(e=GetConfig("upperserver"))),isNull(e)&&(e=""),e.indexOf(":")>0&&(e=e.substring(0,e.indexOf(":"))),e}catch(o){PutToDebugLogException(2,"common: GetServerForHttpReq",o)}return""}function GetProxyaddress(e){try{var t="";if(!isNull(e)&&e.length>0)t=e;else{if((isNull(t)||t.length<3)&&(t=GetConfig("proxyaddress")),!isNull(t)&&t.length>2&&t.indexOf(":")<1){var o=GetConfig("serverport");!isNull(o)&&o.length>0&&"5060"!==o&&(t=t+":"+o)}(isNull(t)||t.length<3)&&(t=GetParameter("proxyaddress"))}return isNull(t)&&(t=""),t=t.toLowerCase(),t=t.replace("udp://",""),t=t.replace("tcp://",""),t=t.replace("http://",""),t=t.replace("https://",""),t=t.replace("udp:",""),t=t.replace("tcp:",""),t=t.replace("http:",""),t=t.replace("https:",""),t=Trim(t),0===t.indexOf("udp")&&(t=t.replace("udp","")),0===t.indexOf("tcp")&&(t=t.replace("tcp","")),0===t.indexOf("http")&&(t=t.replace("http","")),0===t.indexOf("https")&&(t=t.replace("https","")),t}catch(n){PutToDebugLogException(2,"common: GetProxyaddress",n)}return""}function GetWebrtcUpperServer(e){try{var t="",o=GetParameter("upperserverip");if(!isNull(o)&&Trim(o).length>0)return o;if(!0!==e){var n=GetParameter("upperserverdomain");if(!isNull(n)&&Trim(n).length>0)return n}var i=GetConfig("wsuser");if(!isNull(i)&&i.length>10){if(o=GetUrlParamVal("upperserverip"),n=GetUrlParamVal("upperserverdomain"),!isNull(o)&&Trim(o).length>0)return o;if(!0!==e&&!isNull(n)&&Trim(n).length>0)return n}var r=GetParameter("webrtcserveraddress");if(isNull(r)||r.length<2){t=GetParameter("serveraddress_user");var a=GetParameter("upperserver");return(GetConfigInt("cfgusetunneling",0)>0||t.length>0&&t.indexOf(".")<1)&&!isNull(a)&&a.length>1&&(t=a),Trim(t)}return t=GetParameter2("serveraddress"),(isNull(t)||t.length<1)&&(t=GetParameter("serveraddress_user")),(isNull(t)||t.length<1)&&(t=GetParameter("serveraddress_orig")),(isNull(t)||t.length<1)&&(t=GetConfig("serveraddress")),GetConfigInt("cfgusetunneling",0)>0&&!isNull(GetConfig("upperserver"))&&GetConfig("upperserver").length>1&&(t=GetConfig("upperserver")),t}catch(s){PutToDebugLogException(2,"common: GetWebrtcUpperServer",s)}return""}function GetWebrtcSyUpperHeader(e){try{var t=GetParameter("jsupperserver");if((isNull(t)||t.length<1)&&(t=GetWebrtcUpperServer(!0)),!isNull(t)&&t.length>0){var o=GetConfig("transport");return!isNull(o)&&o.length>0&&(o.indexOf(":")<0&&(o=":"+o),t=o+t),t}PutToDebugLog(2,"WARNING, GetWebrtcUpperServer is NULL ("+e+")")}catch(n){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",n)}return""}function GetWebrtcSyUpperDomainHeader(e){try{var t=GetParameter("upperserverd");isNull(t)&&(t="");var o=GetConfig("wsuser");if(!isNull(o)&&o.length>10){var n=GetParameter("upperserverdomain");if(!isNull(n)&&Trim(n).length>0)return n}if(t.length>0){var i=GetConfig("transport");return!isNull(i)&&i.length>0&&(i.indexOf(":")<0&&(i=":"+i),t=i+t),t}}catch(r){PutToDebugLogException(2,"common: GetWebrtcSyUpperHeader",r)}return""}function GetWebrtcSrvAddr(){return GetBestWsAddress()}function HandleAddress(e){try{if(isNull(e)||e.length<1)return"";e=e.toLowerCase(),e=Trim(e);var t=!1;location.host.toLowerCase();!0!==PreferWss()&&!0!==IsHttps()||(t=!0),!0===t&&0===e.indexOf("ws:")&&(e=e.replace("ws:","wss:")),e.indexOf("ws:")<0&&e.indexOf("wss:")<0&&(e=!0===t?"wss://"+e:"ws://"+e),e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?")))}catch(o){PutToDebugLogException(2,"common: HandleAddress",o)}return e}function AddWsAddress(e,t){try{if(isNull(e)||!e.address||isNull(e.address)||e.address.length<4)return void PutToDebugLog(2,"ERROR, AddWsAddress invalid object");if(isNull(wsrvL)&&(wsrvL=[]),wsrvL.length>0)for(var o=0;o<wsrvL.length;o++)if(wsrvL[o].address===e.address)return void(wsrvL[o].answertime<2&&(wsrvL[o].answertime=e.answertime,wsrvL[o].load=e.load));var n=GetParameter("lastwebrtcserver");!isNull(n)&&n.length>3&&n===e.address&&(e.answertime=e.answertime-20),wsrvL.push(e),GetBestWsAddress(t)}catch(i){PutToDebugLogException(2,"common: AddWsAddress",i)}}function GetBestWsAddress(e){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return selectedwserver;var t="";if("undefined"!=typeof webphone_api.parameters.webrtcserveraddress&&null!==webphone_api.parameters.webrtcserveraddress?t=webphone_api.parameters.webrtcserveraddress:"undefined"!=typeof webphone_api.parameters.webrtcserver&&null!==webphone_api.parameters.webrtcserver?t=webphone_api.parameters.webrtcserver:"undefined"!=typeof webphone_api.parameters.webrtcaddress&&null!==webphone_api.parameters.webrtcaddress?t=webphone_api.parameters.webrtcaddress:"undefined"!=typeof webphone_api.parameters.rtcserver&&null!==webphone_api.parameters.rtcserver?t=webphone_api.parameters.rtcserver:"undefined"!=typeof webphone_api.parameters.rtcaddress&&null!==webphone_api.parameters.rtcaddress&&(t=webphone_api.parameters.rtcaddress),void 0!==t&&null!==t&&t.length>3&&t.indexOf(",")<0)return selectedwserver=t;if(!1===decide_already_run)return DecideWebrtcServer(),"";if(!0===e)return selectedwserver=wsrvL[0].address,global.recwsload=wsrvL[0].load,global.selected_apikey=wsrvL[0].apikey,SaveParameter("lastwebrtcserver",selectedwserver),selectedwserver;isNull(addrtimer)&&(ADDR_TIMERSTART=GetTickCount(),addrtimer=setInterval(function(){if(addr_maxloop>60||!isNull(selectedwserver)&&selectedwserver.length>3)return isNull(addrtimer)||clearInterval(addrtimer),void(addrtimer=null);var e=null;if(!isNull(wsrvL)&&wsrvL.length>0)for(var t=0;t<wsrvL.length;t++)!0!==wsrvL[t].worked||wsrvL[t].load<0||(isNull(e)&&wsrvL[t].answertime<9e4&&wsrvL[t].load<2||e.answertime>wsrvL[t].answertime&&wsrvL[t].load<2)&&(e=wsrvL[t]);if(!isNull(e))return selectedwserver=e.address,global.recwsload=e.load,global.selected_apikey=e.apikey,isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,void(!0===IsUKGateway(selectedwserver)?global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(global.usuk="us"));var o=GetTickCount(),n=!0,i=!1;wsrvL.length<1&&(n=!1);for(var t=0;t<wsrvL.length;t++)wsrvL[t].load<0?n=!1:i=!0;if(!0===n||o-ADDR_TIMERSTART>=3e3&&!0===i||o-ADDR_TIMERSTART>=6e3){for(var r=wsrvL.length,a=0,t=0;t<r&&(wsrvL[t].load<0&&(wsrvL.push(wsrvL.splice(t,1)[0]),t<r-1&&t--),!(++a>3*r));t++);for(var t=0;t<r;t++)for(var s=t+1;s<r;s++)if(wsrvL[t].load>-1&&wsrvL[s].load>-1&&wsrvL[t].load>wsrvL[s].load){var l=wsrvL[t];wsrvL[t]=wsrvL[s],wsrvL[s]=l}for(var c=-1,t=0;t<r;t++)wsrvL[t].load<0||(c<0&&(c=wsrvL[t].load),isNull(e)&&(e=wsrvL[t]),wsrvL[t].load>c||e.answertime>wsrvL[t].answertime&&(e=wsrvL[t]))}isNull(e)||(selectedwserver=e.address,global.recwsload=e.load,global.selected_apikey=e.apikey,isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,!0===IsUKGateway(selectedwserver)?global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(global.usuk="us"))},100))}catch(o){PutToDebugLogException(2,"common: GetBestWsAddress",o)}return""}function GetSpecialWsloadUrl(e){try{var t=GetWsloadUrl(GetSipusername()),o=t.indexOf("://");if(o>0){var n=t.substring(0,o+3),i=t.substring(o+3);i=i.substring(i.indexOf("/"));t=n+NormalizeInput(e,0)+i}return t}catch(r){PutToDebugLogException(2,"common: GetSpecialWsloadUrl",r)}return""}function IsUKGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(uk_ip)&&(uk_ip=StrDc(wip_uk,alsvkey),uk_domain=StrDc(wips_uk,alsvkey));var t=-1;if(uk_ip=uk_ip.replace("ws://",""),t=uk_ip.lastIndexOf("/"),t>0&&(uk_ip=uk_ip.substring(0,t)),t=uk_ip.lastIndexOf(":"),t>0&&(uk_ip=uk_ip.substring(0,t)),uk_domain=uk_domain.replace("wss://",""),t=uk_domain.lastIndexOf("/"),t>0&&(uk_domain=uk_domain.substring(0,t)),t=uk_domain.lastIndexOf(":"),t>0&&(uk_domain=uk_domain.substring(0,t)),e.indexOf(uk_ip)>=0||e.indexOf(uk_domain)>=0)return!0}catch(o){PutToDebugLogException(2,"common: IsUKGateway",o)}return!1}function IsUSGateway(e){try{if(isNull(e)||e.length<3)return!1;isNull(us_ip)&&(us_ip=StrDc(wip_us,alsvkey),us_domain=StrDc(wips_us,alsvkey));var t=-1;if(us_ip=us_ip.replace("ws://",""),t=us_ip.lastIndexOf("/"),t>0&&(us_ip=us_ip.substring(0,t)),t=us_ip.lastIndexOf(":"),t>0&&(us_ip=us_ip.substring(0,t)),us_domain=us_domain.replace("wss://",""),t=us_domain.lastIndexOf("/"),t>0&&(us_domain=us_domain.substring(0,t)),t=us_domain.lastIndexOf(":"),t>0&&(us_domain=us_domain.substring(0,t)),e.indexOf(us_ip)>=0||e.indexOf(us_domain)>=0)return!0}catch(o){PutToDebugLogException(2,"common: IsUSGateway",o)}return!1}function ClassWServers(){this.address="",this.worked=!1,this.answertime=99999,this.load=-1,this.apikey=""}function DecideWebrtcServer(){try{if(!isNull(selectedwserver)&&selectedwserver.length>3)return;if(!0===decide_already_run)return void PutToDebugLog(2,"ERROR, DecideWebrtcServer already run");var e=GetParameter("webrtcserveraddress");if(isNull(e)||e.length<4)return;if(e.indexOf(",")<0){e.indexOf("://")<0&&(e=IsHttps()||!1===IsIPAddrress(e)?"wss://"+e:"ws://"+e),selectedwserver=e;var t="",o=selectedwserver.indexOf("authkey=");return void(o>0&&(t=selectedwserver.substring(o+8),selectedwserver=selectedwserver.substring(0,o),isNull(t)&&(t=""),o=t.indexOf("&"),o>0&&(t=t.substring(0,o)),t=Trim(t),global.selected_apikey=api_key,!0===IsUKGateway(selectedwserver)?global.usuk="uk":!0===IsUSGateway(selectedwserver)&&(global.usuk="us")))}for(var n=e.split(","),i=0;i<n.length;)isNull(n[i])||n[i].length<4?n.splice(i,1):i++;if(isNull(n)||n.length<1)return;for(var r=!0,a=n.length,s=0;s<a;s++)if(n[s].toLowerCase().indexOf("mfstwebsock")<1&&n[s].toLowerCase().indexOf("mvstwebsock")<1){r=!1;break}n=ShuffleArray(n);var l=GetParameter("lastwebrtcserver"),c=GetParameter("topprioritywebrtcserver");if(!isNull(c)&&c.length>0)for(var s=0;s<a;s++)if(n[s]===c){var u=splice(s,1);n.unshift(u);break}if(!isNull(l)&&l.length>0)for(var s=0;s<a;s++)if(n[s]===l){var u=splice(s,1);n.unshift(u);break}var m=GetTickCount();if(wsrvL=[],isNull(addrtimer)||clearInterval(addrtimer),addrtimer=null,addr_maxloop=0,decide_already_run=!0,!0===r)for(var s=0;s<a;s++)!function(){function e(){!isNull(u)&&u.close&&u.close(),u=null}var t=s,o=new ClassWServers;try{var i=n[t],r="",a=i.indexOf("authkey=");a>0&&(r=i.substring(a+8),isNull(r)&&(r=""),a=r.indexOf("&"),a>0&&(r=r.substring(0,a)),r=Trim(r));var l=!1;i.indexOf("mfstwebsock")>0&&(l=!0);var c=HandleAddress(i);o.address=c,o.apikey=r,PutToDebugLog(2,"EVENT, DecideWebrtcServer ("+t+") url: "+c);var u=new WebSocket(c,"sip");u.binaryType="arraybuffer",u.onopen=function(){g=!0};var m=0,g=!1,d=setInterval(function(){m++,1===u.readyState&&!0===g&&!0===l&&(h=GetTickCount(),u.send("mrtcping\r\n")),(m>25||1===u.readyState)&&(isNull(d)||clearInterval(d),d=null)},100),p=-1,h=0;u.onerror=function(){o.worked=!1,AddWsAddress(o)},u.onclose=function(){o.worked=!1,AddWsAddress(o)},u.onmessage=function(n){var i=null;if(isNull(n)||(i=n.data),!isNull(i)){var r=ArrayBufferToString(i);if(r=r.toLowerCase(),r.indexOf("mrtcpong")>=0){p=GetTickCount()-h,o.answertime=p;var s=GetSpecialWsloadUrl(c);PutToDebugLog(2,"EVENT, DecideWebrtcServer send wsload ("+t+") url: "+c+"; answertime: "+p.toString()+"; url: "+s),u.send(s+"\r\n")}else{var l=r;if((a=l.indexOf("ws load:"))>=0){l=l.substring(a+8),l=Trim(l),a=l.indexOf(" "),a>0&&(l=l.substring(0,a));var m=-1;!isNull(l)&&IsNumber(l)&&(m=StrToInt(l)),o.load=m,PutToDebugLog(2,"EVENT, DecideWebrtcServer rec wsload ("+t+") url: "+c+"; answertime: "+p.toString()+"; load: "+l),AddWsAddress(o),e()}}}},setTimeout(function(){e()},6500)}catch(f){o.worked=!1,PutToDebugLogException(2,"DecideWebrtcServer ("+t+") failure",f)}}();else{var g=0;if(g<a){var d=g,p=new ClassWServers;try{var h=HandleAddress(n[d]);p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=HandleAddress(n[d]);p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}if(++g<a){var d=g,p=new ClassWServers;try{var h=n[d];p.address=h,PutToDebugLog(2,"EVENT, DecideWebrtcServerT ("+d+") url: "+h);var f=new WebSocket(h,"sip");f.binaryType="arraybuffer",f.onopen=function(){var e=GetTickCount()-m;p.answertime=e,p.worked=!0,PutToDebugLog(2,"EVENT, DecideWebrtcServerT onopen ("+d+") url: "+h+"; answertime: "+e.toString()),!isNull(f)&&f.close&&f.close(),f=null,AddWsAddress(p,!0)}}catch(b){p.worked=!1,PutToDebugLogException(2,"DecideWebrtcServerT ("+d+") failed to connect",b)}}g++}}catch(v){PutToDebugLogException(2,"common: DecideWebrtcServer",v)}}function ShuffleArray(e){try{var t,o,n,i=e;for(n=i.length-1;n>0;n--)t=Math.floor(Math.random()*(n+1)),o=i[n],i[n]=i[t],i[t]=o;return i}catch(r){PutToDebugLogException(2,"common: ShuffleArray",r)}return e}function Engine(){this.name,this.cfg_priority,this.defpriority,this.available,this.serversupport,this.finalscore,this.finalscorex,this.pushlevel,this.failed,this.clicked,this.issupported_cache,this.isinstalled_cache,this.serversupport_cache,this.available_old,this.asyncreqbegintime}function GetEngineList(){return engines}function GetSelectedEngine(){return selected_engine}function GetRecommendedEngine(){return recommend_engine}function GetSelectedEngineName(){try{if(!isNull(selected_engine)&&!isNull(selected_engine.name))return selected_engine.name}catch(e){PutToDebugLogException(2,"common: GetSelectedEngineName",e)}return null}function GetRecommendedEngineName(){try{if(!isNull(recommend_engine)&&!isNull(recommend_engine.name))return recommend_engine.name}catch(e){PutToDebugLogException(2,"common: GetRecommendedEngineName",e)}return null}function GetEngine(e){try{if(isNull(engines))return null;for(var t,o=0;o<engines.length;o++)if(t=engines[o],t.name===e)return t}catch(n){PutToDebugLogException(2,"common: GetEngine",n)}return null}function SetEngine(e,t){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, common SetEngine invalid engine name: "+e),!1;if(isNull(t))return PutToDebugLog(2,"ERROR, common SetEngine invalid engine object"),!1;if(isNull(engines))return PutToDebugLog(2,"ERROR, common SetEngine engines is NULL"),!1;for(var o=0;o<engines.length;o++)engines[o].name===e&&(engines[o]=t)}catch(n){PutToDebugLogException(2,"common: GetEngine",n)}return!1}function ResetEngineClicked(){try{if(isNull(engines))return PutToDebugLog(2,"ERROR, common ResetEngineClicked engines is NULL"),!1;for(var e,t=0;t<engines.length;t++)e=engines[t],e.clicked=0,engines[t]=e}catch(o){PutToDebugLogException(2,"common: ResetEngineClicked",o)}}function HasUsableEngine(e){try{if(isNull(engines))return!1;for(var t,o=0;o<engines.length;o++)if(t=engines[o],t.available>1&&t.failed<1&&e.name!==t.name&&t.name.indexOf("_avail")<0&&t.defpriority>0)return!0}catch(n){PutToDebugLogException(2,"common: HasUsableEngine",n)}return!1}function HasUsableEngineFromEngines(e,t){try{if(isNull(engines))return!1;for(var o,n=0;n<engines.length;n++)if(o=engines[n],!(t.indexOf(o.name)<0)&&o.available>1&&o.failed<1&&e.name!==o.name&&o.name.indexOf("_avail")<0&&o.defpriority>0)return!0}catch(i){PutToDebugLogException(2,"common: HasUsableEngineFromEngines",i)}return!1}function IsMizuWebRTCGateway2(){try{return GetConfigInt("ismrtcgateway",0)>0||(global.wsload_type>0||IsMizuWebRTCGateway())}catch(e){PutToDebugLogException(2,"common: IsMizuWebRTCGateway2",e)}return!1}function IsMizuWebRTCGateway(){try{var e=GetWebrtcSrvAddr();if(isNull(e)||e.length<2)return!0;e=e.toLowerCase(),e=NormalizeInput(e,0),e=e.replace("*","");var t=e.indexOf("/");t>0&&(e=e.substring(0,t));var t=0,o=StrDc(wip_uk,alsvkey);o=o.toLowerCase(),o=NormalizeInput(o,0),o=o.replace("*",""),t=o.indexOf(":"),t>0&&(o=o.substring(0,t)),t=o.indexOf("/"),t>0&&(o=o.substring(0,t));var n=StrDc(wips_uk,alsvkey);n=n.toLowerCase(),n=NormalizeInput(n,0),n=n.replace("*",""),t=n.indexOf(":"),t>0&&(n=n.substring(0,t)),t=n.indexOf("/"),t>0&&(n=n.substring(0,t));var i=StrDc(wip_us,alsvkey);i=i.toLowerCase(),i=NormalizeInput(i,0),i=i.replace("*",""),t=i.indexOf(":"),t>0&&(i=i.substring(0,t)),t=i.indexOf("/"),t>0&&(i=i.substring(0,t));var r=StrDc(wips_us,alsvkey);if(r=r.toLowerCase(),r=NormalizeInput(r,0),r=r.replace("*",""),t=r.indexOf(":"),t>0&&(r=r.substring(0,t)),t=r.indexOf("/"),t>0&&(r=r.substring(0,t)),o===e||n===e||i===e||r===e)return!0}catch(a){PutToDebugLogException(2,"common: IsMizuWebRTCGateway",a)}return!1}function IsMizuWebRTCEmbeddedServer(){try{var e=GetWebrtcSrvAddr();if(isNull(e)||e.length<2)return!1;if(e.indexOf("*")>=0||e.indexOf("mfstwebsock")>0)return!0}catch(t){PutToDebugLogException(2,"common: IsMizuWebRTCEmbeddedServer",t)}return!1}function IsMizuServer(){try{var e=webphone_api.parameters.webrtcserveraddress;if((isNull(e)||e.length<2)&&(e=GetConfig("webrtcserveraddress"),(isNull(e)||e.length<2)&&(e=GetWp())),isNull(e)&&(e=""),e=e.toLowerCase(),e.indexOf("mfstwebsock")>0)return!0}catch(t){PutToDebugLogException(2,"common: IsMizuServer",t)}return!1}function CanIUseApplet(){try{var e=GetBrowserVersion(),t=GetBrowser(),o=GetOs(),n=webphone_api.getmaxchromeversionforjava();if(PutToDebugLog(4,"CanIUseApplet, OS: "+o+"; browser: "+t),"Windows"===o){if("Chrome"===t)return!(isNull(e)||IsNumber(e)&&(e<1||e>n));if("Firefox"===t){var i=GetParameterInt("nojavaforff",52);return!(!0===Is64BitBrowser()||GetBrowserVersion()>=i)||(PutToDebugLog(4,"CanIUseApplet, nojavaforff: "+i),!1)}return"Safari"===t?GetBrowserVersion()<6:"Edge"!==t}if("Mac"===o)return"Chrome"===t?!(isNull(e)||IsNumber(e)&&(e<1||e>n)):"Safari"!==t||!!(!isNull(e)&&IsNumber(e)&&e>0&&e<7);if("Linux"===o)return"Chrome"!==t||!(isNull(e)||IsNumber(e)&&(e<1||e>n))}catch(r){PutToDebugLogException(2,"common: CanIUseApplet",r)}return!1}function CanIUseWebRTC(){try{if(lversion<=0){var e=[];if("Android"===GetOs()||"iOS"===GetOs()){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_");var t=e.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},500)}return!1}if(1===lversion&&!1===Glsp()){var e=[];e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},510),!1}if(IsMizuWebRTCGateway()&&IsLanIP(GetWebrtcUpperServer()))return PutToDebugLog(2,"EVENT, CanIUseWebRTC server is on local network"),!1;if("iOS"===GetOs()){if("Safari"!==GetBrowser()&&"iPhone"!==GetBrowser())return!1;if(GetBrowserVersion()<11)return!1}if(75!==GetParameterInt("brandid",-1)){var o=webphone_api.parameters.webrtcserveraddress;if((isNull(o)||Trim(o).length<1)&&(o=GetConfig("webrtcserveraddress")),isNull(o)||Trim(o).length<1){var n=wpa.webrtcapi.GetUDPServerAddress();if(isNull(n)&&(n=""),n=n.replace("udp://",""),n.length>0&&!1===IsIPAddrress(n)&&DomainToIpServer(n,function(e){isNull(e)||e.length<1||(canresolvedomain=!(e.indexOf("cannotresolve")>=0))}),!1===canresolvedomain)return PutToDebugLog(2,"EVENT, CanIUseWebRTC WebRTC NOT available: Cannot resolve SIP server domain: "+n),!1}}if(global.webrtcavailable<1)return PutToDebugLog(2,"EVENT, CanIUseWebRTC WebRTC NOT available in this environment: "+global.webrtcavailable.toString()),!1;if(0===GetConfigInt("usemizuwebrtcgateway",1)&&GetWebrtcSrvAddr().length<2)return PutToDebugLog(2,"WARNING, CanIUseWebRTC WebRTC available but there is no webrtc server"),!1;if("Windows"===GetOs()){if("MSIE"===GetBrowser())return!1;if("Edge"===GetBrowser()&&GetBrowserVersion()<14)return!1}return!0}catch(i){PutToDebugLogException(2,"common: CanIUseWebRTC",i)}return!1}
function CanIUseService(){try{if("Windows"!==GetOs()&&!IsMacLin()||IsMacLin()&&!1===NSMacLinEnabled())return PutToDebugLog(2,"EVENT, CanIUseService not windows/mac/linux: false"),!1;var e=StrToInt(GetParameter2("enginepriority_java")),t=StrToInt(GetParameter2("enginepriority_webrtc")),o=StrToInt(GetParameter2("enginepriority_ns")),n=StrToInt(GetParameter2("enginepriority_flash")),i=StrToInt(GetParameter2("enginepriority_app")),r=StrToInt(GetParameter2("enginepriority_p2p")),a=StrToInt(GetParameter2("enginepriority_accessnum")),s=StrToInt(GetParameter2("enginepriority_nativedial")),l=!1;if(!isNull(e)&&IsNumber(e)||(l=!0,e=2),!isNull(t)&&IsNumber(t)||(l=!0,t=2),!isNull(o)&&IsNumber(o)||(l=!0,o=2),!isNull(n)&&IsNumber(n)||(l=!0,n=2),!isNull(i)&&IsNumber(i)||(l=!0,i=2),!isNull(r)&&IsNumber(r)||(l=!0,r=2),!isNull(a)&&IsNumber(a)||(l=!0,a=2),!isNull(s)&&IsNumber(s)||(l=!0,s=2),!0===l&&PutToDebugLog(2,"EVENT, CanIUseService priorities are NULL, probably couldnt read settings"),o<1||e>4||t>4||n>4||i>4||r>4||a>4||s>4)return PutToDebugLog(2,"EVENT, CanIUseService: false, other forced"),!1;if(lversion<=0)return!1;if(1===lversion&&!1===Glsp()){var c=[];c.push("D"),c.push("e"),c.push("s"),c.push("k"),c.push("t"),c.push("o"),c.push("p"),c.push(" "),c.push("o"),c.push("n"),c.push("l"),c.push("y"),c.push("_"),c.push("2");var u=c.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+u)},620),!1}if(window.WebSocket)return PutToDebugLog(2,"EVENT, CanIUseService_1 true"),!0;if("Chrome"===GetBrowser())return PutToDebugLog(2,"EVENT, CanIUseService_2 true"),!0;PutToDebugLog(2,"EVENT, CanIUseService final false")}catch(m){PutToDebugLogException(2,"common: CanIUseService",m)}return!1}function CanIUseFlash(){try{if(PutToDebugLog("EVENT, CanIUseFlash__1"),IsLocalServer(!0))return PutToDebugLog("EVENT, CanIUseFlash__2"),PutToDebugLog(2,"EVENT, Cannot use flash (can i use this engine) server to connect to local network VoIP server"),!1;if(lversion<=0){PutToDebugLog("EVENT, CanIUseFlash__3");var e=[];if("Android"===GetOs()||"iOS"===GetOs()){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var t=e.join("");setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},650)}return!1}if(1===lversion&&(PutToDebugLog("EVENT, CanIUseFlash__4"),!1===Glsp())){e.push("D"),e.push("e"),e.push("s"),e.push("k"),e.push("t"),e.push("o"),e.push("p"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push("_"),e.push("3");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},680),!1}PutToDebugLog("EVENT, CanIUseFlash__5");var o=GetParameterInt("enginepriority_java",2),n=GetParameterInt("enginepriority_webrtc",2),i=GetParameterInt("enginepriority_ns",2),r=GetParameterInt("enginepriority_flash",2),a=GetParameterInt("enginepriority_app",2),s=GetParameterInt("enginepriority_p2p",2),l=GetParameterInt("enginepriority_accessnum",2),c=GetParameterInt("enginepriority_nativedial",2);if(PutToDebugLog("EVENT, CanIUseFlash__6"),r>2||o<r&&n<r&&i<r&&a<r&&s<r&&l<r&&c<r){if(PutToDebugLog("EVENT, CanIUseFlash__7 old style detect"),webphone_api.flashdeepdetect=!0,swfobject.hasFlashPlayerVersion("9.0.115"))return!0}else{PutToDebugLog("EVENT, CanIUseFlash__8");try{var u=navigator.plugins["ShockwaveFlash.ShockwaveFlash"];if(u)return PutToDebugLog("EVENT, CanIUseFlash__9"),!0;if(PutToDebugLog("EVENT, CanIUseFlash__10"),u=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(m){if(PutToDebugLog("EVENT, CanIUseFlash__11"),navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!=undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return PutToDebugLog("EVENT, CanIUseFlash__12"),!0}PutToDebugLog("EVENT, CanIUseFlash__13")}PutToDebugLog("EVENT, CanIUseFlash__14")}catch(g){PutToDebugLogException(2,"common: CanIUseFlash",g)}return!1}function GetSinglePossibleEngine(){try{var e=GetParameterInt("enginepriority_java",2),t=GetParameter2("enginepriority_webrtc",2),o=GetParameter2("enginepriority_ns",2),n=CanIUseWebRTC(),i=CanIUseApplet();if("Android"===GetOs()){if(!1===n)return global.ENGINE_APP}else if("iOS"===GetOs()){if(!1===n)return global.ENGINE_APP}else if("Windows"===GetOs())if("Edge"===GetBrowser()){if(!1===n)return global.ENGINE_SERVICE}else if(!1===i||e<1){if(!1===n||t<1)return global.ENGINE_SERVICE;if(!0===n||o<1)return global.ENGINE_WEBRTC}}catch(r){PutToDebugLogException(2,"common: GetSinglePossibleEngine",r)}return""}function IsJavaInstalled(){try{if("Windows"===GetOs()&&"Edge"===GetBrowser())return 0;var e=null,t=!1,o=0;if(navigator.mimeTypes&&navigator.mimeTypes.length?(e=navigator.mimeTypes["application/x-java-jnlp-file"],null==e&&(e=navigator.mimeTypes["application/x-java-vm"]),null==e&&(e=navigator.mimeTypes["application/x-java-applet"]),e?o=1:"MSIE"===GetBrowser()&&(t=!0)):t=!0,t){isNull(document.getElementById("deployJavaPlugin"))&&mwpdeploy.writePluginTag();var n=mwpdeploy.getJREs();if(!isNull(n)&&n.length>0)for(var i=0;i<n.length;i++)o=1;return o<1?0:2}return o?navigator.javaEnabled()?2:1:0}catch(r){PutToDebugLogException(2,"common: IsJavaInstalled",r)}return 0}function EngineIsSupported(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=[];if(lversion<=0){if("Android"===GetOs()||"iOS"===GetOs()){t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y");var o=t.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},500),0}if("java"!==e)return 0}else if(1===lversion){if(!1===Glsp()){t.push("D"),t.push("e"),t.push("s"),t.push("k"),t.push("t"),t.push("o"),t.push("p"),t.push(" "),t.push("o"),t.push("n"),t.push("l"),t.push("y");var o=t.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+o)},500),0}if("java"!==e&&"webrtc"!==e&&"ns"!==e)return 0}if("java"===e){var n=CanIUseApplet();return PutToDebugLog(2,"EVENT, EngineIsSupported CanIUseApplet returned: "+n.toString()),!0===n?1:0}if("webrtc"===e){if(CanIUseWebRTC()){if(!0===BrowserRequiresHttps(!0)&&!1===IsHttps()){var i=GetUsemizutlsproxy();return"false"===GetParameter("usemizutlsproxy_userreload")||"2"!==i&&("1"!==i||!0!==global.usestorage&&!Strl(60))?(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine maybe supported"),1):(PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2)}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine supported"),2}return PutToDebugLog(2,"EVENT, CanIUseWebRTC engine not supported"),0}if("ns"===e)return CanIUseService()?1:0;if("flash"===e)return CanIUseFlash()?2:0;if("app"===e){var r=GetNativeDialerUrl(GetOs());return!isNull(r)&&r.length>5?2:(PutToDebugLog(2,"ERROR, EngineIsSupported: app engine not supported, because cannot find URL"),0)}return"p2p"===e?GetParameter("p2p").length<4?0:2:"accessnum"===e?("Android"===GetOs()||"iOS"===GetOs())&&GetParameter("accessnumber").length>2?2:0:"nativedial"===e?"Android"===GetOs()||"iOS"===GetOs()?2:0:"otherbrowser"===e?("Windows"===GetOs()||"Mac"===GetOs()||"Linux"===GetOs())&&GetParameterInt("enginepriority_otherbrowser",2)>0&&GetParameter("pc_alternatebrowserurl").length>3?2:0:(PutToDebugLog(2,"ERROR, common: EngineIsSupported invalid engine name: "+e),0)}catch(a){PutToDebugLogException(2,"common: EngineIsSupported",a)}}function EngineIsInstalled(e,t,o){try{if(e.indexOf("_avail")>0)return 2;if("java"!==e&&"ns"!==e&&"app"!==e&&"webrtc"!==e)return 2;var n=GetEngine(e);if(n.isinstalled_cache>=0)return n.isinstalled_cache;if(t>0&&0===n.asyncreqbegintime&&(t=0),"java"!==e){if(0===t&&0!==n.asyncreqbegintime)return 1;if(t>0&&0!==n.asyncreqbegintime&&GetTickCount()-n.asyncreqbegintime>3e3)return 0;if(0===n.asyncreqbegintime&&(n.asyncreqbegintime=GetTickCount()),t>0)return-1;if("ns"===e)return PutToDebugLog(2,"EVENT, engine waiting for IsServiceInstalled"),IsServiceInstalled(function(e){PutToDebugLog(2,"EVENT, engine IsServiceInstalled: "+e);var t=GetEngine("ns");t.isinstalled_cache=e?2:0,SetEngine("ns",t)},!1),-1;if("app"===e)return 2}else{if("java"===e){if("Windows"===GetOs()&&"Edge"===GetBrowser()||"Chrome"===GetBrowser())return 0;var i=IsJavaInstalled(),r=GetEngine("java");return r.isinstalled_cache=i,SetEngine("java",r),1===i?-1:i}if("webrtc"===e)return CanIUseWebRTC()?!0===BrowserRequiresHttps(!0)?1:2:0}}catch(a){PutToDebugLogException(2,"common: EngineIsInstalled",a)}return 0}function GetServersupport(e,t){try{if(e.indexOf("_avail")>0)return 1;if("webrtc"!==e)return 1;var o=GetEngine(e);if(o.serversupport_cache>=0)return o.serversupport_cache;if(t>0&&0===o.asyncreqbegintime&&(t=0),0===t&&0!==o.asyncreqbegintime)return 1;if(t>0&&0!==o.asyncreqbegintime&&GetTickCount()-o.asyncreqbegintime>3e3)return 0;if(0===o.asyncreqbegintime&&(o.asyncreqbegintime=GetTickCount()),t>0)return-1;var n=GetConfig("brandid"),i=GetBrandName(),r=GetConfig("companyname"),a="";GetSipusername().length>0&&(a="&username="+GetSipusername());var s=GetLastUsedEngine(),l=GetSelectedEngineName();if(isNull(s)||s.length<1||"webrtc"===s||"java"!==s&&"ns"!==s||"webrtc"===l){DecideWebrtcServer();var c=1;if(IsMizuWebRTCGateway()){global.decideusuk_finished=!1;var u=8e3;setTimeout(function(){if(!1===global.decideusuk_finished){PutToDebugLog(2,"EVENT, decideusuk not yet finihed after delay: "+u.toString());var e=GetWebrtcSrvAddr();(isNull(e)||e.length<2)&&(e=GetWp()),IsUKGateway(e)?(PutToDebugLog(2,"WARNING, common manually setting UK gateway, because DecideUsUk has not yet finished after delay: "+u.toString()),global.usuk="uk"):IsUSGateway(e)&&(PutToDebugLog(2,"WARNING, common manually setting US gateway, because DecideUsUk has not yet finished after delay: "+u.toString()),global.usuk="us"),global.decideusuk_finished=!0}},u);var m="http://rtc.mizu-voip.com/mvapireq/?authkey=1568108345&apientry=wsload&brandid="+n+"&brandname="+i+"&companyname="+r+"&upperserver="+GetWebrtcUpperServer()+"&authid="+a+"&now=415",g="http://usrtcx.webvoipphone.com/mvapireq/?authkey=1552303117&apientry=wsload&brandid="+n+"&brandname="+i+"&companyname="+r+"&upperserver="+GetWebrtcUpperServer()+"&authid="+a+"&now=415";PutToDebugLog(2,"EVENT, DecideUsUk UK_url (UK Websocket connect): "+m),PutToDebugLog(2,"EVENT, DecideUsUk US_url (US Websocket connect): "+g),!0===BrowserRequiresHttps(!1)&&(m=m.replace("http:","https:"),g=g.replace("http:","https:"));var d=GetWp("uk"),p=GetWp("us");if(d=d.replace("*",""),p=p.replace("*",""),d=d.replace("/mfstwebsock","/mvstwebsock"),p=p.replace("/mfstwebsock","/mvstwebsock"),IsLocalServer(!0))PutToDebugLog(2,"ERROR, wsload decide"+stringres.get("webrtc_local_sipserver")+" (8)");else try{var h=new WebSocket(d,"api"),f=new WebSocket(p,"api");h.binaryType="arraybuffer",f.binaryType="arraybuffer",h.onopen=function(){h.send(m+"\r\n"),PutToDebugLog(2,"EVENT, UK wsload sent (UK Websocket onopen)"),SaveParameter("wseverconnected","true")},f.onopen=function(){f.send(g+"\r\n"),PutToDebugLog(2,"EVENT, US wsload sent (US Websocket onopen)"),SaveParameter("wseverconnected","true")},h.onclose=function(){h=null},f.onclose=function(){f=null},h.onerror=function(e){},f.onerror=function(e){},h.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))PutToDebugLog(2,"ERROR, UK wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(t),"wrtcload_uk")}h&&h.close&&h.close()},f.onmessage=function(e){var t=null;if(isNull(e)||(t=e.data),isNull(t))PutToDebugLog(2,"ERROR, US wsload failed, received data is NULL");else{HttpResponseHandler(ArrayBufferToString(t),"wrtcload_us")}f&&f.close&&f.close()}}catch(b){PutToDebugLogException(2,"common: GetServersupport wsload inner",b)}c=1300}else global.decideusuk_finished=!0;setTimeout(function(){var e=GetWsloadUrl(GetSipusername());!isNull(e)&&e.length>0&&(PutToDebugLog(5,"EVENT, common: GetServersupport GetWebrtcLoad"),UriParser(e,"","","","","webrtcload"))},c)}if(!IsMizuServer())return o.serversupport_cache=0,SetEngine(e,o),0}catch(b){PutToDebugLogException(2,"common: GetServersupport",b)}return 0}function GetCfgPriority(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=2;try{t=parseInt(GetParameter2("enginepriority_"+e))}catch(n){PutToDebugLogException(2,"common: GetCfgPriority parseint: "+e,n)}var o=window.location.protocol;return"flash"===e&&!isNull(o)&&o.length>0&&o.toLowerCase().indexOf("file")>=0&&(t=0),t}catch(n){PutToDebugLogException(2,"common: GetCfgPriority",n)}return 2}function GetCfgOldAvailable(e){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var t=1;try{t=parseInt(GetParameter("engineoldavailable_"+e))}catch(o){PutToDebugLogException(2,"common: GetCfgOldAvailable parseint: "+e,o)}return IsNumber(t)||(t=1),t}catch(o){PutToDebugLogException(2,"common: GetCfgOldAvailable",o)}return 1}function SaveCfgOldAvailable(e,t){try{if(e.indexOf("_avail")>0)return;SaveParameter("engineoldavailable_"+e,t)}catch(o){PutToDebugLogException(2,"common: SaveCfgOldAvailable",o)}}function GetEngineDefPriority(e,t){try{e.indexOf("_avail")>0&&(e=e.substring(0,e.indexOf("_avail")));var o=GetConfig("enginedefpriority_"+e);if(!isNull(o)&&o.length>0&&IsNumber(o))return StrToInt(o)}catch(n){PutToDebugLogException(2,"common: GetEngineDefPriority",n)}return t}function EngineSelect(e,t){try{var o;if(!1===t&&PutToDebugLog(2,"ERROR, Engine select called with cannot wait"),PutToDebugLog(2,"EVENT, EngineSelect called with stage: "+e),global.engineselecttime=GetTickCount(),global.engineselectstage=e,isNull(engines)){engines=[];var n=30;!1===CanIUseApplet()&&(n=.1),o=new Engine,o.name="java",o.defpriority=GetEngineDefPriority("java",n),engines.push(o),o=new Engine,o.name="webrtc",o.defpriority=GetEngineDefPriority("webrtc",26),engines.push(o),o=new Engine,o.name="flash",o.defpriority=GetEngineDefPriority("flash",13),engines.push(o),o=new Engine,o.name="ns",o.defpriority=GetEngineDefPriority("ns",31),engines.push(o);var i=10;"Windows"!==GetOs()&&"Mac"!==GetOs()&&"Linux"!==GetOs()||(i=.1),o=new Engine,o.name="app",o.defpriority=GetEngineDefPriority("app",i),engines.push(o),o=new Engine,o.name="p2p",o.defpriority=GetEngineDefPriority("p2p",5),engines.push(o),o=new Engine,o.name="nativedial",o.defpriority=GetEngineDefPriority("nativedial",3),engines.push(o),o=new Engine,o.name="otherbrowser",o.defpriority=GetEngineDefPriority("otherbrowser",2),engines.push(o),o=new Engine,o.name="java_avail",o.defpriority=GetEngineDefPriority("java_avail",33),engines.push(o),o=new Engine,o.name="ns_avail",o.defpriority=GetEngineDefPriority("ns_avail",31),engines.push(o),o=new Engine,o.name="app_avail",o.defpriority=GetEngineDefPriority("app_avail",i),engines.push(o);for(var r=0;r<engines.length;r++)o=engines[r],o.pushlevel=-1,o.issupported_cache=-1,o.isinstalled_cache=-1,o.serversupport_cache=-1,o.failed=0,o.clicked=0,o.asyncreqbegintime=0,o.available_old=GetCfgOldAvailable(o.name)}for(var r=0;r<engines.length;r++)if(o=engines[r],o.cfg_priority=GetCfgPriority(o.name),e>0&&!IsNumber(o.cfg_priority)&&PutToDebugLog(2,"ERROR,Engineselect priority: "+o.name+" is not a number: "+o.cfg_priority),(o.cfg_priority>=5||o.clicked>=2)&&o.name.indexOf("_avail")<0)return selected_engine=o,selected_engine.pushlevel=1,recommend_engine=null,PutToDebugLog(2,"Returning forced only engine set by config: "+o.name),"webrtc"===o.name&&!1===getsrvsupportcalled&&(getsrvsupportcalled=!0,GetServersupport("webrtc",e)),1;var a=GetWebrtcSrvAddr();if(!isNull(a)&&a.length>3&&a.toLowerCase().indexOf("mfstwebsock")<0){2===GetParameterInt("enginepriority_webrtc",1)&&(PutToDebugLog(2,"EVENT, enginepriority_webrtc auto increased to: 3"),SaveParameter("enginepriority_webrtc","3"))}if(lastengine_started_ok=GetLastUsedEngine(),lastengine_working_ok=GetLastUsedEngine(),PutToDebugLog(2,"EVENT, EngineSelect at stage: "+e+"; lastusedengine: "+lastengine_started_ok),lastengine_working_ok.length>0)for(var r=0;r<engines.length;r++)if(o=engines[r],o.name===lastengine_working_ok&&o.failed<1&&o.name.indexOf("_avail")<0&&o.defpriority>0)if("webrtc"===o.name&&(IsMizuWebRTCGateway()||IsMizuWebRTCEmbeddedServer()))avoidjavapopup=2;else if(("flash"!==o.name||"true"!==GetParameter("java_worked"))&&"true"!==GetParameter("ns_worked")&&"true"!==GetParameter("webrtc_worked")){selected_engine=o,selected_engine.pushlevel=1,recommend_engine=null;var s="";try{s=selected_engine.name}catch(R){}return PutToDebugLog(2,"Returning last working ok engine: "+s),1}for(var r=0;r<engines.length;r++){o=engines[r];var l=o.issupported_cache;"webrtc"===o.name&&e>0&&(l=-1),l<0&&(l=EngineIsSupported(o.name)),o.issupported_cache=l,0===l?o.available=0:2===l?o.available=3:lastengine_started_ok===o.name||lastengine_working_ok===o.name?o.available=2:o.available=1}for(var c=0,u=null,r=0;r<engines.length;r++)if(o=engines[r],o.available>2&&o.failed<1&&o.name.indexOf("_avail")<0){if(u=o,++c>1){u=null;break}}else if(o.available>0){u=null;break}if(!isNull(u))return selected_engine=u,selected_engine.pushlevel=1,recommend_engine=null,PutToDebugLog(2,"Returning the only good engine: "+selected_engine.name),1;if(1===avoidjavapopup){var m=GetEngine("java");avoidjavapopup=m.available_old>2?2:0===m.available_old?2:0}for(var r=0;r<engines.length;r++)if(o=engines[r],!(o.available<1||o.available>2))if(o.name.indexOf("_avail")>0)o.available=3;else if(!((avoidjavapopup>1||0===e)&&"java"===o.name||(avoidflashpopup>1||0===e)&&"flash"===o.name)){var l=o.isinstalled_cache,g=HasUsableEngine(o);if(l<0&&(l=EngineIsInstalled(o.name,e,g)),l<0){if(!0===t)return 0;o.available=1,l=1}else o.isinstalled_cache=l,0===l?o.available=0:2===l&&(o.available=3)}if(IsMizuWebRTCGateway()||!0===IsMizuServer())for(var r=0;r<engines.length;r++)if(o=engines[r],o.serversupport=1,"webrtc"===o.name)if(o.available<1)o.serversupport=2;else if(o.serversupport=o.serversupport_cache,o.serversupport<0&&(o.serversupport=GetServersupport(o.name,e)),o.serversupport<0){if(t)return 0;o.serversupport=3}else o.serversupport_cache=o.serversupport;if(avoidjavapopup>1&&e>0){var m=GetEngine("java"),g=HasUsableEngine(m);if(m.available_old>2?m.available=m.available_old:0===m.available_old&&g&&(m.available=m.available_old),m.available<1||m.available>2);else{var d=GetEngine("webrtc"),p=GetEngine("ns");if((1===m.available||2===m.available)&&m.cfg_priority<=2&&(d.available>2&&d.cfg_priority>=2&&d.serversupport<=1||p.available>2&&p.cfg_priority>=2));else{var l=o.isinstalled_cache;if(l<0&&(l=EngineIsInstalled(m.name,e,g)),l<0)return 0;o.isinstalled_cache=l,0===l?m.available=0:2===l&&(m.available=3)}}}if(avoidflashpopup>1&&e>0){var h=GetEngine("flash"),g=HasUsableEngine(h);if(h.available_old>2?h.available=h.available_old:0==h.available_old&&g&&(h.available=h.available_old),h.available<1||h.available>2);else{var d=GetEngine("webrtc"),p=GetEngine("service"),m=GetEngine("java");if((1==h.available||2==h.available)&&h.cfg_priority<=2&&(d.available>2&&d.cfg_priority>=2&&d.serversupport<=1||p.available>2&&p.cfg_priority>=2||m.available>2&&m.cfg_priority>=2));else{var l=o.isinstalled_cache;if(l<0&&(l=EngineIsInstalled(h.name,e,g)),l<0)return 0;o.isinstalled_cache=l,0==l?h.available=0:2==l&&(h.available=3)}}}for(var r=0;r<engines.length;r++)if(o=engines[r],e>0&&o.name.indexOf("_avail")<0&&(o.available_old=o.available,SaveCfgOldAvailable(o.name,o.available)),o.cfg_priority<1)o.finalscore=0;else{switch(o.available){case 0:o.finalscore=10;break;case 1:o.finalscore=25;break;case 2:o.finalscore=35;break;case 3:o.finalscore=60;break;default:o.finalscore=25}switch(!0===NSMacLinEnabled()||"ns"===o.name&&"Windows"!==GetOs()&&(o.finalscore=0),o.cfg_priority){case 1:o.finalscore*=.75;break;case 3:o.finalscore*=1.66;break;case 4:o.finalscore*=2.5}switch(o.defpriority<=3?o.finalscore*=.1:o.defpriority<=4?o.finalscore*=.2:o.defpriority<=6?o.finalscore*=.3:o.defpriority<=15?o.finalscore*=.4:o.defpriority<=25?o.finalscore*=.8:o.defpriority<=30?o.finalscore*=.9:o.defpriority<=35||(o.defpriority<=45?o.finalscore*=1.2:o.defpriority<=55?o.finalscore*=1.35:o.finalscore*=1.45),o.serversupport){case 0:o.finalscore*=1.1;break;case-1:case 2:o.finalscore*=.7;break;case 3:o.finalscore*=.4;break;case 4:o.finalscore*=.2}IsMizuWebRTCGateway()||(o.finalscore*=1.5),o.clicked>0&&(o.clicked=0,o.finalscore*=1.25),lastengine_started_ok.length>0&&lastengine_started_ok===o.name&&(o.finalscore*=1.1),o.failed&&o.finalscore>13&&(o.finalscore=13),lversion<1&&"java"!==o.name&&(o.finalscore*=.8)}if(e>0&&!0===CanIUseService()){var f=GetEngine("ns"),b=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var v=f.finalscore;if(b.failed>0&&IsNumber(v)){for(var r=0;r<engines.length;r++)o=engines[r],"ns"===o.name||o.name.indexOf("_avail")>0||o.finalscore>=v&&(v=o.finalscore+1);f.finalscore=v,SetEngine("ns",f)}}}if(e>0&&!0===CanIUseService()&&!1===IsHttps()&&!0===UseTLSReload()&&("Chrome"===GetBrowser()||"Safari"===GetBrowser()||"Firefox"===GetBrowser()&&GetBrowserVersion()>=68)){var f=GetEngine("ns"),b=GetEngine("webrtc");if(GetParameterInt("enginepriority_ns",2)>=GetParameterInt("enginepriority_webrtc",2)){var v=1.1*f.finalscore;SetEngine("ns",f),(!0===global.usestorage||Strl(90))&&!1===GetParameterBool("reloadalertdisplayed",!0)&&(AlertDialog(stringres.get("warning"),stringres.get("chrome_https")),PutToDebugLog(2,"WARNING, "+stringres.get("chrome_https")),SaveParameter("reloadalertdisplayed","true"))}}var _,E=null;_=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name&&o.finalscore>_&&(_=o.finalscore,E=o);if(isNull(E))return PutToDebugLog(2,"No best engine"),1;if("webrtc"===E.name&&!0===CanIUseService()&&GetEngine("ns").finalscore>15&&GetParameterInt("enginepriority_ns",2)>GetParameterInt("enginepriority_webrtc",2)+1&&!0===GetParameterBool("isfirststart",!0)){PutToDebugLog("EVENT, Engineselect switch to NS because it has higher priority");for(var T=GetEngine("ns").finalscore,P=GetEngine("webrtc").finalscore,r=0;r<engines.length;r++)"ns"===engines[r].name&&(engines[r].finalscore=P),"webrtc"===engines[r].name&&(engines[r].finalscore=T);E=GetEngine("ns")}E.finalscorex=E.finalscore,recommend_engine=null,selected_engine=E,selected_engine.pushlevel=1;var S=null;_=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],o.finalscorex=o.finalscore,o!==E&&"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name&&(!(E.finalscorex>40)||"ns"!==E.name&&"app"!==E.name||"ns"!==o.name&&"app"!==o.name)&&(!(E.finalscorex>50)||"java"!==E.name&&"ns"!==E.name&&"app"!==E.name||"java"!==o.name&&"ns"!==o.name&&"app"!==o.name||(o.finalscorex=.75*o.finalscorex),o.finalscorex>_&&(_=o.finalscorex,S=o));var N=null;_=-1e3;for(var r=0;r<engines.length;r++)o=engines[r],"java_avail"!==o.name&&"ns_avail"!==o.name&&"app_avail"!==o.name||o.name!==E.name+"_avail"&&(E.finalscorex>40&&("ns"===E.name||"app"===E.name)||(E.finalscorex>50&&("java"===E.name||"ns"===E.name||"app"===E.name)&&(o.finalscorex=.75*o.finalscorex),o.finalscorex>_&&(_=o.finalscorex,N=o)));if("webrtc"===E.name||"flash"===E.name||"p2p"===E.name||"accessnum"===E.name||"nativedial"===E.name)selected_engine.pushlevel=1;else switch(E.available){case 0:selected_engine.pushlevel=5;break;case 1:selected_engine.pushlevel=4;break;case 2:selected_engine.pushlevel=3;break;case 3:selected_engine.pushlevel=1}var N=null;if(_=-1e3,e>0)try{for(var w="",r=0;r<engines.length;r++)o=engines[r],o.name.indexOf("_avail")>0||(w.length>0&&(w+="\r\n"),w+="EngineSelectPriority: "+o.name+": "+o.finalscorex+" available: "+o.available);!isNull(w)&&w.length>0&&PutToDebugLog(2,"EVENT\r\n"+w)}catch(R){}if(isNull(S)&&isNull(N))return PutToDebugLog(2,"recommended engine result: same as selected"),1;if(isNull(S)&&!isNull(N)?S=N:!isNull(S)&&isNull(N)||S.finalscorex>50||S.finalscorex>.8*N.finalscorex||(S=N),isNull(S))return PutToDebugLog(2,"recommended engine result: null"),1;if(E.finalscorex>60)return PutToDebugLog(2,"recommended engine result: not needed1 "+E.finalscorex+"       "+TestEngineToString(S,!1)),1;if(S.finalscorex<15&&S.available<1)return PutToDebugLog(2,"recommended engine result: not needed3 "+E.finalscorex+"       "+TestEngineToString(S,!1)),1;if(E.finalscorex>22&&S.finalscorex<=10)return PutToDebugLog(2,"recommended engine result: not needed3 "+E.finalscorex+"       "+TestEngineToString(S,!1)),1;if(E.finalscorex>30&&E.finalscorex>1.35*S.finalscorex)return PutToDebugLog(2,"recommended engine result: not needed2 "+E.finalscorex+" > "+1.35*S.finalscorex+"       "+TestEngineToString(S,!1)),1;recommend_engine=S;var I=3;if(E.finalscorex<20&&recommend_engine.finalscorex>=60?I=6:E.finalscorex<30&&recommend_engine.finalscorex>50?I=5:E.finalscorex>60||E.finalscorex>50&&recommend_engine.finalscorex<30||E.finalscorex>2*recommend_engine.finalscorex?I=0:recommend_engine.finalscorex>15&&recommend_engine.finalscorex>E.finalscorex&&(E.finalscorex<30||E.finalscorex<35&&recommend_engine.finalscorex>45||recommend_engine.finalscorex>2*E.finalscorex||recommend_engine.finalscorex-E.finalscorex>25)?I=4:E.finalscorex>55&&E.finalscorex>.9*recommend_engine.finalscorex&&(I=2),recommend_engine.name.indexOf("_avail")>0){PutToDebugLog(2,"adjusting from virtual engine "+TestEngineToString(recommend_engine,!1));for(var C=recommend_engine.name.substring(0,recommend_engine.name.indexOf("_avail")),r=0;r<engines.length;r++)if(o=engines[r],o.name===C){recommend_engine=o;break}}recommend_engine.pushlevel=I,recommend_engine===selected_engine&&(recommend_engine=null)}catch(y){PutToDebugLogException(2,"common: EngineSelect",y)}return 1}function TestEngineToString(e,t){try{if(isNull(e))return"engine not set";var o=e.name;return t&&(o=o.toUpperCase()),o+"> cfgpriority: "+e.cfg_priority+", available: "+e.available+", serversupport: "+e.serversupport+", finalscore: "+e.finalscore+" ("+e.finalscorex+"), pushlevel: "+e.pushlevel+" "+TestPushLevelToString(e.pushlevel)}catch(n){PutToDebugLogException(2,"common: TestEngineToString",n)}}function TestPushLevelToString(e){try{switch(e){case-1:return"not set";case 0:return"no";case 1:return"just use";case 2:return"barely mention";case 3:return"mention on login/settings page";case 4:return"offer also after login";case 5:return"always ask for";case 6:return"force (allow only this)";default:return"unknown"}}catch(t){PutToDebugLogException(2,"common: TestPushLevelToString",t)}}function CheckInternetConnection(){try{if(0===GetParameterInt("networkchecks",1))return;if(!0===IsLocalServer())return;if(GetParameter("devicetype")!==DEVICE_WEBPHONE())return;isNull(contimer)&&(contimer=setInterval(function(){if(++ccmaxloop>100)return isNull(contimer)||clearInterval(contimer),contimer=null,void(ccmaxloop=0);j$(".messagePopup").is(":visible")||(isNull(contimer)||clearInterval(contimer),contimer=null,ccmaxloop=0,"undefined"!=typeof navigator.onLine&&null!==navigator.onLine?!1===navigator.onLine&&(ShowToast(stringres.get("connection_msg")+"_2",5e3),PutToDebugLog(1,"ERROR, "+stringres.get("connection_msg")+"_2"),PutToDebugLog(2,"ERROR, CheckInternetConnection No internet connection is available at this time")):PutToDebugLog(2,"EVENT, CheckInternetConnection could NOT check"))},1e3))}catch(e){PutToDebugLogException(2,"common: CheckInternetConnection",e)}}function CheckInternetConnectionWS(){try{if(0===GetParameterInt("networkchecks",1))return;if(lastnetsucceded>0&&GetTickCount()-lastnetsucceded<6e5)return;if(lastgood_set=!1,good_succeded=!1,GetLogLevel()<2)return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because loglevel is 1");var e=GetParameter("wstestservers");if(isNull(e)||e.length<3||"null"===e.toLowerCase())return void PutToDebugLog(2,"EVENT, CheckInternetConnectionWS no websocket addresses");if(!0===IsLocalServer())return;var t=e.split(",");if(isNull(t)||t.length<1)return void PutToDebugLog(2,"ERROR, CheckInternetConnectionWS list is NULL");if(!1===GetParameterBool("wseverconnected",!1))return void PutToDebugLog(2,"EVENT, skip CheckInternetConnectionWS because no previous sucessfull WebSocket connection");var o=GetParameter("lastgood_wstest");isNull(o)&&(o="");for(var n=0;n<t.length;)isNull(t[n])||t[n].length<3||t[n]===o?t.splice(n,1):(!0===BrowserRequiresHttps(!1)&&(t[n]=t[n].replace("ws:","wss:")),n++);if(isNull(t)||t.length<1)return void PutToDebugLog(2,"ERROR, CheckInternetConnectionWS list is NULL after");o.length>0&&t.unshift(o);var i=1;global.domloaded_tick>0&&GetTickCount()-global.domloaded_tick<2e4&&(i=2e4-(GetTickCount()-global.domloaded_tick))<1&&(i=1),isNull(wsconn_timer)||clearTimeout(wsconn_timer),wsconn_timer=null,wsconn_timer=setTimeout(function(){try{if(PutToDebugLog(2,"EVENT, CheckInternetConnectionWS start: "+t.length.toString()),t.length>0){ws1ok=-1;var e=new WebSocket(t[0]);e.onopen=function(){ws1ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",t[0]),lastgood_set=!0),good_succeded=!0,PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(1)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(t){ws1ok=0,e=null}}setTimeout(function(){if(!1===good_succeded){if(t.length>1){ws2ok=-1;var e=new WebSocket(t[1]);e.onopen=function(){ws2ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",t[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(2)"),e&&e.close&&e.close(),e=null},e.onclose=function(){e=null},e.onerror=function(t){ws2ok=0,e=null}}if(t.length>2){ws3ok=-1;var o=new WebSocket(t[2]);o.onopen=function(){ws3ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",t[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(3)"),o&&o.close&&o.close(),o=null},o.onclose=function(){o=null},o.onerror=function(e){ws3ok=0,o=null}}if(t.length>3){ws4ok=-1;var n=new WebSocket(t[2]);n.onopen=function(){ws4ok=1,!1===lastgood_set&&(SaveParameter("lastgood_wstest",t[0]),lastgood_set=!0),PutToDebugLog(2,"EVENT, CheckInternetConnectionWS public Internet connection is available(4)"),n&&n.close&&n.close(),n=null},n.onclose=function(){n=null},n.onerror=function(e){ws4ok=0,n=null}}}},1200),isNull(cic_timer)||clearTimeout(cic_timer),cic_timer=null,cic_timer=setTimeout(function(){PutToDebugLog(2,"EVENT, CheckInternetConnectionWS result: con1: "+ws1ok.toString()+"; con2: "+ws2ok.toString()+"; con3: "+ws3ok.toString()),-1!==ws1ok&&0!==ws1ok||-1!==ws2ok&&0!==ws2ok||-1!==ws3ok&&0!==ws3ok||-1!==ws4ok&&0!==ws4ok?lastnetsucceded=GetTickCount():(ShowToast(stringres.get("connection_msg"),5e3),PutToDebugLog(1,"ERROR, "+stringres.get("connection_msg")),PutToDebugLog(2,"ERROR, CheckInternetConnectionWS.onerror, public Internet connection NOT available")),lastgood_set=!1},3500)}catch(o){PutToDebugLogException(2,"common: CheckInternetConnectionWS inner timer",o)}},i)}catch(r){PutToDebugLogException(2,"common: CheckInternetConnectionWS",r)}}function GetAvailableCallfunctions(){var e="callforward,conference,transfer,numpad,mute,hold,chat";if(!0===CanIUseVideo()&&(e+=",video"),0===GetParameterInt("conferencetype",1)&&(e=e.replace("conference,","")),!1===Glcf()&&(e=e.replace("conference,","")),!1===Glvd()&&(e=e.replace("video,",""),e=e.replace(",video","")),lversion<2&&(e="callforward,transfer,numpad,mute,hold,chat"),!1===Glt()&&(e=e.replace("callforward,",""),e=e.replace("transfer,","")),GetParameterInt("featureset",3)<3&&(e="numpad,mute,chat"),5===GetParameterInt("defmute",0)&&(e=e.replace("mute,",""),e=e.replace(",mute",""),e=e.replace("mute","")),getuseengine()===global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&GetBrowserVersion()>=63){var t=ParamAsInt(GetParameter2("fasthold"),-1);1===t?e=e.replace("mute,",""):-1===t&&getuseengine()===global.ENGINE_WEBRTC&&"Firefox"===GetBrowser()&&(e=e.replace("mute,",""))}else getuseengine()===global.ENGINE_FLASH&&(e="transfer,numpad,chat",lversion<1&&(e=e.replace("transfer,","")));var o=e.split(",");if(!isNull(o)&&o.length>0){e=""
;for(var n=0;n<o.length;n++)isNull(o[n])||o[n].length<1||!1===HideSettings(o[n],stringres.get("sett_display_name_"+o[n]),o[n],!0)&&(e.length>0&&(e+=","),e+=o[n])}return e}function UploadAutoprov(){try{var e="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xautoprovpush",t="";if(isNull(settmap2))return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (1)");for(var o in settmap2)if(!(isNull(o)||o.length<1)){var n=settmap2[o];t.length>0&&(t+="\r\n"),t=t+o+";"+n[SETT_VALUE]}var i=location.href;i=decodeURIComponent(i);var r=i.indexOf("?");if(r>0&&(i=i.substring(0,r)),r=i.indexOf("#"),r>0&&(i=i.substring(0,r)),r=i.lastIndexOf("."),r>0&&i.length-r<7&&(r=i.lastIndexOf("/"))>0&&(i=i.substring(0,r)),i+="/webphone_api.js",PutToDebugLog(2,"EVENT, UploadAutoprov pathtowpapi: "+i),t+="\r\n",t=t+"pathtowpapi;"+i,isNull(t)||t.length<10)return void PutToDebugLog(2,"ERROR, common: UploadAutoprov no settins to be uploaded (2)");t="aenc_10_"+StrEc(t,global.ec_autoprov,!0),t="WPAUTOPROVSTART"+t+"WPAUTOPROVEND",!0===IsHttps()&&(e=GetTlsProxyUrl(e)),PutToDebugLog(2,"EVENT, UploadAutoprov url: "+e),HttpRequest(e,"wpautoprov",!0,t)}catch(a){PutToDebugLogException(2,"common: UploadAutoprov",a)}}function SendLog(e){try{if(isNull(e))return void PutToDebugLog(1,"ERROR, common: SendLog no logs to be sent");HttpRequest("http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush","wpsendlog",!0,e)}catch(t){PutToDebugLogException(2,"common: SendLog",t)}}function GetColortheme(){try{var e=GetParameter("theme");(isNull(e)||e.length<1)&&(e=GetConfig("colortheme")),isNull(webphone_api.parameters.theme)||(e=webphone_api.parameters.theme),isNull(webphone_api.parameters.colortheme)||(e=webphone_api.parameters.colortheme),(isNull(e)||e.length<1)&&(e="0");var t=0;try{t=StrToInt(e)}catch(o){}return(isNull(t)||t<0||t>100)&&(t=0),t}catch(n){PutToDebugLogException(2,"common: GetColortheme",n)}return 0}function SetCurrTheme(){try{if(1==IsSDK())return;if(isNull(document.getElementById("colortheme"))){j$("<style />").appendTo("head").attr("id","colortheme")}var e=GetColortheme();if(0===e){j$("#colortheme").html("");return"MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||j$("#colortheme").html("#phone_app_main_container{scrollbar-face-color: #151515;scrollbar-base-color: #1d1d1d;scrollbar-3dlight-color: #1d1d1d;scrollbar-highlight-color: #1d1d1d;scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: #1d1d1d;scrollbar-dark-shadow-color: #1d1d1d;"),void PutToDebugLog(4,"EVENT, SetCurrTheme, default theme")}var t=themes.gettheme("theme_"+e);if(isNull(t))return void PutToDebugLog(2,"ERROR, common: SetCurrTheme no available theme");var o=t.bgcolorheader,n=t.bgcolor,i=t.scrollbarcolor,r=t.listbgcolor,a=t.listitembgcolor,s=t.buttoncolor,l=t.buttonhover,c=t.buttonbordercolor,u=t.tabcolor,m=t.tabselectedcolor,g=t.bgdialpadnrfield,d=t.bgdialpadbtn,p=t.bgdialpadfooter,h=t.fontctheme,f=t.fontcwhite,b=t.fontfamily;if(isNull(o.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolorheader");if(isNull(n.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid bgcolor");if(isNull(i.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid scrollbarcolor");if(isNull(r.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listbgcolor");if(isNull(a.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid listitembgcolor");if(isNull(s.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttoncolor");if(isNull(l.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonhover");if(isNull(c.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid buttonbordercolor");if(isNull(u.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabcolor");if(isNull(m.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid tabselectedcolor");if(isNull(h.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontctheme");if(isNull(f.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)))return void PutToDebugLog(2,"ERROR, SetCurrTheme invalid fontcwhite");isNull(b)&&(b="sans-serif"),PutToDebugLog(4,"EVENT, SetCurrTheme, applying color theme");j$("#js_not_enabled_settings").css("background-color",n),j$("#js_not_enabled_dialpad").css("background-color",n),j$("#js_not_enabled").css("background-color",n),j$("#choose_engine").css("background-color",n),j$("#colortheme").html("");var v="";v+=".ui-overlay-b .ui-content, .ui-content, .all_app_pages, .ui-body-b, .ui-page-theme-b .ui-body-inherit, html .ui-bar-b .ui-body-inherit, html .ui-body-b .ui-body-inherit, html body .ui-group-theme-b .ui-body-inherit, html .ui-panel-page-container-b { background-color: "+n+"; }",v+="#phone_app_main_container { background-color: "+n+" !important;}","MSIE"!==GetBrowser()&&"Edge"!==GetBrowser()||(v+="body{scrollbar-face-color: #151515;scrollbar-base-color: "+n+";scrollbar-3dlight-color: "+n+";scrollbar-highlight-color: "+n+";scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: "+n+";scrollbar-dark-shadow-color: "+n+";}"),v+="#phone_app_main_container ::-webkit-scrollbar { background: "+n+"; }#phone_app_main_container ::-webkit-scrollbar-thumb { background: "+i+"; }#phone_app_main_container ::-webkit-scrollbar-corner { background: #000; }",v+="#page_call_content #page_call_additional_info, #page_call_content #page_call_peer_details { color: "+f+"; }",v+=".ui-body-b,.ui-page-theme-b .ui-body-inherit,html .ui-bar-b .ui-body-inherit,html .ui-body-b .ui-body-inherit,html body .ui-group-theme-b .ui-body-inherit,html .ui-panel-page-container-b { background-color: "+r+"; text-shadow:0 0 0; }",v+=".mlistview .mlistitem { background-color: "+a+" !important; text-shadow:0 0 0; }",v+=".mlistview .mlistitem:hover { background-color: "+l+" !important; text-shadow:0 0 0; }",v+=".ui-page-theme-b .ui-btn,html .ui-bar-b .ui-btn,html .ui-body-b .ui-btn,html body .ui-group-theme-b .ui-btn,html head + body .ui-btn.ui-btn-b,.ui-page-theme-b .ui-btn:visited,html .ui-bar-b .ui-btn:visited,html .ui-body-b .ui-btn:visited,html body .ui-group-theme-b .ui-btn:visited,html head + body .ui-btn.ui-btn-b:visited {background-color: "+s+"; border-color: "+c+"; color: "+f+"; text-shadow:0 0 0; }",v+="#page_contactdetails_content .cd_container, #page_callhistorydetails_content .ch_container { border-bottom: .1em solid "+c+"; }",v+=".ui-page-theme-b .ui-btn:hover,html .ui-bar-b .ui-btn:hover,html .ui-body-b .ui-btn:hover,html body .ui-group-theme-b .ui-btn:hover,html head + body .ui-btn.ui-btn-b:hover,.ui-page-theme-b .ui-btn:active,html .ui-bar-b .ui-btn:active,html .ui-body-b .ui-btn:active,html body .ui-group-theme-b .ui-btn:active,html head + body .ui-btn.ui-btn-b:active {background-color: "+l+"; border-color: "+c+"; color: "+f+"; text-shadow:0 0 0; }",v+=".additional_header_left .btn_header_back SPAN { color: "+f+"; }",v+=".ui-bar-b,.ui-page-theme-b .ui-bar-inherit,html .ui-bar-b .ui-bar-inherit,html .ui-body-b .ui-bar-inherit,html body .ui-group-theme-b .ui-bar-inherit {background-color: "+o+"; border-color: "+n+"; color: "+f+";text-shadow: 0 0 0; }",v+=".navigation_bar .ui-btn {background-color: "+u+" !important; border-color: #125d79;color: "+f+"; text-shadow: 0 0 0; }",v+=".navigation_bar .ui-btn.ui-btn-active {background-color: "+m+" !important; border-color: #125d79;color: "+f+"; text-shadow: 0 0 0; }",v+="#phone_number_container { background: "+g+"; }",v+="#dialpad_btn_grid, #numpad_btn_grid { background: "+d+"; }",v+="#dialpad_call_grid { background: "+p+"; }",v+="#page_dialpad_content #phone_number_container .ui-btn:hover, #dialpad_btn_grid .ui-btn:hover, #dialpad_footer .ui-btn:hover { background: "+l+"; filter: Alpha(Opacity=5); opacity: .5; }",22===GetColortheme()?(v+="#contact_name, #ch_contact_name { background: "+u+"; }",v+="#dialpad_btn_grid .ui-btn .number, #numpad_btn_grid .ui-btn .number { font-size: 2.6em; font-family: Courier New, Courier, Helvetica, Lucida Sans Unicode, Trebuchet MS; }",v+="#dialpad_footer #dialpad_call_grid #btn_call .ui-btn:hover { background: "+l+"; }",v+=".navigation_bar .ui-btn.ui-btn-active { background-color: #ffffff !important; }",v+="#page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover { background:#e8e8e8 !important; filter: Alpha(Opacity=7) !important; opacity: .7 !important; }"):v+="#contact_name, #ch_contact_name { background: "+p+"; }",v+="#page_call_content #callfunctions_layout { background: "+p+"; }",v+=".page_title, .additional_header_middle, .additional_header_left SPAN, .additional_header_left .page_title_small, #page_dialpad_content .ch_numberonly, #page_dialpad_content .ch_data .ch_name, #page_dialpad_content .ch_ctname, #page_contactdetails_content .cd_number, #page_callhistorylist_content .ch_data .ch_name, #page_callhistorydetails_content .ch_number, UL#settings_list .sett_display_name, .ui-header H1.adialog_title, #page_addeditcontact_content .aec_label, #page_messagelist_content #btn_newmessage, #page_messagelist_content .msg_name, #page_newuser_content SPAN, .notification_list .nt_title { color: "+h+"; }",v+=h===d?"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+f+"; }":"#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: "+h+"; }",v+="#sendtosupport_container #btn_sendlog { background: "+h+"; }",v+=".all_app_pages .notification:hover, #page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover, #callfunctions_layout .callfunc_status_on, #callfunctions_layout .ui-btn:hover { background: "+h+"; }",v+=".ui-page .ui-header, .ui-page .ui-bar-b { background-color: "+o+" !important; }",v+=".separator_color_bg { background-color: "+c+" !important; }",v+="#phone_number_container .ui-input-text, #page_contactslist_content .ui-input-search, #contact_name, #page_contactdetails_content .cd_type, #page_contactdetails_content .cd_button, #ch_contact_name, #page_callhistorydetails_content .ch_type { color: "+f+"; }",j$("#colortheme").html(v)}catch(_){PutToDebugLogException(2,"common: SetCurrTheme",_)}}function NeedRegister(){try{var e=GetParameter("register");if("0"===e)return!1;if("2"===e)return!0;if("1"===e){var t=GetSipusername(),o=GetParameter("password");return t.length>0&&o.length>0}}catch(n){PutToDebugLogException(2,"common: NeedRegister",n)}return!0}function IsIPAddrress(e){try{if(isNull(e)||e.length<1)return!1;var t=e.indexOf("://");return t>=0&&(e=e.substring(t+3)),t=e.indexOf("/"),t>=0&&(e=e.substring(0,t)),e=Trim(e),e=ReplaceAll(e,".",""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,":",""),IsNumber(e)}catch(o){PutToDebugLogException(2,"common: IsIPAddrress",o)}return!1}function IsLanIP(e){try{if(isNull(e)||e.length<5)return!1;if(e=e.toString(),e=e.toLowerCase(),0===e.indexOf("192.168.")||0===e.indexOf("10.")||0===e.indexOf("172.")&&(0===e.indexOf("172.16.")||0===e.indexOf("172.17.")||0===e.indexOf("172.18.")||0===e.indexOf("172.19.")||0===e.indexOf("172.20.")||0===e.indexOf("172.21.")||0===e.indexOf("172.22.")||0===e.indexOf("172.23.")||0===e.indexOf("172.24.")||0===e.indexOf("172.25.")||0===e.indexOf("172.26.")||0===e.indexOf("172.27.")||0===e.indexOf("172.28.")||0===e.indexOf("172.29.")||0===e.indexOf("172.30.")||0===e.indexOf("172.31."))||0===e.indexOf("169.254.")||0===e.indexOf("127.")||0===e.indexOf("0.")||0===e.indexOf("4.3.2.1")||e.indexOf("intranet")>=0||e.indexOf("local")>=0)return PutToDebugLog(3,"EVENT, IsLanIP is local IP address: "+e),!0}catch(t){PutToDebugLogException(2,"common: IsLanIP",t)}return!1}function IsLocalUpperServer(){try{var e=GetWsuserUrl(GetSipusername(),GetParameter("password"));if(!isNull(e)&&e.indexOf("upperserver=")>0&&(e=e.substring(e.indexOf("upperserver=")+12),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),!isNull(e)&&e.length>0&&!0===IsIPAddrress(e)&&!0===IsLanIP(e)))return!0}catch(t){PutToDebugLogException(2,"common: IsLocalUpperServer",t)}return!1}function IsLocalServer(e){try{if((isNull(ils_srv1)||ils_srv1.length<1)&&(ils_srv1=GetParameter("serveraddress_user")),(isNull(ils_srv2)||ils_srv2.length<1)&&(ils_srv2=GetParameter("serveraddress_orig")),(isNull(ils_srv3)||ils_srv3.length<1)&&(ils_srv3=GetParameter("serveraddress")),ils_srv1.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv1,function(e){ils_srv1=e}),ils_srv2.length>0&&!IsIPAddrress(ils_srv1)&&DomainToIp(ils_srv2,function(e){ils_srv2=e}),ils_srv3.length>0&&!IsIPAddrress(ils_srv3)&&DomainToIp(ils_srv3,function(e){ils_srv3=e}),!0===e){var t="",o="",n="",i=GetParameter("serveraddress_user");!isNull(i)&&i.length>0&&(t=DomainToIp(i,function(){}),isNull(t)&&(t=""));var r=GetParameter("serveraddress_orig");!isNull(r)&&r.length>0&&(o=DomainToIp(r,function(){}),isNull(o)&&(o=""));var a=GetParameter("serveraddress");return!isNull(a)&&a.length>0&&(n=DomainToIp(a,function(){}),isNull(n)&&(n="")),!!(i.length>0&&!0===IsIPAddrress(i)&&IsLanIP(i))||(!!(r.length>0&&!0===IsIPAddrress(r)&&IsLanIP(r))||(!!(a.length>0&&!0===IsIPAddrress(a)&&IsLanIP(a))||(!(!(t.length>0)||!IsLanIP(t)&&!1!==IsIPAddrress(t))||(!(!(o.length>0)||!IsLanIP(o)&&!1!==IsIPAddrress(o))||!(!(n.length>0)||!IsLanIP(n)&&!1!==IsIPAddrress(n))))))}var s=GetWebrtcSrvAddr();if(s.length<2){if(ils_srv1.length>0&&(IsLanIP(ils_srv1)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv2.length>0&&(IsLanIP(ils_srv2)||!1===IsIPAddrress(ils_srv1)))return!0;if(ils_srv3.length>0&&(IsLanIP(ils_srv3)||!1===IsIPAddrress(ils_srv1)))return!0}else{var l=s.indexOf("://");if(l>0&&(s=s.substring(l+3)),l=s.indexOf(":"),l>0&&(s=s.substring(0,l)),l=s.indexOf("/"),l>0&&(s=s.substring(0,l)),l=s.indexOf("?"),l>0&&(s=s.substring(0,l)),!isNull(s)&&s.length>0&&!0===IsLanIP(s))return!0}}catch(c){PutToDebugLogException(2,"common: IsLanIP",c)}return!1}function GetWebdomain(){try{var e=window.location.host,t=window.location.protocol;return isNull(e)&&(e=""),isNull(t)||t.length<1?t="":t+="//",t+e}catch(o){PutToDebugLogException(2,"common: GetWebdomain",o)}return""}function GetBrandName(){try{var e="";return global.usestorage?(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),(isNull(e)||e.length<1)&&(e=IsWindowsSoftphone()?"Softphone":"WebPhone")):(e=GetParameter("brandname"),(isNull(e)||e.length<1)&&(e=GetConfig("brandname")),isNull(e)&&(e="")),e}catch(t){PutToDebugLogException(2,"common: GetWebdomain",t)}return"WebPhone"}function CanShowLicKeyInput(){try{if(!IsWindowsSoftphone())return!1;if(!isNull(canshowlickeyinput)&&(!0===canshowlickeyinput||!1===canshowlickeyinput))return canshowlickeyinput;WinAPI("API_CanShowLicKeyUserInput",function(e){canshowlickeyinput=!(isNull(e)||!0!==e&&"true"!=e),SaveParameter("canshowlickeyinput",canshowlickeyinput.toString()),PutToDebugLog(4,"EVENT, common API_CanShow: "+e)})}catch(e){PutToDebugLogException(2,"common: CanShowLicKeyInput",e)}return!1}function BrowserRequiresHttps(e){try{if(!0===PreferWss()||IsHttps())return!0;var t=GetBrowser();if(!0===e){var o="";try{o=window.location.href.toLowerCase()}catch(n){o=""}if(isNull(o)&&(o=""),o.toLowerCase().indexOf("file://")>=0)return!1;if(o.indexOf("localhost")<0&&o.indexOf("127.0.0.1")<0&&("Chrome"===t||"Safari"===t||"Firefox"===t&&GetBrowserVersion()>=68))return!0}else if("Chrome"===t||"Safari"===t||"Firefox"===t&&GetBrowserVersion()>=68)return!0}catch(i){PutToDebugLogException(2,"common: BrowserRequiresHttps",i)}return!1}function IsHttps(){try{if(!isNull(is_https))return is_https;if(!0===PreferWss())return is_https=null,!0;is_https=!1;var e=window.location.protocol;return isNull(e)&&(e=location.href,(isNull(e)||e.length<2)&&(is_https=!1,e="")),e=e.toLowerCase(),e=Trim(e),(e.indexOf("https")>=0&&e.indexOf("https")<10||e.indexOf("extension")>=0&&e.indexOf("extension")<12)&&(is_https=!0),is_https}catch(t){PutToDebugLogException(2,"common: IsHttps",t)}return!1}function PreferWss(){var e=!1;try{return!0===GetConfig("preferwss")&&(e=!0),isNull(webphone_api.parameters.preferwss)||!0!==webphone_api.parameters.preferwss&&!1!==webphone_api.parameters.preferwss||(e=webphone_api.parameters.preferwss,wsprinted||(wsprinted=!0,PutToDebugLog(3,"EVENT, PreferWss() set manually in webphone_api."))),e}catch(t){PutToDebugLogException(2,"common: PreferWss",t)}return!1}function MediaStreamPermissionDenied(){var e=GetBrandName();try{e+=" "+stringres.get("allowmedia_general"),1==IsSDK()?AlertDialogSDK(stringres.get("allowmedia_title"),e):AlertDialog(stringres.get("allowmedia_title"),e)}catch(t){PutToDebugLogException(2,"common: MediaStreamPermissionDenied",t)}}function GetTransferDirectoryName(e){try{var t=GetSipusername(),o=GetParameter("password"),n=GetParameter("serveraddress_user");isNull(t)&&(t=""),isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(e)&&(e="");return Md5Hash(t+o+n+e+"539249178376")}catch(i){PutToDebugLogException(2,"common: GetTransferDirectoryName",i)}return""}function FileTransfer(e){try{isNull(e)&&(e=""),e=Trim(e),global.intentfiletransfer[0]="destination="+e,j$.mobile.changePage("#page_filetransfer",{transition:"slide",role:"page"})}catch(t){PutToDebugLogException(2,"common: FileTransfer",t)}}function GetLastUsedEngine(){var e="";try{var t=GetParameter("enginechecksum"),o=GetNewConfig(),n=Md5Hash(o);return t!==n?(PutToDebugLog(2,"Reset lastusedengine because config changed: "+o),PutToDebugLog(2,"old checksum: "+t+"; new checksum: "+n),SaveParameter("enginechecksum",n),SaveParameter("lastusedengine",""),""):(e=GetParameter("lastusedengine"),(isNull(e)||e.length<1)&&(e=global.last_used_engine_cache),isNull(e)&&(e=""),e)}catch(i){PutToDebugLogException(2,"common: GetLastUsedEngine",i)}return""}function IsConfigChanged(){try{if(GetParameter("enginechecksum")!==Md5Hash(GetNewConfig()))return!0}catch(e){PutToDebugLogException(2,"common: IsConfigChanged",e)}return!1}function GetNewConfig(){try{var e=location.href;isNull(e)&&(e=""),e=decodeURIComponent(e),e=e.toLowerCase();var t=e.indexOf("?");t>=0&&(e=e.substring(t+1)),t=e.indexOf("#"),t>=0&&(e=e.substring(0,t)),e=Trim(e);var o=GetParameter("serveraddress_user");(isNull(o)||o.length<2)&&(o=GetParameter("serveraddress")),isNull(o)&&(o=""),o=o.toLowerCase();var n=GetWebrtcSrvAddr();isNull(n)&&(n=""),n=n.toLowerCase();var i=GetProxyaddress(),r=GetParameter("transport"),a=GetParameterInt("enginepriority_java",2),s=GetParameterInt("enginepriority_webrtc",2),l=GetParameterInt("enginepriority_ns",2),c=GetParameterInt("enginepriority_flash",2),u=GetParameterInt("enginepriority_app",2),m=GetParameterInt("enginepriority_p2p",2),g=GetParameterInt("enginepriority_accessnum",2),d=GetParameterInt("enginepriority_nativedial",2),p=GetParameter("realm");isNull(p)&&(p="");var h=GetParameter("webphonebasedir");isNull(h)&&(h="");return e+":"+o+":"+n+":"+a+":"+s+":"+l+":"+c+":"+u+":"+m+":"+g+":"+d+":"+p+":"+h+":"+i+":"+r}catch(f){PutToDebugLogException(2,"common: GetNewConfig",f)}return""}function SaveLastUsedEngine(){try{var e="";getuseengine()===global.ENGINE_WEBPHONE?e="java":getuseengine()===global.ENGINE_WEBRTC?e="webrtc":getuseengine()===global.ENGINE_SERVICE?e="ns":getuseengine()===global.ENGINE_FLASH&&(e="flash"),"Windows"===GetOs()&&"flash"===e||(SaveParameter("lastusedengine",e),!isNull(e)&&e.length>0&&(global.last_used_engine_cache=e),PutToDebugLog(2,"EVENT, lastusedengine saved: "+e))}catch(t){PutToDebugLogException(2,"common: SaveLastUsedEngine",t)}}function IsLocalFileSystem(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;if(e=e.toLowerCase(),e=Trim(e),e.indexOf("file:")>=0)return!0}catch(t){PutToDebugLogException(2,"common: IsLocalFileSystem",t)}return!1}function IsLocalFileSys(){try{var e=location.protocol;if(isNull(e)&&(e=location.href,e=decodeURIComponent(e),isNull(e)||e.length<2))return!1;msg=[],msg.push("f"),msg.push("i"),msg.push("l"),msg.push("e"),msg.push(":");var t=msg.join("");if(e=e.toLowerCase(),e=Trim(e),e.indexOf(t)>=0)return!0}catch(o){PutToDebugLogException(2,"common: ilfs",o)}return!1}function CallScriptingUrl(e,t,o,n,i,r,a,s,l,c){try{if(isNull(e)||Trim(e).length<4)return;isNull(t)&&(t=""),isNull(o)&&(o=""),isNull(n)&&(n=""),isNull(r)&&(r=""),isNull(s)&&(s=""),isNull(l)&&(l=""),isNull(i)&&(i="");var u=GetSipusername(),m=GetParameter("password"),g=GetParameter("serveraddress"),d=RandomInt(1e4,9999999).toString(),p=Md5Hash(u+":"+m),h=Md5Hash(u+":"+m+":"+d);(isNull(a)||a.length<1)&&(a="scripting_cb"),e.indexOf("USERNAME")>0?e=e.replace("USERNAME",u):(e.indexOf("?")<0?e+="?":e+="&",e=e+"username="+u),e=e.replace("PASSWORD",m),e=e.replace("CALLEDNUMBER",n),e.indexOf("PEERNUM")>0?e=e.replace("PEERNUM",n):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peernumber="+n),e.indexOf("PEERDETAILS")>0?e=e.replace("PEERDETAILS",i):(e.indexOf("?")<0?e+="?":e+="&",e=e+"peerdetails="+i),e.indexOf("SERVERADDRESS")>0?e=e.replace("SERVERADDRESS",g):(e.indexOf("?")<0?e+="?":e+="&",e=e+"server="+g),e=e.replace("DIRECTION",o),e=e.replace("STATUS",t),e=e.replace("TEXT",r),e=e.replace("CURRENCY",""),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("CONNECTTIME",s),e=e.replace("DURATION",l),e=e.replace("MD5SIMPLE",p),e=e.replace("MD5NORMAL",h),e=e.replace("MD5SALT",d),!isNull(c)&&c.length>0&&(e=e+"&cdr="+encodeURIComponent(c)),PutToDebugLogSpecial(3,"EVENT,CallScriptingUrl: "+e,!1,""),UriParser(e,"","","","",a)}catch(f){PutToDebugLogException(2,"common: CallScriptingUrl",f)}}function ShowOfferSaveContact(){try{if(global.lastcallduration<1)return;if(!0===IsCExt())return;if(global.lastcallduration=0,j$(".ui-page-active .ui-popup-active").length>0)return;!1===global.contactExists&&!isNull(global.contactExistsNr)&&global.contactExistsNr.length>0&&"1"===GetParameter("savetocontacts")&&(OfferSaveContact(global.contactExistsNr,global.callName),global.contactExists=!0,global.contactExistsNr="")}catch(e){PutToDebugLogException(2,"common: ShowOfferSaveContact",e)}}function OfferSaveContact(e,t,o){try{var n=GetDeviceWidth();if(n=!isNull(n)&&IsNumber(n)&&n>100?Math.floor(n/1.2):220,!isNull(global.lastconfroom)&&global.lastconfroom.length>2){var i=" "+e;if(global.lastconfroom.indexOf(i)>0)return}t=isNull(t)||t===e?"":"<br />"+t;var r="";r='<li id="#offer_item_save"><a data-rel="back" style="text-align: center;">'+stringres.get("btn_save_to_contacts_1")+"</a></li>"+('<li id="#offer_item_cancel"><a data-rel="back" style="text-align: center;">'+stringres.get("btn_cancel")+"</a></li>")+('<li id="#offer_item_dontask"><a data-rel="back">'+stringres.get("btn_save_to_contacts_dontask")+"</a></li>");var a='<div id="savetocontacts" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("save_to_contacts_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><div style="text-align: center; margin-top: .5em; margin-bottom: .5em;">'+stringres.get("save_to_contacts_msg")+"<br />"+e+t+'</div><ul id="savetocontacts_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+r+"</ul></div></div>";savectpopup_wasclosed=!1,o=o||function(){},j$.mobile.activePage.append(a).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){savectpopup_wasclosed=!0,j$(this).unbind("popupafterclose").remove(),j$("#savetocontacts_ul").off("click","li"),o()}}),j$("#savetocontacts_ul").on("click","li",function(o){var n=j$(this).attr("id");j$("#savetocontacts").on("popupafterclose",function(o){savectpopup_wasclosed=!0,"#offer_item_save"===n&&(global.intentaddeditct[0]="action=add",global.intentaddeditct[1]="numbertoadd="+e,global.intentaddeditct[2]="nametoadd="+t,j$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})),"#offer_item_cancel"===n||"#offer_item_dontask"===n&&SaveParameter("savetocontacts","0")})}),setTimeout(function(){!1===savectpopup_wasclosed&&j$.mobile.activePage.find(".messagePopup").popup("close"),savectpopup_wasclosed=!0,global.contactExists=!0,global.contactExistsNr=""},15e3)}catch(s){PutToDebugLogException(2,"common: OfferSaveContact",s)}}function ContactIsFavorite(e){try{if(isNull(global.ctlist)||global.ctlist.length<1||isNull(e)||e.length<1||!IsNumber(e))return!1;var t=global.ctlist[e];if(isNull(t))return!1;var o=t[CT_FAV];if(!isNull(o)&&"1"===o)return!0}catch(n){PutToDebugLogException(2,"common: ContactIsFavorite",n)}return!1}function ContactSetFavorite(e,t){try{if(isNull(global.ctlist)||global.ctlist.length<1||isNull(e)||e.length<1)return;var o="0";isNull(t)||!0!==t||(o="1");var n=global.ctlist[e];if(isNull(n))return;n[CT_FAV]=o,global.ctlist[e]=n,global.wasCtModified=!0}catch(i){PutToDebugLogException(2,"common: ContactSetFavorite",i)}}function AudioDevicePopupSDK(e,t,o,n){try{if(!isNull(audiomodal))return void audiomodal.show();var i=GetParameter("volumein"),r=GetParameter("volumeout");!isNull(i)&&IsNumber(i)||(i="50"),!isNull(r)&&IsNumber(r)||(r="50");var a="";getuseengine()!==global.ENGINE_WEBRTC&&(a='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_ring_label" style="display: inline-block; margin-top: 1.3em;">'+stringres.get("audio_ring")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0; width: 100%;">'+o+"</select></div>");var s="";!isNull(n)&&n.length>0&&(s='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="video_rec_label" style="display: inline-block; margin-top: 1.3em;">'+stringres.get("video_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0; width: 100%;">'+n+"</select></div>");var l="";!isNull(t)&&t.length>0&&(l='<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_rec_label" style="display: inline-block; margin-top: 2.3em;">'+stringres.get("audio_rec")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_play" id="audioselect_play" style="margin: 0; width: 100%;">'+t+'</select><span id="audio_volumeout_value" style="background: #ccc; padding: .5em;">'+r+'</span><input name="audio_volumeout" id="audio_volumeout" min="0" max="100" value="'+r+'" type="range" style="margin-top: 1em; width: 80%;"></div>');var c='<span id="audio_volumein_value" style="background: #ccc; padding: .5em;">'+i+'</span><input name="audio_volumein" id="audio_volumein" min="0" max="100" value="'+i+'" type="range" style="margin-top: 1em; width: 80%;">';getuseengine()===global.ENGINE_WEBRTC&&(c=""),audiomodal=picoModal({content:'<div id="audiodevice_modal" class="pmodal_container"><div id="audiodevice_modal_header" class="pmodal_header">'+stringres.get("audio_title")+'</div><div id="audiodevice_modal_content" class="pmodal_content" style="padding: 1em;"><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_mic_label" style="display: inline-block; margin-top: 2.3em;">'+stringres.get("audio_mic")+':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0; width: 100%;">'+e+"</select>"+c+"</div>"+l+a+s+'</div><div id="audiodevice_modal_footer" class="pmodal_footer" style="float: left; width: 100%; margin-top: 1em;"><button id="btn_audiodevice_positive">'+stringres.get("btn_ok")+'</button><button id="btn_audiodevice_negative">'+stringres.get("btn_cancel")+"</button></div></div>",overlayStyles:{backgroundColor:"#565656",opacity:.6},modalStyles:{width:"20em"},overlayClose:!1,closeStyles:{background:"#eeeeee",position:"absolute",top:".2em",right:".3em",textAlign:"center",fontSize:"1.2em",fontWeight:"bold",border:".15em solid #bbb",borderRadius:".8em",paddingLeft:".25em",paddingRight:".25em",cursor:"pointer"}}).afterCreate(function(e){}).beforeShow(function(e,t){}).afterShow(function(e){}).beforeClose(function(e,t){}).afterClose(function(e){e.destroy(),audiomodal=null,webrtcapi_public.HideVideoPriview()}),audiomodal.show(),j$("#audio_volumein").on("change",function(){j$("#audio_volumein_value").html(j$(this).val())}),j$("#audio_volumeout").on("change",function(){j$("#audio_volumeout_value").html(j$(this).val())}),j$("#videoselect_rec").on("change",function(){var e=j$("#videoselect_rec").val();webrtcapi_public.MyCameraPreview(e)}),j$("#btn_audiodevice_positive").on("click",function(){try{PutToDebugLog(5,"EVENT, common AudioDevicePopupSDK OK click");var e=j$("#audioselect_rec").val(),t=j$("#audioselect_play").val(),o=j$("#audioselect_ring").val(),n="";isNull(document.getElementById("videoselect_rec"))||(n=j$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 0"),webphone_api.setdevice(0,e,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 1"),webphone_api.setdevice(1,t,2)),!isNull(o)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 2"),webphone_api.setdevice(2,o,2)),!isNull(n)&&n.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==n&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopupSDK 3"),webphone_api.setdevice(3,n,2)),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 0"),webphone_api.getdevice(0,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 1"),webphone_api.getdevice(1,function(e){}),PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopupSDK 3"),webphone_api.getdevice(3,function(e){})},300);var i=j$("#audio_volumein").val(),r=j$("#audio_volumeout").val();!isNull(i)&&i.length>0&&IsNumber(i)&&(SaveParameter("volumein",i),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 0"),webphone_api.setvolume(0,i)),!isNull(r)&&r.length>0&&IsNumber(r)&&(SaveParameter("volumeout",r),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopupSDK 1"),webphone_api.setvolume(1,r)),audiomodal.close()}catch(a){PutToDebugLogException(2,"common: AudioDevicePopupSDK OK click",a)}}),j$("#btn_audiodevice_negative").on("click",function(){audiomodal.close()})}catch(u){PutToDebugLogException(2,"common: AudioDevicePopupSDK",u)}}function AudioDevicePopup(e){try{var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220,arecL=GetAudioRecList().split("\r\n"),aplayL=GetAudioPlayList().split("\r\n"),aringL=GetAudioRingList().split("\r\n"),
getuseengine()===global.ENGINE_WEBRTC&&!isNull(GetVideoRecList())&&GetVideoRecList().length>0&&(vrecL=GetVideoRecList().split("\r\n"));var o='<option value="[VALUE]">[TEXT]</option>',n="",i="",r="",a="";if(!isNull(arecL))for(var s=0;s<arecL.length;s++)if(!(isNull(arecL[s])||arecL[s].length<1)){var l=!1,c=GetAudioRecDev();!isNull(c)&&c.length>0&&(c.indexOf(arecL[s])>=0||arecL[s].indexOf(c)>=0)&&(l=!0,n=o+n),!1===l&&(n+=o),n=n.replace("[VALUE]",arecL[s]),n=n.replace("[TEXT]",arecL[s])}if(!isNull(aplayL))for(var s=0;s<aplayL.length;s++)if(!(isNull(aplayL[s])||aplayL[s].length<1)){var l=!1,u=GetAudioPlayDev();!isNull(u)&&u.length>0&&(u.indexOf(aplayL[s])>=0||aplayL[s].indexOf(u)>=0)&&(l=!0,i=o+i),!1===l&&(i+=o),i=i.replace("[VALUE]",aplayL[s]),i=i.replace("[TEXT]",aplayL[s])}if(!isNull(aringL))for(var s=0;s<aringL.length;s++)if(!(isNull(aringL[s])||aringL[s].length<1)){var l=!1,m=GetAudioRingDev();!isNull(m)&&m.length>0&&(m.indexOf(aringL[s])>=0||aringL[s].indexOf(m)>=0)&&(l=!0,r=o+r),!1===l&&(r+=o),r=r.replace("[VALUE]",aringL[s]),r=r.replace("[TEXT]",aringL[s])}if(!isNull(vrecL))for(var s=0;s<vrecL.length;s++)if(!(isNull(vrecL[s])||vrecL[s].length<1)){var l=!1;!isNull(global.video_rec_curr_device)&&global.video_rec_curr_device.length>0&&(global.video_rec_curr_device.indexOf(vrecL[s])>=0||vrecL[s].indexOf(global.video_rec_curr_device)>=0)&&(l=!0,a=o+a),!1===l&&(a+=o),a=a.replace("[VALUE]",vrecL[s]),a=a.replace("[TEXT]",vrecL[s])}if(!0===IsSDK())return void AudioDevicePopupSDK(n,i,r,a);var g=GetParameter("volumein"),d=GetParameter("volumeout");!isNull(g)&&IsNumber(g)||(g="50"),!isNull(d)&&IsNumber(d)||(d="50");var p="";getuseengine()!==global.ENGINE_WEBRTC&&(p='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_ring_label">'+stringres.get("audio_ring")+':</label></div><div class="audio_right_container"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0;">'+r+"</select></div>");var h="";!isNull(a)&&a.length>0&&(h='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="video_rec_label">'+stringres.get("video_rec")+':</label></div><div class="audio_right_container"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0;">'+a+"</select></div>");var f="";!isNull(i)&&i.length>0&&(f='<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_rec_label">'+stringres.get("audio_rec")+':</label></div><div class="audio_right_container"><select name="audioselect_play" id="audioselect_play" style="margin: 0;">'+i+'</select><input name="audio_volumeout" id="audio_volumeout" data-highlight="true" data-mini="true" min="0" max="100" value="'+d+'" type="range"></div>');var b='<input name="audio_volumein" id="audio_volumein" data-highlight="true" data-mini="true" min="0" max="100" value="'+g+'" type="range">';getuseengine()===global.ENGINE_WEBRTC&&(b="");var v='<div id="audiodevice_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="width:'+t+"px; max-width:"+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("audio_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0; width: 100%;"><div class="audio_left_container"><label id="audio_mic_label">'+stringres.get("audio_mic")+':</label></div><div class="audio_right_container"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0;">'+n+"</select>"+b+"</div>"+f+p+h+'</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";savectpopup_wasclosed=!1,e=e||function(){},j$.mobile.activePage.append(v).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#videoselect_rec").off("change"),webrtcapi_public.HideVideoPriview(),e()}}),j$("#videoselect_rec").on("change",function(){var e=j$("#videoselect_rec").val();webrtcapi_public.MyCameraPreview(e)}),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, common AudioDevicePopup close on click");var t=(j$(this).attr("id"),j$("#audioselect_rec").val()),o=j$("#audioselect_play").val(),n=j$("#audioselect_ring").val(),i="";isNull(document.getElementById("videoselect_rec"))||(i=j$("#videoselect_rec").val()),!isNull(arecL)&&arecL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 0"),webphone_api.setdevice(0,t,2)),!isNull(aplayL)&&aplayL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 1"),webphone_api.setdevice(1,o,2)),!isNull(n)&&!isNull(aringL)&&aringL.length>0&&(PutToDebugLog(2,"EVENT, mlogic API_SetDevice AudioDevicePopup 2"),webphone_api.setdevice(2,n,2)),!isNull(i)&&i.length>0&&!isNull(vrecL)&&vrecL.length>0&&vrecL[0]!==i&&webphone_api.setdevice(3,i,2),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 0"),webphone_api.getdevice(0,function(e){})},200),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 1"),webphone_api.getdevice(1,function(e){})},300),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 2"),webphone_api.getdevice(2,function(e){})},400),setTimeout(function(){PutToDebugLog(2,"EVENT, mlogic API_GetDevice AudioDevicePopup 3"),webphone_api.getdevice(3,function(e){})},500);var r=j$("#audio_volumein").val(),a=j$("#audio_volumeout").val();!isNull(r)&&r.length>0&&IsNumber(r)&&(SaveParameter("volumein",r),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 0"),webphone_api.setvolume(0,r)),!isNull(a)&&a.length>0&&IsNumber(a)&&(SaveParameter("volumeout",a),PutToDebugLog(2,"EVENT, mlogic API_SetVolume AudioDevicePopup 1"),webphone_api.setvolume(1,a))})}catch(_){PutToDebugLogException(2,"common: AudioDevicePopup",_)}}function IsContactBlocked(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return!1;var o=GetParameter2("blocked_contacts");if(isNull(o)||o.length<1)return!1;o=Trim(o);var n=o.split(",");if(isNull(n)||n.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<1)&&n[i]===e)return!0;if(!isNull(t)&&t.length>0)for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<1))for(var r=0;r<t.length;r++)if(!(isNull(t[r])||[r].length<1)&&n[i]===t[r])return!0}catch(a){PutToDebugLogException(2,"common: IsContactBlocked",a)}return!1}function IsNumberBlacklisted(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return!1;var o=GetParameter2("blacklist");if(isNull(o)||o.length<1)return!1;o=Trim(o);var n=o.split(",");if(isNull(n)||n.length<1)return!1;if(!isNull(e)&&Trim(e).length>0)for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<1)&&n[i]===e)return!0;if(!isNull(t)&&t.length>0)for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<1))for(var r=0;r<t.length;r++)if(!(isNull(t[r])||[r].length<1)&&n[i]===t[r])return!0}catch(a){PutToDebugLogException(2,"common: IsNumberBlacklisted",a)}return!1}function BlockContact(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return;var o=GetParameter2("blocked_contacts");if(isNull(o)&&(o=""),o=Trim(o),isNull(e)&&Trim(e).length>0||(o.length>0&&(o+=","),o+=Trim(e)),!(isNull(t)&&t.length>0))for(var n=0;n<t.length;n++)isNull(t[n])||Trim(t[n]).length<1||(o.length>0&&(o+=","),o+=Trim(t[n]));SaveParameter("blocked_contacts",o)}catch(i){PutToDebugLogException(2,"common: BlockContact",i)}}function UnBlockContact(e,t){try{if((isNull(e)||e.length<1)&&(isNull(t)||t.length<1))return;var o=GetParameter2("blocked_contacts");if(isNull(o)||o.length<1)return;o=Trim(o);var n=o.split(",");if(isNull(n)||n.length<1)return;if(!isNull(e)&&Trim(e).length>0){e=Trim(e);for(var i=0;i<n.length;i++)isNull(n[i])||n[i].length<1||n[i]===e&&(n[i]="")}if(!isNull(t)&&t.length>0)for(var i=0;i<n.length;i++)if(!(isNull(n[i])||n[i].length<1))for(var r=0;r<t.length;r++)isNull(t[r])||[r].length<1||n[i]===t[r]&&(n[i]="");o="";for(var i=0;i<n.length;i++)isNull(n[i])||n[i].length<1||(o.length>0&&(o+=","),o+=n[i]);SaveParameter("blocked_contacts",o)}catch(a){PutToDebugLogException(2,"common: UnBlockContact",a)}}function GetTlsProxyUrl(e){try{if(isNull(e)||e.length<1)return"";var t=RandomInt(1e5,999999999);return"https://rtc.mizu-voip.com:4443/?hsforward="+StrEc(e,"s7n1k8fnz7ejian4k",!1)+"&nocache="+t.toString()}catch(o){PutToDebugLogException(2,"common: GetTlsProxyUrl",o)}return""}function SetLogFormAction(){try{if(!0===IsSDK())return;var e=document.getElementById("xlogpush");if(isNull(e))return void PutToDebugLog(2,"ERROR, log form not found in HTML");var t=GetParameter("logform_action");(isNull(t)||t.length<3)&&(t="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush"),t=t.toLowerCase(),t=Trim(t),0!==t.indexOf("http")&&(t="http://"+t);var o="";o=!0===IsHttps()?GetTlsProxyUrl(t):t,e.action=o,PutToDebugLog(2,"EVENT, SetLogFormAction: "+o.replace("mnt.mizu-voip","xxx"))}catch(n){PutToDebugLogException(2,"common: SetLogFormAction",n)}}function SentWebrtcSignaling(e){isNull(e)||e.length<1||0!==e.indexOf("INVITE sip")&&(e.indexOf("REGISTER sip:")>=0||e.indexOf("REGISTER sips:")>=0)&&(global.webrtclastregsent=GetTickCount(),isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null,GetTickCount()-global.webrtcregtimer_exec>8e3&&(wrereg_timer=setTimeout(function(){global.webrtcregtimer_exec=GetTickCount(),PutToDebugLog(2,"WARNING, Webrtc resend REGISTER because no answer received for previous register"),webrtcapi_public.ResendRegister()},6e3)))}function GetRecentInviteIn(){return lastinvite_in}function GetWebrtcDisplayName(){return!isNull(global.sipunicoderewritefrom)&&global.sipunicoderewritefrom.length>0&&!isNull(global.sipunicoderewriteto)&&global.sipunicoderewriteto.length>0&&global.sipunicoderewriteto===displayname?global.sipunicoderewritefrom:displayname}function CatchWebrtcSignaling(e,t){try{if(isNull(e)||e.length<1||isNull(t))return;getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!0),webphone_api.iswebrtcengineworking=1,e=e.toString(),global.failover_gateway=!1;try{var o="",n=Trim(e),i=n.indexOf("\r\n");i>0&&(o=n.substring(0,i)),isNull(o)&&(o=""),o=o.toLowerCase()}catch(T){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 1",T)}if(GetParameterInt("forcereregister",1)>0){var r=GetSipHeaderFromMsg(e,"CSeq");if(!isNull(r)&&r.indexOf("REGISTER")>0){var a=e.indexOf("\r\n");if(a>0){var s=e.substring(0,i);if(!isNull(s)&&(s=Trim(s),(a=s.indexOf(" "))>0&&(s=Trim(s.substring(a)),!isNull(s)&&(a=s.indexOf(" "),a>0&&(s=s.substring(0,a)),!isNull(s)&&IsNumber(s))))){var l=StrToInt(s);l>=200?(isNull(wrereg_timer)||clearTimeout(wrereg_timer),wrereg_timer=null):200===l&&1===GetParameterInt("forcereregister",1)&&webrtcapi_public.StartReRegister(!0)}}}}if(!isNull(o)&&o.indexOf(!1))try{var c=GetSipHeaderFromMsg(e,"X-Sms");if(!isNull(c)&&c.length>0&&c.toLowerCase().indexOf("yes")>=0&&e.indexOf("\r\n\r\n")>0){var u=e.substring(e.indexOf("\r\n\r\n")+4);if(isNull(u)&&(u=""),u=Trim(u),u.length>0){var m=GetSipHeaderFromMsg(e,"From");if(!isNull(m)&&m.length>0&&m.indexOf("<")>=0&&(m=m.substring(m.indexOf("<")+1),m.indexOf("@")>0)){m=m.substring(0,m.indexOf("@")),m=m.replace("sips:",""),m=m.replace("sip:","");try{webphone_api.onSmsCb(m,u)}catch(T){common.PutToDebugLogException(2,"There is an error in onSms() callback",T)}}}}}catch(T){PutToDebugLogException(2,"common: CatchWebrtcSignaling handle SMS",T)}if(!isNull(o)&&o.indexOf("invite")>=0){var g="";if(e.indexOf("recv=")>=0){var d=e.toLowerCase();(d.indexOf("p-auto-answer:normal")>0||d.indexOf("p-auto-answer: normal")>0||d.indexOf("answer-mode: auto")>0||d.indexOf("answer-mode:auto")>0||global.autoacceptsipheader.length>0&&d.indexOf(global.autoacceptsipheader)>0)&&setTimeout(function(){common.PutToDebugLog(3,"EVENT, autoaccept INVITE sip header: WebRTC accept"),wpa.webrtcapi.SipAccept(global.aline,!1)},800);var m=GetSipHeaderFromMsg(e,"From");!isNull(m)&&m.length>0&&m.indexOf("<")>=0&&(m=m.substring(m.indexOf("<")+1),m.indexOf("@")>0&&(m=m.substring(0,m.indexOf("@")),m=m.replace("sips:",""),m=m.replace("sip:",""),g=Trim(m)))}else{var m=GetSipHeaderFromMsg(e,"To");!isNull(m)&&m.length>0&&m.indexOf("<")>=0&&(m=m.substring(m.indexOf("<")+1),m.indexOf("@")>0&&(m=m.substring(0,m.indexOf("@")),m=m.replace("sips:",""),m=m.replace("sip:",""),g=Trim(m)))}if(!isNull(g)&&g.length>0)for(var p=0;p<global.ep.length;p++){var h=global.ep[p][EP_DESTNR];if(!isNull(h)&&h.length>0&&h.toLowerCase()===g.toLowerCase()){global.ep[p][EP_SIPINVITE]=e,global.ep[p][EP_CALLID]=GetSipHeaderFromMsg(e,"Call-ID");break}}}if(!0===global.redialof&&!isNull(e)&&e.length>0)try{var f=GetSipHeaderFromMsg(e,"CSeq");isNull(f)&&(f=""),f=f.toLowerCase(),f.indexOf("invite")>=0&&(o.indexOf("100 trying")>0||o.indexOf("603 decline")>0||o.indexOf("486 busy here")>0)&&(global.redialof=!1)}catch(T){PutToDebugLogException(2,"common: CatchWebrtcSignaling inner 2",T)}o.indexOf("503 ")>0&&(PutToDebugLog(2,"WARNING,Restating webrtc sipstack because 503 received: "+o),webphone_api.flagrestartwebrtc=!0,webrtcapi_public.ReStart(5e3,!1));var b=!1;switch(t){case SIP_REGISTER:e.length>10&&(lastreg=e,lastmsg=e);break;case SIP_INVITE_IN:e.length>10&&(lastinvite_in=e,lastmsg=e);break;case SIP_INVITE_OUT:e.length>10&&(lastinvite_out=e,lastmsg=e);break;case SIP_UNKNOWN:b=!0;break;default:b=!0}if(lastmsg=e,!0===b){var v=e.toLowerCase();if(v.indexOf("invite sip")>=0&&v.indexOf("invite sip")<10&&(lastinvite_in=e,e.indexOf("recv=")>=0)){var m=GetSipHeaderFromMsg(e,"From");!isNull(m)&&m.length>0&&m.indexOf("<")>0&&(m=m.substring(0,m.indexOf("<")),isNull(m)&&(m=""),m=ReplaceAll(m,'"',""),displayname=Trim(m))}}var _=GetSipHeaderFromMsg(e,"X-IMStatus");if(!isNull(_)&&_.length>0){var m=GetSipHeaderFromMsg(e,"From");isNull(m)&&(m="");var E=m.indexOf("<sip:");E>=0&&(m=m.substring(E+5),E=m.indexOf("@"),E>=0&&(m=m.substring(0,E)),m=Trim(m)),m!==GetSipusername()&&m!==GetCallerid()&&SaveReceivedPresence2(m,_)}GetWebrtcCreditRating(e),GetWebrtcOptions(e),UpdateShCache(lastmsg)}catch(T){PutToDebugLogException(2,"common: CatchWebrtcSignaling",T)}}function GetSipHeaderFromMsg(e,t){try{if(isNull(e)||e.length<10||isNull(t)||t.length<1)return"";var o="";t=Trim(t),t=t.toLowerCase(),0===t.indexOf("x-r-")&&(t=t.replace("x-r-",""));var n="\r\n";e.indexOf("\r\n")<0&&e.indexOf("\n")>=0&&(n="\n");var i=e.split(n);if(isNull(i))return"";for(var r=0,a=0;a<i.length;a++)if(!(isNull(i[a])||i[a].indexOf(":")<1)){r=i[a].indexOf(":");var s=Trim(i[a].substring(0,r));if(s=s.toLowerCase(),0===s.indexOf("x-r-")&&(s=s.replace("x-r-","")),s===t){o=Trim(i[a].substring(r+1,i[a].length));break}}return isNull(o)&&(o=""),o}catch(l){PutToDebugLogException(2,"common: GetSipHeaderFromMsg",l)}return""}function RewriteSipHeaderInMsg(e,t,o){try{if(isNull(e)||e.length<10||isNull(t)||t.length<1||isNull(o))return e;var n=e;t.indexOf(":")<0&&(t+=":");var i=n.indexOf(t);if(i<0)return e;var r=n.substring(0,i);n=n.substring(i);var a="\r\n";n.indexOf("\r\n")<0&&n.indexOf("\n")>=0&&(a="\n"),n=n.substring(n.indexOf(a)+a.length);return r+t+" "+o+a+n}catch(s){PutToDebugLogException(2,"common: RewriteSipHeaderInMsg",s)}return e}function UpdateShCache(e){try{if(isNull(e)||e.length<10)return;isNull(shcache)&&(shcache={});for(var t in shcache)if(!(isNull(t)||t.length<1)){var o=GetSipHeaderFromMsg(e,t);!isNull(o)&&o.length>0&&(shcache[t]=o)}}catch(n){PutToDebugLogException(2,"common: UpdateShCache",n)}}function RemoveSipHeadreFromCache(e){try{if(isNull(e)||e.length<1)return!1;e=Trim(e),e=e.toLowerCase(),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),shcache[e]=""}catch(t){PutToDebugLogException(2,"common: RemoveSipHeadreFromCache",t)}}function GetSipHeader(e){try{if(isNull(e)||e.length<1)return PutToDebugLog(2,"ERROR, GetSipHeader header is NULL"),"ERROR, GetSipHeader header is NULL";if(e=e.toLowerCase(),e=Trim(e),0===e.indexOf("x-r-")&&(e=e.replace("x-r-","")),isNull(shcache)&&(shcache={}),e in shcache)return t=shcache[e],isNull(t)&&(PutToDebugLog(3,"WARNING, GetSipHeader header not found"),t="WARNING: header not found"),t;var t=GetSipHeaderFromMsg(lastmsg,e);return isNull(t)&&(t=""),shcache[e]=t,t.length<1?(PutToDebugLog(3,"WARNING, GetSipHeader no headers available at this moment"),"WARNING: header not found"):t}catch(o){PutToDebugLogException(2,"common: GetSipHeader",o)}return"ERROR, common: GetSipHeader failed"}function GetSipMessage(e,t,o){try{return lastmsg}catch(n){PutToDebugLogException(2,"common: GetSipMessage",n)}return"ERROR, common: GetSipMessage failed"}function GetWebrtcCreditRating(e){try{if(!1===Glbr())return;if(isNull(e))return;e=e.toString();var t=e.indexOf("Credit:");if(t>0){var o=e.substring(t+7);t=o.indexOf("\r\n"),t>0&&(o=o.substring(0,t)),t=o.indexOf("\n"),t>0&&(o=o.substring(0,t)),!isNull(o)&&o.length>0&&PutToDebugLog(1,"CREDIT,Credit: "+Trim(o))}var t=e.indexOf("Rating:");if(t>0){var n=e.substring(t+7);t=e.indexOf("\r\n"),t>0&&(n=n.substring(0,t)),t=e.indexOf("\n"),t>0&&(n=n.substring(0,t)),!isNull(n)&&n.length>0&&(global.rating=" ("+Trim(n)+")",PutToDebugLog(4,"GetWebrtcCreditRating received rating: "+Trim(n)))}}catch(i){PutToDebugLogException(2,"common: GetWebrtcCreditRating",i)}}function GetWebrtcOptions(e){try{if(isNull(e))return;e=e.toString();var t=e.indexOf("X-RTCOptions:");if(t>0){var o=e.substring(t+13);t=o.indexOf("\r\n"),t>0&&(o=o.substring(0,t)),t=o.indexOf("\n"),t>0&&(o=o.substring(0,t)),!isNull(o)&&o.length>0&&(PutToDebugLog(3,"EVENT,GetWebrtcOptions received: "+o),o.indexOf("nostun")>=0&&(global.nostun=!0),o.indexOf("noturn")>=0&&(global.noturn=!0))}}catch(n){PutToDebugLogException(2,"common: GetWebrtcOptions",n)}}function GetUsemizutlsproxy(){try{var e=GetParameter("usemizutlsproxy"),t=GetConfig("usemizutlsproxy"),o=webphone_api.parameters.usemizutlsproxy;return!isNull(t)&&t.length>0&&IsNumber(t)&&(e=t),!isNull(o)&&o.length>0&&IsNumber(o)&&(e=o),(isNull(e)||1!==e.length)&&(e="1"),e}catch(n){PutToDebugLogException(2,"common: GetUsemizutlsproxy",n)}return"1"}function UseTLSReload(){try{if(!0===IsHttps())return!1;var e=window.location.href;if(!0===IsLanIP(GetDomainFromURL(e))||"localhost"===GetDomainFromURL(e)||e.toLowerCase().indexOf("file:")>=0)return PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because local webserver"),!1;var t=!1,o=GetParameter2("webrtcserveraddress");if((isNull(o)||o.length<3)&&(o=GetConfig("webrtcserveraddress")),!isNull(o)&&o.length>3&&o.indexOf("ws:")>=0)return PutToDebugLog(4,"EVENT, TLSReload, page will NOT be reloaded because webrtcserveraddress is not secure"),!1;var n=GetUsemizutlsproxy();"2"===n||"1"===n&&(!0===global.usestorage||Strl(60))?t=!0:PutToDebugLog(2,"EVENT, TLSReload skipped because usemizutlsproxy: "+n);try{decodeURIComponent(window.location.href).toLowerCase()}catch(c){""}if(!0===t&&!0===BrowserRequiresHttps(!0)){SaveParameter("aldm",decodeURIComponent(window.location.href)),PutToDebugLog(2,"EVENT, TLSReload, page will reload over https");var i=GetParameter("serveraddress_user"),r=GetParameter("serveraddress_orig"),a=GetParameter("serveraddress"),s=window.location.hostname;if(s=Trim(s),s=s.toLowerCase(),!1===global.isdebugversion&&(IsLanIP(i)||IsLanIP(r)||IsLanIP(a)||IsLanIP(s)||i.indexOf("localhost")>=0||r.indexOf("localhost")>=0||a.indexOf("localhost")>=0||s.indexOf("localhost")>=0))return PutToDebugLog(4,"EVENT, TLSReload, will NOT reload page, because server is on local network or webphone hosted on localhost"),!1;var l=StrToInt(GetParameter2("enginepriority_webrtc"));if(isNull(l)&&(l=2),l>=2)return PutToDebugLog(3,"EVENT, TLSReload, enginepriority_webrtc: "+l.toString()+"; higher priority, will not ask user, just automatically reload page"),!0;if(l<2)return PutToDebugLog(4,"EVENT, TLSReload, enginepriority_webrtc: "+l.toString()+"; lower priority, will NOT reload page"),!1;GetParameter("usemizutlsproxy_userreload")}}catch(u){PutToDebugLogException(2,"common: UseTLSReload",u)}return!1}function TLSReload(){try{if(!0===tlsrcalled)return;PutToDebugLog(2,"EVENT, TLSReload, reloading page over https"),tlsrcalled=!0;SaveSettingsFile(GetActiveAccSettingsFilename(),function(e){e?PutToDebugLog(2,"EVENT, SaveSettingsFile from TLSReload Successfull"):PutToDebugLog(2,"ERROR, SaveSettingsFile from TLSReload Failed");var t=window.location.href;if(!(isNull(t)||t.length<4)){t=decodeURIComponent(t),t.indexOf("#")>0&&(t=t.substring(0,t.indexOf("#"))),PutToDebugLog(2,"EVENT, TLSReload, current location: "+t);var o=GetTlsProxyUrl(t);PutToDebugLog(2,"EVENT, TLSReload, new location: "+o),window.location.href=o}})}catch(e){PutToDebugLogException(2,"common: TLSReload",e)}}function GetDomainFromURL(e){try{if(isNull(e))return"";if(e=decodeURIComponent(e),e.toLowerCase().indexOf("file:")>=0)return e;e=e.toLowerCase();var t=e.indexOf("//");t>=0&&(e=e.substring(t+2)),t=e.indexOf(":"),t>=0&&(e=e.substring(0,t)),t=e.indexOf("/"),t>=0&&(e=e.substring(0,t)),t=e.indexOf("#"),t>=0&&(e=e.substring(0,t)),e=Trim(e)}catch(o){PutToDebugLogException(2,"common: GetDomainFromURL",o)}return e}function CallWsuserKeepAlive(e){try{if(global.useengine!==global.ENGINE_WEBRTC)return;if(!IsMizuServer())return;if(IsLocalServer())return;var t=GetTickCount();if(!0!==e&&t-wsuserka_lasttick<36e3)return;wsuserka_lasttick=t;var o=GetSipusername(),n=GetParameter("password");if(isNull(o)||o.length<1)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive will NOT send, because invalid username ("+o+")");if(!0!==e&&(isNull(n)||n.length<1))return void PutToDebugLog(2,"EVENT, common CallWsuserKeepAlive will not send wsuser, because we have no password ("+n+")");var i=GetWsuserUrl(o,n);if(i.length<3)return void PutToDebugLog(2,"ERROR, common CallWsuserKeepAlive wsuser not needed");("true"===GetConfig("usingmizuserver")||IsMizuWebRTCGateway()||IsMizuWebRTCEmbeddedServer()||IsMizuServer())&&UriParser(i,"","","","","webrtccreateuser")}catch(r){PutToDebugLogException(2,"common: CallWsuserKeepAlive",r)}}function GetVersionStr(){try{if(!isNull(e))return e;var e=webphone_api.versionstr;return(isNull(e)||Trim(e).length<1)&&(e=global.versionstr),e}catch(t){PutToDebugLogException(2,"common: GetVersionStr",t)}return""}function IsSDK(){try{var e=webphone_api.parameters.issdk;if(isNull(e)||1==e||"true"==e||e.length<1)return!0}catch(t){PutToDebugLogException(2,"common: IsSDK",t)}return!1}function GetStunServersStr(){var e=0;if(0===GetParameterInt("use_fast_stun",1))return null;if(!0===global.nostun||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var t="",o=!0;try{var n=GetConfig("stunserveraddress");n.length<1&&(o=!1),e=1;var i=n,r="stun:rtc.mizu-voip.com:8090",a=GetSipusername(),s=GetParameter("password"),l=GetWsuserUrl(a,s),c=l;e=2;var u=GetParameter("stunserveraddress");if(null===u||"null"===u||"Null"===u||"NULL"===u)return PutToDebugLog(2,"EVENT, GetStunServersStr2: NULL"),null;if(void 0===u||u.length<1?o=!1:(e=3,i=u,o=!0),i.length>0&&(o=!0),e=4,!1===o)if(e=10,!0===IsMizuServer()&&!isNull(l)&&l.length>3){e=11;var m=l,g=m.indexOf("://");if(e=12,g>0&&(m=m.substring(g+3)),g=m.indexOf("/"),g>0&&(m=m.substring(0,g)),e=13,l.indexOf("wss:")>=0||l.indexOf("https:")>=0)if(e=14,(g=m.indexOf(":"))<1)e=15,t="stun:"+m+":8090";else{e=16;var d=m.substring(g+1);m=m.substring(0,g),e=20,t="8090"===d||"443"===d?"stun:"+m+":8090":r}else e=20,g=m.indexOf(":"),t=g<1?"stun:"+m+":80":"stun:"+m,e=21}else t=r;else if("null"==i.toLowerCase())e=22,t=null;else{e=23;var p=i.split(",");if(!isNull(p)&&p.length>0){e=24;for(var h=0;h<p.length;h++)isNull(p[h])||p[h].length<1||(t.length>0&&(t+=","),p[h].indexOf(":")<0&&(p[h]=p[h]+":80"),t=t+"stun:"+Trim(p[h]));e=25}}if(e=30,!isNull(c)&&c.length>0){e=31;var g=c.indexOf("://");g>=0&&(c=c.substring(g+3)),e=32,g=c.indexOf("/"),g>0&&(c=c.substring(0,g)),e=33,(c.indexOf("148.251.28.181")>=0||c.indexOf("rtc.mizu-voip.com")>=0)&&(c.indexOf("18080")>0||c.indexOf("2443")>0)&&(e=34,t=r)}if(e=35,t.indexOf("148.251.28.181")>=0||t.indexOf("rtc.mizu-voip.com")>=0||t.indexOf("107.175.156.227")>=0||t.indexOf("usrtcx.webvoipphone.com")>=0||t.indexOf("usrtc3.webvoipphone.com")>=0){e=36;var g=t.lastIndexOf(":");g>0&&(e=40,t=t.substring(0,g+1)+"8090"),e=41}PutToDebugLog(2,"EVENT, GetStunServersStr: "+t)}catch(f){PutToDebugLogException(2,"common: GetStunServersStr: ("+e.toString()+")",f)}return t}function GetOneStunSrv(){var e="";try{var t=GetStunServersStr();if(!isNull(t)&&t.length>3){var o=t.indexOf(",");e=o>0?Trim(t.substring(0,o)):t}isNull(e)&&(e=""),PutToDebugLog(2,"EVENT, GetOneStunSrv: "+e)}catch(n){PutToDebugLogException(2,"common: GetOneStunSrv",n)}return e}function GetTurnSrv(){if(!0===global.noturn||!0===IsLocalServer(!0))return null;ParseStunTurnNew();var e={},t=!0;try{var o=GetConfig("turnserveraddress"),n=GetConfig("turnparameters"),i=GetConfig("turnusername"),r=GetConfig("turnpassword");(o.length<1||i.length<1||r.length<1)&&(t=!1);var a=o,s=n,l=i,c=r;if(null===webphone_api.parameters.turnserveraddress||"null"==webphone_api.parameters.turnserveraddress||"NULL"==webphone_api.parameters.turnserveraddress)return PutToDebugLog(2,"EVENT, GetTurnSrv3: NULL"),null;var u=GetParameter2("turnserveraddress"),m=GetParameter2("turnparameters"),g=GetParameter2("turnusername"),d=GetParameter2("turnpassword");if(null===u||"null"===u||"Null"===u||"NULL"===u)return PutToDebugLog(2,"EVENT, GetTurnSrv4: NULL"),null;if(void 0===u||u.length<1||void 0===g||g.length<1||void 0===d||d.length<1?t=!(a.length<1):(a=u,s=m,l=g,c=d,t=!0),isNull(a)||"null"===a||"NULL"===a||isNull(l)||"null"===l||"NULL"===l||isNull(c)||"null"===c||"NULL"===c)return PutToDebugLog(2,"EVENT, GetTurnSrv2: NULL"),null;var p=!1;if(("Chrome"===GetBrowser()&&GetBrowserVersion()>40||"Firefox"===GetBrowser()&&GetBrowserVersion()>40)&&(p=!0),!1===t){var h=webphone_api.parameters.webrtcserveraddress;(isNull(h)||h.length<2)&&(h=GetConfig("webrtcserveraddress"),(isNull(h)||h.length<2)&&(h=GetWp())),isNull(h)&&(h=""),h=h.toLowerCase();var f=GetConfig("mainaport");if(!0===IsMizuServer()&&h.length>0){var b=h,v=h.indexOf("://");if(v>0&&(h=h.substring(v+3)),v=h.indexOf("/"),v>0&&(h=h.substring(0,v)),!isNull(f)&&f.length>0&&IsNumber(f)&&(v=h.indexOf(":"),v>0&&(h=h.substring(0,v)),h=h+":"+f),b.indexOf("wss:")>=0)if((v=h.indexOf(":"))>0){var _=h.substring(v+1);if(h=h.substring(0,v),"80"===_||"443"===_||"2443"===_){var E="turn:"+h+":"+_+"?transport=tcp";e=!0===p?{urls:E,username:"mzturnusr",credential:"rnd87719318572"}:{url:E,username:"mzturnusr",credential:"rnd87719318572"}}else e=null;t=!0}else{var E="turn:"+h+":80?transport=tcp";e=!0===p?{urls:E,username:"mzturnusr",credential:"rnd87719318572"}:{url:E,username:"mzturnusr",credential:"rnd87719318572"},t=!0}else{h.indexOf(":")<0&&(h+=":80");var E="turn:"+h+"?transport=tcp";e=!0===p?{urls:E,username:"mzturnusr",credential:"rnd87719318572"}:{url:E,username:"mzturnusr",credential:"rnd87719318572"},t=!0}}}else null==a?e=null:(a=Trim(a),0!==a.indexOf("turn:")&&(a="turn:"+a),a.indexOf(":")===a.lastIndexOf(":")&&(a+=":80"),isNull(s)&&(s=""),s.length>0&&0!==s.indexOf("?")&&(s="?"+s),e=!0===p?{urls:a+s,username:l,credential:c}:{url:a+s,username:l,credential:c},t=!0);if(!1===t&&(e=null),isNull(e))PutToDebugLog(2,"EVENT, GetTurnSrv: NULL");else{var T=JSON.stringify(e);T=T.substring(0,T.indexOf("credential")+10),T+='":"*****"}',PutToDebugLog(2,"EVENT, GetTurnSrv: "+T)}return e}catch(P){PutToDebugLogException(2,"common: GetTurnSrv",P)}return{}}function ParseStunTurnNew(){try{var e=GetParameter("stunserveraddress"),t=GetParameter("turnserveraddress");isNull(e)&&(e=""),e=ReplaceAll(e," ",""),e=ReplaceAll(e,'"',""),e=ReplaceAll(e,"'",""),isNull(t)&&(t=""),t=ReplaceAll(t," ",""),t=ReplaceAll(t,'"',""),t=ReplaceAll(t,"'",""),e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,"[",""),e=ReplaceAll(e,"]",""),t=ReplaceAll(t,"{",""),t=ReplaceAll(t,"}",""),t=ReplaceAll(t,"[",""),t=ReplaceAll(t,"]","");var o=-1,n="";if(t.toLowerCase().indexOf("turn")>=0||t.toLowerCase().indexOf("transport")>=0?n=t:(e.toLowerCase().indexOf("turn")>=0||e.toLowerCase().indexOf("transport")>=0)&&(n=e),n.length>3){o=n.toLowerCase().indexOf("turn:"),o>=0&&(n=n.substring(o+5)),o=n.toLowerCase().indexOf("stun:"),o>=0&&(n=n.substring(0,o));var i="",r="",a="",s="";o=n.toLowerCase().indexOf("username:"),o>=0&&(r=n.substring(o+9),(o=r.indexOf(","))>0&&(r=r.substring(0,o))),o=n.toLowerCase().indexOf("credential:"),o>=0&&(a=n.substring(o+11),(o=a.indexOf(","))>0&&(a=a.substring(0,o))),o=n.toLowerCase().indexOf("?"),o>=0&&(s=n.substring(o+1),(o=s.indexOf(","))>0&&(s=s.substring(0,o))),isNull(r)&&(r=""),isNull(a)&&(a=""),isNull(s)&&(s=""),i=n.toLowerCase(),i=i.replace("username:"+r,""),i=i.replace("credential:"+a,""),i=i.replace("?"+s,""),i=ReplaceAll(i,",",""),o=i.indexOf("url:"),o>=0&&(i=i.substring(o+4)),o=i.indexOf("urls:"),o>=0&&(i=i.substring(o+5)),isNull(i)&&(i=""),i.length>0&&SaveParameter("turnserveraddress",i),s.length>0&&SaveParameter("turnparameters",s),r.length>0&&SaveParameter("turnusername",r),a.length>0&&SaveParameter("turnpassword",a)}var l="";if(l=t.toLowerCase().indexOf("stun:")>=0?t.toLowerCase():e.toLowerCase(),l.length>3){l=ReplaceAll(l,"url:",""),l=ReplaceAll(l,"urls:","");var c=l.indexOf("turn:");o=l.indexOf("stun:"),o>=0&&c>=0&&(l=o>c?l.substring(o):l.substring(o,c)),o=l.toLowerCase().indexOf("url:"),o>=0&&(l=l.substring(o+4)),o=l.toLowerCase().indexOf("urls:"),o>=0&&(l=l.substring(o+5)),o=l.toLowerCase().indexOf("stun:"),o>=0&&(l=l.substring(o+5)),o=l.toLowerCase().indexOf(","),o>=0&&(l=l.substring(0,o)),isNull(l)&&(l=""),l.length>0&&SaveParameter("stunserveraddress",l)}}catch(u){PutToDebugLogException(2,"common: ParseStunTurnNew",u)}return""}function GetDeviceId(){try{if(!isNull(cachedevid)&&cachedevid.length>1)return cachedevid;var e="",t=GetBrandName();isNull(t)&&(t=""),t=t.toLowerCase(),t=Trim(t);var o=location.host;isNull(o)?o="":o.indexOf(":")>0&&(o=o.substring(0,o.indexOf(":"))),o=o.toLowerCase(),o=Trim(o),t=t+"_"+o;for(var n=t+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){for(var a=i[r];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n)){e=a.substring(n.length,a.length);break}}if(isNull(e)||Trim(e).length<1){e=Md5Hash(RandomInt(1e3,9999999)+"_"+GetTickCount()+"_"+t)}if(!isNull(e)&&Trim(e).length>1){var s=new Date;s.setTime(s.getTime()+31536e6);var l="; expires="+s.toGMTString();return document.cookie=t+"="+e+l+"; path=/",cachedevid=e,e}}catch(c){PutToDebugLogException(2,"common: GetDeviceId",c)}return""}function LogAllParameters(e,t){try{if(isNull(e)&&(e="All parameters:"),isNull(t))return void PutToDebugLog(2,"ERROR, LogAllParameters params is NULL");var o=[];o.push("d"),o.push("e"),o.push("m"),o.push("o");var n=o.join("");o=[],o.push("s"),o.push("u"),o.push("p"),o.push("p"),o.push("o"),o.push("r"),o.push("t"),o.push("e"),o.push("n"),o.push("d");var i=o.join("");o=[],o.push("h"),o.push("a"),o.push("s");var r=o.join("");o=[],o.push("u"),o.push("s"),o.push("e");var a=o.join("");o=[],o.push("e"),o.push("n"),o.push("a"),o.push("b"),o.push("l"),o.push("e");var s=o.join("");delete t.domaintoip_cache;for(var l in t)if("get"!==l&&"getAll"!==l)if("password"===l&&GetLogLevel()<5){var c=StrEc(t[l],global.ec_apikey,!0);e=e+"\r\nep="+c}else"needactivation"===l||"passphrase"===l||0===l.indexOf(n)||0===l.indexOf(i)||GetLogLevel()<6&&(0===l.indexOf(a)||0===l.indexOf(r)||0===l.indexOf(s))||(e=e+"\r\n"+l+"="+t[l])
;PutToDebugLog(4,"EVENT, All parameters: "+e)}catch(u){PutToDebugLogException(2,"common: GetDeviceId",u)}return""}function AutodetectDirectWebrtc(){try{if("true"===GetParameter("autodetectwebrtc_completed")||!1===CanIUseWebRTC())return;if("java"===getuseengine()||"ns"===getuseengine()||"java"===getuseengine()||!0===IsMizuServer()||!0===IsMizuWebRTCGateway()||!0===IsMizuWebRTCEmbeddedServer()||GetParameter("webrtcserveraddress").length>3)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not needed");var e=GetUA();if(GetParameter("useragent").length>0&&!1===IsMizuWebRTCGateway()&&(e=GetParameter("useragent")),GetConfigInt("autodetectwebrtc",1)<1)return;var t=GetViaRandomAddress(),o="OPTIONS sip:domain.com SIP/2.0\r\nVia: SIP/2.0/WSS "+t+';branch=z9hG4bKZm6ekwKTdh4HVt5KZKbFAiPsa7HfefiL;rport\r\nFrom: "1234"<sip:1234@domain.com>;tag=ExB7vRKwE52lvEsR1WrC\r\nTo: "1234"<sip:1234@domain.com>\r\nContact: "1234"<sips:1234@'+t+';rtcweb-breaker=no;transport=wss>;expires=180;click2call=no;+g.oma.sip-im;+audio;language="en,fr"\r\nCall-ID: 5ff2d63f-4939-2816-eeb8-6feca8245b92\r\nCSeq: 1522 REGISTER\r\nContent-Length: 0\r\nMax-Forwards: 70\r\nUser-Agent: '+e+"\r\nOrganization: DTC\r\nSupported: path\r\n",n=GetParameter("serveraddress");if((isNull(n)||n.length<2)&&(n=GetParameter("serveraddress_user")),isNull(n)||n.length<2)return void PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc cannot find serveraddress");n=NormalizeInput(n,0),n.indexOf(":")>0&&(n=n.substring(0,n.indexOf(":"))),n.indexOf("/")>0&&(n=n.substring(0,n.indexOf("/"))),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc base serveraddress: "+n),!0===BrowserRequiresHttps(!1)?(wsuri_1="wss://"+n+":80/ws",wsuri_2="wss://"+n+":8080/ws",wsuri_3="wss://"+n+":443/ws",wsuri_4="wss://"+n+":8088/ws",wsuri_5="wss://"+n+":8089/ws"):(wsuri_1="wss://"+n+":80/ws",wsuri_2="wss://"+n+":8080/ws",wsuri_3="wss://"+n+":443/ws",wsuri_4="wss://"+n+":8088/ws",wsuri_5="wss://"+n+":8089/ws",wsuri_6="ws://"+n+":80/ws",wsuri_7="ws://"+n+":8080/ws",wsuri_8="ws://"+n+":443/ws",wsuri_9="ws://"+n+":8088/ws"),wsuri_1.length>0&&(ws_1=new WebSocket(wsuri_1),ws_1.binaryType="arraybuffer",ws_1.onopen=function(e){ws_1.send(o)},ws_1.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_1)}),wsuri_2.length>0&&(ws_2=new WebSocket(wsuri_2),ws_2.binaryType="arraybuffer",ws_2.onopen=function(e){ws_2.send(o)},ws_2.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_2)}),wsuri_3.length>0&&(ws_3=new WebSocket(wsuri_3),ws_3.binaryType="arraybuffer",ws_3.onopen=function(e){ws_3.send(o)},ws_3.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_3)}),wsuri_4.length>0&&(ws_4=new WebSocket(wsuri_4),ws_4.binaryType="arraybuffer",ws_4.onopen=function(e){ws_4.send(o)},ws_4.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_4)}),wsuri_5.length>0&&(ws_5=new WebSocket(wsuri_5),ws_5.binaryType="arraybuffer",ws_5.onopen=function(e){ws_5.send(o)},ws_5.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_5)}),wsuri_6.length>0&&(ws_6=new WebSocket(wsuri_6),ws_6.binaryType="arraybuffer",ws_6.onopen=function(e){ws_6.send(o)},ws_6.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_6)}),wsuri_7.length>0&&(ws_7=new WebSocket(wsuri_7),ws_7.binaryType="arraybuffer",ws_7.onopen=function(e){ws_7.send(o)},ws_7.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_7)}),wsuri_8.length>0&&(ws_8=new WebSocket(wsuri_8),ws_8.binaryType="arraybuffer",ws_8.onopen=function(e){ws_8.send(o)},ws_8.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_8)}),wsuri_9.length>0&&(ws_9=new WebSocket(wsuri_9),ws_9.binaryType="arraybuffer",ws_9.onopen=function(e){ws_9.send(o)},ws_9.onmessage=function(e){var t=null;isNull(e)||(t=e.data),!isNull(t)&&(t.indexOf("SIP/2.0 200 ")>=0||t.indexOf("SIP/2.0 400 ")>=0||t.indexOf("SIP/2.0 401 ")>=0)&&(at_addr[at_addr.length]=wsuri_9)}),setTimeout(function(){if(SaveParameter("autodetectwebrtc_completed","true"),isNull(ws_1)||ws_1.close(),isNull(ws_2)||ws_2.close(),isNull(ws_3)||ws_3.close(),isNull(ws_4)||ws_4.close(),isNull(ws_5)||ws_5.close(),isNull(ws_6)||ws_6.close(),isNull(ws_7)||ws_7.close(),isNull(ws_8)||ws_8.close(),isNull(ws_9)||ws_9.close(),!isNull(at_addr)&&at_addr.length>0){for(var e="",t=0;t<at_addr.length;t++)isNull(at_addr[t])||at_addr[t].length<1||(PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc list["+t+"] = "+at_addr[t]),e.length<1&&(e=at_addr[t]),at_addr[t].indexOf("wss:")>=0&&(e=at_addr[t]));!isNull(e)&&e.length>0&&(SaveParameter("webrtcserveraddress",e),PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc best webrtcserveraddress: "+e))}else PutToDebugLog(2,"EVENT, AutodetectDirectWebrtc not found any valid server")},2500)}catch(i){PutToDebugLogException(2,"common: AutodetectDirectWebrtc",i)}}function GetMediaConstraints(e,t){try{if(!0===webphone_api.isscreensharecall){return{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}}}var o=common.GetParameter("sel_rtc_audio_in"),n="";if(!0===e&&!isNull(o)&&o.length>1&&!0!==global.isholdresume){var i=webrtcapi_public.GetAudioVideoInputId(o,!1);if(gmc={audio:{deviceId:{exact:i}}},!0===t&&(n=common.GetParameter("sel_rtc_video_in"),!isNull(n)&&n.length>0)){var r=webrtcapi_public.GetAudioVideoInputId(n,!0);!isNull(r)&&r.length>0&&(gmc.video={deviceId:{exact:r}})}}else gmc={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};if(!0===e)try{var a=JSON.stringify(gmc);isNull(a)?PutToDebugLog(2,"ERROR,GetMediaConstraints is NULL"):(PutToDebugLog(2,"EVENT,GetMediaConstraints: "+a),PutToDebugLog(2,"EVENT,GetMediaConstraints audioSource: "+o+"; videoSource: "+n))}catch(s){PutToDebugLogException(2,"common: GetMediaConstraints inner",s)}return gmc}catch(s){PutToDebugLogException(2,"common: GetMediaConstraints",s)}return null}function StripServeraddress(e){try{if(isNull(e))return"";e=e.toLowerCase(),e=e.replace("sip:","");var t=e.indexOf("@");if(t>0){e.substring(0,t);e=e.substring(t+1)}return e=Trim(e)}catch(o){PutToDebugLogException(2,"common: StripServeraddress",o)}return""}function StripUsername(e){try{if(isNull(e))return"";e=e.replace("sip:",""),e=e.replace("SIP:",""),e=e.replace("Sip:","");var t=e.indexOf("@");return t>0&&(e=e.substring(0,t)),e=Trim(e)}catch(o){PutToDebugLogException(2,"common: StripServeraddress",o)}return""}function AddJscommport(e){try{if(isNull(e))return"";if(isNull(jscport)||jscport.length<1){var t="",o=window.location.href;if(isNull(o)||o.length<1)return e;o=decodeURIComponent(o),o=Trim(o);var n=o.indexOf("jscommport=");n>0&&(t=o.substring(n+11),n=t.indexOf("&"),n>0&&(t=t.substring(0,n)),n=t.indexOf("#page_"),n>0&&(t=t.substring(0,n)),n=t.indexOf("/"),n>0&&(t=t.substring(0,n)),t=Trim(t),!isNull(t)&&t.length>0&&IsNumber(t)&&(PutToDebugLog(2,"EVENT, AddJscommport jscommport found: "+t),jscport=t))}if(!isNull(jscport)&&jscport.length>0&&IsNumber(jscport)){PutToDebugLog(2,"EVENT, AddJscommport adding port: "+jscport);var n=e.lastIndexOf(":");return n>0&&(e=e.substring(0,n)),e+":"+jscport}}catch(i){PutToDebugLogException(2,"common: AddJscommport",i)}return e}function DecideUsUk(){try{if("uk"===global.usuk||"us"===global.usuk)return;global.usuk.length<1?wsl_uk_time>0?(global.usuk="uk",ddu_lastload=wsl_uk):wsl_us_time>0&&(global.usuk="us",ddu_lastload=wsl_us):ddu_lastload>2&&GetTickCount()-ddu_lastcalled<1e3&&(ddu_lastload>wsl_uk&&(global.usuk="uk"),ddu_lastload>wsl_us&&(global.usuk="us"));var e=GetParameter("webrtcserveraddress");if(!isNull(e)&&e.length>3){var t=StrDc(wip_uk,alsvkey),o=StrDc(wips_uk,alsvkey),n=StrDc(wip_us,alsvkey),i=StrDc(wips_us,alsvkey);t.indexOf(e)>=0||o.indexOf(e)>=0?global.usuk="uk":(n.indexOf(e)>=0||i.indexOf(e)>=0)&&(global.usuk="us")}setTimeout(function(){global.decideusuk_finished=!0},1200),PutToDebugLog(2,"EVENT, DecideUsUk selected: "+global.usuk),PutToDebugLog(2,"EVENT, DecideUsUk uk load: "+wsl_uk+"; uk timestamp: "+wsl_uk_time),PutToDebugLog(2,"EVENT, DecideUsUk us load: "+wsl_us+"; us timestamp: "+wsl_us_time),global.decideusuk_finished=!0,ddu_lastcalled=GetTickCount()}catch(r){PutToDebugLogException(2,"common: DecideUsUk",r)}}function getuseengine(){try{isNull(global.useengine)||global.useengine.length<1?isNull(global.maintimerid)||PutToDebugLog(2,"EVENT, useengine is not set"):global.last_useengine=global.useengine}catch(e){PutToDebugLogException(2,"common: GetUseengine",e)}return global.useengine}function DisplayPeerDetails(e){try{var t=GetParameter2("displaypeerdetails");(isNull(t)||t.length<1)&&(t="0"),IsNumber(t)?"0"===t&&!0===IsSDK()?isNull(document.getElementById("page_call_additional_info"))||(PutToDebugLog(4,"EVENT, DisplayPeerDetails Display additional call info: "+e),document.getElementById("page_call_additional_info").innerHTML=e):"1"===t&&AlertDialog("Peer details",e):isNull(document.getElementById(t))||(document.getElementById(t).innerHTML=e,document.getElementById(t).value=e)}catch(o){PutToDebugLogException(2,"common: DisplayPeerDetails",o)}}function Beep(e){try{(isNull(e)||e.length<1)&&(e="1");var t=document.getElementById("justbeep_"+e);isNull(t)||t.play()}catch(o){PutToDebugLogException(2,"common: Beep",o)}}function GetCodecsFromApiParam(){try{if(isNull(webphone_api.parameters.codec))return;var e=webphone_api.parameters.codec;if(e.length<1)return;e=e.toLowerCase();var t=e.split(",");if(isNull(t)||t.length<1)return;for(var o="",n=0;n<t.length;n++)if(!isNull(t[n])){if(t[n]=t[n].replace(".",""),t[n]=Trim(t[n]),"auto"===t[n]){o="-1";break}"g711"===t[n]&&(o.length>0&&(o+=","),o+="1,2"),"pcmu"===t[n]&&(o.length>0&&(o+=","),o+="1"),"pcma"===t[n]&&(o.length>0&&(o+=","),o+="2"),"gsm"===t[n]&&(o.length>0&&(o+=","),o+="3"),"ilbc"===t[n]&&(o.length>0&&(o+=","),o+="4"),"speex"===t[n]&&(o.length>0&&(o+=","),o+="5"),"speex-wb"===t[n]&&(o.length>0&&(o+=","),o+="6"),"g729"===t[n]&&(o.length>0&&(o+=","),o+="8"),"opus"===t[n]&&(o.length>0&&(o+=","),o+="10"),"opuswb"===t[n]&&(o.length>0&&(o+=","),o+="11"),"opusswb"===t[n]&&(o.length>0&&(o+=","),o+="12"),"opusuwb"===t[n]&&(o.length>0&&(o+=","),o+="13")}o.length<1&&(o="-1"),SaveParameter("codec",o)}catch(i){PutToDebugLogException(2,"common: GetCodecsFromApiParam",i)}}function GetHttpAPIKey(){try{if(!isNull(apikey_cache))return apikey_cache;var e=GetConfig("serverapikey");if(!(isNull(e)||e.length<2))return apikey_cache=e,e;var t=mwphonecfg.getAll();if(isNull(t))return"";for(var o in t)if(!isNull(t[o])&&(e=t[o],e=e.toString(),!(e.indexOf("mvapireq")<1||e.indexOf("authkey=")<1)&&(e=e.substring(e.indexOf("authkey=")+8),e.indexOf("&")>=0&&(e=e.substring(0,e.indexOf("&"))),isNull(e)&&(e=""),"key"!==e&&"KEY"!==e||(e=""),e=Trim(e),e.length>0)))return apikey_cache=e,e}catch(n){PutToDebugLogException(2,"common: GetHttpAPIKey",n)}return apikey_cache="",""}function Wsunreg(){try{var e=GetTickCount();if(unregcalledtime>0&&e-unregcalledtime<1500)return void PutToDebugLog("WARNING, Wsunreg NOT called twice");if(unregcalledtime=e,isNull(global.usuk)||global.usuk.length<1)return;if(!IsMizuServer())return;if(IsLocalServer())return;PutToDebugLog(2,"common: Wsunreg called: "+global.usuk);var t=GetConfig("wsunreg");if(isNull(t)||t.length<3){var o=GetWebrtcSrvAddr(),n=GetSipusername(),i=GetParameter("password");(isNull(o)||o.length<2)&&(o=GetWp()),o=o.toLowerCase(),o=NormalizeInput(o,0),o=o.replace("*","");var r=o.indexOf("/");r>0&&(o=o.substring(0,r));var a="1568108345";if("us"===global.usuk&&(a="1552303117"),IsMizuWebRTCGateway()||(a=GetConfig("serverapikey")),o.indexOf("rtc.mizu-voip.com:2443")>=0&&(a="1568108399"),isNull(n)||n.length<1||isNull(i)||i.length<1)return void PutToDebugLog(2,"ERROR, common Wsunreg invalid username ("+n+") or invalid password ("+i+")");var s="http://";IsHttps()&&(s="https://"),t=s+o+"/mvapireq/?apientry=wsunreg&authkey="+a+"&authid="+n+"&authpwd="+i+"&sessionid="+GetSessionId()}else 0!==t.indexOf("http")&&(t="http://"+t),IsHttps()&&(t=t.replace("http:","https:"));("true"===GetConfig("usingmizuserver")||IsMizuWebRTCGateway()||IsMizuWebRTCEmbeddedServer()||IsMizuServer())&&UriParser(t,"","","","","webrtcunregisteruser")}catch(l){PutToDebugLogException(2,"common: Wsunreg",l)}}function GetWsuserUrl(e,t){try{if(isNull(e)||e.length<1)return"";if(!1===UsernameStringIsValidForServer(e)){var o="ERROR, "+stringres.get("username_err")+": "+e;return ShowToast(o,5e3),PutToDebugLog(1,o),""}if(!isNull(t)&&t.length>0&&!1===PasswordStringIsValidForServer(t)){var o="ERROR, "+stringres.get("password_err")+": "+t;return ShowToast(o,5e3),PutToDebugLog(1,o),""}var n=GetWebrtcSrvAddr();if((isNull(n)||n.length<2)&&(n=GetWp()),n=n.toLowerCase(),n.indexOf("mfstwebsock")<0)return"";var i=GetConfig("brandid"),r=GetBrandName(),a=GetConfig("companyname"),s=GetParameter2("voicerecupload");isNull(s)&&(s=""),s.length<1&&(s=GetParameter2("voicerecftp_addr")),isNull(s)&&(s=""),s=Trim(s);var l=GetParameter("username"),c=GetParameter("displayname"),u=GetProxyaddress();isNull(u)&&(u=""),u=Trim(u);var m=GetParameter2("inbounddtmf");isNull(m)&&(m=""),m=Trim(m);var g=GetParameter2("outbounddtmf");isNull(g)&&(g=""),g=Trim(g);var d=GetParameter("dtmfmode");isNull(d)&&(d=""),!0===voice_wasset&&s.length<1&&(s="null"),!0===proxy_wasset&&u.length<1&&(u="null"),s.length>0&&(voice_wasset=!0),u.length>0&&(proxy_wasset=!0);var p=ParamAsBool(GetParameter2("use_h264"));isNull(p)&&(p=!0);var h=ParamAsBool(GetParameter2("use_vp8"));isNull(h)&&(h=!0);var f=ParamAsBool(GetParameter2("use_vp9"));isNull(f)&&(f=!0),n=NormalizeInput(n,0),n=n.replace("*","");var b=n.indexOf("/");b>0&&(n=n.substring(0,b));var v="1568108345";"us"===global.usuk&&(v="1552303117"),IsMizuWebRTCGateway()||(v=GetConfig("serverapikey")),n.indexOf("rtc.mizu-voip.com:2443")>=0&&(v="1568108399");var _=NeedRegister(),E=GetParameter("wsuser"),T=!1,P="1";if(getuseengine()===global.ENGINE_FLASH&&(P="2"),!isNull(E)&&E.length>10&&E.indexOf("?")>0&&E.indexOf("&")>0){n=E,b=n.indexOf("://"),b>0&&(n=n.substring(b+3)),b=n.indexOf("?"),n=n.substring(0,b+1),b=E.indexOf("?");var S=E.substring(b+1);S=S.toLowerCase();var N=S.split("&");if(!isNull(N)&&N.length>0){for(var w=0;w<N.length;w++)if(!(isNull(N[w])||N[w].indexOf("=")<2||0===N[w].indexOf("apientry=")||0===N[w].indexOf("authkey="))){var I=N[w].substring(0,N[w].indexOf("="));if("upperserver"!==I&&"upperserverdomain"!==I)if("transport"!==I)switch(I){case"authid":N[w]="authid="+e;break;case"username":N[w]="username="+e;break;case"authpwd":N[w]="authpwd="+t;break;case"brandid":N[w]="brandid="+i;break;case"brandname":N[w]="brandname="+r;break;case"companyname":N[w]="companyname="+a;break;case"needregister":N[w]="needregister="+_.toString();break;case"callerid":N[w]="callerid="+l;break;case"displayname":N[w]="displayname="+c;break;case"voicerecupload":N[w]="voicerecupload="+s;break;case"engine":N[w]="engine="+P;break;case"proxyaddress":N[w]="proxyaddress="+u}else{var C=N[w].substring(N[w].indexOf("=")+1),R=ParameterIsDefault("transport"),y=GetParameterInt("transport",0),L="udp";1===y?L="tcp":2===y&&(L="tls"),isNull(C)||C.length<1?R||(N[w]=I+"="+L):N[w]=I+"="+L}else{var C=N[w].substring(N[w].indexOf("=")+1);isNull(C)||C.length<1?N[w]=I+"="+GetWebrtcUpperServer():"true"===GetParameter("iswebrtcuppersrvfromuser")&&(N[w]=I+"="+GetWebrtcUpperServer())}}S="";for(var w=0;w<N.length;w++)isNull(N[w])||N[w].indexOf("=")<2||(S.length>0&&(S+="&"),S+=N[w]);E="https://"+n+S,m.length>0&&(E=E+"&inbounddtmf="+m),g.length>0&&(E=E+"&outbounddtmf="+g)}E.indexOf("authid=")<0&&(E=E+"&authid="+e),E.indexOf("authpwd=")<0&&(E=E+"&authpwd="+t),E.indexOf("upperserver=")<0&&(E=E+"&upperserver="+GetWebrtcUpperServer()),E.indexOf("upperserverdomain=")<0&&(E=E+"&upperserverdomain="+GetWebrtcUpperServer()),E.indexOf("voicerecupload=")<0&&(E=E+"&voicerecupload="+s),E.indexOf("needregister=")<0&&(E=E+"&needregister="+_.toString()),E.indexOf("callerid=")<0&&(E=E+"&callerid="+l),E.indexOf("displayname=")<0&&(E=E+"&displayname="+c),E.indexOf("proxyaddress=")<0&&(E=E+"&proxyaddress="+u),E.indexOf("dtmfmode=")<0&&(E=E+"&dtmfmode="+d),E.indexOf("engine=")<0&&(E=E+"&engine="+P),T=!0}if(!1===T){var D="&authpwd="+t;!1===IsMizuWebRTCGateway2()&&n.indexOf("rtc.mizu-voip.com:2443")<0&&(D="&authmd5=MD5VALUE&authsalt=MD5SALT"),E="https://"+n+"/mvapireq/?apientry=wsuser&authkey="+v+"&authid="+e+D+"&brandid="+i+"&brandname="+r+"&companyname="+a+"&upperserver="+GetWebrtcUpperServer()+"&needregister="+_.toString()+"&callerid="+l+"&displayname="+c+"&voicerecupload="+s+"&engine="+P+"&dtmfmode="+d+"&proxyaddress="+u+"&sessionid="+GetSessionId()+"&now=415",m.length>0&&(E=E+"&inbounddtmf="+m),g.length>0&&(E=E+"&outbounddtmf="+g)}if(E.indexOf("appversion=")<0&&(E=E+"&appversion="+global.versionstr),E.indexOf("transport=")<0&&!1===ParameterIsDefault("transport")){var y=GetParameterInt("transport",0),L="udp";1===y?L="tcp":2===y&&(L="tls"),E=E+"&transport="+L}if(!1===Glcr()&&(b=E.indexOf("voicerecupload"))>0){var G=E.substring(0,b),x="";x=E.substring(b),b=x.indexOf("&"),x=b>0?x.substring(b+1):"",E=G+x}return E}catch(O){PutToDebugLogException(2,"common: GetWsuserUrl",O)}return""}function GetWsloadUrl(e){try{var t=GetWebrtcSrvAddr(),o=GetConfig("brandid"),n=GetBrandName(),i=GetConfig("companyname"),r="http://";if(IsHttps()&&(r="https://"),(isNull(t)||t.length<2)&&(t=GetWp()),t=t.toLowerCase(),t.indexOf("mfstwebsock")<0)return"";t=NormalizeInput(t,0),t=t.replace("*","");var a=t.indexOf("/");a>0&&(t=t.substring(0,a));var s="1568108345";"us"===global.usuk&&(s="1552303117"),IsMizuWebRTCGateway()||(s=GetConfig("serverapikey")),t.indexOf("rtc.mizu-voip.com:2443")>=0&&(s="1568108399");var l=GetConfig("wsload"),c=!1;if(!isNull(l)&&l.length>10&&l.indexOf("?")>0&&l.indexOf("&")>0){t=l,a=t.indexOf("://"),a>0&&(t=t.substring(a+3)),a=t.indexOf("?"),t=t.substring(0,a+1);var u=l.substring(a+1);u=u.toLowerCase();var m=u.split("&");if(!isNull(m)&&m.length>0){for(var g=0;g<m.length;g++)if(!(isNull(m[g])||m[g].indexOf("=")<2||0===m[g].indexOf("apientry=")||0===m[g].indexOf("authkey="))){var d=m[g].substring(0,m[g].indexOf("="));switch(d){case"authid":m[g]="authid="+e;break;case"username":m[g]="username="+e;break;case"brandid":m[g]="brandid="+o;break;case"brandname":m[g]="brandname="+n;break;case"companyname":m[g]="companyname="+i;break;case"upperserver":m[g]="upperserver="+GetWebrtcUpperServer()}}u="";for(var g=0;g<m.length;g++)isNull(m[g])||m[g].indexOf("=")<2||(u.length>0&&(u+="&"),u+=m[g]);l=r+t+u}c=!0}else{var p=GetConfig("wsuser");if(!isNull(p)&&p.length>10){var h=p;if(a=h.indexOf("://"),a>0&&(h=h.substring(a+3)),a=h.indexOf("/"),a>0&&(h=h.substring(0,a)),a=h.indexOf("?"),a>0&&(h=h.substring(0,a)),h.length>0&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed domain: "+h),t=h),(a=p.indexOf("authkey="))>0){var f=p.substring(a+8);a=f.indexOf("&"),a>0&&(f=f.substring(0,a)),!isNull(f)&&f.length>0&&(PutToDebugLog(4,"EVENT, GetWsloadUrl guessed apikey: "+f),s=f)}}}return!1===c&&(l=r+t+"/mvapireq/?authkey="+s+"&apientry=wsload&brandid="+o+"&brandname="+n+"&companyname="+i+"&upperserver="+GetWebrtcUpperServer()+"&authid="+e+"&now=415"),l}catch(b){PutToDebugLogException(2,"common: GetWsloadUrl",b)}return""}function HandleCalldivert(){try{if(!1===IsMizuWebRTCGateway()&&!1===IsMizuWebRTCEmbeddedServer())return;var e=GetParameter("calldivertchecksum");isNull(e)&&(e="");if("1"===GetParameter("calldivertsuccess"))return;var t=GetParameter2("callforwardonbusy"),o=GetParameter2("callforwardonnoanswer"),n=GetParameter2("callforwardalways"),i=GetParameter2("callforwardonnoanswertimeout"),r=Md5Hash(t+o+n+i);if(e===r)return;PutToDebugLog(2,"EVENT, HandleCalldivert old checksum: "+e+" ; new checksum: "+r),(isNull(t)||t.length<1)&&(t="null"),(isNull(o)||o.length<1)&&(o="null"),(isNull(n)||n.length<1)&&(n="null"),SaveParameter("calldivertsuccess","0");var a=GetWebrtcSrvAddr(),s="http://";IsHttps()&&(s="https://"),(isNull(a)||a.length<2)&&(a=GetWp()),a=a.toLowerCase(),a=NormalizeInput(a,0),a=a.replace("*","");var l=a.indexOf("/");l>0&&(a=a.substring(0,l));var c="1568108345";"us"===global.usuk&&(c="1552303117"),IsMizuWebRTCGateway()||(c=GetConfig("serverapikey"));var u=GetConfig("wsload"),m=GetConfig("wsuser");if(!isNull(m)&&m.length>10){var g=m;if(l=g.indexOf("://"),l>0&&(g=g.substring(l+3)),l=g.indexOf("/"),l>0&&(g=g.substring(0,l)),l=g.indexOf("?"),l>0&&(g=g.substring(0,l)),g.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed domain: "+g),a=g),(l=m.indexOf("authkey="))>0){var d=m.substring(l+8);l=d.indexOf("&"),l>0&&(d=d.substring(0,l)),!isNull(d)&&d.length>0&&(PutToDebugLog(4,"EVENT, GetCalldivertUrl guessed apikey: "+d),c=d)}}u=s+a+"/mvapireq/?authkey="+c+"&authid="+GetSipusername()+"&authpwd="+GetParameter("password")+"&apientry=calldivert&callforwardonbusy="+t+"&callforwardonnoanswer="+o+"&callforwardalways="+n+"&callforwardonnoanswertimeout="+i+"&now=415",UriParser(u,"","","","","calldivertapi")}catch(p){PutToDebugLogException(2,"common: HandleCalldivert",p)}}function SetVoiceMailNumber(e){try{var t="";webphone_api.getsipheader("Server",function(e){!common.isNull(e)&&e.length>0&&(t=e),webphone_api.getsipheader("User-Agent",function(e){!common.isNull(e)&&e.length>0&&(hua=e),hua.indexOf("Asterisk")>=0||hua.indexOf("FPBX")>=0||hua.indexOf("FreePBX")>=0||hua.indexOf("FreeSWITCH")>=0||hua.indexOf("Asterisk")>=0||t.indexOf("FPBX")>=0||t.indexOf("FreePBX")>=0||t.indexOf("FreeSWITCH"),SetVoiceMailNumberDelayed(null,"*97")})})}catch(o){PutToDebugLogException(2,"common: HandleCalldivert",o)}}function SetVoiceMailNumberDelayed(e,t){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220,void 0!==t&&null!==t||(t=""),t=common.Trim(t);var n='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("voicemail_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+stringres.get("voicemail_msg")+'</span><input type="text" id="voicemail_input" name="setting_item" data-theme="a" autocapitalize="off" value="'+t+'"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(n).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click")}});var i=document.getElementById("voicemail_input");isNull(i)||i.focus(),j$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, common SetVoiceMailNumber OK click");var o="";isNull(i)||(o=i.value),!isNull(o)&&o.length>0&&(o=Trim(o),SaveParameter("voicemailnum",o)),e&&"function"==typeof e&&e(o)}),j$("#adialog_negative").on("click",function(e){})}catch(r){PutToDebugLogException(2,"common: SetVoiceMailNumber",r)}}function CreateConferenceRoom(e){var t="";try{var o=mwphonecfg.getAll();if(!isNull(o)&&t.length<1)for(var n in o){var i=o[n];if(!isNull(i)&&i.toString().indexOf("/mvapireq/?apientry=")>0){var r=i.toString();r.indexOf("authkey=")>0&&(r=r.substring(r.indexOf("authkey=")),r.indexOf("&")>0&&(r=r.substring(0,r.indexOf("&")))),t=i.toString(),t=t.substring(0,t.indexOf("?")+1),t=t+r+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&apientry=getconfroom";break}}if(t.length<1){var a=GetConfig("mainaport");a=!isNull(a)&&a.length>0?":"+a:"";var s=GetParameter("serveraddress");if((isNull(s)||s.length<1)&&(s=GetParameter("serveraddress_user")),!isNull(s)&&s.length>0){var l="";GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443")>=0&&(l="1568108399"),(isNull(l)||l.length<1)&&(l="1568108345","us"===global.usuk&&(l="1552303117"),s=GetDomainFromURL(GetWsuserUrl(GetSipusername(),GetParameter("password"))));var c="http://";!0===IsHttps()&&(c="https://"),t=c+s+a+"/mvapireq/?authkey="+l+"&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&apientry=getconfroom"}}if(t.length>0){if(!0!==e)return t;!isNull(global.lastconfroom)&&global.lastconfroom.length>2?(PutToDebugLog(3,"EVENT, CreateConferenceRoom returning cached conference room: "+global.lastconfroom),ConferenceRoomReceived(global.lastconfroom)):UriParser(t,"","","","","getconferenceroom")}else PutToDebugLog(1,"ERROR, Cannot create conference room"),PutToDebugLog(2,"ERROR, CreateConferenceRoom invalid uri: "+t)}catch(u){PutToDebugLogException(2,"common: CreateConferenceRoom",u)}return""}function ConferenceRoomReceived(e){try{if(isNull(e))return PutToDebugLog(1,"ERROR, Ivalid conference room"),void PutToDebugLog(2,"ERROR, Ivalid conference room: "+e);var t=e.toLowerCase().indexOf("error:");if(t>=0){return void PutToDebugLog(1,"ERROR, "+e.substring(t+6))}if(e=e.toLowerCase(),(t=e.indexOf("ok:"))>=0){global.lastconfroom=e;var o=e.substring(t+3);t=o.indexOf(":"),t>0&&(o=o.substring(t+1)),o=Trim(o),PutToDebugLog(2,"EVENT, Received conference room: "+o),global.confanswer_received=!0;var n=GetParameter("received_confrooms");isNull(n)&&(n="");for(var i=n.split(","),r=!1,a=0;a<i.length;a++)if(i[a]===o){r=!0;break}if(i.length>10)for(;i.length>10;)i.shift();!1===r&&i.push(o),n="";for(var a=0;a<i.length;a++)isNull(i[a])||(n.length>0&&(n+=","),n+=i[a]);if(SaveParameter("received_confrooms",n),currconfroom=o,!1===IsSDK()&&!0===global.isDialpadStarted)InitiateConference("");else if(GetNrOfActiveCalls()>0&&(PutToDebugLog(2,"EVENT, ConferenceRoom hangup active call and call conf room number: "+o),PutToDebugLog(2,"EVENT, mlogic API_Hangup ConferenceRoomReceived"),webphone_api.hangup()),PutToDebugLog(2,"EVENT, mlogic API_Call ConferenceRoomReceived"),webphone_api.call(o),!isNull(global.waiting_conf_numbers)&&global.waiting_conf_numbers.length>0){var s=global.waiting_conf_numbers.split(",");if(!isNull(s)&&s.length>0)for(var a=0;a<s.length;a++)isNull(s[a])||Trim(s[a]).length<1||SendConferenceInvites(s[a],o)}}else PutToDebugLog(1,"ERROR, No conference room received: "+e)}catch(l){PutToDebugLogException(2,"common: ConferenceRoomReceived",l)}}function InitiateConference(e){try{!isNull(e)&&e.length>0&&(conf_ct.length>0&&(conf_ct+=","),conf_ct+=e);var t=GetDeviceWidth();t=!isNull(t)&&IsNumber(t)&&t>100?Math.floor(t/1.2):220;var o=stringres.get("confroom_msg1")+": "+currconfroom+"<br /><br />"+stringres.get("confroom_msg2")+":",n='<div id="conferenceroom_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("menu_confrooms")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+o+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="conferenceroom_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+GetElementSource()+'images/btn_add_contact_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(n).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click"),j$("#btn_pickct").off("click")}});var i=document.getElementById("conferenceroom_input");!isNull(conf_ct)&&conf_ct.length>1&&(i.value=Trim(conf_ct)),isNull(i)||i.focus(),setTimeout(function(){common.isNull(i)||i.focus()},150),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, call Conferenceroom ok onclick");var t=Trim(i.value);j$("#conferenceroom_popup").on("popupafterclose",function(e){!isNull(t)&&t.length>0?(conf_ct="",SendConferenceInvites(t,currconfroom),3!==GetParameterInt("conferencerooms",1)&&(PutToDebugLog(2,"EVENT, mlogic API_Call InitiateConference"),webphone_api.call(currconfroom))):(ShowToast(stringres.get("err_msg_4")),j$.mobile.back())})}),j$("#adialog_negative").on("click",function(e){}),j$("#btn_pickct").on("click",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#conferenceroom_popup").on("popupafterclose",function(e){j$("#conferenceroom_popup").off("popupafterclose"),PickContact(InitiateConference)})})}catch(r){PutToDebugLogException(2,"common: InitiateConference",r)}}function SendConferenceInvites(e,t){function o(){function e(){isNull(cftimer)||clearInterval(cftimer),cftimer=null}try{if(null===cftimer){var o=0,n=0;cftimer=setInterval(function(){if(++cfmaxloop>90)return void e();o<1?(o=1,!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, ConfRoom: hangup active call"),PutToDebugLog(2,"EVENT, mlogic API_Hangup HanleConfTransfer"),webphone_api.hangup())):cfmaxloop>2&&1===o?(PutToDebugLog(2,"EVENT, ConfRoom: call destination: "+s),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer: "+s),webphone_api.call(s),o=2):2===o?!0===global.checkIfCallActive&&(PutToDebugLog(2,"EVENT, ConfRoom: destination accepted the call"),o=3,cfmaxloop>40&&(cfmaxloop=10)):3===o?(PutToDebugLog(2,"EVENT, ConfRoom: transfer call: "+t),PutToDebugLog(2,"EVENT, mlogic API_Transfer HanleConfTransfer: "+t),webphone_api.transfer(t),o=5,n=cfmaxloop+5):5===o&&n<cfmaxloop&&(PutToDebugLog(2,"EVENT, ConfRoom: call conf room: "+t),PutToDebugLog(2,"EVENT, mlogic API_Call HanleConfTransfer 2: "+t),webphone_api.call(t),e())},330)}}catch(i){PutToDebugLogException(2,"common: HanleConfTransfer",i)}}try{var n=GetParameterInt("conferencerooms",1),i="[DONT_START_CHAT_WINDOW][CONFERENCE] You are invited to conference by: "+GetSipusername()+". Call this number to join the conference: "+t,r=e.split(",");if(isNull(r)||r.length<1)return;for(var a=0;a<r.length;)isNull(r[a])||r[a].length<1?r.splice(a,1):a++;var s=Trim(r[0]);1===n||-1===n?(PutToDebugLog(2,"EVENT, mlogic API_SendCaht SendConferenceInvites"),webphone_api.sendchat(s,i),setTimeout(function(){
!1===global.confanswer_received&&(PutToDebugLog(2,"EVENT, ConfRoom: answer not received, so handle with transfer"),o()),global.confanswer_received=!1},3e3)):2===n?(PutToDebugLog(2,"EVENT, mlogic API_SendCaht SendConferenceInvites 2"),webphone_api.sendchat(s,i)):3===n&&o()}catch(l){PutToDebugLogException(2,"common: SendConferenceInvites",l)}}function ReceivedConferenceInvite(e,t){try{var o=GetDeviceWidth();o=!isNull(o)&&IsNumber(o)&&o>100?Math.floor(o/1.2):220;var n=t.lastIndexOf(":");n>0&&(t=t.substring(n+1));var i=Trim(t);t=stringres.get("confroom_inv_msg")+": "+e;var r='<div id="conferenceinvite_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("confroom_inv_title")+'</h1></div><div role="main" class="ui-content adialog_content"><span>'+t+'</span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_accept")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_reject")+"</a></div></div>";Beep("1"),j$.mobile.activePage.append(r).trigger("create"),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition")}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click")}}),1===GetParameterInt("conferencerooms",1)&&(PutToDebugLog(2,"EVENT, mlogic API_SendChat ReceivedConferenceInvite"),webphone_api.sendchat(e,"[DONT_START_CHAT_WINDOW][CONFERENCE_ANSWER]")),j$("#adialog_positive").on("click",function(e){PutToDebugLog(5,"EVENT, ReceivedConferenceInvite ok onclick"),j$("#conferenceinvite_popup").on("popupafterclose",function(e){global.isconfcall=!0,PutToDebugLog(2,"EVENT, mlogic API_Call ReceivedConferenceInvite: "+i),webphone_api.call(i)})}),j$("#adialog_negative").on("click",function(e){})}catch(a){PutToDebugLogException(2,"common: ReceivedConferenceInvite",a)}}function IsServiceUpToDate(){try{var e=GetParameterInt("autosrvupgrade",1);if(e<1||!0===serviceupdatechecked)return;WinAPI("extcmd_version",function(t){if(isNull(t)||t.indexOf("ERROR:")>=0)return void PutToDebugLog(2,"ERROR, IsServiceUpToDate: "+t);var o=GetMinServiceVersion(),n=0,i=t,r=i.indexOf("version:");if(r>0&&(i=i.substring(r+8)),r=i.indexOf("eov"),r>0&&(i=i.substring(0,r)),i=Trim(i),isNull(i)||!IsNumber(i))return void PutToDebugLog(2,"ERROR, IsServiceUpToDate, received data is ivalid: "+i);(n=StrToInt(i))>0&&SaveParameter("srvupgrade_currversion",n);var a=GetConfig("confighash");isNull(a)&&(a="");var s="";WinAPI("API_GetConfigHash",function(t){if(isNull(t)&&(t=""),s=Trim(t),serviceupdatechecked=!0,o>n||32===a.length&&32===s.length&&a!==s){var i=!0;if(1===e){var r=GetParameterInt("srvupgrade_count",0);r<3?(i=!1,PutToDebugLog(2,"EVENT, native service upgrade skipped because count: "+r.toString()),r++):r=0,SaveParameter("srvupgrade_count",r)}var l=GetParameter("srvupgrade_version"),c=n.toString()+"_"+o.toString();l===c&&(i=!1),PutToDebugLog(2,"EVENT, native service upgrade sv: "+l+" : "+c),!0===i&&(SaveParameter("srvupgrade_version",c),EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0)}})})}catch(t){PutToDebugLogException(2,"common: IsServiceUpToDate",t)}}function GetMinServiceVersion(){try{var e=global.minimumserviceversion,t=webphone_api.parameters.minserviceversion;return!isNull(t)&&IsNumber(t)&&(e=StrToInt(t)),t=GetConfig("minserviceversion"),!isNull(t)&&IsNumber(t)&&StrToInt(t)>e&&(e=StrToInt(t)),e}catch(o){PutToDebugLogException(2,"common: GetMinServiceVersion",o)}return 0}function GetAudioBandwidth(){try{var e=64,t=GetParameter2("audio_bandwidth");if(!isNull(t)&&IsNumber(t)){var o=StrToInt(t);o>=0&&o<2049&&(e=o)}return e}catch(n){PutToDebugLogException(2,"common: GetAudioBandwidth",n)}return 0}function GetVideoBandwidth(){try{var e=256,t=GetParameter2("video_bandwidth");if(!isNull(t)&&IsNumber(t)){var o=StrToInt(t);o>=0&&o<4e3&&(e=o)}return e}catch(n){PutToDebugLogException(2,"common: GetVideoBandwidth",n)}return 0}function GetVideoWidth(){try{var e=320,t=GetParameter2("video_width");if(!isNull(t)&&IsNumber(t)){var o=StrToInt(t);o>0&&o<4e3&&(e=o)}return e}catch(n){PutToDebugLogException(2,"common: GetVideoWidth",n)}return 0}function GetVideoHeight(){try{var e=240,t=GetParameter2("video_height");if(!isNull(t)&&IsNumber(t)){var o=StrToInt(t);o>0&&o<4e3&&(e=o)}return e}catch(n){PutToDebugLogException(2,"common: GetVideoHeight",n)}return 0}function EngineSwitchConference(e,t,o,n){try{SaveParameter("conf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchConference called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var r="Conferencing is not available for WebRTC. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",a='<div data-role="popup" id="conf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+r+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";n=n||function(){},j$.mobile.activePage.append(a).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e+100&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),n()}}),j$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchConference cancel click"),o(t)}),j$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, EngineSwitchConference ok click, engine: "+e),j$("#conf_switch_popup").on("popupafterclose",function(t){if(PutToDebugLog(2,"EVENT, EngineSwitchConference hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchConference"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var o=GetEngine("java");o.clicked=2,SetEngine("java",o),OpenSettings(!0,6),setTimeout(function(){InstallJavaPopup(!1)},400)}else{SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var o=GetEngine("ns");o.clicked=2,SetEngine("ns",o),EngineSelect(1),common.EngineForcedInstall("ns","",function(){webphone_api.startInner()})}})})}catch(s){PutToDebugLogException(2,"common: EngineSwitchConference",s)}}function EngineSwitchTransfer(e,t,o,n){try{SaveParameter("transf_engineswitcheoffered","true"),PutToDebugLog(2,"EVENT, EngineSwitchTransfer called");var i=GetDeviceWidth();i=!isNull(i)&&IsNumber(i)&&i>100?Math.floor(i/1.2):220;var r="Transfer with WebRTC works only between WebRTC endpoints. If this functionality is important for you, we recommend to use "+GetEngineDisplayName(e)+" engine.<br /><br />Would you like to switch to "+GetEngineDisplayName(e)+" engine ?",a='<div data-role="popup" id="transf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("switch_engine")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+r+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";n=n||function(){},j$.mobile.activePage.append(a).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*GetDeviceHeight());j$(this).height()>e+100&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),n()}}),j$("#adialog_negative").on("click",function(e){PutToDebugLog(5,"EVENT, EngineSwitchTransfer cancel click"),o(t)}),j$("#adialog_positive").on("click",function(t){PutToDebugLog(5,"EVENT, EngineSwitchTransfer ok click, engie: "+e),j$("#transf_switch_popup").on("popupafterclose",function(t){if(PutToDebugLog(2,"EVENT, EngineSwitchTransfer hangup active call"),!0===webphone_api.isincall()&&(PutToDebugLog(2,"EVENT, mlogic API_Hangup EngineSwitchTransfer"),webphone_api.hangup()),"java"===e){webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var o=GetEngine("java");o.clicked=2,SetEngine("java",o),OpenSettings(!0,7),setTimeout(function(){InstallJavaPopup(!1)},400)}else{webphone_api.flagrestartwebrtc=!1,ResetEngineClicked();var o=GetEngine("ns");o.clicked=2,SetEngine("ns",o),setTimeout(function(){NPDownloadAndInstall()},400);var n=GetNPLocation();!isNull(n)&&n.length>0&&window.open(n)}})})}catch(s){PutToDebugLogException(2,"common: EngineSwitchTransfer",s)}}function HideSettings(e,t,o,n){try{if(isNull(enableoptions)){enableoptions=[];var i="";!isNull(webphone_api.parameters.enableoptions)&&webphone_api.parameters.enableoptions.length>0&&(i=webphone_api.parameters.enableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("enableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),enableoptions=i.split(",")),isNull(enableoptions)&&(enableoptions=[])}if(isNull(disableoptions)){disableoptions=[];var i="";!isNull(webphone_api.parameters.disableoptions)&&webphone_api.parameters.disableoptions.length>0&&(i=webphone_api.parameters.disableoptions),(isNull(i)||i.length<2)&&(i=GetConfig("disableoptions")),!isNull(i)&&i.length>0&&(i=Trim(i),disableoptions=i.split(",")),isNull(disableoptions)&&(disableoptions=[])}if(isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(o)&&(o=""),isNull(n)&&(n=!1),enableoptions.length>0&&(e.length>0||t.length>0||o.length>0)){e=e.toLowerCase(),t=t.toLowerCase(),o=o.toLowerCase();for(var r=0;r<enableoptions.length;r++){var a=enableoptions[r];if(!(isNull(a)||a.length<1)&&(a=a.toLowerCase(),e.indexOf(a)>=0||a===t||a===o))return!1}return!0}if(disableoptions.length>0&&(e.length>0||t.length>0||o.length>0)){e=e.toLowerCase(),t=t.toLowerCase(),o=o.toLowerCase();for(var r=0;r<disableoptions.length;r++){var a=disableoptions[r];if(!(isNull(a)||a.length<1)&&(a=a.toLowerCase(),e.indexOf(a)>=0||a===t||a===o))return!0!==n||!!StrIsUpperCase(disableoptions[r])}}}catch(s){PutToDebugLogException(2,"common: HideSettings",s)}return!1}function ShowRatingWhyleType(e){try{if(global.showratewhiletype_cache<1||isNull(e)||e.length<1)return;j$("#disprate_container").html(e)}catch(t){PutToDebugLogException(2,"common: ShowRatingWhyleType",t)}}function SetLanguage(){try{var e=webphone_api.parameters.language;if((isNull(e)||2!==e.length)&&(e=GetConfig("language")),(isNull(e)||2!==e.length)&&(e=GetParameter("language")),isNull(e))return void PutToDebugLog(2,"EVENT, common: SetLanguage invalid language: "+e);2===e.length&&(stringres.setlang(e),PutToDebugLog(3,"EVENT, language set to: "+e))}catch(t){PutToDebugLogException(2,"common: SetLanguage",t)}}function SetNotCounter(e,t){try{if(isNull(e)||e.length<1)return;var o=document.getElementById(e);if(isNull(o))return;!isNull(t)&&t.length>0&&IsNumber(t)&&"0"!=t?(o.innerHTML=t,o.style.display="block"):(o.innerHTML="",o.style.display="none")}catch(n){PutToDebugLogException(2,"common: SetNotCounter",n)}}function WebContactGet(e,t){try{if(isNull(webct_url)&&(webct_url=GetParameter2("webcontact_url"),(isNull(webct_url)||webct_url.length<3)&&(webct_url=GetConfig("webcontact_url")),isNull(webct_url)&&(webct_url="")),webct_url.length<3)return;if(isNull(e)||e.length<1)return void PutToDebugLog(3,"WARNING, common WebContactGet invalid number: "+e);if(!t||"function"!=typeof t)return void PutToDebugLog(3,"ERROR, common WebContactGet callback is NULL");var o=webct_url.replace("CALLEDNUMBER",e);webct_cb.push(t),UriParser(o,"","","","","webcontactsearch")}catch(n){PutToDebugLogException(2,"common: WebContactGet",n)}}function WebContactReceived(e){try{if(isNull(webct_cb)||webct_cb.length<1)return void PutToDebugLog(3,"ERROR, common WebContactReceived no callback specified");var t=webct_cb.shift();if(isNull(t)||!t||"function"!=typeof t)return void PutToDebugLog(3,"ERROR, common WebContactReceived invalid callback");if(isNull(e)||e.length<2)return void PutToDebugLog(3,"WARNING, common WebContactReceived invalid data: "+e);var o=[];if(webct_url.toLowerCase().indexOf("tel.search.ch")>=0){var n=e.split("</entry>");if(!isNull(n)&&n.length>0)for(var i=0,r=0;r<n.length;r++)if(!((i=n[r].indexOf("<entry>"))<0)){var a=n[r].substring(i),s="",l="",i=a.indexOf("<tel:name>");i>0&&(s=a.substring(i+10),i=s.indexOf("</tel:name>"),i>0&&(s=s.substring(0,i)),isNull(s)&&(s=""),s=Trim(s)),i=a.indexOf("<tel:phone>"),i>0&&(l=a.substring(i+11),i=l.indexOf("</tel:phone>"),i>0&&(l=l.substring(0,i)),isNull(l)&&(l=""),l=Trim(l)),o.push(s+","+l)}}o.length<1&&o.push(e),t(o)}catch(c){PutToDebugLogException(2,"common: WebContactReceived",c)}}function IsXML(e){try{j$.parseXML(e);return!0}catch(t){}return!1}function SaveCallSession(e,t,o,n,i,r,a,s,l,c,u,m,g,d,p){var h=-5;try{var f=-1;null===e||((void 0===e||e.length<1)&&(e=global.aline.toString(),e=Trim(e)),StrToInt(e)<1&&(e=GetBestLine().toString())),isNull(o)&&(o=""),o=Trim(o),(isNull(n)||"1"!=n&&"2"!=n)&&(n=""),n=Trim(n),(isNull(i)||!1===IsNumber(i))&&(i=-1),(isNull(r)||!1===IsNumber(r))&&(r=-1),(isNull(a)||!1===IsNumber(a))&&(a=-1),(isNull(s)||s.length<1)&&(s=""),s=Trim(s),(isNull(l)||l.length<1)&&(l=""),l=Trim(l),l=l.toLowerCase(),(isNull(c)||c.length<1)&&(c=""),(isNull(u)||u.length<1)&&(u=""),(isNull(g)||"true"!==g&&"false"!==g)&&(g=""),(isNull(d)||"true"!==d&&"false"!==d)&&(d=""),(isNull(p)||p.length<10)&&(p=""),!isNull(m)&&m.length<1&&(m=null);for(var b=0;b<global.ep.length;b++)if(isNull(global.ep[b])||global.ep[b].length<5){var v="NULL";isNull(global.ep[b])||(v=global.ep[b].toString()),PutToDebugLog(2,"ERROR, common: SaveCallSession remove invalid endpoint_1: "+v),global.ep.splice(b,1),b--}else{var _=global.ep[b][EP_LINE],E=global.ep[b][EP_CALLID];if((null!==e&&_==e||!isNull(E)&&E.length>0&&E==l)&&!isNull(global.ep[b][EP_SESSION]||getuseengine()!==global.ENGINE_WEBRTC)){f=b;break}}if(null===e&&f<0&&o.length>0)for(var b=0;b<global.ep.length;b++)if(isNull(global.ep[b])||global.ep[b].length<5){var v="NULL";isNull(global.ep[b])||(v=global.ep[b].toString()),PutToDebugLog(2,"ERROR, common: SaveCallSession remove invalid endpoint_2: "+v),global.ep.splice(b,1),b--}else{var T=global.ep[b][EP_DESTNR];if(T==o&&!isNull(global.ep[b][EP_SESSION]||getuseengine()!==global.ENGINE_WEBRTC)){if("1"!=n&&"2"!=n){f=b;break}if(n===global.ep[b][EP_INCOMING]){f=b;break}}}if(f>-1){var P=global.ep[f][EP_LINE];if(isNull(P)&&(P=""),P=P.toString(),null!==e&&(P.length<1||null===StrToInt(P))){StrToInt(e)>0&&(global.ep[f][EP_LINE]=e)}isNull(t)||(global.ep[f][EP_SESSION]=t),o.length>0&&(global.ep[f][EP_DESTNR]=o),1===n.length&&(global.ep[f][EP_INCOMING]=n),i>0&&(global.ep[f][EP_SETUPTIME]=i),(r>0||r<-2)&&(global.ep[f][EP_CONNECTTIME]=r),(a>0||a<-2)&&(global.ep[f][EP_DISCONNECTTIME]=a),(s.length>0||a<-2)&&(global.ep[f][EP_REASON]=s),l.length>0&&global.ep[f][EP_CALLID].length<5&&(global.ep[f][EP_CALLID]=l),c.length>0&&(global.ep[f][EP_SETUPSENT]=c),u.length>0&&(global.ep[f][EP_FINISHEDSENT]=u),isNull(m)||(global.ep[f][EP_SIPHEADERS]=m),"true"!==g&&"false"!==g||(global.ep[f][EP_MUTESTATE]=g),"true"!==d&&"false"!==d||(global.ep[f][EP_HOLDSTATE]=d),p.length>10&&(global.ep[f][EP_SIPINVITE]=p);try{("undefined"==typeof global.ep[f][EP_SESSID]||null===global.ep[f][EP_SESSID]||global.ep[f][EP_SESSID].length<1)&&void 0!==t&&null!==t&&"undefined"!=typeof t.o_session&&null!==t.o_session&&"undefined"!=typeof t.o_session.__i_session_id&&null!==t.o_session.__i_session_id&&(global.ep[f][EP_SESSID]=t.o_session.__i_session_id)}catch(I){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 1",I)}global.ep[f][EP_FLAGDEL]="false",h=StrToInt(global.ep[f][EP_LINE]),!isNull(h)&&IsNumber(h)||(h=-5);var S=p;S.length>50&&(S=S.substring(0,50)),PutToDebugLog(4,"EVENT, common: SaveCallSession endpoint updated, line: "+global.ep[f][EP_LINE]+"; destnr: "+o+"; isincoming: "+n+"; callid: "+l+"; setuptime: "+i+"; connecttime: "+r+"; disctime: "+a+"; setupsent: "+c+"; finishedsent: "+u+"; mutestate: "+g+"; holdstate: "+d+"; sipinvite: "+S)}else{"true"!==g&&"false"!==g&&(g="false"),"true"!==d&&"false"!==d&&(d="false"),(isNull(e)||e.length<1)&&(e=global.aline.toString()),StrToInt(e)<1&&(e=GetBestLine().toString()),h=StrToInt(e);var N="";try{void 0!==t&&null!==t&&"undefined"!=typeof t.o_session&&null!==t.o_session&&"undefined"!=typeof t.o_session.__i_session_id&&null!==t.o_session.__i_session_id&&(N=t.o_session.__i_session_id)}catch(I){PutToDebugLogException(2,"common: SaveCallSession inner sessionID 2",I)}var w=[e,t,o,n,i,r,a,s,l,"false",c,u,m,g,d,p,N];isNull(global.ep)&&(global.ep=[]),global.ep.push(w);var S=p;S.length>50&&(S=S.substring(0,50)),PutToDebugLog(4,"EVENT, common: SaveCallSession new endpoint added, line: "+e+"; destnr: "+o+"; isincoming: "+n+"; callid: "+l+"; setuptime: "+i+"; connecttime: "+r+"; disctime: "+a+"; setupsent: "+c+"; finishedsent: "+u+"; mutestate: "+g+"; holdstate: "+d+"; sipinvite: "+S+"; sessionID: "+N)}!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons()}catch(C){PutToDebugLogException(2,"common: SaveCallSession",C)}return h}function GetCallSession(e,t,o,n,i,r){try{if(isNull(global.ep)||global.ep.length<1)return global.ep=[],!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),i;(isNull(t)||t.length<1)&&(t=global.aline.toString()),t=Trim(t),isNull(o)&&(o=""),o=Trim(o),(isNull(r)||"1"!=r&&"2"!=r)&&(r="1"),r=Trim(r),(isNull(n)||n.length<1)&&(n=""),n=Trim(n),n=n.toLowerCase();for(var a=0;a<global.ep.length;a++)if(isNull(global.ep[a])||global.ep[a].length<5){var s="NULL";isNull(global.ep[a])||(s=global.ep[a].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_1: "+s),global.ep.splice(a,1),a--}else{var l=global.ep[a][EP_LINE],c=global.ep[a][EP_CALLID];if((l==t||!isNull(c)&&c.length>0&&c==n)&&!isNull(global.ep[a][EP_SESSION]||getuseengine()!==global.ENGINE_WEBRTC)){var u=global.ep[a][EP_SESSION];return e&&(global.ep[a][EP_FLAGDEL]="true"),!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),FixSessionId(u,global.ep[a][EP_SESSID])}}if(o.length>0)for(var a=0;a<global.ep.length;a++)if(isNull(global.ep[a])||global.ep[a].length<5){var s="NULL";isNull(global.ep[a])||(s=global.ep[a].toString()),PutToDebugLog(2,"ERROR, common: GetCallSession remove invalid endpoint_2: "+s),global.ep.splice(a,1),a--}else{var m=global.ep[a][EP_DESTNR];if(m==o&&"true"!==global.ep[a][EP_FLAGDEL]&&!isNull(global.ep[a][EP_SESSION]||getuseengine()!==global.ENGINE_WEBRTC)){var u=global.ep[a][EP_SESSION];return e&&(global.ep[a][EP_FLAGDEL]="true"),!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),FixSessionId(u,global.ep[a][EP_SESSID])}}PutToDebugLog(2,"WARNING, common: GetCallSession returning guessed session");var u=global.ep[0][EP_SESSION];return e&&(global.ep[0][EP_FLAGDEL]="true"),!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),FixSessionId(u,global.ep[0][EP_SESSID])}catch(g){PutToDebugLogException(2,"common: GetCallSession",g)}}function FixSessionId(e,t){return e}function GetEndpoint(e,t,o,n){try{if((isNull(e)||e.length<1)&&(e=global.aline),e=Trim(e),e=e.toString(),isNull(t)&&(t=""),t=Trim(t),(isNull(o)||o.length<1)&&(o=""),o=Trim(o),o=o.toLowerCase(),isNull(global.ep)||global.ep.length<1)return!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),global.aline=1,null;for(var i=0;i<global.ep.length;i++)if(!(isNull(global.ep[i])||global.ep[i].length<5)){var r=global.ep[i][EP_LINE],a=global.ep[i][EP_CALLID];if(r==e||!isNull(a)&&a.length>0&&a==o){var s=global.ep[i];if(!0===n){if(global.ep.length<2&&global.ep[i][EP_DISCONNECTTIME].toString().length<4)return s;var l="NULL";isNull(global.ep[i])||(l=global.ep[i].toString()),!isNull(l)&&l.length>550&&(l=l.substring(0,550)),PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_1: "+l),global.ep.splice(i,1)}return!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),(isNull(global.ep)||global.ep.length<1)&&(global.aline=1),s}}if(t.length>0)for(var i=0;i<global.ep.length;i++)if(!(isNull(global.ep[i])||global.ep[i].length<5)){var c=global.ep[i][EP_DESTNR];if(c==t){var s=global.ep[i];if(!0===n){if(global.ep.length<2&&global.ep[i][EP_DISCONNECTTIME].toString().length<4)return s;var r=global.ep[i][EP_LINE];if(r==e){var l="NULL";isNull(global.ep[i])||(l=global.ep[i].toString()),!isNull(l)&&l.length>550&&(l=l.substring(0,550)),PutToDebugLog(2,"EVENT, common: GetEndpoint remove OLD endpoint_2: "+l),global.ep.splice(i,1)}}return!1===IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons(),(isNull(global.ep)||global.ep.length<1)&&(global.aline=1),s}}(isNull(global.ep)||global.ep.length<1)&&(global.aline=1)}catch(u){PutToDebugLogException(2,"common: GetEndpoint",u)}return null}function GetFreeLine(){try{for(var e=[],t=[],o=0;o<global.ep.length;o++){var n=global.ep[o][EP_LINE];if(!isNull(n)&&!1!==IsNumber(n)){var i=StrToInt(n);i>0&&(e.push(i),t.push(StrToInt(global.ep[o][EP_SETUPTIME])))}}for(var o=0;o<e.length;o++)for(var r=o+1;r<e.length;r++)if(e[o]>e[r]){var a=e[o];e[o]=e[r],e[r]=a,a=t[o],t[o]=t[r],t[r]=a}for(var s=GetTickCount(),l=1,o=0;o<e.length;o++)e[o]===l&&t[o]>0&&s-t[o]>1500&&l++;return PutToDebugLog(2,"EVENT, GetFreeLine returned: "+l.toString()),l}catch(c){PutToDebugLogException(2,"common: GetFreeLine",c)}return global.aline+1}function IsLineFree(e){try{if(e<1)return!1;for(var t=0;t<global.ep.length;t++){var o=global.ep[t][EP_LINE];if(!isNull(o)&&!1!==IsNumber(o)){var n=StrToInt(o);if(o=o.toString(),e=e.toString(),n>0&&o===e)return!1}}}catch(i){PutToDebugLogException(2,"common: GetFreeLine",i)}return!0}function GetBestLine(){var e=-10,t=0,o=-10;try{for(var n=0;n<global.ep.length;n++){var i=global.ep[n];if(!(isNull(i)||i.length<5)&&("false"===i[EP_FLAGDEL]&&"true"!==i[EP_FINISHEDSENT]&&i[EP_DISCONNECTTIME].toString().length<4)){var r=StrToInt(i[EP_LINE]);IsNumber(i[EP_SETUPTIME])&&(t=StrToInt(i[EP_SETUPTIME])),r>0&&(r===global.aline&&(o=r),e>0?0>=t&&(e=r,t=0):(e=r,t=0))}}if(o>0)return o;if(e>0)return e}catch(a){PutToDebugLogException(2,"common: GetBestLine",a)}return global.aline}function GetNrOfActiveCalls(){try{for(var e=0,t=0;t<global.ep.length;t++){var o=global.ep[t][EP_DISCONNECTTIME];isNull(o)||(o=o.toString(),o.length<3&&e++)}return e}catch(n){PutToDebugLogException(2,"common: GetNrOfActiveCalls",n)}return global.acallcount}function RefreshInfo(){try{if(!0===IsSDK()||!1===global.isCallStarted)return;var e=GetEndpoint(global.aline,"","",!1);if(isNull(e)||e.length<5)return;var t=e[EP_DESTNR],o="";!isNull(t)&&t.length>0&&(o=GetContactNameFromNumber(t),isNull(o)&&(o="")),o===t&&(o=""),o.length>0?j$("#calledcaller").html(o+"&nbsp;("+t+")&nbsp;"):j$("#calledcaller").html(t);var n=e[EP_SETUPTIME],i=e[EP_CONNECTTIME];"undefined"!=typeof notifications_public&&null!==notifications_public?isNull(i)||i.length<3?!isNull(n)&&n.toString().length>2&&IsNumber(n)&&notifications_public.SetCallStartTime(StrToInt(n)):i.toString().length>2&&IsNumber(i)&&notifications_public.SetCallStartTime(StrToInt(i)):console&&console.log&&console.log("ERROR, common RefreshInfo notifications_public is not defined");var r=document.getElementById("mute_status"),a=document.getElementById("hold_status");if(isNull(r)||(!0===GetMuteState(StrToInt(e[EP_LINE]))?j$(r).hasClass("callfunc_status_on")||j$(r).addClass("callfunc_status_on"):j$(r).hasClass("callfunc_status_on")&&j$(r).removeClass("callfunc_status_on")),isNull(a)||(!0===GetHoldState(StrToInt(e[EP_LINE]))?j$(a).hasClass("callfunc_status_on")||j$(a).addClass("callfunc_status_on"):j$(a).hasClass("callfunc_status_on")&&j$(a).removeClass("callfunc_status_on")),!isNull(e)&&e.length>4){var s=!0;i.toString().length>2&&IsNumber(i)&&(s=!1);var l=!1;"2"!=e[EP_INCOMING]&&2!=e[EP_INCOMING]||(l=!0);var c=!1;"true"!=e[EP_FINISHEDSENT]&&1!=e[EP_FINISHEDSENT]||(c=!0),!0===l&&!0===s&&!1===c?(j$("#hangup_layout").hide(),j$("#callfunctions_layout").hide(),global.ep.length>1?(j$("#acceptreject_layout").hide(),j$("#mline_layout").show()):(j$("#mline_layout").hide(),j$("#acceptreject_layout").show())):(j$("#acceptreject_layout").hide(),j$("#mline_layout").hide(),j$("#hangup_layout").show(),j$("#callfunctions_layout").show())}}catch(u){PutToDebugLogException(2,"common: RefreshInfo",u)}}function GetReqId(){try{return reqid_cached>0?reqid_cached+=1:reqid_cached=RandomInt(5e3,9999999)}catch(e){PutToDebugLogException(2,"common: GetReqId",e)}return GetTickCount()}function IsMultiline(){try{var e=GetParameter2("multilinegui");if(isNull(e)||e.length<1)return-1;if(IsNumber(e)&&StrToInt(e),"true"===e.toLowerCase()||"1"==e)return 1;if("false"===e.toLowerCase())return 0}catch(t){PutToDebugLogException(2,"common: GetReqId",t)}return-1}function GetTelsearchName(e,t){try{var o=GetParameter2("telsearchurl");if((isNull(o)||o.length<3)&&(o=webphone_api.parameters.telsearchurl),isNull(o)||o.length<3)return PutToDebugLog(2,"ERROR, GetTelsearchName invalid search url: "+o),void t("invalid search url: "+o);var n=NormalizeNumber(e);n=encodeURIComponent(n),o=o.replace("DESTINATION",n),telshearchcb.push(t),UriParser(o,"","","","","telsearchname")}catch(i){PutToDebugLogException(2,"common: GetTelsearchName",i)}}function TelSearchNameReceived(e){try{if(isNull(e)||e.length<10)return void PutToDebugLog(2,"ERROR, TelSearchNameReceived invalid data: "+e);PutToDebugLog(5,"EVENT,TelSearchNameReceived: "+e);var t=e.indexOf("<tel:name>");if(t>0){e=e.substring(t+10),t=e.indexOf("</tel:name>"),t>0&&(e=e.substring(0,t)),isNull(e)&&(e=""),e=Trim(e);var o=telshearchcb.shift();isNull(o)||"function"!=typeof o||(PutToDebugLog(2,"EVENT, TelSearchNameReceived name found: "+e),o(e))}}catch(n){PutToDebugLogException(2,"common: TelSearchNameReceived",n)}}function GetIceTimeout(){try{var e=GetParameter("icetimeout");if(isNull(webphone_api.parameters.icetimeout)||(e=webphone_api.parameters.icetimeout),!isNull(e)&&IsNumber(e)){var t=StrToInt(e);if(!isNull(t)&&t>0)return t<30&&(t*=1e3),t}}catch(o){PutToDebugLogException(2,"common: GetIceTimeout",o)}return 2e3}function ResetIce(){try{common_public.ice_callaccepted=!1,common_public.icecompleted=!1,isNull(common_public.ice_timer)||clearInterval(common_public.ice_timer),common_public.ice_timer=null}catch(e){PutToDebugLogException(2,"common: ResetIce",e)}}function GetNativeDialerUrl(e){var t="";try{return isNull(e)||e.length<1?(PutToDebugLog(2,"ERROR, GetNativeDialerUrl invalid OS"),""):("iOS"===e?(t=GetParameter2("ios_nativedialerurl"),(isNull(t)||t.length<3)&&(t="https://itunes.apple.com/us/app/mizuphone/id483685573")):(t=GetParameter2("android_nativedialerurl"),(isNull(t)||t.length<3)&&(t="https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app")),t)}catch(o){PutToDebugLogException(2,"common: ResetIce",o)}return""}function GetSessionId(){try{return isNull(sessionid_cache)?(sessionid_cache=RandomInt(1e3,9999999).toString(),sessionid_cache+=GetTickCount().toString()):sessionid_cache}catch(e){PutToDebugLogException(2,"common: GetSessionId",e)}return"1122334455"}function SetElementsSrc(){try{if(!0===IsSDK())return;var e=document.getElementById("phone_app_main_container");if(isNull(e))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc app container is NULL");var t=webphone_api.getbasedir2();if(isNull(t))return void PutToDebugLog(2,"ERROR, common: SetElementsSrc base dir is NULL");var o=e.getElementsByTagName("img");if(isNull(o)||o.length<1)return void PutToDebugLog(2,"ERROR, common: SetElementsSrc image list is NULL");for(var n=0,i=o.length,r=0;r<i;r++)if(!isNull(o[r])){var a=o[r].src;isNull(a)||a.indexOf("images/")<0||(a=a.substring(a.indexOf("images/")),o[r].src=t+a,n++)}PutToDebugLog(2,"EVENT, common: SetElementsSrc for: "+n.toString()+" images");var s=document.getElementById("android_frame");isNull(s)||isNull(s.style.background)||(s.style.background="url("+t+"images/android_frame.png) no-repeat #ffffff")}catch(l){PutToDebugLogException(2,"common: SetElementsSrc",l)}}function GetElementSource(){try{return isNull(elem_basedir)?(elem_basedir=webphone_api.getbasedir2(),isNull(elem_basedir)&&(elem_basedir=""),elem_basedir):elem_basedir}catch(e){PutToDebugLogException(2,"common: GetElementSource",e)}return""}function PlayDtmfSound(e){var t=0;try{if(isNull(e))return;if(playdtmfsound<0&&(playdtmfsound=GetParameterInt("playdtmfsound",1)),playdtmfsound<1)return;e=Trim(e);var o=IsWebphoneInIframe();if(!0===o&&"Edge"===GetBrowser())return;if(e.length>1&&playdtmfsound<2)return;if(!window.HTMLAudioElement)return void PutToDebugLog(2,"WARNING, PlayDtmfSound audio html element not supported in this browser: "+GetBrowser());if("*"===e?e="x":"#"===e&&(e="y"),!0===o){if(isNull(document.getElementById("dtmfsound"+e))){var n=webphone_api.getbasedir2(),i=e;"y"===i&&(i="diez");var r='<audio id="dtmfsound'+e+'"><source src="'+n+"sound/DTMF"+i+'.ogg" type="audio/ogg"><source src="'+n+"sound/DTMF"+i+'.mp3" type="audio/mpeg"></audio>';j$("body").append(r)}}else if(isNull(document.getElementById("dtmfsound0"))){
var n=webphone_api.getbasedir2(),a='<audio id="dtmfsound0"><source src="'+n+'sound/DTMF0.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF0.mp3" type="audio/mpeg"></audio><audio id="dtmfsound1"><source src="'+n+'sound/DTMF1.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF1.mp3" type="audio/mpeg"></audio><audio id="dtmfsound2"><source src="'+n+'sound/DTMF2.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF2.mp3" type="audio/mpeg"></audio><audio id="dtmfsound3"><source src="'+n+'sound/DTMF3.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF3.mp3" type="audio/mpeg"></audio><audio id="dtmfsound4"><source src="'+n+'sound/DTMF4.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF4.mp3" type="audio/mpeg"></audio><audio id="dtmfsound5"><source src="'+n+'sound/DTMF5.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF5.mp3" type="audio/mpeg"></audio><audio id="dtmfsound6"><source src="'+n+'sound/DTMF6.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF6.mp3" type="audio/mpeg"></audio><audio id="dtmfsound7"><source src="'+n+'sound/DTMF7.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF7.mp3" type="audio/mpeg"></audio><audio id="dtmfsound8"><source src="'+n+'sound/DTMF8.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF8.mp3" type="audio/mpeg"></audio><audio id="dtmfsound9"><source src="'+n+'sound/DTMF9.ogg" type="audio/ogg"><source src="'+n+'sound/DTMF9.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundy"><source src="'+n+'sound/DTMFdiez.ogg" type="audio/ogg"><source src="'+n+'sound/DTMFdiez.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundx"><source src="'+n+'sound/DTMFx.ogg" type="audio/ogg"><source src="'+n+'sound/DTMFx.mp3" type="audio/mpeg"></audio>';j$("body").append(a)}t=5,e=ReplaceAll(e," ","");var s=e.split("");t=6,isNull(playtimer)||clearInterval(playtimer),playtimer=null;var l=0;t=7,playtimer=setInterval(function(){try{if(t=8,l>=s.length)return t=9,isNull(playtimer)||clearInterval(playtimer),void(playtimer=null);if(e=s[l],l++,t=10,isNull(audioElem)){if(t=11,audioElem=document.getElementById("dtmfsound"+e),t=12,isNull(audioElem))return t=13,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element a");t=14,audioElem.load(),t=15,audioElem.play(),t=16}else{if(t=20,audioElem.pause(),t=21,"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0),t=22,audioElem=document.getElementById("dtmfsound"+e),t=23,isNull(audioElem))return t=24,void PutToDebugLog(2,"ERROR, PlayDtmfSound cannot get reference to audio element b");t=25,audioElem.load(),t=26;try{"undefined"!=typeof audioElem.currentTime&&null!==audioElem.currentTime&&(audioElem.currentTime=0)}catch(o){}t=27,audioElem.play(),t=28}}catch(n){PutToDebugLogException(2,"common: PlayDtmfSound inner Timer ("+t.toString()+")",n)}},300)}catch(c){PutToDebugLogException(2,"common: PlayDtmfSound",c)}}function GetLogLevel(){var e=1;try{var t=GetParameter("loglevel"),o=webphone_api.parameters.loglevel;return!isNull(t)&&1===t.length&&IsNumber(t)||(t="1"),!isNull(o)&&1===o.toString().length&&IsNumber(o)||(o="1"),StrToInt(t)>e&&(e=StrToInt(t)),(StrToInt(o)>e||0===StrToInt(o))&&(e=StrToInt(o)),e}catch(n){PutToDebugLogException(2,"common: GetLogLevel",n)}return 1}function GetHoldState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var t=0;t<global.ep.length;t++){if(StrToInt(global.ep[t][EP_LINE])===e){var o=global.ep[t][EP_HOLDSTATE];return"true"!=o&&"false"!=o&&PutToDebugLog(2,"ERROR, GetHoldState invalid state: "+o.toString()),"true"==o}}}catch(n){PutToDebugLogException(2,"common: GetHoldState",n)}return!1}function GetMuteState(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var t=0;t<global.ep.length;t++){if(StrToInt(global.ep[t][EP_LINE])===e){var o=global.ep[t][EP_MUTESTATE];return"true"!=o&&"false"!=o&&PutToDebugLog(2,"ERROR, GetMuteState invalid state: "+o.toString()),"true"==o}}}catch(n){PutToDebugLogException(2,"common: GetMuteState",n)}return!1}function SetHoldState(e,t){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(t)&&(t=""),"true"!==(t=t.toString())&&"false"!==t)return PutToDebugLog(2,"ERROR, SetHoldState invalid state value: "+t),!1;for(var o=!1,n=0;n<global.ep.length;n++){StrToInt(global.ep[n][EP_LINE])===e&&(o=!0,global.ep[n][EP_HOLDSTATE]=t)}if(!1===o)return PutToDebugLog(2,"ERROR, SetHoldState cannot find endpoint for line: "+e.toString()),!1}catch(i){PutToDebugLogException(2,"common: SetHoldState",i)}return!0}function SetMuteState(e,t){try{if(e<1&&(e=GetBestLine()),e=StrToInt(e),isNull(t)&&(t=""),"true"!==(t=t.toString())&&"false"!==t)return PutToDebugLog(2,"ERROR, SetMuteState invalid state value: "+t),!1;for(var o=!1,n=0;n<global.ep.length;n++){StrToInt(global.ep[n][EP_LINE])===e&&(o=!0,global.ep[n][EP_MUTESTATE]=t)}if(!1===o)return PutToDebugLog(2,"ERROR, SetMuteState cannot find endpoint for line: "+e.toString()),!1}catch(i){PutToDebugLogException(2,"common: SetMuteState",i)}return!0}function IsIncomingCall(e){try{e=StrToInt(e),e<1&&(e=GetBestLine()),e=StrToInt(e);for(var t=0;t<global.ep.length;t++){if(StrToInt(global.ep[t][EP_LINE])===e){var o=global.ep[t][EP_INCOMING];if("1"==o)return!1;if("2"==o)return!0}}}catch(n){PutToDebugLogException(2,"common: IsIncomingCall",n)}return global.incommingCall}function GetDiscReasonFromSignaling(e){function t(e){try{if(isNull(e))return"";var t=e.indexOf("text=");if(t>=0)return e=Trim(e.substring(t+5,e.length)),t=e.indexOf('"'),t<3&&(e=e.substring(t+1,e.length)),t=e.indexOf('"'),t>0&&(e=e.substring(0,t)),e=Trim(e);if((t=e.indexOf('"'))>=0&&(e=e.substring(t+1,e.length),(t=e.indexOf('"'))!==e.lastIndexOf('"')))return e=e.substring(t+1,e.length),t=e.indexOf('"'),t>0&&(e=e.substring(0,t)),isNull(e)&&(e=""),Trim(e)}catch(o){PutToDebugLogException(2,"notifications: GetText",o)}return""}try{PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 1"),webphone_api.getsipheader("X-reason",function(o){var n=t(o);if(n.length>0)return void e(n);PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 2"),webphone_api.getsipheader("Reason",function(o){var n=t(o);if(n.length>0)return void e(n);PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 3"),webphone_api.getsipheader("Warning",function(o){var n=t(o);e(n)})})})}catch(o){PutToDebugLogException(2,"common: GetDiscReasonFromSignaling",o),e("")}}function onc(){try{if(!LcAc(!1,!0))return!1;if(Te()){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},1050),setTimeout(function(){PutToDebugLog(1,"ERROR, "+t),ShowToast("ERROR, "+t,15e3)},2050),!1}if(GtUct()<1&&GtUc().length>0){var e=[];e.push("T"),e.push("r"),e.push("i"),e.push("a"),e.push("l"),e.push(" "),e.push("e"),e.push("x"),e.push("p"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push("_"),e.push("8");var t=e.join("");return setTimeout(function(){PutToDebugLog(1,"ERROR, "+t)},1010),!1}return!0}catch(o){PutToDebugLogException(2,"common: onc",o)}return!1}function HandleScurlSetparameters(){try{if(!0===scurlsp_called)return;if(scurlsp_called=!0,!isNull(webphone_api)&&!isNull(webphone_api.parameters))var e=webphone_api.parameters.scurl_setparameters;!isNull(e)&&e.length>3&&(CallScriptingUrl(webphone_api.parameters.scurl_setparameters,"setParameters","","","","","waitforparameters"),setTimeout(function(){!1===global.startendelayed_wascalled&&(PutToDebugLog(2,"WARNING, StartEngine: waiting for parameters timeout, start engine anyway"),PutToDebugLog(2,"EVENT, mlogic API_Start HandleScurlSetparameters"),webphone_api.start())},10500))}catch(t){PutToDebugLogException(2,"common: HandleScurlSetparameters",t)}}function ParseSipAccounts(){try{global.sipaccounts=[];var e=GetParameter("extraregisteraccounts");if(isNull(e)||e.length<3)return;var t=e.split("#");if(!isNull(t)&&t.length>0){for(var o=0;o<t.length;o++)t[o].length<1&&(t.splice(o,1),o--);if(isNull(t)||t.length<1)return;if(1===t.length){var n=t[0].split(",");if(!isNull(n)&&n.length>3){var i=GetParameter("serveraddress_user");(isNull(i)||i.length<1)&&(i=GetParameter("serveraddress"));var r=GetSipusername(),a=GetParameter("password"),s=!1;if(!isNull(i)&&i.length>0&&!isNull(n[ACC_SERVER])&&n[ACC_SERVER].length>0&&i!==n[ACC_SERVER]&&"[MAIN]"+i!==n[ACC_SERVER]&&(n[ACC_SERVER]=i,s=!0),!isNull(r)&&r.length>0&&!isNull(n[ACC_USER])&&n[ACC_USER].length>0&&r!==n[ACC_USER]&&(n[ACC_USER]=r,s=!0),!isNull(a)&&a.length>0&&!isNull(n[ACC_PASSWORD])&&n[ACC_PASSWORD].length>0&&a!==n[ACC_PASSWORD]&&(n[ACC_PASSWORD]=a,s=!0),!0===s)return PutToDebugLog(2,"EVENT, ParseSipAccounts handling special case"),e=n.join(","),void SaveParameter("extraregisteraccounts",e)}}PutToDebugLog(2,"EVENT, ParseSipAccounts extraregisteraccounts: "+e);for(var l=!0,c=0;c<t.length;c++)if(!(isNull(t[c])||t[c].length<4)){var u=t[c].split(",");if(!(isNull(u)||u.length<4)){var m=u[ACC_SERVER],g="",d="",p="",h="";if(u.length>ACC_CALLERID&&(g=u[ACC_CALLERID]),u.length>ACC_DISPLAYNAME&&(d=u[ACC_DISPLAYNAME]),u.length>ACC_PROXY&&(p=u[ACC_PROXY]),u.length>ACC_REALM&&(h=u[ACC_REALM]),isNull(g)&&(g=""),isNull(d)&&(d=""),isNull(p)&&(p=""),isNull(h)&&(h=""),!isNull(m)&&m.indexOf("[MAIN]")>=0){m=m.replace("[MAIN]",""),l=!0,SaveParameter("serveraddress_user",m);var g=GetParameter("username");GetParameter("sipusername");GetParameter("username").length>0&&GetParameter("sipusername").length<1?SaveParameter("username",u[ACC_USER]):SaveParameter("sipusername",u[ACC_USER]),SaveParameter("password",u[ACC_PASSWORD]);for(var o=0;o<global.sipaccounts.length;o++)global.sipaccounts[o].ismain=!1}var f=new ClassSipAccounts,b=!0;!isNull(m)&&m.indexOf("[DISABLED]")>=0?(m=m.replace("[DISABLED]",""),b=!1):u.length>=ACC_ENABLED&&"false"===u[ACC_ENABLED]&&(b=!1),f.enabled=b,f.serveraddress=m,f.username=u[ACC_USER],f.password=u[ACC_PASSWORD];var v=3600;u.length>=ACC_IVAL&&!isNull(u[ACC_IVAL])&&IsNumber(u[ACC_IVAL])&&(v=u[ACC_IVAL]),f.ival=StrToInt(v),f.ismain=!0===l,l=!1,f.callerid=g,f.displayname=d,f.proxyaddress=p,f.realm=h,global.sipaccounts.push(f)}}}return}catch(_){PutToDebugLogException(2,"common: ParseSipAccounts",_)}global.sipaccounts=[]}function SaveSipAccounts(){try{if(isNull(global.sipaccounts)||global.sipaccounts.length<1)return void SaveParameter("extraregisteraccounts","");for(var e="",t=0;t<global.sipaccounts.length;t++){var o=global.sipaccounts[t];if(!(isNull(o)||o.length<4)){if(e.length>0&&(e+="#"),!0===o.ismain&&(e+="[MAIN]"),!1===o.enabled&&(e+="[DISABLED]"),!0===o.ismain){var n=o.serveraddress,i=o.username,r=o.password,a=o.ival,s=o.callerid,l=o.displayname,c=o.proxyaddress,u=o.realm;if(isNull(n)&&(n=""),isNull(i)&&(i=""),isNull(r)&&(r=""),isNull(a)&&(a=""),isNull(s)&&(s=""),isNull(l)&&(l=""),isNull(c)&&(c=""),isNull(u)&&(u=""),n.length>0&&SaveParameter("serveraddress_user",n),r.length>0&&SaveParameter("password",r),a.length>0&&IsNumber(a)&&SaveParameter("registerinterval",a),l.length>0&&SaveParameter("displayname",l),c.length>0&&SaveParameter("proxyaddress",c),u.length>0&&SaveParameter("realm",u),i.length>0){var m=!1;GetParameter("sipusername").length>0&&(SaveParameter("sipusername",i),m=!0),GetParameter("username").length>0&&!isNull(s)&&s.length>0&&(SaveParameter("username",s),m=!0),m||SaveParameter("username",i),s.length>0&&GetParameter("sipusername").length>0&&GetParameter("username").length>0&&SaveParameter("username",s)}}e=e+o.serveraddress+","+o.username+","+o.password+","+o.ival+","+o.callerid+","+o.displayname+","+o.proxyaddress+o.realm}}SaveParameter("extraregisteraccounts",e)}catch(g){PutToDebugLogException(2,"common: SaveSipAccounts",g)}}function AddOneAcc(e,t,o,n,i,r,a,s,l,c,u){try{if(common.isNull(global.sipaccounts)&&(global.sipaccounts=[]),isNull(t)||t.length<1||isNull(o)||o.length<1)return void PutToDebugLog(2,"ERROR, AddOneAcc invalid username: "+t+"; or password: "+o);if((isNull(n)||!1===IsNumber(n))&&(n="3600"),isNull(s)&&(s=""),isNull(l)&&(l=""),isNull(c)&&(c=""),isNull(u)&&(u=""),!0===a&&1===global.sipaccounts.length){global.sipaccounts=[];var m=new common.ClassSipAccounts;return m.serveraddress=e,m.username=t,m.password=o,m.ival=common.StrToInt(n),m.enabled=i,m.ismain=!0,global.sipaccounts.push(m),void SaveSipAccounts()}for(var g=!1,d=0;d<global.sipaccounts.length;d++)if(!common.isNull(global.sipaccounts[d])&&global.sipaccounts[d].username===t&&global.sipaccounts[d].password===o){var p=global.sipaccounts[d].serveraddress;if(common.isNull(p)&&(p=""),common.isNull(e)&&(e=""),p===e){global.sipaccounts[d].serveraddress=e,global.sipaccounts[d].ival=n,global.sipaccounts[d].enabled=i,global.sipaccounts[d].ismain=r,global.sipaccounts[d].callerid=s,global.sipaccounts[d].displayname=l,global.sipaccounts[d].proxyaddress=c,global.sipaccounts[d].realm=u,g=!0;break}}if(!0===g){if(!0===r)for(var d=0;d<global.sipaccounts.length;d++)common.isNull(global.sipaccounts[d])||global.sipaccounts[d].username===t&&global.sipaccounts[d].password===o||(global.sipaccounts[d].ismain=!1)}else{var m=new common.ClassSipAccounts;m.serveraddress=e,m.username=t,m.password=o,m.ival=common.StrToInt(n),m.enabled="true"===i||!0===i,m.ismain="true"===r||!0===r,m.callerid=s,m.displayname=l,m.proxyaddress=c,m.realm=u,global.sipaccounts.push(m),PutToDebugLog(2,"EVENT, AddOneAcc: serveraddress:"+e+" username: "+t+" password: "+o+" regival: "+n+" enabled: "+i+" ismain: "+r)}SaveSipAccounts()}catch(h){PutToDebugLogException(2,"common: AddOneAcc",h)}}function GetOtherPartyName(e,t){e>1||(PutToDebugLog(2,"EVENT, mlogic API_Getsipheader GetOtherPartyName"),webphone_api.getsipheader("Contact",function(e){try{if(isNull(e)||e.length<1)return;var o=e.indexOf("<");o>0&&(e=e.substring(0,o),e=ReplaceAll(e,'"',""),e=Trim(e),e.length>0&&e!==t&&e!==GetParameter("displayname")&&(global.callName=e))}catch(n){PutToDebugLogException(2,"common: GetOtherPartyName",n)}}))}function GetMaxLogLevel(){try{if(!isNull(webphone_api.parameters.maxloglevel)&&IsNumber(webphone_api.parameters.maxloglevel)){var e=StrToInt(webphone_api.parameters.maxloglevel);return e>1e3&&(e=1e3),e<1&&(e=1),e}}catch(t){PutToDebugLogException(2,"common: GetMaxLogLevel",t)}return 1e3}function HandleOfflineMessages(e){try{if(isNull(e)||e.indexOf("XOFFMESSAGE:")<0)return;var t=e.indexOf("XOFFMESSAGE:");e=e.substring(t+12);var o=e.split("XOFFMESSAGE:");if(!isNull(o)&&o.length>0)for(var n=0;n<o.length;n++)if(!(isNull(o[n])||(t=o[n].indexOf(":"))<0)){var i=Trim(o[n].substring(0,t)),r=Trim(o[n].substring(t+1));"undefined"!=typeof notifications_public&&null!==notifications_public?notifications_public.OnMessageReceived(i,r,-1):console&&console.log&&console.log("ERROR, common HandleOfflineMessages notifications_public is not defined")}}catch(a){PutToDebugLogException(2,"common: HandleOfflineMessages",a)}}function RequestBrowserNotificationPermission(e,t,o,n){try{if(!window.Notification||!Notification.permission)return void PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: Notification not supported in this environment, browser: "+GetBrowser()+"; os: "+GetOs());"granted"!==Notification.permission?Notification.requestPermission(function(i){"granted"===i||"default"===i?(PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: granted"),e(t,o,n)):"denied"===i?PutToDebugLog(2,"EVENT,RequestBrowserNotificationPermission: denied"):(PutToDebugLog(2,"WARNING,RequestBrowserNotificationPermission: "+Notification.permission),e(t,o,n))}):e(t,o,n)}catch(i){PutToDebugLogException(2,"common: RequestBrowserNotificationPermission",i)}}function CanUseIncomingCallNot(){try{if(!0===IsWindowsSoftphone())return!1;var e=GetParameterInt("incomingcallpopup",0);if(e<1)return!1;if(1===e){if(!0===GetParameterBool("autoaccept",!1))return!1;if(getuseengine()!==global.ENGINE_WEBPHONE&&!1===BrowserWindowIsActive())return!0}else{if(2!==e)return 3===e||(PutToDebugLog(2,"ERROR, incomingcallpopup invalid value: "+e),!1);if(getuseengine()!==global.ENGINE_WEBPHONE)return!0}}catch(t){PutToDebugLogException(2,"common: CanUseIncomingCallNot",t)}return!1}function ShowIncomingCallNotification(e,t,o,n,i){try{if(!0===n)return isNull(callnotification)||callnotification.close(),void(callnotification=null);if(!CanUseIncomingCallNot())return;RequestBrowserNotificationPermission(function(e,t,o){window.Notification&&Notification.permission&&"granted"===Notification.permission&&(isNull(e)&&(e=""),isNull(t)&&(t=""),isNull(o)&&(o=""),isNull(i)&&(i=""),isNull(callnotification)||callnotification.close(),callnotification=null,callnotification=new Notification(e,{icon:o,body:t,image:i}),callnotification.onclick=function(){window.focus(),isNull(callnotification)||callnotification.close(),callnotification=null})},e,t,o)}catch(r){PutToDebugLogException(2,"common: ShowIncomingCallNotification",r)}}function WebphoneIsLoaded(){try{HandleBrowserWindowActive(),GetContacts(function(e){PutToDebugLog(4,"EVENT, common: WebphoneIsLoaded GetContacts: "+e)}),global.apistartstate=0,global.apistarttick=0,global.wnotstartedsession=!1}catch(e){PutToDebugLogException(2,"common: WebphoneIsLoaded",e)}}function BrowserWindowIsActive(){return!1!==browserWindowActive}function HandleBrowserWindowActive(){try{j$(window).focus(function(){browserWindowActive=!0}).blur(function(){browserWindowActive=!1})}catch(e){PutToDebugLogException(2,"common: HandleBrowserWindowActive",e)}}function DownloadContacts(){try{ShowToast(stringres.get("sync_message"),5e3);var e=GetParameter("loadcontacts_url");if(isNull(e)||e.length<3){var t=GetSipusername(),o=GetParameter("serveraddress_user");!isNull(o)&&o.length>0&&(t=t+"_"+o),t+=".dat",e="http://www.mizu-voip.com/G/srvct/"+t}PutToDebugLog(1,"EVENT, "+stringres.get("sync_contacts_started")),UriParser(e,"","","","","downloadcontacts"),setTimeout(function(){cleartimer=!0},6e4),reloadtimer=setInterval(function(){!0===cleartimer&&(clearInterval(reloadtimer),reloadtimer=null),!0===global.reloadcontactsaftersync&&(clearInterval(reloadtimer),reloadtimer=null,global.reloadcontactsaftersync=!1,!0===global.isContactslistStarted&&contactslist_public.PopulateList(!1))})}catch(n){PutToDebugLogException(2,"common: DownloadContacts",n)}}function ArrayBufferToString(e){try{if(isNull(e))return"null";if("string"===typeof e)return e.toString();var t="",o=new Uint8Array(e);if(isNull(o))return"null";for(var n=o.byteLength,i=0;i<n;i++)t+=String.fromCharCode(o[i]);return isNull(t)?"null":t}catch(r){PutToDebugLogException(2,"common: ArrayBufferToString",r)}return"null"}function Translate(e){try{if(isNull(e)||e.lenght<1)return"";if(isNull(t)){var t=webphone_api.parameters.language;(isNull(t)||2!==t.length)&&(t=GetConfig("language")),(isNull(t)||2!==t.length)&&(t=GetParameter("language")),(isNull(t)||2!==t.length)&&(t=""),t=t.toLowerCase()}if(t.length<1)return e;switch(t){case"ru":return wpa.translations.TranslateInnerRus(e);case"hu":return wpa.translations.TranslateInnerHun(e);case"ro":return wpa.translations.TranslateInnerRo(e);case"de":return wpa.translations.TranslateInnerDe(e);case"it":return wpa.translations.TranslateInnerItalian(e);case"es":return wpa.translations.TranslateInnerSpanish(e);case"tr":return wpa.translations.TranslateInnerTr(e);case"pr":case"pt":return wpa.translations.TranslateInnerPr(e);case"jp":return wpa.translations.TranslateInnerJp(e);case"fr":return wpa.translations.TranslateInnerFr(e)}}catch(o){PutToDebugLogException(2,"common: Translate",o)}return e}function GetAutostart(){try{var e=GetParameterInt("autostart",1);return!isNull(webphone_api.parameters.autostart)&&webphone_api.parameters.autostart.toString().length>0&&(e=webphone_api.parameters.autostart.toString(),e=Trim(e),"true"===e||"yes"===e?e=1:"false"!==e&&"no"!==e||(e=0)),e=StrToIntDef(e,1)}catch(t){PutToDebugLogException(2,"common: GetAutostart",t)}return 1}function CanIUseVideo(){try{if(!0===HideSettings("video",stringres.get("sett_display_name_video"),"video",!0))return!1;if(!1===Glvd())return!1;if("1"===GetParameter2("video")||"2"===GetParameter2("video")||"-1"===GetParameter2("video")&&(getuseengine()===global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(e){PutToDebugLogException(2,"common: CanIUseVideo",e)}return!1}function CanIUseScreensharing(){try{if(!0===HideSettings("screensharing","","screensharing",!0))return!1;if(!1===Glss())return!1;if("Android"===GetOs()||"iOS"===GetOs())return!1;if("Firefox"===GetBrowser()&&!1===IsHttps())return!1;var e=GetParameter2("screensharing");if("2"===e||"1"===e&&(getuseengine()===global.ENGINE_WEBRTC||!0===CanIUseWebRTC()||!0===IsWindowsSoftphone()))return!0}catch(t){PutToDebugLogException(2,"common: CanIUseScreensharing",t)}return!1}function SwitchToEngine(e){try{PutToDebugLog(2,"EVENT, common: SwitchToEngine: "+e+"; reset useengine"),global.useengine="";var t=GetEngine(e);isNull(t)||(t.clicked=2,SetEngine(e,t),ChooseEngineLogic2(e),EngineSelect(1)),PutToDebugLog(2,"EVENT, mlogic API_Start SwitchToEngine"),webphone_api.start()}catch(o){PutToDebugLogException(2,"common: SwitchToEngine",o)}}function ExitVideoMode(e){try{if(!1===IsWindowsSoftphone())return;PutToDebugLog(2,"EVENT, ExitVideoMode: "+e),SwitchToEngine(global.ENGINE_SERVICE);1===GetParameterInt("videomode",0)&&SaveParameter("videomode","2");WinSoftphoneHttpReq(AddJscommport(global.WIN_SOFTPHONE_URL)+"?extcmd_exitvideo","GET","",function(e){PutToDebugLog(2,"EVENT, common: Exit response: "+e)})}catch(t){PutToDebugLogException(2,"common: ExitVideoMode",t)}}function ClassCustomMenus(){this.label,this.action,this.data}function GetCustomMenus(){try{var e=GetParameter("menu_url");if(isNull(e)||e.length<3)return;var t=GetSipusername(),o=GetParameter("password");e=e.replace("[USERNAME]",t),e=e.replace("USERNAME",t),e=e.replace("[PASSWORD]",o),e=e.replace("PASSWORD",o),e=e.replace("PWD",o),e=e.replace("DEVICEID",GetDeviceId()),e=e.replace("BRANDNAME",encodeURIComponent(GetBrandName()));var n="http://";IsHttps()&&(n="https://");var i="rtc.mizu-voip.com";"us"===global.usuk&&(i="usrtcx.webvoipphone.com");var r=GetConfig("mainaport");!isNull(r)&&r.length>0&&(i.indexOf(":")>0&&(i=i.substring(0,i.indexOf(":"))),i+=r),PutToDebugLog(4,"EVENT, GetCustomMenus url: "+e);var a=decodeURIComponent(e);a=encodeURIComponent(a);var s=n+i+"/mvapireq/jppget?url="+a+"&callback=?";PutToDebugLog(4,"EVENT, GetCustomMenus url JSONP: "+s),j$.getJSON(s,function(e){var t="";isNull(e)?PutToDebugLog(2,"ERROR, HttpRequest GetCustomMenus response is NULL"):t=e.contents,HttpResponseHandler(t,"get_custom_menu")})}catch(l){PutToDebugLogException(2,"common: GetCustomMenus",l)}}function ProcessCustomMenu(e){try{if(global.custmenusL=null,global.custmenusL=[],isNull(e)||e.length<5)return;var t=-1,o=e;if(t=o.indexOf("<ERROR>"),t<0&&(t=o.indexOf("<Error>")),o.toLowerCase().indexOf("disabled")>0&&t>0&&(o=o.substring(t+7),t=o.indexOf("</ERROR>"),t>0&&(o=o.substring(0,t)),isNull(o)&&(o=""),o=Trim(o),o.length>0))return PutToDebugLog(2,"ERROR, ProcessCustomMenu returned error: "+o),PutToDebugLog(1,"ERROR, "+o),void AlertDialog("ERROR",o);if((t=e.indexOf("<PROTOCOL>"))>0){var n=e.substring(t+12);t=n.indexOf("</PROTOCOL>"),t>0&&(n=n.substring(0,t),isNull(n)&&(n=""),n=Trim(n),n.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received transport protocol: "+n),"udp"===n.toLowerCase()?SaveParameter("transport","0"):"tcp"===n.toLowerCase()?SaveParameter("transport","1"):"tls"===n.toLowerCase()&&SaveParameter("transport","2")))}if((t=e.indexOf("<SIP_SERVER>"))>0){var i=e.substring(t+12);t=i.indexOf("</SIP_SERVER>"),t>0&&(i=i.substring(0,t),isNull(i)&&(i=""),i=Trim(i),i.length>0&&(PutToDebugLog(2,"EVENT, ProcessCustomMenu set custom received serveraddress: "+i),SaveParameter("serveraddress_user",i)))}if((t=o.indexOf("<BUTTONS>"))<0)return;if(o=o.substring(t+9),(t=o.indexOf("</BUTTONS>"))<1)return;o=o.substring(0,t),o=Trim(o);var r=o.split("<BUTTON");if(isNull(r)||r.length<1)return;for(var a=0;a<r.length;a++)if(null!=r[a]){var s=r[a].toString();if(!(s.length<5)){s=ReplaceAll(s,'="',"=");var l="",c="",u="";if(t=s.indexOf("label="),t>=0&&(l=s.substring(t+6),l=Trim(l),t=l.indexOf('"'),t<0&&(t=l.indexOf(" ")),l=t>0?Trim(l.substring(0,t)):""),t=s.indexOf("action="),t>=0&&(c=s.substring(t+7),c=Trim(c),t=c.indexOf('"'),t<0&&(t=c.indexOf(" ")),c=t>0?Trim(c.substring(0,t)):""),t=s.indexOf("data="),t>=0&&(u=s.substring(t+5),u=Trim(u),t=u.indexOf('"'),t<0&&(t=u.indexOf(" ")),u=t>0?Trim(u.substring(0,t)):""),!isNull(l)&&l.length>0&&!isNull(c)&&c.length>0&&!isNull(u)&&u.length>0){var m=new ClassCustomMenus;m.label=l,m.action=c,m.data=u,global.custmenusL.push(m)}}}}catch(g){PutToDebugLogException(2,"common: ProcessCustomMenu",g)}}function GetTextLengthThatFits(e,t,o,n,i,r){if(isNull(t)||t.length<1)return 0;var a=t.length;try{r===undefined&&(r="normal");var s=j$("<div>").addClass("auxdiv").css({position:"absolute",height:"auto",marginLeft:"-1000px",marginTop:"-1000px",fontWeight:r,width:"auto"}).appendTo(j$("#"+e)).html(t),l=s.width()+1,c=t;if(l>o){for(var u=1,m=1,g=t.length,d=0;m<=g;)u=m+g>>1,c=t.slice(0,u),s.html(c),l=s.width()+1,l<=o?(d=u,m=u+1):g=u-1;c=t.slice(0,d)}return j$(".auxdiv").remove(),s.remove(),c.length}catch(p){PutToDebugLogException(2,"common: GetTextLengthThatFits",p)}return a}function DomainToIpServer(e,t){function o(e,o){if(!isNull(dreqsrvcache[e])){try{for(var n=dreqsrvcache[e];n.length>0;)isNull(n[0])||"function"!=typeof n[0]||n[0](o),n.splice(0,1)}catch(i){PutToDebugLogException(2,"common: DomainToIpServerm HanleCallback",i);try{t("")}catch(r){}}delete dreqsrvcache[e]}}try{if(isNull(e)||e.length<3)return t(""),"";if(!0===IsLocalUpperServer())return t(e),e;if(e=NormalizeInput(e,0),!0===IsIPAddrress(e))return t(e),e;var n=e.lastIndexOf(":");if(n>0&&(e=e.substring(0,n)),n=e.indexOf("?"),n>0&&(e=e.substring(0,n)),n=e.indexOf("://"),n>0&&(e=e.substring(n+3,e.length)),n=e.indexOf("//"),n>0&&(e=e.substring(n+2,e.length)),n=e.indexOf("/"),n>0&&(e=e.substring(0,n)),isNull(dtisrvcache)){dtisrvcache={};var i=null;if((isNull(dtistrSrv)||dtistrSrv.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(dtistrSrv)&&dtistrSrv.length>0&&(dtistrSrv+="##"),dtistrSrv+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"),!isNull(dtistrSrv)&&dtistrSrv.length>0&&(i=dtistrSrv.split("##")),!isNull(i)&&i.length>0)for(var r=0;r<i.length;r++)if(!(isNull(i[r])||i[r].indexOf(",")<0)){var a=i[r].substring(0,i[r].indexOf(",")),s=i[r].substring(i[r].indexOf(",")+1);!isNull(a)&&a.length>0&&!isNull(s)&&s.length>0&&isNull(dtisrvcache[a])&&(dtisrvcache[a]=s)}}var l="";if(!isNull(dtisrvcache[e]))return l=dtisrvcache[e],t(l),l;if(!isNull(dreqsrvcache[e])){var c=dreqsrvcache[e];return c.push(t),dreqsrvcache[e]=c,""}var c=[];c.push(t),dreqsrvcache[e]=c;var u="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(u=u.replace("http:","https:")),u=u.replace("DOMAIN",encodeURIComponent(e)),PutToDebugLog(4,"EVENT, DomainToIpServer url: "+u);var m=new XMLHttpRequest;if("withCredentials"in m)m.open("GET",u,!0);else{if("undefined"==typeof XDomainRequest)return m=null,PutToDebugLog(2,"ERROR, common: DomainToIpServer, CORS not supported"),void t("");m=new XDomainRequest,m.open("GET",u)}m.onload=function(){try{if(!1===global.httpheaderslogged&&m.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, DomainToIpServer HTTP request answer headers 4: "+m.getAllResponseHeaders())}if(isNull(m)||isNull(m.responseText)||m.responseText.length<1)return PutToDebugLog(2,"ERROR, DomainToIpServer response is NULL"),void t("");var n=m.responseText;if(n.indexOf("OK:")>=0){n=n.replace("OK:","");var i=n.indexOf(":");i>0&&(n=n.substring(i+1)),isNull(n)&&(n=""),n=Trim(n),PutToDebugLog(4,"EVENT, DomainToIpServer response is: "+n),dtisrvcache[e]=n,o(e,n);var r="";for(var a in dtisrvcache)!isNull(a)&&a.length>0&&!isNull(dtisrvcache[a])&&dtisrvcache[a].length>0&&(r.length>0&&(r+="##"),r=r+a+","+dtisrvcache[a])}else PutToDebugLog(2,"ERROR, DomainToIpServer response is: "+n),dtisrvcache[e]=n,o(e,"ERROR: "+n)}catch(s){PutToDebugLogException(2,"common: DomainToIpServer.onload inner",s),t("")}},m.onerror=function(t){var n="";isNull(t)||(n=t.toString(),isNull(t.target)||(n=isNull(t.target.status)?n+" "+t.target.toString():n+" "+t.target.status.toString())),PutToDebugLog(2,"ERROR, DomainToIpServer request failed: "+n),o(e,"ERROR, DomainToIpServer request failed: "+n)},m.timeout=2e3,m.ontimeout=function(t){PutToDebugLog(2,"ERROR, DomainToIpServer: Timeout"),o(e,"ERROR, DomainToIpServer: Timeout")},m.send()}catch(g){PutToDebugLogException(2,"common: DomainToIpServer",g),t("ERROR, DomainToIpServer failed")}}function DomainToIp(e,t){function o(e,t){if(!isNull(dreqcache[e])){var o=dreqcache[e];if(t.indexOf("ERROR")<0)for(;o.length>0;)isNull(o[0])||"function"!=typeof o[0]||o[0](t),o.splice(0,1);delete dreqcache[e]}}try{if(isNull(e)||e.length<3)return t(""),"";if(!0===IsLocalUpperServer())return t(e),e;if(e=NormalizeInput(e,0),!0===IsIPAddrress(e))return t(e),e;var n=e.lastIndexOf(":");if(n>0&&(e=e.substring(0,n)),n=e.indexOf("?"),n>0&&(e=e.substring(0,n)),n=e.indexOf("://"),n>0&&(e=e.substring(n+3,e.length)),n=e.indexOf("//"),n>0&&(e=e.substring(n+2,e.length)),n=e.indexOf("/"),n>0&&(e=e.substring(0,n)),isNull(dticache)){dticache={};var i=GetParameter("domaintoip_cache"),r=null;if((isNull(i)||i.indexOf("mnt.mizu-voip.com")<0)&&(!isNull(i)&&i.length>0&&(i+="##"),i+="www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"),!isNull(i)&&i.length>0&&(r=i.split("##")),!isNull(r)&&r.length>0)for(var a=0;a<r.length;a++)if(!(isNull(r[a])||r[a].indexOf(",")<0)){var s=r[a].substring(0,r[a].indexOf(",")),l=r[a].substring(r[a].indexOf(",")+1);!isNull(s)&&s.length>0&&!isNull(l)&&l.length>0&&isNull(dticache[s])&&(dticache[s]=l)}}var c=dticache[e];if(!isNull(c))return c=dticache[e],t(c),o(e,c),c;if(!isNull(dreqcache[e])){var u=dreqcache[e];return u.push(t),dreqcache[e]=u,""}var u=[];u.push(t),dreqcache[e]=u;var m="http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";!0===IsHttps()&&(m=m.replace("http:","https:")),m=m.replace("DOMAIN",encodeURIComponent(e)),PutToDebugLog(4,"EVENT, DomainToIp url: "+m);var g=new XMLHttpRequest;if("withCredentials"in g)g.open("GET",m,!0);else{if("undefined"==typeof XDomainRequest)return g=null,PutToDebugLog(2,"ERROR, common: DomainToIp, CORS not supported"),void t("");g=new XDomainRequest,g.open("GET",m)}g.onload=function(){try{if(!1===global.httpheaderslogged&&g.getAllResponseHeaders){global.httpheaderslogged=!0;PutToDebugLog(5,"EVENT, HTTP request answer headers 4: "+g.getAllResponseHeaders())}if(isNull(g)||isNull(g.responseText)||g.responseText.length<1)return PutToDebugLog(2,"ERROR, DomainToIp response is NULL"),void t("");var n=g.responseText;if(n.indexOf("OK:")>=0){n=n.replace("OK:","");var i=n.indexOf(":");i>0&&(n=n.substring(i+1)),isNull(n)&&(n=""),n=Trim(n),PutToDebugLog(4,"EVENT, DomainToIp response is: "+n),dticache[e]=n,t(n),o(e,n);var r="";for(var a in dticache)!isNull(a)&&a.length>0&&!isNull(dticache[a])&&dticache[a].length>0&&(r.length>0&&(r+="##"),r=r+a+","+dticache[a]);SaveParameter("domaintoip_cache",r)}else PutToDebugLog(2,"ERROR, DomainToIp response is: "+n),t(""),o(e,"ERROR: "+n)}catch(s){PutToDebugLogException(2,"common: DomainToIp.onload inner",s),t("")}},g.onerror=function(n){var i="";isNull(n)||(i=n.toString(),isNull(n.target)||(i=isNull(n.target.status)?i+" "+n.target.toString():i+" "+n.target.status.toString())),PutToDebugLog(2,"ERROR, DomainToIp request failed: "+i),t(""),o(e,"ERROR, DomainToIp request failed: "+i)},g.timeout=4e3,g.ontimeout=function(n){PutToDebugLog(2,"ERROR, DomainToIp: Timeout"),t(""),o(e,"ERROR, DomainToIp: Timeout")},g.send()}catch(d){
PutToDebugLogException(2,"common: DomainToIp",d),t("DomainToIp failed")}}function HandleSipProtocol(e){try{if(isNull(e)||e.length<1)return e;if(0!==e.indexOf("REGISTER sip:")&&0!==e.indexOf("INVITE sip"))return e;var t=GetParameterInt("sipprotocol",0);if(0===t)return e;var o=e;if(1===t)return o=ReplaceAll(o,"sips:","sip:"),o=ReplaceAll(o,"WSS","WS"),o=ReplaceAll(o,"wss","ws");if(2===t)return o=ReplaceAll(o,"sip:","sips:"),o=ReplaceAll(o,"WS","WSS"),o=ReplaceAll(o,"ws","wss")}catch(n){PutToDebugLogException(2,"common: HandleSipProtocol",n)}return e}function HandleOptions(e){try{if(isNull(e)||e.length<1||e.indexOf("OPTIONS sip")<0)return!1;var t=e,o=GetSipHeaderFromMsg(t,"accept");isNull(o)&&(o=""),o=o.toLowerCase();var n="\r\n";t.indexOf("\r\n")<0&&t.indexOf("\n")>=0&&(n="\n"),t=t.substring(t.indexOf(n)+n.length);var i="SIP/2.0 200 OK"+n+t,r="<sip:"+GetSipusername()+"@"+wpa.webrtcapi.GetUDPServerAddress()+">";if(i=i.indexOf("Contact:")>0?RewriteSipHeaderInMsg(i,"Contact",r):i+"Contact: "+r+n,i=i.indexOf("User-Agent:")>0?RewriteSipHeaderInMsg(i,"User-Agent","MWWRTC "+global.versionstr):i+"User-Agent: MWWRTC "+global.versionstr+n,o.indexOf("application")>=0&&o.indexOf("sdp")>=0){i.indexOf("Content-Length:")<0&&(i=i+"Content-Length: 0"+n),i+=n;var a="",s=GetParameter("codec");if(isNull(s)||s.length<1||"-1"==s)a="v=0"+n+"m=audio 80 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 126"+n+"a=mid:0"+n+"a=sendrecv"+n+"a=rtcp-mux"+n+"a=rtpmap:111 opus/48000/2"+n+"a=rtcp-fb:111 transport-cc"+n+"a=fmtp:111 minptime=10;useinband"+n+"a=rtpmap:103 ISAC/16000"+n+"a=rtpmap:104 ISAC/32000"+n+"a=rtpmap:9 G722/8000"+n+"a=rtpmap:0 PCMU/8000"+n+"a=rtpmap:8 PCMA/8000"+n+"a=rtpmap:106 CN/32000"+n+"a=rtpmap:105 CN/16000"+n+"a=rtpmap:13 CN/8000"+n+"a=rtpmap:126 telephone-event/8000"+n;else{var l="m=audio 80 UDP/TLS/RTP/SAVPF";a="a=mid:0"+n+"a=sendrecv"+n+"a=rtcp-mux"+n;var c=s.split(",");(c.indexOf("10")>=0||c.indexOf("11")>=0||c.indexOf("13")>=0)&&(l+=" 111",a=a+"a=rtpmap:111 opus/48000/2"+n+"a=rtcp-fb:111 transport-cc"+n+"a=fmtp:111 minptime=10;useinband"+n),l+=" 103 104 9",a=a+"a=rtpmap:103 ISAC/16000"+n+"a=rtpmap:104 ISAC/32000"+n+"a=rtpmap:9 G722/8000"+n,c.indexOf("1")>=0&&(l+=" 0",a=a+"a=rtpmap:0 PCMU/8000"+n),c.indexOf("2")>=0&&(l+=" 8",a=a+"a=rtpmap:8 PCMA/8000"+n),l+=" 106 105 13 126",a=a+"a=rtpmap:106 CN/32000"+n+"a=rtpmap:105 CN/16000"+n+"a=rtpmap:13 CN/8000"+n+"a=rtpmap:126 telephone-event/8000"+n,a="v=0"+n+l+n+a}i=i+n+a,i=RewriteSipHeaderInMsg(i,"Content-Length",a.length)}else i=i.indexOf("Accept:")>0?RewriteSipHeaderInMsg(i,"Accept","application/sdp,application/dtmf-relay,text/plain"):i+"Accept: application/sdp,application/dtmf-relay,text/plain"+n,i=i.indexOf("Content-Length:")>0?RewriteSipHeaderInMsg(i,"Content-Length","0"):i+"Content-Length: 0"+n;return common.PutToDebugLog(3,"EVENT, HandleOptions OPTIONS sip handled manually: EVENT, SEND: \r\n"+i),webphone_api.webrtc_socket.send(i),!0}catch(u){PutToDebugLogException(2,"common: HandleOptions",u)}return!1}function HandleEdgeSdpIP(e){try{if(isNull(e)||e.length<1)return e;if("Edge"!==GetBrowser())return e;if(0!==e.indexOf("INVITE sip"))return e;var t=e,o=t.indexOf("a=candidate:");if(o<0)return e;var n=t.substring(o+12);if(n=n.substring(0,n.indexOf("\r\n")),isNull(n)||n.length<1)return e;var i="";if(o=n.lastIndexOf("."),o>0&&(i=n.substring(o),n=n.substring(0,o+4),o=n.lastIndexOf(" "),o>n.length-6&&(n=n.substring(0,o)),n=Trim(n),o=n.lastIndexOf(" "),o>0&&(n=n.substring(o+1)),isNull(i)&&(i=""),i=Trim(i),o=i.indexOf(" "),o>0&&(i=i.substring(o+1)),o=i.indexOf(" "),o>0&&(i=i.substring(0,o),!isNull(i)&&IsNumber(i)||(i="")),n=Trim(n),i=Trim(i)),isNull(n)||n.length<1||!IsIPAddrress(n))return e;if((o=t.indexOf("c="))<1)return e;var r=t.substring(0,o);t=t.substring(o),o=t.indexOf("\r\n");var a=t.substring(0,o+2);t=t.substring(o+2);var s=a.replace("127.0.0.1",n);if(s=s.replace("127.0.0.0",n),t=r+s+t,a=a.replace("\r\n",""),s=s.replace("\r\n",""),PutToDebugLog(2,"EVENT, HandleEdgeSdpIP IP addres rewritten in SDP, orig header: "+a+"; rewritten to: "+s),isNull(i)||i.length<1||!IsNumber(i))return t;if((o=t.indexOf("m=audio"))<1)return t;e=t,r=t.substring(0,o+7),t=t.substring(o+7),t=Trim(t),o=t.indexOf(" ");var l=t.substring(0,o);return t=t.substring(o),(isNull(l)&&(l=""),l=Trim(l),l.length<1||!IsNumber(l))?e:t=r+" "+i+t}catch(c){PutToDebugLogException(2,"common: HandleEdgeSdpIP",c)}return e}function HandleIncomingSIPSignaling(e){try{if(isNull(e)||e.length<1)return e;var t=HandleAmidHeader(e);return t=HandleSpecialCharsInHeaders(t)}catch(o){PutToDebugLogException(2,"common: HandleIncomingSIPSignaling",o)}return e}function HandleSpecialCharsInHeaders(e){try{var t=e,o=t.indexOf("\r\n\r\n"),n=-1,i="";o>0&&(i=t.substring(o),t=t.substring(0,o)),isNull(i)&&(i="");var r=t.split("\r\n");if(isNull(r)||r.length<1)return e;t="";for(var a=0;a<r.length;a++){if(isNull(r[a])&&(r[a]=""),o=r[a].indexOf('"'),n=r[a].lastIndexOf('"'),o>=0&&n>0&&o<n){var s=r[a].substring(o+1,n),l=RemoveSpecialCharaters(s);s!==l&&(PutToDebugLog(2,"EVENT, HandleSpecialCharsInHeaders, rewrite special charaters in header: "+r[a]+"; to: "+l+" because containes invalid charaters"),r[a]=r[a].replace(s,l),(r[a].indexOf("From:")>=0||r[a].indexOf("Contact:")>=0)&&(global.sipunicoderewritefrom=s,global.sipunicoderewriteto=l))}t.length>0&&(t+="\r\n"),t+=r[a]}if(!isNull(t)&&t.length>10)return t+i}catch(c){PutToDebugLogException(2,"common: HandleSpecialCharsInHeaders",c)}return e}function RemoveSpecialCharaters(e){try{if(isNull(e)||e.length<1)return e;for(var t="",o=0;o<e.length;o++)e.charCodeAt(o)>31&&e.charCodeAt(o)<255&&(t+=e.charAt(o));return t}catch(n){PutToDebugLogException(2,"common: RemoveSpecialCharaters",n)}return e}function HandleAmidHeader(e,t){try{if("Firefox"!==GetBrowser())return e;var o=e,n=o.indexOf("INVITE sip");if((n>=0&&n<20||!1===t)&&(n=o.indexOf("a=mid:"))<1)if((n=o.indexOf("m=audio"))>0){var i=o.substring(0,n);o=o.substring(n),n=o.indexOf("\r\n");o=i+o.substring(0,n+2)+"a=mid:1\r\n"+o.substring(n+2),o=RecalculateContentLength(o)}else if((n=o.indexOf("m=video"))>0){var i=o.substring(0,n);o=o.substring(n),n=o.indexOf("\r\n"),o=i+o.substring(0,n+2)+"a=mid:2\r\n"+o.substring(n+2),o=RecalculateContentLength(o)}return o}catch(r){PutToDebugLogException(2,"common: HandleAmidHeader",r)}return e}function FixContentLength(e){try{if(isNull(e)||e.length<1)return e;var t=e,o=t.indexOf("Call-ID:");if(o>0){var n=Trim(t.substring(o+8));n.indexOf("\r\n")>0&&(n=n.substring(0,n.indexOf("\r\n")),!isNull(n)&&n.length>0&&(t=t.substring(0,o)+"X-C-Call-ID: "+n+"\r\n"+t.substring(o)))}if(global.fcmIsEnabled>0&&(o=t.indexOf("REGISTER sip"))>=0&&o<20&&!isNull(global.fcmtoken)&&global.fcmtoken.length>3){if(t.indexOf("X-MPUSH:")<1&&(o=t.indexOf("\r\n\r\n"))>0){var i="w:"+GetFCMPackageName()+":"+fcmclientid;t=t.substring(0,o)+"\r\nX-MPUSH: "+i+t.substring(o),PutToDebugLog("WARNING, X-MPUSH added at register send")}if(t.indexOf("X-PIID:")<1&&(o=t.indexOf("\r\n\r\n"))>0){var r=GetSipusername()+":"+webrtcapi_public.mRealm+":"+GetParameter("password"),a=common.Md5Hash(r);t=t.substring(0,o)+"\r\nX-PIID: "+a+t.substring(o),PutToDebugLog("WARNING, X-PIID added at register send")}}if((o=t.indexOf("INVITE sip"))>=0&&o<20){if(!0===global.add_recall_header&&t.indexOf("X-Autorecall:")<1&&(o=t.indexOf("\r\n\r\n"))>0&&(t=t.substring(0,o)+"\r\nX-Autorecall: yes"+t.substring(o)),!0===global.addauser_header&&t.indexOf("X-AUSR:")<1&&(o=t.indexOf("\r\n\r\n"))>0&&(t=t.substring(0,o)+"\r\nX-AUSR: "+GetSipusername()+t.substring(o),PutToDebugLog("WARNING, Sipusername added at invite send")),t.indexOf("X-Sy.Upperproxy:")<1){var s=GetParameter("proxyaddress");!isNull(s)&&s.length>0&&(o=t.indexOf("\r\n\r\n"))>0&&(t=t.substring(0,o)+"\r\nX-Sy.Upperproxy: "+s+t.substring(o),PutToDebugLog("WARNING, Proxyaddress added at invite send"))}CatchWebrtcSignaling(t,SIP_UNKNOWN)}if(o=t.indexOf("INVITE sip"),o>=0&&(t=t.replace("X-Sy.Uppersrv: rtc.mizu-voip.com:6060\r\n","")),o>=0&&o<20&&t.indexOf("X-Sy.Uppersrv:")<1){var l=GetWebrtcSyUpperHeader("invite send");!isNull(l)&&l.length>0&&(o=t.indexOf("\r\n\r\n"))>0&&(t=t.substring(0,o)+"\r\nX-Sy.Uppersrv: "+l+t.substring(o),PutToDebugLog("WARNING, Upperserver added at invite send"))}if(o=t.indexOf("INVITE sip"),o>=0&&(t=t.replace("X-Sy.Uppersrvd: rtc.mizu-voip.com:6060\r\n","")),o>=0&&o<20){var c=GetWebrtcSyUpperDomainHeader("invite send");!isNull(c)&&c.length>0&&t.indexOf("X-Sy.Uppersrv:")<1&&(o=t.indexOf("\r\n\r\n"))>0&&(t=t.substring(0,o)+"\r\nX-Sy.Uppersrvd: "+c+t.substring(o),PutToDebugLog("WARNING, Upperserver domain added at invite send"))}return t=RecalculateContentLength(t)}catch(u){PutToDebugLogException(2,"common: FixContentLength",u)}return e}function RecalculateContentLength(e){try{if(isNull(e)||e.length<1)return e;var t=e,o=t.indexOf("Content-Length:");if(o<1||t.indexOf("Content-Length: 0")>0)return t;var n=-1,i=-1;if(o>0){var r=t.substring(o+15);if(o=r.indexOf("\r\n"),o>0&&(r=Trim(r.substring(0,o)),isNull(r)||!0!==IsNumber(r)||(n=StrToInt(r))),n>0&&(o=t.indexOf("\r\n\r\n"))>0&&(i=t.length-o-4)!==n)return t=t.replace("Content-Length: "+n,"Content-Length: "+i),t=t.replace("Content-Length:"+n,"Content-Length:"+i)}}catch(a){PutToDebugLogException(2,"common: RecalculateContentLength",a)}return e}function RemoveDuplicateHeaders(e){try{if(isNull(e)||e.length<1)return e;var t=e,o=t.indexOf("REGISTER sip");if(o>=0&&o<20){var n=[];mArr=t.split("\r\n");for(var i=0;i<mArr.length;i++)"undefined"!=typeof mArr[i]&&null!==mArr[i]&&(mArr[i].indexOf(":")<0?n.push(mArr[i]):n.indexOf(mArr[i])<0&&n.push(mArr[i]));if(!isNull(n)&&n.length>0){for(var r="",i=0;i<n.length;i++)i>0?r=r+"\r\n"+n[i]:r+=n[i];return r}}}catch(a){PutToDebugLogException(2,"common: RecalculateContentLength",a)}return e}function GetViaRandomAddress(){try{return!isNull(viarandaddr)&&viarandaddr.length>0?viarandaddr:viarandaddr=RandomStr(12,!1,!0)+".invalid"}catch(e){PutToDebugLogException(2,"common: FixContentLength",e)}return"abcdefg12345.invalid"}function GetPushnotVal(e){var t=GetParameterInt("enablepush",e),o=GetParameterInt("callreceiver",e),n=o;return 1!==o&&-1!==o||(n=0),t>=0&&(n=t),n}function EnableFCM(){try{var e=GetPushnotVal(-1);if(isNull(e)||e<-1)return!1;if(0===e)return!1;if(!1===IsHttps())return!1;if(!1 in navigator)return!1;if(!0===HideSettings("enablepush",stringres.get("sett_display_name_enablepush"),"enablepush",!0))return!1;if(!0===IsLocalServer(!0)||!0===IsLocalUpperServer())return!1;if(1===e||2===e||3===e)return!0;if(-1===e){if(global.recwsload>1)return PutToDebugLog(2,"WARNING, EnableFCM returned false, because wsload server load is to high: "+global.recwsload),!1;var t=GetParameterInt("lastincalltime",0),o=GetParameterInt("appinstalltime",0);o<1&&SaveParameter("appinstalltime",GetTickCount().toString());var n=GetTickCount(),i=!1;o>0&&n-o<7776e6&&(i=!0);var r=!1;if(t>0&&n-t<7776e6&&(r=!0),"undefined"!=typeof webphone_api.config&&null!==webphone_api.config&&"undefined"!=typeof webphone_api.config.apiKey&&null!==webphone_api.config.apiKey&&webphone_api.config.apiKey.length>3&&(!0===i||!0===r))return!0}}catch(a){PutToDebugLogException(2,"common EnableFCM",a)}return!1}function StartFCM(en){try{if(!1===EnableFCM())return;if(PutToDebugLog(4,"EVENT, exec StartFCM ("+en+")"),"undefined"==typeof firebase||null===firebase)return PutToDebugLog(2,"ERROR, exec StartFCM firebase scripts were not loaded(firebase.js, firebase-app.js, firebase-messaging.js)"),void console.log(2,"ERROR, exec StartFCM firebase scripts were not loaded(firebase.js, firebase-app.js, firebase-messaging.js)");if("undefined"==typeof webphone_api.config||null===webphone_api.config||"undefined"==typeof webphone_api.config.apiKey||null===webphone_api.config.apiKey||webphone_api.config.apiKey.length<3)return void PutToDebugLog(2,"ERROR, exec StartFCM firebase config is not set in webphone_api.js");global.fcmstate=0,firebase.apps.length||firebase.initializeApp(webphone_api.config);var messaging=firebase.messaging();eval('messaging.requestPermission().then(function () { global.fcmstate = 1; console.log("Notification permission granted"); return messaging.getToken(); }).then(function (token){if (isNull(token) || token.length < 3) { PutToDebugLog(2, "ERROR, FCM received token is INVALID: " + token); return; }global.fcmstate = 2; global.fcmtoken = token; PutToDebugLog(4, "EVENT, FCM received token: " + global.fcmtoken); FCMSetToken();}).catch(function (err){if (global.fcmstate === 0) { PutToDebugLog(2, "ERROR, StartFCM user denied permission to show notifications"); ShowToast(stringres.get("fcm_perm_message"));}else { PutToDebugLog(2, "ERROR, exec StartFCM failed to get FCM token"); }});messaging.onMessage(function (payload){if (isNull(payload)) { payload = \'\'; } var data = \'\';try{ data = JSON.stringify(payload); }catch (ein) { data = payload.toString(); } PutToDebugLog(2, "EVENT, FCM onMessage: " + data);});messaging.onTokenRefresh(function() {messaging.getToken().then(function(refreshedToken) {if (isNull(refreshedToken) || refreshedToken.length < 3) { PutToDebugLog(2, "ERROR, FCM received refreshed token is INVALID: " + refreshedToken); return; }global.fcmstate = 2; global.fcmtoken = refreshedToken; PutToDebugLog(4, "EVENT, FCM received refreshed token: " + global.fcmtoken); FCMSetToken();}).catch(function (err) { PutToDebugLogException(2, "ERROR, FCM onTokenRefresh Unable to retrieve refreshed token", err); });});')}catch(e){PutToDebugLogException(2,"common StartFCM",e)}}function FCMSetToken(){try{var e=GetParameterInt("enablefcm",-1);if(e<1&&(e=1),getuseengine()===global.ENGINE_WEBRTC)global.fcmIsEnabled=1,webrtcapi_public.SetPushNotifications(e,global.fcmtoken,"","");else if(!0===IsWindowsSoftphone()||getuseengine()===global.ENGINE_SERVICE)global.fcmIsEnabled=1,WinAPI("API_SetPushNotifications",null,e,global.fcmtoken,"","");else{if(getuseengine()!==global.ENGINE_WEBPHONE)return void PutToDebugLog(2,"WARNING, FCM FCMSetToken push notifications are not supported by engine: "+getuseengine());global.fcmIsEnabled=1,wpa.webphone.SetPushNotifications(e,global.fcmtoken,"","")}PutToDebugLog(2,"EVENT, FCM FCMSetToken push notifications are ENABLED: "+getuseengine())}catch(t){PutToDebugLogException(2,"common FCMSetToken",t)}}function UserExists(e){try{if(isNull(e))return!0;if(e=e.toLowerCase(),e=Trim(e),e.length<1)return!0;if(e===GetSipusername().toLowerCase())return!0;if(!isNull(global.sipaccounts))for(var t=0;t<global.sipaccounts.length;t++)if(!isNull(global.sipaccounts[t].username)&&global.sipaccounts[t].username.toLowerCase()===e)return!0;return!1}catch(o){PutToDebugLogException(2,"common UserExists",o)}return!0}function GetSipusername(){var e="";try{e=GetParameter("sipusername"),(isNull(e)||e.length<1)&&(e=GetParameter("username")),isNull(e)&&(e="")}catch(t){PutToDebugLogException(2,"common GetSipusername",t)}return e}function GetCallerid(){var e="";try{e=GetParameter("username"),(isNull(e)||e.length<1)&&(e=GetParameter("sipusername"))}catch(t){PutToDebugLogException(2,"common GetCallerid",t)}return e}function HandleCallerID(){try{var e=GetParameter("previous_sipusername"),t=GetParameter("previous_username");!isNull(e)&&e.length>0&&e!==GetParameter("sipusername")&&!isNull(t)&&t.length>0&&t===GetParameter("username")&&GetParameter("username")!==GetParameter("sipusername")&&(PutToDebugLog(2,"EVENT, HandleCallerID: callerID is reset; old callerid: "+t),SaveParameter("username","")),SaveParameter("previous_username",GetParameter("username")),SaveParameter("previous_sipusername",GetParameter("sipusername"))}catch(o){common.PutToDebugLogException(2,"common: HandleCallerID",o)}}function GetFCMPackageName(){try{var e=GetParameter("packagename");if(!isNull(e)&&Trim(e).length>0)return e}catch(t){PutToDebugLogException(2,"common GetFCMPackageName",t)}return"com.mizuvoip.mizudroid.app"}function UniqueArray(e){try{if(isNull(e)||e.length<1)return e;for(var t=e,o=0,n=t.length+10,i=0;o<t.length;){if(++i>n)return e;var r=t.indexOf(t[o]);r>=0&&r<o?t.splice(o,1):o++}return t}catch(a){PutToDebugLogException(2,"common UniqueArray",a)}return e}function IsWebphoneInIframe(){try{return window.self!==window.top}catch(e){return!0}}function GetParentIframeUrl(){var e="";try{if(!1===IsWebphoneInIframe())return"";e=document.referrer}catch(t){try{e=window.parent.location}catch(o){e="ERROR, cannot get iframe parent location"}}return isNull(e)&&(e=""),e}function IsCExt(){try{if(iscallerextension>=0)return iscallerextension;var e=window.location.href;void 0!==e&&null!==e||(e=""),e=e.toLowerCase();var t=[];t.push("c"),t.push("a"),t.push("l"),t.push("l"),t.push("e"),t.push("r"),t.push("e"),t.push("x"),t.push("t"),t.push("e"),t.push("n"),t.push("s"),t.push("i"),t.push("o"),t.push("n"),t.push("="),t.push("3"),t.push("4"),t.push("5");var o=t.join("");return iscallerextension=e.indexOf(o)>0?1:0}catch(n){PutToDebugLogException(2,"common IsCExt",n)}return 0}function GetUA(){try{return"MWWRTC "+global.versionstr}catch(e){PutToDebugLogException(2,"common GetUA",e)}return"MWWRTC 1.0"}function StripXML(e){try{if(isNull(e)||e.length<1)return"";var t=Trim(e),o=t.indexOf("<"),n=t.indexOf(">");if(o>=0&&n>=0&&o<n)for(var i=0;o>=0&&n>=0&&o<n&&i<100;)i++,t=t.substring(0,o)+t.substring(n+1),o=t.indexOf("<"),n=t.indexOf(">");return t}catch(r){PutToDebugLogException(2,"common GetUA",r)}return e}function DisplayStartPage(e){try{var t=GetParameter("startpage_url");isNull(t)&&(t="");var o=GetParameter("startpage_text");if(isNull(o)&&(o=""),t.length<2&&o.length<5)return;var n=GetParameter("startpage_title");isNull(n)&&(n="");var i=GetParameterInt("startpage_type",0);if(t.length>0){var r=t.indexOf("stitle=");if(r>0){var a=t.substring(r+7);r=a.indexOf("&"),r>0&&(a=a.substring(0,r)),!isNull(a)&&a.length>0&&(n=a)}if((r=t.indexOf("stype="))>0){var s=t.substring(r+6);r=s.indexOf("&"),r>0&&(s=s.substring(0,r)),!isNull(s)&&s.length>0&&IsNumber(s)&&(i=StrToIntDef(s,0))}}var l=GetParameterInt("startpage_disp_count",0);if(i<2&&l>0)return;if(2==i&&l>0&&"Settings"===e)return;global.intentstartpage[0]="url="+t,global.intentstartpage[1]="lastpage="+j$.mobile.activePage.attr("id"),global.intentstartpage[2]="title="+n,global.intentstartpage[3]="text="+o,global.intentstartpage[4]="type="+i.toString(),j$.mobile.changePage("#page_startpage",{transition:"pop",role:"page"})}catch(c){PutToDebugLogException(2,"common DisplayStartPage",c)}}function ParseQRcode(e){try{if(isNull(e)||Trim(e).lenght<1||e.indexOf(":")<1)return void PutToDebugLog(2,"ERROR, ParseQRcode invalid QRcode: "+e);if(e=ReplaceAll(e,"{",""),e=ReplaceAll(e,"}",""),e=ReplaceAll(e,'"',""),e.indexOf("ERROR")>=0)return e=e.replace("ERROR,",""),e=e.replace("ERROR",""),PutToDebugLog(2,"ERROR, ParseQRcode returned error (show toast to user): "+e),void ShowToast(e);for(var t=e.split(","),o=0;o<t.length;o++)if(!isNull(t[o])){var n=t[o].indexOf(":");if(!(n<1)){var i=t[o].substring(0,n),r=t[o].substring(n+1);if(!(isNull(i)||Trim(i).length<1||isNull(r))){i=Trim(i),r=Trim(r),SaveParameter("QRCODE_"+i,r);var a="";switch(i){case"user":a="sipusername";break;case"server":a="serveraddress_user";break;case"proxy":a="proxyaddress";break;default:a=i}!isNull(a)&&a.length>0&&(PutToDebugLog(5,"ParseQRcode SaveParameter: "+a+"="+r),SaveParameter(a,r)),a=""}}}ShowToast(stringres.get("barcode_success")),setTimeout(function(){try{GetSipusername().length>0&&GetParameter("password").length>0&&"page_settings"!==j$.mobile.activePage.attr("id")&&(PutToDebugLog(5,"ParseQRcode autologin because we have received login details"),plhandler.LoginSkin())}catch(e){PutToDebugLogException(2,"ParseQRcode timer inner run",e)}},3e3)}catch(s){PutToDebugLogException(2,"common ParseQRcode",s)}}function GetSrvVersions(){try{if(!0===IsMacLin()||IsWinMacLinNsTest())return;var e=GetTickCount();if(srvVersionMaxLoop>1&&e-srvVersionLastExec<5e3)return;srvVersionMaxLoop++,srvVersionLastExec=e,WinAPI("API_GetExeVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:",""),e=Trim(e),SaveParameter("srv_exe_version",e))}),setTimeout(function(){WinAPI("API_GetVersion",function(e){!isNull(e)&&e.length>0&&e.toLowerCase().indexOf("error")<0&&(e=e.replace("OK:"),e=Trim(e),SaveParameter("srv_java_version",e))})},500)}catch(t){PutToDebugLogException(2,"common GetSrvVersions",t)}}function IsWinMacLinNsTest(){try{if("undefined"!=typeof webphone_api.parameters.winlinmacnsengine){if(!0===webphone_api.parameters.winlinmacnsengine||"true"===webphone_api.parameters.winlinmacnsengine)return!0;if(!1===webphone_api.parameters.winlinmacnsengine||"false"===webphone_api.parameters.winlinmacnsengine)return!1}}catch(e){PutToDebugLogException(2,"common IsWinMacLinNsTest",e)}return global.winlinmacnsengine}function IsMacLin(){try{return isNull(ismaclin_cached)?ismaclin_cached="Mac"===GetOs()||"Linux"===GetOs():ismaclin_cached}catch(e){PutToDebugLogException(2,"common IsMacLin",e)}return!1}function NSMacLinEnabled(){try{if(!isNull(maclinenabled_cached))return maclinenabled_cached;if("undefined"==typeof webphone_api.parameters.linmacnsengine||!0!==webphone_api.parameters.linmacnsengine&&!1!==webphone_api.parameters.linmacnsengine||(global.linmacnsengine=webphone_api.parameters.linmacnsengine),!0===global.linmacnsengine&&!0===IsMacLin())return maclinenabled_cached=!0;if(!0===IsWinMacLinNsTest()&&(!0===IsMacLin()||"Windows"===GetOs()))return maclinenabled_cached=!0}catch(e){PutToDebugLogException(2,"common NSMacLinEnabled",e)}return!1}function TestNSPolling(){try{return null!==flag_testnspolling_cached?flag_testnspolling_cached:flag_testnspolling_cached="undefined"!=typeof webphone_api.parameters.flag_testnspolling&&!0===webphone_api.parameters.flag_testnspolling}catch(e){PutToDebugLogException(2,"common TestNSPolling",e)}return!1}function GetAudioRecList(){return!isNull(global.audio_rec_device_list)&&global.audio_rec_device_list.length>0?global.audio_rec_device_list:GetParameter("cache_audio_rec_device_list")}function GetAudioPlayList(){return!isNull(global.audio_play_device_list)&&global.audio_play_device_list.length>0?global.audio_play_device_list:GetParameter("cache_audio_play_device_list")}function GetAudioRingList(){return!isNull(global.audio_ring_device_list)&&global.audio_ring_device_list.length>0?global.audio_ring_device_list:GetParameter("cache_audio_ring_device_list")}function GetVideoRecList(){return!isNull(global.video_rec_device_list)&&global.video_rec_device_list.length>0?global.video_rec_device_list:GetParameter("cache_video_rec_device_list")}function GetAudioRecDev(){return!isNull(global.audio_rec_curr_device)&&global.audio_rec_curr_device.length>0?global.audio_rec_curr_device:GetParameter("cache_audio_rec_curr_device")}function GetAudioPlayDev(){return!isNull(global.audio_play_curr_device)&&global.audio_play_curr_device.length>0?global.audio_play_curr_device:GetParameter("cache_audio_play_curr_device")}function GetAudioRingDev(){return!isNull(global.audio_ring_curr_device)&&global.audio_ring_curr_device.length>0?global.audio_ring_curr_device:GetParameter("cache_audio_ring_curr_device")}function GetVideoRecDev(){return!isNull(global.video_rec_curr_device)&&global.video_rec_curr_device.length>0?global.video_rec_curr_device:GetParameter("cache_video_rec_curr_device")}function NuIsWebPage(){try{if(!common.isNull(global.nuiswebpage))return global.nuiswebpage;var e=common.GetParameter("newuser");return common.isNull(e)&&(e=""),e=common.Trim(e),0===e.indexOf("*")?global.nuiswebpage=!1:global.nuiswebpage=!0,global.nuiswebpage}catch(t){common.PutToDebugLogException(2,"common: NuIsWebPage",t)}return!1}function GetMinSrvBuildValue(){try{var e=GetParameterInt("minimumservicebuild",-1);if(e>global.minimumservicebuild)return e}catch(t){common.PutToDebugLogException(2,"common: GetMinSrvBuildValue",t)}return global.minimumservicebuild}function HandleServiceBuildUpgrade(){GetMinSrvBuildValue()<1||WinAPI("API_GetBuildNumber",function(e){try{if(!isNull(e)&&IsNumber(e)){var t=StrToIntDef(e,0),o=GetMinSrvBuildValue();if(o>0&&t<o){GetParameterInt("cancelonnsdownload",0)<e&&(HasUsableEngineFromEngines(GetEngine("ns"),["java","ns","webrtc"])?(EngineForcedInstall("ns",stringres.get("service_update"),!0,function(e){isNull(e)||"cancel"!==e||SaveParameter("cancelonnsdownload",GetMinSrvBuildValue())}),global.nsupdatepending=!0):(EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0))}}}catch(n){common.PutToDebugLogException(2,"common: HandleServiceBuildUpgrade()",n)}})}function ExecFunction(e){try{if(isNull(e)||e.length<1)return;var t=e,o="",n=t.indexOf("(");n>0&&(o=t.substring(n+1),t=Trim(t.substring(0,n))),isNull(o)&&(o=""),o=o.replace(")",""),o=Trim(o),t=t.replace("webphone_api.",""),t=Trim(t);var r=[];if(o.length>0){r=o.split(","),isNull(r)&&(r=[]);for(var a=0,s=0;a<r.length&&s<200;)isNull(r[a])?r.splice(i,1):a++,s++}isNull(r)&&(r=[]),PutToDebugLog(3,"EVENT, ExecFunction: "+t+"("+o+")");var e=window.webphone_api[t];if("function"!=typeof e)return void PutToDebugLog(3,"ERROR, ExecFunction fn is NOT a function");e.apply(window,r)}catch(l){common.PutToDebugLogException(2,"common: ExecFunction: "+e,l)}}function StartAppEngine(e,t,o,n){function i(e,t,o){try{global.isappenginestarted=!0,!isNull(e)&&e.length>0&&PutToDebugLog(2,e),0===GetAppEnProtocol(t).indexOf("webphone:")&&UploadAutoprov(),HandleProtocol(GetAppEnProtocol(t)+o)}catch(n){common.PutToDebugLogException(2,"common: StartAE",n)}}try{var r="";if(void 0!==o&&null!==o||(o=!1),void 0!==n&&null!==n&&n.length>0&&(r=Trim(n)),!0!==e||!0!==global.usestorage&&!common.Strl(90))i(t,o,r);else{var a=GetParameterInt("enginepriority_webrtc",2),s=GetParameterInt("enginepriority_app",2),l=GetParameterInt("enginepriority_p2p",2),c=GetParameterInt("enginepriority_accessnum",2);s>=5&&a<5&&l<5&&c<5||s>=2&&a<s&&l<s&&c<s||AlertDialog(stringres.get("warning"),stringres.get("app_en_message")),setTimeout(function(){if(!1===IsSDK()){var e=j$.mobile.activePage.find(".messagePopup");!common.isNull(e)&&e.length>0&&!0!==global.dontclosecurrpopup&&j$.mobile.activePage.find(".messagePopup").popup("close").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove()}})}},8500),!0===o?i(t,o,r):setTimeout(function(){i(t,o,r)},9e3)}}catch(u){common.PutToDebugLogException(2,"common: StartAppEngine",u)}}function GetUrlParamVal(e,t){try{if(isNull(t)||Trim(t).length<1||isNull(e)||e.indexOf(t)<0)return"";t=Trim(t),t.indexOf("=")<1&&(t+="=");var o=e.indexOf(t);if(o>=0)return e=e.substring(o+t.length),o=e.indexOf("&"),o>0&&(e=e.substring(0,o)),o=e.indexOf("#"),o>0&&(e=e.substring(0,o)),isNull(e)?"":Trim(e)}catch(n){PutToDebugLogException(2,"common: GetUrlParamVal",n)}return""}function GetJsonParamVal(e,t){try{if(isNull(e)||e.length<1||isnull(t)||t.length<1)return"";t=Trim(t),t=t.toLowerCase(),t.indexOf(":")<1&&(t+=":"),e=ReplaceAll(e,'"',"");var o="",n=e.toLowerCase().indexOf(t);if(n>=0&&(o=e.substring(n+t.length),n=o.indexOf(","),n>0&&(o=o.substring(0,n)),n=o.indexOf("}"),n>0&&(o=o.substring(0,n)),n=o.indexOf("\n"),n>0&&(o=o.substring(0,n)),!isNull(o)))return Trim(o)}catch(i){PutToDebugLogException(2,"common: GetJsonParamVal",i)}return""}function HandleNewUserResult(e,t){try{if(!NuIsWebPage())return;if(void 0!==t&&null!==t&&t.getElementsByTagName){var o=t.getElementsByTagName("INPUT");if(!isNull(o)&&o.length>0){var n=[];n.push("s"),n.push("e"),n.push("r"),n.push("v"),n.push("e"),n.push("r"),n.push("a"),n.push("d"),n.push("d"),n.push("r"),n.push("e"),n.push("s"),n.push("s");for(var i=n.join(""),r=0;r>o.length;r++)if(!isNull(o[r])&&"hidden"===o[r].type){var a=o[r].id;if(!isNull(a)&&0===a.indexOf("wp_")){a=a.substring(3);var s=o[r].value;isNull(s)||a!==i&&0!==Trim(a).indexOf(i)&&(PutToDebugLog(2,"_settings: Newuser found input setting parameter: "+a+" = "+s),SaveParameter(a,s))}}}}if(isNull(e)||e.indexOf("wp_")<2)return;var l=e.split("\n");if(isNull(l)||l.length<1)return;for(var c=0,r=0;r<l.length;r++)if(!(isNull(l[r])||l[r].indexOf("wp_")<0))for(;l[r].indexOf("wp_")>=0&&(c=l[r].lastIndexOf("wp_"))>=0;){var u=l[r].substring(c+3);if(l[r]=l[r].substring(0,c),isNull(u)||u.length<1)break;NUFindSingleParam(u)}}catch(m){PutToDebugLogException(2,"_settings: HandleNewUserResult",m)}}function NUFindSingleParam(e){try{if(isNull(e)||e.length<3)return;var t="",o="",n=e.indexOf(":");if(n>0)t=e.substring(0,n),o=e.substring(n+1),(n=t.indexOf("="))>0&&(o=t.substring(n+1),t=t.substring(0,n));else{var n=e.indexOf("=");n>0&&(t=e.substring(0,n-1),o=e.substring(0))}isNull(t)&&(t=""),isNull(o)&&(o=""),t=t.toLowerCase(),t=Trim(t),o=Trim(o);var i=[];i.push("s"),i.push("e"),i.push("r"),i.push("v"),i.push("e"),i.push("r"),i.push("a"),i.push("d"),i.push("d"),i.push("r"),i.push("e"),i.push("s"),i.push("s");var r=i.join("");if(t===r||0===Trim(t).indexOf(r))return;n=o.indexOf("}"),n>0&&(o=o.substring(0,n)),n=o.indexOf("]"),n>0&&(o=o.substring(0,n)),n=o.indexOf(";"),n>0&&(o=o.substring(0,n)),n=o.indexOf(","),n>0&&(o=o.substring(0,n)),o=ReplaceAll(o,"'",""),o=ReplaceAll(o,'"',""),t.length>0&&(PutToDebugLog(2,"_settings: Newuser found setting parameter: "+t+" = "+o),"username"===t&&(t="sipusername"),SaveParameter(t,o),"signup_display"===t&&o.length>0&&(PutToDebugLog(2,"EVENT, NewUserSignup display message: "+o),ShowToast(o)))}catch(a){PutToDebugLogException(2,"common: NUFindSingleParam",a)}}function GetPreferredStorage(){try{return null!==prefstorage_cached?prefstorage_cached:prefstorage_cached="undefined"!=typeof webphone_api&&null!==webphone_api&&"undefined"!=typeof webphone_api.parameters&&null!==webphone_api.parameters&&"undefined"!=typeof webphone_api.parameters.preferred_storage&&null!==webphone_api.parameters.preferred_storage&&common.IsNumber(webphone_api.parameters.preferred_storage)?common.StrToIntDef(webphone_api.parameters.preferred_storage,-1):!isNull(GetConfig("preferred_storage"))&&GetConfig("preferred_storage").length>0?GetConfigInt("preferred_storage",-1):-1}catch(e){common.PutToDebugLogException(2,"common: GetPreferredStorage",e)}return-1}function PrintCallSessions(){if(isNull(global.ep)||global.ep.length<1)return void PutToDebugLog(2,"ERROR,no callsessions to print");for(var e=0;e<global.ep.length;e++){var t=global.ep[e];PutToDebugLog(4,"EVENT, common: PSaveCallSession endpoint updated, line: "+t[EP_LINE]+"; destnr: "+t[EP_DESTNR]+"; isincoming: "+t[EP_INCOMING]+"; callid: "+t[EP_CALLID]+"; setuptime: "+t[EP_SETUPTIME]+"; connecttime: "+t[EP_CONNECTTIME]+"; disctime: "+t[EP_DISCONNECTTIME]+"; setupsent: "+t[EP_SETUPSENT]+"; finishedsent: "+t[EP_FINISHEDSENT]+"; mutestate: "+t[EP_MUTESTATE]+"; holdstate: "+t[EP_HOLDSTATE])}}var settmap={},settmap2={},CONST_DEVICE_WEBPHONE="0",CONST_DEVICE_WIN_SOFTPHONE="1",CONST_DEVICE_ANDROID="2",CONST_DEVICE_IPHONE="3",CONST_DEVICE_BB="4",CONST_DEVICE_WP="5",MIN_USR_PWD_LENGHT=3;global.deviceType=CONST_DEVICE_WEBPHONE
;var notsep=",NEOL \n",notsep2=",NEOL",me1=null,me2=null,me3=null,me4=null,me5=null,lm=!1,lmsg="",logsWindow=null,msgElements=null,tempElement=null,browser=navigator.userAgent.toLowerCase(),ismsie=browser.indexOf("msie")>0||browser.indexOf("trident")>0,logfirstrun=!0,lastlogmsg="",logcount=0,srvinst_offered=!1,checkloglvl=0,sendlogstoandroid=-1,splevel=0,basicinfologged=!1,isPlatformSet=!1,isWindows=!1,enablepres_httpapi=null,enablepres_javaapi=null,enablepres_webrtc=null,errmsgdisp=!1,pgmaxloop=0,first_presence_req=!0,pgstart_timer=null,startpres_timer=null,spmaxloop=0,lf_isconfigured=!1,isielocal=!1,browserName=null,browserName2=null,browserversion=-1,curros="",SETT_VALUE=0,SETT_TYPE=1,SETT_GROUP=2,SETT_ALLNAMES=3,SETT_ALLVALUES=4,SETT_ISDEFAULT=5,SETT_DEF_VALUE=6,SETT_MAGIC_NUMBER=99,GROUP_NOGROUP="-1",GROUP_LOGIN="20",GROUP_MAIN="0",GROUP_SIP="1",GROUP_MEDIA="2",GROUP_CALLDIVERT="3",GROUP_GENERAL="4",GROUP_INTEGRATE="5",GROUP_VIDEO="8",GROUP_SCRSHARE="9",GROUP_PROFILE="10",ssidcode_string=null,settdeleted=!1,autocall_called=!1,sendchat_called=!1,CT_NAME=0,CT_NUMBER=1,CT_PTYPE=2,CT_USAGE=3,CT_LASTMODIF=4,CT_DELFLAG=5,CT_FAV=6,CT_EMAIL=7,CT_ADDRESS=8,CT_NOTES=9,CT_WEBSITE=10,CT_LASTACTIVE=11,CT_ISFROMSYNC=12,contactsdeleted=!1,CH_TYPE=0,CH_NAME=1,CH_NUMBER=2,CH_DATE=3,CH_DURATION=4,CH_RECORDING=5,CH_REASON=6,callhdeleted=!1,jsonpmaxloop=0,wsapisocket=null,wsapiready=!1,wsapi_method=[],wsapi_data=[],wsapi_cb=[],wsapi_reconnect_address=null,wsa_ever_connected=!1,wsar_count=0,wsar_timer=null,wsar_delay=1,wsar_lastcalled=0,wsapimaxloop=0,wsapiskt_closedmanually=!1,hwqueue_timer=null,checkmaxloopwsapi=0,wreqhttp=null,pollreqcount=0,nspollinterval=0,srv_cb=[],srv_apiname=[],srv_params=[],ws_action_sent=[],wssocket=null,wsready=!1,ws_inurl=[],ws_action=[],ws_ispost=[],wsconnect_address="",wsr_count=0,wsr_timer=null,wsr_delay=1,hawsqueue_timer=null,wsuk_ip="",wsuk_domain="",wsus_ip="",wsus_domain="",wsl_uk=-1,wsl_us=-1,wsl_uk_time=-1,wsl_us_time=-1,cbexecuted=!1,reqtimeout=4500,nread=!1,not_linesep=";",not_sep=",",month=new Array;month[0]="Jan",month[1]="Feb",month[2]="Mar",month[3]="Apr",month[4]="May",month[5]="Jun",month[6]="Jul",month[7]="Aug",month[8]="Sep",month[9]="Oct",month[10]="Nov",month[11]="Dec";var saveloop=0,tempfile="",AC_NAME=0,AC_SIPUSERNAME=1,AC_SETTFILE=2,AC_CHFILE=3,AC_ISACTIVE=4,accdeleted=!1,sessionaccfilename="",lpname="",currprofile=null,enckey="aJ6aqK4Nah3hnP7aht",Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,o,n,i,r,a,s,l="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),o=e.charCodeAt(c++),n=e.charCodeAt(c++),i=t>>2,r=(3&t)<<4|o>>4,a=(15&o)<<2|n>>6,s=63&n,isNaN(o)?a=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(s);return l},decode:function(e){var t,o,n,i,r,a,s,l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)i=this._keyStr.indexOf(e.charAt(c++)),r=this._keyStr.indexOf(e.charAt(c++)),a=this._keyStr.indexOf(e.charAt(c++)),s=this._keyStr.indexOf(e.charAt(c++)),t=i<<2|r>>4,o=(15&r)<<4|a>>2,n=(3&a)<<6|s,l+=String.fromCharCode(t),64!=a&&(l+=String.fromCharCode(o)),64!=s&&(l+=String.fromCharCode(n));return l=Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",o=0,n=c1=c2=0;o<e.length;)n=e.charCodeAt(o),n<128?(t+=String.fromCharCode(n),o++):n>191&&n<224?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),o+=3);return t}},acploop=0,aploop=0,ASCII_ALL=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_NRLOWER=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],ASCII_JUSTLOWERCASE=[97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],sdcalled=!1,sdt=0,alsv="",alsvkey="X9hAm21TaGzqeR45Bj",alsvir1="",alsvir2="",alsvir3="",alsvu1="",alsvu2="",alsvu3="",unlockcodetrick="",unlockcodetricktogled=0,alsww="",alswrt="",malsx1=71,usestoragetry="dcid_aglacQ--",usestoragetrm="dcid_bQ--",usestoragetrd="dcid_ag0-",usestoragetry2="dcid_aglacQ--",usestoragetrm2="dcid_bw--",usestoragetrd2="dcid_agg-",hua="",hsrv="",hsrvx="",fip="dcid_LV0Ye0IdQyACaRcYHycZQy0DKBcLLgAIBGVXdw--",wip_uk="dcid_L0pSbkJARTdPKhMLEH9CWisadloHLEJfVycVMB8TFj1XXg--",wips_uk="dcid_L0obe0IdQyACaRcYHycZQy0DKBcLLgAdXDISMw0UByFbVik-",wip_us="dcid_L0pSbkJHQiYVJAJfEjdWQy0DKEkALgNXHzcOKlUcAyFAQicIK1YLKg--",wips_us="dcid_L0obe0IdRCcTMxkJSyVRVzQFMUkYKQJcVHoCKBdeCDRHQTUPOkoHIgY-",lversion=2,lic_video=2,lic_presence=1,lic_filetransfer=2,lic_conference=2,lic_transfer=1,lic_callrecord=1,lic_opus=2,lic_balancerating=1,lic_screensharing=1,lic_smartphone=1,lic_onlyandroidvideo=0,myLoaCachedvalueFrom=null,days_since_deploy=null,enginep={applet:-1,webrtc:-1,ns:-1,flash:-1},pphe="",wready=!1,wsocket=null,wsocket2=null,srvinstalled_callback=[],lastCheckTick=0,stopPolling=!1,limit=600,pollcount=0,cemodal=null,semaxloop=0,fail_timer=null,gwround=0,cestimer=null,isWebphoneFirstStart=null,paramcache=null,lastcalledtick=0,jinstallmodal=null,npmodal=null,npclosehandled=!1,efmodal=null,redirect_timer=null,clear_timer=null,protocolmaxloop=0,admodal=null,toastmodal=null,lccsenr=0,lctmr=null,lcsexp=!1,selectedwserver="",addrtimer=null,addr_maxloop=0,ADDR_TIMERSTART=0,uk_ip=null,uk_domain=null,us_ip=null,us_domain=null,decide_already_run=!1,wsrvL=[],engines=null,lastengine_started_ok="",lastengine_working_ok="",selected_engine=null,recommend_engine=null,avoidjavapopup=1,avoidflashpopup=1,canresolvedomain=!0,retusewebrtc=null,getsrvsupportcalled=!1,contimer=null,ccmaxloop=0,ws1ok=-2,ws2ok=-2,ws3ok=-2,ws4ok=-2,cic_timer=null,lastnetsucceded=0,lastgood_set=!1,good_succeded=!1,wsconn_timer=null,ils_srv1="",ils_srv2="",ils_srv3="",canshowlickeyinput=null,is_https=null,wsprinted=!1,savectpopup_wasclosed=!0,audiomodal=null,arecL=[],aplayL=[],aringL=[],vrecL=[],wrereg_timer=null,SIP_REGISTER=0,SIP_INVITE_OUT=1,SIP_INVITE_IN=2,SIP_UNKNOWN=9,lastreg="",lastinvite_in="",lastinvite_out="",lastmsg="",displayname="",shcache={},tlsrcalled=!1,wsuserka_lasttick=0,currversionstr=null,icecompleted=!1,ice_callaccepted=!1,ice_timer=null,cachedevid=null,at_addr=[],wsuri_1="",wsuri_2="",wsuri_3="",wsuri_4="",wsuri_5="",wsuri_6="",wsuri_7="",wsuri_8="",wsuri_9="",ws_1=null,ws_2=null,ws_3=null,ws_4=null,ws_5=null,ws_6=null,ws_7=null,ws_8=null;ws_9=null;var gmc=null,jscport="",ddu_lastcalled=-1,ddu_lastload=-1,apikey_cache=null,unregcalledtime=0,voice_wasset=!1,proxy_wasset=!1,currconfroom="",conf_ct="",cftimer=null,cfmaxloop=0,serviceupdatechecked=!1,disableoptions=null,enableoptions=null,webct_cb=[],webct_url=null,reqid_cached=0,telshearchcb=[],sessionid_cache=null,elem_basedir=null,audioElem=null,playdtmfsound=-1,playtimer=null,scurlsp_called=!1,callnotification=null,browserWindowActive=!0,reloadtimer=null,cleartimer=!1,statuslang=null,dtisrvcache=null,dreqsrvcache={},dtistrSrv="",dticache=null,dreqcache={},viarandaddr=null,iscallerextension=-1,srvVersionMaxLoop=0,srvVersionLastExec=0,ismaclin_cached=null,maclinenabled_cached=null,flag_testnspolling_cached=null,prefstorage_cached=null,RC_TYPE=0,RC_NAME=1,RC_NUMBER=2,RC_DATE=3,RC_RANK=4,RC_DURATION=5,F_WHAT=0,F_WITH=1,F_MIN=2,F_MAX=3,EP_LINE=0,EP_SESSION=1,EP_DESTNR=2,EP_INCOMING=3,EP_SETUPTIME=4,EP_CONNECTTIME=5,EP_DISCONNECTTIME=6,EP_REASON=7,EP_CALLID=8,EP_FLAGDEL=9,EP_SETUPSENT=10,EP_FINISHEDSENT=11,EP_SIPHEADERS=12,EP_MUTESTATE=13,EP_HOLDSTATE=14,EP_SIPINVITE=15,EP_SESSID=16,PRES_STATUS=0,PRES_TIME=1,ACC_SERVER=0,ACC_USER=1,ACC_PASSWORD=2,ACC_IVAL=3,ACC_ENABLED=4,ACC_ISMAIN=5,ACC_CALLERID=6,ACC_DISPLAYNAME=7,ACC_PROXY=8,ACC_REALM=9,restartice_time=0,common_public={ReceiveNotifications:ReceiveNotifications,PutToDebugLog:PutToDebugLog,PutToDebugLogException:PutToDebugLogException,PutToDebugLogWarning:PutToDebugLogWarning,Trim:Trim,ApiWinSaveFile:ApiWinSaveFile,ApiWinLoadFile:ApiWinLoadFile,Exit:Exit,OpenLinkInExternalBrowser:OpenLinkInExternalBrowser,OpenLinkInInternalBrowser:OpenLinkInInternalBrowser,EngineSelect:EngineSelect,UserChooseEnginePopup:UserChooseEnginePopup,UserChooseEnginePopupSDK:UserChooseEnginePopupSDK,ChooseEngineLogic:ChooseEngineLogic,AlertDialogSDK:AlertDialogSDK,ShowToastSDK:ShowToastSDK,settmap:settmap,settmap2:settmap2,GetSettFilenameSDK:GetSettFilenameSDK,AppEngineClick:AppEngineClick,LicenseAgreementWindow:LicenseAgreementWindow,CatchWebrtcSignaling:CatchWebrtcSignaling,SentWebrtcSignaling:SentWebrtcSignaling,GetTickCount:GetTickCount,GetMediaConstraints:GetMediaConstraints,GetIceTimeout:GetIceTimeout,ResetIce:ResetIce,Hasesw:Hasesw,Us:Us,Ted:Ted,Te2:Te2,GatewayFailower:GatewayFailower,GetParameterInt:GetParameterInt,SaveParameter:SaveParameter,ArrayBufferToString:ArrayBufferToString,CanIUseVideo:CanIUseVideo,HandleSipProtocol:HandleSipProtocol,HandleEdgeSdpIP:HandleEdgeSdpIP,FixContentLength:FixContentLength,HandleIncomingSIPSignaling:HandleIncomingSIPSignaling,HandleOptions:HandleOptions,HandleAmidHeader:HandleAmidHeader,RandomStr:RandomStr,GetViaRandomAddress:GetViaRandomAddress,IsLocalUpperServer:IsLocalUpperServer,CallWsuserKeepAlive:CallWsuserKeepAlive,RemoveDuplicateHeaders:RemoveDuplicateHeaders,ReplaceAll:ReplaceAll,SIP_REGISTER:SIP_REGISTER,SIP_INVITE_OUT:SIP_INVITE_OUT,SIP_INVITE_IN:SIP_INVITE_IN,SIP_UNKNOWN:SIP_UNKNOWN,icecompleted:!1,ice_callaccepted:!1,ice_timer:null,restartice_time:0};return window.common_public=common_public,{InitializeSettings:InitializeSettings,settmap:settmap,settmap2:settmap2,ParamAsBool:ParamAsBool,ParamAsInt:ParamAsInt,GetParameter2:GetParameter2,GetParameter:GetParameter,SaveParameter:SaveParameter,ParameterIsDefault:ParameterIsDefault,GetParameterInt:GetParameterInt,GetParameterBool:GetParameterBool,GetConfig:GetConfig,GetConfigInt:GetConfigInt,GetConfigBool:GetConfigBool,SaveSettingsFile:SaveSettingsFile,ReadSettingsFile:ReadSettingsFile,HandleSettings:HandleSettings,GetSettingsFromUrl:GetSettingsFromUrl,GetOverWriteSettings:GetOverWriteSettings,SETT_VALUE:SETT_VALUE,SETT_TYPE:SETT_TYPE,SETT_GROUP:SETT_GROUP,SETT_ALLNAMES:SETT_ALLNAMES,SETT_ALLVALUES:SETT_ALLVALUES,SETT_ISDEFAULT:SETT_ISDEFAULT,SETT_DEF_VALUE:SETT_DEF_VALUE,CT_NAME:CT_NAME,CT_NUMBER:CT_NUMBER,CT_PTYPE:CT_PTYPE,CT_USAGE:CT_USAGE,CT_LASTMODIF:CT_LASTMODIF,CT_DELFLAG:CT_DELFLAG,CT_FAV:CT_FAV,CT_EMAIL:CT_EMAIL,CT_ADDRESS:CT_ADDRESS,CT_NOTES:CT_NOTES,CT_WEBSITE:CT_WEBSITE,CT_LASTACTIVE:CT_LASTACTIVE,CT_ISFROMSYNC:CT_ISFROMSYNC,SaveContactsFile:SaveContactsFile,ReadContactsFile:ReadContactsFile,GetContacts:GetContacts,SortContacts:SortContacts,UpdateContactLastActive:UpdateContactLastActive,GetContactIdFromNumber:GetContactIdFromNumber,GetContactNameFromNumber:GetContactNameFromNumber,ContactExists:ContactExists,PickContact:PickContact,PickContactNumber:PickContactNumber,LcAc:LcAc,CH_TYPE:CH_TYPE,CH_NAME:CH_NAME,CH_NUMBER:CH_NUMBER,CH_DATE:CH_DATE,CH_DURATION:CH_DURATION,CH_RECORDING:CH_RECORDING,CH_REASON:CH_REASON,SaveCallhistoryFile:SaveCallhistoryFile,ReadCallhistoryFile:ReadCallhistoryFile,AC_NAME:AC_NAME,AC_SIPUSERNAME:AC_SIPUSERNAME,AC_SETTFILE:AC_SETTFILE,AC_CHFILE:AC_CHFILE,AC_ISACTIVE:AC_ISACTIVE,GetNrOfAcc:GetNrOfAcc,SaveAccountsFile:SaveAccountsFile,ReadAccountsFile:ReadAccountsFile,GetActiveAccount:GetActiveAccount,GetAccountsFilename:GetAccountsFilename,GetActiveAccSettingsFilename:GetActiveAccSettingsFilename,GetActiveAccCallhistoryFilename:GetActiveAccCallhistoryFilename,GetLocationPathName:GetLocationPathName,WinAPI:WinAPI,HttpAsyncHandler:HttpAsyncHandler,ApiWinSaveFile:ApiWinSaveFile,ApiWinLoadFile:ApiWinLoadFile,ApiWinSaveFileNew:ApiWinSaveFileNew,StartMsg:StartMsg,PutToDebugLog:PutToDebugLog,PutToDebugLogException:PutToDebugLogException,PutToDebugLogWarning:PutToDebugLogWarning,PutToDebugLogSpecial:PutToDebugLogSpecial,ReplaceAll:ReplaceAll,Trim:Trim,EscapeRegExp:EscapeRegExp,IsNumber:IsNumber,IsNumeric:IsNumeric,StrToInt:StrToInt,StrToIntDef:StrToIntDef,StrToIntPx:StrToIntPx,StrIsUpperCase:StrIsUpperCase,GetDeviceWidth:GetDeviceWidth,GetDeviceHeight:GetDeviceHeight,IsWindowsSoftphone:IsWindowsSoftphone,DeviceType:DeviceType,DEVICE_WEBPHONE:DEVICE_WEBPHONE,DEVICE_WIN_SOFTPHONE:DEVICE_WIN_SOFTPHONE,DEVICE_ANDROID:DEVICE_ANDROID,DEVICE_IPHONE:DEVICE_IPHONE,DEVICE_BB:DEVICE_BB,DEVICE_WP:DEVICE_WP,isNull:isNull,IsFunction:IsFunction,getBgColor:getBgColor,getElementColor:getElementColor,AlertDialog:AlertDialog,AlertDialogSDK:AlertDialogSDK,ShowToast:ShowToast,ShowToastSDK:ShowToastSDK,UsePresence2:UsePresence2,StartPresence2:StartPresence2,PresenceGet2:PresenceGet2,PresenceSet2:PresenceSet2,SaveReceivedPresence2:SaveReceivedPresence2,PresenceSelector:PresenceSelector,SetSelectedPresence:SetSelectedPresence,HelpWindow:HelpWindow,HoverCalc:HoverCalc,IsIeVersion:IsIeVersion,IsIeLocal:IsIeLocal,GetTickCount:GetTickCount,UpgradeToProVersion:UpgradeToProVersion,OpenSettings:OpenSettings,GetIntentParam:GetIntentParam,NormalizeNumber:NormalizeNumber,NormalizeInput:NormalizeInput,NormalizeInput2:NormalizeInput2,PasswordStringIsValidForServer:PasswordStringIsValidForServer,UsernameStringIsValidForServer:UsernameStringIsValidForServer,OpenWebURL:OpenWebURL,Md5Hash:Md5Hash,UriParser:UriParser,HttpResponseHandler:HttpResponseHandler,PutNotifications:PutNotifications,PutNotifications2:PutNotifications2,ShowNotifications:ShowNotifications,ShowNotifications2:ShowNotifications2,HideCallNotifications:HideCallNotifications,HideMessageNotifications:HideMessageNotifications,HideCallNotifications2:HideCallNotifications2,HideMessageNotifications2:HideMessageNotifications2,HideAllNotifications:HideAllNotifications,NotificationOnClick:NotificationOnClick,NotificationOnClick2:NotificationOnClick2,GetBrowser:GetBrowser,GetBrowserVersion:GetBrowserVersion,Is64BitBrowser:Is64BitBrowser,IsARM:IsARM,GetOs:GetOs,Exit:Exit,CallNumberProtocolHandler:CallNumberProtocolHandler,EnterKeyPress:EnterKeyPress,WinSoftphoneHttpReq:WinSoftphoneHttpReq,bwanswer:bwanswer,Encrypt:Encrypt,Decrypt:Decrypt,StrEc:StrEc,StrDc:StrDc,B64Enc:B64Enc,B64Dec:B64Dec,enckey:"aJ6aqK4Nah3hnP7aht",Base64:Base64,delsettings:delsettings,GetCustomAutoprov:GetCustomAutoprov,UseCustomAutoprov:UseCustomAutoprov,RecAutoprovCustom:RecAutoprovCustom,GetAutoprovisioning:GetAutoprovisioning,ParseAutoprovisioning:ParseAutoprovisioning,UploadAutoprov:UploadAutoprov,RestartPhone:RestartPhone,RandomInt:RandomInt,RandomStr:RandomStr,GetViaRandomAddress:GetViaRandomAddress,ShowModalLoader:ShowModalLoader,HideModalLoader:HideModalLoader,DoVersioning:DoVersioning,ShowServerInput:ShowServerInput,RequestUserServerInput:RequestUserServerInput,GetAllContactsNumbersSipuris:GetAllContactsNumbersSipuris,Te:Te,Te2:Te2,Ted:Ted,Strl:Strl,Awe:Awe,Awre:Awre,Awb:Awb,Awb2:Awb2,onc:onc,GtUc:GtUc,GtUct:GtUct,SetDID:SetDID,CheckDID:CheckDID,GetFp:GetFp,GetWp:GetWp,GetWpS:GetWpS,Loa:Loa,Ch:Ch,Glv:Glv,Glss:Glss,Glsp:Glsp,Glbr:Glbr,Glop:Glop,Glpr:Glpr,Glcr:Glcr,Glcf:Glcf,Glft:Glft,Glvd:Glvd,Glt:Glt,enginep:enginep,GetPassphrase:GetPassphrase,IsServiceInstalled:IsServiceInstalled,ServiceStartPolling:ServiceStartPolling,stopPolling:stopPolling,GetNPLocation:GetNPLocation,NPDownloadAndInstall:NPDownloadAndInstall,EngineForcedInstall:EngineForcedInstall,CanIUseApplet:CanIUseApplet,CanIUseWebRTC:CanIUseWebRTC,CanIUseService:CanIUseService,CanIUseFlash:CanIUseFlash,GetSinglePossibleEngine:GetSinglePossibleEngine,ApplyParameters:ApplyParameters,GetServerForHttpReq:GetServerForHttpReq,GetWebrtcUpperServer:GetWebrtcUpperServer,GetWebrtcSyUpperHeader:GetWebrtcSyUpperHeader,GetWebrtcSyUpperDomainHeader:GetWebrtcSyUpperDomainHeader,GetWebrtcSrvAddr:GetWebrtcSrvAddr,CORSRequest:CORSRequest,ResetWsapisocket:ResetWsapisocket,WSRequest:WSRequest,GetCfgPriority:GetCfgPriority,EngineSelect:EngineSelect,TestEngineToString:TestEngineToString,GetEngine:GetEngine,SetEngine:SetEngine,ResetEngineClicked:ResetEngineClicked,HasUsableEngine:HasUsableEngine,HasUsableEngineFromEngines:HasUsableEngineFromEngines,IsMizuWebRTCGateway:IsMizuWebRTCGateway,IsMizuWebRTCGateway2:IsMizuWebRTCGateway2,IsMizuWebRTCEmbeddedServer:IsMizuWebRTCEmbeddedServer,IsMizuServer:IsMizuServer,GetEngineList:GetEngineList,GetSelectedEngine:GetSelectedEngine,GetRecommendedEngine:GetRecommendedEngine,GetSelectedEngineName:GetSelectedEngineName,GetRecommendedEngineName:GetRecommendedEngineName,EngineIsSupported:EngineIsSupported,lastengine_working_ok:lastengine_working_ok,lastengine_started_ok:lastengine_started_ok,CheckEngineFirstStart:CheckEngineFirstStart,IsCurrentEngineWorking:IsCurrentEngineWorking,IsJavaInstalled:IsJavaInstalled,ShowEngineOptionOnPage:ShowEngineOptionOnPage,GetEngineDisplayName:GetEngineDisplayName,InstallJavaPopup:InstallJavaPopup,Phone2Phone:Phone2Phone,ChooseEngineLogic2:ChooseEngineLogic2,CheckInternetConnection:CheckInternetConnection,CheckInternetConnectionWS:CheckInternetConnectionWS,GetSettFilenameSDK:GetSettFilenameSDK,GetAvailableCallfunctions:GetAvailableCallfunctions,GetColortheme:GetColortheme,SetCurrTheme:SetCurrTheme,NeedRegister:NeedRegister,IsIPAddrress:IsIPAddrress,IsLanIP:IsLanIP,IsLocalServer:IsLocalServer,IsLocalUpperServer:IsLocalUpperServer,GetWebdomain:GetWebdomain,SvCont:SvCont,GetBrandName:GetBrandName,SendLog:SendLog,CanShowLicKeyInput:CanShowLicKeyInput,BrowserRequiresHttps:BrowserRequiresHttps,IsHttps:IsHttps,PreferWss:PreferWss,MediaStreamPermissionDenied:MediaStreamPermissionDenied,GetTransferDirectoryName:GetTransferDirectoryName,FileTransfer:FileTransfer,GetLastUsedEngine:GetLastUsedEngine,SaveLastUsedEngine:SaveLastUsedEngine,IsConfigChanged:IsConfigChanged,IsLocalFileSystem:IsLocalFileSystem,GetAppEnProtocol:GetAppEnProtocol,HandleProtocol:HandleProtocol,CallScriptingUrl:CallScriptingUrl,OfferSaveContact:OfferSaveContact,ShowOfferSaveContact:ShowOfferSaveContact,ContactIsFavorite:ContactIsFavorite,ContactSetFavorite:ContactSetFavorite,AudioDevicePopup:AudioDevicePopup,IsContactBlocked:IsContactBlocked,IsNumberBlacklisted:IsNumberBlacklisted,BlockContact:BlockContact,UnBlockContact:UnBlockContact,GetTlsProxyUrl:GetTlsProxyUrl,SetLogFormAction:SetLogFormAction,GetWebrtcDisplayName:GetWebrtcDisplayName,GetRecentInviteIn:GetRecentInviteIn,CatchWebrtcSignaling:CatchWebrtcSignaling,GetSipHeaderFromMsg:GetSipHeaderFromMsg,RemoveSipHeadreFromCache:RemoveSipHeadreFromCache,GetSipHeader:GetSipHeader,GetSipMessage:GetSipMessage,UseTLSReload:UseTLSReload,TLSReload:TLSReload,CallWsuserKeepAlive:CallWsuserKeepAlive,GetDomainFromURL:GetDomainFromURL,GetVersionStr:GetVersionStr,IsSDK:IsSDK,GetStunServersStr:GetStunServersStr,GetOneStunSrv:GetOneStunSrv,GetTurnSrv:GetTurnSrv,GetDeviceId:GetDeviceId,LogAllParameters:LogAllParameters,AutodetectDirectWebrtc:AutodetectDirectWebrtc,AddJscommport:AddJscommport,getuseengine:getuseengine,Beep:Beep,GetCodecsFromApiParam:GetCodecsFromApiParam,GetHttpAPIKey:GetHttpAPIKey,Wsunreg:Wsunreg,GetWsuserUrl:GetWsuserUrl,HandleCalldivert:HandleCalldivert,SetVoiceMailNumber:SetVoiceMailNumber,GetProxyaddress:GetProxyaddress,SendConferenceInvites:SendConferenceInvites,ReceivedConferenceInvite:ReceivedConferenceInvite,IsServiceUpToDate:IsServiceUpToDate,GetMinServiceVersion:GetMinServiceVersion,GetAudioBandwidth:GetAudioBandwidth,GetVideoBandwidth:GetVideoBandwidth,GetVideoWidth:GetVideoWidth,GetVideoHeight:GetVideoHeight,EngineSwitchConference:EngineSwitchConference,EngineSwitchTransfer:EngineSwitchTransfer,HideSettings:HideSettings,SetLanguage:SetLanguage,SetNotCounter:SetNotCounter,WebContactGet:WebContactGet,WebContactReceived:WebContactReceived,IsXML:IsXML,GetCallSession:GetCallSession,SaveCallSession:SaveCallSession,PrintCallSessions:PrintCallSessions,GetEndpoint:GetEndpoint,GetFreeLine:GetFreeLine,IsLineFree:IsLineFree,GetBestLine:GetBestLine,GetNrOfActiveCalls:GetNrOfActiveCalls,RefreshInfo:RefreshInfo,GetReqId:GetReqId,IsMultiline:IsMultiline,GetTelsearchName:GetTelsearchName,SetElementsSrc:SetElementsSrc,GetElementSource:GetElementSource,PlayDtmfSound:PlayDtmfSound,GetLogLevel:GetLogLevel,GetHoldState:GetHoldState,SetHoldState:SetHoldState,GetMuteState:GetMuteState,SetMuteState:SetMuteState,IsIncomingCall:IsIncomingCall,GetDiscReasonFromSignaling:GetDiscReasonFromSignaling,HandleScurlSetparameters:HandleScurlSetparameters,ClassSipAccounts:ClassSipAccounts,ParseSipAccounts:ParseSipAccounts,SaveSipAccounts:SaveSipAccounts,AddOneAcc:AddOneAcc,GetOtherPartyName:GetOtherPartyName,CreateConferenceRoom:CreateConferenceRoom,InitiateConference:InitiateConference,GetMaxLogLevel:GetMaxLogLevel,HandleOfflineMessages:HandleOfflineMessages,WebphoneIsLoaded:WebphoneIsLoaded,BrowserWindowIsActive:BrowserWindowIsActive,ShowIncomingCallNotification:ShowIncomingCallNotification,DownloadContacts:DownloadContacts,ArrayBufferToString:ArrayBufferToString,WSAPIReConnect:WSAPIReConnect,WSAPIHandleReConnect:WSAPIHandleReConnect,Translate:Translate,GetLogTimeStamp:GetLogTimeStamp,GetAutostart:GetAutostart,CanIUseVideo:CanIUseVideo,CanIUseScreensharing:CanIUseScreensharing,SwitchToEngine:SwitchToEngine,ExitVideoMode:ExitVideoMode,GetCustomMenus:GetCustomMenus,DecideWebrtcServer:DecideWebrtcServer,GetTextLengthThatFits:GetTextLengthThatFits,DomainToIp:DomainToIp,DomainToIpServer:DomainToIpServer,AboutWindow:AboutWindow,IsUKGateway:IsUKGateway,IsUSGateway:IsUSGateway,EnableFCM:EnableFCM,UserExists:UserExists,GetSipusername:GetSipusername,GetCallerid:GetCallerid,HandleCallerID:HandleCallerID,StartFCM:StartFCM,WSReConnect:WSReConnect,GetFCMPackageName:GetFCMPackageName,UniqueArray:UniqueArray,IsWebphoneInIframe:IsWebphoneInIframe,GetParentIframeUrl:GetParentIframeUrl,IsCExt:IsCExt,GetUA:GetUA,StripXML:StripXML,DisplayStartPage:DisplayStartPage,ParseQRcode:ParseQRcode,GetSrvVersions:GetSrvVersions,IsMacLin:IsMacLin,NSMacLinEnabled:NSMacLinEnabled,PollServiceStatus:PollServiceStatus,GetAudioRecList:GetAudioRecList,GetAudioPlayList:GetAudioPlayList,GetAudioRingList:GetAudioRingList,GetVideoRecList:GetVideoRecList,GetAudioRecDev:GetAudioRecDev,GetAudioPlayDev:GetAudioPlayDev,GetAudioRingDev:GetAudioRingDev,GetVideoRecDev:GetVideoRecDev,NuIsWebPage:NuIsWebPage,GetMinSrvBuildValue:GetMinSrvBuildValue,HandleServiceBuildUpgrade:HandleServiceBuildUpgrade,CanUseIncomingCallNot:CanUseIncomingCallNot,RequestBrowserNotificationPermission:RequestBrowserNotificationPermission,ExecFunction:ExecFunction,StartAppEngine:StartAppEngine,GetUrlParamVal:GetUrlParamVal,GetJsonParamVal:GetJsonParamVal,HandleNewUserResult:HandleNewUserResult,GetActiveAccUsername:GetActiveAccUsername,GetPreferredStorage:GetPreferredStorage,SIP_REGISTER:SIP_REGISTER,SIP_INVITE_OUT:SIP_INVITE_OUT,SIP_INVITE_IN:SIP_INVITE_IN,SIP_UNKNOWN:SIP_UNKNOWN,GROUP_NOGROUP:GROUP_NOGROUP,GROUP_LOGIN:GROUP_LOGIN,GROUP_MAIN:GROUP_MAIN,GROUP_SIP:GROUP_SIP,GROUP_MEDIA:GROUP_MEDIA,GROUP_CALLDIVERT:GROUP_CALLDIVERT,GROUP_GENERAL:GROUP_GENERAL,GROUP_INTEGRATE:GROUP_INTEGRATE,GROUP_VIDEO:GROUP_VIDEO,GROUP_SCRSHARE:GROUP_SCRSHARE,GROUP_PROFILE:GROUP_PROFILE,RC_TYPE:0,RC_NAME:1,RC_NUMBER:2,RC_DATE:3,RC_RANK:4,RC_DURATION:5,F_WHAT:F_WHAT,F_WITH:F_WITH,F_MIN:F_MIN,F_MAX:F_MAX,EP_LINE:EP_LINE,EP_SESSION:EP_SESSION,EP_DESTNR:EP_DESTNR,EP_INCOMING:EP_INCOMING,EP_SETUPTIME:EP_SETUPTIME,EP_CONNECTTIME:EP_CONNECTTIME,EP_DISCONNECTTIME:EP_DISCONNECTTIME,EP_REASON:EP_REASON,EP_CALLID:EP_CALLID,EP_FLAGDEL:EP_FLAGDEL,EP_SETUPSENT:EP_SETUPSENT,EP_FINISHEDSENT:EP_FINISHEDSENT,EP_SIPHEADERS:EP_SIPHEADERS,EP_MUTESTATE:EP_MUTESTATE,EP_HOLDSTATE:EP_HOLDSTATE,EP_SIPINVITE:EP_SIPINVITE,EP_SESSID:EP_SESSID,PRES_STATUS:PRES_STATUS,PRES_TIME:PRES_TIME,ACC_SERVER:ACC_SERVER,ACC_USER:ACC_USER,ACC_PASSWORD:ACC_PASSWORD,ACC_IVAL:ACC_IVAL,ACC_ENABLED:ACC_ENABLED,ACC_ISMAIN:5,ACC_CALLERID:ACC_CALLERID,ACC_DISPLAYNAME:ACC_DISPLAYNAME,ACC_PROXY:ACC_PROXY,MIN_USR_PWD_LENGHT:3}}();window.common=common,wpa.file=function(){function e(){try{if(!0===m)return;var e=common.GetPreferredStorage();e>0&&(1===e?!0===localforage.supports(localforage.INDEXEDDB)?(localforage.setDriver([localforage.INDEXEDDB,localforage.LOCALSTORAGE,localforage.WEBSQL]),common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: IndexedDB",!1,"")):common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: IndexedDB is not supported",!1,""):2===e?!0===localforage.supports(localforage.LOCALSTORAGE)?(localforage.setDriver([localforage.LOCALSTORAGE,localforage.INDEXEDDB,localforage.WEBSQL]),common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: localStorage",!1,"")):common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: localStorage is not supported",!1,""):3===e&&(!0===localforage.supports(localforage.WEBSQL)?(localforage.setDriver([localforage.WEBSQL,localforage.INDEXEDDB,localforage.LOCALSTORAGE]),common.PutToDebugLogSpecial(1,"EVENT, preferred storage method set to: WebSQL",!1,"")):common.PutToDebugLogSpecial(1,"WARNING, preferred storage method: WebSQL is not supported",!1,""))),m=!0}catch(t){common.PutToDebugLogSpecial(1,"ERROR, file: SetItem",!0,t)}}function t(t,o,n){try{if(!n||"function"!=typeof n)return void common.PutToDebugLog(2,"ERROR, file: SetItem callback not defined");if(e(),common.isNull(t)||common.isNull(o))return void n(!1);global.dispSaveSettMsg<3&&common.PutToDebugLog(5,"EVENT, file saved to localforage: "+t),localforage.setItem(t,o,function(e,t){return e?(common.PutToDebugLog(2,"ERROR, file: SetItem localforage returned error: "+e),n(!1),!1):(n(!0),!0)})}catch(i){common.PutToDebugLogException(2,"file: SetItem",i)}}function o(t,o){try{if(!o||"function"!=typeof o)return void common.PutToDebugLog(2,"ERROR, file: GetItem callback not defined");if(common.isNull(t))return common.PutToDebugLog(2,"ERROR, file: GetItem key is NULL"),void o(null);e(),common.PutToDebugLog(2,"EVENT, file read from localforage: "+t),localforage.getItem(t,function(e,t){return e?(common.PutToDebugLog(2,"ERROR, file: GetItem localforage returned error: "+e),o(""),""):(o(t),t)})}catch(n){common.PutToDebugLogException(2,"file: GetItem",n),o("")}}function n(t,o){try{if(!o||"function"!=typeof o)return void common.PutToDebugLog(2,"ERROR, file: DeleteItem callback not defined");if(common.isNull(t))return common.PutToDebugLog(2,"ERROR, file: DeleteItem key is NULL"),void o(!1);e(),common.PutToDebugLog(2,"EVENT, file deleted from localforage"),localforage.removeItem(t,function(e){return e?(common.PutToDebugLog(2,"ERROR, file: DeleteItem localforage returned error: "+e),o(!1),!1):(o(!0),!0)})}catch(n){common.PutToDebugLogException(2,"file: DeleteItem",n)}}function i(e,t,o,n){try{if(!n||"function"!=typeof n)return common.PutToDebugLog(2,"ERROR, file: SetCookie callback not defined"),!1;if(common.isNull(e)||common.isNull(t))return common.PutToDebugLog(2,"ERROR, file: SetCookie key is NULL"),n(!1),!1;var i="";if(common.isNull(o))i="";else{var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),i="; expires="+r.toGMTString()}if(e.indexOf("_backup")>=0)for(var a=document.cookie.split(";"),s=0;s<a.length;s++){for(var l=a[s];" "===l.charAt(0);)l=l.substring(1,l.length);if(l.indexOf("_backup=")>=0){var c=l.substring(0,l.indexOf("_backup=")+7),u=new Date;u.setTime(u.getTime()+-864e5);var m="; expires="+u.toGMTString();document.cookie=c+"="+m+"; path=/"}}return document.cookie=e+"="+t+i+"; path=/",common.isNull(t)||global.dispSaveSettMsg<3&&common.PutToDebugLog(2,"EVENT, file saved to cookie: "+e),n(!0),!0}catch(g){common.PutToDebugLogException(2,"file: SetCookie",g)}n(!1)}function r(e,t){try{if(!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, file: GetCookie callback not defined");if(common.isNull(e))return common.PutToDebugLog(2,"ERROR, file: GetCookie key is NULL"),void t(null);for(var o=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o)){var a=r.substring(o.length,r.length);return common.PutToDebugLog(2,"EVENT, file read from cookie: "+e),void t(a)}}}catch(s){common.PutToDebugLogException(2,"file: GetCookie",s)}t(null)}function a(){try{for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var o=e[t],n=o.indexOf("="),i=n>-1?o.substr(0,n):o;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}return!0}catch(r){common.PutToDebugLogException(2,"file: DeleteAllCookies",r)}return!1}function s(e,t){try{if(!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, file: DeleteCookie callback not defined");if(common.isNull(e))return common.PutToDebugLog(2,"ERROR, file: DeleteCookie key is NULL"),void t(!1);i(e,"",-1,function(o){common.PutToDebugLog(2,"EVENT, file deleted from cookie: "+e),t(o)})}catch(o){common.PutToDebugLogException(2,"file: DeleteCookie",o)}}function l(e,o,n,a){try{if(!a||"function"!=typeof a)return void common.PutToDebugLog(2,"ERROR, file: SaveFile callback not defined");if(common.isNull(e))return common.PutToDebugLog(3,"ERROR, file: SaveFile filename null"),void a(!1);if(common.isNull(o))return common.PutToDebugLog(3,"ERROR, file: SaveFile content is NULL"),void a(!1);if((common.isNull(n)||n<0||n>2)&&(n=global.STORAGE_LOCAL),common.IsIeLocal()&&(n=global.STORAGE_COOKIE),common.PutToDebugLog(7,"EVENT, file: SaveFile content code"),o=common.Encrypt(o,common.enckey),common.isNull(o)&&common.PutToDebugLog(2,"ERROR, file: SaveFile content after code is NULL"),n!==global.STORAGE_LOCAL&&common.IsCExt()>0)return common.PutToDebugLog(4,"EVENT,Not saving data in cookie in webview: "+e),void a(!0);if(n===global.STORAGE_LOCAL)t(e,o,function(e){global.dispSaveSettMsg<3&&common.PutToDebugLog(3,"EVENT, file: SaveFile SetItem callback: "+e),a(e)});else if(n===global.STORAGE_COOKIE)i(e,o,365,function(e){a(e)});else{if(n!==global.STORAGE_AUTO)return common.PutToDebugLog(2,"ERROR, file: SaveFile invalid storagetype"),void a(!1);r("notincoockie",function(n){var r=!1;common.isNull(n)||"true"!==n||(r=!0),!0===r||o.length>1e3?(t(e,o,function(e){a(e)}),o.length>1e3&&i("notincoockie","true",365,function(){})):i(e,o,365,function(e){a(e)})})}}catch(s){common.PutToDebugLogException(2,"file: SaveFile",s)}}function c(e,t,n){try{if(!n||"function"!=typeof n)return void common.PutToDebugLog(2,"ERROR, file: ReadFile callback not defined");if((common.isNull(t)||t<0||t>2)&&(t=global.STORAGE_LOCAL),common.IsIeLocal()&&(t=global.STORAGE_COOKIE),common.isNull(e))return common.PutToDebugLog(3,"ERROR, file: ReadFile filename is NULL"),void n(null);if(t===global.STORAGE_LOCAL)o(e,function(e){common.isNull(e)||(common.PutToDebugLog(7,"EVENT, file: ReadFile content decode"),e.length>0&&(e=common.Decrypt(e,common.enckey))),common.isNull(e)&&common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null"),n(e)});else if(t===global.STORAGE_COOKIE)r(e,function(e){common.isNull(e)||(common.PutToDebugLog(7,"EVENT, file: ReadFile content decode"),e.length>0&&(e=common.Decrypt(e,common.enckey))),common.isNull(e)&&common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null"),n(e)});else{if(t!==global.STORAGE_AUTO)return common.PutToDebugLog(2,"ERROR, file: ReadFile invalid storagetype"),void n(!1);r("notincoockie",function(i){var a=!1;common.isNull(i)||"true"!==i||(a=!0),t===global.STORAGE_LOCAL||!0===a?o(e,function(e){common.isNull(e)||(common.PutToDebugLog(7,"EVENT, file: ReadFile content decode"),e.length>0&&(e=common.Decrypt(e,common.enckey))),common.isNull(e)&&common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null"),n(e)}):r(e,function(e){common.isNull(e)||(common.PutToDebugLog(7,"EVENT, file: ReadFile content decode"),e.length>0&&(e=common.Decrypt(e,common.enckey))),
common.isNull(e)&&common.PutToDebugLog(3,"EVENT, file: ReadFile content after decode is null"),n(e)})})}}catch(i){common.PutToDebugLogException(2,"file: ReadFile",i)}}function u(e,t){try{if(!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, file: DeleteFile callback not defined");if(common.isNull(e))return common.PutToDebugLog(3,"ERROR, file: DeleteFile filename null"),void t(!1);var o=!1;if(s(e,function(e){o||t(!0),o=!0}),common.IsIeLocal())return;n(e,function(e){o||t(!0),o=!0})}catch(i){common.PutToDebugLogException(2,"file: DeleteFile",i)}}var m=!1,g={SaveFile:l,ReadFile:c,DeleteFile:u,SetItem:t,GetItem:o,SetCookie:i,GetCookie:r,DeleteAllCookies:a};return global.File=g,window.file_public=g,{SaveFile:l,ReadFile:c,DeleteFile:u}}(),wpa.flashapi=function(){function e(){try{common.PutToDebugLog(3,"EVENT, Initializing...");var e=I();!common.isNull(e)&&e.length>0&&(R.rtmp_url="rtmp://"+e+"/phone",global.isdebugversion&&common.PutToDebugLog(3,"EVENT, Flash RTMP server: "+R.rtmp_url));var t=document.getElementById("flashphonehandle");if(common.isNull(t)){var o="https://www.adobe.com/go/getflashplayer",n="https://www.adobe.com/images/shared/download_buttons/get_flash_player.gif";!0===common.IsHttps()&&(o=o.replace("http:","https:"),n=n.replace("http:","https:"));var i='<div id="flashphonehandle" style="float: left; visibility: hidden; position: absolute; top: 0; left: 0; z-index: -1;"><span>You need Adobe Flash Player for the softphone to work.</span><p><a href="'+o+'" target="_blank"><img src="'+n+'" alt="Get Adobe Flash player" /></a></p></div>';j$("body").append(i)}swfobject.embedSWF("native/flashphone.swf",L,"1","1","9.0.0","native/expressInstall.swf",R,y,[],function(e){common.PutToDebugLog(2,"EVENT, flashapi embedswf: "+e.success),0==e.success&&common.PutToDebugLog(2,"EVENT, flashapi embed failed, flash player needs to be installed")})}catch(r){common.PutToDebugLogException(2,"flashapi: Start",r)}}function t(){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, onInit cannot get flash handle!");common.PutToDebugLog(3,"EVENT, flash Initialized."),G=!1}catch(e){common.PutToDebugLogException(2,"flashapi: onInit",e)}}function o(e){try{common.PutToDebugLog(3,"EVENT, Connected to flash server: "+e),global.iscurrengineworking=!0,common.SaveParameter("lastsessionsuccess","2"),G=!1,global.phonestarted<2&&(global.phonestarted=2);var t=common.GetSipusername(),o=common.GetParameter("password"),i=I(),r=i,a=r.indexOf(":");a>0&&(r=r.substring(0,a)),t=t+"@"+r,D=t;var s=common.NeedRegister();if(common.PutToDebugLog(3,"Flash connection details:"),common.PutToDebugLog(3,"RTMP server: "+R.rtmp_url),common.PutToDebugLog(3,"username: "+t),common.PutToDebugLog(3,"password: "+o),!0===s){if(common.PutToDebugLog(1,"STATUS,-1,Register..."),common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, trying to register with SIP account, but cannot get flash handle");n().login(t,o)}}catch(l){common.PutToDebugLogException(2,"flashapi: onConnected",l)}}function n(){try{if(!common.isNull(j$("#"+L)[0])&&"function"==typeof j$("#"+L)[0].login)return j$("#"+L)[0]}catch(e){common.PutToDebugLogException(2,"flashapi: GetHandle",e)}return null}function i(e){r(e)}function r(e){try{if(common.isNull(e)||e.length<1)return;var t=e.toLowerCase(),o="";o=t.indexOf("error")>=0?"ERROR, ":t.indexOf("warning")>=0?"WARNING, ":"EVENT, ",common.PutToDebugLog(2,o+"flash, "+e)}catch(n){common.PutToDebugLogException(2,"flashapi: onDebug",n)}}function a(){try{common.PutToDebugLog(3,"WARNING, flashapi onDisconnected: disconnected from flash server"),G=!1,setTimeout(function(){if(common.PutToDebugLog(3,"EVENT, onDisconnected: reconnecting to flash server"),common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle onDisconnect!");n().connect()},5e3)}catch(e){common.PutToDebugLogException(2,"flashapi: onDisconnected",e)}}function s(e){try{if(G=!1,common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");n().logout(e)}catch(t){common.PutToDebugLogException(2,"flashapi: Logout",t)}}function l(e,t,o){try{if("success"!=e)common.PutToDebugLog(1,"ERROR,-1,Register failed"),G=!1;else{global.iscurrengineworking=!0,common.SaveParameter("lastsessionsuccess","2"),common.PutToDebugLog(1,"EVENT,EVENT,authenticated successfully"),G=!0,w(),setTimeout(function(){common.PutToDebugLog(1,"STATUS,-1,Registered.")},1500);var i=t+"@"+o;if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");n().register(i,"")}}catch(r){common.PutToDebugLogException(2,"flashapi: onLogin",r)}}function c(e,t){common.PutToDebugLog(1,"STATUS,-1,Unregistered")}function u(e){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Call: cannot get flash handle!");W=!1,V=e,common.PutToDebugLog(1,"STATUS,1,CallSetup,"+e+","+common.GetSipusername()+",1,"+e);var t=D;return common.isNull(t)&&(t=""),common.PutToDebugLog(1,"STATUS,-1,Starting call to "+e),common.PutToDebugLog(1,"STATUS,-1,Call"),n().makeCall(e,t,[]),!0}catch(o){common.PutToDebugLogException(2,"flashapi: Call",o)}return!1}function m(){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=x;return common.isNull(e)&&(e=""),n().hangup(e),!0}catch(t){common.PutToDebugLogException(2,"flashapi: Hangup",t)}return!1}function g(){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=x;return common.isNull(e)&&(e=""),n().answer(e),!0}catch(t){common.PutToDebugLogException(2,"flashapi: Accept",t)}return!1}function d(e,t){try{return(common.isNull(t)||t.length<1)&&(t="1500"),common.isNull(n())?void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(n().sendDTMF(e,t),!0)}catch(o){common.PutToDebugLogException(2,"flashapi: sendDTMF",o)}return!1}function p(){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var e=x;return common.isNull(e)&&(e=""),n().attach(e),!0}catch(t){common.PutToDebugLogException(2,"flashapi: Attach",t)}return!1}function h(e){try{if(common.isNull(n()))return void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!");var t=x;return common.isNull(t)&&(t=""),n().transfer(t,e),!0}catch(o){common.PutToDebugLogException(2,"flashapi: Transfer",o)}return!1}function f(e,t){try{return common.isNull(n())?void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(n().three_way(e,t),!0)}catch(o){common.PutToDebugLogException(2,"flashapi: ThreeWay",o)}return!1}function b(e,t){try{return common.isNull(n())?void common.PutToDebugLog(3,"ERROR, Cannot get flash handle!"):(n().join(e,t),!0)}catch(o){common.PutToDebugLogException(2,"flashapi: Join",o)}return!1}function v(e,t){try{if(common.isNull(t)||t.length<1)return;x=e;var o=!1;switch(t){case"RINGING":o=!0,common.PutToDebugLog(1,"STATUS,-1,Ringing...");var n="1";W&&(n="2"),common.PutToDebugLog(1,"STATUS,1,Ringing,"+V+","+common.GetSipusername()+","+n+","+V),A=common.GetTickCount();break;case"ACTIVE":o=!0;var n="1";W&&(n="2"),common.PutToDebugLog(1,"STATUS,1,CallConnect,"+V+","+common.GetSipusername()+","+n+","+V),setTimeout(function(){common.PutToDebugLog(1,"STATUS,-1,InCall"),common.PutToDebugLog(1,"STATUS,-1,Speaking")},1300),common.PutToDebugLog(1,"STATUS,-1,Speaking"),k=common.GetTickCount();break;case"HANGUP":if(common.GetTickCount()-O<110)break;o=!0;var n="1";W&&(n="2"),common.PutToDebugLog(1,"STATUS,1,CallDisconnect,"+V+","+common.GetSipusername()+","+n+","+V),common.PutToDebugLog(1,"STATUS,-1,Call Finished"),common.PutToDebugLog(1,"STATUS,1,Finished"),O=common.GetTickCount()}!0!==o&&common.PutToDebugLog(3,"EVENT, onCallState: "+t+";  uuid: "+e)}catch(i){common.PutToDebugLogException(2,"flashapi: onCallState",i)}}function _(e,t,o,n,i){try{x=e,W=!0,V=o,common.PutToDebugLog(1,"STATUS,1,CallSetup,"+o+","+common.GetSipusername()+",2,"+o),common.PutToDebugLog(1,"STATUS,-1,Incoming...");var r=common.GetParameter2("autoignore");(common.isNull(r)||1!==r.length)&&(r="0");var a=common.StrToInt(r);a>1?(common.PutToDebugLog(3,"EVENT, autoignore Flash hangup(reject)"),Reject()):1===a&&(common.PutToDebugLog(3,"EVENT, autoignore Flash silent ignore"),Reject()),!0===common.GetParameterBool("autoaccept",!1)&&(common.PutToDebugLog(3,"EVENT, autoaccept Flash accept"),g());var s=common.GetParameter2("calltransferalways");!common.isNull(s)&&s.length>1&&(common.PutToDebugLog(3,"EVENT, call transfer Flash calltransferalways: "+s),h(s));var l=common.GetParameter2("callforwardonbusy");!common.isNull(l)&&l.length>1&&common.PutToDebugLog(3,"EVENT, call foward Flash callforwardonbusy: NOT IMPLEMENTED YET");var c=common.GetParameter2("callforwardalways");!common.isNull(c)&&c.length>1&&common.PutToDebugLog(3,"EVENT, call foward Flash callforwardalways: NOT IMPLEMENTED YET")}catch(u){common.PutToDebugLogException(2,"flashapi: onIncomingCall",u)}}function E(e,t){try{common.PutToDebugLog(1,"STATUS,-1,Hangup"),common.PutToDebugLog(3,"EVENT, onHangup reason: "+t+";  "+e),N(),setTimeout(function(){w()},1500)}catch(o){common.PutToDebugLogException(2,"flashapi: onHangup",o)}}function T(e,t,o){try{common.PutToDebugLog(1,"EVENT, flashapi onDisplayUpdate, name: "+t+", number: "+o+", "+e)}catch(n){common.PutToDebugLogException(2,"flashapi: onDisplayUpdate",n)}}function P(e,t,o){common.PutToDebugLog(4,"EVENT, flashapi onMakeCall: "+t)}function S(e){common.PutToDebugLog(4,"EVENT, flashapi onAttach: "+e)}function N(){try{U=common.GetTickCount();var e=0;!common.isNull(k)&&k>0&&!common.isNull(U)&&U>0&&(e=U-k),V=common.isNull(V)?"":common.Trim(V),common.isNull(k)&&(k=0);var t="",o="",n="NA";!common.isNull(k)&&common.IsNumber(k)&&!common.isNull(A)&&common.IsNumber(A)&&(n=(k-A).toString());W?(t=V,o=common.GetSipusername()):(t=common.GetSipusername(),o=V);var i="1";!0===W&&(i="2");var r="CDR,1,"+V+","+t+","+o+",NA,"+n+","+e.toString()+",NA,,"+i;global.lastcallcdr=r,setTimeout(function(){common.PutToDebugLog(1,r)},500),setTimeout(function(){w()},1500),A=0,k=0,U=0,V="",W=!1}catch(a){common.PutToDebugLogException(2,"flashapi: BuildCDR",a)}}function w(){G&&common.PutToDebugLog(1,"STATUS,-1,Registered.")}function I(){var e="";try{if(e=common.GetParameter("rtmpserveraddress"),common.isNull(e)||e.length<2){if(e=common.GetWpS(),common.IsLocalServer())return common.PutToDebugLog(1,"ERROR, Cannot use flash server to connect to local network VoIP server"),alert("ERROR, Cannot use flash server to connect to local network VoIP server"),"";e=e.toLowerCase(),e=common.NormalizeInput(e,0);var t=e.indexOf("/");t>0&&(e=e.substring(0,t)),t=e.indexOf(":"),t>0&&(e=e.substring(0,t)),e+=":1939"}return e}catch(o){common.PutToDebugLogException(2,"flashapi: GetFlashServerAddress",o)}return""}function C(e,t){}var R={rtmp_url:""},y={allowScriptAccess:"always"},L="flashphonehandle",D="",G=!1,x="",O=0,A=0,k=0,U=0,V="",W=!1,M={onInit:t,onEvent:i,onDebug:r,onConnected:o,onDisconnected:a,onLogin:l,onLogout:c,onCallState:v,onIncomingCall:_,onHangup:E,onDisplayUpdate:T,onMakeCall:P,onAttach:S};return window.flashapi_public=M,{Start:e,Call:u,Logout:s,Hangup:m,Accept:g,SendDTMF:d,Attach:p,Transfer:h,ThreeWay:f,Join:b,ShowPermissionRequest:C}}();var hex_chr="0123456789abcdef".split("");md5("hello"),function(){function e(e,t){var o={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return t&&(o.video.mandatory.chromeMediaSourceId=t),o}function t(){return i?i.isLoaded?void i.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(t,100):void o(t)}function o(e){if(i)return void e();i=document.createElement("iframe"),i.onload=function(){i.isLoaded=!0,e()},i.src="https://www.webrtc-experiment.com/getSourceId/",i.style.display="none",(document.body||document.documentElement).appendChild(i)}function n(){return i?i.isLoaded?void i.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):void setTimeout(function(){n()},100):void o(n)}window.getScreenIdWebphone=function(o){function n(t){t.data&&(t.data.chromeMediaSourceId&&("PermissionDeniedError"===t.data.chromeMediaSourceId?o("permission-denied"):o(null,t.data.chromeMediaSourceId,e(null,t.data.chromeMediaSourceId))),t.data.chromeExtensionStatus&&o(t.data.chromeExtensionStatus,null,e(t.data.chromeExtensionStatus)),window.removeEventListener("message",n))}if("Firefox"===webphone_api.GetBrowser())return void o(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}});window.removeEventListener("message",webphone_api.HandleEventMessage),window.addEventListener("message",n),setTimeout(function(){t()},100)};var i;window.getScreenConstraints=function(e){o(function(){getScreenIdWebphone(function(t,o,n){e(t,n.video)})})},window.getChromeExtensionStatus=function(e){function t(o){o.data&&(o.data.chromeExtensionStatus&&e(o.data.chromeExtensionStatus),window.removeEventListener("message",t))}if("Firefox"===webphone_api.GetBrowser())return void e("installed-enabled");window.removeEventListener("message",webphone_api.HandleEventMessage),window.addEventListener("message",t),setTimeout(function(){n()},100)}}(),wpa.init=function(){function e(){j$("#loading_bg_txt").hide();var e=window.location.href;e.indexOf("#page_call")>0&&(console&&console.log&&console.log("WARNING, page Call was last started and after browser window reload, go to Settings page"),e=e.replace("#page_call",""),window.location.href=e)}function t(){if(!0!==i){if(i=!0,common.SetElementsSrc(),global.domloaded_tick=common.GetTickCount(),common.PutToDebugLog(2,"EVENT, init: initialize start"),common.Glv()<1)return void(global.webrtcavailable=0);common.IsWindowsSoftphone()||(webphone_api.loadwebrtc_timestamp=common.GetTickCount(),webrtcapi_public.WebRtcIsSupported(function(e){function t(){if(common.EngineSelect(0),common.SetLanguage(),!1===global.onloaded_called){global.wploaded=!0,common.PutToDebugLogSpecial(1,"EVENT, init webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){common.PutToDebugLogException(2,"init: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){common.PutToDebugLogException(2,"init: There is an error in onLoaded() callback",e)}common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),global.onloaded_called=!0,setTimeout(function(){global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,common.WebphoneIsLoaded()}}if("Windows"===common.GetOs()&&("MSIE"===common.GetBrowser()?e=!1:"Edge"===common.GetBrowser()&&(common.GetBrowserVersion()<14?e=!1:!1===e&&common.PutToDebugLog(2,"ERROR,Init Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===common.GetOs()?(("Safari"===common.GetBrowser()||"iPhone"===common.GetBrowser())&&common.GetBrowserVersion()<11&&(e=!1),"Firefox"!==common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(e=!1),"Chrome"!==common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(e=!1)):"Windows"===common.GetOs()&&"Safari"===common.GetBrowser()&&(e=!1),common.isNull(e)&&(e=""),common.PutToDebugLog(2,"EVENT, init: initialize LoadWebrtc engine: "+e),!0===e){global.webrtcavailable=1,common.PutToDebugLog(2,"webrtc engine available (init)");var o=common.GetEngine("webrtc"),n=common.GetParameter2("serveraddress_user");(common.isNull(n)||n.length<2)&&(n=common.GetParameter2("serveraddress")),(common.isNull(n)||n.length<2)&&(n=common.GetConfig("serveraddress")),common.isNull(n)&&(n=""),common.IsLanIP(common.GetWebrtcUpperServer())||n.length>0&&common.IsLanIP(n)?common.isNull(o)||(o.issupported_cache=0,o.available=0):!0===common.BrowserRequiresHttps(!0)?common.isNull(o)||(o.issupported_cache=1,o.available=2):common.isNull(o)||(o.issupported_cache=2,o.available=3)}else!1===e&&(global.webrtcavailable=0,common.PutToDebugLog(2,"webrtc engine NOT available"));!0===common.UseCustomAutoprov(!0)?common.GetCustomAutoprov(function(e){common.RecAutoprovCustom(e),t()}):t()}))}}function o(){try{global.domloaded=!0,j$.mobile.pageContainer=j$("#android_frame"),common.PutToDebugLog(3,"EVENT, init: mobileinit"),j$("body").on("contextmenu",function(e){if(0==common.IsSDK())return n(e)})}catch(e){common.PutToDebugLogException(2,"init: mobileinit",e)}}function n(e){var t="";try{if(t=j$.mobile.activePage.attr("id"),common.isNull(t)||t.length<1)return common.PutToDebugLog(2,"ERROR, init: OpenMenu NO PAGE"),!1;t=t.replace("page_","");var o="#btn_"+t+"_menu";if("settings"===t)return j$(o).click(),e.preventDefault(),!1;if("dialpad"===t)return j$(o).click(),e.preventDefault(),!1;if("contactslist"===t)return j$(o).click(),e.preventDefault(),!1;if("contactdetails"===t)return j$(o).click(),e.preventDefault(),!1;if("callhistorylist"===t)return j$(o).click(),e.preventDefault(),!1;if("callhistorydetails"===t)return j$(o).click(),e.preventDefault(),!1;if("call"===t)return j$(o).click(),e.preventDefault(),!1;if("addeditcontact"===t)return j$(o).click(),e.preventDefault(),!1;if("messagelist"===t)return j$(o).click(),e.preventDefault(),!1;if("message"===t)return j$(o).click(),e.preventDefault(),!1;if("internalbrowser"===t)return j$(o).click(),e.preventDefault(),!1;if("newuser"===t)return j$(o).click(),e.preventDefault(),!1;if("filetransfer"===t)return j$(o).click(),e.preventDefault(),!1;if("smscodeverify"===t)return j$(o).click(),e.preventDefault(),!1}catch(n){common.PutToDebugLogException(2,"init: OpenMenu "+t,n)}}j$(document).ready(function(){e()}),j$(document).on("mobileinit",function(){o(),j$.event.special.tap.emitTapOnTaphold=!1});var i=!1;j$(".options_menu").on("popupbeforeposition",function(e,t){j$(".all_app_pages").css("overflow","hidden")});var r=!1;window.onunload=window.onbeforeunload=function(e){try{if(webphone_api.unregisteredcb=null,global.onunload_flag=!0,!0===r)return;webphone_api.stop();global.useengine;global.useengine="",common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh event detected. reset useengine"),global.wasSettModified&&common.SaveSettingsFile(common.GetActiveAccSettingsFilename(),function(e){e?common.PutToDebugLog(2,"EVENT, SaveSettingsFile on exit Successfull"):common.PutToDebugLog(2,"ERROR, SaveSettingsFile on exit Failed")}),global.wasCtModified&&common.SaveContactsFile(function(e){e?common.PutToDebugLog(2,"EVENT, SaveContactsFile on exit Successfull"):common.PutToDebugLog(2,"ERROR, SaveContactsFile on exit Failed")}),global.wasChModified&&common.SaveCallhistoryFile(function(e){e?common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile on exit Successfull"):common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile on exit Failed")}),r=!0}catch(t){common.PutToDebugLogException(2,"init: Window.OnUnload",t)}},j$(document).on("pagecontainershow",function(e,t){var o="";try{var n=j$.mobile.pageContainer.pagecontainer("getActivePage");o=n[0].id,document.getElementById(o).style.minHeight="auto"}catch(i){common.PutToDebugLogException(2,"init: pagecontainershow "+o,i)}}),j$(document).on("pageinit",'[data-role="page"]',function(e){var t="";try{if(t=j$(this).attr("id"),common.isNull(t)||t.length<1)return void common.PutToDebugLog(2,"ERROR, init: pageinit NO PAGE");if(t.indexOf("settings")>=0)return void wpa._settings.onCreate(e);if(t.indexOf("dialpad")>=0)return void wpa._dialpad.onCreate(e);if(t.indexOf("contactslist")>=0)return void wpa._contactslist.onCreate(e);if(t.indexOf("contactdetails")>=0)return void wpa._contactdetails.onCreate(e);if(t.indexOf("callhistorylist")>=0)return void wpa._callhistorylist.onCreate(e);if(t.indexOf("callhistorydetails")>=0)return void wpa._callhistorydetails.onCreate(e);if(t.indexOf("call")>=0)return void wpa._call.onCreate(e);if(t.indexOf("addeditcontact")>=0)return void wpa._addeditcontact.onCreate(e);if(t.indexOf("messagelist")>=0)return void wpa._messagelist.onCreate(e);if(t.indexOf("message")>=0)return void wpa._message.onCreate(e);if(t.indexOf("internalbrowser")>=0)return void wpa._internalbrowser.onCreate(e);if(t.indexOf("startpage")>=0)return void wpa._startpage.onCreate(e);if(t.indexOf("logview")>=0)return void wpa._logview.onCreate(e);if(t.indexOf("newuser")>=0)return void wpa._newuser.onCreate(e);if(t.indexOf("filetransfer")>=0)return void wpa._filetransfer.onCreate(e);if(t.indexOf("filters")>=0)return void wpa._filters.onCreate(e);if(t.indexOf("accounts")>=0)return void wpa._accounts.onCreate(e);if(t.indexOf("smscodeverify")>=0)return void wpa._smscodeverify.onCreate(e);if(t.indexOf("extra1")>=0)return void(wpa._extra1&&wpa._extra1.onCreate&&(wpa._extra1.onCreate(e),global.isExtra1Started=!0));if(t.indexOf("extra2")>=0)return void(wpa._extra2&&wpa._extra2.onCreate&&(wpa._extra2.onCreate(e),global.isExtra2Started=!0));if(t.indexOf("extra3")>=0)return void(wpa._extra3&&wpa._extra3.onCreate&&(wpa._extra3.onCreate(e),global.isExtra3Started=!0));if(t.indexOf("extra4")>=0)return void(wpa._extra4&&wpa._extra4.onCreate&&(wpa._extra4.onCreate(e),global.isExtra4Started=!0));if(t.indexOf("extra5")>=0)return void(wpa._extra5&&wpa._extra5.onCreate&&(wpa._extra5.onCreate(e),global.isExtra5Started=!0))}catch(o){common.isNull(t)&&(t=""),common.PutToDebugLogException(2,"init: pageinit "+t,o)}}),j$(document).on("pageshow",'[data-role="page"]',function(e){var t="";try{if(t=j$(this).attr("id"),common.isNull(t)||t.length<1)return void common.PutToDebugLog(2,"ERROR, init: pageshow NO PAGE");var o="#"+t.substring(t.indexOf("_")+1,t.length)+"_header";if(document.getElementById(t).style.background=common.getBgColor(o),t.indexOf("settings")>=0)return void wpa._settings.onStart(e);if(t.indexOf("dialpad")>=0)return void wpa._dialpad.onStart(e);if(t.indexOf("contactslist")>=0)return void wpa._contactslist.onStart(e);if(t.indexOf("contactdetails")>=0)return void wpa._contactdetails.onStart(e);if(t.indexOf("callhistorylist")>=0)return void wpa._callhistorylist.onStart(e);if(t.indexOf("callhistorydetails")>=0)return void wpa._callhistorydetails.onStart(e);if(t.indexOf("call")>=0)return void wpa._call.onStart(e);if(t.indexOf("addeditcontact")>=0)return void wpa._addeditcontact.onStart(e);if(t.indexOf("messagelist")>=0)return void wpa._messagelist.onStart(e);if(t.indexOf("message")>=0)return void wpa._message.onStart(e);if(t.indexOf("internalbrowser")>=0)return void wpa._internalbrowser.onStart(e);if(t.indexOf("startpage")>=0)return void wpa._startpage.onStart(e);if(t.indexOf("logview")>=0)return void wpa._logview.onStart(e);if(t.indexOf("newuser")>=0)return void wpa._newuser.onStart(e);if(t.indexOf("filetransfer")>=0)return void wpa._filetransfer.onStart(e);if(t.indexOf("filters")>=0)return void wpa._filters.onStart(e);if(t.indexOf("accounts")>=0)return void wpa._accounts.onStart(e);if(t.indexOf("smscodeverify")>=0)return void wpa._smscodeverify.onStart(e);if(t.indexOf("extra1")>=0)return void(wpa._extra1&&wpa._extra1.onStart&&(wpa._extra1.onStart(e),global.isExtra1Started=!0));if(t.indexOf("extra2")>=0)return void(wpa._extra2&&wpa._extra2.onStart&&(wpa._extra2.onStart(e),global.isExtra2Started=!0));if(t.indexOf("extra3")>=0)return void(wpa._extra3&&wpa._extra3.onStart&&(wpa._extra3.onStart(e),global.isExtra3Started=!0));if(t.indexOf("extra4")>=0)return void(wpa._extra4&&wpa._extra4.onStart&&(wpa._extra4.onStart(e),global.isExtra4Started=!0));if(t.indexOf("extra5")>=0)return void(wpa._extra5&&wpa._extra5.onStart&&(wpa._extra5.onStart(e),global.isExtra5Started=!0))}catch(n){common.isNull(t)&&(t=""),common.PutToDebugLogException(2,"init: pageshow "+t,n)}}),j$(document).on("pagebeforehide",'[data-role="page"]',function(e){var t="";try{if(t=j$(this).attr("id"),common.isNull(t)||t.length<1)return void common.PutToDebugLog(2,"ERROR, init: pagebeforehide NO PAGE");if(t.indexOf("settings")>=0)return void wpa._settings.onStop(e);if(t.indexOf("dialpad")>=0)return void wpa._dialpad.onStop(e);if(t.indexOf("contactslist")>=0)return void wpa._contactslist.onStop(e);if(t.indexOf("contactdetails")>=0)return void wpa._contactdetails.onStop(e);if(t.indexOf("callhistorylist")>=0)return void wpa._callhistorylist.onStop(e);if(t.indexOf("callhistorydetails")>=0)return void wpa._callhistorydetails.onStop(e);if(t.indexOf("call")>=0)return void wpa._call.onStop(e);if(t.indexOf("addeditcontact")>=0)return void wpa._addeditcontact.onStop(e);if(t.indexOf("messagelist")>=0)return void wpa._messagelist.onStop(e);if(t.indexOf("message")>=0)return void wpa._message.onStop(e);if(t.indexOf("internalbrowser")>=0)return void wpa._internalbrowser.onStop(e);if(t.indexOf("startpage")>=0)return void wpa._startpage.onStop(e);if(t.indexOf("logview")>=0)return void wpa._logview.onStop(e);if(t.indexOf("newuser")>=0)return void wpa._newuser.onStop(e);if(t.indexOf("filetransfer")>=0)return void wpa._filetransfer.onStop(e);if(t.indexOf("filters")>=0)return void wpa._filters.onStop(e);if(t.indexOf("accounts")>=0)return void wpa._accounts.onStop(e);if(t.indexOf("smscodeverify")>=0)return void wpa._smscodeverify.onStop(e);if(t.indexOf("extra1")>=0)return void(wpa._extra1&&wpa._extra1.onStop&&(wpa._extra1.onStop(e),global.isExtra1Started=!1));if(t.indexOf("extra2")>=0)return void(wpa._extra2&&wpa._extra2.onStop&&(wpa._extra2.onStop(e),global.isExtra2Started=!1));if(t.indexOf("extra3")>=0)return void(wpa._extra3&&wpa._extra3.onStop&&(wpa._extra3.onStop(e),global.isExtra3Started=!1));if(t.indexOf("extra4")>=0)return void(wpa._extra4&&wpa._extra4.onStop&&(wpa._extra4.onStop(e),global.isExtra4Started=!1));if(t.indexOf("extra5")>=0)return void(wpa._extra5&&wpa._extra5.onStop&&(wpa._extra5.onStop(e),global.isExtra5Started=!1))}catch(o){common.isNull(t)&&(t=""),common.PutToDebugLogException(2,"init: pagebeforehide "+t,o)}}),j$(document).on("pagehide",'[data-role="page"]',function(e){var t="";try{if(t=j$(this).attr("id"),common.isNull(t)||t.length<1)return void common.PutToDebugLog(2,"ERROR, init: pagehide NO PAGE");if(t.indexOf("settings")>=0&&wpa._settings.onDestroy)return void wpa._settings.onDestroy(e);if(t.indexOf("dialpad")>=0&&wpa._dialpad.onDestroy)return void wpa._dialpad.onDestroy(e);if(t.indexOf("contactslist")>=0&&wpa._contactslist.onDestroy)return void wpa._contactslist.onDestroy(e);if(t.indexOf("contactdetails")>=0&&wpa._contactdetails.onDestroy)return void wpa._contactdetails.onDestroy(e);if(t.indexOf("callhistorylist")>=0&&wpa._callhistorylist.onDestroy)return void wpa._callhistorylist.onDestroy(e);if(t.indexOf("callhistorydetails")>=0&&wpa._callhistorydetails.onDestroy)return void wpa._callhistorydetails.onDestroy(e);if(t.indexOf("call")>=0&&wpa._call.onDestroy)return void wpa._call.onDestroy(e);if(t.indexOf("addeditcontact")>=0&&wpa._addeditcontact.onDestroy)return void wpa._addeditcontact.onDestroy(e);if(t.indexOf("messagelist")>=0&&wpa._messagelist.onDestroy)return void wpa._messagelist.onDestroy(e);if(t.indexOf("message")>=0&&wpa._message.onDestroy)return void wpa._message.onDestroy(e);if(t.indexOf("internalbrowser")>=0&&wpa._internalbrowser.onDestroy)return void wpa._internalbrowser.onDestroy(e);if(t.indexOf("startpage")>=0&&wpa._startpage.onDestroy)return void wpa._startpage.onDestroy(e);if(t.indexOf("logview")>=0&&wpa._logview.onDestroy)return void wpa._logview.onDestroy(e);if(t.indexOf("newuser")>=0&&wpa._newuser.onDestroy)return void wpa._newuser.onDestroy(e);if(t.indexOf("filetransfer")>=0&&wpa._filetransfer.onDestroy)return void wpa._filetransfer.onDestroy(e);if(t.indexOf("filters")>=0&&wpa._filters.onDestroy)return void wpa._filters.onDestroy(e);if(t.indexOf("accounts")>=0&&wpa._accounts.onDestroy)return void wpa._accounts.onDestroy(e);if(t.indexOf("smscodeverify")>=0&&wpa._accounts.onDestroy)return void wpa._smscodeverify.onDestroy(e)}catch(o){common.isNull(t)&&(t=""),common.PutToDebugLogException(2,"init: pagehide "+t,o)}});var a={SkinLoaded:t};return window.wpskininit_public=a,{initialize:e,mobileinit:o}}(),function(e,t,o){1!=webphone_api.parameters.issdk&&"true"!=webphone_api.parameters.issdk&&("function"==typeof define&&define.amd?define(["jquery"],function(n){return o(n,e,t),n.mobile}):o(e.jQuery,e,t))}(this,document,function(e,t,o){!function(e){e.mobile={}}(e),function(e){e.extend(e.mobile,{version:"1.4.2",subPageUrlKey:"ui-page",hideUrlBar:!0,keepNative:":jqmData(role='none'), :jqmData(role='nojs')",activePageClass:"ui-page-active",activeBtnClass:"ui-btn-active",focusClass:"ui-focus",ajaxEnabled:!0,hashListeningEnabled:!0,linkBindingEnabled:!0,defaultPageTransition:"fade",maxTransitionWidth:!1,minScrollBack:0,defaultDialogTransition:"pop",pageLoadErrorMessage:"Error Loading Page",pageLoadErrorMessageTheme:"a",phonegapNavigationEnabled:!1,autoInitializePage:!0,pushStateEnabled:!0,ignoreContentEnabled:!1,buttonMarkup:{hoverDelay:200},dynamicBaseEnabled:!0,pageContainer:e(),allowCrossDomainPages:!1,dialogHashKey:"&ui-state=dialog"})}(e),function(e,t,o){var n={},i=e.find,r=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;e.extend(e.mobile,{ns:"",getAttribute:function(t,o){var n;(t=t.jquery?t[0]:t)&&t.getAttribute&&(n=t.getAttribute("data-"+e.mobile.ns+o));try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:r.test(n)?JSON.parse(n):n)}catch(i){}return n},nsNormalizeDict:n,nsNormalize:function(t){return n[t]||(n[t]=e.camelCase(e.mobile.ns+t))},closestPageData:function(e){return e.closest(":jqmData(role='page'), :jqmData(role='dialog')").data("mobile-page")}}),e.fn.jqmData=function(t,o){var n;return void 0!==t&&(t&&(t=e.mobile.nsNormalize(t)),n=arguments.length<2||void 0===o?this.data(t):this.data(t,o)),n},e.jqmData=function(t,o,n){var i;return void 0!==o&&(i=e.data(t,o?e.mobile.nsNormalize(o):o,n)),i},e.fn.jqmRemoveData=function(t){return this.removeData(e.mobile.nsNormalize(t))},e.jqmRemoveData=function(t,o){return e.removeData(t,e.mobile.nsNormalize(o))},e.find=function(t,o,n,r){return t.indexOf(":jqmData")>-1&&(t=t.replace(/:jqmData\(([^)]*)\)/g,"[data-"+(e.mobile.ns||"")+"$1]")),i.call(this,t,o,n,r)},e.extend(e.find,i)}(e),function(e,t){function n(t,o){var n,r,a,s=t.nodeName.toLowerCase();return"area"===s?(n=t.parentNode,r=n.name,!(!t.href||!r||"map"!==n.nodeName.toLowerCase())&&(!!(a=e("img[usemap=#"+r+"]")[0])&&i(a))):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||o:o)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var r=0,a=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"c0ab71056b936627e8a7821f03c044aec6280a40",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(o,n){return"number"==typeof o?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},o)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(this[0].ownerDocument||o):t},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(o){return!!e.data(o,t)}}):function(t,o,n){return!!e.data(t,n[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var o=e.attr(t,"tabindex"),i=isNaN(o);return(i||o>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(o,n){function i(t,o,n,i){return e.each(r,function(){o-=parseFloat(e.css(t,"padding"+this))||0,
n&&(o-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(o-=parseFloat(e.css(t,"margin"+this))||0)}),o}var r="Width"===n?["Left","Right"]:["Top","Bottom"],a=n.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(o){return o===t?s["inner"+n].call(this):this.each(function(){e(this).css(a,i(this,o)+"px")})},e.fn["outer"+n]=function(t,o){return"number"!=typeof t?s["outer"+n].call(this,t):this.each(function(){e(this).css(a,i(this,t,!0,o)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(o){return arguments.length?t.call(this,e.camelCase(o)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in o.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,r,a=e(this[0]);a.length&&a[0]!==o;){if(("absolute"===(i=a.css("position"))||"relative"===i||"fixed"===i)&&(r=parseInt(a.css("zIndex"),10),!isNaN(r)&&0!==r))return r;a=a.parent()}return 0}}),e.ui.plugin={add:function(t,o,n){var i,r=e.ui[t].prototype;for(i in n)r.plugins[i]=r.plugins[i]||[],r.plugins[i].push([o,n[i]])},call:function(e,t,o,n){var i,r=e.plugins[t];if(r&&(n||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,o)}}}(e),function(e,t){var n=function(t,o){var n=t.parent(),i=[],r=n.children(":jqmData(role='header')"),a=t.children(":jqmData(role='header')"),s=n.children(":jqmData(role='footer')"),l=t.children(":jqmData(role='footer')");return 0===a.length&&r.length>0&&(i=i.concat(r.toArray())),0===l.length&&s.length>0&&(i=i.concat(s.toArray())),e.each(i,function(t,n){o-=e(n).outerHeight()}),Math.max(0,o)};e.extend(e.mobile,{window:e(t),document:e(o),keyCode:e.ui.keyCode,behaviors:{},silentScroll:function(o){"number"!==e.type(o)&&(o=e.mobile.defaultHomeScroll),e.event.special.scrollstart.enabled=!1,setTimeout(function(){t.scrollTo(0,o),e.mobile.document.trigger("silentscroll",{x:0,y:o})},20),setTimeout(function(){e.event.special.scrollstart.enabled=!0},150)},getClosestBaseUrl:function(t){var o=e(t).closest(".ui-page").jqmData("url"),n=e.mobile.path.documentBase.hrefNoHash;return e.mobile.dynamicBaseEnabled&&o&&e.mobile.path.isPath(o)||(o=n),e.mobile.path.makeUrlAbsolute(o,n)},removeActiveLinkClass:function(t){!e.mobile.activeClickedLink||e.mobile.activeClickedLink.closest("."+e.mobile.activePageClass).length&&!t||e.mobile.activeClickedLink.removeClass(e.mobile.activeBtnClass),e.mobile.activeClickedLink=null},getInheritedTheme:function(e,t){for(var o,n,i=e[0],r="",a=/ui-(bar|body|overlay)-([a-z])\b/;i&&!((o=i.className||"")&&(n=a.exec(o))&&(r=n[2]));)i=i.parentNode;return r||t||"a"},enhanceable:function(e){return this.haveParents(e,"enhance")},hijackable:function(e){return this.haveParents(e,"ajax")},haveParents:function(t,o){if(!e.mobile.ignoreContentEnabled)return t;var n,i,r,a,s=t.length,l=e();for(a=0;s>a;a++){for(i=t.eq(a),r=!1,n=t[a];n;){if("false"===(n.getAttribute?n.getAttribute("data-"+e.mobile.ns+o):"")){r=!0;break}n=n.parentNode}r||(l=l.add(i))}return l},getScreenHeight:function(){return t.innerHeight||e.mobile.window.height()},resetActivePageHeight:function(t){var o=e("."+e.mobile.activePageClass),i=o.height(),r=o.outerHeight(!0);t=n(o,"number"==typeof t?t:e.mobile.getScreenHeight()),o.css("min-height",t-(r-i))},loading:function(){var t=this.loading._widget||e(e.mobile.loader.prototype.defaultHtml).loader(),o=t.loader.apply(t,arguments);return this.loading._widget=t,o}}),e.addDependents=function(t,o){var n=e(t),i=n.jqmData("dependents")||e();n.jqmData("dependents",e(i).add(o))},e.fn.extend({removeWithDependents:function(){e.removeWithDependents(this)},enhanceWithin:function(){var t,o={},n=e.mobile.page.prototype.keepNativeSelector(),i=this;e.mobile.nojs&&e.mobile.nojs(this),e.mobile.links&&e.mobile.links(this),e.mobile.degradeInputsWithin&&e.mobile.degradeInputsWithin(this),e.fn.buttonMarkup&&this.find(e.fn.buttonMarkup.initSelector).not(n).jqmEnhanceable().buttonMarkup(),e.fn.fieldcontain&&this.find(":jqmData(role='fieldcontain')").not(n).jqmEnhanceable().fieldcontain(),e.each(e.mobile.widgets,function(t,r){if(r.initSelector){var a=e.mobile.enhanceable(i.find(r.initSelector));a.length>0&&(a=a.not(n)),a.length>0&&(o[r.prototype.widgetName]=a)}});for(t in o)o[t][t]();return this},addDependents:function(t){e.addDependents(this,t)},getEncodedText:function(){return e("<a>").text(this.text()).html()},jqmEnhanceable:function(){return e.mobile.enhanceable(this)},jqmHijackable:function(){return e.mobile.hijackable(this)}}),e.removeWithDependents=function(t){var o=e(t);(o.jqmData("dependents")||e()).remove(),o.remove()},e.addDependents=function(t,o){var n=e(t),i=n.jqmData("dependents")||e();n.jqmData("dependents",e(i).add(o))},e.find.matches=function(t,o){return e.find(t,null,null,o)},e.find.matchesSelector=function(t,o){return e.find(o,null,null,[t]).length>0}}(e,this),function(e,t){var o=0,n=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var o,n=0;null!=(o=t[n]);n++)try{e(o).triggerHandler("remove")}catch(r){}i(t)},e.widget=function(t,o,n){var i,r,a,s,l={},c=t.split(".")[0];return t=t.split(".")[1],i=c+"-"+t,n||(n=o,o=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[c]=e[c]||{},r=e[c][t],a=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new a(e,t)},e.extend(a,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),s=new o,s.options=e.widget.extend({},s.options),e.each(n,function(t,n){return e.isFunction(n)?void(l[t]=function(){var e=function(){return o.prototype[t].apply(this,arguments)},i=function(e){return o.prototype[t].apply(this,e)};return function(){var t,o=this._super,r=this._superApply;return this._super=e,this._superApply=i,t=n.apply(this,arguments),this._super=o,this._superApply=r,t}}()):void(l[t]=n)}),a.prototype=e.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||t:t},l,{constructor:a,namespace:c,widgetName:t,widgetFullName:i}),r?(e.each(r._childConstructors,function(t,o){var n=o.prototype;e.widget(n.namespace+"."+n.widgetName,a,o._proto)}),delete r._childConstructors):o._childConstructors.push(a),e.widget.bridge(t,a),a},e.widget.extend=function(o){for(var i,r,a=n.call(arguments,1),s=0,l=a.length;l>s;s++)for(i in a[s])r=a[s][i],a[s].hasOwnProperty(i)&&r!==t&&(o[i]=e.isPlainObject(r)?e.isPlainObject(o[i])?e.widget.extend({},o[i],r):e.widget.extend({},r):r);return o},e.widget.bridge=function(o,i){var r=i.prototype.widgetFullName||o;e.fn[o]=function(a){var s="string"==typeof a,l=n.call(arguments,1),c=this;return a=!s&&l.length?e.widget.extend.apply(null,[a].concat(l)):a,this.each(s?function(){var n,i=e.data(this,r);return"instance"===a?(c=i,!1):i?e.isFunction(i[a])&&"_"!==a.charAt(0)?(n=i[a].apply(i,l),n!==i&&n!==t?(c=n&&n.jquery?c.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+a+"' for "+o+" widget instance"):e.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+a+"'")}:function(){var t=e.data(this,r);t?t.option(a||{})._init():e.data(this,r,new i(a,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=o++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(o,n){var i,r,a,s=o;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof o)if(s={},i=o.split("."),o=i.shift(),i.length){for(r=s[o]=e.widget.extend({},this.options[o]),a=0;a<i.length-1;a++)r[i[a]]=r[i[a]]||{},r=r[i[a]];if(o=i.pop(),n===t)return r[o]===t?null:r[o];r[o]=n}else{if(n===t)return this.options[o]===t?null:this.options[o];s[o]=n}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,o,n){var i,r=this;"boolean"!=typeof t&&(n=o,o=t,t=!1),n?(o=i=e(o),this.bindings=this.bindings.add(o)):(n=o,o=this.element,i=this.widget()),e.each(n,function(n,a){function s(){return t||!0!==r.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof a?r[a]:a).apply(r,arguments):void 0}"string"!=typeof a&&(s.guid=a.guid=a.guid||s.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,u=l[2];u?i.delegate(u,c,s):o.bind(c,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function o(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(o,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,o,n){var i,r,a=this.options[t];if(n=n||{},o=e.Event(o),o.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),o.target=this.element[0],r=o.originalEvent)for(i in r)i in o||(o[i]=r[i]);return this.element.trigger(o,n),!(e.isFunction(a)&&!1===a.apply(this.element[0],[o].concat(n))||o.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,o){e.Widget.prototype["_"+t]=function(n,i,r){"string"==typeof i&&(i={effect:i});var a,s=i?!0===i||"number"==typeof i?o:i.effect||o:t;i=i||{},"number"==typeof i&&(i={duration:i}),a=!e.isEmptyObject(i),i.complete=r,i.delay&&n.delay(i.delay),a&&e.effects&&e.effects.effect[s]?n[t](i):s!==t&&n[s]?n[s](i.duration,i.easing,r):n.queue(function(o){e(this)[t](),r&&r.call(n[0]),o()})}})}(e),function(e){var t=function(e){return"-"+e.toLowerCase()};e.extend(e.Widget.prototype,{_getCreateOptions:function(){var o,n,i=this.element[0],r={};if(!e.mobile.getAttribute(i,"defaults"))for(o in this.options)null!=(n=e.mobile.getAttribute(i,o.replace(/[A-Z]/g,t)))&&(r[o]=n);return r}}),e.mobile.widget=e.Widget}(e),function(e){var t="ui-loader",o=e("html");e.widget("mobile.loader",{options:{theme:"a",textVisible:!1,html:"",text:"loading"},defaultHtml:"<div class='"+t+"'><span class='ui-icon-loading'></span><h1></h1></div>",fakeFixLoader:function(){var t=e("."+e.mobile.activeBtnClass).first();this.element.css({top:e.support.scrollTop&&this.window.scrollTop()+this.window.height()/2||t.length&&t.offset().top||100})},checkLoaderPosition:function(){var t=this.element.offset(),o=this.window.scrollTop(),n=e.mobile.getScreenHeight();(t.top<o||t.top-o>n)&&(this.element.addClass("ui-loader-fakefix"),this.fakeFixLoader(),this.window.unbind("scroll",this.checkLoaderPosition).bind("scroll",e.proxy(this.fakeFixLoader,this)))},resetHtml:function(){this.element.html(e(this.defaultHtml).html())},show:function(n,i,r){var a,s,l;this.resetHtml(),"object"===e.type(n)?(l=e.extend({},this.options,n),n=l.theme):(l=this.options,n=n||l.theme),s=i||(!1===l.text?"":l.text),o.addClass("ui-loading"),a=l.textVisible,this.element.attr("class",t+" ui-corner-all ui-body-"+n+" ui-loader-"+(a||i||n.text?"verbose":"default")+(l.textonly||r?" ui-loader-textonly":"")),l.html?this.element.html(l.html):this.element.find("h1").text(s),this.element.appendTo(e.mobile.pageContainer),this.checkLoaderPosition(),this.window.bind("scroll",e.proxy(this.checkLoaderPosition,this))},hide:function(){o.removeClass("ui-loading"),this.options.text&&this.element.removeClass("ui-loader-fakefix"),e.mobile.window.unbind("scroll",this.fakeFixLoader),e.mobile.window.unbind("scroll",this.checkLoaderPosition)}})}(e),function(e,t,n){"$:nomunge";function i(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var r,a="hashchange",s=o,l=e.event.special,c=s.documentMode,u="on"+a in t&&(c===n||c>7);e.fn[a]=function(e){return e?this.bind(a,e):this.trigger(a)},e.fn[a].delay=50,l[a]=e.extend(l[a],{setup:function(){return!u&&void e(r.start)},teardown:function(){return!u&&void e(r.stop)}}),r=function(){function o(){var n=i(),s=d(c);n!==c?(g(c=n,s),e(t).trigger(a)):s!==c&&(location.href=location.href.replace(/#.*/,"")+s),r=setTimeout(o,e.fn[a].delay)}var r,l={},c=i(),m=function(e){return e},g=m,d=m;return l.start=function(){r||o()},l.stop=function(){r&&clearTimeout(r),r=n},t.attachEvent&&!t.addEventListener&&!u&&function(){var t,n;l.start=function(){t||(n=e.fn[a].src,n=n&&n+i(),t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||g(i()),o()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow,s.onpropertychange=function(){try{"title"===event.propertyName&&(t.document.title=s.title)}catch(e){}})},l.stop=m,d=function(){return i(t.location.href)},g=function(o,n){var i=t.document,r=e.fn[a].domain;o!==n&&(i.title=s.title,i.open(),r&&i.write('<script>document.domain="'+r+'"<\/script>'),i.close(),t.location.hash=o)}}(),l}()}(e,this),function(e){t.matchMedia=t.matchMedia||function(e){var t,o=e.documentElement,n=o.firstElementChild||o.firstChild,i=e.createElement("body"),r=e.createElement("div");return r.id="mq-test-1",r.style.cssText="position:absolute;top:-100em",i.style.background="none",i.appendChild(r),function(e){return r.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',o.insertBefore(i,n),t=42===r.offsetWidth,o.removeChild(i),{matches:t,media:e}}}(o),e.mobile.media=function(e){return t.matchMedia(e).matches}}(e),function(e){var t={touch:"ontouchend"in o};e.mobile.support=e.mobile.support||{},e.extend(e.support,t),e.extend(e.mobile.support,t)}(e),function(e){e.extend(e.support,{orientation:"orientation"in t&&"onorientationchange"in t})}(e),function(e,n){function i(e){var t,o=e.charAt(0).toUpperCase()+e.substr(1),i=(e+" "+c.join(o+" ")+o).split(" ");for(t in i)if(l[i[t]]!==n)return!0}function r(){var o=t,n=!(!o.document.createElementNS||!o.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||o.opera&&-1===navigator.userAgent.indexOf("Chrome")),i=function(t){t&&n||e("html").addClass("ui-nosvg")},r=new o.Image;r.onerror=function(){i(!1)},r.onload=function(){i(1===r.width&&1===r.height)},r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}var a,s=e("<body>").prependTo("html"),l=s[0].style,c=["Webkit","Moz","O"],u="palmGetResource"in t,m=t.operamini&&"[object OperaMini]"==={}.toString.call(t.operamini),g=t.blackberry&&!i("-webkit-transform");e.extend(e.mobile,{browser:{}}),e.mobile.browser.oldIE=function(){var e=3,t=o.createElement("div"),n=t.all||[];do{t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><br><![endif]--\x3e"}while(n[0]);return e>4?e:!e}(),e.extend(e.support,{pushState:"pushState"in history&&"replaceState"in history&&!(t.navigator.userAgent.indexOf("Firefox")>=0&&t.top!==t)&&-1===t.navigator.userAgent.search(/CriOS/),mediaquery:e.mobile.media("only all"),cssPseudoElement:!!i("content"),touchOverflow:!!i("overflowScrolling"),cssTransform3d:function(){var i,r,a,l="transform-3d",u=e.mobile.media("(-"+c.join("-"+l+"),(-")+"-"+l+"),("+l+")");if(u)return!!u;i=o.createElement("div"),r={MozTransform:"-moz-transform",transform:"transform"},s.append(i);for(a in r)i.style[a]!==n&&(i.style[a]="translate3d( 100px, 1px, 1px )",u=t.getComputedStyle(i).getPropertyValue(r[a]));return!!u&&"none"!==u}(),boxShadow:!!i("boxShadow")&&!g,fixedPosition:function(){var e=t,o=navigator.userAgent,n=navigator.platform,i=o.match(/AppleWebKit\/([0-9]+)/),r=!!i&&i[1],a=o.match(/Fennec\/([0-9]+)/),s=!!a&&a[1],l=o.match(/Opera Mobi\/([0-9]+)/),c=!!l&&l[1];return!((n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1)&&r&&534>r||e.operamini&&"[object OperaMini]"==={}.toString.call(e.operamini)||l&&7458>c||o.indexOf("Android")>-1&&r&&533>r||s&&6>s||"palmGetResource"in t&&r&&534>r||o.indexOf("MeeGo")>-1&&o.indexOf("NokiaBrowser/8.5.0")>-1)}(),scrollTop:("pageXOffset"in t||"scrollTop"in o.documentElement||"scrollTop"in s[0])&&!u&&!m,dynamicBaseTag:function(){var t,o,n=location.protocol+"//"+location.host+location.pathname+"ui-dir/",i=e("head base"),r=null,a="";return i.length?a=i.attr("href"):i=r=e("<base>",{href:n}).appendTo("head"),t=e("<a href='testurl' />").prependTo(s),o=t[0].href,i[0].href=a||location.pathname,r&&r.remove(),0===o.indexOf(n)}(),cssPointerEvents:function(){var e,n=o.createElement("x"),i=o.documentElement,r=t.getComputedStyle;return"pointerEvents"in n.style&&(n.style.pointerEvents="auto",n.style.pointerEvents="x",i.appendChild(n),e=r&&"auto"===r(n,"").pointerEvents,i.removeChild(n),!!e)}(),boundingRect:function(){return"undefined"!=typeof o.createElement("div").getBoundingClientRect}(),inlineSVG:r}),s.remove(),a=function(){var e=t.navigator.userAgent;return e.indexOf("Nokia")>-1&&(e.indexOf("Symbian/3")>-1||e.indexOf("Series60/5")>-1)&&e.indexOf("AppleWebKit")>-1&&e.match(/(BrowserNG|NokiaBrowser)\/7\.[0-3]/)}(),e.mobile.gradeA=function(){return(e.support.mediaquery&&e.support.cssPseudoElement||e.mobile.browser.oldIE&&e.mobile.browser.oldIE>=8)&&(e.support.boundingRect||null!==e.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/))},e.mobile.ajaxBlacklist=t.blackberry&&!t.WebKitPoint||m||a,a&&e(function(){e("head link[rel='stylesheet']").attr("rel","alternate stylesheet").attr("rel","stylesheet")}),e.support.boxShadow||e("html").addClass("ui-noboxshadow")}(e),function(e,t){var o,n=e.mobile.window,i=function(){};e.event.special.beforenavigate={setup:function(){n.on("navigate",i)},teardown:function(){n.off("navigate",i)}},e.event.special.navigate=o={bound:!1,pushStateEnabled:!0,originalEventName:void 0,isPushStateEnabled:function(){return e.support.pushState&&!0===e.mobile.pushStateEnabled&&this.isHashChangeEnabled()},isHashChangeEnabled:function(){return!0===e.mobile.hashListeningEnabled},popstate:function(t){var o=new e.Event("navigate"),i=new e.Event("beforenavigate"),r=t.originalEvent.state||{};i.originalEvent=t,n.trigger(i),i.isDefaultPrevented()||(t.historyState&&e.extend(r,t.historyState),o.originalEvent=t,setTimeout(function(){n.trigger(o,{state:r})},0))},hashchange:function(t){var o=new e.Event("navigate"),i=new e.Event("beforenavigate");i.originalEvent=t,n.trigger(i),i.isDefaultPrevented()||(o.originalEvent=t,n.trigger(o,{state:t.hashchangeState||{}}))},setup:function(){o.bound||(o.bound=!0,o.isPushStateEnabled()?(o.originalEventName="popstate",n.bind("popstate.navigate",o.popstate)):o.isHashChangeEnabled()&&(o.originalEventName="hashchange",n.bind("hashchange.navigate",o.hashchange)))}}}(e),function(e,o){var n,i,r="&ui-state=dialog";e.mobile.path=n={uiStateKey:"&ui-state",urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(e){var t=e?this.parseUrl(e):location,o=this.parseUrl(e||location.href).hash;return o="#"===o?"":o,t.protocol+"//"+t.host+t.pathname+t.search+o},getDocumentUrl:function(t){return t?e.extend({},n.documentUrl):n.documentUrl.href},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(t){if("object"===e.type(t))return t;var o=n.urlParseRE.exec(t||"")||[];return{href:o[0]||"",hrefNoHash:o[1]||"",hrefNoSearch:o[2]||"",domain:o[3]||"",protocol:o[4]||"",doubleSlash:o[5]||"",authority:o[6]||"",username:o[8]||"",password:o[9]||"",host:o[10]||"",hostname:o[11]||"",port:o[12]||"",pathname:o[13]||"",directory:o[14]||"",filename:o[15]||"",search:o[16]||"",hash:o[17]||""}},makePathAbsolute:function(e,t){var o,n,i,r;if(e&&"/"===e.charAt(0))return e;for(e=e||"",t=t?t.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"",o=t?t.split("/"):[],n=e.split("/"),i=0;i<n.length;i++)switch(r=n[i]){case".":break;case"..":o.length&&o.pop();break;default:o.push(r)}return"/"+o.join("/")},isSameDomain:function(e,t){return n.parseUrl(e).domain===n.parseUrl(t).domain},isRelativeUrl:function(e){return""===n.parseUrl(e).protocol},isAbsoluteUrl:function(e){return""!==n.parseUrl(e).protocol},makeUrlAbsolute:function(e,t){if(!n.isRelativeUrl(e))return e;t===o&&(t=this.documentBase);var i=n.parseUrl(e),r=n.parseUrl(t),a=i.protocol||r.protocol,s=i.protocol?i.doubleSlash:i.doubleSlash||r.doubleSlash,l=i.authority||r.authority,c=""!==i.pathname;return a+s+l+n.makePathAbsolute(i.pathname||r.filename,r.pathname)+(i.search||!c&&r.search||"")+i.hash},addSearchParams:function(t,o){var i=n.parseUrl(t),r="object"==typeof o?e.param(o):o,a=i.search||"?";return i.hrefNoSearch+a+("?"!==a.charAt(a.length-1)?"&":"")+r+(i.hash||"")},convertUrlToDataUrl:function(e){var o=n.parseUrl(e);return n.isEmbeddedPage(o)?o.hash.split(r)[0].replace(/^#/,"").replace(/\?.*$/,""):n.isSameDomain(o,this.documentBase)?o.hrefNoHash.replace(this.documentBase.domain,"").split(r)[0]:t.decodeURIComponent(e)},get:function(e){return e===o&&(e=n.parseLocation().hash),n.stripHash(e).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(e){location.hash=e},isPath:function(e){return/\//.test(e)},clean:function(e){return e.replace(this.documentBase.domain,"")},stripHash:function(e){return e.replace(/^#/,"")},stripQueryParams:function(e){return e.replace(/\?.*$/,"")},cleanHash:function(e){return n.stripHash(e.replace(/\?.*$/,"").replace(r,""))},isHashValid:function(e){return/^#[^#]+$/.test(e)},isExternal:function(e){var t=n.parseUrl(e);return!(!t.protocol||t.domain===this.documentUrl.domain)},hasProtocol:function(e){return/^(:?\w+:)/.test(e)},isEmbeddedPage:function(e){var t=n.parseUrl(e);return""!==t.protocol?!this.isPath(t.hash)&&t.hash&&(t.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&t.hrefNoHash===this.documentBase.hrefNoHash):/^#/.test(t.href)},squash:function(e,t){var o,i,r,a,s=this.isPath(e),l=this.parseUrl(e),c=l.hash,u="";return t=t||(n.isPath(e)?n.getLocation():n.getDocumentUrl()),i=s?n.stripHash(e):e,i=n.isPath(l.hash)?n.stripHash(l.hash):i,a=i.indexOf(this.uiStateKey),a>-1&&(u=i.slice(a),i=i.slice(0,a)),o=n.makeUrlAbsolute(i,t),r=this.parseUrl(o).search,s?((n.isPath(c)||0===c.replace("#","").indexOf(this.uiStateKey))&&(c=""),u&&-1===c.indexOf(this.uiStateKey)&&(c+=u),-1===c.indexOf("#")&&""!==c&&(c="#"+c),o=n.parseUrl(o),o=o.protocol+"//"+o.host+o.pathname+r+c):o+=o.indexOf("#")>-1?u:"#"+u,o},isPreservableHash:function(e){return 0===e.replace("#","").indexOf(this.uiStateKey)},hashToSelector:function(e){var t="#"===e.substring(0,1);return t&&(e=e.substring(1)),(t?"#":"")+e.replace(/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g,"\\$1")},getFilePath:function(t){var o="&"+e.mobile.subPageUrlKey;return t&&t.split(o)[0].split(r)[0]},isFirstPageUrl:function(t){var i=n.parseUrl(n.makeUrlAbsolute(t,this.documentBase)),r=i.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&i.hrefNoHash===this.documentBase.hrefNoHash,a=e.mobile.firstPage,s=a&&a[0]?a[0].id:o;return r&&(!i.hash||"#"===i.hash||s&&i.hash.replace(/^#/,"")===s)},isPermittedCrossDomainRequest:function(t,o){return e.mobile.allowCrossDomainPages&&("file:"===t.protocol||"content:"===t.protocol)&&-1!==o.search(/^https?:/)}},n.documentUrl=n.parseLocation(),i=e("head").find("base"),n.documentBase=i.length?n.parseUrl(n.makeUrlAbsolute(i.attr("href"),n.documentUrl.href)):n.documentUrl,n.documentBaseDiffers=n.documentUrl.hrefNoHash!==n.documentBase.hrefNoHash,n.getDocumentBase=function(t){return t?e.extend({},n.documentBase):n.documentBase.href},e.extend(e.mobile,{getDocumentUrl:n.getDocumentUrl,getDocumentBase:n.getDocumentBase})}(e),function(e,t){e.mobile.History=function(e,t){this.stack=e||[],this.activeIndex=t||0},e.extend(e.mobile.History.prototype,{getActive:function(){return this.stack[this.activeIndex]},getLast:function(){return this.stack[this.previousIndex]},getNext:function(){return this.stack[this.activeIndex+1]},getPrev:function(){return this.stack[this.activeIndex-1]},add:function(e,t){t=t||{},this.getNext()&&this.clearForward(),t.hash&&-1===t.hash.indexOf("#")&&(t.hash="#"+t.hash),t.url=e,this.stack.push(t),this.activeIndex=this.stack.length-1},clearForward:function(){this.stack=this.stack.slice(0,this.activeIndex+1)},find:function(e,t,o){t=t||this.stack;var n,i,r,a=t.length;for(i=0;a>i;i++)if(n=t[i],(decodeURIComponent(e)===decodeURIComponent(n.url)||decodeURIComponent(e)===decodeURIComponent(n.hash))&&(r=i,o))return r;return r},closest:function(e){var o,n=this.activeIndex;return o=this.find(e,this.stack.slice(0,n)),o===t&&(o=this.find(e,this.stack.slice(n),!0),o=o===t?o:o+n),o},direct:function(o){var n=this.closest(o.url),i=this.activeIndex;n!==t&&(this.activeIndex=n,this.previousIndex=i),i>n?(o.present||o.back||e.noop)(this.getActive(),"back"):n>i?(o.present||o.forward||e.noop)(this.getActive(),"forward"):n===t&&o.missing&&o.missing(this.getActive())}})}(e),function(e){var n=e.mobile.path,i=location.href;e.mobile.Navigator=function(t){this.history=t,this.ignoreInitialHashChange=!0,e.mobile.window.bind({"popstate.history":e.proxy(this.popstate,this),"hashchange.history":e.proxy(this.hashchange,this)})},e.extend(e.mobile.Navigator.prototype,{squash:function(i,r){var a,s,l=n.isPath(i)?n.stripHash(i):i;return s=n.squash(i),a=e.extend({hash:l,url:s},r),t.history.replaceState(a,a.title||o.title,s),a},hash:function(e,t){var o,i,r,a;return o=n.parseUrl(e),i=n.parseLocation(),i.pathname+i.search===o.pathname+o.search?r=o.hash?o.hash:o.pathname+o.search:n.isPath(e)?(a=n.parseUrl(t),r=a.pathname+a.search+(n.isPreservableHash(a.hash)?a.hash.replace("#",""):"")):r=e,r},go:function(i,r,a){var s,l,c,u,m=e.event.special.navigate.isPushStateEnabled();l=n.squash(i),c=this.hash(i,l),a&&c!==n.stripHash(n.parseLocation().hash)&&(this.preventNextHashChange=a),this.preventHashAssignPopState=!0,t.location.hash=c,this.preventHashAssignPopState=!1,s=e.extend({url:l,hash:c,title:o.title},r),m&&(u=new e.Event("popstate"),u.originalEvent={type:"popstate",state:null},this.squash(i,s),a||(this.ignorePopState=!0,e.mobile.window.trigger(u))),this.history.add(s.url,s)},popstate:function(t){var o,r;if(e.event.special.navigate.isPushStateEnabled())return this.preventHashAssignPopState?(this.preventHashAssignPopState=!1,void t.stopImmediatePropagation()):this.ignorePopState?void(this.ignorePopState=!1):!t.originalEvent.state&&1===this.history.stack.length&&this.ignoreInitialHashChange&&(this.ignoreInitialHashChange=!1,location.href===i)?void t.preventDefault():(o=n.parseLocation().hash,!t.originalEvent.state&&o?(r=this.squash(o),this.history.add(r.url,r),void(t.historyState=r)):void this.history.direct({url:(t.originalEvent.state||{}).url||o,present:function(o,n){t.historyState=e.extend({},o),t.historyState.direction=n}}))},hashchange:function(t){var i,r;if(e.event.special.navigate.isHashChangeEnabled()&&!e.event.special.navigate.isPushStateEnabled()){if(this.preventNextHashChange)return this.preventNextHashChange=!1,void t.stopImmediatePropagation();i=this.history,r=n.parseLocation().hash,this.history.direct({url:r,present:function(o,n){t.hashchangeState=e.extend({},o),t.hashchangeState.direction=n},missing:function(){i.add(r,{hash:r,title:o.title})}})}}})}(e),function(e){e.mobile.navigate=function(t,o,n){e.mobile.navigate.navigator.go(t,o,n)},e.mobile.navigate.history=new e.mobile.History,e.mobile.navigate.navigator=new e.mobile.Navigator(e.mobile.navigate.history);var t=e.mobile.path.parseLocation();e.mobile.navigate.history.add(t.href,{hash:t.hash})}(e),function(e,t){var n={animation:{},transition:{}},i=o.createElement("a"),r=["","webkit-","moz-","o-"];e.each(["animation","transition"],function(o,a){var s=0===o?a+"-name":a;e.each(r,function(o,r){return i.style[e.camelCase(r+s)]!==t?(n[a].prefix=r,!1):void 0}),n[a].duration=e.camelCase(n[a].prefix+a+"-duration"),n[a].event=e.camelCase(n[a].prefix+a+"-end"),""===n[a].prefix&&(n[a].event=n[a].event.toLowerCase())}),e.support.cssTransitions=n.transition.prefix!==t,e.support.cssAnimations=n.animation.prefix!==t,e(i).remove(),e.fn.animationComplete=function(i,r,a){var s,l,c=this,u=r&&"animation"!==r?"transition":"animation";return e.support.cssTransitions&&"transition"===u||e.support.cssAnimations&&"animation"===u?(a===t&&(e(this).context!==o&&(l=3e3*parseFloat(e(this).css(n[u].duration))),(0===l||l===t||isNaN(l))&&(l=e.fn.animationComplete.defaultDuration)),s=setTimeout(function(){e(c).off(n[u].event),i.apply(c)},l),e(this).one(n[u].event,function(){clearTimeout(s),i.call(this,arguments)})):(setTimeout(e.proxy(i,this),0),e(this))},e.fn.animationComplete.defaultDuration=1e3}(e),function(e,t,o,n){function i(e){for(;e&&"undefined"!=typeof e.originalEvent;)e=e.originalEvent;return e}function r(t,o){var r,a,s,l,c,u,m,g,d,p=t.type;if(t=e.Event(t),t.type=o,r=t.originalEvent,a=e.event.props,p.search(/^(mouse|click)/)>-1&&(a=y),r)for(m=a.length,l;m;)l=a[--m],t[l]=r[l];if(p.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1),-1!==p.search(/^touch/)&&(s=i(r),p=s.touches,c=s.changedTouches,u=p&&p.length?p[0]:c&&c.length?c[0]:n))for(g=0,d=C.length;d>g;g++)l=C[g],t[l]=u[l];return t}function a(t){for(var o,n,i={};t;){o=e.data(t,N);for(n in o)o[n]&&(i[n]=i.hasVirtualBinding=!0);t=t.parentNode}return i}function s(t,o){for(var n;t;){if((n=e.data(t,N))&&(!o||n[o]))return t;t=t.parentNode}return null}function l(){U=!1}function c(){U=!0}function u(){F=0,A.length=0,k=!1,c()}function m(){l()}function g(){d(),D=setTimeout(function(){D=0,u()},e.vmouse.resetTimerDuration)}function d(){D&&(clearTimeout(D),D=0)}function p(t,o,n){var i;return(n&&n[t]||!n&&s(o.target,t))&&(i=r(o,t),e(o.target).trigger(i)),i}function h(t){var o,n=e.data(t.target,w);k||F&&F===n||(o=p("v"+t.type,t))&&(o.isDefaultPrevented()&&t.preventDefault(),o.isPropagationStopped()&&t.stopPropagation(),o.isImmediatePropagationStopped()&&t.stopImmediatePropagation())}function f(t){var o,n,r,s=i(t).touches;s&&1===s.length&&(o=t.target,n=a(o),n.hasVirtualBinding&&(F=M++,e.data(o,w,F),d(),m(),O=!1,r=i(t).touches[0],G=r.pageX,x=r.pageY,p("vmouseover",t,n),p("vmousedown",t,n)))}function b(e){U||(O||p("vmousecancel",e,a(e.target)),O=!0,g())}function v(t){if(!U){var o=i(t).touches[0],n=O,r=e.vmouse.moveDistanceThreshold,s=a(t.target);O=O||Math.abs(o.pageX-G)>r||Math.abs(o.pageY-x)>r,
O&&!n&&p("vmousecancel",t,s),p("vmousemove",t,s),g()}}function _(e){if(!U){c();var t,o,n=a(e.target);p("vmouseup",e,n),O||(t=p("vclick",e,n))&&t.isDefaultPrevented()&&(o=i(e).changedTouches[0],A.push({touchID:F,x:o.clientX,y:o.clientY}),k=!0),p("vmouseout",e,n),O=!1,g()}}function E(t){var o,n=e.data(t,N);if(n)for(o in n)if(n[o])return!0;return!1}function T(){}var P,S,N="virtualMouseBindings",w="virtualTouchID",I="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),C="clientX clientY pageX pageY screenX screenY".split(" "),R=e.event.mouseHooks?e.event.mouseHooks.props:[],y=e.event.props.concat(R),L={},D=0,G=0,x=0,O=!1,A=[],k=!1,U=!1,V="addEventListener"in o,W=e(o),M=1,F=0;for(e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},S=0;S<I.length;S++)e.event.special[I[S]]=function(t){var o=t.substr(1);return{setup:function(){E(this)||e.data(this,N,{}),e.data(this,N)[t]=!0,L[t]=(L[t]||0)+1,1===L[t]&&W.bind(o,h),e(this).bind(o,T),V&&(L.touchstart=(L.touchstart||0)+1,1===L.touchstart&&W.bind("touchstart",f).bind("touchend",_).bind("touchmove",v).bind("scroll",b))},teardown:function(){--L[t],L[t]||W.unbind(o,h),V&&(--L.touchstart||W.unbind("touchstart",f).unbind("touchmove",v).unbind("touchend",_).unbind("scroll",b));var n=e(this),i=e.data(this,N);i&&(i[t]=!1),n.unbind(o,T),E(this)||n.removeData(N)}}}(I[S]);V&&o.addEventListener("click",function(t){var o,n,i,r,a,s=A.length,l=t.target;if(s)for(o=t.clientX,n=t.clientY,P=e.vmouse.clickDistanceThreshold,i=l;i;){for(r=0;s>r;r++)if(a=A[r],0,i===l&&Math.abs(a.x-o)<P&&Math.abs(a.y-n)<P||e.data(i,w)===a.touchID)return t.preventDefault(),void t.stopPropagation();i=i.parentNode}},!0)}(e,0,o),function(e,t,n){function i(t,o,i,r){var a=i.type;i.type=o,r?e.event.trigger(i,n,t):e.event.dispatch.call(t,i),i.type=a}var r=e(o),a=e.mobile.support.touch,s="touchmove scroll",l=a?"touchstart":"mousedown",c=a?"touchend":"mouseup",u=a?"touchmove":"mousemove";e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(t,o){e.fn[o]=function(e){return e?this.bind(o,e):this.trigger(o)},e.attrFn&&(e.attrFn[o]=!0)}),e.event.special.scrollstart={enabled:!0,setup:function(){function t(e,t){o=t,i(r,o?"scrollstart":"scrollstop",e)}var o,n,r=this;e(r).bind(s,function(i){e.event.special.scrollstart.enabled&&(o||t(i,!0),clearTimeout(n),n=setTimeout(function(){t(i,!1)},50))})},teardown:function(){e(this).unbind(s)}},e.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var t=this,o=e(t),n=!1;o.bind("vmousedown",function(a){function s(){clearTimeout(u)}function l(){s(),o.unbind("vclick",c).unbind("vmouseup",s),r.unbind("vmousecancel",l)}function c(e){l(),n||m!==e.target?n&&e.stopPropagation():i(t,"tap",e)}if(n=!1,a.which&&1!==a.which)return!1;var u,m=a.target;o.bind("vmouseup",s).bind("vclick",c),r.bind("vmousecancel",l),u=setTimeout(function(){e.event.special.tap.emitTapOnTaphold||(n=!0),i(t,"taphold",e.Event("taphold",{target:m}))},e.event.special.tap.tapholdThreshold)})},teardown:function(){e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),r.unbind("vmousecancel")}},e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(e){var o=t.pageXOffset,n=t.pageYOffset,i=e.clientX,r=e.clientY;return 0===e.pageY&&Math.floor(r)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)?(i-=o,r-=n):(r<e.pageY-n||i<e.pageX-o)&&(i=e.pageX-o,r=e.pageY-n),{x:i,y:r}},start:function(t){var o=t.originalEvent.touches?t.originalEvent.touches[0]:t,n=e.event.special.swipe.getLocation(o);return{time:(new Date).getTime(),coords:[n.x,n.y],origin:e(t.target)}},stop:function(t){var o=t.originalEvent.touches?t.originalEvent.touches[0]:t,n=e.event.special.swipe.getLocation(o);return{time:(new Date).getTime(),coords:[n.x,n.y]}},handleSwipe:function(t,o,n,r){if(o.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-o.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-o.coords[1])<e.event.special.swipe.verticalDistanceThreshold){var a=t.coords[0]>o.coords[0]?"swipeleft":"swiperight";return i(n,"swipe",e.Event("swipe",{target:r,swipestart:t,swipestop:o}),!0),i(n,a,e.Event(a,{target:r,swipestart:t,swipestop:o}),!0),!0}return!1},eventInProgress:!1,setup:function(){var t,o=this,n=e(o),i={};t=e.data(this,"mobile-events"),t||(t={length:0},e.data(this,"mobile-events",t)),t.length++,t.swipe=i,i.start=function(t){if(!e.event.special.swipe.eventInProgress){e.event.special.swipe.eventInProgress=!0;var n,a=e.event.special.swipe.start(t),s=t.target,l=!1;i.move=function(t){a&&(n=e.event.special.swipe.stop(t),l||(l=e.event.special.swipe.handleSwipe(a,n,o,s))&&(e.event.special.swipe.eventInProgress=!1),Math.abs(a.coords[0]-n.coords[0])>e.event.special.swipe.scrollSupressionThreshold&&t.preventDefault())},i.stop=function(){l=!0,e.event.special.swipe.eventInProgress=!1,r.off(u,i.move),i.move=null},r.on(u,i.move).one(c,i.stop)}},n.on(l,i.start)},teardown:function(){var t,o;t=e.data(this,"mobile-events"),t&&(o=t.swipe,delete t.swipe,0===--t.length&&e.removeData(this,"mobile-events")),o&&(o.start&&e(this).off(l,o.start),o.move&&r.off(u,o.move),o.stop&&r.off(c,o.stop))}},e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe",swiperight:"swipe"},function(t,o){e.event.special[t]={setup:function(){e(this).bind(o,e.noop)},teardown:function(){e(this).unbind(o)}}})}(e,this),function(e){e.event.special.throttledresize={setup:function(){e(this).bind("resize",i)},teardown:function(){e(this).unbind("resize",i)}};var t,o,n,i=function(){o=(new Date).getTime(),n=o-r,n>=250?(r=o,e(this).trigger("throttledresize")):(t&&clearTimeout(t),t=setTimeout(i,250-n))},r=0}(e),function(e,t){function n(){var e=i();e!==r&&(r=e,m.trigger(g))}var i,r,a,s,l,c,u,m=e(t),g="orientationchange",d={0:!0,180:!0};e.support.orientation&&(l=t.innerWidth||m.width(),c=t.innerHeight||m.height(),u=50,a=l>c&&l-c>u,s=d[t.orientation],(a&&s||!a&&!s)&&(d={"-90":!0,90:!0})),e.event.special.orientationchange=e.extend({},e.event.special.orientationchange,{setup:function(){return!(e.support.orientation&&!e.event.special.orientationchange.disabled)&&(r=i(),void m.bind("throttledresize",n))},teardown:function(){return!(e.support.orientation&&!e.event.special.orientationchange.disabled)&&void m.unbind("throttledresize",n)},add:function(e){var t=e.handler;e.handler=function(e){return e.orientation=i(),t.apply(this,arguments)}}}),e.event.special.orientationchange.orientation=i=function(){var n=!0,i=o.documentElement;return n=e.support.orientation?d[t.orientation]:i&&i.clientWidth/i.clientHeight<1.1,n?"portrait":"landscape"},e.fn[g]=function(e){return e?this.bind(g,e):this.trigger(g)},e.attrFn&&(e.attrFn[g]=!0)}(e,this),function(e){var t=e("head").children("base"),o={element:t.length?t:e("<base>",{href:e.mobile.path.documentBase.hrefNoHash}).prependTo(e("head")),linkSelector:"[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",set:function(t){e.mobile.dynamicBaseEnabled&&e.support.dynamicBaseTag&&o.element.attr("href",e.mobile.path.makeUrlAbsolute(t,e.mobile.path.documentBase))},rewrite:function(t,n){var i=e.mobile.path.get(t);n.find(o.linkSelector).each(function(t,o){var n=e(o).is("[href]")?"href":e(o).is("[src]")?"src":"action",r=e(o).attr(n);r=r.replace(location.protocol+"//"+location.host+location.pathname,""),/^(\w+:|#|\/)/.test(r)||e(o).attr(n,i+r)})},reset:function(){o.element.attr("href",e.mobile.path.documentBase.hrefNoSearch)}};e.mobile.base=o}(e),function(e,t){e.mobile.widgets={};var o=e.widget,n=e.mobile.keepNative;e.widget=function(o){return function(){var n=o.apply(this,arguments),i=n.prototype.widgetName;return n.initSelector=n.prototype.initSelector!==t?n.prototype.initSelector:":jqmData(role='"+i+"')",e.mobile.widgets[i]=n,n}}(e.widget),e.extend(e.widget,o),e.mobile.document.on("create",function(t){e(t.target).enhanceWithin()}),e.widget("mobile.page",{options:{theme:"a",domCache:!1,keepNativeDefault:e.mobile.keepNative,contentTheme:null,enhanced:!1},_createWidget:function(){e.Widget.prototype._createWidget.apply(this,arguments),this._trigger("init")},_create:function(){return!1!==this._trigger("beforecreate")&&(this.options.enhanced||this._enhance(),this._on(this.element,{pagebeforehide:"removeContainerBackground",pagebeforeshow:"_handlePageBeforeShow"}),this.element.enhanceWithin(),void("dialog"===e.mobile.getAttribute(this.element[0],"role")&&e.mobile.dialog&&this.element.dialog()))},_enhance:function(){var o="data-"+e.mobile.ns,n=this;this.options.role&&this.element.attr("data-"+e.mobile.ns+"role",this.options.role),this.element.attr("tabindex","0").addClass("ui-page ui-page-theme-"+this.options.theme),this.element.find("["+o+"role='content']").each(function(){var i=e(this),r=this.getAttribute(o+"theme")||t;n.options.contentTheme=r||n.options.contentTheme||n.options.dialog&&n.options.theme||"dialog"===n.element.jqmData("role")&&n.options.theme,i.addClass("ui-content"),n.options.contentTheme&&i.addClass("ui-body-"+n.options.contentTheme),i.attr("role","main").addClass("ui-content")})},bindRemove:function(t){var o=this.element;!o.data("mobile-page").options.domCache&&o.is(":jqmData(external-page='true')")&&o.bind("pagehide.remove",t||function(t,o){if(!o.samePage){var n=e(this),i=new e.Event("pageremove");n.trigger(i),i.isDefaultPrevented()||n.removeWithDependents()}})},_setOptions:function(o){o.theme!==t&&this.element.removeClass("ui-page-theme-"+this.options.theme).addClass("ui-page-theme-"+o.theme),o.contentTheme!==t&&this.element.find("[data-"+e.mobile.ns+"='content']").removeClass("ui-body-"+this.options.contentTheme).addClass("ui-body-"+o.contentTheme)},_handlePageBeforeShow:function(){this.setContainerBackground()},removeContainerBackground:function(){this.element.closest(":mobile-pagecontainer").pagecontainer({theme:"none"})},setContainerBackground:function(e){this.element.parent().pagecontainer({theme:e||this.options.theme})},keepNativeSelector:function(){var t=this.options,o=e.trim(t.keepNative||""),i=e.trim(e.mobile.keepNative),r=e.trim(t.keepNativeDefault),a=n===i?"":i,s=""===a?r:"";return(o?[o]:[]).concat(a?[a]:[]).concat(s?[s]:[]).join(", ")}})}(e),function(e,n){e.widget("mobile.pagecontainer",{options:{theme:"a"},initSelector:!1,_create:function(){this.setLastScrollEnabled=!0,this._on(this.window,{navigate:"_disableRecordScroll",scrollstop:"_delayedRecordScroll"}),this._on(this.window,{navigate:"_filterNavigateEvents"}),this._on({pagechange:"_afterContentChange"}),this.window.one("navigate",e.proxy(function(){this.setLastScrollEnabled=!0},this))},_setOptions:function(e){e.theme!==n&&"none"!==e.theme?this.element.removeClass("ui-overlay-"+this.options.theme).addClass("ui-overlay-"+e.theme):e.theme!==n&&this.element.removeClass("ui-overlay-"+this.options.theme),this._super(e)},_disableRecordScroll:function(){this.setLastScrollEnabled=!1},_enableRecordScroll:function(){this.setLastScrollEnabled=!0},_afterContentChange:function(){this.setLastScrollEnabled=!0,this._off(this.window,"scrollstop"),this._on(this.window,{scrollstop:"_delayedRecordScroll"})},_recordScroll:function(){if(this.setLastScrollEnabled){var e,t,o,n=this._getActiveHistory();n&&(e=this._getScroll(),t=this._getMinScroll(),o=this._getDefaultScroll(),n.lastScroll=t>e?o:e)}},_delayedRecordScroll:function(){setTimeout(e.proxy(this,"_recordScroll"),100)},_getScroll:function(){return this.window.scrollTop()},_getMinScroll:function(){return e.mobile.minScrollBack},_getDefaultScroll:function(){return e.mobile.defaultHomeScroll},_filterNavigateEvents:function(t,o){var n;t.originalEvent&&t.originalEvent.isDefaultPrevented()||(n=t.originalEvent.type.indexOf("hashchange")>-1?o.state.hash:o.state.url,n||(n=this._getHash()),n&&"#"!==n&&0!==n.indexOf("#"+e.mobile.path.uiStateKey)||(n=location.href),this._handleNavigate(n,o.state))},_getHash:function(){return e.mobile.path.parseLocation().hash},getActivePage:function(){return this.activePage},_getInitialContent:function(){return e.mobile.firstPage},_getHistory:function(){return e.mobile.navigate.history},_getActiveHistory:function(){return e.mobile.navigate.history.getActive()},_getDocumentBase:function(){return e.mobile.path.documentBase},back:function(){this.go(-1)},forward:function(){this.go(1)},go:function(o){if(e.mobile.hashListeningEnabled)t.history.go(o);else{var n=e.mobile.navigate.history.activeIndex,i=n+parseInt(o,10),r=e.mobile.navigate.history.stack[i].url,a=o>=1?"forward":"back";e.mobile.navigate.history.activeIndex=i,e.mobile.navigate.history.previousIndex=n,this.change(r,{direction:a,changeHash:!1,fromHashChange:!0})}},_handleDestination:function(t){var o;return"string"===e.type(t)&&(t=e.mobile.path.stripHash(t)),t&&(o=this._getHistory(),(t=e.mobile.path.isPath(t)?t:e.mobile.path.makeUrlAbsolute("#"+t,this._getDocumentBase()))===e.mobile.path.makeUrlAbsolute("#"+o.initialDst,this._getDocumentBase())&&o.stack.length&&o.stack[0].url!==o.initialDst.replace(e.mobile.dialogHashKey,"")&&(t=this._getInitialContent())),t||this._getInitialContent()},_handleDialog:function(t,o){var n,i,r=this.getActivePage();return r&&!r.hasClass("ui-dialog")?("back"===o.direction?this.back():this.forward(),!1):(n=o.pageUrl,i=this._getActiveHistory(),e.extend(t,{role:i.role,transition:i.transition,reverse:"back"===o.direction}),n)},_handleNavigate:function(t,o){var i=e.mobile.path.stripHash(t),r=this._getHistory(),a=0===r.stack.length?"none":n,s={changeHash:!1,fromHashChange:!0,reverse:"back"===o.direction};e.extend(s,o,{transition:(r.getLast()||{}).transition||a}),r.activeIndex>0&&i.indexOf(e.mobile.dialogHashKey)>-1&&r.initialDst!==i&&!1===(i=this._handleDialog(s,o))||this._changeContent(this._handleDestination(i),s)},_changeContent:function(t,o){e.mobile.changePage(t,o)},_getBase:function(){return e.mobile.base},_getNs:function(){return e.mobile.ns},_enhance:function(e,t){return e.page({role:t})},_include:function(e,t){e.appendTo(this.element),this._enhance(e,t.role),e.page("bindRemove")},_find:function(t){var o,n=this._createFileUrl(t),i=this._createDataUrl(t),r=this._getInitialContent();return o=this.element.children("[data-"+this._getNs()+"url='"+i+"']"),0===o.length&&i&&!e.mobile.path.isPath(i)&&(o=this.element.children(e.mobile.path.hashToSelector("#"+i)).attr("data-"+this._getNs()+"url",i).jqmData("url",i)),0===o.length&&e.mobile.path.isFirstPageUrl(n)&&r&&r.parent().length&&(o=e(r)),o},_getLoader:function(){return e.mobile.loading()},_showLoading:function(t,o,n,i){this._loadMsg||(this._loadMsg=setTimeout(e.proxy(function(){this._getLoader().loader("show",o,n,i),this._loadMsg=0},this),t))},_hideLoading:function(){clearTimeout(this._loadMsg),this._loadMsg=0,this._getLoader().loader("hide")},_showError:function(){this._hideLoading(),this._showLoading(0,e.mobile.pageLoadErrorMessageTheme,e.mobile.pageLoadErrorMessage,!0),setTimeout(e.proxy(this,"_hideLoading"),1500)},_parse:function(t,o){var n,i=e("<div></div>");return i.get(0).innerHTML=t,n=i.find(":jqmData(role='page'), :jqmData(role='dialog')").first(),n.length||(n=e("<div data-"+this._getNs()+"role='page'>"+(t.split(/<\/?body[^>]*>/gim)[1]||"")+"</div>")),n.attr("data-"+this._getNs()+"url",e.mobile.path.convertUrlToDataUrl(o)).attr("data-"+this._getNs()+"external-page",!0),n},_setLoadedTitle:function(t,o){var n=o.match(/<title[^>]*>([^<]*)/)&&RegExp.$1;n&&!t.jqmData("title")&&(n=e("<div>"+n+"</div>").text(),t.jqmData("title",n))},_isRewritableBaseTag:function(){return e.mobile.dynamicBaseEnabled&&!e.support.dynamicBaseTag},_createDataUrl:function(t){return e.mobile.path.convertUrlToDataUrl(t)},_createFileUrl:function(t){return e.mobile.path.getFilePath(t)},_triggerWithDeprecated:function(t,o,n){var i=e.Event("page"+t),r=e.Event(this.widgetName+t);return(n||this.element).trigger(i,o),this.element.trigger(r,o),{deprecatedEvent:i,event:r}},_loadSuccess:function(t,o,i,r){var a=this._createFileUrl(t),s=this._createDataUrl(t);return e.proxy(function(l,c,u){var m,g=new RegExp("(<[^>]+\\bdata-"+this._getNs()+"role=[\"']?page[\"']?[^>]*>)"),d=new RegExp("\\bdata-"+this._getNs()+"url=[\"']?([^\"'>]*)[\"']?");g.test(l)&&RegExp.$1&&d.test(RegExp.$1)&&RegExp.$1&&(a=e.mobile.path.getFilePath(e("<div>"+RegExp.$1+"</div>").text())),i.prefetch===n&&this._getBase().set(a),m=this._parse(l,a),this._setLoadedTitle(m,l),o.xhr=u,o.textStatus=c,o.page=m,o.content=m,this._trigger("load",n,o)&&(this._isRewritableBaseTag()&&m&&this._getBase().rewrite(a,m),this._include(m,i),t.indexOf("&"+e.mobile.subPageUrlKey)>-1&&(m=this.element.children("[data-"+this._getNs()+"url='"+s+"']")),i.showLoadMsg&&this._hideLoading(),this.element.trigger("pageload"),r.resolve(t,i,m))},this)},_loadDefaults:{type:"get",data:n,reloadPage:!1,reload:!1,role:n,showLoadMsg:!1,loadMsgDelay:50},load:function(t,o){var i,r,a,s,l=o&&o.deferred||e.Deferred(),c=e.extend({},this._loadDefaults,o),u=null,m=e.mobile.path.makeUrlAbsolute(t,this._findBaseWithDefault());return c.reload=c.reloadPage,c.data&&"get"===c.type&&(m=e.mobile.path.addSearchParams(m,c.data),c.data=n),c.data&&"post"===c.type&&(c.reload=!0),i=this._createFileUrl(m),r=this._createDataUrl(m),u=this._find(m),0===u.length&&e.mobile.path.isEmbeddedPage(i)&&!e.mobile.path.isFirstPageUrl(i)?void l.reject(m,c):(this._getBase().reset(),u.length&&!c.reload?(this._enhance(u,c.role),l.resolve(m,c,u),void(c.prefetch||this._getBase().set(t))):(s={url:t,absUrl:m,dataUrl:r,deferred:l,options:c},a=this._triggerWithDeprecated("beforeload",s),a.deprecatedEvent.isDefaultPrevented()||a.event.isDefaultPrevented()?void 0:(c.showLoadMsg&&this._showLoading(c.loadMsgDelay),c.prefetch===n&&this._getBase().reset(),e.mobile.allowCrossDomainPages||e.mobile.path.isSameDomain(e.mobile.path.documentUrl,m)?void e.ajax({url:i,type:c.type,data:c.data,contentType:c.contentType,dataType:"html",success:this._loadSuccess(m,s,c,l),error:this._loadError(m,s,c,l)}):void l.reject(m,c))))},_loadError:function(t,o,n,i){return e.proxy(function(r,a,s){this._getBase().set(e.mobile.path.get()),o.xhr=r,o.textStatus=a,o.errorThrown=s;var l=this._triggerWithDeprecated("loadfailed",o);l.deprecatedEvent.isDefaultPrevented()||l.event.isDefaultPrevented()||(n.showLoadMsg&&this._showError(),i.reject(t,n))},this)},_getTransitionHandler:function(t){return t=e.mobile._maybeDegradeTransition(t),e.mobile.transitionHandlers[t]||e.mobile.defaultTransitionHandler},_triggerCssTransitionEvents:function(t,o,n){var i=!1;n=n||"",o&&(t[0]===o[0]&&(i=!0),this._triggerWithDeprecated(n+"hide",{nextPage:t,samePage:i},o)),this._triggerWithDeprecated(n+"show",{prevPage:o||e("")},t)},_cssTransition:function(t,o,n){var i,r,a=n.transition,s=n.reverse,l=n.deferred;this._triggerCssTransitionEvents(t,o,"before"),this._hideLoading(),i=this._getTransitionHandler(a),r=new i(a,s,t,o).transition(),r.done(function(){l.resolve.apply(l,arguments)}),r.done(e.proxy(function(){this._triggerCssTransitionEvents(t,o)},this))},_releaseTransitionLock:function(){r=!1,i.length>0&&e.mobile.changePage.apply(null,i.pop())},_removeActiveLinkClass:function(t){e.mobile.removeActiveLinkClass(t)},_loadUrl:function(t,o,n){n.target=t,n.deferred=e.Deferred(),this.load(t,n),n.deferred.done(e.proxy(function(e,t,n){r=!1,t.absUrl=o.absUrl,this.transition(n,o,t)},this)),n.deferred.fail(e.proxy(function(){this._removeActiveLinkClass(!0),this._releaseTransitionLock(),this._triggerWithDeprecated("changefailed",o)},this))},_triggerPageBeforeChange:function(t,o,n){var i=new e.Event("pagebeforechange");return e.extend(o,{toPage:t,options:n}),o.absUrl="string"===e.type(t)?e.mobile.path.makeUrlAbsolute(t,this._findBaseWithDefault()):n.absUrl,this.element.trigger(i,o),!i.isDefaultPrevented()},change:function(t,o){if(r)return void i.unshift(arguments);var n=e.extend({},e.mobile.changePage.defaults,o),a={};n.fromPage=n.fromPage||this.activePage,this._triggerPageBeforeChange(t,a,n)&&(t=a.toPage,"string"===e.type(t)?(r=!0,this._loadUrl(t,a,n)):this.transition(t,a,n))},transition:function(t,a,s){var l,c,u,m,g,d,p,h,f,b,v,_,E;if(r)return void i.unshift([t,s]);if(this._triggerPageBeforeChange(t,a,s)&&(E=this._triggerWithDeprecated("beforetransition",a),!E.deprecatedEvent.isDefaultPrevented()&&!E.event.isDefaultPrevented())){if(r=!0,t[0]!==e.mobile.firstPage[0]||s.dataUrl||(s.dataUrl=e.mobile.path.documentUrl.hrefNoHash),l=s.fromPage,c=s.dataUrl&&e.mobile.path.convertUrlToDataUrl(s.dataUrl)||t.jqmData("url"),u=c,e.mobile.path.getFilePath(c),m=e.mobile.navigate.history.getActive(),g=0===e.mobile.navigate.history.activeIndex,d=0,p=o.title,h=("dialog"===s.role||"dialog"===t.jqmData("role"))&&!0!==t.jqmData("dialog"),l&&l[0]===t[0]&&!s.allowSamePageTransition)return r=!1,this._triggerWithDeprecated("transition",a),this.element.trigger("pagechange",a),void(s.fromHashChange&&e.mobile.navigate.history.direct({url:c}));t.page({role:s.role}),s.fromHashChange&&(d="back"===s.direction?-1:1);try{o.activeElement&&"body"!==o.activeElement.nodeName.toLowerCase()?e(o.activeElement).blur():e("input:focus, textarea:focus, select:focus").blur()}catch(T){}f=!1,h&&m&&(m.url&&m.url.indexOf(e.mobile.dialogHashKey)>-1&&this.activePage&&!this.activePage.hasClass("ui-dialog")&&e.mobile.navigate.history.activeIndex>0&&(s.changeHash=!1,f=!0),c=m.url||"",c+=!f&&c.indexOf("#")>-1?e.mobile.dialogHashKey:"#"+e.mobile.dialogHashKey,0===e.mobile.navigate.history.activeIndex&&c===e.mobile.navigate.history.initialDst&&(c+=e.mobile.dialogHashKey)),b=m?t.jqmData("title")||t.children(":jqmData(role='header')").find(".ui-title").text():p,b&&p===o.title&&(p=b),t.jqmData("title")||t.jqmData("title",p),s.transition=s.transition||(d&&!g?m.transition:n)||(h?e.mobile.defaultDialogTransition:e.mobile.defaultPageTransition),!d&&f&&(e.mobile.navigate.history.getActive().pageUrl=u),c&&!s.fromHashChange&&(!e.mobile.path.isPath(c)&&c.indexOf("#")<0&&(c="#"+c),v={transition:s.transition,title:p,pageUrl:u,role:s.role},!1!==s.changeHash&&e.mobile.hashListeningEnabled?e.mobile.navigate(c,v,!0):t[0]!==e.mobile.firstPage[0]&&e.mobile.navigate.history.add(c,v)),o.title=p,e.mobile.activePage=t,this.activePage=t,s.reverse=s.reverse||0>d,_=e.Deferred(),this._cssTransition(t,l,{transition:s.transition,reverse:s.reverse,deferred:_}),_.done(e.proxy(function(o,n,i,r,l){e.mobile.removeActiveLinkClass(),s.duplicateCachedPage&&s.duplicateCachedPage.remove(),l||e.mobile.focusPage(t),this._releaseTransitionLock(),this.element.trigger("pagechange",a),this._triggerWithDeprecated("transition",a)},this))}},_findBaseWithDefault:function(){return this.activePage&&e.mobile.getClosestBaseUrl(this.activePage)||e.mobile.path.documentBase.hrefNoHash}}),e.mobile.navreadyDeferred=e.Deferred();var i=[],r=!1}(e),function(e,o){function n(e){for(;e&&("string"!=typeof e.nodeName||"a"!==e.nodeName.toLowerCase());)e=e.parentNode;return e}var i=e.Deferred(),r=e.Deferred(),a=e.mobile.path.documentUrl,s=null;e.mobile.loadPage=function(t,o){var n;return o=o||{},n=o.pageContainer||e.mobile.pageContainer,o.deferred=e.Deferred(),n.pagecontainer("load",t,o),o.deferred.promise()},e.mobile.back=function(){var o=t.navigator;this.phonegapNavigationEnabled&&o&&o.app&&o.app.backHistory?o.app.backHistory():e.mobile.pageContainer.pagecontainer("back")},e.mobile.focusPage=function(e){var t=e.find("[autofocus]"),o=e.find(".ui-title:eq(0)");return t.length?void t.focus():void(o.length?o.focus():e.focus())},e.mobile._maybeDegradeTransition=e.mobile._maybeDegradeTransition||function(e){return e},e.mobile.changePage=function(t,o){e.mobile.pageContainer.pagecontainer("change",t,o)},e.mobile.changePage.defaults={transition:o,reverse:!1,changeHash:!0,fromHashChange:!1,role:o,duplicateCachedPage:o,pageContainer:o,showLoadMsg:!0,dataUrl:o,fromPage:o,allowSamePageTransition:!1},e.mobile._registerInternalEvents=function(){var i=function(t,o){var n,i,r,l,c=!0;return!(!e.mobile.ajaxEnabled||t.is(":jqmData(ajax='false')")||!t.jqmHijackable().length||t.attr("target"))&&(n=s&&s.attr("formaction")||t.attr("action"),l=(t.attr("method")||"get").toLowerCase(),n||(n=e.mobile.getClosestBaseUrl(t),"get"===l&&(n=e.mobile.path.parseUrl(n).hrefNoSearch),n===e.mobile.path.documentBase.hrefNoHash&&(n=a.hrefNoSearch)),n=e.mobile.path.makeUrlAbsolute(n,e.mobile.getClosestBaseUrl(t)),!(e.mobile.path.isExternal(n)&&!e.mobile.path.isPermittedCrossDomainRequest(a,n))&&(o||(i=t.serializeArray(),s&&s[0].form===t[0]&&(r=s.attr("name"))&&(e.each(i,function(e,t){return t.name===r?(r="",!1):void 0}),r&&i.push({name:r,value:s.attr("value")})),c={url:n,options:{type:l,data:e.param(i),transition:t.jqmData("transition"),reverse:"reverse"===t.jqmData("direction"),reloadPage:!0}}),c))};e.mobile.document.delegate("form","submit",function(t){var o;t.isDefaultPrevented()||(o=i(e(this)))&&(e.mobile.changePage(o.url,o.options),t.preventDefault())}),e.mobile.document.bind("vclick",function(t){var o,r,a=t.target,l=!1;if(!(t.which>1)&&e.mobile.linkBindingEnabled){if(s=e(a),e.data(a,"mobile-button")){if(!i(e(a).closest("form"),!0))return;a.parentNode&&(a=a.parentNode)}else{if(!(a=n(a))||"#"===e.mobile.path.parseUrl(a.getAttribute("href")||"#").hash)return;if(!e(a).jqmHijackable().length)return}~a.className.indexOf("ui-link-inherit")?a.parentNode&&(r=e.data(a.parentNode,"buttonElements")):r=e.data(a,"buttonElements"),r?a=r.outer:l=!0,o=e(a),l&&(o=o.closest(".ui-btn")),o.length>0&&!o.hasClass("ui-state-disabled")&&(e.mobile.removeActiveLinkClass(!0),e.mobile.activeClickedLink=o,e.mobile.activeClickedLink.addClass(e.mobile.activeBtnClass))}}),e.mobile.document.bind("click",function(i){if(e.mobile.linkBindingEnabled&&!i.isDefaultPrevented()){var r,s,l,c,u,m,g=n(i.target),d=e(g),p=function(){t.setTimeout(function(){e.mobile.removeActiveLinkClass(!0)},200)};if(e.mobile.activeClickedLink&&e.mobile.activeClickedLink[0]===i.target.parentNode&&p(),g&&!(i.which>1)&&d.jqmHijackable().length){if(d.is(":jqmData(rel='back')"))return e.mobile.back(),!1;if(r=e.mobile.getClosestBaseUrl(d),s=e.mobile.path.makeUrlAbsolute(d.attr("href")||"#",r),!e.mobile.ajaxEnabled&&!e.mobile.path.isEmbeddedPage(s))return void p();if(-1!==s.search("#")){if(!(s=s.replace(/[^#]*#/,"")))return void i.preventDefault();s=e.mobile.path.isPath(s)?e.mobile.path.makeUrlAbsolute(s,r):e.mobile.path.makeUrlAbsolute("#"+s,a.hrefNoHash)}if(l=d.is("[rel='external']")||d.is(":jqmData(ajax='false')")||d.is("[target]"),l||e.mobile.path.isExternal(s)&&!e.mobile.path.isPermittedCrossDomainRequest(a,s))return void p();c=d.jqmData("transition"),u="reverse"===d.jqmData("direction")||d.jqmData("back"),m=d.attr("data-"+e.mobile.ns+"rel")||o,e.mobile.changePage(s,{transition:c,reverse:u,role:m,link:d}),i.preventDefault()}}}),e.mobile.document.delegate(".ui-page","pageshow.prefetch",function(){var t=[];e(this).find("a:jqmData(prefetch)").each(function(){var o=e(this),n=o.attr("href");n&&-1===e.inArray(n,t)&&(t.push(n),e.mobile.loadPage(n,{role:o.attr("data-"+e.mobile.ns+"rel"),prefetch:!0}))})}),e.mobile.pageContainer.pagecontainer(),e.mobile.document.bind("pageshow",function(){r?r.done(e.mobile.resetActivePageHeight):e.mobile.resetActivePageHeight()}),e.mobile.window.bind("throttledresize",e.mobile.resetActivePageHeight)},e(function(){i.resolve()}),e.mobile.window.load(function(){r.resolve(),r=null}),e.when(i,e.mobile.navreadyDeferred).done(function(){e.mobile._registerInternalEvents()})}(e),function(e,t){e.mobile.Transition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.Transition.prototype,{toPreClass:" ui-page-pre-in",init:function(t,o,n,i){e.extend(this,{name:t,reverse:o,$to:n,$from:i,deferred:new e.Deferred})},cleanFrom:function(){this.$from.removeClass(e.mobile.activePageClass+" out in reverse "+this.name).height("")},beforeDoneIn:function(){},beforeDoneOut:function(){},beforeStartOut:function(){},doneIn:function(){this.beforeDoneIn(),this.$to.removeClass("out in reverse "+this.name).height(""),this.toggleViewportClass(),e.mobile.window.scrollTop()!==this.toScroll&&this.scrollPage(),this.sequential||this.$to.addClass(e.mobile.activePageClass),this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},doneOut:function(e,t,o,n){this.beforeDoneOut(),this.startIn(e,t,o,n)},hideIn:function(e){this.$to.css("z-index",-10),e.call(this),this.$to.css("z-index","")},scrollPage:function(){e.event.special.scrollstart.enabled=!1,(e.mobile.hideUrlBar||this.toScroll!==e.mobile.defaultHomeScroll)&&t.scrollTo(0,this.toScroll),setTimeout(function(){e.event.special.scrollstart.enabled=!0},150)},startIn:function(t,o,n,i){this.hideIn(function(){this.$to.addClass(e.mobile.activePageClass+this.toPreClass),i||e.mobile.focusPage(this.$to),this.$to.height(t+this.toScroll),n||this.scrollPage()}),this.$to.removeClass(this.toPreClass).addClass(this.name+" in "+o),n?this.doneIn():this.$to.animationComplete(e.proxy(function(){this.doneIn()},this))},startOut:function(t,o,n){this.beforeStartOut(t,o,n),this.$from.height(t+e.mobile.window.scrollTop()).addClass(this.name+" out"+o)},toggleViewportClass:function(){e.mobile.pageContainer.toggleClass("ui-mobile-viewport-transitioning viewport-"+this.name)},transition:function(){var t,o=this.reverse?" reverse":"",n=e.mobile.getScreenHeight(),i=!1!==e.mobile.maxTransitionWidth&&e.mobile.window.width()>e.mobile.maxTransitionWidth;return this.toScroll=e.mobile.navigate.history.getActive().lastScroll||e.mobile.defaultHomeScroll,t=!e.support.cssTransitions||!e.support.cssAnimations||i||!this.name||"none"===this.name||Math.max(e.mobile.window.scrollTop(),this.toScroll)>e.mobile.getMaxScrollForTransition(),this.toggleViewportClass(),this.$from&&!t?this.startOut(n,o,t):this.doneOut(n,o,t,!0),this.deferred.promise()}})}(e,this),function(e){e.mobile.SerialTransition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.SerialTransition.prototype,e.mobile.Transition.prototype,{sequential:!0,beforeDoneOut:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(t,o,n){this.$from.animationComplete(e.proxy(function(){this.doneOut(t,o,n)},this))}})}(e),function(e){e.mobile.ConcurrentTransition=function(){this.init.apply(this,arguments)},e.extend(e.mobile.ConcurrentTransition.prototype,e.mobile.Transition.prototype,{sequential:!1,beforeDoneIn:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(e,t,o){this.doneOut(e,t,o)}})}(e),function(e){var t=function(){return 3*e.mobile.getScreenHeight()};e.mobile.transitionHandlers={sequential:e.mobile.SerialTransition,simultaneous:e.mobile.ConcurrentTransition},e.mobile.defaultTransitionHandler=e.mobile.transitionHandlers.sequential,e.mobile.transitionFallbacks={},e.mobile._maybeDegradeTransition=function(t){return t&&!e.support.cssTransform3d&&e.mobile.transitionFallbacks[t]&&(t=e.mobile.transitionFallbacks[t]),t},e.mobile.getMaxScrollForTransition=e.mobile.getMaxScrollForTransition||t}(e),function(e){e.mobile.transitionFallbacks.flip="fade"}(e),function(e){e.mobile.transitionFallbacks.flow="fade"}(e),function(e){e.mobile.transitionFallbacks.pop="fade"}(e),function(e){e.mobile.transitionHandlers.slide=e.mobile.transitionHandlers.simultaneous,e.mobile.transitionFallbacks.slide="fade"}(e),function(e){e.mobile.transitionFallbacks.slidedown="fade"}(e),function(e){e.mobile.transitionFallbacks.slidefade="fade"}(e),function(e){e.mobile.transitionFallbacks.slideup="fade"}(e),function(e){e.mobile.transitionFallbacks.turn="fade"}(e),function(e){e.mobile.degradeInputs={color:!1,date:!1,datetime:!1,"datetime-local":!1,email:!1,month:!1,number:!1,range:"number",search:"text",tel:!1,time:!1,url:!1,week:!1},e.mobile.page.prototype.options.degradeInputs=e.mobile.degradeInputs,e.mobile.degradeInputsWithin=function(t){t=e(t),t.find("input").not(e.mobile.page.prototype.keepNativeSelector()).each(function(){var t,o,n,i,r=e(this),a=this.getAttribute("type"),s=e.mobile.degradeInputs[a]||"text";e.mobile.degradeInputs[a]&&(t=e("<div>").html(r.clone()).html(),o=t.indexOf(" type=")>-1,n=o?/\s+type=["']?\w+['"]?/:/\/?>/,
i=' type="'+s+'" data-'+e.mobile.ns+'type="'+a+'"'+(o?"":">"),r.replaceWith(t.replace(n,i)))})}}(e),function(e,t,o){e.widget("mobile.page",e.mobile.page,{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0,dialog:!1},_create:function(){this._super(),this.options.dialog&&(e.extend(this,{_inner:this.element.children(),_headerCloseButton:null}),this.options.enhanced||this._setCloseBtn(this.options.closeBtn))},_enhance:function(){this._super(),this.options.dialog&&this.element.addClass("ui-dialog").wrapInner(e("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(this.options.corners?" ui-corner-all":"")}))},_setOptions:function(t){var n,i,r=this.options;t.corners!==o&&this._inner.toggleClass("ui-corner-all",!!t.corners),t.overlayTheme!==o&&e.mobile.activePage[0]===this.element[0]&&(r.overlayTheme=t.overlayTheme,this._handlePageBeforeShow()),t.closeBtnText!==o&&(n=r.closeBtn,i=t.closeBtnText),t.closeBtn!==o&&(n=t.closeBtn),n&&this._setCloseBtn(n,i),this._super(t)},_handlePageBeforeShow:function(){this.options.overlayTheme&&this.options.dialog?(this.removeContainerBackground(),this.setContainerBackground(this.options.overlayTheme)):this._super()},_setCloseBtn:function(t,o){var n,i=this._headerCloseButton;t="left"===t?"left":"right"===t?"right":"none","none"===t?i&&(i.remove(),i=null):i?(i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+t),o&&i.text(o)):(n=this._inner.find(":jqmData(role='header')").first(),i=e("<a></a>",{href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+t}).attr("data-"+e.mobile.ns+"rel","back").text(o||this.options.closeBtnText||"").prependTo(n)),this._headerCloseButton=i}})}(e),function(e,t,o){e.widget("mobile.dialog",{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0},_handlePageBeforeShow:function(){this._isCloseable=!0,this.options.overlayTheme&&this.element.page("removeContainerBackground").page("setContainerBackground",this.options.overlayTheme)},_handlePageBeforeHide:function(){this._isCloseable=!1},_handleVClickSubmit:function(t){var o,n=e(t.target).closest("vclick"===t.type?"a":"form");n.length&&!n.jqmData("transition")&&(o={},o["data-"+e.mobile.ns+"transition"]=(e.mobile.navigate.history.getActive()||{}).transition||e.mobile.defaultDialogTransition,o["data-"+e.mobile.ns+"direction"]="reverse",n.attr(o))},_create:function(){var t=this.element,o=this.options;t.addClass("ui-dialog").wrapInner(e("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(o.corners?" ui-corner-all":"")})),e.extend(this,{_isCloseable:!1,_inner:t.children(),_headerCloseButton:null}),this._on(t,{vclick:"_handleVClickSubmit",submit:"_handleVClickSubmit",pagebeforeshow:"_handlePageBeforeShow",pagebeforehide:"_handlePageBeforeHide"}),this._setCloseBtn(o.closeBtn)},_setOptions:function(t){var n,i,r=this.options;t.corners!==o&&this._inner.toggleClass("ui-corner-all",!!t.corners),t.overlayTheme!==o&&e.mobile.activePage[0]===this.element[0]&&(r.overlayTheme=t.overlayTheme,this._handlePageBeforeShow()),t.closeBtnText!==o&&(n=r.closeBtn,i=t.closeBtnText),t.closeBtn!==o&&(n=t.closeBtn),n&&this._setCloseBtn(n,i),this._super(t)},_setCloseBtn:function(t,o){var n,i=this._headerCloseButton;t="left"===t?"left":"right"===t?"right":"none","none"===t?i&&(i.remove(),i=null):i?(i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+t),o&&i.text(o)):(n=this._inner.find(":jqmData(role='header')").first(),i=e("<a></a>",{role:"button",href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+t}).text(o||this.options.closeBtnText||"").prependTo(n),this._on(i,{click:"close"})),this._headerCloseButton=i},close:function(){var t=e.mobile.navigate.history;this._isCloseable&&(this._isCloseable=!1,e.mobile.hashListeningEnabled&&t.activeIndex>0?e.mobile.back():e.mobile.pageContainer.pagecontainer("back"))}})}(e),function(e,t){var o=function(e){return"ui-btn-icon-"+(null===e?"left":e)};e.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var t=this.element,o={accordion:t.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+(e.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=o,this._renderedOptions=this._getOptions(this.options),this.options.enhanced?(o.heading=e(".ui-collapsible-heading",this.element[0]),o.content=o.heading.next(),o.anchor=e("a",o.heading[0]).first(),o.status=o.anchor.children(".ui-collapsible-heading-status")):this._enhance(t,o),this._on(o.heading,{tap:function(){o.heading.find("a").first().addClass(e.mobile.activeBtnClass)},click:function(e){this._handleExpandCollapse(!o.heading.hasClass("ui-collapsible-heading-collapsed")),e.preventDefault(),e.stopPropagation()}})},_getOptions:function(t){var o,n=this._ui.accordion,i=this._ui.accordionWidget;t=e.extend({},t),n.length&&!i&&(this._ui.accordionWidget=i=n.data("mobile-collapsibleset"));for(o in t)t[o]=null!=t[o]?t[o]:i?i.options[o]:n.length?e.mobile.getAttribute(n[0],o.replace(/([A-Z])/g,"-$1").toLowerCase()):null,null==t[o]&&(t[o]=e.mobile.collapsible.defaults[o]);return t},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:""},_enhance:function(t,n){var i,r=this._renderedOptions,a=this._themeClassFromOption("ui-body-",r.contentTheme);return t.addClass("ui-collapsible "+(r.inset?"ui-collapsible-inset ":"")+(r.inset&&r.corners?"ui-corner-all ":"")+(a?"ui-collapsible-themed-content ":"")),n.originalHeading=t.children(this.options.heading).first(),n.content=t.wrapInner("<div class='ui-collapsible-content "+a+"'></div>").children(".ui-collapsible-content"),n.heading=n.originalHeading,n.heading.is("legend")&&(n.heading=e("<div role='heading'>"+n.heading.html()+"</div>"),n.placeholder=e("<div>\x3c!-- placeholder for legend --\x3e</div>").insertBefore(n.originalHeading),n.originalHeading.remove()),i=r.collapsed?r.collapsedIcon?"ui-icon-"+r.collapsedIcon:"":r.expandedIcon?"ui-icon-"+r.expandedIcon:"",n.status=e("<span class='ui-collapsible-heading-status'></span>"),n.anchor=n.heading.detach().addClass("ui-collapsible-heading").append(n.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn "+(i?i+" ":"")+(i?o(r.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",r.theme)+" "+(r.mini?"ui-mini ":"")),n.heading.insertBefore(n.content),this._handleExpandCollapse(this.options.collapsed),n},refresh:function(){this._applyOptions(this.options),this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(e){var n,i,r,a,s,l=this.element,c=this._renderedOptions,u=this._ui,m=u.anchor,g=u.status,d=this._getOptions(e);e.collapsed!==t&&this._handleExpandCollapse(e.collapsed),n=l.hasClass("ui-collapsible-collapsed"),n?d.expandCueText!==t&&g.text(d.expandCueText):d.collapseCueText!==t&&g.text(d.collapseCueText),s=d.collapsedIcon!==t?!1!==d.collapsedIcon:!1!==c.collapsedIcon,(d.iconpos!==t||d.collapsedIcon!==t||d.expandedIcon!==t)&&(m.removeClass([o(c.iconpos)].concat(c.expandedIcon?["ui-icon-"+c.expandedIcon]:[]).concat(c.collapsedIcon?["ui-icon-"+c.collapsedIcon]:[]).join(" ")),s&&m.addClass([o(d.iconpos!==t?d.iconpos:c.iconpos)].concat(n?["ui-icon-"+(d.collapsedIcon!==t?d.collapsedIcon:c.collapsedIcon)]:["ui-icon-"+(d.expandedIcon!==t?d.expandedIcon:c.expandedIcon)]).join(" "))),d.theme!==t&&(r=this._themeClassFromOption("ui-btn-",c.theme),i=this._themeClassFromOption("ui-btn-",d.theme),m.removeClass(r).addClass(i)),d.contentTheme!==t&&(r=this._themeClassFromOption("ui-body-",c.contentTheme),i=this._themeClassFromOption("ui-body-",d.contentTheme),u.content.removeClass(r).addClass(i)),d.inset!==t&&(l.toggleClass("ui-collapsible-inset",d.inset),a=!(!d.inset||!d.corners&&!c.corners)),d.corners!==t&&(a=!(!d.corners||!d.inset&&!c.inset)),a!==t&&l.toggleClass("ui-corner-all",a),d.mini!==t&&m.toggleClass("ui-mini",d.mini)},_setOptions:function(e){this._applyOptions(e),this._super(e),this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(t){var o=this._renderedOptions,n=this._ui;n.status.text(t?o.expandCueText:o.collapseCueText),n.heading.toggleClass("ui-collapsible-heading-collapsed",t).find("a").first().toggleClass("ui-icon-"+o.expandedIcon,!t).toggleClass("ui-icon-"+o.collapsedIcon,t||o.expandedIcon===o.collapsedIcon).removeClass(e.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",t),n.content.toggleClass("ui-collapsible-content-collapsed",t).attr("aria-hidden",t).trigger("updatelayout"),this.options.collapsed=t,this._trigger(t?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var e=this._ui;this.options.enhanced||(e.placeholder?(e.originalHeading.insertBefore(e.placeholder),e.placeholder.remove(),e.heading.remove()):(e.status.remove(),e.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),e.anchor.contents().unwrap(),e.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}}),e.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}}(e),function(e){e.mobile.behaviors.addFirstLastClasses={_getVisibles:function(e,t){var o;return t?o=e.not(".ui-screen-hidden"):(o=e.filter(":visible"),0===o.length&&(o=e.not(".ui-screen-hidden"))),o},_addFirstLastClasses:function(e,t,o){e.removeClass("ui-first-child ui-last-child"),t.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child"),o||this.element.trigger("updatelayout")},_removeFirstLastClasses:function(e){e.removeClass("ui-first-child ui-last-child")}}}(e),function(e,t){var o=":mobile-collapsible, "+e.mobile.collapsible.initSelector;e.widget("mobile.collapsibleset",e.extend({initSelector:":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')",options:e.extend({enhanced:!1},e.mobile.collapsible.defaults),_handleCollapsibleExpand:function(t){var o=e(t.target).closest(".ui-collapsible");o.parent().is(":mobile-collapsibleset, :jqmData(role='collapsible-set')")&&o.siblings(".ui-collapsible:not(.ui-collapsible-collapsed)").collapsible("collapse")},_create:function(){var t=this.element,o=this.options;e.extend(this,{_classes:""}),o.enhanced||(t.addClass("ui-collapsible-set "+this._themeClassFromOption("ui-group-theme-",o.theme)+" "+(o.corners&&o.inset?"ui-corner-all ":"")),this.element.find(e.mobile.collapsible.initSelector).collapsible()),this._on(t,{collapsibleexpand:"_handleCollapsibleExpand"})},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:""},_init:function(){this._refresh(!0),this.element.children(o).filter(":jqmData(collapsed='false')").collapsible("expand")},_setOptions:function(e){var o,n,i=this.element,r=this._themeClassFromOption("ui-group-theme-",e.theme);return r&&i.removeClass(this._themeClassFromOption("ui-group-theme-",this.options.theme)).addClass(r),e.inset!==t&&(n=!(!e.inset||!e.corners&&!this.options.corners)),e.corners!==t&&(n=!(!e.corners||!e.inset&&!this.options.inset)),n!==t&&i.toggleClass("ui-corner-all",n),o=this._super(e),this.element.children(":mobile-collapsible").collapsible("refresh"),o},_destroy:function(){var e=this.element;this._removeFirstLastClasses(e.children(o)),e.removeClass("ui-collapsible-set ui-corner-all "+this._themeClassFromOption("ui-group-theme-",this.options.theme)).children(":mobile-collapsible").collapsible("destroy")},_refresh:function(t){var n=this.element.children(o);this.element.find(e.mobile.collapsible.initSelector).not(".ui-collapsible").collapsible(),this._addFirstLastClasses(n,this._getVisibles(n,t),t)},refresh:function(){this._refresh(!1)}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e){e.fn.fieldcontain=function(){return this.addClass("ui-field-contain")}}(e),function(e){e.fn.grid=function(t){return this.each(function(){var o,n,i=e(this),r=e.extend({grid:null},t),a=i.children(),s={solo:1,a:2,b:3,c:4,d:5},l=r.grid;if(!l)if(a.length<=5)for(n in s)s[n]===a.length&&(l=n);else l="a",i.addClass("ui-grid-duo");o=s[l],i.addClass("ui-grid-"+l),a.filter(":nth-child("+o+"n+1)").addClass("ui-block-a"),o>1&&a.filter(":nth-child("+o+"n+2)").addClass("ui-block-b"),o>2&&a.filter(":nth-child("+o+"n+3)").addClass("ui-block-c"),o>3&&a.filter(":nth-child("+o+"n+4)").addClass("ui-block-d"),o>4&&a.filter(":nth-child("+o+"n+5)").addClass("ui-block-e")})}}(e),function(e,t){e.widget("mobile.navbar",{options:{iconpos:"top",grid:null},_create:function(){var t=this.element,n=t.find("a"),i=n.filter(":jqmData(icon)").length?this.options.iconpos:void 0;t.addClass("ui-navbar").attr("role","navigation").find("ul").jqmEnhanceable().grid({grid:this.options.grid}),n.each(function(){var t=e.mobile.getAttribute(this,"icon"),o=e.mobile.getAttribute(this,"theme"),n="ui-btn";o&&(n+=" ui-btn-"+o),t&&(n+=" ui-icon-"+t+" ui-btn-icon-"+i),e(this).addClass(n)}),t.delegate("a","vclick",function(){var t=e(this);t.hasClass("ui-state-disabled")||t.hasClass("ui-disabled")||t.hasClass(e.mobile.activeBtnClass)||(n.removeClass(e.mobile.activeBtnClass),t.addClass(e.mobile.activeBtnClass),e(o).one("pagehide",function(){t.removeClass(e.mobile.activeBtnClass)}))}),t.closest(".ui-page").bind("pagebeforeshow",function(){n.filter(".ui-state-persist").addClass(e.mobile.activeBtnClass)})}})}(e),function(e){var t=e.mobile.getAttribute;e.widget("mobile.listview",e.extend({options:{theme:null,countTheme:null,dividerTheme:null,icon:"carat-r",splitIcon:"carat-r",splitTheme:null,corners:!0,shadow:!0,inset:!1},_create:function(){var e=this,t="";t+=e.options.inset?" ui-listview-inset":"",e.options.inset&&(t+=e.options.corners?" ui-corner-all":"",t+=e.options.shadow?" ui-shadow":""),e.element.addClass(" ui-listview"+t),e.refresh(!0)},_findFirstElementByTagName:function(e,t,o,n){var i={};for(i[o]=i[n]=!0;e;){if(i[e.nodeName])return e;e=e[t]}return null},_addThumbClasses:function(t){var o,n,i=t.length;for(o=0;i>o;o++)n=e(this._findFirstElementByTagName(t[o].firstChild,"nextSibling","img","IMG")),n.length&&e(this._findFirstElementByTagName(n[0].parentNode,"parentNode","li","LI")).addClass(n.hasClass("ui-li-icon")?"ui-li-has-icon":"ui-li-has-thumb")},_getChildrenByTagName:function(t,o,n){var i=[],r={};for(r[o]=r[n]=!0,t=t.firstChild;t;)r[t.nodeName]&&i.push(t),t=t.nextSibling;return e(i)},_beforeListviewRefresh:e.noop,_afterListviewRefresh:e.noop,refresh:function(o){var n,i,r,a,s,l,c,u,m,g,d,p,h,f,b,v,_,E,T,P,S=this.options,N=this.element,w=!!e.nodeName(N[0],"ol"),I=N.attr("start"),C={},R=N.find(".ui-li-count"),y=t(N[0],"counttheme")||this.options.countTheme,L=y?"ui-body-"+y:"ui-body-inherit";for(S.theme&&N.addClass("ui-group-theme-"+S.theme),w&&(I||0===I)&&(d=parseInt(I,10)-1,N.css("counter-reset","listnumbering "+d)),this._beforeListviewRefresh(),P=this._getChildrenByTagName(N[0],"li","LI"),i=0,r=P.length;r>i;i++)a=P.eq(i),s="",(o||a[0].className.search(/\bui-li-static\b|\bui-li-divider\b/)<0)&&(m=this._getChildrenByTagName(a[0],"a","A"),g="list-divider"===t(a[0],"role"),h=a.attr("value"),l=t(a[0],"theme"),m.length&&m[0].className.search(/\bui-btn\b/)<0&&!g?(c=t(a[0],"icon"),u=!1!==c&&(c||S.icon),m.removeClass("ui-link"),n="ui-btn",l&&(n+=" ui-btn-"+l),m.length>1?(s="ui-li-has-alt",f=m.last(),b=t(f[0],"theme")||S.splitTheme||t(a[0],"theme",!0),v=b?" ui-btn-"+b:"",_=t(f[0],"icon")||t(a[0],"icon")||S.splitIcon,E="ui-btn ui-btn-icon-notext ui-icon-"+_+v,f.attr("title",e.trim(f.getEncodedText())).addClass(E).empty()):u&&(n+=" ui-btn-icon-right ui-icon-"+u),m.first().addClass(n)):g?(T=t(a[0],"theme")||S.dividerTheme||S.theme,s="ui-li-divider ui-bar-"+(T||"inherit"),a.attr("role","heading")):m.length<=0&&(s="ui-li-static ui-body-"+(l||"inherit")),w&&h&&(p=parseInt(h,10)-1,a.css("counter-reset","listnumbering "+p))),C[s]||(C[s]=[]),C[s].push(a[0]);for(s in C)e(C[s]).addClass(s);R.each(function(){e(this).closest("li").addClass("ui-li-has-count")}),L&&R.addClass(L),this._addThumbClasses(P),this._addThumbClasses(P.find(".ui-btn")),this._afterListviewRefresh(),this._addFirstLastClasses(P,this._getVisibles(P,o),o)}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e){function t(t){var o=e.trim(t.text())||null;return o?o=o.slice(0,1).toUpperCase():null}e.widget("mobile.listview",e.mobile.listview,{options:{autodividers:!1,autodividersSelector:t},_beforeListviewRefresh:function(){this.options.autodividers&&(this._replaceDividers(),this._superApply(arguments))},_replaceDividers:function(){var t,n,i,r,a,s=null,l=this.element;for(l.children("li:jqmData(role='list-divider')").remove(),n=l.children("li"),t=0;t<n.length;t++)i=n[t],r=this.options.autodividersSelector(e(i)),r&&s!==r&&(a=o.createElement("li"),a.appendChild(o.createTextNode(r)),a.setAttribute("data-"+e.mobile.ns+"role","list-divider"),i.parentNode.insertBefore(a,i)),s=r}})}(e),function(e){e.widget("mobile.listview",e.mobile.listview,{options:{hideDividers:!1},_afterListviewRefresh:function(){var e,t,o,n=!0;if(this._superApply(arguments),this.options.hideDividers)for(e=this._getChildrenByTagName(this.element[0],"li","LI"),t=e.length-1;t>-1;t--)o=e[t],o.className.match(/(^|\s)ui-li-divider($|\s)/)?(n&&(o.className=o.className+" ui-screen-hidden"),n=!0):o.className.match(/(^|\s)ui-screen-hidden($|\s)/)||(n=!1)}})}(e),function(e){e.mobile.nojs=function(t){e(":jqmData(role='nojs')",t).addClass("ui-nojs")}}(e),function(e){e.mobile.behaviors.formReset={_handleFormReset:function(){this._on(this.element.closest("form"),{reset:function(){this._delay("_reset")}})}}}(e),function(e,t){var o=e.mobile.path.hashToSelector;e.widget("mobile.checkboxradio",e.extend({initSelector:"input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",options:{theme:"inherit",mini:!1,wrapperClass:null,enhanced:!1,iconpos:"left"},_create:function(){var t=this.element,n=this.options,i=function(e,t){return e.jqmData(t)||e.closest("form, fieldset").jqmData(t)},r=t.closest("label"),a=r.length?r:t.closest("form, fieldset, :jqmData(role='page'), :jqmData(role='dialog')").find("label").filter("[for='"+o(t[0].id)+"']").first(),s=t[0].type,l="ui-"+s+"-on",c="ui-"+s+"-off";("checkbox"===s||"radio"===s)&&(this.element[0].disabled&&(this.options.disabled=!0),n.iconpos=i(t,"iconpos")||a.attr("data-"+e.mobile.ns+"iconpos")||n.iconpos,n.mini=i(t,"mini")||n.mini,e.extend(this,{input:t,label:a,parentLabel:r,inputtype:s,checkedClass:l,uncheckedClass:c}),this.options.enhanced||this._enhance(),this._on(a,{vmouseover:"_handleLabelVMouseOver",vclick:"_handleLabelVClick"}),this._on(t,{vmousedown:"_cacheVals",vclick:"_handleInputVClick",focus:"_handleInputFocus",blur:"_handleInputBlur"}),this._handleFormReset(),this.refresh())},_enhance:function(){this.label.addClass("ui-btn ui-corner-all"),this.parentLabel.length>0?this.input.add(this.label).wrapAll(this._wrapper()):(this.element.wrap(this._wrapper()),this.element.parent().prepend(this.label)),this._setOptions({theme:this.options.theme,iconpos:this.options.iconpos,mini:this.options.mini})},_wrapper:function(){return e("<div class='"+(this.options.wrapperClass?this.options.wrapperClass:"")+" ui-"+this.inputtype+(this.options.disabled?" ui-state-disabled":"")+"' ></div>")},_handleInputFocus:function(){this.label.addClass(e.mobile.focusClass)},_handleInputBlur:function(){this.label.removeClass(e.mobile.focusClass)},_handleInputVClick:function(){this.element.prop("checked",this.element.is(":checked")),this._getInputSet().not(this.element).prop("checked",!1),this._updateAll()},_handleLabelVMouseOver:function(e){this.label.parent().hasClass("ui-state-disabled")&&e.stopPropagation()},_handleLabelVClick:function(e){var t=this.element;return t.is(":disabled")?void e.preventDefault():(this._cacheVals(),t.prop("checked","radio"===this.inputtype&&!0||!t.prop("checked")),t.triggerHandler("click"),this._getInputSet().not(t).prop("checked",!1),this._updateAll(),!1)},_cacheVals:function(){this._getInputSet().each(function(){e(this).attr("data-"+e.mobile.ns+"cacheVal",this.checked)})},_getInputSet:function(){var t,n,i=this.element[0],r=i.name,a=i.form,s=this.element.parents().last().get(0),l=this.element;return r&&"radio"===this.inputtype&&s&&(t="input[type='radio'][name='"+o(r)+"']",a?(n=a.id,n&&(l=e(t+"[form='"+o(n)+"']",s)),l=e(a).find(t).filter(function(){return this.form===a}).add(l)):l=e(t,s).filter(function(){return!this.form})),l},_updateAll:function(){var t=this;this._getInputSet().each(function(){var o=e(this);(this.checked||"checkbox"===t.inputtype)&&o.trigger("change")}).checkboxradio("refresh")},_reset:function(){this.refresh()},_hasIcon:function(){var t,o,n=e.mobile.controlgroup;return!(n&&(t=this.element.closest(":mobile-controlgroup,"+n.prototype.initSelector),t.length>0))||(o=e.data(t[0],"mobile-controlgroup"),"horizontal"!==(o?o.options.type:t.attr("data-"+e.mobile.ns+"type")))},refresh:function(){var t=this._hasIcon(),o=this.element[0].checked,n=e.mobile.activeBtnClass,i="ui-btn-icon-"+this.options.iconpos,r=[],a=[];t?(a.push(n),r.push(i)):(a.push(i),(o?r:a).push(n)),o?(r.push(this.checkedClass),a.push(this.uncheckedClass)):(r.push(this.uncheckedClass),a.push(this.checkedClass)),this.label.addClass(r.join(" ")).removeClass(a.join(" "))},widget:function(){return this.label.parent()},_setOptions:function(e){var o=this.label,n=this.options,i=this.widget(),r=this._hasIcon();e.disabled!==t&&(this.input.prop("disabled",!!e.disabled),i.toggleClass("ui-state-disabled",!!e.disabled)),e.mini!==t&&i.toggleClass("ui-mini",!!e.mini),e.theme!==t&&o.removeClass("ui-btn-"+n.theme).addClass("ui-btn-"+e.theme),e.wrapperClass!==t&&i.removeClass(n.wrapperClass).addClass(e.wrapperClass),e.iconpos!==t&&r?o.removeClass("ui-btn-icon-"+n.iconpos).addClass("ui-btn-icon-"+e.iconpos):r||o.removeClass("ui-btn-icon-"+n.iconpos),this._super(e)}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.button",{initSelector:"input[type='button'], input[type='submit'], input[type='reset']",options:{theme:null,icon:null,iconpos:"left",iconshadow:!1,corners:!0,shadow:!0,inline:null,mini:null,wrapperClass:null,enhanced:!1},_create:function(){this.element.is(":disabled")&&(this.options.disabled=!0),this.options.enhanced||this._enhance(),e.extend(this,{wrapper:this.element.parent()}),this._on({focus:function(){this.widget().addClass(e.mobile.focusClass)},blur:function(){this.widget().removeClass(e.mobile.focusClass)}}),this.refresh(!0)},_enhance:function(){this.element.wrap(this._button())},_button:function(){var t=this.options,o=this._getIconClasses(this.options);return e("<div class='ui-btn ui-input-btn"+(t.wrapperClass?" "+t.wrapperClass:"")+(t.theme?" ui-btn-"+t.theme:"")+(t.corners?" ui-corner-all":"")+(t.shadow?" ui-shadow":"")+(t.inline?" ui-btn-inline":"")+(t.mini?" ui-mini":"")+(t.disabled?" ui-state-disabled":"")+(o?" "+o:"")+"' >"+this.element.val()+"</div>")},widget:function(){return this.wrapper},_destroy:function(){this.element.insertBefore(this.button),this.button.remove()},_getIconClasses:function(e){return e.icon?"ui-icon-"+e.icon+(e.iconshadow?" ui-shadow-icon":"")+" ui-btn-icon-"+e.iconpos:""},_setOptions:function(o){var n=this.widget();o.theme!==t&&n.removeClass(this.options.theme).addClass("ui-btn-"+o.theme),o.corners!==t&&n.toggleClass("ui-corner-all",o.corners),o.shadow!==t&&n.toggleClass("ui-shadow",o.shadow),o.inline!==t&&n.toggleClass("ui-btn-inline",o.inline),o.mini!==t&&n.toggleClass("ui-mini",o.mini),o.disabled!==t&&(this.element.prop("disabled",o.disabled),n.toggleClass("ui-state-disabled",o.disabled)),(o.icon!==t||o.iconshadow!==t||o.iconpos!==t)&&n.removeClass(this._getIconClasses(this.options)).addClass(this._getIconClasses(e.extend({},this.options,o))),this._super(o)},refresh:function(t){var o,n=this.element.prop("disabled");this.options.icon&&"notext"===this.options.iconpos&&this.element.attr("title")&&this.element.attr("title",this.element.val()),t||(o=this.element.detach(),e(this.wrapper).text(this.element.val()).append(o)),this.options.disabled!==n&&this._setOptions({disabled:n})}})}(e),function(e){var t=e("meta[name=viewport]"),o=t.attr("content"),n=o+",maximum-scale=1, user-scalable=no",i=o+",maximum-scale=10, user-scalable=yes",r=/(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test(o);e.mobile.zoom=e.extend({},{enabled:!r,locked:!1,disable:function(o){r||e.mobile.zoom.locked||(t.attr("content",n),e.mobile.zoom.enabled=!1,e.mobile.zoom.locked=o||!1)},enable:function(o){r||e.mobile.zoom.locked&&!0!==o||(t.attr("content",i),e.mobile.zoom.enabled=!0,e.mobile.zoom.locked=!1)},restore:function(){r||(t.attr("content",o),e.mobile.zoom.enabled=!0)}})}(e),function(e,t){e.widget("mobile.textinput",{initSelector:"input[type='text'],input[type='search'],:jqmData(type='search'),input[type='number'],:jqmData(type='number'),input[type='password'],input[type='email'],input[type='url'],input[type='tel'],textarea,input[type='time'],input[type='date'],input[type='month'],input[type='week'],input[type='datetime'],input[type='datetime-local'],input[type='color'],input:not([type]),input[type='file']",options:{theme:null,corners:!0,mini:!1,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,wrapperClass:"",enhanced:!1},_create:function(){var t=this.options,o=this.element.is("[type='search'], :jqmData(type='search')"),n="TEXTAREA"===this.element[0].tagName,i=this.element.is("[data-"+(e.mobile.ns||"")+"type='range']"),r=(this.element.is("input")||this.element.is("[data-"+(e.mobile.ns||"")+"type='search']"))&&!i;this.element.prop("disabled")&&(t.disabled=!0),e.extend(this,{classes:this._classesFromOptions(),isSearch:o,isTextarea:n,isRange:i,inputNeedsWrap:r}),this._autoCorrect(),t.enhanced||this._enhance(),this._on({focus:"_handleFocus",blur:"_handleBlur"})},refresh:function(){this.setOptions({disabled:this.element.is(":disabled")})},_enhance:function(){var e=[];this.isTextarea&&e.push("ui-input-text"),(this.isTextarea||this.isRange)&&e.push("ui-shadow-inset"),this.inputNeedsWrap?this.element.wrap(this._wrap()):e=e.concat(this.classes),this.element.addClass(e.join(" "))},widget:function(){return this.inputNeedsWrap?this.element.parent():this.element},_classesFromOptions:function(){var e=this.options,t=[];return t.push("ui-body-"+(null===e.theme?"inherit":e.theme)),e.corners&&t.push("ui-corner-all"),e.mini&&t.push("ui-mini"),e.disabled&&t.push("ui-state-disabled"),e.wrapperClass&&t.push(e.wrapperClass),t},_wrap:function(){return e("<div class='"+(this.isSearch?"ui-input-search ":"ui-input-text ")+this.classes.join(" ")+" ui-shadow-inset'></div>")},_autoCorrect:function(){"undefined"==typeof this.element[0].autocorrect||e.support.touchOverflow||(this.element[0].setAttribute("autocorrect","off"),this.element[0].setAttribute("autocomplete","off"))},_handleBlur:function(){this.widget().removeClass(e.mobile.focusClass),this.options.preventFocusZoom&&e.mobile.zoom.enable(!0)},_handleFocus:function(){this.options.preventFocusZoom&&e.mobile.zoom.disable(!0),this.widget().addClass(e.mobile.focusClass)},_setOptions:function(e){var o=this.widget();this._super(e),(e.disabled!==t||e.mini!==t||e.corners!==t||e.theme!==t||e.wrapperClass!==t)&&(o.removeClass(this.classes.join(" ")),this.classes=this._classesFromOptions(),o.addClass(this.classes.join(" "))),e.disabled!==t&&this.element.prop("disabled",!!e.disabled)},_destroy:function(){this.options.enhanced||(this.inputNeedsWrap&&this.element.unwrap(),this.element.removeClass("ui-input-text "+this.classes.join(" ")))}})}(e),function(e,n){e.widget("mobile.slider",e.extend({initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",widgetEventPrefix:"slide",options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!1},_create:function(){var i,r,a,s,l,c,u,m,g,d,p=this,h=this.element,f=this.options.trackTheme||e.mobile.getAttribute(h[0],"theme"),b=f?" ui-bar-"+f:" ui-bar-inherit",v=this.options.corners||h.jqmData("corners")?" ui-corner-all":"",_=this.options.mini||h.jqmData("mini")?" ui-mini":"",E=h[0].nodeName.toLowerCase(),T="select"===E,P=h.parent().is(":jqmData(role='rangeslider')"),S=T?"ui-slider-switch":"",N=h.attr("id"),w=e("[for='"+N+"']"),I=w.attr("id")||N+"-label",C=T?0:parseFloat(h.attr("min")),R=T?h.find("option").length-1:parseFloat(h.attr("max")),y=t.parseFloat(h.attr("step")||1),L=o.createElement("a"),D=e(L),G=o.createElement("div"),x=e(G),O=!(!this.options.highlight||T)&&function(){var t=o.createElement("div");return t.className="ui-slider-bg "+e.mobile.activeBtnClass,e(t).prependTo(x)}();if(w.attr("id",I),this.isToggleSwitch=T,L.setAttribute("href","#"),G.setAttribute("role","application"),G.className=[this.isToggleSwitch?"ui-slider ui-slider-track ui-shadow-inset ":"ui-slider-track ui-shadow-inset ",S,b,v,_].join(""),L.className="ui-slider-handle",G.appendChild(L),D.attr({role:"slider","aria-valuemin":C,"aria-valuemax":R,"aria-valuenow":this._value(),"aria-valuetext":this._value(),title:this._value(),"aria-labelledby":I}),e.extend(this,{slider:x,handle:D,control:h,type:E,step:y,max:R,min:C,valuebg:O,isRangeslider:P,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),T){for(u=h.attr("tabindex"),u&&D.attr("tabindex",u),h.attr("tabindex","-1").focus(function(){e(this).blur(),D.focus()}),r=o.createElement("div"),r.className="ui-slider-inneroffset",a=0,s=G.childNodes.length;s>a;a++)r.appendChild(G.childNodes[a]);for(G.appendChild(r),D.addClass("ui-slider-handle-snapping"),i=h.find("option"),l=0,c=i.length;c>l;l++)m=l?"a":"b",g=l?" "+e.mobile.activeBtnClass:"",d=o.createElement("span"),d.className=["ui-slider-label ui-slider-label-",m,g].join(""),d.setAttribute("role","img"),d.appendChild(o.createTextNode(i[l].innerHTML)),e(d).prependTo(x);p._labels=e(".ui-slider-label",x)}h.addClass(T?"ui-slider-switch":"ui-slider-input"),this._on(h,{change:"_controlChange",keyup:"_controlKeyup",blur:"_controlBlur",vmouseup:"_controlVMouseUp"}),x.bind("vmousedown",e.proxy(this._sliderVMouseDown,this)).bind("vclick",!1),this._on(o,{vmousemove:"_preventDocumentDrag"}),this._on(x.add(o),{vmouseup:"_sliderVMouseUp"}),x.insertAfter(h),T||P||(r=this.options.mini?"<div class='ui-slider ui-mini'>":"<div class='ui-slider'>",h.add(x).wrapAll(r)),this._on(this.handle,{vmousedown:"_handleVMouseDown",keydown:"_handleKeydown",keyup:"_handleKeyup"}),this.handle.bind("vclick",!1),this._handleFormReset(),this.refresh(n,n,!0)},_setOptions:function(e){e.theme!==n&&this._setTheme(e.theme),e.trackTheme!==n&&this._setTrackTheme(e.trackTheme),e.corners!==n&&this._setCorners(e.corners),e.mini!==n&&this._setMini(e.mini),e.highlight!==n&&this._setHighlight(e.highlight),e.disabled!==n&&this._setDisabled(e.disabled),this._super(e)},_controlChange:function(e){return!1!==this._trigger("controlchange",e)&&void(this.mouseMoved||this.refresh(this._value(),!0))},_controlKeyup:function(){this.refresh(this._value(),!0,!0)},_controlBlur:function(){this.refresh(this._value(),!0)},_controlVMouseUp:function(){this._checkedRefresh()},_handleVMouseDown:function(){this.handle.focus()},_handleKeydown:function(t){var o=this._value();if(!this.options.disabled){switch(t.keyCode){case e.mobile.keyCode.HOME:case e.mobile.keyCode.END:case e.mobile.keyCode.PAGE_UP:case e.mobile.keyCode.PAGE_DOWN:case e.mobile.keyCode.UP:case e.mobile.keyCode.RIGHT:case e.mobile.keyCode.DOWN:case e.mobile.keyCode.LEFT:t.preventDefault(),this._keySliding||(this._keySliding=!0,this.handle.addClass("ui-state-active"))}switch(t.keyCode){case e.mobile.keyCode.HOME:this.refresh(this.min);break;case e.mobile.keyCode.END:this.refresh(this.max);break
;case e.mobile.keyCode.PAGE_UP:case e.mobile.keyCode.UP:case e.mobile.keyCode.RIGHT:this.refresh(o+this.step);break;case e.mobile.keyCode.PAGE_DOWN:case e.mobile.keyCode.DOWN:case e.mobile.keyCode.LEFT:this.refresh(o-this.step)}}},_handleKeyup:function(){this._keySliding&&(this._keySliding=!1,this.handle.removeClass("ui-state-active"))},_sliderVMouseDown:function(e){return!(this.options.disabled||1!==e.which&&0!==e.which&&e.which!==n)&&(!1!==this._trigger("beforestart",e)&&(this.dragging=!0,this.userModified=!1,this.mouseMoved=!1,this.isToggleSwitch&&(this.beforeStart=this.element[0].selectedIndex),this.refresh(e),this._trigger("start"),!1))},_sliderVMouseUp:function(){return this.dragging?(this.dragging=!1,this.isToggleSwitch&&(this.handle.addClass("ui-slider-handle-snapping"),this.refresh(this.mouseMoved?this.userModified?0===this.beforeStart?1:0:this.beforeStart:0===this.beforeStart?1:0)),this.mouseMoved=!1,this._trigger("stop"),!1):void 0},_preventDocumentDrag:function(e){return!1!==this._trigger("drag",e)&&(this.dragging&&!this.options.disabled?(this.mouseMoved=!0,this.isToggleSwitch&&this.handle.removeClass("ui-slider-handle-snapping"),this.refresh(e),this.userModified=this.beforeStart!==this.element[0].selectedIndex,!1):void 0)},_checkedRefresh:function(){this.value!==this._value()&&this.refresh(this._value())},_value:function(){return this.isToggleSwitch?this.element[0].selectedIndex:parseFloat(this.element.val())},_reset:function(){this.refresh(n,!1,!0)},refresh:function(t,n,i){var r,a,s,l,c,u,m,g,d,p,h,f,b,v,_,E,T,P,S,N,w=this,I=e.mobile.getAttribute(this.element[0],"theme"),C=this.options.theme||I,R=C?" ui-btn-"+C:"",y=this.options.trackTheme||I,L=y?" ui-bar-"+y:" ui-bar-inherit",D=this.options.corners?" ui-corner-all":"",G=this.options.mini?" ui-mini":"";if(w.slider[0].className=[this.isToggleSwitch?"ui-slider ui-slider-switch ui-slider-track ui-shadow-inset":"ui-slider-track ui-shadow-inset",L,D,G].join(""),(this.options.disabled||this.element.prop("disabled"))&&this.disable(),this.value=this._value(),this.options.highlight&&!this.isToggleSwitch&&0===this.slider.find(".ui-slider-bg").length&&(this.valuebg=function(){var t=o.createElement("div");return t.className="ui-slider-bg "+e.mobile.activeBtnClass,e(t).prependTo(w.slider)}()),this.handle.addClass("ui-btn"+R+" ui-shadow"),m=this.element,g=!this.isToggleSwitch,d=g?[]:m.find("option"),p=g?parseFloat(m.attr("min")):0,h=g?parseFloat(m.attr("max")):d.length-1,f=g&&parseFloat(m.attr("step"))>0?parseFloat(m.attr("step")):1,"object"==typeof t){if(s=t,l=8,r=this.slider.offset().left,a=this.slider.width(),c=a/((h-p)/f),!this.dragging||s.pageX<r-l||s.pageX>r+a+l)return;u=c>1?(s.pageX-r)/a*100:Math.round((s.pageX-r)/a*100)}else null==t&&(t=g?parseFloat(m.val()||0):m[0].selectedIndex),u=(parseFloat(t)-p)/(h-p)*100;if(!isNaN(u)&&(b=u/100*(h-p)+p,v=(b-p)%f,_=b-v,2*Math.abs(v)>=f&&(_+=v>0?f:-f),E=100/((h-p)/f),b=parseFloat(_.toFixed(5)),void 0===c&&(c=a/((h-p)/f)),c>1&&g&&(u=(b-p)*E*(1/f)),0>u&&(u=0),u>100&&(u=100),p>b&&(b=p),b>h&&(b=h),this.handle.css("left",u+"%"),this.handle[0].setAttribute("aria-valuenow",g?b:d.eq(b).attr("value")),this.handle[0].setAttribute("aria-valuetext",g?b:d.eq(b).getEncodedText()),this.handle[0].setAttribute("title",g?b:d.eq(b).getEncodedText()),this.valuebg&&this.valuebg.css("width",u+"%"),this._labels&&(T=this.handle.width()/this.slider.width()*100,P=u&&T+(100-T)*u/100,S=100===u?0:Math.min(T+100-P,100),this._labels.each(function(){var t=e(this).hasClass("ui-slider-label-a");e(this).width((t?P:S)+"%")})),!i)){if(N=!1,g?(N=m.val()!==b,m.val(b)):(N=m[0].selectedIndex!==b,m[0].selectedIndex=b),!1===this._trigger("beforechange",t))return!1;!n&&N&&m.trigger("change")}},_setHighlight:function(e){e=!!e,e?(this.options.highlight=!!e,this.refresh()):this.valuebg&&(this.valuebg.remove(),this.valuebg=!1)},_setTheme:function(e){this.handle.removeClass("ui-btn-"+this.options.theme).addClass("ui-btn-"+e);var t=this.options.theme?this.options.theme:"inherit",o=e||"inherit";this.control.removeClass("ui-body-"+t).addClass("ui-body-"+o)},_setTrackTheme:function(e){var t=this.options.trackTheme?this.options.trackTheme:"inherit",o=e||"inherit";this.slider.removeClass("ui-body-"+t).addClass("ui-body-"+o)},_setMini:function(e){e=!!e,this.isToggleSwitch||this.isRangeslider||(this.slider.parent().toggleClass("ui-mini",e),this.element.toggleClass("ui-mini",e)),this.slider.toggleClass("ui-mini",e)},_setCorners:function(e){this.slider.toggleClass("ui-corner-all",e),this.isToggleSwitch||this.control.toggleClass("ui-corner-all",e)},_setDisabled:function(e){e=!!e,this.element.prop("disabled",e),this.slider.toggleClass("ui-state-disabled",e).attr("aria-disabled",e)}},e.mobile.behaviors.formReset))}(e),function(e){function t(){return o||(o=e("<div></div>",{"class":"ui-slider-popup ui-shadow ui-corner-all"})),o.clone()}var o;e.widget("mobile.slider",e.mobile.slider,{options:{popupEnabled:!1,showValue:!1},_create:function(){this._super(),e.extend(this,{_currentValue:null,_popup:null,_popupVisible:!1}),this._setOption("popupEnabled",this.options.popupEnabled),this._on(this.handle,{vmousedown:"_showPopup"}),this._on(this.slider.add(this.document),{vmouseup:"_hidePopup"}),this._refresh()},_positionPopup:function(){var e=this.handle.offset();this._popup.offset({left:e.left+(this.handle.width()-this._popup.width())/2,top:e.top-this._popup.outerHeight()-5})},_setOption:function(e,o){this._super(e,o),"showValue"===e?this.handle.html(o&&!this.options.mini?this._value():""):"popupEnabled"===e&&o&&!this._popup&&(this._popup=t().addClass("ui-body-"+(this.options.theme||"a")).hide().insertBefore(this.element))},refresh:function(){this._super.apply(this,arguments),this._refresh()},_refresh:function(){var e,t=this.options;t.popupEnabled&&this.handle.removeAttr("title"),(e=this._value())!==this._currentValue&&(this._currentValue=e,t.popupEnabled&&this._popup?(this._positionPopup(),this._popup.html(e)):t.showValue&&!this.options.mini&&this.handle.html(e))},_showPopup:function(){this.options.popupEnabled&&!this._popupVisible&&(this.handle.html(""),this._popup.show(),this._positionPopup(),this._popupVisible=!0)},_hidePopup:function(){var e=this.options;e.popupEnabled&&this._popupVisible&&(e.showValue&&!e.mini&&this.handle.html(this._value()),this._popup.hide(),this._popupVisible=!1)}})}(e),function(e,t){e.widget("mobile.flipswitch",e.extend({options:{onText:"On",offText:"Off",theme:null,enhanced:!1,wrapperClass:null,corners:!0,mini:!1},_create:function(){this.options.enhanced?e.extend(this,{flipswitch:this.element.parent(),on:this.element.find(".ui-flipswitch-on").eq(0),off:this.element.find(".ui-flipswitch-off").eq(0),type:this.element.get(0).tagName}):this._enhance(),this._handleFormReset(),this._originalTabIndex=this.element.attr("tabindex"),null!=this._originalTabIndex&&this.on.attr("tabindex",this._originalTabIndex),this.element.attr("tabindex","-1"),this._on({focus:"_handleInputFocus"}),this.element.is(":disabled")&&this._setOptions({disabled:!0}),this._on(this.flipswitch,{click:"_toggle",swipeleft:"_left",swiperight:"_right"}),this._on(this.on,{keydown:"_keydown"}),this._on({change:"refresh"})},_handleInputFocus:function(){this.on.focus()},widget:function(){return this.flipswitch},_left:function(){this.flipswitch.removeClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=0:this.element.prop("checked",!1),this.element.trigger("change")},_right:function(){this.flipswitch.addClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=1:this.element.prop("checked",!0),this.element.trigger("change")},_enhance:function(){var t=e("<div>"),o=this.options,n=this.element,i=o.theme?o.theme:"inherit",r=e("<a></a>",{href:"#"}),a=e("<span></span>"),s=n.get(0).tagName,l="INPUT"===s?o.onText:n.find("option").eq(1).text(),c="INPUT"===s?o.offText:n.find("option").eq(0).text();r.addClass("ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit").text(l),a.addClass("ui-flipswitch-off").text(c),t.addClass("ui-flipswitch ui-shadow-inset ui-bar-"+i+" "+(o.wrapperClass?o.wrapperClass:"")+" "+(n.is(":checked")||n.find("option").eq(1).is(":selected")?"ui-flipswitch-active":"")+(n.is(":disabled")?" ui-state-disabled":"")+(o.corners?" ui-corner-all":"")+(o.mini?" ui-mini":"")).append(r,a),n.addClass("ui-flipswitch-input").after(t).appendTo(t),e.extend(this,{flipswitch:t,on:r,off:a,type:s})},_reset:function(){this.refresh()},refresh:function(){var e,t=this.flipswitch.hasClass("ui-flipswitch-active")?"_right":"_left";(e="SELECT"===this.type?this.element.get(0).selectedIndex>0?"_right":"_left":this.element.prop("checked")?"_right":"_left")!==t&&this[e]()},_toggle:function(){this[this.flipswitch.hasClass("ui-flipswitch-active")?"_left":"_right"]()},_keydown:function(t){t.which===e.mobile.keyCode.LEFT?this._left():t.which===e.mobile.keyCode.RIGHT?this._right():t.which===e.mobile.keyCode.SPACE&&(this._toggle(),t.preventDefault())},_setOptions:function(e){if(e.theme!==t){var o=e.theme?e.theme:"inherit",n=e.theme?e.theme:"inherit";this.widget().removeClass("ui-bar-"+o).addClass("ui-bar-"+n)}e.onText!==t&&this.on.text(e.onText),e.offText!==t&&this.off.text(e.offText),e.disabled!==t&&this.widget().toggleClass("ui-state-disabled",e.disabled),e.mini!==t&&this.widget().toggleClass("ui-mini",e.mini),e.corners!==t&&this.widget().toggleClass("ui-corner-all",e.corners),this._super(e)},_destroy:function(){this.options.enhanced||(null!=this._originalTabIndex?this.element.attr("tabindex",this._originalTabIndex):this.element.removeAttr("tabindex"),this.on.remove(),this.off.remove(),this.element.unwrap(),this.flipswitch.remove(),this.removeClass("ui-flipswitch-input"))}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.rangeslider",e.extend({options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!0},_create:function(){var t=this.element,o=this.options.mini?"ui-rangeslider ui-mini":"ui-rangeslider",n=t.find("input").first(),i=t.find("input").last(),r=t.find("label").first(),a=e.data(n.get(0),"mobile-slider")||e.data(n.slider().get(0),"mobile-slider"),s=e.data(i.get(0),"mobile-slider")||e.data(i.slider().get(0),"mobile-slider"),l=a.slider,c=s.slider,u=a.handle,m=e("<div class='ui-rangeslider-sliders' />").appendTo(t);n.addClass("ui-rangeslider-first"),i.addClass("ui-rangeslider-last"),t.addClass(o),l.appendTo(m),c.appendTo(m),r.insertBefore(t),u.prependTo(c),e.extend(this,{_inputFirst:n,_inputLast:i,_sliderFirst:l,_sliderLast:c,_label:r,_targetVal:null,_sliderTarget:!1,_sliders:m,_proxy:!1}),this.refresh(),this._on(this.element.find("input.ui-slider-input"),{slidebeforestart:"_slidebeforestart",slidestop:"_slidestop",slidedrag:"_slidedrag",slidebeforechange:"_change",blur:"_change",keyup:"_change"}),this._on({mousedown:"_change"}),this._on(this.element.closest("form"),{reset:"_handleReset"}),this._on(u,{vmousedown:"_dragFirstHandle"})},_handleReset:function(){var e=this;setTimeout(function(){e._updateHighlight()},0)},_dragFirstHandle:function(t){return e.data(this._inputFirst.get(0),"mobile-slider").dragging=!0,e.data(this._inputFirst.get(0),"mobile-slider").refresh(t),!1},_slidedrag:function(t){var o=e(t.target).is(this._inputFirst),n=o?this._inputLast:this._inputFirst;return this._sliderTarget=!1,"first"===this._proxy&&o||"last"===this._proxy&&!o?(e.data(n.get(0),"mobile-slider").dragging=!0,e.data(n.get(0),"mobile-slider").refresh(t),!1):void 0},_slidestop:function(t){var o=e(t.target).is(this._inputFirst);this._proxy=!1,this.element.find("input").trigger("vmouseup"),this._sliderFirst.css("z-index",o?1:"")},_slidebeforestart:function(t){this._sliderTarget=!1,e(t.originalEvent.target).hasClass("ui-slider-track")&&(this._sliderTarget=!0,this._targetVal=e(t.target).val())},_setOptions:function(e){e.theme!==t&&this._setTheme(e.theme),e.trackTheme!==t&&this._setTrackTheme(e.trackTheme),e.mini!==t&&this._setMini(e.mini),e.highlight!==t&&this._setHighlight(e.highlight),this._super(e),this.refresh()},refresh:function(){var e=this.element,t=this.options;(this._inputFirst.is(":disabled")||this._inputLast.is(":disabled"))&&(this.options.disabled=!0),e.find("input").slider({theme:t.theme,trackTheme:t.trackTheme,disabled:t.disabled,corners:t.corners,mini:t.mini,highlight:t.highlight}).slider("refresh"),this._updateHighlight()},_change:function(t){if("keyup"===t.type)return this._updateHighlight(),!1;var o=this,n=parseFloat(this._inputFirst.val(),10),i=parseFloat(this._inputLast.val(),10),r=e(t.target).hasClass("ui-rangeslider-first"),a=r?this._inputFirst:this._inputLast,s=r?this._inputLast:this._inputFirst;if(this._inputFirst.val()>this._inputLast.val()&&"mousedown"===t.type&&!e(t.target).hasClass("ui-slider-handle"))a.blur();else if("mousedown"===t.type)return;return n>i&&!this._sliderTarget?(a.val(r?i:n).slider("refresh"),this._trigger("normalize")):n>i&&(a.val(this._targetVal).slider("refresh"),setTimeout(function(){s.val(r?n:i).slider("refresh"),e.data(s.get(0),"mobile-slider").handle.focus(),o._sliderFirst.css("z-index",r?"":1),o._trigger("normalize")},0),this._proxy=r?"first":"last"),n===i?(e.data(a.get(0),"mobile-slider").handle.css("z-index",1),e.data(s.get(0),"mobile-slider").handle.css("z-index",0)):(e.data(s.get(0),"mobile-slider").handle.css("z-index",""),e.data(a.get(0),"mobile-slider").handle.css("z-index","")),this._updateHighlight(),!(n>=i)&&void 0},_updateHighlight:function(){var t=parseInt(e.data(this._inputFirst.get(0),"mobile-slider").handle.get(0).style.left,10),o=parseInt(e.data(this._inputLast.get(0),"mobile-slider").handle.get(0).style.left,10),n=o-t;this.element.find(".ui-slider-bg").css({"margin-left":t+"%",width:n+"%"})},_setTheme:function(e){this._inputFirst.slider("option","theme",e),this._inputLast.slider("option","theme",e)},_setTrackTheme:function(e){this._inputFirst.slider("option","trackTheme",e),this._inputLast.slider("option","trackTheme",e)},_setMini:function(e){this._inputFirst.slider("option","mini",e),this._inputLast.slider("option","mini",e),this.element.toggleClass("ui-mini",!!e)},_setHighlight:function(e){this._inputFirst.slider("option","highlight",e),this._inputLast.slider("option","highlight",e)},_destroy:function(){this._label.prependTo(this.element),this.element.removeClass("ui-rangeslider ui-mini"),this._inputFirst.after(this._sliderFirst),this._inputLast.after(this._sliderLast),this._sliders.remove(),this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")}},e.mobile.behaviors.formReset))}(e),function(e,t){e.widget("mobile.textinput",e.mobile.textinput,{options:{clearBtn:!1,clearBtnText:"Clear text"},_create:function(){this._super(),(this.options.clearBtn||this.isSearch)&&this._addClearBtn()},clearButton:function(){return e("<a href='#' class='ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all' title='"+this.options.clearBtnText+"'>"+this.options.clearBtnText+"</a>")},_clearBtnClick:function(e){this.element.val("").focus().trigger("change"),this._clearBtn.addClass("ui-input-clear-hidden"),e.preventDefault()},_addClearBtn:function(){this.options.enhanced||this._enhanceClear(),e.extend(this,{_clearBtn:this.widget().find("a.ui-input-clear")}),this._bindClearEvents(),this._toggleClear()},_enhanceClear:function(){this.clearButton().appendTo(this.widget()),this.widget().addClass("ui-input-has-clear")},_bindClearEvents:function(){this._on(this._clearBtn,{click:"_clearBtnClick"}),this._on({keyup:"_toggleClear",change:"_toggleClear",input:"_toggleClear",focus:"_toggleClear",blur:"_toggleClear",cut:"_toggleClear",paste:"_toggleClear"})},_unbindClear:function(){this._off(this._clearBtn,"click"),this._off(this.element,"keyup change input focus blur cut paste")},_setOptions:function(e){this._super(e),e.clearBtn===t||this.element.is("textarea, :jqmData(type='range')")||(e.clearBtn?this._addClearBtn():this._destroyClear()),e.clearBtnText!==t&&this._clearBtn!==t&&this._clearBtn.text(e.clearBtnText).attr("title",e.clearBtnText)},_toggleClear:function(){this._delay("_toggleClearClass",0)},_toggleClearClass:function(){this._clearBtn.toggleClass("ui-input-clear-hidden",!this.element.val())},_destroyClear:function(){this.widget().removeClass("ui-input-has-clear"),this._unbindClear(),this._clearBtn.remove()},_destroy:function(){this._super(),this._destroyClear()}})}(e),function(e,t){e.widget("mobile.textinput",e.mobile.textinput,{options:{autogrow:!0,keyupTimeoutBuffer:100},_create:function(){this._super(),this.options.autogrow&&this.isTextarea&&this._autogrow()},_autogrow:function(){this.element.addClass("ui-textinput-autogrow"),this._on({keyup:"_timeout",change:"_timeout",input:"_timeout",paste:"_timeout"}),this._on(!0,this.document,{pageshow:"_handleShow",popupbeforeposition:"_handleShow",updatelayout:"_handleShow",panelopen:"_handleShow"})},_handleShow:function(t){e.contains(t.target,this.element[0])&&this.element.is(":visible")&&("popupbeforeposition"!==t.type&&this.element.addClass("ui-textinput-autogrow-resize").animationComplete(e.proxy(function(){this.element.removeClass("ui-textinput-autogrow-resize")},this),"transition"),this._timeout())},_unbindAutogrow:function(){this.element.removeClass("ui-textinput-autogrow"),this._off(this.element,"keyup change input paste"),this._off(this.document,"pageshow popupbeforeposition updatelayout panelopen")},keyupTimeout:null,_prepareHeightUpdate:function(e){this.keyupTimeout&&clearTimeout(this.keyupTimeout),e===t?this._updateHeight():this.keyupTimeout=this._delay("_updateHeight",e)},_timeout:function(){this._prepareHeightUpdate(this.options.keyupTimeoutBuffer)},_updateHeight:function(){var e,t,o,n,i,r,a,s,l,c=this.window.scrollTop();this.keyupTimeout=0,"onpage"in this.element[0]||this.element.css({height:0,"min-height":0,"max-height":0}),n=this.element[0].scrollHeight,i=this.element[0].clientHeight,r=parseFloat(this.element.css("border-top-width")),a=parseFloat(this.element.css("border-bottom-width")),s=r+a,l=n+s+15,0===i&&(e=parseFloat(this.element.css("padding-top")),t=parseFloat(this.element.css("padding-bottom")),o=e+t,l+=o),this.element.css({height:l,"min-height":"","max-height":""}),this.window.scrollTop(c)},refresh:function(){this.options.autogrow&&this.isTextarea&&this._updateHeight()},_setOptions:function(e){this._super(e),e.autogrow!==t&&this.isTextarea&&(e.autogrow?this._autogrow():this._unbindAutogrow())}})}(e),function(e){e.widget("mobile.selectmenu",e.extend({initSelector:"select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",options:{theme:null,icon:"carat-d",iconpos:"right",inline:!1,corners:!0,shadow:!0,iconshadow:!1,overlayTheme:null,dividerTheme:null,hidePlaceholderMenuItems:!0,closeText:"Close",nativeMenu:!0,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,mini:!1},_button:function(){return e("<div/>")},_setDisabled:function(e){return this.element.attr("disabled",e),this.button.attr("aria-disabled",e),this._setOption("disabled",e)},_focusButton:function(){var e=this;setTimeout(function(){e.button.focus()},40)},_selectOptions:function(){return this.select.find("option")},_preExtension:function(){var t=this.options.inline||this.element.jqmData("inline"),o=this.options.mini||this.element.jqmData("mini"),n="";~this.element[0].className.indexOf("ui-btn-left")&&(n=" ui-btn-left"),~this.element[0].className.indexOf("ui-btn-right")&&(n=" ui-btn-right"),t&&(n+=" ui-btn-inline"),o&&(n+=" ui-mini"),this.select=this.element.removeClass("ui-btn-left ui-btn-right").wrap("<div class='ui-select"+n+"'>"),this.selectId=this.select.attr("id")||"select-"+this.uuid,this.buttonId=this.selectId+"-button",this.label=e("label[for='"+this.selectId+"']"),this.isMultiple=this.select[0].multiple},_destroy:function(){var e=this.element.parents(".ui-select");e.length>0&&(e.is(".ui-btn-left, .ui-btn-right")&&this.element.addClass(e.hasClass("ui-btn-left")?"ui-btn-left":"ui-btn-right"),this.element.insertAfter(e),e.remove())},_create:function(){this._preExtension(),this.button=this._button();var o=this,n=this.options,i=!!n.icon&&(n.iconpos||this.select.jqmData("iconpos")),r=this.button.insertBefore(this.select).attr("id",this.buttonId).addClass("ui-btn"+(n.icon?" ui-icon-"+n.icon+" ui-btn-icon-"+i+(n.iconshadow?" ui-shadow-icon":""):"")+(n.theme?" ui-btn-"+n.theme:"")+(n.corners?" ui-corner-all":"")+(n.shadow?" ui-shadow":""));this.setButtonText(),n.nativeMenu&&t.opera&&t.opera.version&&r.addClass("ui-select-nativeonly"),this.isMultiple&&(this.buttonCount=e("<span>").addClass("ui-li-count ui-body-inherit").hide().appendTo(r.addClass("ui-li-has-count"))),(n.disabled||this.element.attr("disabled"))&&this.disable(),this.select.change(function(){o.refresh(),n.nativeMenu&&this.blur()}),this._handleFormReset(),this._on(this.button,{keydown:"_handleKeydown"}),this.build()},build:function(){var t=this;this.select.appendTo(t.button).bind("vmousedown",function(){t.button.addClass(e.mobile.activeBtnClass)}).bind("focus",function(){t.button.addClass(e.mobile.focusClass)}).bind("blur",function(){t.button.removeClass(e.mobile.focusClass)}).bind("focus vmouseover",function(){t.button.trigger("vmouseover")}).bind("vmousemove",function(){t.button.removeClass(e.mobile.activeBtnClass)}).bind("change blur vmouseout",function(){t.button.trigger("vmouseout").removeClass(e.mobile.activeBtnClass)}),t.button.bind("vmousedown",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.label.bind("click focus",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.select.bind("focus",function(){t.options.preventFocusZoom&&e.mobile.zoom.disable(!0)}),t.button.bind("mouseup",function(){t.options.preventFocusZoom&&setTimeout(function(){e.mobile.zoom.enable(!0)},0)}),t.select.bind("blur",function(){t.options.preventFocusZoom&&e.mobile.zoom.enable(!0)})},selected:function(){return this._selectOptions().filter(":selected")},selectedIndices:function(){var e=this;return this.selected().map(function(){return e._selectOptions().index(this)}).get()},setButtonText:function(){var t=this,n=this.selected(),i=this.placeholder,r=e(o.createElement("span"));this.button.children("span").not(".ui-li-count").remove().end().end().prepend(function(){return i=n.length?n.map(function(){return e(this).text()}).get().join(", "):t.placeholder,i?r.text(i):r.html("&#160;"),r.addClass(t.select.attr("class")).addClass(n.attr("class")).removeClass("ui-screen-hidden")}())},setButtonCount:function(){var e=this.selected();this.isMultiple&&this.buttonCount[e.length>1?"show":"hide"]().text(e.length)},_handleKeydown:function(){this._delay("_refreshButton")},_reset:function(){this.refresh()},_refreshButton:function(){this.setButtonText(),this.setButtonCount()},refresh:function(){this._refreshButton()},open:e.noop,close:e.noop,disable:function(){this._setDisabled(!0),this.button.addClass("ui-state-disabled")},enable:function(){this._setDisabled(!1),this.button.removeClass("ui-state-disabled")}},e.mobile.behaviors.formReset))}(e),function(e){e.mobile.links=function(t){e(t).find("a").jqmEnhanceable().filter(":jqmData(rel='popup')[href][href!='']").each(function(){var e=this,t=e.getAttribute("href").substring(1);t&&(e.setAttribute("aria-haspopup",!0),e.setAttribute("aria-owns",t),e.setAttribute("aria-expanded",!1))}).end().not(".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')").addClass("ui-link")}}(e),function(e,o){function n(e,t,o,n){return t>e?o+(e-t)/2:Math.min(Math.max(o,n-t/2),o+e-t)}function i(e){return{x:e.scrollLeft(),y:e.scrollTop(),cx:e[0].innerWidth||e.width(),cy:e[0].innerHeight||e.height()}}e.widget("mobile.popup",{options:{wrapperClass:null,theme:null,overlayTheme:null,shadow:!0,corners:!0,transition:"none",positionTo:"origin",tolerance:null,closeLinkSelector:"a:jqmData(rel='back')",closeLinkEvents:"click.popup",navigateEvents:"navigate.popup",closeEvents:"navigate.popup pagebeforechange.popup",dismissible:!0,enhanced:!1,history:!e.mobile.browser.oldIE},_create:function(){var t=this.element,o=t.attr("id"),n=this.options;n.history=n.history&&e.mobile.ajaxEnabled&&e.mobile.hashListeningEnabled,e.extend(this,{_scrollTop:0,_page:t.closest(".ui-page"),_ui:null,_fallbackTransition:"",_currentTransition:!1,_prerequisites:null,_isOpen:!1,_tolerance:null,_resizeData:null,_ignoreResizeTo:0,_orientationchangeInProgress:!1}),0===this._page.length&&(this._page=e("body")),n.enhanced?this._ui={container:t.parent(),screen:t.parent().prev(),placeholder:e(this.document[0].getElementById(o+"-placeholder"))}:(this._ui=this._enhance(t,o),this._applyTransition(n.transition)),this._setTolerance(n.tolerance)._ui.focusElement=this._ui.container,this._on(this._ui.screen,{vclick:"_eatEventAndClose"}),this._on(this.window,{orientationchange:e.proxy(this,"_handleWindowOrientationchange"),resize:e.proxy(this,"_handleWindowResize"),keyup:e.proxy(this,"_handleWindowKeyUp")}),this._on(this.document,{focusin:"_handleDocumentFocusIn"})},_enhance:function(t,o){var n=this.options,i=n.wrapperClass,r={screen:e("<div class='ui-screen-hidden ui-popup-screen "+this._themeClassFromOption("ui-overlay-",n.overlayTheme)+"'></div>"),placeholder:e("<div style='display: none;'>\x3c!-- placeholder --\x3e</div>"),container:e("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate"+(i?" "+i:"")+"'></div>")},a=this.document[0].createDocumentFragment();return a.appendChild(r.screen[0]),a.appendChild(r.container[0]),o&&(r.screen.attr("id",o+"-screen"),r.container.attr("id",o+"-popup"),r.placeholder.attr("id",o+"-placeholder").html("\x3c!-- placeholder for "+o+" --\x3e")),this._page[0].appendChild(a),r.placeholder.insertAfter(t),t.detach().addClass("ui-popup "+this._themeClassFromOption("ui-body-",n.theme)+" "+(n.shadow?"ui-overlay-shadow ":"")+(n.corners?"ui-corner-all ":"")).appendTo(r.container),r},_eatEventAndClose:function(e){return e.preventDefault(),e.stopImmediatePropagation(),this.options.dismissible&&this.close(),!1},_resizeScreen:function(){var e=this._ui.screen,t=this._ui.container.outerHeight(!0),o=e.removeAttr("style").height(),n=this.document.height()-1;n>o?e.height(n):t>o&&e.height(t)},_handleWindowKeyUp:function(t){return this._isOpen&&t.keyCode===e.mobile.keyCode.ESCAPE?this._eatEventAndClose(t):void 0},_expectResizeEvent:function(){var e=i(this.window);if(this._resizeData){if(e.x===this._resizeData.windowCoordinates.x&&e.y===this._resizeData.windowCoordinates.y&&e.cx===this._resizeData.windowCoordinates.cx&&e.cy===this._resizeData.windowCoordinates.cy)return!1;clearTimeout(this._resizeData.timeoutId)}return this._resizeData={timeoutId:this._delay("_resizeTimeout",200),windowCoordinates:e},!0},_resizeTimeout:function(){this._isOpen?this._expectResizeEvent()||(this._ui.container.hasClass("ui-popup-hidden")&&(this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"),this.reposition({positionTo:"window"}),this._ignoreResizeEvents()),this._resizeScreen(),this._resizeData=null,this._orientationchangeInProgress=!1):(this._resizeData=null,this._orientationchangeInProgress=!1)},_stopIgnoringResizeEvents:function(){this._ignoreResizeTo=0},_ignoreResizeEvents:function(){this._ignoreResizeTo&&clearTimeout(this._ignoreResizeTo),this._ignoreResizeTo=this._delay("_stopIgnoringResizeEvents",1e3)},_handleWindowResize:function(){this._isOpen&&0===this._ignoreResizeTo&&(!this._expectResizeEvent()&&!this._orientationchangeInProgress||this._ui.container.hasClass("ui-popup-hidden")||this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))},_handleWindowOrientationchange:function(){!this._orientationchangeInProgress&&this._isOpen&&0===this._ignoreResizeTo&&(this._expectResizeEvent(),this._orientationchangeInProgress=!0)},_handleDocumentFocusIn:function(t){var o,n=t.target,i=this._ui;if(this._isOpen){if(n!==i.container[0]){if(o=e(n),0===o.parents().filter(i.container[0]).length)return e(this.document[0].activeElement).one("focus",function(){o.blur()}),i.focusElement.focus(),t.preventDefault(),t.stopImmediatePropagation(),!1;i.focusElement[0]===i.container[0]&&(i.focusElement=o)}this._ignoreResizeEvents()}},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:e+"inherit"},_applyTransition:function(t){return t&&(this._ui.container.removeClass(this._fallbackTransition),"none"!==t&&(this._fallbackTransition=e.mobile._maybeDegradeTransition(t),"none"===this._fallbackTransition&&(this._fallbackTransition=""),this._ui.container.addClass(this._fallbackTransition))),this},_setOptions:function(e){var t=this.options,n=this.element,i=this._ui.screen;return e.wrapperClass!==o&&this._ui.container.removeClass(t.wrapperClass).addClass(e.wrapperClass),e.theme!==o&&n.removeClass(this._themeClassFromOption("ui-body-",t.theme)).addClass(this._themeClassFromOption("ui-body-",e.theme)),e.overlayTheme!==o&&(i.removeClass(this._themeClassFromOption("ui-overlay-",t.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-",e.overlayTheme)),this._isOpen&&i.addClass("in")),e.shadow!==o&&n.toggleClass("ui-overlay-shadow",e.shadow),e.corners!==o&&n.toggleClass("ui-corner-all",e.corners),e.transition!==o&&(this._currentTransition||this._applyTransition(e.transition)),e.tolerance!==o&&this._setTolerance(e.tolerance),e.disabled!==o&&e.disabled&&this.close(),this._super(e)},_setTolerance:function(t){var n,i={t:30,r:15,b:30,l:15};if(t!==o)switch(n=String(t).split(","),e.each(n,function(e,t){n[e]=parseInt(t,10)}),n.length){case 1:isNaN(n[0])||(i.t=i.r=i.b=i.l=n[0]);break;case 2:isNaN(n[0])||(i.t=i.b=n[0]),isNaN(n[1])||(i.l=i.r=n[1]);break;case 4:isNaN(n[0])||(i.t=n[0]),isNaN(n[1])||(i.r=n[1]),isNaN(n[2])||(i.b=n[2]),isNaN(n[3])||(i.l=n[3])}return this._tolerance=i,this},_clampPopupWidth:function(e){var t,o=i(this.window),n={x:this._tolerance.l,y:o.y+this._tolerance.t,cx:o.cx-this._tolerance.l-this._tolerance.r,cy:o.cy-this._tolerance.t-this._tolerance.b};return e||this._ui.container.css("max-width",n.cx),t={cx:this._ui.container.outerWidth(!0),cy:this._ui.container.outerHeight(!0)},{rc:n,menuSize:t}},_calculateFinalLocation:function(e,t){var o,i=t.rc,r=t.menuSize;return o={left:n(i.cx,r.cx,i.x,e.x),top:n(i.cy,r.cy,i.y,e.y)},o.top=Math.max(0,o.top),o.top-=Math.min(o.top,Math.max(0,o.top+r.cy-this.document.height())),o},_placementCoords:function(e){return this._calculateFinalLocation(e,this._clampPopupWidth())},_createPrerequisites:function(t,o,n){var i,r=this;i={screen:e.Deferred(),container:e.Deferred()},i.screen.then(function(){i===r._prerequisites&&t()}),i.container.then(function(){i===r._prerequisites&&o()}),e.when(i.screen,i.container).done(function(){i===r._prerequisites&&(r._prerequisites=null,n())}),r._prerequisites=i},_animate:function(t){return this._ui.screen.removeClass(t.classToRemove).addClass(t.screenClassToAdd),t.prerequisites.screen.resolve(),t.transition&&"none"!==t.transition&&(t.applyTransition&&this._applyTransition(t.transition),this._fallbackTransition)?void this._ui.container.addClass(t.containerClassToAdd).removeClass(t.classToRemove).animationComplete(e.proxy(t.prerequisites.container,"resolve")):(this._ui.container.removeClass(t.classToRemove),void t.prerequisites.container.resolve())},_desiredCoords:function(t){var o,n=null,r=i(this.window),a=t.x,s=t.y,l=t.positionTo;if(l&&"origin"!==l)if("window"===l)a=r.cx/2+r.x,s=r.cy/2+r.y;else{try{n=e(l)}catch(c){n=null}n&&(n.filter(":visible"),0===n.length&&(n=null))}return n&&(o=n.offset(),a=o.left+n.outerWidth()/2,s=o.top+n.outerHeight()/2),("number"!==e.type(a)||isNaN(a))&&(a=r.cx/2+r.x),("number"!==e.type(s)||isNaN(s))&&(s=r.cy/2+r.y),{x:a,y:s}},_reposition:function(e){e={x:e.x,y:e.y,positionTo:e.positionTo},this._trigger("beforeposition",o,e),this._ui.container.offset(this._placementCoords(this._desiredCoords(e)))},reposition:function(e){this._isOpen&&this._reposition(e)},_openPrerequisitesComplete:function(){var e=this.element.attr("id");this._ui.container.addClass("ui-popup-active"),this._isOpen=!0,this._resizeScreen(),this._ui.container.attr("tabindex","0").focus(),this._ignoreResizeEvents(),
e&&this.document.find("[aria-haspopup='true'][aria-owns='"+e+"']").attr("aria-expanded",!0),this._trigger("afteropen")},_open:function(t){var o=e.extend({},this.options,t),n=function(){var e=navigator.userAgent,t=e.match(/AppleWebKit\/([0-9\.]+)/),o=!!t&&t[1],n=e.match(/Android (\d+(?:\.\d+))/),i=!!n&&n[1],r=e.indexOf("Chrome")>-1;return!(!(null!==n&&"4.0"===i&&o&&o>534.13)||r)}();this._createPrerequisites(e.noop,e.noop,e.proxy(this,"_openPrerequisitesComplete")),this._currentTransition=o.transition,this._applyTransition(o.transition),this._ui.screen.removeClass("ui-screen-hidden"),this._ui.container.removeClass("ui-popup-truncate"),this._reposition(o),this._ui.container.removeClass("ui-popup-hidden"),this.options.overlayTheme&&n&&this.element.closest(".ui-page").addClass("ui-popup-open"),this._animate({additionalCondition:!0,transition:o.transition,classToRemove:"",screenClassToAdd:"in",containerClassToAdd:"in",applyTransition:!1,prerequisites:this._prerequisites})},_closePrerequisiteScreen:function(){this._ui.screen.removeClass("out").addClass("ui-screen-hidden")},_closePrerequisiteContainer:function(){this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")},_closePrerequisitesDone:function(){var t=this._ui.container,n=this.element.attr("id");t.removeAttr("tabindex"),e.mobile.popup.active=o,e(":focus",t[0]).add(t[0]).blur(),n&&this.document.find("[aria-haspopup='true'][aria-owns='"+n+"']").attr("aria-expanded",!1),this._trigger("afterclose")},_close:function(t){this._ui.container.removeClass("ui-popup-active"),this._page.removeClass("ui-popup-open"),this._isOpen=!1,this._createPrerequisites(e.proxy(this,"_closePrerequisiteScreen"),e.proxy(this,"_closePrerequisiteContainer"),e.proxy(this,"_closePrerequisitesDone")),this._animate({additionalCondition:this._ui.screen.hasClass("in"),transition:t?"none":this._currentTransition,classToRemove:"in",screenClassToAdd:"out",containerClassToAdd:"reverse out",applyTransition:!0,prerequisites:this._prerequisites})},_unenhance:function(){this.options.enhanced||(this._setOptions({theme:e.mobile.popup.prototype.options.theme}),this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"),this._ui.screen.remove(),this._ui.container.remove(),this._ui.placeholder.remove())},_destroy:function(){return e.mobile.popup.active===this?(this.element.one("popupafterclose",e.proxy(this,"_unenhance")),this.close()):this._unenhance(),this},_closePopup:function(o,n){var i,r,a=this.options,s=!1;o&&o.isDefaultPrevented()||e.mobile.popup.active!==this||(t.scrollTo(0,this._scrollTop),o&&"pagebeforechange"===o.type&&n&&(i="string"==typeof n.toPage?n.toPage:n.toPage.jqmData("url"),i=e.mobile.path.parseUrl(i),r=i.pathname+i.search+i.hash,this._myUrl!==e.mobile.path.makeUrlAbsolute(r)?s=!0:o.preventDefault()),this.window.off(a.closeEvents),this.element.undelegate(a.closeLinkSelector,a.closeLinkEvents),this._close(s))},_bindContainerClose:function(){this.window.on(this.options.closeEvents,e.proxy(this,"_closePopup"))},widget:function(){return this._ui.container},open:function(t){var o,n,i,r,a,s=this,l=this.options;return e.mobile.popup.active||l.disabled?this:(e.mobile.popup.active=this,this._scrollTop=this.window.scrollTop(),l.history?(a=e.mobile.navigate.history,n=e.mobile.dialogHashKey,i=e.mobile.activePage,r=!!i&&i.hasClass("ui-dialog"),this._myUrl=o=a.getActive().url,o.indexOf(n)>-1&&!r&&a.activeIndex>0?(s._open(t),s._bindContainerClose(),this):(-1!==o.indexOf(n)||r?o=e.mobile.path.parseLocation().hash+n:o+=o.indexOf("#")>-1?n:"#"+n,0===a.activeIndex&&o===a.initialDst&&(o+=n),this.window.one("beforenavigate",function(e){e.preventDefault(),s._open(t),s._bindContainerClose()}),this.urlAltered=!0,e.mobile.navigate(o,{role:"dialog"}),this)):(s._open(t),s._bindContainerClose(),s.element.delegate(l.closeLinkSelector,l.closeLinkEvents,function(e){s.close(),e.preventDefault()}),this))},close:function(){return e.mobile.popup.active!==this?this:(this._scrollTop=this.window.scrollTop(),this.options.history&&this.urlAltered?(e.mobile.back(),this.urlAltered=!1):this._closePopup(),this)}}),e.mobile.popup.handleLink=function(t){var o,n=e.mobile.path,i=e(n.hashToSelector(n.parseUrl(t.attr("href")).hash)).first();i.length>0&&i.data("mobile-popup")&&(o=t.offset(),i.popup("open",{x:o.left+t.outerWidth()/2,y:o.top+t.outerHeight()/2,transition:t.jqmData("transition"),positionTo:t.jqmData("position-to")})),setTimeout(function(){t.removeClass(e.mobile.activeBtnClass)},300)},e.mobile.document.on("pagebeforechange",function(t,o){"popup"===o.options.role&&(e.mobile.popup.handleLink(o.options.link),t.preventDefault())})}(e),function(e,t){var n=".ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')",i=function(e,t,o){var i=e[o+"All"]().not(n).first();i.length&&(t.blur().attr("tabindex","-1"),i.find("a").first().focus())};e.widget("mobile.selectmenu",e.mobile.selectmenu,{_create:function(){var e=this.options;return e.nativeMenu=e.nativeMenu||this.element.parents(":jqmData(role='popup'),:mobile-popup").length>0,this._super()},_handleSelectFocus:function(){this.element.blur(),this.button.focus()},_handleKeydown:function(e){this._super(e),this._handleButtonVclickKeydown(e)},_handleButtonVclickKeydown:function(t){this.options.disabled||this.isOpen||("vclick"===t.type||t.keyCode&&(t.keyCode===e.mobile.keyCode.ENTER||t.keyCode===e.mobile.keyCode.SPACE))&&(this._decideFormat(),"overlay"===this.menuType?this.button.attr("href","#"+this.popupId).attr("data-"+(e.mobile.ns||"")+"rel","popup"):this.button.attr("href","#"+this.dialogId).attr("data-"+(e.mobile.ns||"")+"rel","dialog"),this.isOpen=!0)},_handleListFocus:function(t){var o="focusin"===t.type?{tabindex:"0",event:"vmouseover"}:{tabindex:"-1",event:"vmouseout"};e(t.target).attr("tabindex",o.tabindex).trigger(o.event)},_handleListKeydown:function(t){var o=e(t.target),n=o.closest("li");switch(t.keyCode){case 38:return i(n,o,"prev"),!1;case 40:return i(n,o,"next"),!1;case 13:case 32:return o.trigger("click"),!1}},_handleMenuPageHide:function(){this.thisPage.page("bindRemove")},_handleHeaderCloseClick:function(){return"overlay"===this.menuType?(this.close(),!1):void 0},build:function(){var o,n,i,r,a,s,l,c,u,m,g,d,p,h,f,b,v,_,E=this.options;return E.nativeMenu?this._super():(_=this,o=this.selectId,n=o+"-listbox",i=o+"-dialog",r=this.label,a=this.element.closest(".ui-page"),s=this.element[0].multiple,l=o+"-menu",c=E.theme?" data-"+e.mobile.ns+"theme='"+E.theme+"'":"",u=E.overlayTheme||E.theme||null,m=u?" data-"+e.mobile.ns+"overlay-theme='"+u+"'":"",g=E.dividerTheme&&s?" data-"+e.mobile.ns+"divider-theme='"+E.dividerTheme+"'":"",d=e("<div data-"+e.mobile.ns+"role='dialog' class='ui-selectmenu' id='"+i+"'"+c+m+"><div data-"+e.mobile.ns+"role='header'><div class='ui-title'>"+r.getEncodedText()+"</div></div><div data-"+e.mobile.ns+"role='content'></div></div>"),p=e("<div id='"+n+"' class='ui-selectmenu'></div>").insertAfter(this.select).popup({theme:E.overlayTheme}),h=e("<ul class='ui-selectmenu-list' id='"+l+"' role='listbox' aria-labelledby='"+this.buttonId+"'"+c+g+"></ul>").appendTo(p),f=e("<div class='ui-header ui-bar-"+(E.theme?E.theme:"inherit")+"'></div>").prependTo(p),b=e("<h1 class='ui-title'></h1>").appendTo(f),this.isMultiple&&(v=e("<a>",{role:"button",text:E.closeText,href:"#","class":"ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete"}).appendTo(f)),e.extend(this,{selectId:o,menuId:l,popupId:n,dialogId:i,thisPage:a,menuPage:d,label:r,isMultiple:s,theme:E.theme,listbox:p,list:h,header:f,headerTitle:b,headerClose:v,menuPageContent:void 0,menuPageClose:void 0,placeholder:""}),this.refresh(),this._origTabIndex===t&&(this._origTabIndex=null!==this.select[0].getAttribute("tabindex")&&this.select.attr("tabindex")),this.select.attr("tabindex","-1"),this._on(this.select,{focus:"_handleSelectFocus"}),this._on(this.button,{vclick:"_handleButtonVclickKeydown"}),this.list.attr("role","listbox"),this._on(this.list,{focusin:"_handleListFocus",focusout:"_handleListFocus",keydown:"_handleListKeydown"}),this.list.delegate("li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider)","click",function(t){var o=_.select[0].selectedIndex,n=e.mobile.getAttribute(this,"option-index"),i=_._selectOptions().eq(n)[0];i.selected=!_.isMultiple||!i.selected,_.isMultiple&&e(this).find("a").toggleClass("ui-checkbox-on",i.selected).toggleClass("ui-checkbox-off",!i.selected),(_.isMultiple||o!==n)&&_.select.trigger("change"),_.isMultiple?_.list.find("li:not(.ui-li-divider)").eq(n).find("a").first().focus():_.close(),t.preventDefault()}),this._on(this.menuPage,{pagehide:"_handleMenuPageHide"}),this._on(this.listbox,{popupafterclose:"close"}),this.isMultiple&&this._on(this.headerClose,{click:"_handleHeaderCloseClick"}),this)},_isRebuildRequired:function(){var e=this.list.find("li");return this._selectOptions().not(".ui-screen-hidden").text()!==e.text()},selected:function(){return this._selectOptions().filter(":selected:not( :jqmData(placeholder='true') )")},refresh:function(t){var o,n;return this.options.nativeMenu?this._super(t):(o=this,(t||this._isRebuildRequired())&&o._buildList(),n=this.selectedIndices(),o.setButtonText(),o.setButtonCount(),void o.list.find("li:not(.ui-li-divider)").find("a").removeClass(e.mobile.activeBtnClass).end().attr("aria-selected",!1).each(function(t){if(e.inArray(t,n)>-1){var i=e(this);i.attr("aria-selected",!0),o.isMultiple?i.find("a").removeClass("ui-checkbox-off").addClass("ui-checkbox-on"):i.hasClass("ui-screen-hidden")?i.next().find("a").addClass(e.mobile.activeBtnClass):i.find("a").addClass(e.mobile.activeBtnClass)}}))},close:function(){if(!this.options.disabled&&this.isOpen){var e=this;"page"===e.menuType?(e.menuPage.dialog("close"),e.list.appendTo(e.listbox)):e.listbox.popup("close"),e._focusButton(),e.isOpen=!1}},open:function(){this.button.click()},_focusMenuItem:function(){var t=this.list.find("a."+e.mobile.activeBtnClass);0===t.length&&(t=this.list.find("li:not("+n+") a.ui-btn")),t.first().focus()},_decideFormat:function(){var t=this,o=this.window,n=t.list.parent(),i=n.outerHeight(),r=o.scrollTop(),a=t.button.offset().top,s=o.height();i>s-80||!e.support.scrollTop?(t.menuPage.appendTo(e.mobile.pageContainer).page(),t.menuPageContent=t.menuPage.find(".ui-content"),t.menuPageClose=t.menuPage.find(".ui-header a"),t.thisPage.unbind("pagehide.remove"),0===r&&a>s&&t.thisPage.one("pagehide",function(){e(this).jqmData("lastScroll",a)}),t.menuPage.one({pageshow:e.proxy(this,"_focusMenuItem"),pagehide:e.proxy(this,"close")}),t.menuType="page",t.menuPageContent.append(t.list),t.menuPage.find("div .ui-title").text(t.label.text())):(t.menuType="overlay",t.listbox.one({popupafteropen:e.proxy(this,"_focusMenuItem")}))},_buildList:function(){var t,n,i,r,a,s,l,c,u,m,g,d,p,h,f=this,b=this.options,v=this.placeholder,_=!0,E="data-"+e.mobile.ns,T=E+"option-index",P=E+"icon",S=E+"role",N=E+"placeholder",w=o.createDocumentFragment(),I=!1;for(f.list.empty().filter(".ui-listview").listview("destroy"),t=this._selectOptions(),n=t.length,i=this.select[0],a=0;n>a;a++,I=!1)s=t[a],l=e(s),l.hasClass("ui-screen-hidden")||(c=s.parentNode,u=l.text(),m=o.createElement("a"),g=[],m.setAttribute("href","#"),m.appendChild(o.createTextNode(u)),c!==i&&"optgroup"===c.nodeName.toLowerCase()&&(d=c.getAttribute("label"))!==r&&(p=o.createElement("li"),p.setAttribute(S,"list-divider"),p.setAttribute("role","option"),p.setAttribute("tabindex","-1"),p.appendChild(o.createTextNode(d)),w.appendChild(p),r=d),!_||s.getAttribute("value")&&0!==u.length&&!l.jqmData("placeholder")||(_=!1,I=!0,null===s.getAttribute(N)&&(this._removePlaceholderAttr=!0),s.setAttribute(N,!0),b.hidePlaceholderMenuItems&&g.push("ui-screen-hidden"),v!==u&&(v=f.placeholder=u)),h=o.createElement("li"),s.disabled&&(g.push("ui-state-disabled"),h.setAttribute("aria-disabled",!0)),h.setAttribute(T,a),h.setAttribute(P,"false"),I&&h.setAttribute(N,!0),h.className=g.join(" "),h.setAttribute("role","option"),m.setAttribute("tabindex","-1"),this.isMultiple&&e(m).addClass("ui-btn ui-checkbox-off ui-btn-icon-right"),h.appendChild(m),w.appendChild(h));f.list[0].appendChild(w),this.isMultiple||v.length?this.headerTitle.text(this.placeholder):this.header.addClass("ui-screen-hidden"),f.list.listview()},_button:function(){return this.options.nativeMenu?this._super():e("<a>",{href:"#",role:"button",id:this.buttonId,"aria-haspopup":"true","aria-owns":this.menuId})},_destroy:function(){this.options.nativeMenu||(this.close(),this._origTabIndex!==t&&(!1!==this._origTabIndex?this.select.attr("tabindex",this._origTabIndex):this.select.removeAttr("tabindex")),this._removePlaceholderAttr&&this._selectOptions().removeAttr("data-"+e.mobile.ns+"placeholder"),this.listbox.remove(),this.menuPage.remove()),this._super()}})}(e),function(e,t){function o(e,t){var o=t||[];return o.push("ui-btn"),e.theme&&o.push("ui-btn-"+e.theme),e.icon&&(o=o.concat(["ui-icon-"+e.icon,"ui-btn-icon-"+e.iconpos]),e.iconshadow&&o.push("ui-shadow-icon")),e.inline&&o.push("ui-btn-inline"),e.shadow&&o.push("ui-shadow"),e.corners&&o.push("ui-corner-all"),e.mini&&o.push("ui-mini"),o}function n(e){var o,n,i,a=!1,s=!0,l={icon:"",inline:!1,shadow:!1,corners:!1,iconshadow:!1,mini:!1},c=[];for(e=e.split(" "),o=0;o<e.length;o++)i=!0,n=r[e[o]],n!==t?(i=!1,l[n]=!0):0===e[o].indexOf("ui-btn-icon-")?(i=!1,s=!1,l.iconpos=e[o].substring(12)):0===e[o].indexOf("ui-icon-")?(i=!1,l.icon=e[o].substring(8)):0===e[o].indexOf("ui-btn-")&&8===e[o].length?(i=!1,l.theme=e[o].substring(7)):"ui-btn"===e[o]&&(i=!1,a=!0),i&&c.push(e[o]);return s&&(l.icon=""),{options:l,unknownClasses:c,alreadyEnhanced:a}}function i(e){return"-"+e.toLowerCase()}var r={"ui-shadow":"shadow","ui-corner-all":"corners","ui-btn-inline":"inline","ui-shadow-icon":"iconshadow","ui-mini":"mini"},a=function(){var o=e.mobile.getAttribute.apply(this,arguments);return null==o?t:o};e.fn.buttonMarkup=function(r,s){var l,c,u,m,g,d=e.fn.buttonMarkup.defaults;for(l=0;l<this.length;l++){if(u=this[l],c=s?{alreadyEnhanced:!1,unknownClasses:[]}:n(u.className),m=e.extend({},c.alreadyEnhanced?c.options:{},r),!c.alreadyEnhanced)for(g in d)m[g]===t&&(m[g]=a(u,g.replace(/[A-Z]/g,i)));u.className=o(e.extend({},d,m),c.unknownClasses).join(" "),"button"!==u.tagName.toLowerCase()&&u.setAttribute("role","button")}return this},e.fn.buttonMarkup.defaults={icon:"",iconpos:"left",theme:null,inline:!1,shadow:!0,corners:!0,iconshadow:!1,mini:!1},e.extend(e.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button"})}(e),function(e,t){e.widget("mobile.controlgroup",e.extend({options:{enhanced:!1,theme:null,shadow:!1,corners:!0,excludeInvisible:!0,type:"vertical",mini:!1},_create:function(){var t=this.element,o=this.options;e.fn.buttonMarkup&&this.element.find(e.fn.buttonMarkup.initSelector).buttonMarkup(),e.each(this._childWidgets,e.proxy(function(t,o){e.mobile[o]&&this.element.find(e.mobile[o].initSelector).not(e.mobile.page.prototype.keepNativeSelector())[o]()},this)),e.extend(this,{_ui:null,_initialRefresh:!0}),this._ui=o.enhanced?{groupLegend:t.children(".ui-controlgroup-label").children(),childWrapper:t.children(".ui-controlgroup-controls")}:this._enhance()},_childWidgets:["checkboxradio","selectmenu","button"],_themeClassFromOption:function(e){return e?"none"===e?"":"ui-group-theme-"+e:""},_enhance:function(){var t=this.element,o=this.options,n={groupLegend:t.children("legend"),childWrapper:t.addClass("ui-controlgroup ui-controlgroup-"+("horizontal"===o.type?"horizontal":"vertical")+" "+this._themeClassFromOption(o.theme)+" "+(o.corners?"ui-corner-all ":"")+(o.mini?"ui-mini ":"")).wrapInner("<div class='ui-controlgroup-controls "+(!0===o.shadow?"ui-shadow":"")+"'></div>").children()};return n.groupLegend.length>0&&e("<div role='heading' class='ui-controlgroup-label'></div>").append(n.groupLegend).prependTo(t),n},_init:function(){this.refresh()},_setOptions:function(e){var o,n,i=this.element;return e.type!==t&&(i.removeClass("ui-controlgroup-horizontal ui-controlgroup-vertical").addClass("ui-controlgroup-"+("horizontal"===e.type?"horizontal":"vertical")),o=!0),e.theme!==t&&i.removeClass(this._themeClassFromOption(this.options.theme)).addClass(this._themeClassFromOption(e.theme)),e.corners!==t&&i.toggleClass("ui-corner-all",e.corners),e.mini!==t&&i.toggleClass("ui-mini",e.mini),e.shadow!==t&&this._ui.childWrapper.toggleClass("ui-shadow",e.shadow),e.excludeInvisible!==t&&(this.options.excludeInvisible=e.excludeInvisible,o=!0),n=this._super(e),o&&this.refresh(),n},container:function(){return this._ui.childWrapper},refresh:function(){var t=this.container(),o=t.find(".ui-btn").not(".ui-slider-handle"),n=this._initialRefresh;e.mobile.checkboxradio&&t.find(":mobile-checkboxradio").checkboxradio("refresh"),this._addFirstLastClasses(o,this.options.excludeInvisible?this._getVisibles(o,n):o,n),this._initialRefresh=!1},_destroy:function(){var e,t,o=this.options;return o.enhanced?this:(e=this._ui,t=this.element.removeClass("ui-controlgroup ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini "+this._themeClassFromOption(o.theme)).find(".ui-btn").not(".ui-slider-handle"),this._removeFirstLastClasses(t),e.groupLegend.unwrap(),void e.childWrapper.children().unwrap())}},e.mobile.behaviors.addFirstLastClasses))}(e),function(e,t){e.widget("mobile.toolbar",{initSelector:":jqmData(role='footer'), :jqmData(role='header')",options:{theme:null,addBackBtn:!1,backBtnTheme:null,backBtnText:"Back"},_create:function(){var t=this.element.is(":jqmData(role='header')")?"header":"footer",o=this.element.closest(".ui-page");0===o.length&&(o=!1,this._on(this.document,{pageshow:"refresh"})),e.extend(this,{role:t,page:o,leftbtn:void 0,rightbtn:void 0}),this.element.attr("role","header"===t?"banner":"contentinfo").addClass("ui-"+t),this.refresh(),this._setOptions(this.options)},_setOptions:function(o){if(o.addBackBtn!==t&&(this.options.addBackBtn&&"header"===this.role&&e(".ui-page").length>1&&this.page[0].getAttribute("data-"+e.mobile.ns+"url")!==e.mobile.path.stripHash(location.hash)&&!this.leftbtn?this._addBackButton():this.element.find(".ui-toolbar-back-btn").remove()),null!=o.backBtnTheme&&this.element.find(".ui-toolbar-back-btn").addClass("ui-btn ui-btn-"+o.backBtnTheme),o.backBtnText!==t&&this.element.find(".ui-toolbar-back-btn .ui-btn-text").text(o.backBtnText),o.theme!==t){var n=this.options.theme?this.options.theme:"inherit",i=o.theme?o.theme:"inherit";this.element.removeClass("ui-bar-"+n).addClass("ui-bar-"+i)}this._super(o)},refresh:function(){"header"===this.role&&this._addHeaderButtonClasses(),this.page||(this._setRelative(),"footer"===this.role&&this.element.appendTo("body")),this._addHeadingClasses(),this._btnMarkup()},_setRelative:function(){e("[data-"+e.mobile.ns+"role='page']").css({position:"relative"})},_btnMarkup:function(){this.element.children("a").filter(":not([data-"+e.mobile.ns+"role='none'])").attr("data-"+e.mobile.ns+"role","button"),this.element.trigger("create")},_addHeaderButtonClasses:function(){var e=this.element.children("a, button");this.leftbtn=e.hasClass("ui-btn-left"),this.rightbtn=e.hasClass("ui-btn-right"),this.leftbtn=this.leftbtn||e.eq(0).not(".ui-btn-right").addClass("ui-btn-left").length,this.rightbtn=this.rightbtn||e.eq(1).addClass("ui-btn-right").length},_addBackButton:function(){var t=this.options,o=t.backBtnTheme||t.theme;e("<a role='button' href='javascript:void(0);' class='ui-btn ui-corner-all ui-shadow ui-btn-left "+(o?"ui-btn-"+o+" ":"")+"ui-toolbar-back-btn ui-icon-carat-l ui-btn-icon-left' data-"+e.mobile.ns+"rel='back'>"+t.backBtnText+"</a>").prependTo(this.element)},_addHeadingClasses:function(){this.element.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})}})}(e),function(e,t){e.widget("mobile.toolbar",e.mobile.toolbar,{options:{position:null,visibleOnPageShow:!0,disablePageZoom:!0,transition:"slide",fullscreen:!1,tapToggle:!0,tapToggleBlacklist:"a, button, input, select, textarea, .ui-header-fixed, .ui-footer-fixed, .ui-flipswitch, .ui-popup, .ui-panel, .ui-panel-dismiss-open",hideDuringFocus:"input, textarea, select",updatePagePadding:!0,trackPersistentToolbars:!0,supportBlacklist:function(){return!e.support.fixedPosition}},_create:function(){this._super(),"fixed"!==this.options.position||this.options.supportBlacklist()||this._makeFixed()},_makeFixed:function(){this.element.addClass("ui-"+this.role+"-fixed"),this.updatePagePadding(),this._addTransitionClass(),this._bindPageEvents(),this._bindToggleHandlers()},_setOptions:function(o){if("fixed"===o.position&&"fixed"!==this.options.position&&this._makeFixed(),"fixed"===this.options.position&&!this.options.supportBlacklist()){var n=this.page?this.page:e(".ui-page-active").length>0?e(".ui-page-active"):e(".ui-page").eq(0);o.fullscreen!==t&&(o.fullscreen?(this.element.addClass("ui-"+this.role+"-fullscreen"),n.addClass("ui-page-"+this.role+"-fullscreen")):(this.element.removeClass("ui-"+this.role+"-fullscreen"),n.removeClass("ui-page-"+this.role+"-fullscreen").addClass("ui-page-"+this.role+"-fixed")))}this._super(o)},_addTransitionClass:function(){var e=this.options.transition;e&&"none"!==e&&("slide"===e&&(e=this.element.hasClass("ui-header")?"slidedown":"slideup"),this.element.addClass(e))},_bindPageEvents:function(){var e=this.page?this.element.closest(".ui-page"):this.document;this._on(e,{pagebeforeshow:"_handlePageBeforeShow",webkitAnimationStart:"_handleAnimationStart",animationstart:"_handleAnimationStart",updatelayout:"_handleAnimationStart",pageshow:"_handlePageShow",pagebeforehide:"_handlePageBeforeHide"})},_handlePageBeforeShow:function(){var t=this.options;t.disablePageZoom&&e.mobile.zoom.disable(!0),t.visibleOnPageShow||this.hide(!0)},_handleAnimationStart:function(){this.options.updatePagePadding&&this.updatePagePadding(this.page?this.page:".ui-page-active")},_handlePageShow:function(){this.updatePagePadding(this.page?this.page:".ui-page-active"),this.options.updatePagePadding&&this._on(this.window,{throttledresize:"updatePagePadding"})},_handlePageBeforeHide:function(t,o){var n,i,r,a,s=this.options;s.disablePageZoom&&e.mobile.zoom.enable(!0),s.updatePagePadding&&this._off(this.window,"throttledresize"),s.trackPersistentToolbars&&(n=e(".ui-footer-fixed:jqmData(id)",this.page),i=e(".ui-header-fixed:jqmData(id)",this.page),r=n.length&&o.nextPage&&e(".ui-footer-fixed:jqmData(id='"+n.jqmData("id")+"')",o.nextPage)||e(),a=i.length&&o.nextPage&&e(".ui-header-fixed:jqmData(id='"+i.jqmData("id")+"')",o.nextPage)||e(),(r.length||a.length)&&(r.add(a).appendTo(e.mobile.pageContainer),o.nextPage.one("pageshow",function(){a.prependTo(this),r.appendTo(this)})))},_visible:!0,updatePagePadding:function(o){var n=this.element,i="header"===this.role,r=parseFloat(n.css(i?"top":"bottom"));this.options.fullscreen||(o=o&&o.type===t&&o||this.page||n.closest(".ui-page"),o=this.page?this.page:".ui-page-active",e(o).css("padding-"+(i?"top":"bottom"),n.outerHeight()+r))},_useTransition:function(t){var o=this.window,n=this.element,i=o.scrollTop(),r=n.height(),a=this.page?n.closest(".ui-page").height():e(".ui-page-active").height(),s=e.mobile.getScreenHeight();return!t&&(this.options.transition&&"none"!==this.options.transition&&("header"===this.role&&!this.options.fullscreen&&i>r||"footer"===this.role&&!this.options.fullscreen&&a-r>i+s)||this.options.fullscreen)},show:function(e){var t="ui-fixed-hidden",o=this.element;this._useTransition(e)?o.removeClass("out "+t).addClass("in").animationComplete(function(){o.removeClass("in")}):o.removeClass(t),this._visible=!0},hide:function(e){var t="ui-fixed-hidden",o=this.element,n="out"+("slide"===this.options.transition?" reverse":"");this._useTransition(e)?o.addClass(n).removeClass("in").animationComplete(function(){o.addClass(t).removeClass(n)}):o.addClass(t).removeClass(n),this._visible=!1},toggle:function(){this[this._visible?"hide":"show"]()},_bindToggleHandlers:function(){var t,o,n=this,i=n.options,r=!0;(this.page?this.page:e(".ui-page")).bind("vclick",function(t){i.tapToggle&&!e(t.target).closest(i.tapToggleBlacklist).length&&n.toggle()}).bind("focusin focusout",function(a){screen.width<1025&&e(a.target).is(i.hideDuringFocus)&&!e(a.target).closest(".ui-header-fixed, .ui-footer-fixed").length&&("focusout"!==a.type||r?"focusin"===a.type&&r&&(clearTimeout(t),r=!1,o=setTimeout(function(){n.hide()},0)):(r=!0,clearTimeout(o),t=setTimeout(function(){n.show()},0)))})},_setRelative:function(){"fixed"!==this.options.position&&e("[data-"+e.mobile.ns+"role='page']").css({position:"relative"})},_destroy:function(){var e=this.element,t=e.hasClass("ui-header");e.closest(".ui-page").css("padding-"+(t?"top":"bottom"),""),e.removeClass("ui-header-fixed ui-footer-fixed ui-header-fullscreen ui-footer-fullscreen in out fade slidedown slideup ui-fixed-hidden"),e.closest(".ui-page").removeClass("ui-page-header-fixed ui-page-footer-fixed ui-page-header-fullscreen ui-page-footer-fullscreen")}})}(e),function(e){e.widget("mobile.toolbar",e.mobile.toolbar,{_makeFixed:function(){this._super(),this._workarounds()},_workarounds:function(){var e=navigator.userAgent,t=navigator.platform,o=e.match(/AppleWebKit\/([0-9]+)/),n=!!o&&o[1],i=null,r=this;if(t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1||t.indexOf("iPod")>-1)i="ios";else{if(!(e.indexOf("Android")>-1))return;i="android"}if("ios"===i)r._bindScrollWorkaround();else{if(!("android"===i&&n&&534>n))return;r._bindScrollWorkaround(),r._bindListThumbWorkaround()}},_viewportOffset:function(){var e=this.element,t=e.hasClass("ui-header"),o=Math.abs(e.offset().top-this.window.scrollTop());return t||(o=Math.round(o-this.window.height()+e.outerHeight())-60),o},_bindScrollWorkaround:function(){var e=this;this._on(this.window,{scrollstop:function(){e._viewportOffset()>2&&e._visible&&e._triggerRedraw()}})},_bindListThumbWorkaround:function(){this.element.closest(".ui-page").addClass("ui-android-2x-fixed")},_triggerRedraw:function(){var t=parseFloat(e(".ui-page-active").css("padding-bottom"));e(".ui-page-active").css("padding-bottom",t+1+"px"),setTimeout(function(){e(".ui-page-active").css("padding-bottom",t+"px")},0)},destroy:function(){this._super(),this.element.closest(".ui-page-active").removeClass("ui-android-2x-fix")}})}(e),function(e,t){function o(){var e=i.clone(),t=e.eq(0),o=e.eq(1),n=o.children();return{arEls:o.add(t),gd:t,ct:o,ar:n}}var n=e.mobile.browser.oldIE&&e.mobile.browser.oldIE<=8,i=e("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container"+(n?" ie":"")+"'><div class='ui-popup-arrow'></div></div>");e.widget("mobile.popup",e.mobile.popup,{options:{arrow:""},_create:function(){var e=this._super();return this.options.arrow&&(this._ui.arrow=this._addArrow()),e},_addArrow:function(){var e,t=this.options,n=o();return e=this._themeClassFromOption("ui-body-",t.theme),n.ar.addClass(e+(t.shadow?" ui-overlay-shadow":"")),n.arEls.hide().appendTo(this.element),n},_unenhance:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()},_tryAnArrow:function(e,t,o,n,i){var r,a,s,l={},c={};return n.arFull[e.dimKey]>n.guideDims[e.dimKey]?i:(l[e.fst]=o[e.fst]+(n.arHalf[e.oDimKey]+n.menuHalf[e.oDimKey])*e.offsetFactor-n.contentBox[e.fst]+(n.clampInfo.menuSize[e.oDimKey]-n.contentBox[e.oDimKey])*e.arrowOffsetFactor,l[e.snd]=o[e.snd],r=n.result||this._calculateFinalLocation(l,n.clampInfo),a={x:r.left,y:r.top},c[e.fst]=a[e.fst]+n.contentBox[e.fst]+e.tipOffset,c[e.snd]=Math.max(r[e.prop]+n.guideOffset[e.prop]+n.arHalf[e.dimKey],Math.min(r[e.prop]+n.guideOffset[e.prop]+n.guideDims[e.dimKey]-n.arHalf[e.dimKey],o[e.snd])),s=Math.abs(o.x-c.x)+Math.abs(o.y-c.y),(!i||s<i.diff)&&(c[e.snd]-=n.arHalf[e.dimKey]+r[e.prop]+n.contentBox[e.snd],i={dir:t,diff:s,result:r,posProp:e.prop,posVal:c[e.snd]}),i)},_getPlacementState:function(e){var t,o,n=this._ui.arrow,i={clampInfo:this._clampPopupWidth(!e),arFull:{cx:n.ct.width(),cy:n.ct.height()},guideDims:{cx:n.gd.width(),cy:n.gd.height()},guideOffset:n.gd.offset()};return t=this.element.offset(),n.gd.css({left:0,top:0,right:0,bottom:0}),o=n.gd.offset(),i.contentBox={x:o.left-t.left,y:o.top-t.top,cx:n.gd.width(),cy:n.gd.height()},n.gd.removeAttr("style"),i.guideOffset={left:i.guideOffset.left-t.left,top:i.guideOffset.top-t.top},i.arHalf={cx:i.arFull.cx/2,cy:i.arFull.cy/2},i.menuHalf={cx:i.clampInfo.menuSize.cx/2,cy:i.clampInfo.menuSize.cy/2},i},_placementCoords:function(t){var o,i,r,a,s,l=this.options.arrow,c=this._ui.arrow;return c?(c.arEls.show(),s={},o=this._getPlacementState(!0),r={l:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:1,tipOffset:-o.arHalf.cx,arrowOffsetFactor:0},r:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:-1,tipOffset:o.arHalf.cx+o.contentBox.cx,arrowOffsetFactor:1},b:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:-1,tipOffset:o.arHalf.cy+o.contentBox.cy,arrowOffsetFactor:1},t:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:1,tipOffset:-o.arHalf.cy,arrowOffsetFactor:0}},e.each((!0===l?"l,t,r,b":l).split(","),e.proxy(function(e,n){i=this._tryAnArrow(r[n],n,t,o,i)},this)),i?(c.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-"+i.dir).removeAttr("style").css(i.posProp,i.posVal).show(),n||(a=this.element.offset(),s[r[i.dir].fst]=c.ct.offset(),s[r[i.dir].snd]={left:a.left+o.contentBox.x,top:a.top+o.contentBox.y}),i.result):(c.arEls.hide(),this._super(t))):this._super(t)},_setOptions:function(e){var o,n=this.options.theme,i=this._ui.arrow,r=this._super(e);if(e.arrow!==t){if(!i&&e.arrow)return void(this._ui.arrow=this._addArrow());i&&!e.arrow&&(i.arEls.remove(),this._ui.arrow=null)}return i=this._ui.arrow,i&&(e.theme!==t&&(n=this._themeClassFromOption("ui-body-",n),o=this._themeClassFromOption("ui-body-",e.theme),i.ar.removeClass(n).addClass(o)),e.shadow!==t&&i.ar.toggleClass("ui-overlay-shadow",e.shadow)),r},_destroy:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()}})}(e),function(e,o){e.widget("mobile.panel",{options:{classes:{panel:"ui-panel",panelOpen:"ui-panel-open",panelClosed:"ui-panel-closed",panelFixed:"ui-panel-fixed",panelInner:"ui-panel-inner",modal:"ui-panel-dismiss",modalOpen:"ui-panel-dismiss-open",pageContainer:"ui-panel-page-container",pageWrapper:"ui-panel-wrapper",pageFixedToolbar:"ui-panel-fixed-toolbar",pageContentPrefix:"ui-panel-page-content",animate:"ui-panel-animate"},animate:!0,theme:null,position:"left",dismissible:!0,display:"reveal",swipeClose:!0,positionFixed:!1},_closeLink:null,_parentPage:null,_page:null,_modal:null,_panelInner:null,_wrapper:null,_fixedToolbars:null,_create:function(){var t=this.element,o=t.closest(".ui-page, :jqmData(role='page')");e.extend(this,{_closeLink:t.find(":jqmData(rel='close')"),_parentPage:o.length>0&&o,_openedPage:null,_page:this._getPage,_panelInner:this._getPanelInner(),_fixedToolbars:this._getFixedToolbars}),"overlay"!==this.options.display&&this._getWrapper(),this._addPanelClasses(),e.support.cssTransform3d&&this.options.animate&&this.element.addClass(this.options.classes.animate),this._bindUpdateLayout(),this._bindCloseEvents(),this._bindLinkListeners(),this._bindPageEvents(),this.options.dismissible&&this._createModal(),this._bindSwipeEvents()},_getPanelInner:function(){var e=this.element.find("."+this.options.classes.panelInner);return 0===e.length&&(e=this.element.children().wrapAll("<div class='"+this.options.classes.panelInner+"' />").parent()),e},_createModal:function(){var t=this,o=t._parentPage?t._parentPage.parent():t.element.parent();t._modal=e("<div class='"+t.options.classes.modal+"'></div>").on("mousedown",function(){t.close()}).appendTo(o)},_getPage:function(){return this._openedPage||this._parentPage||e("."+e.mobile.activePageClass)},_getWrapper:function(){var e=this._page().find("."+this.options.classes.pageWrapper)
;0===e.length&&(e=this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='"+this.options.classes.pageWrapper+"'></div>").parent()),this._wrapper=e},_getFixedToolbars:function(){var t=e("body").children(".ui-header-fixed, .ui-footer-fixed"),o=this._page().find(".ui-header-fixed, .ui-footer-fixed");return t.add(o).addClass(this.options.classes.pageFixedToolbar)},_getPosDisplayClasses:function(e){return e+"-position-"+this.options.position+" "+e+"-display-"+this.options.display},_getPanelClasses:function(){var e=this.options.classes.panel+" "+this._getPosDisplayClasses(this.options.classes.panel)+" "+this.options.classes.panelClosed+" ui-body-"+(this.options.theme?this.options.theme:"inherit");return this.options.positionFixed&&(e+=" "+this.options.classes.panelFixed),e},_addPanelClasses:function(){this.element.addClass(this._getPanelClasses())},_handleCloseClickAndEatEvent:function(e){return e.isDefaultPrevented()?void 0:(e.preventDefault(),this.close(),!1)},_handleCloseClick:function(e){e.isDefaultPrevented()||this.close()},_bindCloseEvents:function(){this._on(this._closeLink,{click:"_handleCloseClick"}),this._on({"click a:jqmData(ajax='false')":"_handleCloseClick"})},_positionPanel:function(t){var o=this,n=o._panelInner.outerHeight(),i=n>e.mobile.getScreenHeight();i||!o.options.positionFixed?(i&&(o._unfixPanel(),e.mobile.resetActivePageHeight(n)),t&&this.window[0].scrollTo(0,e.mobile.defaultHomeScroll)):o._fixPanel()},_bindFixListener:function(){this._on(e(t),{throttledresize:"_positionPanel"})},_unbindFixListener:function(){this._off(e(t),"throttledresize")},_unfixPanel:function(){this.options.positionFixed&&e.support.fixedPosition&&this.element.removeClass(this.options.classes.panelFixed)},_fixPanel:function(){this.options.positionFixed&&e.support.fixedPosition&&this.element.addClass(this.options.classes.panelFixed)},_bindUpdateLayout:function(){var e=this;e.element.on("updatelayout",function(){e._open&&e._positionPanel()})},_bindLinkListeners:function(){this._on("body",{"click a":"_handleClick"})},_handleClick:function(t){var o,n=this.element.attr("id");return t.currentTarget.href.split("#")[1]===n&&void 0!==n?(t.preventDefault(),o=e(t.target),o.hasClass("ui-btn")&&(o.addClass(e.mobile.activeBtnClass),this.element.one("panelopen panelclose",function(){o.removeClass(e.mobile.activeBtnClass)})),this.toggle(),!1):void 0},_bindSwipeEvents:function(){var e=this,t=e._modal?e.element.add(e._modal):e.element;e.options.swipeClose&&("left"===e.options.position?t.on("swipeleft.panel",function(){e.close()}):t.on("swiperight.panel",function(){e.close()}))},_bindPageEvents:function(){var e=this;this.document.on("panelbeforeopen",function(t){e._open&&t.target!==e.element[0]&&e.close()}).on("keyup.panel",function(t){27===t.keyCode&&e._open&&e.close()}),this._parentPage||"overlay"===this.options.display||this._on(this.document,{pageshow:"_getWrapper"}),e._parentPage?this.document.on("pagehide",":jqmData(role='page')",function(){e._open&&e.close(!0)}):this.document.on("pagebeforehide",function(){e._open&&e.close(!0)})},_open:!1,_pageContentOpenClasses:null,_modalOpenClasses:null,open:function(t){if(!this._open){var o=this,n=o.options,i=function(){o.document.off("panelclose"),o._page().jqmData("panel","open"),e.support.cssTransform3d&&n.animate&&"overlay"!==n.display&&(o._wrapper.addClass(n.classes.animate),o._fixedToolbars().addClass(n.classes.animate)),!t&&e.support.cssTransform3d&&n.animate?o.element.animationComplete(r,"transition"):setTimeout(r,0),n.theme&&"overlay"!==n.display&&o._page().parent().addClass(n.classes.pageContainer+"-themed "+n.classes.pageContainer+"-"+n.theme),o.element.removeClass(n.classes.panelClosed).addClass(n.classes.panelOpen),o._positionPanel(!0),o._pageContentOpenClasses=o._getPosDisplayClasses(n.classes.pageContentPrefix),"overlay"!==n.display&&(o._page().parent().addClass(n.classes.pageContainer),o._wrapper.addClass(o._pageContentOpenClasses),o._fixedToolbars().addClass(o._pageContentOpenClasses)),o._modalOpenClasses=o._getPosDisplayClasses(n.classes.modal)+" "+n.classes.modalOpen,o._modal&&o._modal.addClass(o._modalOpenClasses).height(Math.max(o._modal.height(),o.document.height()))},r=function(){"overlay"!==n.display&&(o._wrapper.addClass(n.classes.pageContentPrefix+"-open"),o._fixedToolbars().addClass(n.classes.pageContentPrefix+"-open")),o._bindFixListener(),o._trigger("open"),o._openedPage=o._page()};o._trigger("beforeopen"),"open"===o._page().jqmData("panel")?o.document.on("panelclose",function(){i()}):i(),o._open=!0}},close:function(t){if(this._open){var o=this,n=this.options,i=function(){n.theme&&"overlay"!==n.display&&o._page().parent().removeClass(n.classes.pageContainer+"-themed "+n.classes.pageContainer+"-"+n.theme),o.element.addClass(n.classes.panelClosed),"overlay"!==n.display&&(o._page().parent().removeClass(n.classes.pageContainer),o._wrapper.removeClass(n.classes.pageContentPrefix+"-open"),o._fixedToolbars().removeClass(n.classes.pageContentPrefix+"-open")),e.support.cssTransform3d&&n.animate&&"overlay"!==n.display&&(o._wrapper.removeClass(n.classes.animate),o._fixedToolbars().removeClass(n.classes.animate)),o._fixPanel(),o._unbindFixListener(),e.mobile.resetActivePageHeight(),o._page().jqmRemoveData("panel"),o._trigger("close"),o._openedPage=null};o._trigger("beforeclose"),function(){o.element.removeClass(n.classes.panelOpen),"overlay"!==n.display&&(o._wrapper.removeClass(o._pageContentOpenClasses),o._fixedToolbars().removeClass(o._pageContentOpenClasses)),!t&&e.support.cssTransform3d&&n.animate?o.element.animationComplete(i,"transition"):setTimeout(i,0),o._modal&&o._modal.removeClass(o._modalOpenClasses)}(),o._open=!1}},toggle:function(){this[this._open?"close":"open"]()},_destroy:function(){var t,o=this.options,n=e("body > :mobile-panel").length+e.mobile.activePage.find(":mobile-panel").length>1;"overlay"!==o.display&&(t=e("body > :mobile-panel").add(e.mobile.activePage.find(":mobile-panel")),0===t.not(".ui-panel-display-overlay").not(this.element).length&&this._wrapper.children().unwrap(),this._open&&(this._fixedToolbars().removeClass(o.classes.pageContentPrefix+"-open"),e.support.cssTransform3d&&o.animate&&this._fixedToolbars().removeClass(o.classes.animate),this._page().parent().removeClass(o.classes.pageContainer),o.theme&&this._page().parent().removeClass(o.classes.pageContainer+"-themed "+o.classes.pageContainer+"-"+o.theme))),n||this.document.off("panelopen panelclose"),this._open&&this._page().jqmRemoveData("panel"),this._panelInner.children().unwrap(),this.element.removeClass([this._getPanelClasses(),o.classes.panelOpen,o.classes.animate].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout"),this._modal&&this._modal.remove()}})}(e),function(e,t){e.widget("mobile.table",{options:{classes:{table:"ui-table"},enhanced:!1},_create:function(){this.options.enhanced||this.element.addClass(this.options.classes.table),e.extend(this,{headers:t,allHeaders:t}),this._refresh(!0)},_setHeaders:function(){var e=this.element.find("thead tr");this.headers=this.element.find("tr:eq(0)").children(),this.allHeaders=this.headers.add(e.children())},refresh:function(){this._refresh()},rebuild:e.noop,_refresh:function(){var t=this.element,o=t.find("thead tr");this._setHeaders(),o.each(function(){var n=0;e(this).children().each(function(){var i,r=parseInt(this.getAttribute("colspan"),10),a=":nth-child("+(n+1)+")";if(this.setAttribute("data-"+e.mobile.ns+"colstart",n+1),r)for(i=0;r-1>i;i++)n++,a+=", :nth-child("+(n+1)+")";e(this).jqmData("cells",t.find("tr").not(o.eq(0)).not(this).children(a)),n++})})}})}(e),function(e){e.widget("mobile.table",e.mobile.table,{options:{mode:"columntoggle",columnBtnTheme:null,columnPopupTheme:null,columnBtnText:"Columns...",classes:e.extend(e.mobile.table.prototype.options.classes,{popup:"ui-table-columntoggle-popup",columnBtn:"ui-table-columntoggle-btn",priorityPrefix:"ui-table-priority-",columnToggleTable:"ui-table-columntoggle"})},_create:function(){this._super(),"columntoggle"===this.options.mode&&(e.extend(this,{_menu:null}),this.options.enhanced?(this._menu=e(this.document[0].getElementById(this._id()+"-popup")).children().first(),this._addToggles(this._menu,!0)):(this._menu=this._enhanceColToggle(),this.element.addClass(this.options.classes.columnToggleTable)),this._setupEvents(),this._setToggleState())},_id:function(){return this.element.attr("id")||this.widgetName+this.uuid},_setupEvents:function(){this._on(this.window,{throttledresize:"_setToggleState"}),this._on(this._menu,{"change input":"_menuInputChange"})},_addToggles:function(t,o){var n,i=0,r=this.options,a=t.controlgroup("container");o?n=t.find("input"):a.empty(),this.headers.not("td").each(function(){var t=e(this),s=e.mobile.getAttribute(this,"priority"),l=t.add(t.jqmData("cells"));s&&(l.addClass(r.classes.priorityPrefix+s),(o?n.eq(i++):e("<label><input type='checkbox' checked />"+(t.children("abbr").first().attr("title")||t.text())+"</label>").appendTo(a).children(0).checkboxradio({theme:r.columnPopupTheme})).jqmData("cells",l))}),o||t.controlgroup("refresh")},_menuInputChange:function(t){var o=e(t.target),n=o[0].checked;o.jqmData("cells").toggleClass("ui-table-cell-hidden",!n).toggleClass("ui-table-cell-visible",n),o[0].getAttribute("locked")?(o.removeAttr("locked"),this._unlockCells(o.jqmData("cells"))):o.attr("locked",!0)},_unlockCells:function(e){e.removeClass("ui-table-cell-hidden ui-table-cell-visible")},_enhanceColToggle:function(){var t,o,n,i,r=this.element,a=this.options,s=e.mobile.ns,l=this.document[0].createDocumentFragment();return t=this._id()+"-popup",o=e("<a href='#"+t+"' class='"+a.classes.columnBtn+" ui-btn ui-btn-"+(a.columnBtnTheme||"a")+" ui-corner-all ui-shadow ui-mini' data-"+s+"rel='popup'>"+a.columnBtnText+"</a>"),n=e("<div class='"+a.classes.popup+"' id='"+t+"'></div>"),i=e("<fieldset></fieldset>").controlgroup(),this._addToggles(i,!1),i.appendTo(n),l.appendChild(n[0]),l.appendChild(o[0]),r.before(l),n.popup(),i},rebuild:function(){this._super(),"columntoggle"===this.options.mode&&this._refresh(!1)},_refresh:function(e){this._super(e),e||"columntoggle"!==this.options.mode||(this._unlockCells(this.element.find(".ui-table-cell-hidden, .ui-table-cell-visible")),this._addToggles(this._menu,e),this._setToggleState())},_setToggleState:function(){this._menu.find("input").each(function(){var t=e(this);this.checked="table-cell"===t.jqmData("cells").eq(0).css("display"),t.checkboxradio("refresh")})},_destroy:function(){this._super()}})}(e),function(e){e.widget("mobile.table",e.mobile.table,{options:{mode:"reflow",classes:e.extend(e.mobile.table.prototype.options.classes,{reflowTable:"ui-table-reflow",cellLabels:"ui-table-cell-label"})},_create:function(){this._super(),"reflow"===this.options.mode&&(this.options.enhanced||(this.element.addClass(this.options.classes.reflowTable),this._updateReflow()))},rebuild:function(){this._super(),"reflow"===this.options.mode&&this._refresh(!1)},_refresh:function(e){this._super(e),e||"reflow"!==this.options.mode||this._updateReflow()},_updateReflow:function(){var t=this,o=this.options;e(t.allHeaders.get().reverse()).each(function(){var n,i,r=e(this).jqmData("cells"),a=e.mobile.getAttribute(this,"colstart"),s=r.not(this).filter("thead th").length&&" ui-table-cell-label-top",l=e(this).text();""!==l&&(s?(n=parseInt(this.getAttribute("colspan"),10),i="",n&&(i="td:nth-child("+n+"n + "+a+")"),t._addLabels(r.filter(i),o.classes.cellLabels+s,l)):t._addLabels(r,o.classes.cellLabels,l))})},_addLabels:function(e,t,o){e.not(":has(b."+t+")").prepend("<b class='"+t+"'>"+o+"</b>")}})}(e),function(e,o){var n=function(t,o){return-1===(""+(e.mobile.getAttribute(this,"filtertext")||e(this).text())).toLowerCase().indexOf(o)};e.widget("mobile.filterable",{initSelector:":jqmData(filter='true')",options:{filterReveal:!1,filterCallback:n,enhanced:!1,input:null,children:"> li, > option, > optgroup option, > tbody tr, > .ui-controlgroup-controls > .ui-btn, > .ui-controlgroup-controls > .ui-checkbox, > .ui-controlgroup-controls > .ui-radio"},_create:function(){var t=this.options;e.extend(this,{_search:null,_timer:0}),this._setInput(t.input),t.enhanced||this._filterItems((this._search&&this._search.val()||"").toLowerCase())},_onKeyUp:function(){var o,n,i=this._search;if(i){if(o=i.val().toLowerCase(),(n=e.mobile.getAttribute(i[0],"lastval")+"")&&n===o)return;this._timer&&(t.clearTimeout(this._timer),this._timer=0),this._timer=this._delay(function(){this._trigger("beforefilter",null,{input:i}),i[0].setAttribute("data-"+e.mobile.ns+"lastval",o),this._filterItems(o),this._timer=0},250)}},_getFilterableItems:function(){var t=this.element,o=this.options.children,n=o?e.isFunction(o)?o():o.nodeName?e(o):o.jquery?o:this.element.find(o):{length:0};return 0===n.length&&(n=t.children()),n},_filterItems:function(t){var o,i,r,a,s=[],l=[],c=this.options,u=this._getFilterableItems();if(null!=t)for(i=c.filterCallback||n,r=u.length,o=0;r>o;o++)a=i.call(u[o],o,t)?l:s,a.push(u[o]);0===l.length?u[c.filterReveal?"addClass":"removeClass"]("ui-screen-hidden"):(e(l).addClass("ui-screen-hidden"),e(s).removeClass("ui-screen-hidden")),this._refreshChildWidget(),this._trigger("filter",null,{items:u})},_refreshChildWidget:function(){var t,o,n=["collapsibleset","selectmenu","controlgroup","listview"];for(o=n.length-1;o>-1;o--)t=n[o],e.mobile[t]&&(t=this.element.data("mobile-"+t))&&e.isFunction(t.refresh)&&t.refresh()},_setInput:function(o){var n=this._search;this._timer&&(t.clearTimeout(this._timer),this._timer=0),n&&(this._off(n,"keyup change input"),n=null),o&&(n=o.jquery?o:o.nodeName?e(o):this.document.find(o),this._on(n,{keyup:"_onKeyUp",change:"_onKeyUp",input:"_onKeyUp"})),this._search=n},_setOptions:function(e){var t=!(e.filterReveal===o&&e.filterCallback===o&&e.children===o);this._super(e),e.input!==o&&(this._setInput(e.input),t=!0),t&&this.refresh()},_destroy:function(){var e=this.options,t=this._getFilterableItems();e.enhanced?t.toggleClass("ui-screen-hidden",e.filterReveal):t.removeClass("ui-screen-hidden")},refresh:function(){this._timer&&(t.clearTimeout(this._timer),this._timer=0),this._filterItems((this._search&&this._search.val()||"").toLowerCase())}})}(e),function(e,t){var o=function(e,t){return function(o){t.call(this,o),e._syncTextInputOptions(o)}},n=e.mobile.filterable.prototype.options.filterCallback;e.mobile.filterable.prototype.options.filterCallback=function(e,t){return!this.className.match(/(^|\s)ui-li-divider(\s|$)/)&&n.call(this,e,t)},e.widget("mobile.filterable",e.mobile.filterable,{options:{filterPlaceholder:"Filter items...",filterTheme:null},_create:function(){var t,o,n=this.element,i=["collapsibleset","selectmenu","controlgroup","listview"],r={};for(this._super(),e.extend(this,{_widget:null}),t=i.length-1;t>-1;t--)if(o=i[t],e.mobile[o]){if(this._setWidget(n.data("mobile-"+o)))break;r[o+"create"]="_handleCreate"}this._widget||this._on(n,r)},_handleCreate:function(e){this._setWidget(this.element.data("mobile-"+e.type.substring(0,e.type.length-6)))},_trigger:function(e,t,o){this._widget&&"mobile-listview"===this._widget.widgetFullName&&"beforefilter"===e&&this._widget._trigger("beforefilter",t,o),this._super(e,t,o)},_setWidget:function(e){return!this._widget&&e&&(this._widget=e,this._widget._setOptions=o(this,this._widget._setOptions)),this._widget&&(this._syncTextInputOptions(this._widget.options),"listview"===this._widget.widgetName&&(this._widget.options.hideDividers=!0,this._widget.element.listview("refresh"))),!!this._widget},_isSearchInternal:function(){return this._search&&this._search.jqmData("ui-filterable-"+this.uuid+"-internal")},_setInput:function(t){var o=this.options,n=!0,i={};if(!t){if(this._isSearchInternal())return;n=!1,t=e("<input data-"+e.mobile.ns+"type='search' placeholder='"+o.filterPlaceholder+"'></input>").jqmData("ui-filterable-"+this.uuid+"-internal",!0),e("<form class='ui-filterable'></form>").append(t).submit(function(e){e.preventDefault(),t.blur()}).insertBefore(this.element),e.mobile.textinput&&(null!=this.options.filterTheme&&(i.theme=o.filterTheme),t.textinput(i))}this._super(t),this._isSearchInternal()&&n&&this._search.attr("placeholder",this.options.filterPlaceholder)},_setOptions:function(o){var n=this._super(o);return o.filterPlaceholder!==t&&this._isSearchInternal()&&this._search.attr("placeholder",o.filterPlaceholder),o.filterTheme!==t&&this._search&&e.mobile.textinput&&this._search.textinput("option","theme",o.filterTheme),n},_destroy:function(){this._isSearchInternal()&&this._search.remove(),this._super()},_syncTextInputOptions:function(o){var n,i={};if(this._isSearchInternal()&&e.mobile.textinput){for(n in e.mobile.textinput.prototype.options)o[n]!==t&&(i[n]="theme"===n&&null!=this.options.filterTheme?this.options.filterTheme:o[n]);this._search.textinput("option",i)}}})}(e),function(e,t){function o(){return++i}function n(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}var i=0,r=/#.*$/;e.widget("ui.tabs",{version:"fadf2b312a05040436451c64bbfaf4814bc62c56",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,o=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",o.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),o.active=this._initialActive(),e.isArray(o.disabled)&&(o.disabled=e.unique(o.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(o.active):e(),this._refresh(),this.active.length&&this.load(o.active)},_initialActive:function(){var t=this.options.active,o=this.options.collapsible,n=location.hash.substring(1);return null===t&&(n&&this.tabs.each(function(o,i){return e(i).attr("aria-controls")===n?(t=o,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!o&&0),!o&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var o=e(this.document[0].activeElement).closest("li"),n=this.tabs.index(o),i=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:n++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,n--;break;case e.ui.keyCode.END:n=this.anchors.length-1;break;case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n!==this.options.active&&n);default:return}t.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,i),t.ctrlKey||(o.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,o){for(var n=this.tabs.length-1;-1!==e.inArray(function(){return t>n&&(t=0),0>t&&(t=n),t}(),this.options.disabled);)t=o?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+o()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,o=this.tablist.children(":has(a[href])");t.disabled=e.map(o.filter(".ui-state-disabled"),function(e){return o.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(o,i){var r,a,s,l=e(i).uniqueId().attr("id"),c=e(i).closest("li"),u=c.attr("aria-controls");n(i)?(r=i.hash,a=t.element.find(t._sanitizeSelector(r))):(s=t._tabId(c),r="#"+s,a=t.element.find(r),a.length||(a=t._createPanel(s),a.insertAfter(t.panels[o-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),u&&c.data("ui-tabs-aria-controls",u),c.attr({"aria-controls":r.substring(1),"aria-labelledby":l}),a.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var o,n=0;o=this.tabs[n];n++)!0===t||-1!==e.inArray(n,t)?e(o).addClass("ui-state-disabled").attr("aria-disabled","true"):e(o).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var o={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){o[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,o),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var o,n=this.element.parent();"fill"===t?(o=n.height(),o-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");"absolute"!==n&&"fixed"!==n&&(o-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){o-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,o-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(o=0,this.panels.each(function(){o=Math.max(o,e(this).height("").height())}).height(o))},_eventHandler:function(t){var o=this.options,n=this.active,i=e(t.currentTarget),r=i.closest("li"),a=r[0]===n[0],s=a&&o.collapsible,l=s?e():this._getPanelForTab(r),c=n.length?this._getPanelForTab(n):e(),u={oldTab:n,oldPanel:c,newTab:s?e():r,newPanel:l};t.preventDefault(),r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||a&&!o.collapsible||!1===this._trigger("beforeActivate",t,u)||(o.active=!s&&this.tabs.index(r),this.active=a?e():r,this.xhr&&this.xhr.abort(),c.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(r),t),this._toggle(t,u))},_toggle:function(t,o){function n(){r.running=!1,r._trigger("activate",t,o)}function i(){o.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&r.options.show?r._show(a,r.options.show,n):(a.show(),n())}var r=this,a=o.newPanel,s=o.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){o.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),i()}):(o.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),i()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),o.oldTab.attr("aria-selected","false"),a.length&&s.length?o.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr({"aria-expanded":"true","aria-hidden":"false"}),o.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var o,n=this._findActive(t);n[0]!==this.active[0]&&(n.length||(n=this.active),o=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:o,currentTarget:o,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),o=t.data("ui-tabs-aria-controls");o?t.attr("aria-controls",o).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(o){var n=this.options.disabled;!1!==n&&(o===t?n=!1:(o=this._getIndex(o),n=e.isArray(n)?e.map(n,function(e){return e!==o?e:null}):e.map(this.tabs,function(e,t){return t!==o?t:null})),this._setupDisabled(n))},disable:function(o){var n=this.options.disabled;if(!0!==n){if(o===t)n=!0;else{if(o=this._getIndex(o),-1!==e.inArray(o,n))return;n=e.isArray(n)?e.merge([o],n).sort():[o]}this._setupDisabled(n)}},load:function(t,o){t=this._getIndex(t);var i=this,r=this.tabs.eq(t),a=r.find(".ui-tabs-anchor"),s=this._getPanelForTab(r),l={tab:r,panel:s};n(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,o,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(r.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){s.html(e),i._trigger("load",o,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&i.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),e===i.xhr&&delete i.xhr},1)})))},_ajaxSettings:function(t,o,n){var i=this;return{url:t.attr("href"),beforeSend:function(t,r){return i._trigger("beforeLoad",o,e.extend({jqXHR:t,ajaxSettings:r},n))}}},_getPanelForTab:function(t){var o=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+o))}})}(e),function(e,t){function o(e){i=e.originalEvent,l=i.accelerationIncludingGravity,r=Math.abs(l.x),a=Math.abs(l.y),s=Math.abs(l.z),!t.orientation&&(r>7||(s>6&&8>a||8>s&&a>6)&&r>5)?n.enabled&&n.disable():n.enabled||n.enable()}e.mobile.iosorientationfixEnabled=!0;var n,i,r,a,s,l,c=navigator.userAgent;/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(c)&&c.indexOf("AppleWebKit")>-1?(n=e.mobile.zoom,e.mobile.document.on("mobileinit",function(){e.mobile.iosorientationfixEnabled&&e.mobile.window.bind("orientationchange.iosorientationfix",n.enable).bind("devicemotion.iosorientationfix",o)})):e.mobile.iosorientationfixEnabled=!1}(e,this),function(e,t){function n(){i.removeClass("ui-mobile-rendering")}var i=e("html"),r=e.mobile.window;e(t.document).trigger("mobileinit"),e.mobile.gradeA()&&(e.mobile.ajaxBlacklist&&(e.mobile.ajaxEnabled=!1),i.addClass("ui-mobile ui-mobile-rendering"),setTimeout(n,5e3),e.extend(e.mobile,{initializePage:function(){var t=e.mobile.path,i=e(":jqmData(role='page'), :jqmData(role='dialog')"),a=t.stripHash(t.stripQueryParams(t.parseLocation().hash));a&&a.length>0&&(h=o.getElementById(a)),i.length||(i=e("body").wrapInner("<div data-"+e.mobile.ns+"role='page'></div>").children(0)),i.each(function(){var t=e(this);t[0].getAttribute("data-"+e.mobile.ns+"url")||t.attr("data-"+e.mobile.ns+"url",t.attr("id")||location.pathname+location.search)}),e.mobile.firstPage=i.first(),e.mobile.pageContainer=e.mobile.firstPage.parent().addClass("ui-mobile-viewport").pagecontainer(),e.mobile.navreadyDeferred.resolve(),r.trigger("pagecontainercreate"),e.mobile.loading("show"),n(),e.mobile.hashListeningEnabled&&e.mobile.path.isHashValid(location.hash)&&(e(h).is(":jqmData(role='page')")||e.mobile.path.isPath(a)||a===e.mobile.dialogHashKey)?e.event.special.navigate.isPushStateEnabled()?(e.mobile.navigate.history.stack=[],e.mobile.navigate(e.mobile.path.isPath(location.hash)?location.hash:location.href)):r.trigger("hashchange",[!0]):(e.mobile.path.isHashValid(location.hash)&&(e.mobile.navigate.history.initialDst=a.replace("#","")),e.event.special.navigate.isPushStateEnabled()&&e.mobile.navigate.navigator.squash(t.parseLocation().href),e.mobile.changePage(e.mobile.firstPage,{transition:"none",reverse:!0,changeHash:!1,fromHashChange:!0}))}}),e(function(){e.support.inlineSVG(),e.mobile.hideUrlBar&&t.scrollTo(0,1),e.mobile.defaultHomeScroll=e.support.scrollTop&&1!==e.mobile.window.scrollTop()?1:0,e.mobile.autoInitializePage&&e.mobile.initializePage(),e.mobile.hideUrlBar&&r.load(e.mobile.silentScroll),e.support.cssPointerEvents||e.mobile.document.delegate(".ui-state-disabled,.ui-disabled","vclick",function(e){e.preventDefault(),e.stopImmediatePropagation()})}))}(e,this)}),wpa.webrtcapi=function(){function JsObjecSniffer(e,t,o){if(void 0===e)return void console.log("josniffer obj is undefine");if(null===e)return void console.log("josniffer obj is NULL");console.log("=========== JsObjecSniffer ============="),void 0!==t&&null!==t||(t=0),-1===t&&(t=100);var n=e;for(var i in n){!0===o&&"function"==typeof n[i]||console.log("[josniffer] "+i+": "+n[i]);var r="",a="",s="",l="",c="",u="",m="",g="",d="",p="",h="",f="",b="",v="",_="",E=null,T=null,P=null,S=null,N=null,w=null,I=null,C=null,R=null,y=null,L=null,D=null,G=null,x=null,O=null;if(null!==n&&"undefined"!=typeof n[i]&&null!==n[i]&&(E=n[i],t>0&&null!==E&&"object"==typeof E))for(var r in E)if(!0===o&&"function"==typeof E[r]||console.log("[josniffer] "+i+" - "+r+": "+E[r]),null!==E&&"undefined"!=typeof E[r]&&null!==E[r]&&(T=E[r],
t>1&&null!==T&&"object"==typeof T))for(var a in T)if(!0===o&&"function"==typeof T[a]||console.log("[josniffer] "+i+" - "+r+" - "+a+": "+T[a]),null!==T&&"undefined"!=typeof T[a]&&null!==T[a]&&(P=T[a],t>2&&null!==P&&"object"==typeof P))for(var s in P)if(!0===o&&"function"==typeof P[s]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+": "+P[s]),null!==P&&"undefined"!=typeof P[s]&&null!==P[s]&&(S=P[s],t>3&&null!==S&&"object"==typeof S))for(var l in S)if(!0===o&&"function"==typeof S[l]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+": "+S[l]),null!==S&&"undefined"!=typeof S[l]&&null!==S[l]&&(N=S[l],t>4&&null!==N&&"object"==typeof N))for(var c in N)if(!0===o&&"function"==typeof N[c]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+": "+N[c]),null!==N&&"undefined"!=typeof N[c]&&null!==N[c]&&(w=N[c],t>5&&null!==w&&"object"==typeof w))for(var u in w)if(!0===o&&"function"==typeof w[u]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+": "+w[u]),null!==w&&"undefined"!=typeof w[u]&&null!==w[u]&&(I=w[u],t>6&&null!==I&&"object"==typeof I))for(var m in I)if(!0===o&&"function"==typeof I[m]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+": "+I[m]),null!==I&&"undefined"!=typeof I[m]&&null!==I[m]&&(C=I[m],t>7&&null!==C&&"object"==typeof C))for(var g in C)if(!0===o&&"function"==typeof C[g]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+": "+C[g]),null!==C&&"undefined"!=typeof C[g]&&null!==C[g]&&(R=C[g],t>8&&null!==R&&"object"==typeof R))for(var d in R)if(!0===o&&"function"==typeof R[d]||console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+": "+R[d]),null!==R&&"undefined"!=typeof R[d]&&null!==R[d]&&(y=R[d],t>9&&null!==y&&"object"==typeof y))for(var p in y)if(console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+": "+y[p]),null!==y&&"undefined"!=typeof y[p]&&null!==y[p]&&(L=y[p],t>10&&null!==L&&"object"==typeof L))for(var h in L)if(console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+" - "+h+": "+L[h]),null!==L&&"undefined"!=typeof L[h]&&null!==L[h]&&(D=L[h],t>11&&null!==D&&"object"==typeof D))for(var f in D)if(console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+" - "+h+" - "+f+": "+D[f]),null!==D&&"undefined"!=typeof D[f]&&null!==D[f]&&(G=D[f],t>12&&null!==G&&"object"==typeof G))for(var b in G)if(console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+r+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+" - "+h+" - "+f+" - "+b+": "+G[b]),null!==G&&"undefined"!=typeof G[b]&&null!==G[b]&&(x=G[b],t>13&&null!==x&&"object"==typeof x))for(var v in x)if(console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+" - "+h+" - "+f+" - "+b+" - "+v+": "+x[v]),null!==x&&"undefined"!=typeof x[v]&&null!==x[v]&&(O=x[v],t>14&&null!==O&&"object"==typeof O))for(var _ in O)console.log("[josniffer] "+i+" - "+r+" - "+a+" - "+s+" - "+l+" - "+c+" - "+u+" - "+m+" - "+g+" - "+d+" - "+p+" - "+h+" - "+f+" - "+b+" - "+v+" - "+_+": "+O[_])}console.log("=========== End JsObjecSniffer =============")}function WebRtcIsSupported(e){try{if(!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, webrtcapi: WebRtcIsSupported callback is NULL");var t=document.getElementById("dtmfTone"),o=document.getElementById("justbeep_1");common.isNull(t)&&j$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),common.isNull(o)&&j$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>');var n=!1;window.WebSocket&&(n=!0);var i=!1;return(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(i=!0),peerconSupport=!1,window.RTCPeerConnection&&(peerconSupport=!0),!0===n&&!0===i&&!0===peerconSupport?(e(!0),!0):(common.PutToDebugLog(2,"EVENT, WebRtcIsSupported: WebRTC not supported: wssuport: "+n+"; gumSupport: "+i+"; peerconSupport: "+peerconSupport),e(!1),!1)}catch(r){common.PutToDebugLogException(2,"webrtcapi: WebRtcIsSupported",r);try{e(!1)}catch(r){}}}function LoadScript(e,t,o){try{if(!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, webrtcapi: LoadScript success callback NOT set");if(!o||"function"!=typeof o)return void common.PutToDebugLog(2,"ERROR, webrtcapi: LoadScript error callback NOT set");jQuery.ajax({url:e,dataType:"script",method:"GET",timeout:8e3,success:t,error:o,async:!0})}catch(n){common.PutToDebugLogException(2,"webrtcapi: LoadScript",n)}}function LoadWebrtc(e){try{if(initcallback=e,!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, webrtcapi: CheckIfSupported callback is NULL");if("undefined"==typeof SIPml||null===SIPml){var t=webphone_api.getbasedir2()+"js/lib/wen.js";common.PutToDebugLog(2,"EVENT, Loading WebRTC engine script: "+t),LoadScript(t,function(){LoadWebrtcInner(initcallback)},function(){common.PutToDebugLog(2,"ERROR, LoadWebrtc: failed to load script"),LoadWebrtcInner(initcallback)})}else LoadWebrtcInner(e)}catch(o){common.PutToDebugLogException(2,"webrtcapi: LoadWebrtc",o),e(!1)}}function LoadWebrtcInner(e){try{j$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'),j$(document.body).append('<audio id="ringtone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'),j$(document.body).append('<audio id="ringbacktone" loop src="'+webphone_api.getbasedir2()+'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'),j$(document.body).append('<audio id="dtmfTone" src="'+webphone_api.getbasedir2()+'sound/rtc_dtmf.wav" ></audio>'),j$(document.body).append('<audio id="justbeep_1" src="'+webphone_api.getbasedir2()+'sound/beep-01.wav" ></audio>'),AddVideoElemnts(!1),setTimeout(function(){AddVideoElemnts(!0)},5e3),document.onkeyup=onKeyUp,document.body.onkeyup=onKeyUp;var t="error";common.GetLogLevel()>1&&(t="info"),SIPml.setDebugLevel(t);var o=function(e){for(var t=window.location.search.substring(1),o=t.split("&"),n=0;n<o.length;n++){var i=o[n].split("=");if(decodeURIComponent(i[0])===e)return decodeURIComponent(i[1])}return null},n=function(){var t=o("wt"),n=o("fps"),i=o("mvs"),r=o("mbwu"),a=o("mbwd"),s=o("za"),l=o("ndb");if(SIPml.isInitialized())return void e(!0);t&&SIPml.setWebRtcType(t),SIPml.init(CheckIfSupported,function(t){common.PutToDebugLogException(2,"webrtc: preinit SIPml.init",t),common.PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (10)"),e(!1)}),n&&SIPml.setFps(parseFloat(n)),i&&SIPml.setMaxVideoSize(i),r&&SIPml.setMaxBandwidthUp(parseFloat(r)),a&&SIPml.setMaxBandwidthDown(parseFloat(a)),s&&SIPml.setZeroArtifacts("true"===s),"true"==l&&SIPml.startNativeDebug()};common.isNull(oReadyStateTimer)||clearInterval(oReadyStateTimer);var i=(common.GetTickCount(),0);oReadyStateTimer=setInterval(function(){i++,common.GetTickCount()-webphone_api.loadwebrtc_timestamp>25e3&&"Edge"===common.GetBrowser()&&(common.PutToDebugLog(2,"ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),console.log("ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"),window.location.reload()),"complete"!==document.readyState&&!0!==webphone_api.document_loaded||(clearInterval(oReadyStateTimer),n())},50)}catch(r){common.PutToDebugLogException(2,"webrtcapi: LoadWebrtc inner",r),e(!1)}}function CheckIfSupported(){var e=0;try{return SIPml.isWebRtcSupported()?(e=5,SIPml.isWebSocketSupported()?(e=10,viewVideoLocal=videoLocal,viewVideoRemote=videoRemote,e=11,SIPml.isWebRtcSupported()?(e=16,postInit(),e=17,common.isNull(initcallback)||(e=18,initcallback(!0),e=19),e=20,!0):(e=12,common.PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (3)"),common.isNull(initcallback)||(e=13,initcallback(!1),e=14),e=15,!1)):(e=6,common.PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (2)"),common.isNull(initcallback)||(e=7,initcallback(!1),e=8),e=9,!1)):(e=1,common.PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (1)"),common.isNull(initcallback)||(e=2,initcallback(!1),e=3),e=4,!1)}catch(t){return common.PutToDebugLog(2,"EVENT, WebRTC CheckIfSupported false (4)"),common.PutToDebugLogException(2,"webrtcapi: CheckIfSupported ("+e+")",t),common.isNull(initcallback)||initcallback(!1),!1}}function postInit(){try{isregistered=!1,common.isNull(audioRemote)&&common.PutToDebugLog(2,"ERROR, Cannot find audio_remote html element (incoming audio will not work without this element!!)"),callsipheaders=RemoveDuplicateHeader(callsipheaders),oConfigCall={audio_remote:audioRemote,video_local:viewVideoLocal,video_remote:viewVideoRemote,screencast_window_id:0,bandwidth:{audio:0,video:undefined},video_size:null,events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im"}],sip_headers:callsipheaders},oConfigMessage={events_listener:{events:"*",listener:onSipEventSession}},oConfigSms={events_listener:{events:"*",listener:onSipEventSession},sip_headers:[{name:"P-Sms",value:"Yes"}]}}catch(e){common.PutToDebugLogException(2,"webrtcapi: postInit",e)}}function SetSipHeader(e,t){try{var o=!1;!0!==common.IsMizuWebRTCGateway()&&!0!==common.IsMizuWebRTCEmbeddedServer()&&!0!==common.IsMizuServer()||(o=!0);var n=common.GetParameter("customsipheader");if(!common.isNull(n)&&n.length>0){var i=null;if(i=n.indexOf(";")>0?n.split(";"):n.indexOf("\r\n")>0?n.split("\r\n"):n.split("\n"),!common.isNull(i)&&i.length>0)for(var r=0;r<i.length;r++)if(!(common.isNull(i[r])||common.Trim(i[r]).length<1||i[r].indexOf(":")<1)){var a=common.Trim(i[r].substring(0,i[r].indexOf(":"))),s=common.Trim(i[r].substring(i[r].indexOf(":")+1,i[r].length));common.isNull(a)||a.length<1||(common.isNull(s)&&(s=""),!0===o&&0!==a.indexOf("X-")&&(a="X-R-"+a),AddSipHeader(sipheaders,a,s),AddSipHeader(callsipheaders,a,s))}}if(common.isNull(t))return;t=common.Trim(t);var l;if(l=t.indexOf(";")>0?t.split(";"):t.indexOf("\r\n")>0?t.split("\r\n"):t.split("\n"),common.isNull(l)||l.length<1)return;if(-1===e&&(e=common.GetBestLine()),t.length<1)if(-2===e||!1===global.checkIfInCall){for(var r=0;r<sipheaders.length;r++){var c=sipheaders[r].name;"User-Agent"!==c&&"Organization"!==c&&c.indexOf("Webdomain")<0&&"P-Sms"!==c&&"Sy.Uppersrv"!==c&&"X-Sy.Uppersrv"!==c&&"Sy.Upperproxy"!==c&&"X-Sy.Upperproxy"!==c&&"X-IMStatus"!==c&&"X-P2P"!==c&&"X-AUSR"!==c&&"X-Sy.Uppersrvd"!==c&&"X-P2P"!==c&&(sipheaders.splice(r,1),r--)}oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var r=0;r<global.ep.length;r++)try{var u=global.ep[r][common.EP_SIPHEADERS];if(common.isNull(u)||u.length<1)continue;for(var m=0;m<u.length;m++){var c=u[m].name;"User-Agent"!==c&&"Organization"!==c&&c.indexOf("Webdomain")<0&&"P-Sms"!==c&&"Sy.Uppersrv"!==c&&"X-Sy.Uppersrv"!==c&&"Sy.Upperproxy"!==c&&"X-Sy.Upperproxy"!==c&&"X-IMStatus"!==c&&"X-P2P"!==c&&"X-AUSR"!==c&&"X-Sy.Uppersrvd"!==c&&"X-P2P"!==c&&(u.splice(m,1),m--)}global.ep[r][common.EP_SIPHEADERS]=u;var g=global.ep[r][common.EP_SESSION];common.isNull(g)||(u=RemoveDuplicateHeader(u),g.setConfiguration({sip_headers:u}))}catch(b){common.PutToDebugLogException(2,"webrtcapi: SetSipHeader remove from callseesions",b)}}else if(e>0){for(var d=-1,r=0;r<global.ep.length;r++){var p=global.ep[common.EP_LINE];if(p===e){d=r;break}}if(d>-1){var u=global.ep[d][common.EP_SIPHEADERS];if(!common.isNull(u)&&u.length>0){for(var m=0;m<u.length;m++){var c=u[m].name;"User-Agent"!==c&&"Organization"!==c&&c.indexOf("Webdomain")<0&&"P-Sms"!==c&&"Sy.Uppersrv"!==c&&"X-Sy.Uppersrv"!==c&&"Sy.Upperproxy"!==c&&"X-Sy.Upperproxy"!==c&&"X-IMStatus"!==c&&"X-P2P"!==c&&"X-AUSR"!==c&&"X-Sy.Uppersrvd"!==c&&"X-P2P"!==c&&(u.splice(m,1),m--)}global.ep[d][common.EP_SIPHEADERS]=u;var g=global.ep[d][common.EP_SESSION];common.isNull(g)||(u=RemoveDuplicateHeader(u),g.setConfiguration({sip_headers:u}))}}}for(var r=0;r<l.length;r++)if(!(common.isNull(l[r])||l[r].indexOf(":")<1)){var a=l[r].substring(0,l[r].indexOf(":")),h=l[r].substring(l[r].indexOf(":")+1);if(common.isNull(h)&&(h=""),!0===o&&0!==a.indexOf("X-")&&(a="X-R-"+a),-2===e||!1===global.checkIfInCall){AddSipHeader(sipheaders,a,h),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}));for(var m=0;m<global.ep.length;m++)try{var u=global.ep[m][common.EP_SIPHEADERS];if(common.isNull(u)||u.length<1)continue;AddSipHeader(u,a,h),global.ep[m][common.EP_SIPHEADERS]=u;var g=global.ep[m][common.EP_SESSION];common.isNull(g)||(u=RemoveDuplicateHeader(u),g.setConfiguration({sip_headers:u}))}catch(b){common.PutToDebugLogException(2,"webrtcapi: SetSipHeader add OR remove from callseesions",b)}AddSipHeader(callsipheaders,a,h)}else if(e>0){for(var d=-1,f=0;f<global.ep.length;f++){var p=global.ep[common.EP_LINE];if(p===e){d=f;break}}if(d>-1){var u=global.ep[d][common.EP_SIPHEADERS];if(!common.isNull(u)&&u.length>0){AddSipHeader(u,a,h),global.ep[d][common.EP_SIPHEADERS]=u;var g=global.ep[d][common.EP_SESSION];common.isNull(g)||(u=RemoveDuplicateHeader(u),g.setConfiguration({sip_headers:u}))}}}}}catch(b){common.PutToDebugLogException(2,"webrtcapi: SetSipHeader",b)}}function AddSipHeader(e,t,o){try{if(common.isNull(e)&&(e=[]),common.isNull(t)||t.length<1)return;common.isNull(o)&&(o=""),common.PutToDebugLog(4,"EVENT, AddSipHeader: "+t+": "+o);for(var n=t.toLowerCase(),i=!1,r=0;r<e.length;r++){var a=e[r].name;if(!(common.isNull(a)||a.length<1)&&(a=a.toLowerCase(),n===a)){"User-Agent"!==t&&"Organization"!==t&&t.indexOf("Webdomain")<0&&"P-Sms"!==t&&"Sy.Uppersrv"!==t&&"X-Sy.Uppersrv"!==t&&"Sy.Upperproxy"!==t&&"X-Sy.Upperproxy"!==t&&"X-P2P"!==t&&"X-AUSR"!==t&&"X-Sy.Uppersrvd"!==t&&"X-P2P"!==t&&(t.length<1?e[r].splice(r,1):e[r].value=o),i=!0;break}}!1===i&&t.length>0&&(e[e.length]={},e[e.length-1].name=t,e[e.length-1].value=o),e=RemoveDuplicateHeader(e)}catch(s){common.PutToDebugLogException(2,"webrtcapi: AddSipHeader",s)}}function RemoveDuplicateHeader(e){try{var t=e,o=[];if(common.isNull(t)||t.length<1)return e;for(var n=t.length-1;n>=0;n--)if(!common.isNull(t[n])){for(var i=!1,r=0;r<o.length;r++)if(o[r].name===t[n].name){i=!0;break}!1===i&&o.push(t[n])}if(!common.isNull(o))return o}catch(a){common.PutToDebugLogException(2,"webrtcapi: RemoveDuplicateHeader",a)}return e}function ReStart(e,t){try{if(common.isNull(te2)&&(te2=common.Te2()),te2)return;if(common.PutToDebugLog(2,"EVENT, webrtcapi restart flag: "+webphone_api.flagrestartwebrtc.toString()),!1===webphone_api.flagrestartwebrtc)return;if(!0===t)return common.PutToDebugLog(2,"EVENT, restarting webrtc sipstack: forced"),restartdelay=2e3,common.CallWsuserKeepAlive(!0),void Start();var o=common.GetTickCount();if(!common.isNull(e)&&common.IsNumber(e)&&(restartdelay=common.StrToInt(e)),o<=lastrestarttick+restartdelay)return;o-lastrestarttick>8e5&&restartdelay>2e3&&(restartdelay=2e3),o>lastrestarttick+restartdelay&&o-lastrestarttick<512e3&&(restartdelay*=2),lastrestarttick=o;var n=new Date(lastrestarttick),i=n.getHours(),r=n.getMinutes(),a=n.getSeconds();r<10&&(r="0"+r),a<10&&(a="0"+a),restarttimestr=i+":"+r+":"+a,setTimeout(function(){common.PutToDebugLog(2,"EVENT, restarting webrtc sipstack: "+restarttimestr),common.CallWsuserKeepAlive(!0),Start()},restartdelay)}catch(s){common.PutToDebugLogException(2,"webrtcapi: ReStart",s)}}function Start(){try{LoadWebrtc(function(e){common.PutToDebugLog(2,"EVENT, webrtcapi: LoadWebrtc returned: "+e),StartInner()})}catch(e){common.PutToDebugLogException(2,"webrtcapi: Start",e)}}function StartInner(){try{common.PutToDebugLog(2,"EVENT, webrtcapi start"),webphone_api.flagrestartwebrtc=!0,StartGetDevices(),common.PutToDebugLog(2,"EVENT, mlogic API_Setvolume on WebRTC start"),webphone_api.setvolume(1,common.GetParameter("volumeout"));var chsptr=common.GetParameter2("changesptoring");(common.isNull(chsptr)||chsptr.length<1||!1===common.IsNumber(chsptr))&&(chsptr=2),changesptoring=common.StrToInt(chsptr);var remonco=common.GetParameter2("recheckmediaonconnect");(common.isNull(remonco)||remonco.length<1||!1===common.IsNumber(remonco))&&(remonco=2),recheckmediaonconnect=common.StrToInt(remonco),(recheckmediaonconnect<0||recheckmediaonconnect>3)&&(recheckmediaonconnect=2),global.autoacceptsipheader=common.GetParameter("autoacceptsipheader");var sipusername=common.GetSipusername(),password=common.GetParameter("password"),callerid=common.GetParameter("username");(common.isNull(callerid)||common.Trim(callerid).length<1)&&(callerid=sipusername);var udpaddr=GetUDPServerAddress(),wsaddr=common.GetWebrtcSrvAddr(),displayname=common.GetParameter("displayname");if((common.isNull(displayname)||displayname.length<1)&&sipusername!==callerid&&(displayname=sipusername),!0===common.GetParameterBool("hidemyidentity",!1)&&(displayname=""),2===common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),common.isNull(wsaddr)||wsaddr.length<2){wsaddr=common.GetWp();var wstmp=wsaddr;wstmp.indexOf("//")>=0&&(wstmp=wstmp.substring(wstmp.indexOf("//")+2,wstmp.length)),wstmp.indexOf(":")>0&&(wstmp=wstmp.substring(0,wstmp.indexOf(":")))}else wsaddr=common.Trim(wsaddr.toLowerCase());wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=common.GetProxyaddress();if(common.isNull(proxyaddress)&&(proxyaddress=""),!0===common.IsMizuServer()&&proxyaddress.length<1&&(proxyaddress=sipaddress),proxyaddress=common.GetProxyaddress(proxyaddress),proxyaddress.length>0)if(!0===common.IsMizuServer()||!0===common.IsMizuWebRTCGateway()||!0===common.IsMizuWebRTCEmbeddedServer())proxyaddress="udp://"+proxyaddress;else{var transport=common.GetParameterInt("transport",0),transpStr="udp";1===transport?transpStr="tcp":2===transport&&(transpStr="tls"),transport.indexOf(":")<0&&(transport+="://"),proxyaddress=transport+proxyaddress}var wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();!1!==common.IsIPAddrress(wsaddress)&&!0!==common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:")),!1===global.decideusuk_finished&&(!0===common.IsUKGateway(wsaddress)?(global.usuk="uk",global.decideusuk_finished=!0):!0===common.IsUSGateway(wsaddress)&&(global.usuk="us",global.decideusuk_finished=!0));var publicsipaddress=common.GetConfig("publicsipaddress");common.isNull(publicsipaddress)&&(publicsipaddress=""),publicsipaddress.length>0&&common.PutToDebugLog(2,"EVENT, WebRTC publicsipaddress is set to: "+publicsipaddress);var realm=publicsipaddress;realm.length<2&&(realm=common.GetParameter("realm"),(common.isNull(realm)||realm.length<2)&&(realm=udpaddr)),realm=common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=common.Trim(realm),mRealm=realm;var sipuri=callerid;if(sipuri.indexOf("sip:")<0&&(sipuri="sip:"+callerid),sipuri.indexOf("@")<0)if(sipuri+="@",publicsipaddress.length>1)sipuri+=publicsipaddress;else if(realm.indexOf(".")>0)sipuri+=realm;else{var tmpsrv=sipaddress;tmpsrv=tmpsrv.toLowerCase(),tmpsrv=common.NormalizeInput(tmpsrv,0),tmpsrv.indexOf(":")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf(":"))),tmpsrv.indexOf("/")>0&&(tmpsrv=tmpsrv.substring(0,tmpsrv.indexOf("/"))),sipuri+=tmpsrv}if(!common.isNull(sipuri)&&sipuri.indexOf("@")>0){var addrtmp=sipuri.substr(sipuri.indexOf("@")+1);if(!common.isNull(addrtmp)&&(addrtmp.indexOf(":")>0&&(addrtmp=addrtmp.substring(0,addrtmp.indexOf(":"))),!common.isNull(addrtmp)&&addrtmp.length>0&&common.IsLanIP(addrtmp)&&common.GetWebrtcSrvAddr().length<2))return common.PutToDebugLog(1,"ERROR, "+stringres.get("webrtc_local_sipserver")+" (2)"),(!0===global.usestorage||common.Strl(60))&&alert("ERROR, "+stringres.get("webrtc_local_sipserver")+"\n\n"+stringres.get("all_demo_msg")+" (2)"),!1}var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!1===common.IsMizuWebRTCGateway()&&!1===common.IsMizuWebRTCEmbeddedServer()),common.PutToDebugLog(2,"EVENT, webrtcapi: Start rtcbreaker: "+enableRTCWebBreaker.toString());var organization=common.GetConfig("companyname");(common.isNull(organization)||organization.length<1)&&(organization=common.GetConfig("brandname"),(common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=common.GetUA();common.GetParameter("useragent").length>0&&!1===common.IsMizuWebRTCGateway()&&(ua=common.GetParameter("useragent")),sipheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:common.GetWebdomain()}];var xhval="1";!0===common_public.Hasesw()?xhval="2":!0===common_public.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval,SetSipHeader(0);var company=common.GetParameter("companyname");!common.isNull(company)&&company.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Company",sipheaders[sipheaders.length-1].value=company);var brand=common.GetParameter("brandname");!common.isNull(brand)&&brand.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Brand",sipheaders[sipheaders.length-1].value=brand);var uppsrv=common.GetWebrtcSyUpperHeader("start");uppsrv.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrv",sipheaders[sipheaders.length-1].value=uppsrv);var uppsrvd=common.GetWebrtcSyUpperDomainHeader("start");uppsrvd.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Uppersrvd",sipheaders[sipheaders.length-1].value=uppsrvd);var xp2p=common.GetConfig("p2p");!common.isNull(xp2p)&&xp2p.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value=xp2p),global.addauser_header=!1,!common.isNull(sipusername)&&sipusername.length>0&&!common.isNull(callerid)&&callerid.length>0&&sipusername!==callerid&&(global.addauser_header=!0,sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-AUSR",sipheaders[sipheaders.length-1].value=sipusername);var prxy=common.GetParameter("proxyaddress");!common.isNull(prxy)&&prxy.length>0&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-Sy.Upperproxy",sipheaders[sipheaders.length-1].value=prxy),common.UsePresence2(),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-IMStatus",sipheaders[sipheaders.length-1].value="Online",0===common.GetParameterInt("p2psignaling",1)&&(sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-P2P",sipheaders[sipheaders.length-1].value="no"),sipheaders=RemoveDuplicateHeader(sipheaders);var loglevel="error";common.GetLogLevel()>1&&(loglevel="info"),SIPml.setDebugLevel(loglevel),window.webkitNotifications&&0!=window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),(common.isNull(sipusername)||sipusername.length<1)&&(common.PutToDebugLog(2,"ERROR, WebRTC invalid username: "+sipusername),common.PutToDebugLog(1,"ERROR, Invalid username")),(common.isNull(password)||password.length<1)&&(common.PutToDebugLog(2,"ERROR, WebRTC invalid password: "+password),common.PutToDebugLog(1,"ERROR, Invalid password")),(common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&common.PutToDebugLog(2,"ERROR, WebRTC invalid sipuri: "+sipuri);var stun_turn=[],stun=common.GetStunServersStr(),turn=common.GetTurnSrv();if(!common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===common.GetBrowser()&&common.GetBrowserVersion()>40||"Firefox"===common.GetBrowser()&&common.GetBrowserVersion()>40)&&(useurls=!0),!common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}common.isNull(turn)||common.IsLocalServer()||stun_turn.push(turn);var logparams={};if(!common.isNull(common.settmap2)){for(var key in common.settmap2){var value=common.settmap2[key];common.isNull(value)||(key.indexOf("server")<0&&key.indexOf("username")<0&&key.indexOf("password")<0&&"1"===value[common.SETT_ISDEFAULT]||(logparams[key]=value[common.SETT_VALUE]))}var extraoption=common.GetParameter("extraoption");if(!common.isNull(extraoption)&&extraoption.length>0){extraoption=common.Trim(extraoption);var optionlist=extraoption.split(";");if(!common.isNull(optionlist)&&optionlist.length>0)for(var i=0;i<optionlist.length;i++)if(!(common.isNull(optionlist[i])||optionlist[i].length<1||optionlist[i].indexOf("=")<1)){var key=common.Trim(optionlist[i].substring(0,optionlist[i].indexOf("="))),value=common.Trim(optionlist[i].substring(optionlist[i].indexOf("=")+1));!common.isNull(key)&&key.length>0&&!common.isNull(value)&&(logparams[key]=value)}}}if(common.IsCExt()>0&&(global.add_recall_header=!0),common.LogAllParameters("WebRTC all parameters (just informative):",logparams),common.PutToDebugLog(3,"Webrtc connection details:"),common.PutToDebugLog(3,"sipusername: "+sipusername),(common.GetLogLevel()>1||!0===global.isdebugversion)&&common.PutToDebugLog(3,"password: "+password),common.PutToDebugLog(3,"sipuri: "+sipuri),common.PutToDebugLog(3,"displayname: "+displayname),common.PutToDebugLog(3,"wsaddress: "+wsaddress),common.PutToDebugLog(3,"proxyaddress: "+proxyaddress),common.PutToDebugLog(3,"realm: "+realm),(common.isNull(global.usuk)||global.usuk.length<1)&&(common.IsUKGateway(wsaddress)?(common.PutToDebugLog(2,"WARNING, webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),global.usuk="uk"):common.IsUSGateway(wsaddress)&&(common.PutToDebugLog(2,"WARNING, webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),global.usuk="us")),mSipuri=sipuri,mDisplayname=displayname,!common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="turn server";!common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="stun server"),common.PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else common.PutToDebugLog(3,"stun server: NOT set");var iceobj=null,icestr=common.GetParameter("ice");if(!common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,common.PutToDebugLogException(2,"ERROR, webrtcapi parse ICE servers",eice)}if(!common.isNull(iceobj)){try{common.PutToDebugLog(2,"EVENT, webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1),common.isNull(te2)&&(te2=common.Te2()),te2&&(stun_turn=null),webphone_api.webrtcMicVolume=GetVolume(0)/100,global.minten=!1;try{sipheaders=RemoveDuplicateHeader(sipheaders),oSipStack=new SIPml.Stack({realm:realm,impi:sipusername,impu:sipuri,password:password,display_name:displayname,websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSipEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sipheaders})}catch(err_reg){var reason="";common.isNull(err_reg)||(reason=err_reg.toString()),!common.isNull(reason)&&reason.indexOf("is not valid as SIP Uri")>=0&&(reason=common.NormalizeInput2(sipusername,1)!==sipusername?"invalid SIP Uri because username contains special characters: "+sipusername:"invalid serveraddress: "+realm),!common.isNull(reason)&&reason.length>0&&(lastregfailreason=reason,common.PutToDebugLog(1,"ERROR, Register failed: "+reason));try{webphone_api.onRegStateChangeCb("failed",reason)}catch(errin){common.PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed(failed) callback",errin)}try{webphone_api.onRegisterFailedCb(reason)}catch(errin){common.PutToDebugLogException(2,"webrtcapi: Start: There is an error in onRegisterFailed() callback",errin)}common.PutToDebugLogException(2,"webrtcapi: Start failed to create SIPstack",err_reg)}return common.GetParameterInt("forcereregister",1)>1&&StartReRegister(!0),global.webrtc_regstate=0,common.CallWsuserKeepAlive(!1),setTimeout(function(){if(!common.isNull(global.sipaccounts)&&global.sipaccounts.length>1)for(var e=0;e<global.sipaccounts.length;e++)if("true"!==global.sipaccounts[e].ismain.toString()){var t=global.sipaccounts[e].serveraddress+","+global.sipaccounts[e].username+","+global.sipaccounts[e].password+","+global.sipaccounts[e].ival;RegisterEx(t)}},2500),0!=oSipStack.start()?(common.PutToDebugLog(2,"ERROR, webrtcapi: Start, Failed to start the SIP stack"),!1):(setTimeout(function(){global.phonestarted<2&&(global.phonestarted=2)},500),!0)}catch(err){common.PutToDebugLogException(2,"webrtcapi: StartInner",err)}return!1}function GetUDPServerAddress(){try{var e="";if((common.isNull(e)||e.length<3)&&(e=common.GetConfig("serverdomain")),(common.isNull(e)||e.length<3)&&(e=common.GetConfig("serveraddress")),(common.isNull(e)||e.length<3)&&(e=common.GetConfig("server")),(common.isNull(e)||e.length<3)&&(e=common.GetConfig("serverip")),!common.isNull(e)&&e.length>2&&e.indexOf(":")<1){var t=common.GetConfig("serverport");!common.isNull(t)&&t.length>0&&"5060"!==t&&(e=e+":"+t)}return(common.isNull(e)||e.length<3)&&(e=common.GetParameter("serveraddress_user")),(common.isNull(e)||e.length<3||e.indexOf(".")<1)&&(e=common.GetParameter("upperserver")),(common.isNull(e)||e.length<3)&&(e=common.GetFp()),e=e.toLowerCase(),e=e.replace("udp://",""),e=e.replace("tcp://",""),e=e.replace("http://",""),e=e.replace("https://","")}catch(o){common.PutToDebugLogException(2,"webrtcapi: GetUDPServerAddress",o)}return""}function SipUnRegister(){try{if(oSipSessionRegister)return oSipSessionRegister.unregister(),setTimeout(function(){common.PutToDebugLog(1,"STATUS,-1,Unregistered")},100),!0}catch(e){common.PutToDebugLogException(2,"webrtcapi: SipUnRegister",e)}return!1}function SipStop(){try{if(!0===webphone_api.isregistered()&&SipUnRegister(),oSipStack)return oSipStack.stop(),common.PutToDebugLog(2,"EVENT,SipStack Stopped"),setTimeout(function(){try{"undefined"!=typeof webphone_api.webrtc_socket&&null!==webphone_api.webrtc_socket&&(webphone_api.webrtc_socket.close(),webphone_api.webrtc_socket=null,common.PutToDebugLog(2,"EVENT,SipStack Destroyed")),common.PutToDebugLog(2,"webrtcapi: SipStop websocket closed")}catch(e){common.PutToDebugLogException(2,"webrtcapi: SipStop inner",e)}},500),!0}catch(e){common.PutToDebugLogException(2,"webrtcapi: SipStop",e)}return!1}function HandleOconfigCall(e,t){try{var o=e;return!0===webphone_api.isincall()&&common.isNull(document.getElementById("audio_remote_"+t))&&j$(document.body).append('<audio id="audio_remote_'+t+'" autoplay="autoplay" ></audio>'),common.isNull(document.getElementById("audio_remote_"+t))?oConfigCall.audio_remote=audioRemote:oConfigCall.audio_remote=document.getElementById("audio_remote_"+t),o}catch(n){common.PutToDebugLogException(2,"webrtcapi: HandleOconfigCall",n)}return e}function RemoveUnusedAudioElements(){try{for(var e=1;e<15;e++)j$("#audio_remote_"+e).remove()}catch(t){
common.PutToDebugLogException(2,"webrtcapi: RemoveUnusedAudioElements",t)}}function SipCall(e,t,o){try{if(!oSipStack&&!1===sipstackstarted)return common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall sipstack not started"),common.PutToDebugLog(1,"ERROR, Reconnecting, try to call again"),common.PutToDebugLog(1,"EVENT, POPUP, Reconnecting, try to call again"),ReStart(1500),sipstackstarted=!0,setTimeout(function(){SipCall(e,t,o)},2500),!1;if(tsk_string_is_null_or_empty(o))return common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipCall number is NULL"),!1;oConfigCall.bandwidth=undefined,oConfigCall.video_size=undefined;var n=common.GetVideoBandwidth(),i=common.GetAudioBandwidth();if(oConfigCall.bandwidth={audio:i,video:n},"call-audiovideo"===e||"call-screenshare"===e){var r=document.getElementById("video_container");common.isNull(r)&&(common.PutToDebugLog(2,"ERROR, VideoCall cannot find video container"),(!0===global.usestorage||common.Strl(60))&&common.ShowToast('ERROR, For the video to work, you must add a DIV html element to your page with id="video_container"',1e4)),common.PutToDebugLog(2,"EVENT, webrtcapi: video bandwidth: "+n),"call-audiovideo"===e&&(oConfigCall.video_size=GetVideoSizeObj()),common.PutToDebugLog(1,"STATUS,-1,Starting video call to "+o)}else common.PutToDebugLog(2,"EVENT, webrtcapi: audio bandwidth: "+i),common.PutToDebugLog(1,"STATUS,-1,Starting call to "+o);SetSipHeader(1),!1===global.wsuser_succeded?(common.CallWsuserKeepAlive(!0),common.PutToDebugLog(3,"WARNING, wsuser NOT YET succeeded")):(common.CallWsuserKeepAlive(!1),common.PutToDebugLog(3,"EVENT, wsuser already succeeded"));try{var a=common.GetEndpoint(t,"","",!1);if(!common.isNull(a)&&a.length>2&&"false"===a[common.EP_FLAGDEL]){var s=common.StrToInt(t)+1;common.PutToDebugLog(2,"WARNING, webrtc: call to: "+o+" line set to: "+s.toString()+" because we already have a call on line: "+t.toString()),t=s}}catch(u){common.PutToDebugLogException(2,"webrtcapi: detect multiple call on same line",u)}calltype=e,callline=t,destnumber=o,oSipSessionCall=oSipStack.newSession(e,HandleOconfigCall(oConfigCall,t)),sipstackstarted=!1;var l=common.GetTickCount();if(0!=oSipSessionCall.call(o,HandleOconfigCall(oConfigCall,t)))return oSipSessionCall=null,common.PutToDebugLog(2,"WRTC, ERROR, Failed to make call"),global.stacknotstarted_time>0&&l-global.stacknotstarted_time<300&&!0===global.stacknotstarted_retry&&(global.stacknotstarted_retry=!1,setTimeout(function(){common.PutToDebugLog(2,"WRTC, WARNING, Retry failed webrtc call (Stack not started)"),SipCall(e,t,o)},2500)),!1;global.checkIfInCall=!0,common.PutToDebugLog(1,"STATUS,-1,Call"),common.SaveCallSession(t,oSipSessionCall,o,"1",common.GetTickCount(),-1,-1,"",oSipSessionCall.getId(),"","",oConfigCall.sip_headers),setTimeout(function(){if(!1===common.Awb()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("w"),e.push("e"),e.push("b"),e.push("s"),e.push("r"),e.push("v"),e.push("8");var n=e.join("");common.PutToDebugLog(2,"EVENT, "+n),common.GetCallSession(!0,t,o).hangup({events_listener:{events:"*",listener:onSipEventSession}}),setTimeout(function(){common.GetEndpoint(t,"","",!0)},400)}},15e3),setTimeout(function(){if(!1===common.Loa()){var e=[];e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("c"),e.push("a"),e.push("l"),e.push("l"),e.push(" "),e.push("o"),e.push("n"),e.push("l"),e.push("y"),e.push(" "),e.push("a"),e.push("n"),e.push("d"),e.push("r"),e.push("o"),e.push("i"),e.push("d");var n=e.join("");setTimeout(function(){common.PutToDebugLog(2,"ERROR, "+n)},1200),setTimeout(function(){common.GetCallSession(!0,t,o).hangup({events_listener:{events:"*",listener:onSipEventSession}})},1300),setTimeout(function(){common.GetEndpoint(t,"","",!0)},1700)}},6e3);var c=common_public.GetIceTimeout()+4500;return!common.isNull(e)&&e.indexOf("video")>0&&(c+=4e3),1===common.GetParameterInt("redialonfail",0)&&(red_line=t,red_sessioncall=oSipSessionCall,red_number=o,red_setuptime=common.GetTickCount(),red_callid=oSipSessionCall.getId(),red_headers=oConfigCall.sip_headers,red_delaytime=c,red_s_type=e,global.redialof=!0),!0}catch(m){common.PutToDebugLogException(2,"webrtcapi: SipCall",m)}return!1}function RedialOnFail(){try{if(!1===global.redialof)return;redialonfailtimer=setTimeout(function(){try{if(!0===global.redialof){var e=!1;if("Firefox"===common.GetBrowser()){common.GetParameterInt("webrtc_successfulcalls",0)<3&&(e=!0)}!1===global.webrtcpermissionaccepted?(common.PutToDebugLog(2,"ERROR, initiate outgoing call, but permission not yet accepted"),common.ShowToast(stringres.get("request_permission"),12e3)):(common.PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: "+red_number+"; delay after first attempt: "+red_delaytime.toString()),global.redialof=!1,global.redialhideevt=!0,common.isNull(red_sessioncall)?(common.PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: create new session"),red_sessioncall=oSipStack.newSession(red_s_type,oConfigCall)):(common.PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: hangup previous call"),!0===e?webphone_api.hangup():red_sessioncall.hangup()),setTimeout(function(){common.PutToDebugLog(2,"EVENT, webrtcapi, RedialOnFail: initiate call again (redial)"),!0===e?webphone_api.call(red_number):red_sessioncall.call(red_number),common.SaveCallSession(red_line,red_sessioncall,red_number,"1",red_setuptime,-1,-1,"",red_callid,"","",red_headers)},1e3))}}catch(t){common.PutToDebugLogException(2,"webrtcapi: RedialOnFail",t)}},red_delaytime),setTimeout(function(){global.redialhideevt=!1,common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),redialonfailtimer=null,red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=5e3,red_s_type="call-audio"},red_delaytime+2e3)}catch(e){common.PutToDebugLogException(2,"webrtcapi: RedialOnFail",e)}}function SipHangup(e,t){var o=0;try{global.redialof=!1,global.redialhideevt=!1,o=1,common.isNull(redialonfailtimer)||clearTimeout(redialonfailtimer),o=2,redialonfailtimer=null,o=3;var n=common.GetCallSession(!0,t,"");if(o=4,setTimeout(function(){common.GetEndpoint(t,"","",!0)},400),o=5,n){try{o=6,common.PutToDebugLog(1,"STATUS,"+t+",Hangup"),o=7,e&&(o=8,common.PutToDebugLog(1,"EVENT,Rejected")),o=9,t>0&&common.GetNrOfActiveCalls()>1&&(o=20,webphone_api.dont_remove_remote_stream=!0,o=21,common.PutToDebugLog(2,"WARNING, on hangup dont_remove_remote_stream set to true"),o=22,setTimeout(function(){webphone_api.dont_remove_remote_stream=!1,common.PutToDebugLog(2,"WARNING, after hangup reset dont_remove_remote_stream")},300)),o=23}catch(i){common.PutToDebugLogException(2,"webrtcapi: SipHangup inner ("+o.toString()+")",i)}return o=24,n.hangup({events_listener:{events:"*",listener:onSipEventSession}}),o=25,!0}}catch(i){common.PutToDebugLogException(2,"webrtcapi: SipHangup ("+o.toString()+")",i)}return!1}function SipAccept(e,t){try{var o=common.GetCallSession(!1,e,"");if(o){var n=common.GetEndpoint(e,"","",!1);if(!common.isNull(n)&&n.length>5){var i=n[common.EP_CONNECTTIME];if(common.isNull(i)&&(i=-1),(i=common.StrToIntDef(i,-1))>0)for(var r=0;r<global.ep.length;r++){var a=global.ep[r];if(!common.isNull(a)){var s=a[common.EP_INCOMING];common.isNull(s)&&(s=1);var l=a[common.EP_SETUPTIME];common.isNull(l)&&(l=-1);var c=a[common.EP_CONNECTTIME];if(common.isNull(c)&&(c=-1),2===common.StrToIntDef(s,1)&&common.StrToIntDef(l,-1)>0&&common.StrToIntDef(c,1)<0&&!common.isNull(common.GetCallSession(!1,common.StrToInt(a[common.EP_LINE]),""))){common.PutToDebugLog(2,"EVENT, API_Accept: call is already connected on line: "+e+"; incoming call found to be accepted on line: "+a[common.EP_LINE]),e=common.StrToInt(a[common.EP_LINE]),o=common.GetCallSession(!1,e,"");break}}}}try{var u=common.GetTickCount()-global.ringstart_time;1===recheckmediaonconnect&&u>14e3?!0!==common.IsMizuServer()&&!0!==common.IsMizuWebRTCEmbeddedServer()&&!0!==common.IsMizuWebRTCGateway()||(common.PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_1: "+u),tmedia_session_jsep01.prototype.__get_lo.call(savethis,!0)):2===recheckmediaonconnect&&u>14e3?(common.PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_2: "+u),tmedia_session_jsep01.prototype.__get_lo.call(savethis,!0)):3===recheckmediaonconnect&&(common.PutToDebugLog(2,"EVENT, webrtcapi SipAccept recheckmediaonconnect_3"),tmedia_session_jsep01.prototype.__get_lo.call(savethis,!0))}catch(g){common.PutToDebugLogException(2,"webrtcapi: SipAccept longring",g)}if(common_public.ice_callaccepted=!0,SetSipHeader(1),o.accept(HandleOconfigCall(oConfigCall,e)),common.PutToDebugLog(1,"EVENT,Accepted"),!1!==t){var m=common.GetParameterInt("beeponconnect",0);1!==m&&2!==m&&4!==m||common.Beep("1")}return!0}common.PutToDebugLog(2,"ERROR,webrtcapi session is NULL"),common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress2"))}catch(d){common.PutToDebugLogException(2,"webrtcapi: SipAccept",d)}return!1}function SipIgnore(){try{stopRingTone()}catch(e){common.PutToDebugLogException(2,"webrtcapi: SipIgnore",e)}return!1}function SipSendChat(e,t,o,n){try{if(!oSipStack)return common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat sipstack not started"),!1;if(common.isNull(t)||t.length<1)return common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat number is NULL"),!1;if(common.isNull(o)||o.length<1)return common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi: SipSendChat message is NULL"),!1;var i=sipheaders,r=sipheaders;return r[r.length]={},r[r.length-1].name="P-Sms",r[r.length-1].value="Yes",i=RemoveDuplicateHeader(i),r=RemoveDuplicateHeader(r),!0===n?(oSipSessionMessage=oSipStack.newSession("message",oConfigSms),oSipSessionMessage.setConfiguration({sip_headers:r})):(oSipSessionMessage=oSipStack.newSession("message",oConfigMessage),oSipSessionMessage.setConfiguration({sip_headers:i})),0==oSipSessionMessage.send(t,o,"text/plain;charset=utf-8")||(oSipSessionMessage=null,common.PutToDebugLog(2,"WRTC, ERROR, Failed to send message chat"),!1)}catch(a){common.PutToDebugLogException(2,"webrtcapi: SipSendChat",a),oSipSessionMessage=null}return!1}function sipShareScreen(){if("w4a"===SIPml.getWebRtcType()){if(!oSipSessionCall)return void(txtCallStatus.innerHTML="<i>No active session</i>");oSipSessionCall.bfcpSharing?(SetSipHeader(2),0!=oSipSessionCall.stopBfcpShare(oConfigCall)?txtCallStatus.value="Failed to stop BFCP share":oSipSessionCall.bfcpSharing=!1):(SetSipHeader(2),oConfigCall.screencast_window_id=0,0!=oSipSessionCall.startBfcpShare(oConfigCall)?txtCallStatus.value="Failed to start BFCP share":oSipSessionCall.bfcpSharing=!0)}else sipCall("call-screenshare")}function Forward(e){try{if(common.isNull(e)||e.length<1)return common.PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid number: "+e),!1;if(0===common.GetParameterInt("allowcallredirect",1))return common.PutToDebugLog(2,"EVENT, webrtcapi Forward dropped, because allowcallredirect is 0 (disabled)"),!1;var t=common.GetRecentInviteIn();if(common.isNull(t)||t.toString().length<10)return common.PutToDebugLog(2,"ERROR, webrtcapi Forward, invalid INVITE msg: "+t),!1;common.GetParameterInt("fwd_msg_displayed",0)<1&&(common.SaveParameter("fwd_msg_displayed","1"),common.ShowToast(stringres.get("call_forward_warn")));var o="<sip:"+common.Trim(e)+"@"+GetUDPServerAddress()+">",n="SIP/2.0 302 Moved Temporarily\r\n";return n=n+"Via: "+common.GetSipHeaderFromMsg(t,"via")+"\r\n",n=n+"From: "+common.GetSipHeaderFromMsg(t,"from")+"\r\n",n=n+"To: "+common.GetSipHeaderFromMsg(t,"to")+";totag=227A1\r\n",n=n+"Call-ID: "+common.GetSipHeaderFromMsg(t,"call-id")+"\r\n",n=n+"CSeq: "+common.GetSipHeaderFromMsg(t,"cseq")+"\r\n",n=n+"Contact: "+o+"\r\n",n+="Content-Length: 0 \r\n",n+="\r\n",common.PutToDebugLog(3,"EVENT, send Forward SIP message:\r\n"+n),webphone_api.webrtc_socket.send(n),common.PutToDebugLog(2,"EVENT, Hangup because call Forward: "+e),SipHangup(!0,global.aline),!0}catch(i){common.PutToDebugLogException(2,"webrtcapi: Forward",i)}return!1}function SipTransfer(e){try{var t=common.GetCallSession(!1,global.aline,e);if(!t)return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress")),!1;if(!tsk_string_is_null_or_empty(e)){var o=common.GetParameterInt("transfertype",-1);if(0!=t.transfer(e))return common.PutToDebugLog(1,"ERROR,Transfer failed."),!1;common.PutToDebugLog(2,"WRTC, EVENT, SipTransfer ("+o+"): "+e)}}catch(n){common.PutToDebugLogException(2,"webrtcapi: SipTransfer",n)}return!1}function SipToggleHoldResume(e,t){try{common.isNull(t)&&(t=global.aline);var o=common.GetCallSession(!1,t,"");if(o){"Firefox"===common.GetBrowser()&&global.firefoxholdcount++,e?common.PutToDebugLog(1,"EVENT,Hold"):common.PutToDebugLog(1,"EVENT,Reload");var n=-1;return global.isholdresume=!0,global.holdresumecount++,!0===e?n=o.hold():(global.isresume=!0,n=o.resume()),0!=n?(common.PutToDebugLog(1,"ERROR,Hold / Resume failed."),!1):(!0!==e&&(common.isNull(lastmuste_mute)||!1!==lastmuste_mute||(common.PutToDebugLog(5,"webrtcapi: SipToggleHoldResume also unmute call, because user unmuted when was on hold"),SipToggleMute(lastmuste_mute,lastmuste_direction,lastmuste_line,lastmuste_log),lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null)),!0)}return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress")),!1}catch(i){common.PutToDebugLogException(2,"webrtcapi: SipToggleHoldResume",i)}return!1}function SipMuteVideo(e,t){try{var o=!1,n=common.GetCallSession(!1,global.aline,"");if(!n)return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress")),!1;var i=!e;if((common.isNull(t)||!1===common.IsNumber(t))&&(t=0),t=common.StrToInt(t),(t<0||t>2)&&(t=0),0===t||1===t)if(null!=n.o_session)if(null!=n.o_session.o_stream_remote)if(n.o_session.o_stream_remote.getVideoTracks().length>0){for(var r=0;r<n.o_session.o_stream_remote.getVideoTracks().length;r++)common.PutToDebugLog(2,"EVENT, webrtcapi MuteVideo REMOTE Setting Video Tracks ["+r+"] to state = "+i.toString()),n.o_session.o_stream_remote.getVideoTracks()[r].enabled=i;n.o_session.o_stream_remote.getVideoTracks().length>0&&(o=!0)}else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote-> NO VIDEO TRACKS");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote is NULL");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session is NULL");if(0===t||2===t)if(null!=n.o_session)if(null!=n.o_session.o_stream_local)if(n.o_session.o_stream_local.getVideoTracks().length>0){for(var r=0;r<n.o_session.o_stream_local.getVideoTracks().length;r++)common.PutToDebugLog(2,"EVENT, webrtcapi MuteVideo LOCAL Setting Video Tracks ["+r+"] to state = "+i.toString()),n.o_session.o_stream_local.getVideoTracks()[r].enabled=i;n.o_session.o_stream_local.getVideoTracks().length>0&&(o=!0)}else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local-> NO VIDEO TRACKS");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local is NULL");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session is NULL");return o}catch(a){common.PutToDebugLogException(2,"webrtcapi: SipMuteVideo",a)}return!1}function MuteMic(e,t){try{if(t=!t,null!=e.o_session)if(null!=e.o_session.o_stream_local)if(e.o_session.o_stream_local.getAudioTracks().length>0){for(var o=0;o<e.o_session.o_stream_local.getAudioTracks().length;o++)common.PutToDebugLog(2,"EVENT, webrtcapi MuteMic Setting Audio Tracks ["+o+"] to state = "+t.toString()),e.o_session.o_stream_local.getAudioTracks()[o].enabled=t;if(e.o_session.o_stream_local.getAudioTracks().length>0)return!0}else common.PutToDebugLog(2,"ERROR, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local-> NO AUDIO TRACKS");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local is NULL");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteMic oSipSessionCall.o_session is NULL")}catch(n){common.PutToDebugLogException(2,"webrtcapi: MuteMic",n)}return!1}function MuteSpeaker(e,t){try{if(t=!t,null!=e.o_session)if(null!=e.o_session.o_stream_remote)if(e.o_session.o_stream_remote.getAudioTracks().length>0){for(var o=0;o<e.o_session.o_stream_remote.getAudioTracks().length;o++)common.PutToDebugLog(2,"EVENT, webrtcapi MuteSpeaker Setting Audio Tracks ["+o+"] to state = "+t.toString()),e.o_session.o_stream_remote.getAudioTracks()[o].enabled=t;if(e.o_session.o_stream_remote.getAudioTracks().length>0)return!0}else common.PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote-> NO AUDIO TRACKS");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote is NULL");else common.PutToDebugLog(2,"ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session is NULL")}catch(n){common.PutToDebugLogException(2,"webrtcapi: MuteSpeaker",n)}return!1}function SipToggleMute(e,t,o,n){try{common.isNull(o)&&(o=global.aline);var i=common.GetCallSession(!1,o,"");if(!i)return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress")),!1;if(lastmuste_mute=e,lastmuste_direction=t,lastmuste_line=o,lastmuste_log=n,(common.isNull(t)||"0"!=t&&"1"!=t&&"2"!=t)&&(t="2"),"2"==t){var r=MuteMic(i,e);return!1!==r||(!1!==n&&!1===webphone_api.isonhold()&&common.PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("1"==t){var r=MuteSpeaker(i,e);return!1!==r||(!1!==n&&!1===webphone_api.isonhold()&&common.PutToDebugLog(1,"ERROR,Mute / Unmute failed."),!1)}if("0"==t){var r=MuteMic(i,e),a=MuteSpeaker(i,e);return!1!==r&&!1!==a||(!1!==n&&!1===webphone_api.isonhold()&&(common.PutToDebugLog(1,"ERROR,Mute / Unmute failed."),common.PutToDebugLog(2,"ERROR,Mute / Unmute failed state: "+e+"; ret: "+r+"; ret2: "+a)),!1)}return common.PutToDebugLog(1,"ERROR,Mute / Unmute failed."),common.PutToDebugLog(2,"ERROR,Mute / Unmute invalid direction: "+t),!1}catch(s){common.PutToDebugLogException(2,"webrtcapi: SipToggleMute",s)}return!1}function SipSendDTMF(e){try{var t=common.GetCallSession(!1,global.aline,"");if(common.isNull(e)||e.length<1)return;if(e=e.toString(),1===e.length)Dtmf(e,t);else{var o=e.substring(0,1);if(" "!==o&&Dtmf(o,t),e=e.substring(1),!common.isNull(e)&&e.length>0){var n=1;" "===e.substring(0,1)&&(n=1e3),setTimeout(function(){SipSendDTMF(e)},n)}}}catch(i){common.PutToDebugLogException(2,"webrtcapi: SipSendDTMF",i)}return!1}function Dtmf(e,t){try{return t&&e?0==t.dtmf(e)?(common.PutToDebugLog(3,"EVENT, DTMFsent: "+e),!0):(common.PutToDebugLog(2,"WRTC, ERROR, webrtcapi Dtmf failed."),!1):(common.PutToDebugLog(1,"ERROR,"+stringres.get("err_nocallinprogress")),!1)}catch(o){common.PutToDebugLogException(2,"webrtcapi: Dtmf",o)}}function PresenceSet(e){try{if(!1===isregistered)return void common.PutToDebugLog(2,"WARNING, webrtcapi cannot set presence, because not registered");if(common.isNull(mSipuri)||mSipuri.length<2)return void common.PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid sipuri: "+mSipuri);if(common.isNull(e)||e.length<2)return void common.PutToDebugLog(2,"ERROR, webrtcapi PresenceSet invalid status: "+e);common.isNull(mDisplayname)&&(mDisplayname=""),publishSession=oSipStack.newSession("publish",{events_listener:{events:"*",listener:onSipEventSession}});common.PutToDebugLog(2,"EVENT, PresenceSet: "+e+"; for: "+mSipuri+"; displayname: "+mDisplayname);var t='<?xml version="1.0" encoding="UTF-8"?>\n<presence xmlns="urn:ietf:params:xml:ns:pidf"\n xmlns:im="urn:ietf:params:xml:ns:pidf:im" entity="'+mSipuri+'">\n<tuple id="s8794">\n<status>\n   <basic>'+e+"</basic>\n   <im:im>"+e+'</im:im>\n</status>\n<contact priority="0.8">tel:'+mDisplayname+'</contact>\n<note  xml:lang="en"></note>\n</tuple>\n</presence>';sipheaders=RemoveDuplicateHeader(sipheaders),publishSession.publish(t,"application/pidf+xml",{sip_caps:[{name:"+g.oma.sip-im"},{name:"+sip.ice"}],sip_headers:sipheaders})}catch(o){common.PutToDebugLogException(2,"webrtcapi: PresenceSet",o)}}function PresenceGet(e){try{if(common.isNull(e)||e.length<1)return;if(!1===isregistered&&pgmaxloop<15)return pgmaxloop++,void setTimeout(function(){PresenceGet(e)},1e3);pgmaxloop=0;var t=sipheaders;common.isNull(t)&&(t=[]);for(var o=!1,n=!1,i=0;i<t.length;i++){var r=t[i];common.isNull(r)||common.isNull(r.name)||("event"===r.name.toLowerCase()&&(o=!0),"accept"===r.name.toLowerCase()&&(n=!0))}!1===o&&t.push({name:"Event",value:"presence"}),!1===n&&t.push({name:"Accept",value:"application/pidf+xml"}),t=RemoveDuplicateHeader(t),subscribeSession=oSipStack.newSession("subscribe",{events_listener:{events:"*",listener:onSipEventSession},sip_headers:t,sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]}),common.PutToDebugLog(2,"EVENT, PresenceGet for: "+e);var a=e.split(",");if(!common.isNull(a)&&a.length>0)for(var i=0;i<a.length&&!(i>maxnrofusers);i++)common.isNull(a[i])||a[i].length<1||subscribeSession.subscribe(a[i])}catch(s){common.PutToDebugLogException(2,"webrtcapi: PresenceGet",s)}}function startRingTone(){try{if(common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),common.isNull(ringtone))return void common.PutToDebugLog(2,"EVENT, webrtcapi: startRingTone is NULL");!0!==webphone_api.rt_loaded&&common.PutToDebugLog(2,"ERROR,webrtcapi: startRingTone cannot load media"),!0!==webphone_api.rt_canplay&&common.PutToDebugLog(2,"ERROR,webrtcapi: startRingTone cannot play through media"),ringtone.play?ringtone.play():common.PutToDebugLog(2,"WARNING, webrtcapi: startRingTone play function is not available: "+ringtone.play)}catch(e){common.PutToDebugLogException(2,"webrtcapi: startRingTone",e)}}function stopRingTone(){try{if(common.isNull(ringtone)&&(ringtone=document.getElementById("ringtone")),common.isNull(ringtone))return void common.PutToDebugLog(2,"EVENT, webrtcapi: stopRingTone is NULL");!0!==webphone_api.rt_loaded&&common.PutToDebugLog(2,"ERROR,webrtcapi: stopRingTone cannot load media"),ringtone.pause?ringtone.pause():common.PutToDebugLog(2,"WARNING, webrtcapi: stopRingTone pause function is not available: "+ringtone.pause)}catch(e){common.PutToDebugLogException(2,"webrtcapi: stopRingTone",e)}}function startRingbackTone(){try{if(common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),common.isNull(ringbacktone))return void common.PutToDebugLog(2,"EVENT, webrtcapi: startRingbackTone is NULL");!0!==webphone_api.rbt_loaded&&common.PutToDebugLog(2,"ERROR,webrtcapi: startRingbackTone cannot load media"),!0!==webphone_api.rbt_canplay&&common.PutToDebugLog(2,"ERROR,webrtcapi: startRingbackTone cannot play through media"),ringbacktone.play?ringbacktone.play():common.PutToDebugLog(2,"WARNING, webrtcapi: startRingbackTone play function is not available: "+ringbacktone.play)}catch(e){common.PutToDebugLogException(2,"webrtcapi: startRingbackTone",e)}}function stopRingbackTone(){try{if(common.isNull(ringbacktone)&&(ringbacktone=document.getElementById("ringbacktone")),common.isNull(ringbacktone))return void common.PutToDebugLog(2,"EVENT, webrtcapi: stopRingBackTone is NULL");!0!==webphone_api.rbt_loaded&&common.PutToDebugLog(2,"ERROR,webrtcapi: stopRingbackTone cannot load media"),ringbacktone.pause?ringbacktone.pause():common.PutToDebugLog(2,"WARNING, webrtcapi: stopRingbackTone pause function is not available: "+ringbacktone.pause)}catch(e){common.PutToDebugLogException(2,"webrtcapi: stopRingbackTone",e)}}function toggleFullScreen(){fullScreen(videoRemote.webkitSupportsFullscreen?!videoRemote.webkitDisplayingFullscreen:!0)}function fullScreen(e){function t(){try{document.exitFullscreen&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&document.exitFullscreen()}catch(e){common.PutToDebugLogException(2,"webrtcapi: ExitFullScreen",e)}}if(bFullScreen=e,void 0!==videoRemote&&null!==videoRemote)if(tsk_utils_have_webrtc4native()&&bFullScreen&&videoRemote.webkitSupportsFullscreen){if(common.isNull(videoRemote))return!1;bFullScreen?videoRemote.webkitEnterFullScreen():videoRemote.webkitExitFullscreen()}else videoRemote.requestFullscreen?bFullScreen?videoRemote.requestFullscreen():t():videoRemote.mozRequestFullScreen?bFullScreen?videoRemote.mozRequestFullScreen():t():videoRemote.webkitRequestFullscreen&&(bFullScreen?videoRemote.webkitRequestFullscreen():t());else if(tsk_utils_have_webrtc4npapi())try{window.__o_display_remote&&window.__o_display_remote.setFullScreen(e)}catch(o){common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}else common.isNull(divVideo)||divVideo.setAttribute("class",e?"full-screen":"normal-screen")}function showNotifICall(e){window.webkitNotifications&&0==window.webkitNotifications.checkPermission()&&(oNotifICall&&oNotifICall.cancel(),oNotifICall=window.webkitNotifications.createNotification(common.GetElementSource()+"images/sipml-34x39.png","Incaming call","Incoming call from "+e),oNotifICall.onclose=function(){oNotifICall=null},oNotifICall.show())}function onKeyUp(e){e=e||window.event,27==e.keyCode?fullScreen(!1):e.ctrlKey&&e.shiftKey&&(65!=e.keyCode&&86!=e.keyCode||(bDisableVideo=65==e.keyCode,txtCallStatus.innerHTML="<i>Video "+(bDisableVideo?"disabled":"enabled")+"</i>",window.localStorage.setItem("org.doubango.expert.disable_video",bDisableVideo)))}function onDivCallCtrlMouseMove(e){try{tsk_utils_have_stream()&&(btnCall.disabled=!tsk_utils_have_stream()||!oSipSessionRegister||!oSipSessionRegister.is_connected(),document.getElementById("divCallCtrl").onmousemove=null)}catch(t){}}function uiOnConnectionEvent(e,t){}function uiVideoDisplayEvent(e,t){if(!1===common.CanIUseVideo())return void common.PutToDebugLog(5,"EVENT, uiDisplayEvent ret");if(common.isNull(videoRemote))return void common.PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayEvent videoRemote is NULL");var o=e?videoLocal:videoRemote;t?(o.style.opacity=1,uiVideoDisplayShowHide(!0)):(o.style.opacity=0,fullScreen(!1))}function uiVideoDisplayShowHide(e){common.isNull(divVideo)||(e?(divVideo.style.height="Microsoft Internet Explorer"==navigator.appName?"100%":"340px",j$("#contact_details").hide(),j$("#video_container").show(),1===common.GetParameterInt("softphonevideomode",0)&&j$("#div_video_fullscreen_button").hide(),common.PutToDebugLog(2,"EVENT, webrtcapi uiVideoDisplayShowHide video container displayed")):(divVideo.style.height="0px",j$("#contact_details").show(),j$("#video_container").hide()))}function uiBtnCallSetText(e){switch(e){case"Call":var t=window.localStorage&&"true"==window.localStorage.getItem("org.doubango.expert.disable_callbtn_options");btnCall.value=btnCall.innerHTML=t?"Call":'Call <span id="spanCaret" class="caret">',btnCall.setAttribute("class",t?"btn btn-primary":"btn btn-primary dropdown-toggle"),btnCall.onclick=t?function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")}:null,ulCallOptions.style.visibility=t?"hidden":"visible",t||ulCallOptions.parentNode==divBtnCallGroup?t&&ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions):divBtnCallGroup.appendChild(ulCallOptions);break;default:btnCall.value=btnCall.innerHTML=e,btnCall.setAttribute("class","btn btn-primary"),btnCall.onclick=function(){sipCall(bDisableVideo?"call-audio":"call-audiovideo")},ulCallOptions.style.visibility="hidden",ulCallOptions.parentNode==divBtnCallGroup&&document.body.appendChild(ulCallOptions)}}function uiCallTerminated(e,t){common_public.restartice_time=0,oSipSessionCall=null,stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null),uiVideoDisplayEvent(!1,!1),uiVideoDisplayEvent(!0,!1);var o=global.aline;void 0!==t&&null!==t&&common.IsNumber(t)&&common.StrToIntDef(t,-5)>0&&(o=t),common.PutToDebugLog(1,"STATUS,"+o.toString()+","+e),"Call Finished"===e&&common.PutToDebugLog(1,"STATUS,"+o.toString()+",Finished")}function GetRegisterivalWebRTC(){try{var e=common.GetParameter2("registerinterval");return(common.isNull(e)||e.length<1||!common.IsNumber(e))&&(e=0),e<5&&(e=common.GetConfigInt("registerinterval",0)),e<5&&(e=200),global.recwsload>1&&e<400&&(e=600),e}catch(t){common.PutToDebugLogException(2,"webrtcapi: GetRegisterivalWebRTC",t)}return 200}function RegisterEx(accounts){function onSEventStack(e){function t(t){common.PutToDebugLog(5,"EVENT, ExSessionEvent_"+username+": "+e.type+", "+e.description)}try{if(common.PutToDebugLog(5,"EVENT, ExStackEvent_"+username+": "+e.type+", "+e.description),"started"===e.type&&!0===common.NeedRegister()){var o=200;!common.isNull(aival)&&common.IsNumber(aival)&&(o=aival);this.newSession("register",{expires:o,events_listener:{events:"*",listener:t},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]}).register()}}catch(n){common.PutToDebugLogException(2,"webrtcapi: ExEventStack_"+username,n)}}try{if(common.isNull(accounts)||accounts.length<5)return;for(var accarr=accounts.split("#"),i=0;i<accarr.length;i++)if(!(common.isNull(accarr[i])||accarr[i].length<5)){var oneacc=accarr[i].split(",");if(!(common.isNull(oneacc)||oneacc.length<4)){common.PutToDebugLog(2,"EVENT, RegisterEx: "+accarr[i]);var asrv=oneacc[0],ausr=oneacc[1],apwd=oneacc[2],aival=oneacc[3];if(common.isNull(ausr)||ausr.length<1||common.isNull(apwd)||apwd.length<1||common.isNull(aival)||aival.length<1)common.PutToDebugLog(2,"ERROR, RegisterEx invalid account");else{var username=ausr,password=apwd,callerid=ausr,udpaddr=asrv;(common.isNull(udpaddr)||udpaddr.length<1)&&(udpaddr=GetUDPServerAddress());var wsaddr=common.GetWebrtcSrvAddr(),displayname="";if(2===common.GetConfigInt("usemizuwebrtcgateway",1)&&(wsaddr=""),common.isNull(wsaddr)||wsaddr.length<2){wsaddr=common.GetWp();var wstmp=wsaddr;wstmp.indexOf("//")>=0&&(wstmp=wstmp.substring(wstmp.indexOf("//")+2,wstmp.length)),wstmp.indexOf(":")>0&&(wstmp=wstmp.substring(0,wstmp.indexOf(":")))}else wsaddr=common.Trim(wsaddr.toLowerCase());wsaddr=wsaddr.replace("*",""),wsaddr=wsaddr.toLowerCase(),wsaddr=wsaddr.replace("udp://",""),wsaddr=wsaddr.replace("tcp://",""),wsaddr=wsaddr.replace("http://",""),wsaddr=wsaddr.replace("https://","");var sipaddress=udpaddr;sipaddress.indexOf("udp:")<0&&(sipaddress="udp://"+sipaddress);var proxyaddress=sipaddress,wsaddress=wsaddr;wsaddress.indexOf("ws:")<0&&wsaddress.indexOf("wss:")<0&&(wsaddress="ws://"+wsaddress);var hostmp=location.host.toLowerCase();!1!==common.IsIPAddrress(wsaddress)&&!0!==common.BrowserRequiresHttps(!0)||(wsaddress=wsaddress.replace("ws:","wss:"));var publicsipaddress=common.GetConfig("publicsipaddress");common.isNull(publicsipaddress)&&(publicsipaddress="");var realm=udpaddr;realm=common.NormalizeInput(realm,0),realm.indexOf(":")>0&&(realm=realm.substring(0,realm.indexOf(":"))),realm=common.Trim(realm);var sipuri=username;sipuri.indexOf("sip:")<0&&(sipuri="sip:"+username),sipuri.indexOf("@")<0&&(sipuri=sipuri+"@"+realm);var enableRTCWebBreaker=!0;enableRTCWebBreaker=!(!common.isNull(webphone_api.parameters.rtcbreaker)&&0===webphone_api.parameters.rtcbreaker)&&(!common.isNull(webphone_api.parameters.rtcbreaker)&&1===webphone_api.parameters.rtcbreaker||!1===common.IsMizuWebRTCGateway()&&!1===common.IsMizuWebRTCEmbeddedServer());var organization=common.GetConfig("companyname");(common.isNull(organization)||organization.length<1)&&(organization=common.GetConfig("brandname"),(common.isNull(organization)||organization.length<1)&&(organization="Mizutech"));var ua=common.GetUA();common.GetParameter("useragent").length>0&&!1===common.IsMizuWebRTCGateway()&&(ua=common.GetParameter("useragent"));var sheaders=[{name:"User-Agent",value:ua},{name:"Organization",value:organization},{name:"X-Webdomain",value:common.GetWebdomain()}],xhval="1";!0===common_public.Hasesw()?xhval="2":!0===common_public.Us()&&(xhval="0"),sipheaders[sipheaders.length]={},sipheaders[sipheaders.length-1].name="X-LS",sipheaders[sipheaders.length-1].value=xhval
;var company=common.GetParameter("companyname");!common.isNull(company)&&company.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Company",sheaders[sheaders.length-1].value=company);var brand=common.GetParameter("brandname");!common.isNull(brand)&&brand.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Brand",sheaders[sheaders.length-1].value=brand);var uppsrv=common.GetWebrtcSyUpperHeader("RegisterEx");uppsrv.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrv",sheaders[sheaders.length-1].value=uppsrv);var uppsrvd=common.GetWebrtcSyUpperDomainHeader("RegisterEx");uppsrvd.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-Sy.Uppersrvd",sheaders[sheaders.length-1].value=uppsrvd);var xp2p=common.GetConfig("p2p");!common.isNull(xp2p)&&xp2p.length>0&&(sheaders[sheaders.length]={},sheaders[sheaders.length-1].name="X-P2P",sheaders[sheaders.length-1].value=xp2p),sheaders=RemoveDuplicateHeader(sheaders),(common.isNull(username)||username.length<1)&&common.PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid username: "+username),(common.isNull(password)||password.length<1)&&common.PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid password: "+password),(common.isNull(sipuri)||sipuri.length<2||sipuri.indexOf("@")<1||sipuri.indexOf(".")<1)&&common.PutToDebugLog(2,"ERROR, WebRTC RegisterEx invalid sipuri: "+sipuri);var stun_turn=[],stun=common.GetStunServersStr(),turn=common.GetTurnSrv();if(!common.isNull(stun)&&stun.length>2){var sarr=stun.split(","),useurls=!1;if(("Chrome"===common.GetBrowser()&&common.GetBrowserVersion()>40||"Firefox"===common.GetBrowser()&&common.GetBrowserVersion()>40)&&(useurls=!0),!common.isNull(sarr))for(var i=0;i<sarr.length;i++)if(!(common.isNull(sarr[i])||sarr[i].length<1))if(!0===useurls){var obj={urls:sarr[i]};stun_turn.push(obj)}else{var obj={url:sarr[i]};stun_turn.push(obj)}}if(common.isNull(turn)||common.IsLocalServer()||stun_turn.push(turn),common.PutToDebugLog(3,"Webrtc RegisterEx connection details:"),common.PutToDebugLog(3,"RegisterEx username: "+username),(common.GetLogLevel()>1||!0===global.isdebugversion)&&common.PutToDebugLog(3,"RegisterEx password: "+password),common.PutToDebugLog(3,"RegisterEx sipuri: "+sipuri),common.PutToDebugLog(3,"RegisterEx displayname: "),common.PutToDebugLog(3,"RegisterEx wsaddress: "+wsaddress),common.PutToDebugLog(3,"RegisterEx proxyaddress: "+proxyaddress),common.PutToDebugLog(3,"RegisterEx realm: "+realm),(common.isNull(global.usuk)||global.usuk.length<1)&&(common.IsUKGateway(wsaddress)?(common.PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"),global.usuk="uk"):common.IsUSGateway(wsaddress)&&(common.PutToDebugLog(2,"WARNING, RegisterEx webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"),global.usuk="us")),!common.isNull(stun_turn)&&stun_turn.length>0){for(var i=0;i<stun_turn.length;i++)if(!common.isNull(stun_turn[i])){var sobj=stun_turn[i];for(var key in sobj){var msgtmp="RegisterEx turn server";!common.isNull(sobj[key])&&sobj[key].toString().indexOf("stun")>=0&&(msgtmp="RegisterEx stun server"),common.PutToDebugLog(3,msgtmp+"["+i+"]: "+key+": "+sobj[key])}}}else common.PutToDebugLog(3,"RegisterEx stun server: NOT set");var iceobj=null,icestr=common.GetParameter("ice");if(!common.isNull(icestr)&&icestr.length>0)try{iceobj=eval(icestr)}catch(eice){iceobj=null,common.PutToDebugLogException(2,"ERROR, RegisterEx webrtcapi parse ICE servers",eice)}if(!common.isNull(iceobj)){try{common.PutToDebugLog(2,"EVENT, RegisterEx webrtcapi found ICE (STUN/TURN) server: "+JSON.stringify(iceobj))}catch(eice2){}stun_turn=iceobj}var earlymediaint=common.GetParameterInt("earlymedia",2),earlymedia=!0;earlymediaint<1&&(earlymedia=!1);var sStack=new SIPml.Stack({realm:realm,impi:username,impu:sipuri,password:password,display_name:"",websocket_proxy_url:wsaddress,outbound_proxy_url:proxyaddress,ice_servers:stun_turn,enable_rtcweb_breaker:enableRTCWebBreaker,events_listener:{events:"*",listener:onSEventStack},enable_early_ims:earlymedia,enable_media_stream_cache:!0,bandwidth:null,video_size:null,sip_headers:sheaders})}}}}catch(err){common.PutToDebugLogException(2,"webrtcapi: RegisterEx",err)}}function ResendRegister(){try{oSipSessionRegister&&oSipSessionRegister.register?(common.PutToDebugLog(2,"EVENT, ResendRegister resending..."),sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders}),oSipSessionRegister.register()):common.PutToDebugLog(2,"ERROR, ResendRegister failed, invalid register session"),common.isNull(check_reg_timer)||clearTimeout(check_reg_timer),check_reg_timer=null,check_reg_timer=setTimeout(function(){try{if(common.GetTickCount()-global.webrtclastregsent>3e3){if(common.PutToDebugLog(2,"WARNING, ResendRegister: restart SipStack, because REGISTER was not resent"),!0===webphone_api.isincall())return void common.PutToDebugLog(2,"WARNING, ResendRegister: skip SipStack restart, because a call is in progress");ReStart(1,!0)}}catch(e){common.PutToDebugLogException(2,"webrtcapi: ResendRegister inner timer",e)}},2900)}catch(e){common.PutToDebugLogException(2,"webrtcapi: ResendRegister",e)}}function StartReRegister(e){try{if(common.GetParameterInt("forcereregister",1)<1)return;if(!0===e&&!0===reregstarted)return;if(global.phonestarted<1)return void(reregstarted=!1);reregstarted=!0,common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,rereg_timer=setTimeout(function(){if(global.phonestarted<1)return common.isNull(rereg_timer)||clearTimeout(rereg_timer),rereg_timer=null,reregstarted=!1,rereg_ival=1e4,void(global.webrtc_regstate=-1);if(1===global.webrtc_regstate)return void StartReRegister(!1);if(0===global.webrtc_regstate){rereg_ival<12e4?rereg_ival*=2:rereg_ival=1e4;var e=common.GetParameterInt("forcereregister",1);0===rereg_action&&oSipSessionRegister&&oSipSessionRegister.register?(common.PutToDebugLog(2,"ERROR, ReRegister new session (forcereregister: "+e.toString()+")"),rereg_action=1,ResendRegister()):(common.PutToDebugLog(2,"ERROR, ReRegister restart SipStack (forcereregister: "+e.toString()+")"),rereg_action=0,ReStart(1,!0)),StartReRegister(!1)}},rereg_ival)}catch(t){common.PutToDebugLogException(2,"webrtcapi: StartReRegister",t)}}function onSipEventStack(e){switch(global.isdebugversionwebrtc&&console.log("WRTCEVENT_STACK: "+e.type+", "+e.description),tsk_utils_log_info("==stack event = "+e.type),e.type){case"started":common.getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!0),common.SaveParameter("lastsessionsuccess","2");try{!0===common.NeedRegister()?(oSipSessionRegister=this.newSession("register",{expires:GetRegisterivalWebRTC(),events_listener:{events:"*",listener:onSipEventSession},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null}]}),oSipSessionRegister&&(sipheaders=RemoveDuplicateHeader(sipheaders),oSipSessionRegister.setConfiguration({sip_headers:sipheaders})),oSipSessionRegister.register()):common.PutToDebugLog(1,"STATUS,-1,Ready.")}catch(e){common.PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack register")}break;case"stopping":case"stopped":case"failed_to_start":case"failed_to_stop":"failed_to_start"==e.type||e.type;oSipStack=null,oSipSessionRegister=null,oSipSessionCall=null,uiOnConnectionEvent(!1,!1),stopRingbackTone(),stopRingTone(),uiVideoDisplayShowHide(!1),"failed_to_start"==e.type?(common.PutToDebugLog(1,"ERROR,-1,Register failed"),common.PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_start"),common.CheckInternetConnection(),common.CheckInternetConnectionWS(),common.getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!1),ReStart()):"failed_to_stop"==e.type?(common.PutToDebugLog(1,"ERROR,-1,UnRegister failed"),common.PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack failed_to_stop")):"stopping"==e.type?common.PutToDebugLog(2,"EVENT, WebRTC sipstack stopping"):"stopped"==e.type&&(common.PutToDebugLog(2,"EVENT, WebRTC sipstack stopped"),common.CheckInternetConnection(),common.CheckInternetConnectionWS(),ReStart()),global.webrtc_regstate=0;break;case"i_new_call":if(common.RemoveSipHeadreFromCache("X-reason"),common.RemoveSipHeadreFromCache("Reason"),common.RemoveSipHeadreFromCache("Warning"),common.getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!0),!0===global.dontSendSignaling&&global.dontSendSignalingTimer>0&&common_public.GetTickCount()-global.dontSendSignalingTimer<200)return e.newSession.hangup(),void common.PutToDebugLog(2,"WARNING, webrtcapi, API_Hangup call because retring with optimized SDP");if(!common.onc()){var t=[];t.push("h"),t.push("a"),t.push("n"),t.push("g"),t.push("u"),t.push("p"),t.push(" "),t.push("5"),t.push(" ");var o=t.join("");return common.PutToDebugLog(2,"EVENT, "+o),void SipHangup(!0,-2)}if(common.SaveParameter("lastsessionsuccess","2"),!0===common.UsePresence2()&&"dnd"===common.GetParameter("presencestatus").toLowerCase())return common.PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because presence is DND"),e.newSession.hangup(),setTimeout(function(){SendRegisteredStatus()},500),setTimeout(function(){SendRegisteredStatus()},1e3),void(global.webrtc_regstate=1);if(common.GetNrOfActiveCalls()>0){var n="";if(oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),common.isNull(n)&&(n=""),n=common.Trim(n),n.length>0&&n===global.currcallnumber){var i=common.GetParameterInt("dropsameoldcall",0);if(1===i){var r=common.GetSipHeader("X-Autorecall");common.isNull(r)&&(r=""),r=common.Trim(r),r=r.toLowerCase(),"yes"===r&&(common.PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(1) from: "+n),e.newSession.hangup())}else if(2===i){var r=common.GetSipHeader("X-Autorecall");common.isNull(r)&&(r=""),r=common.Trim(r),r=r.toLowerCase(),!0===global.isvideocall&&"yes"===r&&(common.PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(2) from: "+n),e.newSession.hangup())}else 3===i&&(common.PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, dropsameoldcall(3) from: "+n),e.newSession.hangup())}}if(common.GetNrOfActiveCalls()>0&&1!==common.IsMultiline()){var a=common.GetParameter2("rejectonbusy");if("false"!==a){common.PutToDebugLog(2,"EVENT, webrtcapi hangup incoming call, because rejectonbusy is: "+a),e.newSession.hangup();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),common.isNull(n)&&(n=""),"undefined"!=typeof notifications_public&&null!==notifications_public?notifications_public.AddToCallLog(n,"2","recfile",0,global.aline,"Rejected busy"):console&&console.log&&console.log("ERROR, webrtcapi onSipEventStack notifications_public is not defined")}}else{common.GetNrOfActiveCalls()>0&&(global.aline=common.GetFreeLine()),common_public.restartice_time=common.GetTickCount(),oSipSessionCall=e.newSession,SetSipHeader(1),oSipSessionCall.setConfiguration(HandleOconfigCall(oConfigCall,global.aline)),startRingTone();var n="";oSipSessionCall&&null!==oSipSessionCall&&(n=oSipSessionCall.getRemoteFriendlyName()),showNotifICall(n);var s=global.aline.toString();common.StrToInt(s)<1&&(global.aline=common.GetFreeLine());var l=null;oSipSessionCall.o_session&&oSipSessionCall.o_session&&oSipSessionCall.o_session.o_stack&&oSipSessionCall.o_session.o_stack.ao_headers&&oSipSessionCall.o_session.o_stack.ao_headers.length>0&&(l=oSipSessionCall.o_session.o_stack.ao_headers),common.SaveCallSession(global.aline,oSipSessionCall,n,"2",common.GetTickCount(),-1,-1,"",oSipSessionCall.getId(),"true","",l);try{var c="recv=\n"+e.o_event.o_message;common.CatchWebrtcSignaling(c,common.SIP_REGISTER)}catch(T){common.PutToDebugLogException(2,"webrtcapi: onSipEventStack i_new_call CatchWebrtcSignaling",T)}var u=common.GetEndpoint(-1,n,oSipSessionCall.getId(),!1),m="";common.isNull(u)||(m=u[common.EP_CALLID]),common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",CallSetup,"+n+","+common.GetSipusername()+",2,"+n+",["+m+"],,,,,"),common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",Ringing,"+n+","+common.GetSipusername()+",2,"+n+",["+m+"]"),common.PutToDebugLog(1,"STATUS,-1,Incoming..."),istypeincoming=!0;var g=common.GetParameter2("autoignore");(common.isNull(g)||1!==g.length)&&(g="0");var d=common.StrToInt(g);if(d>1?(common.PutToDebugLog(3,"EVENT, autoignore WebRTC hangup(reject)"),SipHangup(!0,global.aline)):1===d&&(common.PutToDebugLog(3,"EVENT, autoignore WebRTC silent ignore"),stopRingTone()),!0===common.GetParameterBool("autoaccept",!1)){var p=common.GetParameterInt("beeponconnect",0);1!==p&&2!==p&&4!==p||common.Beep("1"),common.PutToDebugLog(3,"EVENT, autoaccept WebRTC accept"),SipAccept(global.aline,!1)}var h=common.GetParameter2("calltransferalways");!common.isNull(h)&&h.length>1&&(common.PutToDebugLog(3,"EVENT, call transfer WebRTC calltransferalways: "+h),SipTransfer(h));var f=common.GetParameter2("callforwardonbusy");!common.isNull(f)&&f.length>1&&Forward(f);var b=common.GetParameter2("callforwardalways");!common.isNull(b)&&b.length>1&&Forward(b)}break;case"i_new_message":common.getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!0),common.SaveParameter("lastsessionsuccess","2"),e.newSession.accept();var v=e.newSession.getRemoteFriendlyName(),t=e.getContentString();if(common.isNull(v)||v.length<1)return void common.PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from is NULL");if(common.isNull(t)||t.length<1)return void common.PutToDebugLog(2,"ERROR, webrtcapi: onSipEventStack chat received, from: "+v+"; message is NULL");common.PutToDebugLog(1,"CHAT,-1,"+v+","+t);break;case"m_permission_requested":common.PutToDebugLog(5,"EVENT, webrtcapi: permission requested"),global.lastpermreq=common.GetTickCount(),last_event=global.last_event,common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",Waiting for permission"),setTimeout(function(){!1===global.webrtcpermissionaccepted&&common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",Waiting for permission")},3500);break;case"m_permission_accepted":if(common.PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission granted"),common.PutToDebugLog(1,"EVENT,"+last_event),global.webrtcpermissionaccepted=!0,RedialOnFail(),!0===global.incommingCall){var _=common.GetTickCount(),E=common.GetParameterInt("acceptcall_onsharedevice",1);2===E?(common.PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_1"),SipAccept(global.aline)):1===E&&("Firefox"===common.GetBrowser()&&!1===common.IsHttps()?(common.PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_2"),SipAccept(global.aline)):"Chrome"===common.GetBrowser()&&!0===common.IsLocalFileSystem()?(common.PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_3"),SipAccept(global.aline)):global.lastpermreq>0&&_-global.lastpermreq>8e3&&(common.PutToDebugLog(5,"EVENT, webrtcapi: Accept Call on MediaStream permission granted_4"),SipAccept(global.aline)))}break;case"m_permission_refused":if("m_permission_refused"==e.type){if(global.webrtcpermissionaccepted=!1,common.PutToDebugLog(5,"EVENT, webrtcapi: MediaStream permission denied"),uiCallTerminated("Media stream permission denied"),!common.isNull(destnumber)&&destnumber.length>0&&"call-audiovideo"===calltype)return common.PutToDebugLog(2,"WARNING, MediaStream permission denied, retry audio call with no video: "+destnumber),void SipCall("call-audio",callline,destnumber);common.PutToDebugLog(2,"EVENT, Hangup incoming call, because MediaStream permission denied: "+destnumber),SipHangup(!0,global.aline),setTimeout(function(){common.MediaStreamPermissionDenied()},150)}}}function onSipEventSession(e){switch(global.isdebugversionwebrtc&&console.log("WRTCEVENT_SESSION: "+e.type+", "+e.description),common.isNull(e.session.o_session)||common.isNull(e.session.o_session.s_type),common.SaveParameter("lastsessionsuccess","2"),tsk_utils_log_info("==session event = "+e.type),e.type){case"connecting":case"connected":var t="connected"==e.type;if(e.session==oSipSessionRegister)"connecting"==e.type&&common.PutToDebugLog(1,"STATUS,-1,Registering..."),"connected"==e.type&&(common.getuseengine()===global.ENGINE_WEBRTC&&(global.iscurrengineworking=!0),isregistered=!0,SendRegisteredStatus(),global.webrtc_regstate=1);else if(e.session==oSipSessionMessage);else if(e.session==oSipSessionTransferCall);else if(e.session instanceof SIPml.Session.Call){var o=!1;if(e.session==oSipSessionCall&&(o=!0),!1===o&&!common.isNull(global.ep))for(var n=0;n<global.ep.length;n++){var i=global.ep[n][common.EP_SESSION];if(!common.isNull(i)&&e.session==i){o=!0;break}}if(!0===o){var r="unknown";e&&null!==e&&e.session&&null!==e.session&&(r=e.session.getRemoteFriendlyName());var a="1";istypeincoming&&(a="2");try{if("undefined"!=typeof e.session.o_session&&null!==e.session.o_session&&"undefined"!=typeof e.session.o_session.o_uri_from&&null!==e.session.o_session.o_uri_from&&"undefined"!=typeof e.session.o_session.o_uri_from.s_user_name&&null!==e.session.o_session.o_uri_from.s_user_name&&e.session.o_session.o_uri_from.s_user_name.length>0){var s=e.session.o_session.o_uri_from.s_user_name;!common.isNull(s)&&s.length>0&&(a=common.GetSipusername().toLowerCase()===s.toLowerCase()?"1":"2")}}catch(w){common.PutToDebugLogException(2,"webrtcapi: onSipEventSession: connecting or connected",w)}if(t){stopRingbackTone(),stopRingTone(),oNotifICall&&(oNotifICall.cancel(),oNotifICall=null);var l=common.GetEndpoint(-1,r,e.session.getId(),!1),c="";common.isNull(l)||(c=l[common.EP_CALLID]),common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",CallConnect,"+r+","+common.GetSipusername()+","+a+","+r+",,,,,,["+c+"]"),common.SaveCallSession(global.aline,e.session,r,a,-1,common.GetTickCount(),-1,"",e.session.getId(),"",""),setTimeout(function(){common.PutToDebugLog(1,"STATUS,-1,InCall"),common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",Speaking,"+r+","+common.GetSipusername()+","+a+","+r)},1100),common.PutToDebugLog(1,"STATUS,-1,Speaking"),"2"===a&&common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",InCall,"+r+","+common.GetSipusername()+","+a+","+r)}else common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+","+e.description),common.SaveCallSession(global.aline,e.session,r,a,common.GetTickCount(),-1,-1,"",e.session.getId(),"","",null);SIPml.isWebRtc4AllSupported()&&(common.PutToDebugLog(2,"EVENT, webrtc4all supported connect uiVideoDisplayEvent"),uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0))}}break;case"terminating":case"terminated":if(e.session==oSipSessionRegister)if(uiOnConnectionEvent(!1,!1),oSipSessionCall=null,oSipSessionRegister=null,isregistered=!1,global.webrtc_regstate=0,!0===global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc);else{common.PutToDebugLog(2,"ERROR,register failed with reason: "+e.description),common.PutToDebugLog(1,"STATUS,-1,Register failed: "+e.description),!common.isNull(e.description)&&e.description.length>0&&(lastregfailreason=e.description);try{webphone_api.onRegStateChangeCb("failed",e.description)}catch(w){common.PutToDebugLogException(2,"webrtcapi: There is an error in onRegStateChangeCb(failed) callback",w)}try{webphone_api.onRegisterFailedCb(e.description)}catch(w){common.PutToDebugLogException(2,"webrtcapi: There is an error in onRegisterFailed() callback",w)}common.CheckInternetConnection(),common.CheckInternetConnectionWS()}else if(e.session==oSipSessionMessage)common.PutToDebugLog(2,"EVENT,EventSession message: "+e.type);else if(e.session==oSipSessionTransferCall)common.PutToDebugLog(2,"EVENT,EventSession call transfer: "+e.type);else if(e.session instanceof SIPml.Session.Call){if(common.PutToDebugLog(2,"EVENT,EventSession call: "+e.type),e.session===lastsession)return void common.PutToDebugLog(2,"EVENT, webrtcap: skip because duplicate session received");lastsession=e.session;var r="unknown";e&&null!==e&&e.session&&null!==e.session&&(r=e.session.getRemoteFriendlyName());var a="1";istypeincoming&&(a="2"),setTimeout(function(){calltype="",callline=1,destnumber=""},200);var l=common.GetEndpoint(global.aline,r,e.session.getId(),!1),c="";if(common.isNull(l)||(c=l[common.EP_CALLID]),!common.isNull(l)&&"true"===l[common.EP_FINISHEDSENT]||lastsessionid===e.session.getId())common.PutToDebugLog(3,"EVENT, webrtc finished status already sent for this session");else{var u=global.aline;lastsessionid=e.session.getId(),setTimeout(function(){lastsessionid=-1e3},150),!1===global.calltransf_completed&&(u=common.SaveCallSession(null,e.session,r,a,-1,-1,common.GetTickCount(),"",e.session.getId(),"","true",null)),u<-4&&(u=global.aline),common.PutToDebugLog(1,"STATUS,"+u.toString()+",CallDisconnect,"+r+","+common.GetSipusername()+","+a+","+r+",,,,,,["+c+"]"),uiCallTerminated("Call Finished",u),BuildCDR(u,r,e.session.getId(),e.description)}}break;case"i_notify":if(common.PutToDebugLog(4,"EVENT, NOTIFY content-type: "+e.getContentType()),common.PutToDebugLog(4,"EVENT, NOTIFY content: "+e.getContentString()),"application/pidf+xml"==e.getContentType()&&window.DOMParser){var m=new DOMParser,g=m?m.parseFromString(e.getContentString(),"text/xml"):null,d=g?g.getElementsByTagName("presence")[0]:null;if(d){var p=d.getAttribute("entity"),h=d.getElementsByTagName("tuple")[0];if(p&&h){var f=h.getElementsByTagName("status")[0];if(f){var b=f.getElementsByTagName("basic")[0];if(b){var v=p,_=b.textContent;v=v.toLowerCase(),v=v.replace("sip:","");var E=v.indexOf("@");E>0&&(v=v.substring(0,E));var T=common.SaveReceivedPresence2(v,_);common.PutToDebugLog(4,"EVENT, Presence notification: number: "+v+" status: "+_),!1===common.IsSDK()&&wpa._dialpad.PopulateListRecents(),!0===global.isContactdetailsStarted&&!1===common.IsSDK()&&wpa._contactdetails.PopulateData(),!0===global.isMessageStarted&&message_public.DisplayPresence(T)}}}}}break;case"m_stream_video_local_added":common.PutToDebugLog(2,"EVENT, local video stream added"),e.session instanceof SIPml.Session.Call&&uiVideoDisplayEvent(!0,!0);break;case"m_stream_video_local_removed":common.PutToDebugLog(2,"EVENT, local video stream removed"),e.session instanceof SIPml.Session.Call&&uiVideoDisplayEvent(!0,!1);break;case"m_stream_video_remote_added":common.PutToDebugLog(2,"EVENT, remote video stream added"),e.session instanceof SIPml.Session.Call&&uiVideoDisplayEvent(!1,!0);break;case"m_stream_video_remote_removed":common.PutToDebugLog(2,"EVENT, remote video stream removed"),e.session instanceof SIPml.Session.Call&&uiVideoDisplayEvent(!1,!1);break;case"m_stream_audio_local_added":common.PutToDebugLog(2,"EVENT, local audio stream added");case"m_stream_audio_local_removed":common.PutToDebugLog(2,"EVENT, local audio stream removed");case"m_stream_audio_remote_added":common.PutToDebugLog(2,"EVENT, remote audio stream added");case"m_stream_audio_remote_removed":common.PutToDebugLog(2,"EVENT, remote audio stream removed");break;case"i_ect_new_call":oSipSessionTransferCall=e.session;break;case"i_ao_request":if(e.session instanceof SIPml.Session.Call){var P=global.aline.toString(),S=common.StrToInt(P);S<1&&(global.aline=common.GetFreeLine());var r="unknown";e&&null!==e&&e.session&&null!==e.session&&(r=e.session.getRemoteFriendlyName());var l=common.GetEndpoint(-1,r,e.session.getId(),!1),c="";common.isNull(l)||(c=l[common.EP_CALLID]),!common.isNull(l)&&l.length>common.EP_SETUPSENT&&"true"===l[common.EP_SETUPSENT]||(common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",CallSetup,"+r+","+common.GetSipusername()+",1,"+r+",["+c+"],,,,,"),common.SaveCallSession(global.aline,e.session,r,"1",common.GetTickCount(),-1,-1,"",e.session.getId(),"true","",null));var N=e.getSipResponseCode();180!=N&&183!=N||(common.PutToDebugLog(1,"STATUS,-1,Ringing..."),istypeincoming=!1,common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",Ringing,"+r+","+common.GetSipusername()+",1,"+r+",["+c+"]"),0===changesptoring?180==N&&startRingbackTone():2!==changesptoring&&5!==changesptoring||startRingbackTone())}break;case"m_early_media":e.session instanceof SIPml.Session.Call&&(5!==changesptoring&&setTimeout(function(){stopRingbackTone(),stopRingTone()},100),common.PutToDebugLog(1,"STATUS,-1,Early media started"));break;case"m_local_hold_ok":e.session instanceof SIPml.Session.Call&&(e.session.bTransfering&&(e.session.bTransfering=!1),e.session.bHeld=!0);break;case"m_local_hold_nok":e.session instanceof SIPml.Session.Call&&(e.session.bTransfering=!1);break;case"m_local_resume_ok":e.session instanceof SIPml.Session.Call&&(e.session.bTransfering=!1,e.session.bHeld=!1,SIPml.isWebRtc4AllSupported()&&(uiVideoDisplayEvent(!1,!0),uiVideoDisplayEvent(!0,!0)));break;case"m_local_resume_nok":e.session instanceof SIPml.Session.Call&&(e.session.bTransfering=!1,common.PutToDebugLog(1,"STATUS,-1,Failed to unhold call"));break;case"m_remote_hold":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,-1,Placed on hold by remote party");break;case"m_remote_resume":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,-1,Taken off hold by remote party");break;case"m_bfcp_info":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,-1,BFCP Info: "+e.description);break;case"o_ect_trying":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,"+global.aline+",Call transfer in progress..._");break;case"o_ect_accepted":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,"+global.aline+",Call transfer accepted");break;case"o_ect_completed":case"i_ect_completed":e.session instanceof SIPml.Session.Call&&(global.calltransf_completed=!0,setTimeout(function(){global.calltransf_completed=!1,common.RefreshInfo()},3e3),common.PutToDebugLog(1,"STATUS,"+global.aline+",Call transfer completed"),oSipSessionTransferCall&&(oSipSessionCall=oSipSessionTransferCall),oSipSessionTransferCall=null);break;case"o_ect_failed":common.PutToDebugLog(1,"ERROR,"+global.aline+",Call transfer failed_");case"i_ect_failed":e.session instanceof SIPml.Session.Call&&common.PutToDebugLog(1,"STATUS,"+global.aline+",Call transfer failed");break;case"o_ect_notify":common.PutToDebugLog(1,"STATUS,"+global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description+"_o");case"i_ect_notify":e.session instanceof SIPml.Session.Call&&(common.PutToDebugLog(1,"STATUS,"+global.aline+",Call Transfer: "+e.getSipResponseCode()+" "+e.description),e.getSipResponseCode()>=300&&e.session.bHeld&&e.session.resume());break;case"i_ect_requested":if(e.session instanceof SIPml.Session.Call){if(0===common.GetParameterInt("transfertype",-1))common.PutToDebugLog(2,"EVENT, incoming SIP REFER transfer rejected."),e.session.rejectTransfer();else{common.PutToDebugLog(1,"STATUS,"+global.aline+",Call transfer in progress...");var P=global.aline.toString(),S=common.StrToInt(P);S<1&&(global.aline=common.GetFreeLine());var r="unknown";e&&null!==e&&e.session&&null!==e.session&&(r=e.session.getRemoteFriendlyName());var l=common.GetEndpoint(-1,r,e.session.getId(),!1),c="";common.isNull(l)||(c=l[common.EP_CALLID]),!common.isNull(l)&&l.length>common.EP_SETUPSENT&&"true"===l[common.EP_SETUPSENT]||(common.PutToDebugLog(1,"STATUS,"+global.aline.toString()+",CallSetup,"+r+","+common.GetSipusername()+",1,"+r+",["+c+"],,,,,"),common.SaveCallSession(global.aline,e.session,r,"1",common.GetTickCount(),-5,-5,"",e.session.getId(),"true","",null));var N=e.getSipResponseCode();e.session.acceptTransfer()}}}}function BuildCDR(e,t,o,n){try{2===common.GetParameterInt("androidspeaker",1)&&!1===adev_hack_called&&"Android"===common.GetOs()&&(common.isNull(audioinput_id)||audioinput_id.length<1||audioinput_name[0].toLowerCase().indexOf("microphone")>=0&&audioinput_name[0].indexOf("1")>=0)&&(adev_hack_called=!0,StartGetDevices(),setTimeout(function(){plhandler_public.GetAudioDevicesForMenu(0,!0)},200));var i=!0;!0===global.calltransf_completed&&(i=!1);var r=common.GetEndpoint(e,t,o,i);if(common.isNull(r)||r.length<5)return void common.PutToDebugLog(2,"ERROR, webrtcapi: BuildCDR invalid endpoint");var a=0,s=0,l=0,c="",u=!1;!common.isNull(r[common.EP_SETUPTIME])&&common.IsNumber(r[common.EP_SETUPTIME])&&(a=common.StrToInt(r[common.EP_SETUPTIME])),!common.isNull(r[common.EP_CONNECTTIME])&&common.IsNumber(r[common.EP_CONNECTTIME])&&(s=common.StrToInt(r[common.EP_CONNECTTIME])),!common.isNull(r[common.EP_DESTNR])&&r[common.EP_DESTNR].length>0&&(c=r[common.EP_DESTNR]),common.isNull(r[common.EP_INCOMING])||1!==r[common.EP_INCOMING].length||"2"===r[common.EP_INCOMING]&&(u=!0),l=common.GetTickCount();var m=0;!common.isNull(s)&&s>0&&!common.isNull(l)&&l>0&&(m=l-s),c=common.isNull(c)?"":common.Trim(c),common.isNull(s)&&(s=0);var g="",d="",p="NA";!common.isNull(s)&&common.IsNumber(s)&&!common.isNull(a)&&common.IsNumber(a)&&(p=(s-a).toString());u?(g=c,d=common.GetSipusername()):(g=common.GetSipusername(),d=c),common.isNull(n)&&(n="");var h=r[common.EP_CALLID];(common.isNull(o)||o.length<1)&&(h=o),common.GetDiscReasonFromSignaling(function(t){!common.isNull(t)&&t.length>0&&(n=t);var o="CDR,"+e+","+c+","+g+","+d+",NA,"+p+","+m.toString()+",NA,"+n+","+h;global.lastcallcdr=o,setTimeout(function(){common.PutToDebugLog(1,o)},500),setTimeout(function(){SendRegisteredStatus()},1500)})}catch(f){common.PutToDebugLogException(2,"webrtcapi: BuildCDR",f)}}function SendRegisteredStatus(){isregistered&&common.PutToDebugLog(1,"STATUS,-1,Registered.")}function GetWebrtcStats(){try{return}catch(e){common.PutToDebugLogException(2,"webrtcapi: GetWebrtcStats",e)}}function DumpStats(e){try{var t="";return Object.keys(e).forEach(function(o,n){var i=e[o];t+="<h3>Report ",t+=n,t+="</h3>\n",t+="time "+i.timestamp+"<br>\n",t+="type "+i.type+"<br>\n",Object.keys(i).forEach(function(e){"timestamp"!==e&&"type"!==e&&(t+=e+": "+i[e]+"<br>\n")})}),t}catch(o){common.PutToDebugLogException(2,"webrtcapi: DumpStats",o)}return""}function SetVolume(e,t){try{if(common.isNull(t)||!common.IsNumber(t))return void common.PutToDebugLog(2,"ERROR, webrtcapi: SetVolume is NULL: "+t);var o=common.StrToInt(t);if(o<0||o>100)return void common.PutToDebugLog(2,"ERROR, webrtcapi: SetVolume invalid value. Accepted varulue range is from 0 - 100: "+o);var n=document.getElementById("audio_remote");if(common.isNull(n))return common.PutToDebugLog(2,"ERROR, webrtcapi: SetVolume cannot find audio element"),!1;0==e||"0"==e?(o>100&&(o=100),o<0&&(o=0),o/=100,webphone_api.webrtcMicVolume=o):2==e&&"2"==e?(o>100&&(o=100),j$("#ringtone").prop("volvalueforgetvolume",o),j$("#ringbacktone").prop("volvalueforgetvolume",o),o=o/100*2,o>1&&(o=1),j$("#ringtone").prop("volume",o),j$("#ringbacktone").prop("volume",o)):0!=e&&"0"!=e&&(o>100&&(o=100),j$("#audio_remote").prop("volvalueforgetvolume",o),o=o/100*2,o>1&&(o=1),j$("#audio_remote").prop("volume",o),j$("#video_remote").prop("volume",o))}catch(i){common.PutToDebugLogException(2,"webrtcapi: SetVolume",i)}}function GetVolume(e){try{if(0==e||"0"==e){return common.GetParameterInt("volumein",50)}if(0!=e){var t=j$("#audio_remote").prop("volume");t=100*t/2;var o=j$("#audio_remote").prop("volvalueforgetvolume");return!common.isNull(o)&&common.IsNumber(o)&&(t=common.StrToInt(o)),common.PutToDebugLog(2,"webrtcapi: GetVolume returned: "+t.toString()),t}}catch(n){common.PutToDebugLogException(2,"webrtcapi: GetVolume",n)}}function GetAudioDeviceList(e){try{var t=[];t=0==e?audioinput_name:1===e||2===e?audiooutput_name:videoinput_name;var o="";if(!common.isNull(t)&&t.length>0)for(var n=0;n<t.length;n++)o.length>0&&(o+="\r\n"),o+=t[n];return o}catch(i){common.PutToDebugLogException(2,"webrtcapi: GetAudioDeviceList",i)}return""}function GetAudioDevice(e){try{var t="";if(0==e){t=audioinput_name[0];var o=common.GetParameter("sel_rtc_audio_in");if(!common.isNull(o)&&o.length>0)for(var n=0;n<audioinput_name.length;n++)if(o===audioinput_name[n]){t=o;break}(common.isNull(t)||t.length<1)&&(t=o),common.SaveParameter("sel_rtc_audio_in",t)}else if(1==e||2==e){t=audiooutput_name[0]
;var o=common.GetParameter("sel_rtc_audio_out");if(!common.isNull(o)&&o.length>0)for(var n=0;n<audiooutput_name.length;n++)if(o===audiooutput_name[n]){t=o;break}(common.isNull(t)||t.length<1)&&(t=o),common.SaveParameter("sel_rtc_audio_out",t)}if(3==e){t=videoinput_name[0];var o=common.GetParameter("sel_rtc_video_in");if(!common.isNull(o)&&o.length>0)for(var n=0;n<videoinput_name.length;n++)if(o===videoinput_name[n]){t=o;break}(common.isNull(t)||t.length<1)&&(t=o),common.SaveParameter("sel_rtc_video_in",t)}return t}catch(i){common.PutToDebugLogException(2,"webrtcapi: GetAudioDevice",i)}return""}function SetAudioDevice(e,t,o){try{var n=!1;if(common.isNull(t)||t.length<0)return void common.PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice: invalid devicename: "+t);if(common.PutToDebugLog(3,"EVENT, webrtcapi SetAudioDevice: device: "+e+", devicename: "+t),t=t.toLowerCase(),0===e){for(var i=0;i<audioinput_name.length;i++)if(!common.isNull(audioinput_name[i])&&audioinput_name[i].toLowerCase()===t){common.SaveParameter("sel_rtc_audio_in",audioinput_name[i]),GetSetDevices(audioinput_id[i],"",o),n=!0;break}}else if(1===e||2===e){for(var i=0;i<audiooutput_name.length;i++)if(!common.isNull(audiooutput_name[i])&&audiooutput_name[i].toLowerCase()===t){var r=audiooutput_name[i];common.SaveParameter("sel_rtc_audio_out",r.toString()),common.isNull(videoElement)?common.PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice videoElement is NULL"):attachSinkId(videoElement,audiooutput_id[i],"audio output_v"),attachSinkId(audioRemoteElement,audiooutput_id[i],"audio output"),n=!0;break}}else for(var i=0;i<videoinput_name.length;i++)if(!common.isNull(videoinput_name[i])&&videoinput_name[i].toLowerCase()===t){common.SaveParameter("sel_rtc_video_in",videoinput_name[i]),!0===o&&(common.isNull(videoElement)?common.PutToDebugLog(2,"WARNING, webrtcapi SetAudioDevice for video videoElement is NULL"):attachSinkId(videoElement,videoinput_id[i],"video")),n=!0;break}!1===n&&common.PutToDebugLog(2,"ERROR, webrtcapi SetAudioDevice device not found")}catch(a){common.PutToDebugLogException(2,"webrtcapi: SetAudioDevice",a)}}function StartGetDevices(){try{videoElement=document.getElementById("video_remote"),audioRemoteElement=document.getElementById("audio_remote"),common.isNull(navigator.mediaDevices)||common.isNull(navigator.mediaDevices.enumerateDevices)||eval("navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(errorCallback);")}catch(err){common.PutToDebugLogException(2,"webrtcapi: StartGetDevices",err)}}function GetSetDevices(audioSource,videoSource,setalsovideo,vid_prev_elem){try{window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var constraints=null;constraints=!0===setalsovideo?{audio:{deviceId:audioSource?{exact:audioSource}:undefined},video:{deviceId:videoSource?{exact:videoSource}:undefined}}:{audio:{deviceId:audioSource?{exact:audioSource}:undefined}},common.isNull(navigator.mediaDevices)||common.isNull(navigator.mediaDevices.getUserMedia)||eval("navigator.mediaDevices.getUserMedia(constraints).then(function(stream){window.stream = stream;if(typeof(vid_prev_elem) !== 'undefined' && vid_prev_elem !== null) { attachMediaStream(vid_prev_elem, stream); }}).then(gotDevices).catch(errorCallback);")}catch(err){common.PutToDebugLogException(2,"webrtcapi: GetSetDevices",err)}}function SwitchOffAndroidSpeaker(callback){function GUMHandleSuccess(stream){function ENUMgotdevices(e){try{if(!common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var t=0;t!==e.length;++t){var o=e[t],n=o.deviceId;if("audioinput"===o.kind){var i=o.label||"microphone "+(audioinput_name.length+1);audioinput_name.push(i),audioinput_id.push(n)}else if("audiooutput"===o.kind){var i=o.label||"speaker "+(audiooutput_name.length+1);audiooutput_name.push(i),audiooutput_id.push(n)}else if("videoinput"===o.kind){var i=o.label||"camera "+(videoinput_name.length+1);videoinput_name.push(i),videoinput_id.push(n)}else common.PutToDebugLog(3,"EVENT, webrtcapi GUMgotdevices: Some other kind of source/device: ",o)}common.PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 0"),webphone_api.getdevicelist(0,function(){}),common.PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 1"),webphone_api.getdevicelist(1,function(){}),common.PutToDebugLog(2,"EVENT, mlogic API_GetDevicelist WebRTC 3"),webphone_api.getdevicelist(3,function(){}),common.PutToDebugLog(3,"EVENT, webrtcapi SwitchOffAndroidSpeaker GUMgotdevices executed successfully"),callback()}else common.PutToDebugLog(2,"WARNING, webrtrcapi GUMgotdevices: no devices found"),callback()}catch(r){common.PutToDebugLogException(2,"webrtcapi: ENUMgotdevices",r),callback()}}function ENUMerrorCallback(e){common.PutToDebugLog(2,"ERROR, GUMerrorCallback webrtcapi navigator.getUserMedia: "+e),callback()}try{eval("navigator.mediaDevices.enumerateDevices().then(ENUMgotdevices).catch(ENUMerrorCallback);")}catch(err){common.PutToDebugLogException(2,"webrtcapi: GUMHandleSuccess",err),callback()}}function GUMHandleError(e){try{common.PutToDebugLog(2,"ERROR, GUMHandleError webrtcapi navigator.getUserMedia: "+e),callback()}catch(t){common.PutToDebugLogException(2,"webrtcapi: GUMHandleError",t),callback()}}try{if(callback&&"function"==typeof callback||(callback=function(){}),"MSIE"===common.GetBrowser())return void callback();if(!0===switchas_called||"Android"!==common.GetOs())return void callback();var as=common.GetParameterInt("androidspeaker",1);if(as<1)return void callback();switchas_called=!0;var constraints={audio:!0,video:!1};eval("navigator.mediaDevices.getUserMedia(constraints).then(GUMHandleSuccess).catch(GUMHandleError);")}catch(err){common.PutToDebugLogException(2,"webrtcapi: SwitchOffAndroidSpeaker",err),callback()}}function MyCameraPreview(e){try{if(common.GetParameterInt("displayvideodevice",0)<1)return;common.PutToDebugLog(2,"EVENT, webrtcapi MyCameraPreview: "+e);var t='<div id="preview_div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="preview_video_local" autoplay="autoplay" muted="true"></video><button id="preview_btn_close">'+stringres.get("btn_close")+"</button></div>";if(!1===common.IsSDK()){var o=j$.mobile.activePage.attr("id");j$("#"+o).append(t)}else j$("body").append(t);var n=document.getElementById("preview_video_local");if(common.isNull(n))return void common.PutToDebugLog(2,"EVENT, MyCameraPreview video element is NULL");j$("#preview_btn_close").on("click",function(){HideVideoPriview()});GetSetDevices(GetAudioVideoInputId(common.GetParameter("sel_rtc_audio_in"),!1),GetAudioVideoInputId(common.GetParameter("sel_rtc_video_in"),!0),!0,n),setTimeout(function(){HideVideoPriview()},1e4)}catch(i){common.PutToDebugLogException(2,"webrtcapi: MyCameraPreview",i)}}function HideVideoPriview(){try{var e=document.getElementById("preview_video_local");if(common.isNull(e))return;"undefined"!=typeof URL.revokeObjectURL&&URL.revokeObjectURL(e.src),e.src&&(e.src=null),j$("#preview_div_video_local").remove()}catch(t){common.PutToDebugLogException(2,"webrtcapi: HideVideoPriview",t)}}function PrintWebRTCAudioDevices(){try{if(!0===global.printwad_called)return;global.printwad_called=!0,common.isNull(audioinput_name)||common.isNull(audioinput_id)||common.PutToDebugLog(2,"EVENT, webrtcdevices: audio input devices name: "+audioinput_name.toString()+"; ids: "+audioinput_id.toString()),common.isNull(audiooutput_name)||common.isNull(audiooutput_id)||common.PutToDebugLog(2,"EVENT, webrtcdevices: audio output devices name: "+audiooutput_name.toString()+"; ids: "+audiooutput_id.toString()),common.isNull(videoinput_name)||common.isNull(videoinput_id)||common.PutToDebugLog(2,"EVENT, webrtcdevices: video input devices name: "+videoinput_name.toString()+"; ids: "+videoinput_id.toString())}catch(e){common.PutToDebugLogException(2,"webrtcapi: PrintWebRTCAudioDevices",e)}}function GetAudioVideoInputId(e,t){try{if(common.isNull(e)||e.length<1)return e;if(!0===t){if(common.isNull(videoinput_name)||videoinput_name.length<1||common.isNull(videoinput_id)||videoinput_id.length<1)return e;for(var o=0;o<videoinput_name.length;o++)if(e===videoinput_name[o])return videoinput_id[o]}else{if(common.isNull(audioinput_name)||audioinput_name.length<1||common.isNull(audioinput_id)||audioinput_id.length<1)return e;for(var o=0;o<audioinput_name.length;o++)if(e===audioinput_name[o])return audioinput_id[o]}}catch(n){common.PutToDebugLogException(2,"webrtcapi: GetAudioInputId",n)}return e}function gotDevices(e){try{if(!common.isNull(e)&&e.length>0){audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[];for(var t=0;t!==e.length;++t){var o=e[t],n=o.deviceId;if("audioinput"===o.kind){var i=o.label||"microphone "+(audioinput_name.length+1);audioinput_name.push(i),audioinput_id.push(n)}else if("audiooutput"===o.kind){var i=o.label||"speaker "+(audiooutput_name.length+1);audiooutput_name.push(i),audiooutput_id.push(n)}else if("videoinput"===o.kind){var i=o.label||"camera "+(videoinput_name.length+1);videoinput_name.push(i),videoinput_id.push(n)}else common.PutToDebugLog(3,"EVENT, webrtcapi gotDevices: Some other kind of source/device: ",o)}PrintWebRTCAudioDevices()}else common.PutToDebugLog(2,"WARNING, webrtrcapi gotDevices: no devices found")}catch(r){common.PutToDebugLogException(2,"webrtcapi: gotDevices",r)}}function attachSinkId(element,sinkId,msg){try{"undefined"!=typeof element.sinkId?eval("element.setSinkId(sinkId).then(function(){common.PutToDebugLog(3, 'EVENT, webrtcapi attachSinkId: Success, ' + msg + ' device: ' + element.toString() + '; attached: ' + sinkId);}).catch(function(error){var errorMessage = error;if (error.name === 'SecurityError'){errorMessage = 'You need to use HTTPS for selecting audio output device: ' + error;}common.PutToDebugLog(2, 'ERROR, webrtcapi attachSinkId to: ' + element.toString() + '; sinkId: ' + sinkId + ' error: ' + errorMessage);});"):common.PutToDebugLog(2,"WARNING, webrtcapi attachSinkId: Browser does not support output device selection.")}catch(err){common.PutToDebugLogException(2,"webrtcapi: attachSinkId",err)}}function errorCallback(e){common.PutToDebugLog(2,"ERROR, webrtcapi navigator.getUserMedia: "+e)}function AddVideoElemnts(e){try{var t='<div id="div_video"><div id="div_video_remote"><video class="video" width="100%" height="100%" id="video_remote" autoplay="autoplay"></video></div><div id="div_video_local_wrapper"><iframe allow="microphone; camera" class="previewvideo"> </iframe><div id="div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="video_local" autoplay="autoplay" muted="true"></video></div></div><div id="div_video_fullscreen_button"><button id="btn_video_fullscreen" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">'+stringres.get("btn_video_fullscreen")+"</button></div></div>";videocontainer=document.getElementById("video_container"),common.isNull(videocontainer)?!0===e?common.PutToDebugLog(2,"WARNING, AddVideoElemnts cannot find video_container DIV"):common.PutToDebugLog(2,"EVENT, AddVideoElemnts cannot find video_container DIV"):common.isNull(divVideo)&&(common.PutToDebugLog(2,"EVENT, AddVideoElemnts video elements added"),videocontainer.innerHTML=t),divVideo=document.getElementById("div_video"),videoLocal=document.getElementById("video_local"),videoRemote=document.getElementById("video_remote"),audioRemote=document.getElementById("audio_remote"),j$("#btn_video_fullscreen").off("click"),j$("#btn_video_fullscreen").on("click",function(){toggleFullScreen()})}catch(o){common.PutToDebugLogException(2,"webrtcapi: AddVideoElemnts",o)}}function GetVideoSizeObj(){var e=undefined;try{var t=common.GetParameter2("video_min_width"),o=common.GetParameter2("video_min_height"),n=common.GetParameter2("video_max_width"),i=common.GetParameter2("video_max_height"),r=common.GetParameter2("video_width"),a=common.GetParameter2("video_height"),s=0,l=0,c=0,u=0,m=0,g=0;s=!common.isNull(t)&&t.length>0&&common.IsNumber(t)?common.StrToInt(t):100,l=!common.isNull(o)&&o.length>0&&common.IsNumber(o)?common.StrToInt(o):80,c=!common.isNull(n)&&n.length>0&&common.IsNumber(n)?common.StrToInt(n):1920,u=!common.isNull(i)&&i.length>0&&common.IsNumber(i)?common.StrToInt(i):1080,m=!common.isNull(r)&&r.length>0&&common.IsNumber(r)?common.StrToInt(r):960,g=!common.isNull(a)&&a.length>0&&common.IsNumber(a)?common.StrToInt(a):540,71===common.GetConfigInt("brandid",-1)&&(m>0&&(s=m),g>0&&(l=g)),s>0&&l>0&&c>0&&u>0&&(common.PutToDebugLog(2,"EVENT, webrtcapi: video minw: "+s+"; minh: "+l+"; maxw: "+c+"; maxh: "+u),e={minWidth:s,minHeight:l,maxWidth:c,maxHeight:u,width:m,height:g})}catch(d){common.PutToDebugLogException(2,"webrtcapi: GetVideoSizeObj",d)}return e}function GetRegFailReason(){return common.isNull(lastregfailreason)&&(lastregfailreason=""),lastregfailreason}function SetPushNotifications(e,t,o,n){try{if(common.isNull(t)||t.length<3)return void common.PutToDebugLog(2,"ERROR, webrtcapi SetPushNotifications invalid TOKEN: "+t);common.isNull(o)&&(o=""),common.isNull(n)&&(n="");var i="X-MPUSH: w:"+common.GetFCMPackageName()+":"+t,r=common.GetSipusername()+":"+mRealm+":"+common.GetParameter("password"),a="X-PIID: "+common.Md5Hash(r);SetSipHeader(0,i),SetSipHeader(0,a),global.phonestarted>2&&ResendRegister()}catch(s){common.PutToDebugLogException(2,"webrtcapi: SetPushNotifications",s)}}function PlaySound(e,t,o,n,i,r,a,s,l){try{return!common.isNull(ps_audio)&&ps_audio.pause&&ps_audio.pause(),ps_audio=null,1==e&&!common.isNull(t)&&t.length>0&&(ps_audio=new Audio(t),ps_audio.play()),!0}catch(c){common.PutToDebugLogException(2,"webrtcapi: PlaySound",c)}return!1}function LineToCallID(e){try{var t=common.StrToInt(e);if(common.isNull(global.ep)||global.ep.length<1)return"";for(var o=0;o<global.ep.length;o++){var n=global.ep[o];if(!(common.isNull(n)||n.length<9)&&n[common.EP_LINE]==t)return n[common.EP_CALLID]}}catch(i){common.PutToDebugLogException(2,"webrtcapi: LineToCallID",i)}return""}function CallIDToLine(e){try{if(e=e.toString(),e.length<1)return-10;if(common.isNull(global.ep)||global.ep.length<1)return"";for(var t=0;t<global.ep.length;t++){var o=global.ep[t];if(!(common.isNull(o)||o.length<9)&&o[common.EP_CALLID]==e)return o[common.EP_LINE]}}catch(n){common.PutToDebugLogException(2,"webrtcapi: CallIDToLine",n)}return-10}var sTransferNumber,oRingTone,oRingbackTone,oSipStack,oSipSessionRegister,oSipSessionCall,oSipSessionMessage,oSipSessionTransferCall,videoRemote,videoLocal,audioRemote,divVideo,bFullScreen=!1,oNotifICall,bDisableVideo=!1,viewVideoLocal,viewVideoRemote,viewLocalScreencast,oConfigCall,oConfigMessage,oConfigSms,oReadyStateTimer,isregistered=!1,sipheaders=[],callsipheaders=[],mSipuri="",mDisplayname="",changesptoring=2,recheckmediaonconnect=2,lastregfailreason="",mRealm="";C={divKeyPadWidth:220};var initcallback=null,lastrestarttick=0,restartdelay=2e3,restarttimestr="",te2=null,sipstackstarted=!1,redialonfailtimer=null,calltype="",callline=1,destnumber="",last_vid_device="",red_line=null,red_sessioncall=null,red_number=null,red_setuptime=0,red_callid=null,red_headers=null,red_delaytime=6e3,red_s_type="call-audio",lastmuste_mute=null,lastmuste_direction=null,lastmuste_line=null,lastmuste_log=null,publishSession,subscribeSession,maxnrofusers=25,pgmaxloop=0,check_reg_timer=null,reregstarted=!1,rereg_timer=null,rereg_ival=1e4,rereg_action=0,last_event="",lastsession=null,lastsessionid=-1e3,istypeincoming=!1,adev_hack_called=!1,videoElement=null,audioRemoteElement=null,switchas_called=!1,audioinput_name=[],audioinput_id=[],audiooutput_name=[],audiooutput_id=[],videoinput_name=[],videoinput_id=[],videocontainer=null,ps_audio=null,webrtcapi_public={WebRtcIsSupported:WebRtcIsSupported,ReStart:ReStart,PresenceSet:PresenceSet,PresenceGet:PresenceGet,GetWebrtcStats:GetWebrtcStats,GetAudioVideoInputId:GetAudioVideoInputId,MyCameraPreview:MyCameraPreview,HideVideoPriview:HideVideoPriview,SetSipHeader:SetSipHeader,RemoveUnusedAudioElements:RemoveUnusedAudioElements,SwitchOffAndroidSpeaker:SwitchOffAndroidSpeaker,JsObjecSniffer:JsObjecSniffer,ResendRegister:ResendRegister,StartReRegister:StartReRegister,GetVideoSizeObj:GetVideoSizeObj,SetPushNotifications:SetPushNotifications,mRealm:mRealm};return window.webrtcapi_public=webrtcapi_public,{WebRtcIsSupported:WebRtcIsSupported,Start:Start,RegisterEx:RegisterEx,SipUnRegister:SipUnRegister,SipStop:SipStop,SipCall:SipCall,SipHangup:SipHangup,SipAccept:SipAccept,SipIgnore:SipIgnore,SipSendChat:SipSendChat,Forward:Forward,SipTransfer:SipTransfer,SipMuteVideo:SipMuteVideo,SipToggleHoldResume:SipToggleHoldResume,SipToggleMute:SipToggleMute,SipSendDTMF:SipSendDTMF,PresenceSet:PresenceSet,PresenceGet:PresenceGet,SetSipHeader:SetSipHeader,GetRegFailReason:GetRegFailReason,SetVolume:SetVolume,GetVolume:GetVolume,GetAudioDeviceList:GetAudioDeviceList,GetAudioDevice:GetAudioDevice,SetAudioDevice:SetAudioDevice,SwitchOffAndroidSpeaker:SwitchOffAndroidSpeaker,PlaySound:PlaySound,LineToCallID:LineToCallID,CallIDToLine:CallIDToLine,GetUDPServerAddress:GetUDPServerAddress}}();var plhandler=function(){function e(t,i){try{Ot("Start");var r=common.GetTickCount(),a=r-global.laststarttick;if(global.laststarttick>0&&a<250)return common.PutToDebugLog(3,"EVENT, plhandler start already called"),!1;common.HandleCallerID(),global.laststarttick=r,global.pres_set_at_start=!1,global.pingpong=0,global.ever_received_pong=!1,common.GetCustomMenus(),global.nuiswebpage=null,global.phonestarttick<0&&(global.phonestarttick=common.GetTickCount());var s=common.GetAutostart();if(!1===i&&0===s)return common.PutToDebugLog(3,"EVENT, plhandler autologin disabled because autostart is FALSE"),!1;global.colorizelog=common.GetParameterInt("colorizelog",0),global.authenticated_displayed=!1,global.applet_started=!1,jt=t,common.lastengine_working_ok="",common.PutToDebugLog(3,"EVENT, plhandler onstart"),common.PutToDebugLog(1,"STATUS,-1,"+stringres.get("initializing"));var l=common.GetParameter("serveraddress_user");(common.isNull(l)||l.length<2)&&(l=common.GetParameter("serveraddress")),(common.isNull(l)||l.length<2)&&common.PutToDebugLog(2,"EVENT, plhandler start serveraddress not set");var c=!0;if(!1===global.usestorage&&!common.CheckDID(l,!1))if(!common.IsIPAddrress(l)&&l.indexOf(".")>0){var u=common.DomainToIp(l,function(){});if(common.isNull(u)||!(u.length>0)||!0!==common.IsIPAddrress(u))return qt=t,zt=i,void common.DomainToIp(l,function(t){!common.isNull(t)&&t.length>0&&!0===common.IsIPAddrress(t)&&(common.CheckDID(t,!1)||(c=!1)),e(qt,zt)});common.CheckDID(u,!1)||(c=!1)}else c=!1;if(!1===c){var m=[];m.push("E"),m.push("R"),m.push("R"),m.push("O"),m.push("R"),m.push(","),m.push("S"),m.push("e"),m.push("r"),m.push("v"),m.push("e"),m.push("r"),m.push(" "),m.push("n"),m.push("o"),m.push("t"),m.push(" "),m.push("a"),m.push("l"),m.push("l"),m.push("o"),m.push("w"),m.push("e"),m.push("d"),m.push("_");var g=m.join("");return setTimeout(function(){common.PutToDebugLog(1,g+" "+l)},851),!1}Ht=!0,common.isNull(Ft)||clearTimeout(Ft),Ft=setTimeout(function(){Ht=!1},2e3),common.PutToDebugLog(2,"EVENT, plhandler onstart reset useengine"),global.useengine="",global.readcallhistoryforrecents=!0,common.IsWindowsSoftphone()?common.SaveParameter("devicetype",common.DEVICE_WIN_SOFTPHONE()):common.SaveParameter("devicetype",common.DEVICE_WEBPHONE());var d=window.location.href;common.isNull(d)&&(d="");var p=d.indexOf("#");if(p>0&&(d=d.substring(0,p)),p=d.indexOf("?"),p>0&&(d=d.substring(0,p)),common.SaveParameter("wphoneappurl",d),!common.Glsp()){Bt--;var m=[];m.push("E"),m.push("R"),m.push("R"),m.push("O"),m.push("R"),m.push(","),m.push(" "),m.push("U"),m.push("s"),m.push("a"),m.push("g"),m.push("e"),m.push(" "),m.push("o"),m.push("n"),m.push(" "),m.push("t"),m.push("h"),m.push("i"),m.push("s"),m.push(" "),m.push("o"),m.push("p"),m.push("e"),m.push("r"),m.push("a"),m.push("t"),m.push("i"),m.push("n"),m.push("g"),m.push(" "),m.push("s"),m.push("y"),m.push("s"),m.push("t"),m.push("e"),m.push("m"),m.push(" "),m.push("i"),m.push("s"),m.push(" "),m.push("n"),m.push("o"),m.push("t"),m.push(" "),m.push("p"),m.push("e"),m.push("r"),m.push("m"),m.push("i"),m.push("t"),m.push("t"),m.push("e"),m.push("d"),m.push(" "),m.push("b"),m.push("y"),m.push(" "),m.push("t"),m.push("h"),m.push("i"),m.push("s"),m.push(" "),m.push("l"),m.push("i"),m.push("c"),m.push("e"),m.push("n"),m.push("s"),m.push("e"),m.push("."),m.push(" "),m.push("U"),m.push("p"),m.push("g"),m.push("r"),m.push("a"),m.push("d"),m.push("e"),m.push(" "),m.push("t"),m.push("o"),m.push(" "),m.push("t"),m.push("h"),m.push("e"),m.push(" "),m.push("A"),m.push("d"),m.push("v"),m.push("a"),m.push("n"),m.push("c"),m.push("e"),m.push("d"),m.push(" "),m.push("v"),m.push("e"),m.push("r"),m.push("s"),m.push("i"),m.push("o"),m.push("n"),m.push(" "),m.push("t"),m.push("o"),m.push(" "),m.push("e"),m.push("n"),m.push("a"),m.push("b"),m.push("l"),m.push("e"),m.push(" "),m.push("t"),m.push("h"),m.push("e"),m.push(" "),m.push("w"),m.push("e"),m.push("b"),m.push("p"),m.push("h"),m.push("o"),m.push("n"),m.push("e"),m.push(" "),m.push("o"),m.push("n"),m.push(" "),m.push("s"),m.push("m"),m.push("a"),m.push("r"),m.push("t"),m.push("p"),m.push("h"),m.push("o"),m.push("n"),m.push("e"),m.push("s"),m.push(" "),m.push("a"),m.push("n"),m.push("d"),m.push(" "),m.push("t"),m.push("a"),m.push("b"),m.push("l"),m.push("e"),m.push("t"),m.push("s"),m.push(".");var h=[];h.push("E"),h.push("R"),h.push("R"),h.push("O"),h.push("R");var f=h.join(""),g=m.join("");global.dontclosecurrpopup=!0,setTimeout(function(){global.dontclosecurrpopup=!1},3e4),setTimeout(function(){common.PutToDebugLog(1,g)},2e3),setTimeout(function(){common.AlertDialog(f,g,function(){global.dontclosecurrpopup=!1})},759),$t+=10}if(Bt<10)return;return common.IsWindowsSoftphone()?(common.PutToDebugLog(3,"EVENT, plhandler start softphone"),n()):(common.PutToDebugLog(3,"EVENT, plhandler start webphone"),o()),!0}catch(b){common.PutToDebugLogException(2,"plhandler: Start",b)}return!1}function t(){try{if(!common.IsMizuServer())return void(global.isfirstwsu=!1);if(common.IsLocalServer()){var e=common.GetWebrtcSrvAddr();common.isNull(e)&&(e=""),e=e.toLowerCase(),e=e.replace("ws://",""),e=e.replace("wss://","");var o=e.indexOf("/");if(o>0&&(e=e.substring(0,o)),e.length>0&&!common.IsLanIP(e))return common.PutToDebugLog(2,"ERROR, "+stringres.get("webrtc_local_sipserver")+" (4)"),void((!0===global.usestorage||common.Strl(60))&&alert("ERROR, "+stringres.get("webrtc_local_sipserver")+"\n\n"+stringres.get("all_demo_msg")+" (5)"))}var n=common.GetSipusername(),i=common.GetParameter("password");if("true"===common.GetConfig("usingmizuserver")||common.IsMizuWebRTCGateway()||common.IsMizuWebRTCEmbeddedServer()||common.IsMizuServer()){var r=common.GetParameter("serveraddress_user");(common.isNull(r)||r.length<2)&&(r=common.GetParameter("serveraddress"));var a=common.GetParameter("mainconfigs"),s=n+":"+i+":"+r+":"+common.GetWebrtcSrvAddr();if((common.isNull(a)||a.length<1||a!==s)&&(Kt=!0),n.length<1&&i.length<1&&Xt<25)return Xt++,void setTimeout(function(){t()},80);if((common.isNull(n)||n.length<1)&&common.PutToDebugLog(2,"ERROR, will NOT send wsuser, because username is not set: "+n),(common.isNull(i)||i.length<1)&&common.PutToDebugLog(2,"EVENT, CallWsuser password is not set: "+i),Jt=common.GetWsuserUrl(n,i),Jt.length<3)return common.PutToDebugLog(2,"ERROR, plhandler CallWsuser wsuser not needed"),global.isfirstwsu=!1,Kt=!1,void(global.wsuser_succeded=!0);if(global.isfirstwsu)if(common.isNull(a)||a.length<1||a!==s)Yt=!0;else{var l=common.GetParameter("wsusers"),c=l.split(",");if(!common.isNull(c)&&c.length>0&&n.length>0)for(var u=0;u<c.length;u++)if(!common.isNull(c[u])&&c[u]===n){global.isfirstwsu=!1;break}}Xt=0,common.isNull(n)||n.length<2||common.isNull(i)||i.length<2?common.PutToDebugLog(2,"WARNING, common CallWsuserKeepAlive invalid username ("+n+") or invalid password ("+i+")"):common.UriParser(Jt,"","","","","webrtccreateuser"),setTimeout(function(){global.webrtcavailable>0&&!1===global.wsuser_succeded&&(n=common.GetSipusername(),i=common.GetParameter("password"),Jt=common.GetWsuserUrl(n,i),common.UriParser(Jt,"","","","","webrtccreateuser"))},4500)}}catch(m){common.PutToDebugLogException(2,"plhandler: CallWsuser",m)}}function o(){try{common.isNull(Qt)||clearInterval(Qt),Qt=null,Qt=setInterval(function(){++Zt>100&&(common.PutToDebugLog(2,"WARNING, EngineSelect timeout"),clearInterval(Qt),common.PutToDebugLog(2,"WARNING, WaitForEngineSelect not ready, but start anyway"),common_public.ChooseEngineLogic(function(){n()},!0));var e=common.GetSipusername(),t=!1;if(global.isfirstwsu&&common.CanIUseWebRTC()&&Kt){if(eo<10){var o=common.GetParameter("wsusers"),i=o.split(",");if(!common.isNull(i)&&i.length>0)for(var r=0;r<i.length;r++)if(!common.isNull(i[r])&&e.length>0&&i[r]===e){eo=common.GetTickCount();break}}eo>10&&common.GetTickCount()-eo>2500&&(common.PutToDebugLog(4,"EVENT, wsuser can be sent (first time)"),t=!0)}else common.PutToDebugLog(4,"EVENT, wsuser can be sent"),t=!0;if(!1!==t||!common.CanIUseWebRTC()){var a=common.EngineSelect(1);a<1||global.webrtcavailable<0?(a<1&&common.PutToDebugLog(2,"EVENT, waiting for EngineSelect ("+Zt+")"),global.webrtcavailable<0&&common.PutToDebugLog(2,"EVENT, waiting for WebRTC to load ("+Zt+")")):(clearInterval(Qt),common.PutToDebugLog(2,"EVENT, selected engine("+global.engineselectstage+"): "+common.TestEngineToString(common.GetSelectedEngine(),!1)),common.PutToDebugLog(2,"EVENT, recommended engine("+global.engineselectstage+"): "+common.TestEngineToString(common.GetRecommendedEngine(),!1)),setTimeout(function(){common_public.ChooseEngineLogic(function(){n()},!0)},1e3))}},200)}catch(e){common.PutToDebugLogException(2,"plhandler: WaitForEngineSelect",e)}}function n(){try{common.IsCurrentEngineWorking(jt),common.CheckEngineFirstStart(jt),common_public.GatewayFailower(-1,"startUp"),1==common.IsSDK()?(common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp call HandleSettingsSDK",!1,""),i(function(e){common.PutToDebugLogSpecial(1,"EVENT, plhandler StartUp HandleSettingsSDK FINISHED: "+e,!1,"")})):(common.PutToDebugLog(3,"EVENT, plhandler StartUp call StartEngine"),r())}catch(e){common.PutToDebugLogException(2,"plhandler: StartUp",e)}return!1}function i(e){try{if(Wt)return common.PutToDebugLog(3,"EVENT, HandleSettingsSDK call StartEngine"),common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK call StartEngine",!1,""),r(),void e("Already called");if(!e||"function"!=typeof e)return void common.PutToDebugLogSpecial(1,"ERROR, HandleSettingsSDK call StartEngine",!0,"");common.PutToDebugLogSpecial(1,"EVENT, plhandler HandleSettingsSDK called",!1,""),common.PutToDebugLog(3,"EVENT, HandleSettingsSDK called");var t=webphone_api.parameters.serveraddress;!common.isNull(t)&&t.length>1&&(common.SaveParameter("serveraddress",t,!0),common.SaveParameter("serveraddress_user",t,!0),common.SaveParameter("serveraddress_orig",t,!0),common.SaveParameter("iswebrtcuppersrvfromuser","true")),Vt.length<1&&(Vt=common.GetSettFilenameSDK()),common.PutToDebugLogSpecial(1,"EVENT, HandleSettingsSDK settfilename: "+Vt,!1,""),common.PutToDebugLog(3,"EVENT, HandleSettingsSDK settfilename: "+Vt),common.ReadSettingsFile(Vt,function(t){common.PutToDebugLog(5,"EVENT, plhandler GetSettings callback"),t||common.PutToDebugLog(5,"EVENT, plhandler GetSettings ReadSettings no content");var n=webphone_api.parameters.serveraddress;!common.isNull(n)&&n.length>1&&(common.SaveParameter("serveraddress",n,!0),common.SaveParameter("serveraddress_user",n,!0),common.SaveParameter("serveraddress_orig",n,!0)),common.isNull(Mt)||(clearTimeout(Mt),Mt=null),common.SaveSettingsFile(Vt,function(t){if(common.PutToDebugLog(3,"EVENT, plhandler: HandleSettingsSDK settings SAVED"),!Wt){Wt=!0;var n=common.GetParameter2("register");(common.isNull(n)||n.length<1)&&(n="0");var i=common.StrToInt(n);if(0===common.GetAutostart())return common.PutToDebugLog(2,"EVENT, autostart is disabled, Start must be called manually"),void e("autostart is disabled");i<1?o():common.GetSipusername().length>0&&common.GetParameter("password").length>0&&o(),common.HandleScurlSetparameters(),common.ParseSipAccounts(),e("finished normally")}Wt=!0})})}catch(n){common.PutToDebugLogSpecial(1,"ERROR, plhandler HandleSettingsSDK",!0,n),common.PutToDebugLogException(2,"plhandler: HandleSettingsSDK",n),e("ERROR,exception")}}function r(){try{if(to)return;if(!1===oo&&!0===common.IsSDK()&&common.ReadCallhistoryFile(function(e){e||common.PutToDebugLog(2,"ERROR, plhandler: Load call history failed")}),$t>190)return;!1===common.IsWindowsSoftphone()&&(common.PutToDebugLog(4,"EVENT, plhandler StartEngine called"),common.PutToDebugLog(2,"EVENT, starting engine...")),common.HideSettings("voicemail","","voicemail",!0)&&common.SaveParameter("voicemail","0"),(common.HideSettings("chat","","chat",!0)||3==common.GetParameterInt("chatsms",0))&&(common.SaveParameter("haschat","false"),global.haschat=0);var e=common.GetParameter("serveraddress_user"),t=common.GetSipusername();(common.isNull(t)||t.length<1)&&(t=common.GetSipusername());var n=common.GetParameter("password"),i=common.GetParameter("registerinterval");if(!common.isNull(t)&&t.length>0&&!common.isNull(n)&&n.length>0){common.isNull(e)&&(e=""),(common.isNull(i)||0==common.IsNumber(i))&&(i="3600");var r=common.StrToInt(i),a=!1;if(global.sipaccounts.length<1)a=!0;else for(var l=0;l<global.sipaccounts.length;l++){var c=global.sipaccounts[l];if(!common.isNull(c)&&(c.username===t&&c.password===n&&c.serveraddress===e)){a=c.ismain;break}}var u=common.GetParameter("username"),m=common.GetParameter("displayname"),g=common.GetParameter("proxyaddress"),d=common.GetParameter("realm");common.AddOneAcc(e,t,n,r,!0,a,!0,u,m,g,d)}to=!0,setTimeout(function(){to=!1},2e3),jt=null,common.IsWindowsSoftphone()?fe("platform","desktop"):common.GetParameter("devicetype")===common.DEVICE_WEBPHONE()&&fe("platform","web");var p=common.GetParameter("messagepopup");if(!common.isNull(p)&&p.length>1&&setTimeout(function(){(!0===common.IsSDK()||j$(".ui-page-active .ui-popup-active").length<1)&&(common.ShowToast(p),common.SaveParameter("messagepopup",""))},4500),common.IsWindowsSoftphone())return common.PutToDebugLog(2,"EVENT, start engine: windows softphone - NS engine"),wpa.webphone.StartWin(),!0;var h=common.GetSelectedEngineName(),f=common.GetRecommendedEngineName();if(common.isNull(h)||h.length<1)return common.PutToDebugLog(2,"ERROR, plhandler StartUp no selected engine available"),!1;if(!0===global.isfirststart||common.isNull(global.useengine)||global.useengine.length<2)common.PutToDebugLog(2,"EVENT, StartEngine set useengine: "+h),global.useengine=h,global.isfirststart=!1;else{if(common.isNull(f)||f.length<1){var b=common.GetEngine(h);return b.failed=1,common.SetEngine(h,b),common.PutToDebugLog(4,"EVENT, WaitForEngineSelect called_3"),common.EngineSelect(1),o(),!1}common.PutToDebugLog(2,"EVENT, StartEngine recommended set useengine: "+f),global.useengine=f}if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE()&&"flash"===common.getuseengine()){var v=window.location.protocol;!common.isNull(v)&&v.length>0&&v.toLowerCase().indexOf("file")>=0&&("0"===common.GetParameter2("enginepriority_java")&&"0"===common.GetParameter2("enginepriority_webrtc")&&"0"===common.GetParameter2("enginepriority_ns")||"flash"===common.getuseengine())&&(common.PutToDebugLog(1,"ERROR,"+stringres.get("err_flash_local")),alert(stringres.get("err_flash_local")))}try{webphone_api.onAppStateChangeCb("started")}catch(T){common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(started) callback",T)}try{webphone_api.onStartCb()}catch(T){common.PutToDebugLogException(2,"There is an error in onStart() callback",T)}if(common.CallScriptingUrl(webphone_api.parameters.scurl_onstart,"onStart","","","",""),!0===common.UseCustomAutoprov(!1)&&common.GetCustomAutoprov(function(e){common.RecAutoprovCustom(e)}),!1===common.Loa()){
var _=[];_.push("E"),_.push("R"),_.push("R"),_.push("O"),_.push("R"),_.push(","),_.push(" "),_.push("o"),_.push("n"),_.push("l"),_.push("y"),_.push(" "),_.push("a"),_.push("n"),_.push("d"),_.push("r"),_.push("o"),_.push("i"),_.push("d");var E=_.join("");setTimeout(function(){common.PutToDebugLog(2,E)},1214),setTimeout(function(){s()},6e4)}else s();ht()}catch(T){common.PutToDebugLogException(2,"plhandler: StartEngine",T)}}function a(e){try{(common.isNull(e)||e.length<1)&&(common.PutToDebugLog(2,"ERROR, ParseReceivedParameters invalid parameters: "+e),s()),e=common.Trim(e),e.indexOf("error")>=0&&(common.PutToDebugLog(2,"ERROR, ParseReceivedParameters error received: "+e),s());var t=e.split(",");if(!common.isNull(t)&&t.length>0)for(var o=0;o<t.length;o++)if(!(common.isNull(t[o])||t[o].length<3||t[o].indexOf("=")<1)){var n=common.Trim(t[o].substring(0,t[o].indexOf("="))),i=common.Trim(t[o].substring(t[o].indexOf("=")+1,t[o].length));!common.isNull(n)&&n.length>0&&!common.isNull(i)&&(n=n.toLowerCase(),common.SaveParameter(n,i))}}catch(r){common.PutToDebugLogException(2,"plhandler: ParseReceivedParameters",r)}common.PutToDebugLog(2,"EVENT, scurl_setparameters STOP"),Oe(),setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Start scurl_setparameters START"),webphone_api.start()},1500)}function s(){l()}function l(){try{if(global.startendelayed_wascalled=!0,global.flagnsreconnect=!0,global.phonestarted>1&&!1===global.enstarteddisplayed){global.enstarteddisplayed=!0;var e="",t=common.getuseengine();e=t===global.ENGINE_WEBPHONE?"jv":t===global.ENGINE_SERVICE?"ns":t===global.ENGINE_WEBRTC?"rtc":t,!1===common.IsWindowsSoftphone()&&common.PutToDebugLog(1,"EVENT,"+stringres.get("status_enginestarted")+" ("+e+")")}if(common.getuseengine()===global.ENGINE_SERVICE||(common.getuseengine(),global.ENGINE_WEBPHONE),common.getuseengine()===global.ENGINE_WEBRTC){var o=1e3;1!==common.GetParameterInt("autoaction",0)&&3!==common.GetParameterInt("autoaction",0)||(o=1e4),g(o)}common.PutToDebugLog(2,"EVENT, enginepriority_java: "+common.GetCfgPriority("java")),common.PutToDebugLog(2,"EVENT, enginepriority_webrtc: "+common.GetCfgPriority("webrtc")),common.PutToDebugLog(2,"EVENT, enginepriority_ns: "+common.GetCfgPriority("ns")),common.PutToDebugLog(2,"EVENT, enginepriority_flash: "+common.GetCfgPriority("flash")),common.PutToDebugLog(2,"EVENT, enginepriority_app: "+common.GetCfgPriority("app")),common.PutToDebugLog(2,"EVENT, enginepriority_p2p: "+common.GetCfgPriority("p2p")),common.PutToDebugLog(2,"EVENT, enginepriority_accessnum: "+common.GetCfgPriority("accessnum")),common.PutToDebugLog(2,"EVENT, enginepriority_nativedial: "+common.GetCfgPriority("nativedial")),common.SaveParameter("lastsessionsuccess","1");var e="",t=common.getuseengine();if(e=t===global.ENGINE_WEBPHONE?"jv":t===global.ENGINE_SERVICE?"ns":t===global.ENGINE_WEBRTC?"rtc":t,!1===common.IsWindowsSoftphone()&&(common.PutToDebugLog(1,"STATUS,-1,"+stringres.get("status_startingengine")+" ("+e+")"),common.PutToDebugLog(3,"EVENT, starting useengine: "+common.getuseengine())),common.Glv()<=0&&"Chrome"===common.GetBrowser()){var n=[];n.push("E"),n.push("R"),n.push("R"),n.push("O"),n.push("R"),n.push(","),n.push(" "),n.push("T"),n.push("h"),n.push("e"),n.push(" "),n.push("B"),n.push("a"),n.push("s"),n.push("i"),n.push("c"),n.push(" "),n.push("v"),n.push("e"),n.push("r"),n.push("s"),n.push("i"),n.push("o"),n.push("n"),n.push(" "),n.push("o"),n.push("f"),n.push(" "),n.push("W"),n.push("e"),n.push("b"),n.push("p"),n.push("h"),n.push("o"),n.push("n"),n.push("e"),n.push(" "),n.push("d"),n.push("o"),n.push("e"),n.push("s"),n.push(" "),n.push("n"),n.push("o"),n.push("t"),n.push(" "),n.push("s"),n.push("u"),n.push("p"),n.push("p"),n.push("o"),n.push("r"),n.push("t"),n.push(" "),n.push("C"),n.push("h"),n.push("r"),n.push("o"),n.push("m"),n.push("e"),n.push(" "),n.push("b"),n.push("r"),n.push("o"),n.push("w"),n.push("s"),n.push("e"),n.push("r");var i=n.join("");return setTimeout(function(){common.PutToDebugLog(1,i)},1500),void setTimeout(function(){common.AlertDialog("",i)},2500)}var r=common.GetEngine(global.useengine);global.useengineclicked_cache=r.clicked,r.clicked=1,common.SetEngine(global.useengine,r),common.AutodetectDirectWebrtc(),global.lastconfroom="";var a=common.GetParameter("username"),s=common.GetParameter("sipusername"),l="";if(a.indexOf("@")>0?l=a:s.indexOf("@")>0&&(l=s),l.length>0&&common.GetParameterInt("allowsipuriasusername",0)>0){l=l.substring(s.indexOf("@")+1);var d=common.GetParameter2("serveraddress");(common.isNull(d)||d.length<1)&&(d=common.GetParameter2("serveraddress_user")),!common.isNull(d)&&d.length<2&&"YOURSIPDOMAIN.COM"!==d&&"YOURSIPSERVER.COM"!==d&&"SIPSERVER"!==d&&"VOIPSERVER"!==d&&"SERVERADDRESS"!==d&&(common.SaveParameter("serveraddress",l),common.SaveParameter("serveraddress_user",l))}var p=common.GetParameter2("serveraddress");if((common.isNull(p)||p.length<2||"YOURSIPDOMAIN.COM"===p||"YOURSIPSERVER.COM"===p||"SIPSERVER"===p||"VOIPSERVER"===p||"SERVERADDRESS"===p)&&(common.SaveParameter("serveraddress",""),p=common.GetParameter2("serveraddress_user"),common.isNull(p)||p.length<2||"YOURSIPDOMAIN.COM"===p||"YOURSIPSERVER.COM"===p||"SIPSERVER"===p||"VOIPSERVER"===p||"SERVERADDRESS"===p))return common.PutToDebugLog(1,"ERROR,"+stringres.get("error_noserver")),common.PutToDebugLog(2,"ERROR,"+stringres.get("error_noserver")+"; srv: "+common.GetParameter("serveraddress")+"; srv_user: "+common.GetParameter("serveraddress_user")),common.AlertDialog("ERROR","ERROR,"+stringres.get("error_noserver")),"undefined"!=typeof global.worktimer&&null!==global.worktimer&&clearTimeout(global.worktimer),void(global.worktimer=null);var h=common.GetSipusername(),f=common.GetParameter2("password");"USERNAME"===h&&"PASSWORD"===f&&("USERNAME"===common.GetParameter("username")&&common.SaveParameter("username",""),"USERNAME"===common.GetParameter("sipusername")&&common.SaveParameter("sipusername",""),common.SaveParameter("password",""));var b=common.GetParameter("lastwpapixxx"),v=common.GetParameter("serveraddress_user");(common.isNull(v)||v.length<2)&&(v=common.GetParameter("serveraddress")),common.isNull(v)&&(v=""),v=v.toLowerCase();var _=common.GetWebrtcSrvAddr();common.isNull(_)&&(_=""),_=_.toLowerCase();var E=common.GetProxyaddress(),T=common.GetParameter("transport"),P=common.GetParameter("realm");common.isNull(P)&&(P="");var S=v+":"+_+":"+P+":"+E+":"+T;if(!common.isNull(b)&&b.length>0&&!common.isNull(S)&&S.length>0&&b!==S&&(common.PutToDebugLog(2,"WARNING, DelSettings on start because main configs changed"),common.PutToDebugLog(2,"WARNING, DelSettings old config: "+b),common.PutToDebugLog(2,"WARNING, DelSettings new config: "+S),Ze(1,!1)),common.isNull(S)&&(S=""),common.SaveParameter("lastwpapixxx",S),common.StartFCM(common.getuseengine()),"java"===common.getuseengine()){common.ResetWsapisocket("plhandler start java");var N=common.StrToInt(common.GetParameter2("enginepriority_java")),w=common.StrToInt(common.GetParameter2("enginepriority_webrtc")),I=common.StrToInt(common.GetParameter2("enginepriority_ns")),C=common.StrToInt(common.GetParameter2("enginepriority_flash")),R=common.StrToInt(common.GetParameter2("enginepriority_app")),y=common.StrToInt(common.GetParameter2("enginepriority_p2p")),L=common.StrToInt(common.GetParameter2("enginepriority_accessnum")),D=common.StrToInt(common.GetParameter2("enginepriority_nativedial"));return(5===N||N>0&&w<1&&I<1&&C<1&&R<1&&y<1&&L<1&&D<1)&&0===common.IsJavaInstalled()&&common.EngineForcedInstall("java"),common.IsCurrentEngineWorking(jt),common.PutToDebugLog(2,"EVENT, start engine: java"),global.dispregfailed<1&&(global.dispregfailed=1),m(),wpa.webphone.Start()}if("ns"===common.getuseengine())return 5===common.GetParameterInt("enginepriority_ns",2)&&common.IsServiceInstalled(function(e){!1===e&&(common.PutToDebugLog(2,"EVENT, plhandler: StartEngineDelayed, service upgrade: "+common.GetMinServiceVersion().toString()),common.EngineForcedInstall("ns"))},!0),void common.IsServiceInstalled(function(e){if(!0===e){common.PutToDebugLog(2,"EVENT, start engine: service");var t=!1,o=common.GetParameterInt("lnsengine",-1);!1===global.usestorage&&!1===common.Strl(60)&&0===o&&(t=!0,common.SaveParameter("lnsengine","1"));var n=6e3;t&&(common.PutToDebugLog(2,"EVENT, Force NS engine upgrade because release version changed"),common.EngineForcedInstall("ns",stringres.get("service_update")),global.nsupdatepending=!0,n=18e4),setTimeout(function(){common.IsServiceUpToDate()},n),global.dispregfailed<1&&(global.dispregfailed=1),m(),wpa.webphone.StartService()}else common.isNull(global.worktimer)||clearTimeout(global.worktimer),common.PutToDebugLog(2,"EVENT, start engine: service; NOT starting because it is not installed")},!0);if("webrtc"===common.getuseengine()){var G=0;G=common.GetParameterInt("autoprovisioning",1);var x=be("serveraddress_user");if(common.isNull(x)&&(x=""),0===G||x.length<1||1===G&&x.indexOf(".")>0)c();else{var O=common.GetParameterInt("lastautoprov",0);O<1?common.GetAutoprovisioning("",function(e){common.ParseAutoprovisioning(e),c()}):(c(),common.GetAutoprovisioning("",function(e){common.ParseAutoprovisioning(e)}))}return}if("flash"===common.getuseengine()){var G=0;G=common.GetParameterInt("autoprovisioning",1);var x=be("serveraddress_user");if(common.isNull(x)&&(x=""),0===G||x.length<1||1===G&&x.indexOf(".")>0)u();else{var O=common.GetParameterInt("lastautoprov",0);O<1?common.GetAutoprovisioning("",function(e){common.ParseAutoprovisioning(e),u()}):(u(),common.GetAutoprovisioning("",function(e){common.ParseAutoprovisioning(e)}))}return}if("app"===common.getuseengine()){var A=common.GetParameterInt("appengine_startat",2);1===A||2===A&&!1===common.IsSDK()?common.StartAppEngine(!0,"EVENT, start engine: app HandleProtocol, open native app"):(common.PutToDebugLog(2,"EVENT, start engine: skip APP engine start, appengine_startat: "+A+"; isSDK: "+common.IsSDK()),common.PutToDebugLog(1,"EVENT, Ready."))}else common.PutToDebugLog(2,"ERROR, start engine: invalid engine: "+common.getuseengine());setTimeout(function(){global.startendelayed_wascalled=!1},12e3)}catch(k){common.PutToDebugLogException(2,"plhandler: StartEngineDelayedEx",k)}}function c(){try{if(io<0&&(io=common.GetTickCount()),!1===global.decideusuk_finished&&(common.isNull(no)||clearTimeout(no),no=null,no=setTimeout(function(){c()},150)),common.isNull(no)||clearTimeout(no),no=null,io>0&&common.GetTickCount()-io>6500&&!0===common.GetParameterBool("firststart_webrtc",!0)&&!0===common.CanIUseService()){common.PutToDebugLog(2,"WARNING, StartEngineWebRTC Failover to NS engine, because no response received from Websocket wsload"),common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,common.ResetEngineClicked();var e=GetEngine("ns");e.clicked=2,common.SetEngine("ns",e),common.EngineSelect(1),common.PutToDebugLog(2,"WARNING, plhandler: offer ns engine because webrtc not received"),common.IsServiceInstalled(function(e){!1===e?common.EngineForcedInstall("ns",stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()}):webphone_api.startInner()},!0)}io=-1,common.ResetWsapisocket("plhandler start webrtc");var o=common.GetParameter("password");(common.isNull(o)||o.length<1)&&!1===common.NeedRegister()||t(),!0===common.UseTLSReload()&&common.TLSReload(),common.Ch(),common.PutToDebugLog(2,"EVENT, start engine: webrtc"),common.CheckEngineFirstStart(jt),common_public.GatewayFailower(-1,"starten");var n=common.GetWebrtcSrvAddr();if(2===common.GetConfigInt("usemizuwebrtcgateway",1)&&(n=""),(common.isNull(n)||n.length<2)&&(n=common.GetWp()),n.indexOf("mfstwebsock")<0){var i=common.StrToInt(common.GetParameter2("enginepriority_java")),r=common.StrToInt(common.GetParameter2("enginepriority_webrtc")),a=common.StrToInt(common.GetParameter2("enginepriority_ns")),s=common.StrToInt(common.GetParameter2("enginepriority_flash")),l=common.StrToInt(common.GetParameter2("enginepriority_app")),u=common.StrToInt(common.GetParameter2("enginepriority_p2p")),g=common.StrToInt(common.GetParameter2("enginepriority_accessnum")),d=common.StrToInt(common.GetParameter2("enginepriority_nativedial"));i<3&&r<3&&a<3&&s<3&&l<3&&u<3&&g<3&&d<3&&(r=3,common.SaveParameter("enginepriority_webrtc",r),common.PutToDebugLog(2,"EVENT,WebRtc engine priority set to higher, because not Mgateway: "+r))}return"Android"===common.GetOs()&&3===common.GetParameterInt("androidspeaker",1)&&setTimeout(function(){webrtcapi_public.SwitchOffAndroidSpeaker()},500),global.dispregfailed<1&&(global.dispregfailed=1),m(),wpa.webrtcapi.Start()}catch(p){common.PutToDebugLogException(2,"plhandler: StartEngineWebRTC",p)}}function u(){try{return common.PutToDebugLog(2,"EVENT, start engine: flash"),global.dispregfailed<1&&(global.dispregfailed=1),m(),wpa.flashapi.Start()}catch(e){common.PutToDebugLogException(2,"plhandler: StartEngineFlash",e)}}function m(){try{var e=common.GetAutostart();if(!0===common.IsSDK()||0!==e)return!1;setTimeout(function(){if("page_settings"===j$.mobile.activePage.attr("id")){common.PutToDebugLog(2,"EVENT, plhandler LoginSkin exec");var e=common.GetSipusername(),t=common.GetParameter("password");return!common.isNull(e)&&e.length>0&&!common.isNull(t)&&t.length>0?(global.laststarttick=common.GetTickCount()+100,void settings_public.SaveSettings()):void 0}},600)}catch(t){common.PutToDebugLogException(2,"plhandler: LoginSkin",t)}}function g(e,t){try{if(ro>0&&common.GetTickCount()-ro<3e3)return;ro=common.GetTickCount(),(common.isNull(e)||!1===common.IsNumber(e)||e<0)&&(e=2e3);var o=200;if(common.getuseengine()===global.ENGINE_WEBRTC&&(o=150),common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu called delay: "+e+"; delayaddition: "+o),!0===t)return setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e),setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+150),setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+300),void common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu return forced");(common.isNull(global.audio_rec_device_list)||global.audio_rec_device_list.length<1)&&setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist mic"),webphone_api.getdevicelist(0,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 1")}),webphone_api.getdevice(0,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec mic 2")})},e+o),(common.isNull(global.audio_play_device_list)||global.audio_play_device_list.length<1)&&setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist play"),webphone_api.getdevicelist(1,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 1")}),webphone_api.getdevice(1,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec play 2")})},e+2*o),(common.isNull(global.audio_ring_device_list)||global.audio_ring_device_list.length<1)&&setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist ring"),webphone_api.getdevicelist(2,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 1")}),webphone_api.getdevice(2,function(e){common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu rec ring 2")})},e+3*o),common.getuseengine()===global.ENGINE_WEBRTC&&(common.isNull(global.video_rec_device_list)||global.video_rec_device_list.length<1)&&setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist video"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+4*o),setTimeout(function(){if(common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu START checking audio_rec_device_list: "+global.audio_rec_device_list+"; audio_play_device_list: "+global.audio_play_device_list),!common.isNull(global.audio_rec_device_list)&&global.audio_rec_device_list.length>0&&!common.isNull(global.audio_play_device_list)&&global.audio_play_device_list.length>0){var t=common.GetTickCount()-ro;common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on first try after delay: "+t),global.audio_devices_loaded=!0}else setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 0"),webphone_api.getdevicelist(0,function(e){}),webphone_api.getdevice(0,function(e){})},e+2e4+o),setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 1"),webphone_api.getdevicelist(1,function(e){}),webphone_api.getdevice(1,function(e){})},e+2e4+2*o),setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 2"),webphone_api.getdevicelist(2,function(e){}),webphone_api.getdevice(2,function(e){})},e+2e4+3*o),common.getuseengine()===global.ENGINE_WEBRTC&&setTimeout(function(){common.PutToDebugLog(2,"EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 3"),webphone_api.getdevicelist(3,function(e){}),webphone_api.getdevice(3,function(e){})},e+2e4+4*o),setTimeout(function(){if(!common.isNull(global.audio_rec_device_list)&&global.audio_rec_device_list.length>0&&!common.isNull(global.audio_play_device_list)&&global.audio_play_device_list.length>0){var e=common.GetTickCount()-ro;common.PutToDebugLog(5,"EVENT, GetAudioDevicesForMenu READY on second try after delay: "+e),global.audio_devices_loaded=!0}},e+4*o)},e+3*o+500)}catch(n){common.PutToDebugLogException(2,"plhandler: GetAudioDevicesForMenu",n)}}function d(t){try{Ot("Register");var o=common.GetParameterInt("register",1);if(webphone_api.parameters.register=2,common.SaveParameter("register","2"),common.PutToDebugLog(2,"EVENT, user, register (API_Register) called"),Ht)return void common.PutToDebugLog(3,"EVENT, plhandler register, Start already called");(!0===common.IsConfigChanged()&&!0===webphone_api.isregistered()||!0===global.pres_unreg_called||0===o)&&e(t)}catch(n){common.PutToDebugLogException(2,"plhandler: Register",n)}}function p(e){try{Ot("RegisterEx");var t=25;if(common.Glv()<2&&(t=13),common.isNull(e)||e.length<4)return void common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(e=e.toString(),e=common.ReplaceAll(e," ",""),common.isNull(e)||e.length<4)return void common.PutToDebugLog(2,"ERROR, plhandler RegisterEx no acocunts passed: "+e);if(t<21){var o=[];o.push("E"),o.push("R"),o.push("R"),o.push("O"),o.push("R"),o.push(","),o.push("R"),o.push("e"),o.push("g"),o.push("i"),o.push("s"),o.push("t"),o.push("e"),o.push("r"),o.push("E"),o.push("x"),o.push(" "),o.push("n"),o.push("o"),o.push("t"),o.push(" "),o.push("a"),o.push("l"),o.push("l"),o.push("o"),o.push("w"),o.push("e"),o.push("d"),o.push(" "),o.push("b"),o.push("y"),o.push(" "),o.push("l"),o.push("i"),o.push("c"),o.push("e"),o.push("n"),o.push("s"),o.push("e");var n=o.join("");return void setTimeout(function(){common.PutToDebugLog(1,n)},851)}common.SaveParameter("extraregisteraccounts",e),common.PutToDebugLog(2,"EVENT, plhandler RegisterEx: "+e),common.getuseengine()===global.ENGINE_WEBRTC&&wpa.webrtcapi.RegisterEx(e),common.getuseengine()===global.ENGINE_FLASH&&common.PutToDebugLog(2,"ERROR, RegisterEx is not supported by flash engine"),common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_RegisterEx",null,e),common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.RegisterEx(e)}catch(i){common.PutToDebugLogException(2,"plhandler: RegisterEx",i)}}function h(e,t){try{if(Ot("CheckPresence"),common.isNull(e)||e.length<1)return"";if(global.phonestarted<2)return void At("CheckPresence",[e,t]);if(common.PutToDebugLog(2,"EVENT, user, checkpresence (API_CheckPresence), userlist: "+e),t&&"function"==typeof t&&(common.isNull(global.checkpres_callback)&&(global.checkpres_callback=[]),global.checkpres_callback.push(t)),common.PresenceGet2(e),!common.isNull(global.presenceHM)){var o={5:"online",4:"DND",3:"pending",2:"idle",1:"invisible",0:"offline","-1":"not exists"},n="";for(var i in global.presenceHM)common.isNull(i)||i.length<1||common.isNull(global.presenceHM.num)||(n.length>1&&(n+=";"),n=n+i+","+o[n.num[common.PRES_STATUS]]);return common.isNull(n)&&(n=""),n}}catch(r){common.PutToDebugLogException(2,"plhandler: CheckPresence",r)}return""}function f(e){if(Ot("SetPresenceStatus"),global.phonestarted<2)return void At("SetPresenceStatus",[e]);common.PutToDebugLog(2,"EVENT, user, setpresencestatus (API_SetPresenceStatus), status: "+e),common.PresenceSet2(e)}function b(e){Ot("CheckBLF");try{if(common.isNull(e)||e.length<1)return common.PutToDebugLog(2,"ERROR, plhandler checkblf empty userkist"),!1;if(global.phonestarted<2)return void At("CheckBLF",[e]);if(common.PutToDebugLog(2,"EVENT, plhandler API_CheckBLF: "+e),common.getuseengine()===global.ENGINE_WEBRTC)return common.PutToDebugLog(2,"WARNING, BLF is not yet supported on WebRTC"),!1;if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"WARNING, BLF is not yet supported on flash"),!1;if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_CheckBLF",null,e),!0;if(common.getuseengine()===global.ENGINE_WEBPHONE)return wpa.webphone.CheckBLF(e)}catch(t){common.PutToDebugLogException(2,"plhandler: CheckBLF",t)}return!1}function v(e){Ot("GetVersionNS");try{if(!e||"function"!=typeof e)return common.PutToDebugLog(2,"ERROR, plhandler GetVersionNS: no callback function specified"),"ERROR, no callback function specified";if(common.PutToDebugLog(2,"EVENT, plhandler getversionns"),common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_GetExeVersion",function(t){common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=common.Trim(t),e(t)}),common.getuseengine()===global.ENGINE_WEBPHONE){var t=wpa.webphone.GetVersionNS();t=t.toString(),t=t.replace("OK:",""),t=common.Trim(t),e(t)}}catch(o){common.PutToDebugLogException(2,"plhandler: GetVersionNS",o)}}function _(e){Ot("GetVersionNSNum");try{if(!e||"function"!=typeof e)return common.PutToDebugLog(2,"ERROR, plhandler GetVersionNSNum: no callback function specified"),"ERROR, no callback function specified";if(common.PutToDebugLog(2,"EVENT, plhandler getversionnsnum"),common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_GetExeVersionNumber",function(t){common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=common.Trim(t),e(t)}),common.getuseengine()===global.ENGINE_WEBPHONE){var t=wpa.webphone.GetVersionNSNum();common.isNull(t)&&(t=""),t=t.toString(),t=t.replace("OK:",""),t=common.Trim(t),e(t)}}catch(o){common.PutToDebugLogException(2,"plhandler: GetVersionNS",o)}}function E(e){Ot("GetVersionJava");try{if(!e||"function"!=typeof e)return common.PutToDebugLog(2,"ERROR, plhandler GetVersionJava: no callback function specified"),"ERROR, no callback function specified";if(common.PutToDebugLog(2,"EVENT, plhandler getversionjava"),common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_GetExeVersion",function(t){common.isNull(t)&&(t=""),e(t)}),common.getuseengine()===global.ENGINE_WEBPHONE)return void e(wpa.webphone.GetVersionJava())}catch(t){common.PutToDebugLogException(2,"plhandler: GetVersionJava",t)}}function T(){try{if(Ot("IsEncrypted"),common.getuseengine()===global.ENGINE_WEBRTC)return 3;if(common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&global.useengine!==global.ENGINE_SERVICE&&global.useengine!==global.ENGINE_WEBPHONE)return 0;if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_IsEncrypted",function(e){!common.isNull(e)&&common.IsNumber(e)&&(global.isencrypted=e)}),0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.IsEncrypted()}catch(e){common.PutToDebugLogException(2,"plhandler: IsEncrypted",e)}return 0}function P(e){try{if(Ot("SetSipHeader"),common.isNull(e))return void common.PutToDebugLog(2,"ERROR, SetSipHeader invalid header. A valid SIP header consists of a name/value pair separated by a colon, ex. Headername: Value");if(global.phonestarted<2)return void At("SetSipHeader",[e]);common.PutToDebugLog(2,"EVENT, setsipheader: "+e);var t=global.aline;if((common.isNull(t)||-3===t)&&(t=-1),e=common.Trim(e),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SetSipHeader(t,e);if(common.getuseengine()===global.ENGINE_FLASH)return void common.PutToDebugLog(2,"ERROR, setsipheader is not supported by flash engine");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_SetSIPHeader",null,t,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.SetSipHeader(t,e)}catch(o){common.PutToDebugLogException(2,"plhandler: SetSipHeader",o)}}function S(e,t){try{if(Ot("GetSipHeader"),!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, plhandler: GetSipHeader callback is not defined");var o=global.aline;if((common.isNull(o)||-3===o)&&(o=-1),common.isNull(e)||e.length<1)return common.PutToDebugLog(2,"ERROR, Invalid header: "+e),void t("ERROR, Invalid header: "+e);if(e=e.toString(),e=e.replace(":",""),global.phonestarted<2)return void At("GetSipHeader",[e,t]);if(common.PutToDebugLog(2,"EVENT, plhandler: getsipheader: "+e+"; ("+common.getuseengine()+")"),common.getuseengine()===global.ENGINE_WEBRTC)return void t(common.GetSipHeader(e));if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"ERROR, getsipheader is not supported by flash engine"),void t("");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetSIPHeader",function(e){t(e)},o,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void t(wpa.webphone.GetSipHeader(o,e,t))}catch(n){common.PutToDebugLogException(2,"plhandler: GetSipHeader",n)}}function N(e,t,o){try{if(Ot("GetSipMessage"),!o||"function"!=typeof o)return void common.PutToDebugLog(2,"ERROR, plhandler: GetSipMessage callback is not defined");var n=global.aline;if((common.isNull(n)||-3===n)&&(n=-1),global.phonestarted<2)return void At("GetSipMessage",[e,t,o]);if(common.getuseengine()===global.ENGINE_WEBRTC)return void o(common.GetSipMessage(n,e,t));if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"ERROR, GetSipMessage is not supported by flash engine"),void o("");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetSIPMessage",function(e){o(e)},n,e,t);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void o(wpa.webphone.GetSipMessage(n,e,t))}catch(i){common.PutToDebugLogException(2,"plhandler: GetSipMessage",i)}}function w(e){try{if(Ot("GetSipMessage"),common.isNull(e)||!common.IsNumber(e))return!1;var t=common.StrToInt(e);if(t<0||t>45)return!1;if(common.PutToDebugLog(2,"EVENT, plhandler changetheme to: "+t.toString()),common.SaveParameter("theme",t.toString()),common.SetCurrTheme(),common.IsWindowsSoftphone()){var o=common.AddJscommport(global.WIN_SOFTPHONE_URL)+"?extcmd_theme="+mSettValue;common.WinSoftphoneHttpReq(o,"GET","",function(e){common.PutToDebugLog(2,"EVENT, plhandler, send theme to softphone response: "+e)})}}catch(n){common.PutToDebugLogException(2,"plhandler: ChangeTheme",n)}return!1}function I(e){try{if(Ot("GetWorkDir"),!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, plhandler: GetWorkDir callback is not definaed");if(common.getuseengine()===global.ENGINE_WEBRTC)return common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"ERROR, getworkdir: only for ns and java"),void e("ERROR, etworkdir: only for ns and java");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetWorkdir",function(t){e(t)});if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void e(wpa.webphone.GetWorkDir())}catch(t){common.PutToDebugLogException(2,"plhandler: GetWorkDir",t)}}function C(e){try{if("function"!=typeof window.getChromeExtensionStatus)return;var t;if(so=e,window.getChromeExtensionStatus(function(e){t=!0,common.PutToDebugLog(2,"ShowChromeExtensionStatus is: "+e),so&&"function"==typeof so&&so()}),++ao>5)return;setTimeout(function(){t||C()},1e3)}catch(o){common.PutToDebugLogException(2,"plhandler: ShowChromeExtensionStatus",o)}}function R(e){Ot("VideoCall"),!1!==common.Glvd()&&G(e,1)}function y(e,t){try{return Ot("MuteVideo"),!1===global.checkIfCallActive?(common.PutToDebugLog(2,"ERROR, MuteVideo there is no active call at the moment."),!1):!1===global.isvideocall?(common.PutToDebugLog(2,"ERROR, MuteVideo this is not a video call."),!1):common.getuseengine()!==global.ENGINE_WEBRTC?(common.PutToDebugLog(2,"ERROR, MuteVideo this is not WebRTC engine."),!1):(e?common.PutToDebugLog(1,"STATUS, "+stringres.get("muted_video")):common.PutToDebugLog(1,"STATUS, "+stringres.get("unmuted_video")),common.PutToDebugLog(2,"EVENT, USER, mutevideo (API_MuteVideo), "+e+", "+t),wpa.webrtcapi.SipMuteVideo(e,t))}catch(o){common.PutToDebugLogException(2,"plhandler: MuteVideo",o)}return!1}function L(e,t){function o(){try{!common.isNull(t)&&t.toString().length>0?(common.PutToDebugLog(2,"EVENT, plhandler ScreenShare USER provided screenid: "+t.toString()),getScreenIdWebphone(function(o,i,r){common.PutToDebugLog(2,"EVENT, plhandler ScreenShare getScreenIdWebphone callback; sourceId from getUserMedia: "+i);var a="";if(common.isNull(r))common.PutToDebugLog(2,"ERROR, getScreenId USER returned invalid media constrints");else try{a=JSON.stringify(r)}catch(s){}common.PutToDebugLog(2,"EVENT, getScreenId USER callback status: "+o+"; screen_constraints: "+a),i=t,common.isNull(r)?common.PutToDebugLog(2,"ERROR, ScreenShare screen_constraints is NULL"):common.isNull(r.video)?common.PutToDebugLog(2,"ERROR, ScreenShare screen_constraints.video is NULL"):common.isNull(r.video.mandatory)?common.PutToDebugLog(2,"ERROR, ScreenShare screen_constraints.video.mandatory is NULL"):common.isNull(r.video.mandatory.chromeMediaSource)?common.PutToDebugLog(2,"ERROR, ScreenShare screen_constraints.video.mandatory.chromeMediaSource is NULL"):(r.video.mandatory.chromeMediaSource=t,webphone_api.ss_screen_constraints=r),n(o,e,i,r)})):C(function(){try{getScreenIdWebphone(function(t,o,i){n(t,e,o,i)})}catch(t){common.PutToDebugLogException(2,"plhandler: ScreenShareDelayed callback",t)}})}catch(o){common.PutToDebugLogException(2,"plhandler: ScreenShareDelayed",o)}}function n(e,t,o,n){try{if("not-installed"==e){var i=stringres.get("chrome_ext_install")+':<br /><br /><a href="'+global.chrome_ss_plugin_url+'" target="_blank">Screen Capturing</a>';return common.PutToDebugLog(2,"WARNING, "+i),void common.AlertDialog(stringres.get("chrome_ext_install_title"),i)}if("installed-disabled"==e){var i=stringres.get("chrome_ext_enable")+':<br /><br /><a href="chrome://extensions" target="_blank">Enable extension</a>';return common.PutToDebugLog(2,"WARNING, "+i),void common.AlertDialog(stringres.get("chrome_ext_enable_title"),i)}if("permission-denied"==e)return common.PutToDebugLog(1,"ERROR, Sreensharing permission denied"),
void((!0===global.usestorage||common.Strl(60))&&common.ShowToast("HTTPS is required for Screen sharing.",8e3));var r="";if(common.isNull(n))common.PutToDebugLog(2,"ERROR, getScreenId returned invalid media constrints");else{try{r=JSON.stringify(n)}catch(a){}webphone_api.ss_screen_constraints=n}common.PutToDebugLog(2,"EVENT, getScreenId callback status: "+e+"; sourceId: "+o+"; screen_constraints: "+r),G(t,2)}catch(s){common.PutToDebugLogException(2,"plhandler: ScreenShareInner",s)}}try{if(Ot("ScreenShare"),!1===common.Glss())return;common.IsWindowsSoftphone(),o()}catch(i){common.PutToDebugLogException(2,"plhandler: ScreenShare",i)}}function D(){try{if(!global.usestorage)return;common.isNull(lo)||(clearTimeout(lo),lo=null)}catch(e){common.PutToDebugLogException(2,"plhandler: Cfin",e)}}function G(e,t){try{Ot("Call"),global.ringstart_time=0,global.callstart_time=0,common.getuseengine()===global.ENGINE_APP&&!1===global.isappenginestarted&&common.StartAppEngine(!0,"EVENT, start engine: because initiating call",!0,e),uo=!1;var o=115e3;if((common.isNull(t)||!1===common.IsNumber(t))&&(t=0),common.SvCont()&&(o=23e4),global.usestorage&&(lo=setTimeout(function(){clearTimeout(lo),lo=null;var e=[];e.push("L"),e.push("i"),e.push("c"),e.push("e"),e.push("n"),e.push("s"),e.push("e"),e.push(" "),e.push("o"),e.push("r"),e.push(" "),e.push("d"),e.push("e"),e.push("m"),e.push("o "),e.push("l"),e.push("i"),e.push("m"),e.push("i"),e.push("t"),e.push(". "),e.push("R"),e.push("e"),e.push("s"),e.push("t"),e.push("a"),e.push("r"),e.push("t "),e.push("r"),e.push("e"),e.push("q"),e.push("u"),e.push("i"),e.push("r"),e.push("e"),e.push("d"),e.push(" "),e.push("h"),e.push("a"),e.push("n"),e.push("g"),e.push("u"),e.push("p"),e.push(" "),e.push("9");var t=e.join("");k(),setTimeout(function(){common.PutToDebugLog(1,"ERROR,"+t)},100),setTimeout(function(){common.PutToDebugLog(1,"ERROR,"+t),common.ShowToast("ERROR,"+t,15e3)},250)},o)),!common.onc())return!1;var n=global.aline;if((common.isNull(n)||-3===n)&&(n=-1),common.IsLineFree(n)||(n=common.GetFreeLine(),ve(n)),common.isNull(e)||common.Trim(e).lengh<1)return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_msg_4")+": "+e),!1;if(e=common.Trim(e),common.PutToDebugLog(2,"EVENT, plhandler initiate Call with engine: "+global.useengine+", to number: "+e),common.RemoveSipHeadreFromCache("X-reason"),common.RemoveSipHeadreFromCache("Reason"),common.RemoveSipHeadreFromCache("Warning"),"p2p"===common.getuseengine())return void common.Phone2Phone("",e);if("accessnum"===common.getuseengine())var i=common.GetParameter("accessnumber"),r="tel://"+i;else if("nativedial"===common.getuseengine()){var r="tel://"+encodeURIComponent(e),a='<a href="'+r+'" id="make_native_call" style="display: none;">call</a>';return j$("body").append(a),j$("#make_native_call").on("click",function(){var e=j$("#make_native_call").attr("href");j$("#make_native_call").remove(),window.location=e}),j$("#make_native_call").click(),void common.ShowToast(stringres.get("native_call"))}var s=!1;if(common.getuseengine()===global.ENGINE_WEBRTC&&common.GetNrOfActiveCalls()>0&&"Firefox"===common.GetBrowser()&&!common.isNull(global.ep)&&global.ep.length>0)for(var l=0;l<global.ep.length;l++)if(!common.isNull(global.ep[l])&&"true"==global.ep[l][common.EP_HOLDSTATE]){var c=global.ep[l][common.EP_LINE];webphone_api.setline(c),common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from pl and mute because webrtc multiline call; peer: "+global.ep[l][common.EP_DESTNR]+" on line: "+c),webphone_api.hold(!1),webphone_api.mute(!0),s=!0}s?setTimeout(function(){webphone_api.setline(n),x(n,e,t)},150):x(n,e,t)}catch(u){common.PutToDebugLogException(2,"plhandler: Call",u)}return!1}function x(t,o,n){try{common.isNull(co)||clearTimeout(co),co=null,global.phonestarted<1&&common.getuseengine()!==global.ENGINE_APP&&(global.phonestarted=1,e(webphone_api.parameters));var i=common.NeedRegister(),r=common.GetTickCount();if(mo<1&&(mo=r),!0===common.GetParameterBool("mustconnect",!1)&&global.phonestarted<3)return common.PutToDebugLog(1,"ERROR, "+stringres.get("warning_notreg")),void common.ShowToast(stringres.get("warning_notreg"));if(i&&global.phonestarted<3&&r-mo<4e3||global.phonestarted<2){var a=common.GetParameterInt("register",1);return a>1&&!1===uo&&r-mo>3500&&(uo=!0,!1===i?(common.PutToDebugLog(2,"WARNING, Cannot initiate call because SipStack is not started: "),common.ShowToast(stringres.get("warning_notstarted"))):(common.PutToDebugLog(2,"WARNING, "+stringres.get("warning_notreg")),2===a&&common.ShowToast(stringres.get("warning_notreg")))),void(co=setTimeout(function(){x(t,o,n)},250))}var s="audio";1===n&&(s="video"),2===n&&(s="screenshare"),common.PutToDebugLog(2,"EVENT, USER, API_Call ("+global.useengine+"), to: "+o+", on line: "+t.toString()+", type: "+s),uo=!1,mo=0,0==common.IsSDK()&&(global.intentcall[0]="number="+o,global.intentcall[1]="calltype=outgoing",global.intentcall[2]="name=",global.intentcall[3]="callmode="+n,setTimeout(function(){j$.mobile.changePage("#page_call",{transition:"pop",role:"page"})},10)),!0===global.isfirstcall&&"Android"===common.GetOs()&&1===common.GetParameterInt("androidspeaker",1)&&common.getuseengine()===global.ENGINE_WEBRTC?(common.PutToDebugLog(2,"EVENT, call handle SwitchOffAndroidSpeaker"),webrtcapi_public.SwitchOffAndroidSpeaker(function(){common.PutToDebugLog(2,"EVENT, call SwitchOffAndroidSpeaker handled"),O(t,o,n)})):O(t,o,n)}catch(l){common.PutToDebugLogException(2,"plhandler: CallDelayed",l)}}function O(e,t,o){try{if(common.getuseengine()===global.ENGINE_WEBRTC)return global.stacknotstarted_retry=!0,setTimeout(function(){return 0===o?wpa.webrtcapi.SipCall("call-audio",e,t):1===o?(global.isvideocall=!0,wpa.webrtcapi.SipCall("call-audiovideo",e,t)):2===o?(webphone_api.isscreensharecall=!0,wpa.webrtcapi.SipCall("call-screenshare",e,t)):wpa.webrtcapi.SipCall("call-audio",e,t)},100),!0;if(common.getuseengine()===global.ENGINE_FLASH)return wpa.flashapi.Call(t);if(!0===common.IsWindowsSoftphone())return 0===o?void common.WinAPI("API_Call",null,e,t):1===o?(global.isvideocall=!0,void common.WinAPI("API_SoftphoneVideoCall",null,t)):2===o?(webphone_api.isscreensharecall=!0,void common.WinAPI("API_SoftphoneScreenshare",null,t)):void common.WinAPI("API_Call",null,e,t);if(o>0&&common.getuseengine()===global.ENGINE_SERVICE&&!0===common.CanIUseWebRTC())return common.SwitchToEngine(global.ENGINE_WEBRTC),void setTimeout(function(){x(e,t,o)},3e3);if(common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Call",null,e,t);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Call(e,t)}catch(n){common.PutToDebugLogException(2,"plhandler: CallDelayedSecond",n)}}function A(){try{Ot("StopScreenShare");var e=global.aline;(common.isNull(e)||-3===e)&&(e=-1),common.PutToDebugLog(2,"EVENT, USER, stopscreenshare (API_StopScreenShare) ("+global.useengine+") on line: "+e.toString());var t=common.GetCallSession(!0,e,"");if(common.isNull(t)&&(global.checkIfInCall=!1,global.checkIfCallActive=!1),setTimeout(function(){common.GetEndpoint(e,"","",!0)},400),setTimeout(function(){if(common.GetNrOfActiveCalls()>0){ve(common.GetBestLine()),!1===common.IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons()}},350),-2===e&&!common.isNull(global.ep)&&global.ep.length>0){for(var o=0;o<global.ep.length;o++){var n=global.ep[o][common.EP_LINE];common.isNull(n)||!0!==common.IsNumber(n)||U(common.StrToInt(n))}return!0}return U(e)}catch(i){common.PutToDebugLogException(2,"plhandler: StopScreenShare",i)}return!1}function k(e){try{Ot("Hangup");var t=-10;t=!common.isNull(e)&&common.IsNumber(e)?common.StrToInt(e):global.aline,(common.isNull(t)||-3===t)&&(t=-1),common.PutToDebugLog(2,"EVENT, USER, hangup (API_Hangup) ("+global.useengine+") on line: "+t.toString());var o=common.GetCallSession(!0,t,"");if(common.isNull(o)&&common.GetNrOfActiveCalls()<2&&(global.checkIfInCall=!1,global.checkIfCallActive=!1),setTimeout(function(){common.GetEndpoint(t,"","",!0)},400),setTimeout(function(){if(common.GetNrOfActiveCalls()>0){ve(common.GetBestLine()),!1===common.IsSDK()&&!0===global.isCallStarted&&callpage_public.UpdateLineButtons()}},350),-2===t&&!common.isNull(global.ep)&&global.ep.length>0){for(var n=0;n<global.ep.length;n++){var i=global.ep[n][common.EP_LINE];if(!common.isNull(i)&&!0===common.IsNumber(i))if(common.getuseengine()===global.ENGINE_WEBRTC){var r=350*n+1;setTimeout(function(){U(common.StrToInt(i))},r)}else U(common.StrToInt(i))}return!0}return U(t)}catch(a){common.PutToDebugLogException(2,"plhandler: Hangup",a)}return!1}function U(e){try{Ot("HangupLine"),common.PutToDebugLog(3,"EVENT, hangupline: "+e.toString());try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_BUTTON")}catch(t){common.PutToDebugLogException(2,"plhandler: HangupLine inner AndroidWebphoneJsInterface",t)}if(common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipHangup(!1,e);if(common.getuseengine()===global.ENGINE_FLASH)return wpa.flashapi.Hangup();if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Hangup",null,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Hangup(e)}catch(t){common.PutToDebugLogException(2,"plhandler: HangupLine",t)}return!1}function V(e){try{Ot("Accept");var t=-10;if(t=!common.isNull(e)&&common.IsNumber(e)?common.StrToInt(e):global.aline,(common.isNull(t)||-3===t)&&(t=-2),common.PutToDebugLog(2,"EVENT, USER, accept (API_Accept) ("+global.useengine+") on line: "+t.toString()),global.active_incoming_call=!1,!0===common.CanUseIncomingCallNot()&&common.RequestBrowserNotificationPermission(function(){},"","",""),common.getuseengine()===global.ENGINE_WEBRTC)return!1===global.webrtcpermissionaccepted&&(common.PutToDebugLog(2,"ERROR, call accepted, but permission not yet accepted"),common.ShowToast(stringres.get("request_permission"),12e3)),wpa.webrtcapi.SipAccept(t);if(common.getuseengine()===global.ENGINE_FLASH)return wpa.flashapi.Accept();if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_Accept",null,t),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Accept(t)}catch(o){common.PutToDebugLogException(2,"plhandler: Accept",o)}return!1}function W(e){try{Ot("Reject");var t=-10;if(t=!common.isNull(e)&&common.IsNumber(e)?common.StrToInt(e):global.aline,(common.isNull(t)||-3===t)&&(t=-2),common.PutToDebugLog(2,"EVENT, USER, reject (API_Reject) ("+global.useengine+") on line: "+t.toString()),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipHangup(!0,t);if(common.getuseengine()===global.ENGINE_FLASH)return wpa.flashapi.Hangup();if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Reject",null,t);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Reject(t)}catch(o){common.PutToDebugLogException(2,"plhandler: Reject",o)}return!1}function M(){try{Ot("Ignore");var e=global.aline;(common.isNull(e)||-3===e)&&(e=-2),common.PutToDebugLog(2,"EVENT, USER, ignore (API_Ignore) ("+global.useengine+") on line: "+e.toString());try{!1===common.IsSDK()&&"page_call"===j$.mobile.activePage.attr("id")&&wpa._call.CloseCall()}catch(t){common.PutToDebugLogException(2,"plhandler: Ignore inner",t)}if(common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipIgnore();if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Ignore",null,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Ignore(e)}catch(o){common.PutToDebugLogException(2,"plhandler: Ignore",o)}return!1}function F(e,t,o){var n=0;try{!common.isNull(e)&&common.IsNumber(e)&&(n=common.StrToInt(e));var i=0,r=0;!common.isNull(t)&&common.IsNumber(t)&&(i=common.StrToInt(t)),!common.isNull(o)&&common.IsNumber(o)&&(r=common.StrToInt(o)),i>0&&(1===n?(common.PutToDebugLog(5,"EVENT, USER SetVideoSize remote width: "+t+"; height: "+o),j$("#div_video_remote").width(i),r>0&&j$("#div_video_remote").height(r)):2===n&&(common.PutToDebugLog(5,"EVENT, USER SetVideoSize local width: "+t+"; height: "+o),j$("#div_video_remote").width(i),r>0&&j$(".previewvideo").height(r)))}catch(a){common.PutToDebugLogException(2,"plhandler: SetVideoSize",a)}}function H(){try{Ot("GetAvailableCallfunc");var e="conference,transfer,mute,hold,chat";return common.getuseengine()===global.ENGINE_WEBRTC?e="transfer,chat":common.getuseengine()===global.ENGINE_FLASH&&(e="transfer,chat"),e}catch(t){common.PutToDebugLogException(2,"plhandler: GetAvailableCallfunc",t)}return""}function j(e){try{if(Ot("Forward"),!1===common.Glt())return;var t=global.aline;if((common.isNull(t)||-3===t)&&(t=-1),common.PutToDebugLog(2,"EVENT, USER, forward (API_Forward), "+e+" on line: "+t.toString()),common.isNull(e))return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_msg_4")),!1;if(e=common.Trim(e),!0===common.GetParameterBool("isfirstcallfwd",!0)&&(common.SaveParameter("isfirstcallfwd","false"),(!0===global.usestorage||common.Strl(60))&&common.ShowToast("Call forward will work only if the remote peer has support for it.",6e3)),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.Forward(e);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Forward",null,t,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Forward(t,e)}catch(o){common.PutToDebugLogException(2,"plhandler: Forward",o)}return!1}function B(){common.isNull(go)||clearInterval(go),go=null,po=0}function $(e,t){try{if(Ot("Conference"),!1===common.Glcf())return;if(!global.checkIfInCall)return G(e);if(common.PutToDebugLog(2,"EVENT, USER, conference (API_Conf) ("+global.useengine+"), "+e),common.isNull(e))return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_msg_4")),!1;if(common.isNull(t)&&(t=!0,common.PutToDebugLog(2,"WARNING, plhandler Conference add is NULL, used as true")),e=common.Trim(e),!0===global.active_incoming_call&&(common.PutToDebugLog(2,"EVENT, mlogic API_Accept Conf"),webphone_api.accept()),!0===t&&common.GetParameterInt("multilinegui",0)<1){if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return global.isconfcall=!0,void common.WinAPI("API_Conf",null,e);if(common.getuseengine()===global.ENGINE_WEBPHONE)return global.isconfcall=!0,wpa.webphone.Conference(e)}else{if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return global.isconfcall=!0,void common.WinAPI("API_ConfEx",null,global.aline,e,t);if(common.getuseengine()===global.ENGINE_WEBPHONE)return global.isconfcall=!0,wpa.webphone.ConferenceEx(global.aline,e,t)}if(common.getuseengine()===global.ENGINE_WEBRTC){var o=common.GetParameterInt("conferencetype",1);if(1!==o&&3!==o&&5!==o&&6!==o&&7!==o||!0!==common.GetConfigBool("usingmizuserver",!1)&&!0!==common.IsMizuWebRTCEmbeddedServer()&&!0!==common.IsMizuWebRTCGateway()){if(!0===common.CanIUseApplet())return void common.SwitchToEngine(global.ENGINE_WEBPHONE);!0===common.CanIUseService()?common.IsServiceInstalled(function(t){try{!0===t?(common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(1)"),webphone_api.hangup(),!1===common.IsSDK()&&(common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(1)"),wpa._call.CloseCall()),common.SwitchToEngine(global.ENGINE_SERVICE),common.PutToDebugLog(1,"EVENT, "+stringres.get("switch_conf")),common.ShowToast(stringres.get("switch_conf")),setTimeout(function(){if(!common.isNull(go))return void B();var t=!1,o=0;go=setInterval(function(){return++po>50?void B():(o<1&&!1===t&&!0===webphone_api.isregistered()&&(o=common.GetTickCount()),o>0&&common.GetTickCount()-o>1e3&&!1===t&&(t=!0,common.PutToDebugLog(2,"EVENT, mlogic API_Call Conf switch: "+currcallnumber),webphone_api.call(global.currcallnumber)),!0===global.checkIfInCall?(global.isconfcall=!0,common.WinAPI("API_Conf",null,e),void B()):void 0)},500)},4e3)):(common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because Conference engine switch to NS(2)"),webphone_api.hangup(),!1===common.IsSDK()&&(common.PutToDebugLog(4,"EVENT, Close call page because Conference engine switch to NS(2)"),wpa._call.CloseCall()),setTimeout(function(){common.AlertDialog(stringres.get("switch_conf_title"),stringres.get("switch_confmessage"),function(e){if(!0===e){var t=common.GetNPLocation();!common.isNull(t)&&t.length>0&&window.open(t),setTimeout(function(){common.SwitchToEngine(global.ENGINE_SERVICE)},1e3)}},stringres.get("btn_ok"))},500))}catch(o){common.PutToDebugLogException(2,"plhandler: Conference InnerService",o)}},!0):common.PutToDebugLog(1,"ERROR, Conference not available in this environment")}else{var n=common.GetSipHeader("X-UT");if(common.isNull(n)&&(n=""),n=common.Trim(n),5===o||6===o||7===o||"g"!==n&&"s"!==n){var i=common.CreateConferenceRoom(!1);if(common.isNull(i)||i.length<3)return void common.PutToDebugLog(2,"ERROR, plhandler Conference webrtc invalid URL: "+i);common.UriParser(i,"","","","","getconferenceroom"),!common.isNull(global.waiting_conf_numbers)&&global.waiting_conf_numbers.length>0&&global.waiting_conf_numbers,global.waiting_conf_numbers=global.waiting_conf_numbers+e}else!0===t?webphone_api.dtmf("*1*"+e+"#"):webphone_api.dtmf("*6*"+e+"#")}return}}catch(r){common.PutToDebugLogException(2,"plhandler: Conference",r)}return!1}function q(e){try{if(Ot("Transfer"),!1===common.Glt())return;var t=global.aline;if((common.isNull(t)||-3===t)&&(t=2),common.PutToDebugLog(2,"EVENT, USER, transfer (API_Transfer), "+e+" on line: "+t.toString()),common.isNull(e))return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_msg_4")),!1;if(e=common.Trim(e),global.last_transfer_tick=common.GetTickCount(),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipTransfer(e);if(common.getuseengine()===global.ENGINE_FLASH)return wpa.flashapi.Transfer(e);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Transfer",null,t,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Transfer(t,e)}catch(o){common.PutToDebugLogException(2,"plhandler: Transfer",o)}return!1}function z(e){try{Ot("Dtmf");var t=global.aline;if((common.isNull(t)||-3===t)&&(t=-1),common.PutToDebugLog(2,"EVENT, USER, dtmf (API_Dtmf), "+e+" on line: "+t.toString()),common.isNull(e))return common.PutToDebugLog(1,"ERROR,"+stringres.get("err_msg_4")),!1;if(e=common.Trim(e),common.PlayDtmfSound(e),common.getuseengine()===global.ENGINE_WEBRTC)return common.PutToDebugLog(1,"EVENT,Send DTMF "+e),wpa.webrtcapi.SipSendDTMF(e);if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(1,"EVENT,Send DTMF "+e),wpa.flashapi.SendDTMF(e);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_Dtmf",null,t,e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Dtmf(t,e)}catch(o){common.PutToDebugLogException(2,"plhandler: Dtmf",o)}return!1}function K(e,t){try{Ot("MuteEx");var o=[];o.push("h"),o.push("a"),o.push("s"),o.push("m"),o.push("u"),o.push("t"),o.push("e");var n=o.join("");if(!1===common.GetParameterBool(n,!0)){var i="N";return i+="o",i+=" ",common.PutToDebugLog(2,"WARNING, "+i+n),!1}var r=global.aline;(common.isNull(r)||-3===r)&&(r=-1);var a=common.ParamAsBool(e),s=common.GetParameterInt("muteholdalllines",0);if(!0===global.isconfcall&&s>1&&(r=-2,global.aline=-2),(common.isNull(t)||t.length<1)&&(t=common.GetParameterInt("defmute",2)),5===(t=common.StrToIntDef(t,0)))return common.PutToDebugLog(2,"WARNING, USER, mute (API_MutEx), "+a+", "+t+" on line: "+r.toString()+" Mute is disabled!"),!1;if(3!==t&&4!==t||(t=0),a?common.PutToDebugLog(1,"STATUS,"+r.toString()+","+stringres.get("muted")):common.PutToDebugLog(1,"STATUS,"+r.toString()+","+stringres.get("unmuted")),common.SetMuteState(r,a),common.PutToDebugLog(2,"EVENT, USER, API_MutEx, "+a+", "+t+" on line: "+r.toString()),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipToggleMute(a,t);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_MuteEx",null,r,a,t),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.MuteEx(r,a,t)}catch(l){common.PutToDebugLogException(2,"plhandler: MuteEx",l)}return!1}function X(){try{Ot("IsMuted");var e=global.aline;return(common.isNull(e)||-3===e)&&(e=-1),common.PutToDebugLog(2,"EVENT, USER, ismuted (API_IsMuted) on line: "+e.toString()),common.getuseengine()===global.ENGINE_WEBPHONE?wpa.webphone.IsMuted(e):common.GetMuteState(e)}catch(t){common.PutToDebugLogException(2,"plhandler: IsMuted",t)}return!1}function J(e,t){try{Ot("Hold");var o=[];o.push("h"),o.push("a"),o.push("s"),o.push("h"),o.push("o"),o.push("l"),o.push("d");var n=o.join("");if(!1===common.GetParameterBool(n,!0)){var i="N";return i+="o",i+=" ",common.PutToDebugLog(2,"WARNING, "+i+n),!1}var r=-10;r=!common.isNull(t)&&common.IsNumber(t)?common.StrToInt(t):global.aline,(common.isNull(r)||-3===r)&&(r=-1);var a=common.ParamAsBool(e),s=common.GetParameterInt("muteholdalllines",0);!0===global.isconfcall&&s>1&&(r=-2,global.aline=-2),common.SetHoldState(r,a);var l=common.ParamAsInt(common.GetParameter2("fasthold"),-1);if(1===l)return common.PutToDebugLog(2,"EVENT, fasthold: "+a),K(a,0);if(-1===l&&common.getuseengine()===global.ENGINE_WEBRTC&&"Firefox"===common.GetBrowser())return common.PutToDebugLog(2,"EVENT, fasthold firefox: "+a),K(a,0);if(common.PutToDebugLog(2,"EVENT, USER, hold (API_Hold), "+a+" on line: "+r.toString()),common.getuseengine()===global.ENGINE_WEBRTC){var c=common.GetParameterInt("holdtype",-1);if(-2===c||0===c)return common.PutToDebugLog(2,"EVENT, API_Hold ignored because holdtype is: "+c.toString()),!1;if(common.GetNrOfActiveCalls()>1&&"Firefox"===common.GetBrowser()&&(global.usemutemutiline=!0),common.GetNrOfActiveCalls()>1){common.PutToDebugLog(2,"EVENT, API_Hold mute instead because multiline call ("+common.GetNrOfActiveCalls()+")");var u=common.GetParameterInt("defmute",0);return webphone_api.mute(a,u,-1)}return wpa.webrtcapi.SipToggleHoldResume(a)}if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_Hold",null,r,a),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Hold(r,a)}catch(m){common.PutToDebugLogException(2,"plhandler: Hold",m)}return!1}function Y(){try{Ot("IsOnHold");var e=global.aline;return(common.isNull(e)||-3===e)&&(e=-1),common.PutToDebugLog(2,"EVENT, USER, isonhold (API_IsOnHold) on line: "+e.toString()),common.getuseengine()===global.ENGINE_WEBPHONE?wpa.webphone.IsOnHold(e):common.GetHoldState(e)}catch(t){common.PutToDebugLogException(2,"plhandler: IsOnHold",t)}return!1}function Q(e,t,o,n){try{if(Ot("SendChat"),!common.isNull(e)&&e.indexOf(",")>0){common.isNull(o)&&(o="");var i=e.split(","),r=o.split("|");if(common.isNull(o)||o.length<1||common.isNull(r)||r.length<i.length){o="";for(var a=0;a<i.length;a++)common.isNull(i[a])||common.Trim(i[a]).length<1||(o.length>0&&(o+="|"),o+=common.Trim(i[a]))}for(var a=0;a<i.length;a++)common.isNull(i[a])||common.Trim(i[a]).length<1||Z(i[a],t,o,n)}else Z(e,t,n)}catch(s){common.PutToDebugLogException(2,"SendChatProcesser: IsOnHold",s)}}function Z(t,o,n,i){try{Ot("SendChatAction");var r=global.aline;if((common.isNull(r)||-3===r)&&(r=1),global.phonestarted<2)return void At("SendChatAction",[t,o,n,i]);if(common.PutToDebugLog(2,"EVENT, USER, sendchat (API_Chat), "+t+", "+o),common.isNull(t)||common.Trim(t).length<1)return common.PutToDebugLog(1,"ERROR, "+stringres.get("err_msg_6")),!1;common.isNull(n)&&(n=""),n=common.Trim(n),common.isNull(ho)||clearTimeout(ho),ho=null,global.phonestarted<1&&(global.phonestarted=1,e(webphone_api.parameters));if(common.NeedRegister()&&global.phonestarted<3||global.phonestarted<2)return void(ho=setTimeout(function(){Q(t,o,i)},250));if(!common.LcAc(!1,!1))return!1;if(common.Te()){var a=[];a.push("T"),a.push("r"),a.push("i"),a.push("a"),a.push("l"),a.push(" "),a.push("e"),a.push("x"),a.push("p"),a.push("i"),a.push("r"),a.push("e"),a.push("d");var s=a.join("");return setTimeout(function(){common.PutToDebugLog(1,"ERROR, "+s)},1150),setTimeout(function(){common.PutToDebugLog(1,"ERROR, "+s)},2150),!1}common.PutToDebugLog(2,"EVENT, USER, API_Chat, "+t),!0!==i&&2===global.haschat&&(global.haschat=3,webphone_api.setparameter("haschat","3"));var l=!1;if(0===common.Trim(o).indexOf("[DONT_START_CHAT_WINDOW]")&&(o=o.replace("[DONT_START_CHAT_WINDOW]",""),l=!0),common.CallScriptingUrl(webphone_api.parameters.scurl_onoutchat,"outChat","",t,t,o),!1!==common.IsSDK()||global.isMessageStarted||!1!==l||(global.intentmsg[0]="action=chat",global.intentmsg[1]="to="+t,global.intentmsg[2]="message="+o,j$.mobile.changePage("#page_message",{transition:"slide",role:"page"})),common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SipSendChat(r,t,o,i);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_SendChat",null,r,t,n,o);if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(1,"EVENT, Chat not supported by flash engine"),!1;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.SendChat(r,t,n,o)}catch(c){common.PutToDebugLogException(2,"plhandler: SendChat",c)}return!1}function ee(e,t,o){try{if(Ot("SendSms"),common.PutToDebugLog(2,"EVENT, USER, sendsms (API_Sms), "+e+", "+t+", "+o),common.isNull(e)||common.Trim(e).length<1)return common.PutToDebugLog(1,"ERROR, Sms "+stringres.get("err_msg_6")),!1;if(global.phonestarted<2)return void At("SendSms",[e,t,o]);var n=common.GetParameter2("sms");(common.isNull(n)||n.length<2)&&(n=common.GetConfig("sms")),!common.isNull(n)&&n.length>2?((common.isNull(o)||o.length<1)&&(o=common.GetSipusername()),UriParser(n,"",o,e,t,"sendsms")):(2!==global.haschat&&(global.haschat=2,webphone_api.setparameter("haschat","2")),Q(e,t,"",!0))}catch(i){common.PutToDebugLogException(2,"plhandler: SendSms",i)}return!1}function te(e,t){try{if(Ot("Voicerecord"),!1===common.Glcr())return;if(global.phonestarted<2)return void At("Voicerecord",[e,t]);common.PutToDebugLog(2,"EVENT, voicerecord (API_Voicerecord), "+e+", "+t);var o=!1;if((!1===e||common.isNull(t)||t.length<1)&&(t="null",o=!0),common.SaveParameter("voicerecupload",t),common.isNull(webphone_api.parameters.voicerecupload)||(webphone_api.parameters.voicerecupload=t),common.getuseengine()===global.ENGINE_WEBRTC)return void common.CallWsuserKeepAlive(!0);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void(!1===o?common.WinAPI("API_VoiceRecord",null,4,2,t):common.WinAPI("API_VoiceRecord",null,0,2,""));if(common.getuseengine()===global.ENGINE_WEBPHONE)return void(!1===o?wpa.webphone.VoiceRecord(4,2,t):wpa.webphone.VoiceRecord(0,2,""))}catch(n){common.PutToDebugLogException(2,"plhandler: Voicerecord",n)}}function oe(){try{if("undefined"!=typeof notifications_public&&null!==notifications_public)return notifications_public.GetStatus();console&&console.log&&console.log("ERROR, plhandler GetStatus notifications_public is not defined")}catch(e){common.PutToDebugLogException(2,"plhandler: GetStatus",e)}return""}function ne(e,t){try{if(Ot("GetRegFailReason"),!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, plhandler: GetRegFailReason callback is not definaed");var o=!0;if((common.isNull(t)||"true"!=t&&"false"!=t||"false"==t||0==t)&&(o=!1),global.phonestarted<2)return void At("GetRegFailReason",[e,t]);if(common.getuseengine()===global.ENGINE_WEBRTC)return void e(wpa.webrtcapi.GetRegFailReason());if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"ERROR, GetRegFailReason is not supported by flash engine"),void e("");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetRegFailReason",function(t){e(t)},o);if(common.getuseengine()===global.ENGINE_WEBPHONE)return wpa.webphone.GetRegFailReason(e,o)}catch(n){common.PutToDebugLogException(2,"plhandler: GetRegFailReason",n)}return""}function ie(){try{if(Ot("DevicePopup"),common.isNull(fo)||clearTimeout(fo),fo=null,global.phonestarted<1&&(global.phonestarted=1,e(webphone_api.parameters)),global.phonestarted<2)return void(fo=setTimeout(function(){ie()},250));if(common.PutToDebugLog(2,"EVENT, USER, devicepopup (API_DevicePopup)"),common.getuseengine()===global.ENGINE_WEBPHONE)return wpa.webphone.AudioDevice();common.AudioDevicePopup()}catch(t){common.PutToDebugLogException(2,"plhandler: DevicePopup",t)}return!1}function re(e,t){try{if(Ot("SetVolume"),common.isNull(e)||e.length<1||common.isNull(t)||t.length<1||!common.IsNumber(e)||!common.IsNumber(t))return common.PutToDebugLog(3,"ERROR, wphone: setvolume device or volume is NULL"),!1;if(global.phonestarted<2)return void At("SetVolume",[e,t]);common.PutToDebugLog(2,"EVENT, plhandler setvolume engine: "+common.getuseengine()+"; dev: "+e+"; volume: "+t);var o=common.StrToInt(e),n=common.StrToInt(t);if(o<0||o>2)return common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid device"),!1;if(n<0||n>100)return common.PutToDebugLog(3,"ERROR, wphone: setvolume invalid valume value"),!1;if(common.PutToDebugLog(2,"EVENT, USER, API_SetVolume, "+e+", "+t),0==e?common.SaveParameter("volumein",t):common.SaveParameter("volumeout",t),common.getuseengine()===global.ENGINE_FLASH)return void common.PutToDebugLog(2,"EVENT, setvolume is not supported by flash engine");if(common.getuseengine()===global.ENGINE_WEBRTC)return void wpa.webrtcapi.SetVolume(e,t);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_SetVolume",null,e,t);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.SetVolume(e,t)}catch(i){common.PutToDebugLogException(2,"plhandler: SetVolume",i)}return!1}function ae(e,t){try{if(Ot("GetVolume"),!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, plhandler: GetVolume callback is not defined");if(common.isNull(e)||e.length<1||!common.IsNumber(e))return common.PutToDebugLog(3,"ERROR, wphone: getvolume device is NULL"),t(-1),!1;var o=common.StrToInt(e);if(o<0||o>2)return common.PutToDebugLog(3,"ERROR, wphone: getvolume invalid device"),!1;if(global.phonestarted<2)return void At("GetVolume",[e,t]);if(common.PutToDebugLog(2,"EVENT, USER, getvolume (API_GetVolume), "+e),common.getuseengine()===global.ENGINE_FLASH)return void common.PutToDebugLog(2,"EVENT, getvolume is not supported by flash engine");if(common.getuseengine()===global.ENGINE_WEBRTC)return void t(wpa.webrtcapi.GetVolume(e));if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetVolume",function(e){var o=50;common.isNull(e)||e.length<1||!1===common.IsNumber(e)?common.PutToDebugLog(2,"ERROR, plhandler GetVolume invalid return value: "+e):o=common.StrToInt(e),
common.PutToDebugLog(2,"plhandler: GetVolume NS returned: "+o.toString()),t(o)},e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void t(wpa.webphone.GetVolume(e))}catch(n){common.PutToDebugLogException(2,"plhandler: GetVolume",n)}return!1}function se(e){try{if(common.getuseengine()===global.ENGINE_WEBRTC)return void(!0===e||"true"===e?common.SaveParameter("androidspeaker","0"):common.SaveParameter("androidspeaker","1"));common.PutToDebugLog(2,"WARNING, setloudspeaker not iplemented for this engine: "+common.getuseengine())}catch(t){common.PutToDebugLogException(2,"plhandler: SetLoudspeaker",t)}return!1}function le(e,t,o,n,i,r,a,s,l){try{if(Ot("PlaySound"),global.phonestarted<2)return void At("PlaySound",[e,t,o,n,i,r,a,s,l]);if(common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.PlaySound(e,t,o,n,i,r,a,s,l);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_PlaySound",null,e,t,o,n,i,r,a,s,l),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.PlaySound(e,t,o,n,i,r,a,s,l);common.PutToDebugLog(2,"ERROR, plhandler API_PlaySuond is not supported by "+common.getuseengine()+" engine")}catch(c){common.PutToDebugLogException(2,"plhandler: PlaySound",c)}return!1}function ce(e,t,o,n,i,r){try{if(Ot("AddContact"),common.isNull(t)||common.Trim(t).length<1)return common.PutToDebugLog(3,"ERROR, plhandler AddContact invalid number: "+t),!1;t=common.Trim(t),common.isNull(e)&&(e=""),e=common.Trim(e),t=common.NormalizeInput2(t,3);var a=common.GetParameterInt("normalize_contact",1);a>0&&(e=common.NormalizeInput2(e,2)),common.isNull(o)&&(o=""),a>0&&(o=common.NormalizeInput2(o,3),o=common.Trim(o)),common.isNull(n)&&(n=""),a>0&&(n=common.NormalizeInput2(n,3),n=common.Trim(n)),common.isNull(i)&&(i=""),a>0&&(i=common.NormalizeInput2(i,3),i=common.Trim(i)),common.isNull(r)&&(r=""),a>0&&(r=common.NormalizeInput2(r,2),r=common.Trim(r));var s="sip";common.IsNumber(t)&&(s="phone");return common.PutToDebugLog(2,"EVENT, AddContact name: "+e+"; number: "+t+"; email: "+o+"; address: "+n+"; notes: "+i+"; website: "+r+"; isfromsync: 0"),ue(e,t,"0",s,common.GetTickCount(),o,n,i,r,"0"),!0}catch(l){common.PutToDebugLogException(2,"plhandler: AddContact",l)}return!1}function ue(e,t,o,n,i,r,a,s,l,c){try{common.isNull(global.ctlist)&&(global.ctlist=[]);var u=[];u[common.CT_NAME]=e,u[common.CT_NUMBER]=[t],u[common.CT_PTYPE]=[n],u[common.CT_USAGE]="0",u[common.CT_LASTMODIF]=i,u[common.CT_DELFLAG]="0",u[common.CT_FAV]=o,u[common.CT_EMAIL]=r,u[common.CT_ADDRESS]=a,u[common.CT_NOTES]=s,u[common.CT_WEBSITE]=l,u[common.CT_LASTACTIVE]=common.GetTickCount().toString(),u[common.CT_ISFROMSYNC]=c;for(var m=0;m<global.ctlist.length;m++){if(global.ctlist[m][common.CT_NUMBER]===t){global.ctlist.splice(m,1);break}}global.ctlist.push(u),global.wasCtModified=!0,common.SortContacts()}catch(g){common.PutToDebugLogException(2,"plhandler: SaveTheContact",g)}}function me(e,t){try{return Ot("DeleteContact"),(common.isNull(e)&&(e=""),e=e.toString(),common.isNull(t)&&(t=""),t=t.toString(),e.length<0&&t.length<0)?(common.PutToDebugLog(2,"ERROR, plhandler DeleteContact invalid name and number"),!1):(common.isNull(global.ctlist)&&(global.ctlist=[]),ge(e,t),!0)}catch(o){common.PutToDebugLogException(2,"plhandler: DeleteContact",o)}return!1}function ge(e,t){try{if(common.isNull(global.ctlist)||global.ctlist.length<1)return void common.PutToDebugLog(2,"WARNING, plhandler RemoveTheContact no contacts in list");if(e.length>0&&t.length>0)for(var o=0;o<global.ctlist.length;o++){var n=global.ctlist[o];if(n[common.CT_NAME]===e||n[common.CT_NAME]===t){global.ctlist.splice(o,1),global.wasCtModified=!0;break}for(var i=0;i<n[common.CT_NUMBER].length;i++)if(n[common.CT_NUMBER][i]===e||n[common.CT_NUMBER][i]===t){global.ctlist.splice(o,1),global.wasCtModified=!0;break}}else if(e.length>0)for(var o=0;o<global.ctlist.length;o++){var n=global.ctlist[o];if(n[common.CT_NAME]===e){global.ctlist.splice(o,1),global.wasCtModified=!0;break}for(var i=0;i<n[common.CT_NUMBER].length;i++)if(n[common.CT_NUMBER][i]===e){global.ctlist.splice(o,1),global.wasCtModified=!0;break}}else if(t.length>0)for(var o=0;o<global.ctlist.length;o++){var n=global.ctlist[o];if(n[common.CT_NAME]===t){global.ctlist.splice(o,1),global.wasCtModified=!0;break}for(var i=0;i<n[common.CT_NUMBER].length;i++)if(n[common.CT_NUMBER][i]===t){global.ctlist.splice(o,1),global.wasCtModified=!0;break}}}catch(r){common.PutToDebugLogException(2,"plhandler: RemoveTheContact",r)}}function de(e,t){try{return Ot("GetContact"),(common.isNull(e)&&(e=""),e=e.toString(),common.isNull(t)&&(t=""),t=t.toString(),e.length<0&&t.length<0)?(common.PutToDebugLog(2,"ERROR, plhandler GetContact invalid name and number"),null):(common.PutToDebugLog(4,"EVENT, plhandler getcontact with name: "+e+" and number: "+t),common.isNull(global.ctlist)&&(global.ctlist=[]),function(e,t){try{var o="";if(e.length>0)for(var n=0;n<global.ctlist.length;n++){var i=global.ctlist[n];i[common.CT_NAME]===e&&(o=i[common.CT_NAME]+"\t"+i[common.CT_NUMBER].join("|")+"\t"+i[common.CT_FAV]+"\t"+i[common.CT_EMAIL]+"\t"+i[common.CT_ADDRESS]+"\t"+i[common.CT_NOTES]+"\t"+i[common.CT_WEBSITE])}else if(t.length>0)for(var n=0;n<global.ctlist.length;n++){var i=global.ctlist[n];i[common.CT_NAME]===t&&(o=i[common.CT_NAME]+"\t"+i[common.CT_NUMBER].join("|")+"\t"+i[common.CT_FAV]+"\t"+i[common.CT_EMAIL]+"\t"+i[common.CT_ADDRESS]+"\t"+i[common.CT_NOTES]+"\t"+i[common.CT_WEBSITE]);for(var r=0;r<i[common.CT_NUMBER].length;r++)i[common.CT_NUMBER][r]===t&&(o=i[common.CT_NAME]+"\t"+i[common.CT_NUMBER].join("|")+"\t"+i[common.CT_FAV]+"\t"+i[common.CT_EMAIL]+"\t"+i[common.CT_ADDRESS]+"\t"+i[common.CT_NOTES]+"\t"+i[common.CT_WEBSITE])}if(!common.isNull(o))return o}catch(a){common.PutToDebugLogException(2,"plhandler: FindContactInList",a)}return null}(e,t))}catch(o){common.PutToDebugLogException(2,"plhandler: GetContact",o)}return null}function pe(e){try{return Ot("ListContacts"),common.isNull(global.ctlist)&&(global.ctlist=[]),common.PutToDebugLog(4,"EVENT, plhandler listcontacts called"),function(e){try{for(var t="",o=0;o<global.ctlist.length;o++){var n=global.ctlist[o];if(!1!==e||"Echo delayed"!==n[common.CT_NAME]&&"Echo"!==n[common.CT_NAME]&&"Funny"!==n[common.CT_NAME]&&"Music"!==n[common.CT_NAME]&&"Playback"!==n[common.CT_NAME]&&"Record"!==n[common.CT_NAME]&&"Redial"!==n[common.CT_NAME]&&"Voicemail"!==n[common.CT_NAME]){!common.isNull(t)&&t.length>0&&(t+="\r\n");for(var i="",r=0;r<n[common.CT_NUMBER].length;r++)common.isNull(n[common.CT_NUMBER][r])||n[common.CT_NUMBER][r].length<1||(i.length>0&&(i+="|"),i+=n[common.CT_NUMBER][r]);t+=n[common.CT_NAME]+"\t"+i+"\t"+n[common.CT_FAV]+"\t"+n[common.CT_EMAIL]+"\t"+n[common.CT_ADDRESS]+"\t"+n[common.CT_NOTES]+"\t"+n[common.CT_WEBSITE]}}if(!common.isNull(t)&&t.length>0)return t}catch(a){common.PutToDebugLogException(2,"plhandler: BuildCtList",a)}return null}(e)}catch(t){common.PutToDebugLogException(2,"plhandler: ListContacts",t)}return null}function he(){try{Ot("ListCallhistory"),common.isNull(global.chlist)&&(global.chlist=[]),common.PutToDebugLog(4,"EVENT, plhandler listcallhistory called");for(var e="",t=0;t<global.chlist.length;t++){var o=global.chlist[t];!common.isNull(e)&&e.length>0&&(e+="\r\n");e+=o[common.CH_TYPE]+"\t"+o[common.CH_NAME]+"\t"+o[common.CH_NUMBER]+"\t"+o[common.CH_DATE]+"\t"+o[common.CH_DURATION]+"\t"+o[common.CH_REASON]}if(!common.isNull(e)&&e.length>0)return e}catch(n){common.PutToDebugLogException(2,"plhandler: ListCallhistory",n)}return null}function fe(e,t){try{if(common.PutToDebugLogSpecial(1,"EVENT, SetParameter user, "+e+": "+t,!1,""),Ot("SetParameter: "+e+": "+t),common.isNull(e)||e.length<1)return!1;if(e=e.toLowerCase(),common.isNull(t)&&(t="null"),t=common.Trim(t),0===t.indexOf("encrypted__3__")&&(t=common.StrDc(t,common.GetPassphrase())),e.indexOf("server")>=0){if("YOURSIPDOMAIN.COM"===t||"YOURSIPSERVER.COM"===t||"SIPSERVER"===t||"VOIPSERVER"===t||"SERVERADDRESS"===t)return!1}else if(e.indexOf("username")>=0){if("USERNAME"===t||"SIPUSERNAME"===t)return!1}else if(e.indexOf("password")>=0){if("PASSWORD"===t||"SIPPASSWORD"===t||"SIPASSWORD"===t)return!1}else if(e.indexOf("callto")>=0&&("DESTINATION"===t||"CALLTO"===t))return!1;"webrtcserver"!==e&&"webrtcaddress"!==e&&"rtcserver"!==e&&"rtcaddress"!==e||(e="webrtcserveraddress");try{window.location.href.indexOf("isdemopage=true")>0&&!common.isNull(t)&&t.toString().length>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)&&webphone_api.SetCookie("wpdemosett_"+e,t,365)}catch(r){common.PutToDebugLogException(2,"plhandler: SetParameter inner",r)}var o=t;("password"===e||"sippassword"===e||common.GetParameterInt("loglevel",1)<5)&&(o="*****"),common.PutToDebugLogSpecial(1,"EVENT, SetParameter "+e+": "+o,!1,""),"serveraddress"===e&&t.length>0?common.SaveParameter("serveraddress_user",t):"theme"===e&&t.length>0?common.SaveParameter("colortheme",t):"colortheme"===e&&t.length>0&&common.SaveParameter("theme",t),common.SaveParameter(e,t),common.isNull(webphone_api.parameters)||common.isNull(webphone_api.parameters[e])||(webphone_api.parameters[e]=t);var n=common.GetParameter("devicetype");if(n===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_SetParameter",null,e,t);if(n===common.DEVICE_WEBPHONE())return wpa.webphone.SetParameter(e,t)}catch(a){var i=e;i=common.isNull(i)?"":": "+i,common.PutToDebugLogException(2,"plhandler: SetParameter"+i,a)}return!1}function be(e){try{if(common.isNull(e)||e.length<1)return null;e=e.toLowerCase();var t=common.GetParameter(e);try{if(window.location.href.indexOf("isdemopage=true")>0&&("sipusername"===e||"username"===e||"password"===e||"sippassword"===e||"serveraddress_user"===e||"serveraddress_orig"===e||"serveraddress"===e||"upperserver"===e||"callto"===e||"destination"===e)){var o=webphone_api.GetCookie("wpdemosett_"+e);if(!common.isNull(o)&&o.length>0&&(common.isNull(t)||t.length<1))return o}}catch(n){common.PutToDebugLogException(2,"plhandler: GetParameter inner",n)}return t}catch(i){common.PutToDebugLogException(2,"plhandler: GetParameter",i)}return null}function ve(e){try{if(Ot("SetLine"),common.isNull(e)||e.toString().length<1)return void common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (1): "+e);common.PutToDebugLog(2,"EVENT, USER, setline (API_SetLine), "+e.toString());var t=!1,o=-10;if(common.IsNumber(e)&&e.toString().length<3){if((o=common.StrToInt(common.Trim(e)))<-2||o>50)return void common.PutToDebugLog(2,"ERROR, plhandler: SetLine invalid line (2): "+e);-1===o&&(o=common.GetBestLine())}if(e=e.toString(),o<-5){t=!0;for(var n=0;n<global.ep.length;n++)if(!common.isNull(global.ep[n])){var i=global.ep[n][common.EP_DESTNR];!common.isNull(i)&&i.length>1&&e===i&&(o=common.StrToInt(global.ep[n][common.EP_LINE]))}}if(o<-5)for(var n=0;n<global.ep.length;n++)if(!common.isNull(global.ep[n])){var r=global.ep[n][common.EP_CALLID];!common.isNull(i)&&i.length>1&&e===r&&(o=common.StrToInt(global.ep[n][common.EP_LINE]))}if(0===common.IsMultiline())return void setTimeout(function(){var e=[];e.push("E"),e.push("R"),e.push("R"),e.push("O"),e.push("R"),e.push(","),e.push("M"),e.push("u"),e.push("l"),e.push("t"),e.push("i"),e.push("l"),e.push("i"),e.push("n"),e.push("e"),e.push(" "),e.push("f"),e.push("e"),e.push("a"),e.push("t"),e.push("u"),e.push("r"),e.push("e"),e.push(" "),e.push("i"),e.push("s"),e.push("d"),e.push("i"),e.push("s"),e.push("a"),e.push("b"),e.push("l"),e.push("e"),e.push("d");var t=e.join("");common.PutToDebugLog(1,t)},550);if(global.aline=o,!1===bo&&(common.SaveParameter("multilinegui","1"),bo=!0),common.RefreshInfo(),common.getuseengine()===global.ENGINE_WEBRTC)return;if(common.getuseengine()===global.ENGINE_FLASH)return void common.PutToDebugLog(2,"WARNING, SetLine method not available for engine: "+common.GetEngineDisplayName(global.useengine));if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return!0===t?common.WinAPI("API_SetLine",null,e):common.WinAPI("API_SetLine",null,o),void common.SaveParameter("line",o.toString());if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return!0===t?wpa.webphone.SetLineEx(e):wpa.webphone.SetLine(o),void common.SaveParameter("line",o.toString())}catch(a){common.PutToDebugLogException(2,"plhandler: SetLine",a)}return null}function _e(){var e=global.aline;try{if(Ot("GetLine"),common.PutToDebugLog(2,"EVENT, USER, getline (API_getLine)"),common.getuseengine()===global.ENGINE_WEBRTC)return e;if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"WARNING, GetLine method not available for engine: "+common.GetEngineDisplayName(global.useengine)),e;if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return e;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return global.aline=wpa.webphone.GetLine(),global.aline}catch(t){common.PutToDebugLogException(2,"plhandler: GetLine",t)}return e}function Ee(e,t){try{if(Ot("LineToCallID"),common.PutToDebugLog(2,"EVENT, USER, linetocallid (API_LineToCallID)"),common.isNull(e)||!common.IsNumber(e))return void t("ERROR, linetocallid: Invalid line");if(common.getuseengine()===global.ENGINE_WEBRTC)return void t(wpa.webrtcapi.LineToCallID(e));if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"WARNING, LineToCallID method not available for engine: "+common.GetEngineDisplayName(global.useengine)),"";if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_LineToCallID",function(e){t(e)},e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void t(wpa.webphone.LineToCallID(e))}catch(o){common.PutToDebugLogException(2,"plhandler: LineToCallID",o)}}function Te(e,t){try{if(Ot("CallIDToLine"),common.PutToDebugLog(2,"EVENT, USER, callidtoline (API_CallIDToLine)"),common.isNull(e)||e.length<1)return void t("ERROR, CallIDToLine: Invalid callid");if(common.getuseengine()===global.ENGINE_WEBRTC)return void t(wpa.webrtcapi.CallIDToLine(e));if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"WARNING, CallIDToLine method not available for engine: "+common.GetEngineDisplayName(global.useengine)),"";if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_CallIDToLine",function(e){t(e)},e);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void t(wpa.webphone.CallIDToLine(e))}catch(o){common.PutToDebugLogException(2,"plhandler: CallIDToLine",o)}}function Pe(e){try{var t=-5;if(!common.isNull(e)&&common.IsNumber(e)&&(t=common.StrToInt(e)),t<1&&(t=common.GetBestLine()),common.getuseengine()===global.ENGINE_WEBPHONE){var o=wpa.webphone.GetLineDetails(t);if(!common.isNull(o)&&o.length>0){var n=o.split(",");if(!common.isNull(n)&&n.length>0){o="";for(var i=0;i<n.length;i++)common.isNull(n[i])&&(n[i]=""),n[i]=common.Trim(n[i]),0===n[i].indexOf("_BASE64_")&&(n[i]=common.B64Dec(n[i]),common.isNull(n[i])&&(n[i]=""),n[i]=common.Trim(n[i])),o.length>0&&(o+=","),o+=n[i]}}return o}var r=t.toString(),a="Unused line",s="",l="",c="",u="-1",m=common.GetParameter("serveraddress_user"),g="",d="false",p="false",h="",f=common.GetTickCount(),b=global.lnstat[t];if(!common.isNull(b)&&b.length>1){var v=common.GetConfigInt("registerinterval",0);v<1&&(v=90),v*=6e4,!common.isNull(b[0])&&common.IsNumber(b[0])&&f-b[0]<=v&&!common.isNull(b[1]&&b[1].length)&&(a=b[1])}var _=common.GetEndpoint(t,"","",!1);!common.isNull(_)&&_.length>2&&(s=_[common.EP_CALLID],l=_[common.EP_DESTNR],c=common.GetSipusername(),u=_[common.EP_INCOMING],m=common.GetParameter("serveraddress_user"),g="",d=_[common.EP_MUTESTATE],p=_[common.EP_HOLDSTATE],h="");var E="LINEDETAILS,"+r+","+a+","+s+","+l+","+c+","+u+","+m+","+g+","+d+","+p+","+h;return common.PutToDebugLog(4,"EVENT, GetLineDetails user: "+E),E}catch(T){common.PutToDebugLogException(2,"plhandler: GetLineDetails",T)}return""}function Se(){try{Ot("GetLastCallDetails");var e=global.lastcalldetails;if(common.isNull(e)&&(e=""),e=common.Trim(e),global.phonestarted<2)return void At("GetLastCallDetails",[]);if(common.getuseengine()===global.ENGINE_WEBRTC||common.getuseengine()===global.ENGINE_FLASH)return e;if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return e;if(common.getuseengine()===global.ENGINE_FLASH)return e;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.GetLastCallDetails()}catch(t){common.PutToDebugLogException(2,"plhandler: GetLastCallDetails",t)}return""}function Ne(e){try{if(Ot("GetIcomingDisplay"),!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, plhandler: GetIncomingDisplay callback is not definaed");if(global.phonestarted<2)return void At("GetIncomingDisplay",[e]);if(common.getuseengine()===global.ENGINE_WEBRTC)return void e(common.GetWebrtcDisplayName());if(common.getuseengine()===global.ENGINE_FLASH)return void e("");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetIncomingDisplay",function(t){common.isNull(t)&&(t=""),t=common.Trim(t),0===t.indexOf("_BASE64_")&&(t=common.B64Dec(t),common.isNull(t)&&(t=""),t=common.Trim(t)),e(t)});if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE()){var t=wpa.webphone.GetIncomingDisplay();return common.isNull(t)&&(t=""),t=common.Trim(t),0===t.indexOf("_BASE64_")&&(t=common.B64Dec(t),common.isNull(t)&&(t=""),t=common.Trim(t)),void e(t)}}catch(o){common.PutToDebugLogException(2,"plhandler: GetIncomingDisplay",o)}return""}function we(){try{global.printwad_called=!1,common.PutToDebugLog(2,"EVENT, USER, API_Unregister"),global.authenticated_displayed=!1,global.dispSaveSettMsg=0,global.pres_unreg_called=!0,global.last_presence_enabled=common.UsePresence2(),global.onregisteredcalled=!1;var e=global.dispregfailed;if(global.dispregfailed=2,setTimeout(function(){global.dispregfailed=e},500),!1===global.onunregistered_flag){global.onunregistered_flag=!0,setTimeout(function(){global.onunregistered_flag=!1},2e3);try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(o){common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered(unregistered) callback",o)}try{webphone_api.onUnRegisteredCb()}catch(o){common.PutToDebugLogException(2,"plhandler: There is an error in onUnRegistered() callback",o)}}var t=common.getuseengine();if((common.isNull(t)||t.length<1)&&(t=global.last_useengine),t===global.ENGINE_WEBRTC)return webphone_api.flagrestartwebrtc=!1,wpa.webrtcapi.SipUnRegister(),common.Wsunreg(),void(global.phonestarted=2);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||t===global.ENGINE_SERVICE)return common.WinAPI("API_Unregister",null),void(global.phonestarted=2);if(t===global.ENGINE_FLASH)return wpa.flashapi.Logout(null),void(global.phonestarted=2);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.Unregister(),void(global.phonestarted=2)}catch(o){common.PutToDebugLogException(2,"plhandler: Unregister",o)}}function Ie(e){try{return global.onregisteredcalled=!1,e===global.ENGINE_WEBRTC?(!0===global.checkIfInCall&&(common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_1: "+e),wpa.webrtcapi.SipHangup(!1,-2)),webphone_api.flagrestartwebrtc=!1,wpa.webrtcapi.SipStop(),common.Wsunreg(),void(global.phonestarted=2)):e===global.ENGINE_FLASH?(!0===global.checkIfInCall&&(common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_2: "+e),wpa.flashapi.Hangup()),wpa.flashapi.Logout(null),void(global.phonestarted=2)):e===global.ENGINE_WEBPHONE?(!0===global.checkIfInCall&&(common.PutToDebugLog(3,"EVENT, Window.OnUnload close or refresh: hangup active call_3: "+e),wpa.webphone.Hangup(-2)),wpa.webphone.Unregister(),void(global.phonestarted=2)):(!0===global.checkIfInCall||common.WinAPI("API_Unregister",null),void(global.phonestarted=2))}catch(t){common.PutToDebugLogException(2,"plhandler: UnregisterEngine",t)}}function Ce(){try{if(Ot("HTTPKeepAlive"),common.PutToDebugLog(5,"EVENT, httpkeepalive (API_HTTPKeepAlive)"),global.useengine!==global.ENGINE_WEBPHONE)return;return wpa.webphone.HTTPKeepAlive()}catch(e){common.PutToDebugLogException(2,"plhandler: HTTPKeepAlive",e)}}function Re(){Ot("IsRegistered");try{if(common.getuseengine()===global.ENGINE_WEBPHONE){var e=wpa.webphone.IsRegistered();return common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: wp "+e.toString()),e}if(global.phonestarted>2)return common.PutToDebugLog(2,"EVENT, USER, API_IsRegistered: true"),!0;common.PutToDebugLog(2,"EVENT, USER, isregistered (API_IsRegistered)")}catch(t){common.PutToDebugLogException(2,"plhandler: IsRegistered",t)}return!1}function ye(){Ot("IsInCall");try{common.PutToDebugLog(4,"EVENT, isincall: "+global.checkIfInCall.toString())}catch(e){common.PutToDebugLogException(2,"plhandler: IsInCall",e)}return global.checkIfInCall}function Le(e,t,o){try{if(!0!==o){if(Ot("GetDeviceList"),!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, plhandler: GetDeviceList callback is not defined");vo.push(e),_o.push(t)}if(common.getuseengine().length<1&&global.phonestarted<2)return common.isNull(Eo)||clearTimeout(Eo),Eo=null,void(Eo=setTimeout(function(){Le(vo[0],null,!0)},250));if(common.isNull(Eo)||clearTimeout(Eo),Eo=null,common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetAudioDeviceList",function(e){var t=_o.shift(),o=vo.shift();common.isNull(e)&&(e=""),e=common.Trim(e),0===e.indexOf("_BASE64_")&&(e=common.B64Dec(e),common.isNull(e)&&(e=""),e=common.Trim(e)),0==o?(global.audio_rec_device_list=e,common.SaveParameter("cache_audio_rec_device_list",e),t(e)):1==o?(global.audio_play_device_list=e,common.SaveParameter("cache_audio_play_device_list",e),t(e)):2==o?(!common.isNull(e)&&e.length>0&&e.indexOf("\r\nAll")<1&&(e+="\r\nAll"),global.audio_ring_device_list=e,common.SaveParameter("cache_audio_ring_device_list",e),t(e)):(global.video_rec_device_list=e,common.SaveParameter("cache_video_rec_device_list",e),t(e)),!common.isNull(_o)&&_o.length>0&&setTimeout(function(){Le(vo[0],null,!0)},100)},e);if(common.getuseengine()===global.ENGINE_WEBPHONE){var n="",i=vo.shift();n=wpa.webphone.GetAudioDeviceList(e),common.isNull(n)&&(n=""),n=common.Trim(n),0===n.indexOf("_BASE64_")&&(n=common.B64Dec(n),common.isNull(n)&&(n=""),n=common.Trim(n)),0==i?(global.audio_rec_device_list=n,common.SaveParameter("cache_audio_rec_device_list",n)):1==i?(global.audio_play_device_list=n,common.SaveParameter("cache_audio_play_device_list",n)):2==i?(!common.isNull(n)&&n.length>0&&n.indexOf("\r\nAll")<1&&(n+="\r\nAll"),global.audio_ring_device_list=n,common.SaveParameter("cache_audio_ring_device_list",n)):(global.video_rec_device_list=n,common.SaveParameter("cache_video_rec_device_list",n));var r=_o.shift();return r(n),void(!common.isNull(_o)&&_o.length>0&&setTimeout(function(){Le(vo[0],null,!0)},100))}if(common.getuseengine()===global.ENGINE_WEBRTC){var n="",i=vo.shift();0==i?(n=wpa.webrtcapi.GetAudioDeviceList(e),global.audio_rec_device_list=n,common.SaveParameter("cache_audio_rec_device_list",n)):1==i?(n=wpa.webrtcapi.GetAudioDeviceList(e),global.audio_play_device_list=n,common.SaveParameter("cache_audio_play_device_list",n)):2==i?(n=wpa.webrtcapi.GetAudioDeviceList(e),global.audio_ring_device_list=n,common.SaveParameter("cache_audio_ring_device_list",n)):(n=wpa.webrtcapi.GetAudioDeviceList(e),global.video_rec_device_list=n,common.SaveParameter("cache_video_rec_device_list",n));var r=_o.shift();return r(n),void(!common.isNull(_o)&&_o.length>0&&setTimeout(function(){Le(vo[0],null,!0)},100))}var r=_o.shift();vo.shift(),r("ERROR, Cannot get device list because no engine is started at the moment")}catch(a){common.PutToDebugLogException(2,"plhandler: GetDeviceList",a)}}function De(e,t,o){try{if(!0!==o){if(Ot("GetDevice"),!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, plhandler: GetDevice callback is not defined");To.push(e),Po.push(t)}if(common.getuseengine().length<1||global.phonestarted<2)return common.isNull(So)||clearTimeout(So),So=null,void(So=setTimeout(function(){De(To[0],null,!0)},250));if(common.isNull(So)||clearTimeout(So),So=null,common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetAudioDevice",function(e){var t=To.shift();common.isNull(e)&&(e=""),e=common.Trim(e),0===e.indexOf("_BASE64_")&&(e=common.B64Dec(e),common.isNull(e)&&(e=""),e=common.Trim(e)),0==t?(global.audio_rec_curr_device=e,common.SaveParameter("cache_audio_rec_curr_device",e)):1==t?(global.audio_play_curr_device=e,common.SaveParameter("cache_audio_play_curr_device",e)):2==t?(global.audio_ring_curr_device=e,common.SaveParameter("cache_audio_ring_curr_device",e)):(global.video_rec_curr_device=e,common.SaveParameter("cache_video_rec_curr_device",e));var o=Po.shift();common.PutToDebugLog(4,"EVENT, GetDevice (1), res: "+e),o(e),!common.isNull(Po)&&Po.length>0&&setTimeout(function(){De(To[0],null,!0)},100)},e);if(common.getuseengine()===global.ENGINE_WEBPHONE){var n="",i=To.shift();n=wpa.webphone.GetAudioDevice(e),common.isNull(n)&&(n=""),n=common.Trim(n),0===n.indexOf("_BASE64_")&&(n=common.B64Dec(n),common.isNull(n)&&(n=""),n=common.Trim(n)),0==i?(global.audio_rec_curr_device=n,common.SaveParameter("cache_audio_rec_curr_device",n)):1==i?(global.audio_play_curr_device=n,common.SaveParameter("cache_audio_play_curr_device",n)):2==i?(global.audio_ring_curr_device=n,common.SaveParameter("cache_audio_ring_curr_device",n)):(global.video_rec_curr_device=n,common.SaveParameter("cache_video_rec_curr_device",n));var r=Po.shift();return common.PutToDebugLog(4,"EVENT, GetDevice (2), dev: "+i+"; res: "+n),r(n),void(!common.isNull(Po)&&Po.length>0&&setTimeout(function(){De(To[0],null,!0)},100))}if(common.getuseengine()===global.ENGINE_WEBRTC){var n="",i=To.shift();0==i?(n=wpa.webrtcapi.GetAudioDevice(e),global.audio_rec_curr_device=n,common.SaveParameter("cache_audio_rec_curr_device",n)):1==i?(n=wpa.webrtcapi.GetAudioDevice(e),global.audio_play_curr_device=n,common.SaveParameter("cache_audio_play_curr_device",n)):2==i?(n=wpa.webrtcapi.GetAudioDevice(e),global.audio_ring_curr_device=n,common.SaveParameter("cache_audio_ring_curr_device",n)):(n=wpa.webrtcapi.GetAudioDevice(e),global.video_rec_curr_device=n,common.SaveParameter("cache_video_rec_curr_device",n));var r=Po.shift();return common.PutToDebugLog(4,"EVENT, GetDevice (3), dev: "+i+"; res: "+n),r(n),void(!common.isNull(Po)&&Po.length>0&&setTimeout(function(){De(To[0],null,!0)},100))}}catch(a){common.PutToDebugLogException(2,"plhandler: GetDevice",a)}}function Ge(e,t,o,n,i){try{if(!0!==i&&(Ot("SetDevice"),No.push(e),wo.push(t),Io.push(o),Co.push(n)),common.getuseengine().length<1||global.phonestarted<2)return common.isNull(Ro)||clearTimeout(Ro),Ro=null,void(Ro=setTimeout(function(){Ge(null,null,null,null,!0)},250));if(common.isNull(Ro)||clearTimeout(Ro),Ro=null,null===e&&!common.isNull(No)&&No.length>0&&(e=No.shift(),t=wo.shift(),o=Io.shift(),n=Co.shift()),null===e&&null===t)return;if(common.PutToDebugLog(4,"EVENT, setdevice, dev: "+e+"; devicename: "+t+"; immediate: "+o),common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_SetAudioDevice",null,e,t,o),void(!common.isNull(No)&&No.length>0&&setTimeout(function(){Ge(null,null,null,null)},100));if(common.getuseengine()===global.ENGINE_WEBPHONE)return wpa.webphone.SetAudioDevice(e,t,o),!common.isNull(No)&&No.length>0&&setTimeout(function(){Ge(null,null,null,null)},100),!0;if(common.getuseengine()===global.ENGINE_WEBRTC)return wpa.webrtcapi.SetAudioDevice(e,t,n),!common.isNull(No)&&No.length>0&&setTimeout(function(){Ge(null,null,null,null)},100),!0}catch(r){common.PutToDebugLogException(2,"plhandler: SetDevice",r)}}function xe(e,t){try{if(global.isappenginestarted=!1,(common.isNull(e)||e.length<1)&&(e=common.getuseengine()),(common.isNull(e)||e.length<1)&&(e=global.last_useengine),common.isNull(e)||e.length<1)return void common.PutToDebugLog(2,"ERROR, plhandler: StopEngine engine is not defined");global.webrtc_regstate=0,common.PutToDebugLog(2,"EVENT, USER, stopengine (API_StopEngine)");if(!1===common.GetParameterBool("needunregister",!0)&&!0!==t)return void common.PutToDebugLog(2,"EVENT, API_StopEngine needunregister is FALSE");if(common.Glsp()){if(e===global.ENGINE_SERVICE)return global.apistartstate=0,global.apistarttick=0,global.wnotstartedsession=!1,void(!1===common.NSMacLinEnabled()&&common.WinAPI("API_Exit",null));if(e===global.ENGINE_WEBPHONE)return global.apistartstate=0,global.apistarttick=0,global.wnotstartedsession=!1,wpa.webphone.Exit()}}catch(o){common.PutToDebugLogException(2,"plhandler: StopEngine",o)}}function Oe(e){try{common.PutToDebugLog(2,"EVENT, USER, API_Stop"),webphone_api.flagrestartwebrtc=!1,global.laststarttick=0,global.webrtc_regstate=0,global.apistartstate=0,global.apistarttick=0,global.wnotstartedsession=!1,global.isappenginestarted=!1,setTimeout(function(){xe(common.getuseengine(),e)},900),setTimeout(function(){common.isNull(global.maintimerid)||(clearInterval(global.maintimerid),global.maintimerid=null,common.isNull(global.initcalled)||(global.initcalled=!1)),global.apistartstate=0,global.apistarttick=0,global.wnotstartedsession=!1},1100),setTimeout(function(){try{webphone_api.onAppStateChangeCb("stopped")}catch(e){common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(stopped) callback",e)}try{webphone_api.onStopCb()}catch(e){common.PutToDebugLogException(2,"There is an error in onStop() callback",e)}},1250),common.isNull(global.serviceStatusPollTimer)||clearInterval(global.serviceStatusPollTimer),common.isNull(global.polltimerid)||clearInterval(global.polltimerid),common.isNull(global.worktimer)||clearTimeout(global.worktimer),global.worktimer=null;if(!1===common.GetParameterBool("needunregister",!0)&&!0!==e)return void common.PutToDebugLog(2,"EVENT, API_Stop needunregister is FALSE");common.Glsp()&&(common.getuseengine()===global.ENGINE_WEBRTC?global.phonestarted>2&&(wpa.webrtcapi.SipStop(),common.Wsunreg()):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?!1===common.NSMacLinEnabled()&&common.WinAPI("API_Exit",null):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.Exit())}catch(t){common.PutToDebugLogException(2,"plhandler: Stop",t)}global.phonestarted=0}function Ae(e){try{if(Ot("SendChatIsComposing"),common.isNull(e)||e.lebgth<1)return void common.PutToDebugLog(2,"ERROR, SendChatIsComposing invalid destination");var t=global.aline;if((common.isNull(t)||-3===t)&&(t=-1),common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_SendChatIsComposing",null,t,e);if(common.getuseengine()===global.ENGINE_WEBPHONE)return wpa.webphone.SendChatIsComposing(t,e)}catch(o){common.PutToDebugLogException(2,"plhandler: SendChatIsComposing",o)}}function ke(){return common.BrowserWindowIsActive()}function Ue(){try{return Ot("HelpWindow"),common.PutToDebugLog(2,"EVENT, USER, helpwindow (API_HelpWindow)"),common.HelpWindow()}catch(e){common.PutToDebugLogException(2,"plhandler: HelpWindow",e)}return!1}function Ve(){try{return Ot("SettingsPage"),
common.PutToDebugLog(2,"EVENT, USER, settingspage (API_SettingsPage)"),common.OpenSettings(!0,9),!0}catch(e){common.PutToDebugLogException(2,"plhandler: SettingsPage",e)}return!1}function We(){try{return Ot("DialPage"),common.PutToDebugLog(2,"EVENT, USER, dialpage (API_DialPage)"),j$.mobile.changePage("#page_dialpad",{transition:"pop",role:"page"}),!0}catch(e){common.PutToDebugLogException(2,"plhandler: DialPage",e)}return!1}function Me(){try{return Ot("MessageInboxPage"),common.PutToDebugLog(2,"EVENT, USER, messageinboxpage (API_MessageInboxPage)"),j$.mobile.changePage("#page_messagelist",{transition:"none",role:"page"}),!0}catch(e){common.PutToDebugLogException(2,"plhandler: MessageInboxPage",e)}return!1}function Fe(){try{return Ot("MessagePage"),common.PutToDebugLog(2,"EVENT, USER, messagepage (API_MessagePage)"),global.intentmsg[0]="action=",global.intentmsg[1]="to=",global.intentmsg[2]="message=",j$.mobile.changePage("#page_message",{transition:"none",role:"page"}),!0}catch(e){common.PutToDebugLogException(2,"plhandler: MessagePage",e)}return!1}function He(){try{return Ot("AddContactPage"),common.PutToDebugLog(2,"EVENT, USER, addcontactpage (API_AddContactPage)"),global.intentaddeditct[0]="action=add",j$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"}),!0}catch(e){common.PutToDebugLogException(2,"plhandler: AddContactPage",e)}return!1}function je(e){try{wpa.webphone.InsertApplet(e)}catch(t){common.PutToDebugLogException(2,"plhandler: InsertApplet",t)}}function Be(){try{return common.EnterKeyPress()}catch(e){common.PutToDebugLogException(2,"plhandler: EnterKeyPress",e)}return!1}function $e(e){Q(e,"FILETRANSFER_DELIVERED:"+e)}function qe(e,t){try{if(Ot("GetTelSearchName"),!t||"function"!=typeof t)return void common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName callback is not definaed");if(common.isNull(e)||e.length<2)return void common.PutToDebugLog(2,"ERROR, plhandler: GetTelsearchName invalid number: "+e);common.GetTelsearchName(e,t)}catch(o){common.PutToDebugLogException(2,"plhandler: EnterKeyPress",o)}}function ze(e){try{common.bwanswer(e)}catch(t){common.PutToDebugLogException(2,"plhandler: bwanswer",t)}}function Ke(){try{global.wasSettModified&&common.SaveSettingsFile(common.GetActiveAccSettingsFilename(),function(e){e?common.PutToDebugLog(2,"EVENT, SaveSettingsFile from onappexit Successfull"):common.PutToDebugLog(2,"ERROR, SaveSettingsFile from onappexit Failed")})}catch(e){common.PutToDebugLogException(2,"plhandler: onappexit",e)}}function Xe(){Ot("getlogs"),common.PutToDebugLog(2,"EVENT, getlogs called");var e=global.logs;return global.logs="",e}function Je(){try{Ot("getlogsex"),common.PutToDebugLog(2,"EVENT, getlogsex called"),common.WinAPI("API_SetLogs",null,global.logs)}catch(e){common.PutToDebugLogException(2,"plhandler: getlogsex",e)}}function Ye(e){try{common.isNull(e)&&(e=""),common.PutToDebugLog(2,"APILOGS: "+e)}catch(t){common.PutToDebugLogException(2,"plhandler: putlogs",t)}}function Qe(){try{Ot("ImportContacts"),common.PutToDebugLog(2,"EVENT, importcontacts called"),common.DownloadContacts()}catch(e){common.PutToDebugLogException(2,"plhandler: ImportContacts",e)}}function Ze(e,t){try{Ot("delsettings"),global.phonestarted<2&&(common_public.PutToDebugLog(2,"EVENT, resetsettings set to TRUE"),common.SaveParameter("resetsettings","true")),common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_DelSettings",null,e):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.DelSettings(e),!0!==t&&common.delsettings(e)}catch(o){common.PutToDebugLogException(2,"plhandler: delsettings",o)}}function et(e){try{if(Ot("needratingrequest"),!e||"function"!=typeof e)return!1;if(global.phonestarted<2)return void At("needratingrequest",[e]);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_IsEncrypted",function(t){e(common.isNull(t)?"true"===t||!0===t?!0:!1:!1)});common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.NeedRatingRequest(e)}catch(t){common.PutToDebugLogException(2,"plhandler: needratingrequest",t),e(!1)}}function tt(){try{if(!common.isNull(platform)&&!common.isNull(platform.name)){var e=platform.name.toString();if(e=e.toLowerCase(),e.indexOf("mobile")>=0)return!0}var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}catch(o){common.PutToDebugLogException(2,"plhandler: IsMobileBrowser",o)}return!1}function ot(){try{return common.isNull(global.useengine)?"":global.useengine}catch(e){common.PutToDebugLogException(2,"plhandler: Getenginename",e)}}function nt(e){try{if(Ot("GetLastInvite"),!e||"function"!=typeof e)return void common.PutToDebugLog(2,"ERROR, plhandler: getlastinvite callback is not defined");if(global.phonestarted<2)return void At("GetLastInvite",[e]);var t=global.aline;if((common.isNull(t)||-3===t)&&(t=-1),common.getuseengine()===global.ENGINE_WEBRTC){t<1&&(t=common.GetBestLine());var o=common.GetEndpoint(t,"","",!1),n="";return isNull(o)||(n=o[common.EP_SIPINVITE]),void e(n)}if(common.getuseengine()===global.ENGINE_FLASH)return common.PutToDebugLog(2,"ERROR, getlastinvite is not supported by flash engine"),void e("");if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return void common.WinAPI("API_GetLastInvite",function(t){e(t)},t);if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return void e(wpa.webphone.GetGetLastInvite(t,e))}catch(i){common.PutToDebugLogException(2,"plhandler: GetLastInvite",i)}}function it(){try{if(Ot("API_RecFiles_Upload"),global.phonestarted<2)return void At("API_RecFiles_Upload",[]);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_RecFiles_Upload",null),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.API_RecFiles_Upload();common.PutToDebugLog(2,"WARNING, API_RecFiles_Upload not supported by engine: "+common.getuseengine())}catch(e){common.PutToDebugLogException(2,"plhandler: API_RecFiles_Upload",e)}return!1}function rt(e,t){try{if(Ot("API_RecFiles_UploadEx"),global.phonestarted<2)return void At("API_RecFiles_UploadEx",[e,t]);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_RecFiles_UploadEx",null,e,t),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.API_RecFiles_UploadEx(e,t);common.PutToDebugLog(2,"WARNING, API_RecFiles_UploadEx not supported by engine: "+common.getuseengine())}catch(o){common.PutToDebugLogException(2,"plhandler: API_RecFiles_UploadEx",o)}return!1}function at(){try{if(Ot("API_RecFiles_Clear"),global.phonestarted<2)return void At("API_RecFiles_Clear",[]);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_RecFiles_Clear",null),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.API_RecFiles_Clear();common.PutToDebugLog(2,"WARNING, API_RecFiles_Clear not supported by engine: "+common.getuseengine())}catch(e){common.PutToDebugLogException(2,"plhandler: API_RecFiles_Clear",e)}return!1}function st(){try{if(Ot("API_RecFiles_Del"),global.phonestarted<2)return void At("API_RecFiles_Del",[]);if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)return common.WinAPI("API_RecFiles_Del",null),!0;if(common.GetParameter("devicetype")===common.DEVICE_WEBPHONE())return wpa.webphone.API_RecFiles_Del();common.PutToDebugLog(2,"WARNING, API_RecFiles_Del not supported by engine: "+common.getuseengine())}catch(e){common.PutToDebugLogException(2,"plhandler: API_RecFiles_Del",e)}return!1}function lt(e){try{return stringres.get(e)}catch(t){common.PutToDebugLogException(2,"plhandler: getstringresource",t)}return""}function ct(e,t){try{Ot("Jvoip-"+e);var o=ot();if(common.isNull(o)||o.length<2)return void common.PutToDebugLog(2,"ERROR, Jvoip no engine available at the moment");if(o!==global.ENGINE_WEBPHONE&&o!==global.ENGINE_SERVICE)return void common.PutToDebugLog(2,"ERROR, Jvoip not applicable for engine: "+common.GetEngineDisplayName(o));if(common.isNull(e)||e.length<3)return void common.PutToDebugLog(2,"ERROR, Jvoip invalid api function name: "+e);var n=e.indexOf("(");n>0&&(e=e.substring(0,n)),e=common.Trim(e),common.isNull(t)&&(t=[]);for(var i="",r=0;r<t.length;r++)r>0&&(i+=","),i+=t[r];common.PutToDebugLog(2,"EVENT, USER, jvoip (API_Jvoip): "+e+"; arguments: ["+i+"]"),wpa.webphone.Jvoip(e,t)}catch(a){common.PutToDebugLogException(2,"plhandler: Jvoip",a)}}function ut(){return common.GetOneStunSrv()}function mt(e,t){try{Ot("RemoveCodecMaudio");var o=e;if(common.isNull(t)||!1===common.IsNumber(t))return common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid codec: "+t),e;if(common.isNull(o)||e.indexOf("m=audio")<0)return common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio invalid m=audio: "+o),e;var n=o.indexOf("/");if(n<0)return common.PutToDebugLog(2,"ERROR, RemoveCodecMaudio cannot parse m=audio: "+o),e;var i=o.substring(0,n);if(o=o.substring(n),(n=o.indexOf(" "))>0)return i+=o.substring(0,n),o=o.substring(n),o.indexOf(t+" ")>=0?o=o.replace(t+" ",""):o.indexOf(" "+t)>=0&&(o=o.replace(" "+t,"")),i+o}catch(r){common.PutToDebugLogException(2,"plhandler: RemoveCodecMaudio",r)}return e}function gt(e){try{var t=e,o=common.GetParameter("codec");if(common.isNull(o)||o.length<1||o.indexOf(",")<0&&!1===common.IsNumber(o)||"-1"===o)return e;var n=o.split(",");if(common.isNull(n)||n.length<1)return e;for(var i=!1,r=!1,a=!1,s=!1,l=common.ParamAsBool(common.GetParameter2("use_h264")),c=common.ParamAsBool(common.GetParameter2("use_vp8")),u=common.ParamAsBool(common.GetParameter2("use_vp9")),m=0;m<n.length;m++)common.isNull(n[m])||("1"===n[m]?i=!0:"2"===n[m]?r=!0:"5"===n[m]||"6"===n[m]?a=!0:"10"!==n[m]&&"11"!==n[m]&&"12"!==n[m]&&"13"!==n[m]||(s=!0));!1===common.Glop()&&(s=!1);var g=t.split("\n");if(common.isNull(g)&&g.length<10)return e;for(var d=-1,m=0;m<g.length;m++)if(!common.isNull(g[m])&&g[m].indexOf("m=audio")>=0){d=m;break}if(d<0)return common.PutToDebugLog(2,"ERROR, HandleWebrtcCodecs m=audio not found"),e;if(!1===i){var p="0";g[d]=mt(g[d],p);for(var h=g.length,m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}if(!1===r){var p="8";g[d]=mt(g[d],p);for(var h=g.length,m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}if(!1===a){for(var p="",h=g.length,m=0;m<h;m++)if(!common.isNull(g[m])&&g[m].indexOf("a=rtpmap:")>=0&&g[m].toLowerCase().indexOf("speex")>0){p=g[m].replace("a=rtpmap:",""),p=common.Trim(p);var f=p.indexOf(" ");f>0&&(p=common.Trim(p.substring(0,f)))}if(!common.isNull(p)&&p.length>0){g[d]=mt(g[d],p);for(var m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}}if(!1===s){for(var p="",h=g.length,m=0;m<h;m++)if(!common.isNull(g[m])&&g[m].indexOf("a=rtpmap:")>=0&&g[m].toLowerCase().indexOf("opus")>0){p=g[m].replace("a=rtpmap:",""),p=common.Trim(p);var f=p.indexOf(" ");f>0&&(p=common.Trim(p.substring(0,f)))}if(!common.isNull(p)&&p.length>0){g[d]=mt(g[d],p);for(var m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}}if(!1===l){for(var p="",h=g.length,m=0;m<h;m++)if(!common.isNull(g[m])&&g[m].indexOf("a=rtpmap:")>=0&&g[m].toLowerCase().indexOf("h264")>0){p=g[m].replace("a=rtpmap:",""),p=common.Trim(p);var f=p.indexOf(" ");f>0&&(p=common.Trim(p.substring(0,f)))}if(!common.isNull(p)&&p.length>0){g[d]=mt(g[d],p);for(var m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}}if(!1===c){for(var p="",h=g.length,m=0;m<h;m++)if(!common.isNull(g[m])&&g[m].indexOf("a=rtpmap:")>=0&&g[m].toLowerCase().indexOf("vp8")>0){p=g[m].replace("a=rtpmap:",""),p=common.Trim(p);var f=p.indexOf(" ");f>0&&(p=common.Trim(p.substring(0,f)))}if(!common.isNull(p)&&p.length>0){g[d]=mt(g[d],p);for(var m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}}if(!1===u){for(var p="",h=g.length,m=0;m<h;m++)if(!common.isNull(g[m])&&g[m].indexOf("a=rtpmap:")>=0&&g[m].toLowerCase().indexOf("vp9")>0){p=g[m].replace("a=rtpmap:",""),p=common.Trim(p);var f=p.indexOf(" ");f>0&&(p=common.Trim(p.substring(0,f)))}if(!common.isNull(p)&&p.length>0){g[d]=mt(g[d],p);for(var m=0;m<h;m++)!common.isNull(g[m])&&(g[m].indexOf("a=rtpmap:"+p)>=0||g[m].indexOf("a=rtcp-fb:"+p)>=0||g[m].indexOf("a=fmtp:"+p)>=0)&&(g.splice(m,1),m--,h--)}}t="";for(var m=0;m<g.length;m++)t.length>0&&(t+="\n"),t+=g[m];return common.PutToDebugLog(2,"EVENT, HandleWebrtcCodecs modified sdp: "+t),t}catch(b){common.PutToDebugLogException(2,"plhandler: HandleWebrtcCodecs",b)}return e}function dt(e){try{return e}catch(t){common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold",t)}return e}function pt(e){try{if(void 0===e||null===e)return e;if("Firefox"!==common.GetBrowser())return e;var t=e,o=t.split("\n");if(common.isNull(o)&&o.length<10)return e;t="";for(var n=0,i=-1,r=0;r<o.length;r++)o[r].indexOf("a=msid:")>=0&&(n++,i=r);if(n>1&&i>0){o.splice(i,1),common.PutToDebugLog(2,"EVENT, HandleWebrtcFirefoxHold_RemoveDuplicateHeader removed");for(var r=0;r<o.length;r++)t.length>0&&(t+="\n"),t+=o[r];return t}}catch(a){common.PutToDebugLogException(2,"plhandler: HandleWebrtcFirefoxHold_RemoveDuplicateHeader",a)}return e}function ht(){try{var e=!1,t=common.GetParameter("serveraddressbook_url");if(!common.isNull(t)&&t.length>0){var o=common.GetParameterInt("serveraddressbook_sync",0),n=common.GetParameterInt("serveraddressbook_status",2);n<1?e=!0:1===n&&o>0&&(e=!0),o>1&&(e=!0)}if(!0===e){common.IsHttps()&&(t=t.replace("http:","https:")),common.PutToDebugLog(3,"EVENT, DownloadServerAddressbook url: "+t);var i=new XMLHttpRequest;if("withCredentials"in i)i.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return void common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook, CORS not supported");i=new XDomainRequest,i.open("GET",t)}var r=0;i.onload=function(){try{common.PutToDebugLog(4,"EVENT, DownloadServerAddressbook.onload"),r=19;var e=i.responseText;return r=20,common.PutToDebugLog(2,"EVENT, DownloadServerAddressbook response: "+e),r=21,common.isNull(e)||e.length<1?(r=23,void common.PutToDebugLog(2,"ERROR, DownloadServerAddressbook response is NULL")):void ft(e)}catch(t){common.PutToDebugLogException(2,"DownloadServerAddressbook.onload inner ("+r+")",t)}},i.onerror=function(e){var t="";common.isNull(e)||(t=e.toString(),common.isNull(e.target)||(t=common.isNull(e.target.status)?t+" "+e.target.toString():t+" "+e.target.status.toString())),common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: onerror: "+t)},i.timeout=9e3,i.ontimeout=function(e){common.PutToDebugLog(2,"ERROR, common: DownloadServerAddressbook: Timeout")},i.send()}}catch(a){common.PutToDebugLogException(2,"plhandler: DownloadServerAddressbook",a)}}function ft(e){try{if(common.isNull(e)||e.length<1)return;var t=e.split("\r\n"),o=0;if(common.isNull(t))return void common.PutToDebugLog(2,"ERROR, ParserServerAddressbook list is NULL: "+e);for(var n=0;n<t.length;n++)if(!(common.isNull(t[n])||t[n].length<3||t[n].indexOf("\t")<1)){var i=t[n].split("\t");if(!(common.isNull(i)||i.length<2)){var r=i[0],a=i[1],s=0,l="",c="",u="",m="";if(!(common.isNull(r)||r.length<1||common.isNull(a)||a.length<1)){i.length>2&&(common.isNull(i[2])||"1"!==common.Trim(i[2])||(s=1)),i.length>3&&!common.isNull(i[3])&&common.Trim(i[3]).length>3&&(l=common.Trim(i[3])),i.length>4&&!common.isNull(i[4])&&common.Trim(i[4]).length>3&&(c=common.Trim(i[4])),i.length>5&&!common.isNull(i[5])&&common.Trim(i[5]).length>0&&(u=common.Trim(i[5])),i.length>6&&!common.isNull(i[6])&&common.Trim(i[6]).length>3&&(m=common.Trim(i[6]));var g="sip",d=a.replace("+","");common.IsNumber(d)&&(g="phone"),o++;ue(r,a,s,g,common.GetTickCount(),l,c,u,m,"1")}}}common.PutToDebugLog(4,"EVENT, ParserServerAddressbook: "+o.toString()+" contacts added sucessfully")}catch(p){common.PutToDebugLogException(2,"plhandler: ParserServerAddressbook",p)}}function bt(e,t){Ot("IsServiceInstalled"),common.IsServiceInstalled(e,t)}function vt(){return Ot("CanIUseWebrtc"),common.CanIUseWebRTC()}function _t(e,t,o){Ot("ShowToast-"+e),common.ShowToast(e,t,o)}function Et(e,t,o){Ot("AlertDialog-"+t),common.AlertDialog(e,t,o)}function Tt(e,t,o,n,i){wpa.webphone.API_SetCredentials(e,t,o,n,i)}function Pt(e,t,o,n){wpa.webphone.API_SetCredentialsMD5(e,t,o,n)}function St(e){wpa.webphone.API_CheckVoicemail(e)}function Nt(e){wpa.webphone.API_SetLine(e)}function wt(e){wpa.webphone.API_GetLine(e)}function It(e){wpa.webphone.API_GetLineStatus(e)}function Ct(e,t){wpa.webphone.API_Forward(e,t)}function Rt(e){wpa.webphone.API_IsMuted(e)}function yt(e){wpa.webphone.API_IsOnHold(e)}function Lt(e){wpa.webphone.API_GetAudioDeviceList(e)}function Dt(e){wpa.webphone.API_GetAudioDevice(e)}function Gt(e){wpa.webphone.API_SetAudioDevice(e)}function xt(e){wpa.webphone.API_GetVolume(e)}function Ot(e){try{if(!0===common.IsWindowsSoftphone())return;if(!1===global.wploaded){var t="ERROR,WapiTouced API called before webphone loaded: "+e;if(common.PutToDebugLog(2,t),"undefined"!=typeof console&&null!==console)if("undefined"!=typeof console.error&&null!==console.error)try{console.error(t)}catch(o){}else if("undefined"!=typeof console.log&&null!==console.log)try{console.log(t)}catch(o){}}}catch(n){common.PutToDebugLogSpecial(2,"EVENT, plhandler WapiTouced",!0,n)}}function At(e,arguments){common.isNull(e)||e.length<1||(kt(),common.isNull(yo)&&(yo=[]),common.isNull(arguments)&&(arguments=[]),common.PutToDebugLog(2,"EVENT,AddToQueueEn cached for execution after engine start: "+e.toLowerCase()+"("+arguments.toString()+")"),arguments.unshift(e),arguments.unshift(common.GetTickCount().toString()),yo.push(arguments))}function kt(){common.isNull(Lo)&&(Lo=setInterval(function(){if(++Do>1e5||Do>1e5&&(common.isNull(yo)||yo.length<1||global.phonestarted>=2))return void 0!==Lo&&null!==Lo&&clearInterval(Lo),Lo=null,yo=[],void(Do=0);if(!(common.isNull(yo)||yo.length<1)&&global.phonestarted>=2){var e=yo.shift();if(common.isNull(e)||e.length<2)return;var t=0;try{t=common.StrToInt(e[0])}catch(i){}e.shift();var o=e[0];if(common.isNull(o)||o.length<1)return void common.PutToDebugLog(2,"ERROR, handle API function queue invalid name(engine: "+common.getuseengine()+"): "+o);if(common.GetTickCount()-t>6e5)return void common.PutToDebugLog(2,"ERROR, handle API function queue(engine: "+common.getuseengine()+"): "+o+" (too late)");e.shift();var n="";common.isNull(e)||(n=e.toString()),common.PutToDebugLog(2,"EVENT, handle API function queue(engine: "+common.getuseengine()+"): "+o+" ("+n+");"),Ut(o,e)}},15))}function Ut(e,arguments){var t=window.plhandler[e];"function"==typeof t&&t.apply(window,arguments)}var Vt="",Wt=!1,Mt=null;global.isfirststart=!0,1==common.IsSDK()&&(common.PutToDebugLogSpecial(1,"EVENT, plhandler call HandleSettingsSDK",!1,""),global.domloaded_tick=common.GetTickCount(),i(function(e){if(common.PutToDebugLogSpecial(1,"EVENT, plhandler onload HandleSettingsSDK FINISHED: "+e,!1,""),common.PutToDebugLog(2,"EVENT, plhandler: initialize start"),common.Glv()<1)return void(global.webrtcavailable=0);j$(document).ready(function(){webphone_api.loadwebrtc_timestamp=common.GetTickCount(),webrtcapi_public.WebRtcIsSupported(function(e){function t(){if(common.EngineSelect(0),common.SetLanguage(),!1===global.onloaded_called){global.wploaded=!0,common.PutToDebugLogSpecial(1,"EVENT, plhandler webphone onLoaded",!1,"");try{webphone_api.onAppStateChangeCb("loaded")}catch(e){common.PutToDebugLogException(2,"plhandler: There is an error in onAppStateChange(loaded) callback",e)}try{webphone_api.onLoadedCb()}catch(e){common.PutToDebugLogException(2,"plhandler: There is an error in onLoaded() callback",e)}common.CallScriptingUrl(webphone_api.parameters.scurl_onload,"onLoad","","","",""),global.onloaded_called=!0,setTimeout(function(){global.onloaded_called=!1},5e3),webphone_api.webphone_loaded=!0,common.WebphoneIsLoaded()}}if("Windows"===common.GetOs()&&("MSIE"===common.GetBrowser()?e=!1:"Edge"===common.GetBrowser()&&(common.GetBrowserVersion()<14?e=!1:!1===e&&common.PutToDebugLog(2,"ERROR,plhandler Edge webrtc is not supported, getusermedia: "+typeof navigator.getUserMedia+"; RTCPeerConnection: "+typeof window.RTCPeerConnection))),"iOS"===common.GetOs()?(("Safari"===common.GetBrowser()||"iPhone"===common.GetBrowser())&&common.GetBrowserVersion()<11&&(e=!1),"Firefox"!==common.GetBrowser()||navigator.mozGetUserMedia||navigator.GetUserMedia||(e=!1),"Chrome"!==common.GetBrowser()||navigator.webkitGetUserMedia||navigator.GetUserMedia||(e=!1)):"Windows"===common.GetOs()&&"Safari"===common.GetBrowser()&&(e=!1),common.isNull(e)&&(e=""),common.PutToDebugLog(2,"EVENT, plhandler: initialize LoadWebrtc engine: "+e),!0===e){global.webrtcavailable=1,common.PutToDebugLog(2,"webrtc engine available (plh)");var o=common.GetEngine("webrtc"),n=common.GetParameter2("serveraddress_user");(common.isNull(n)||n.length<2)&&(n=common.GetParameter2("serveraddress")),(common.isNull(n)||n.length<2)&&(n=common.GetConfig("serveraddress")),common.isNull(n)&&(n=""),common.IsLanIP(common.GetWebrtcUpperServer())||n.length>0&&common.IsLanIP(n)?common.isNull(o)||(o.issupported_cache=0,o.available=0):!0===common.BrowserRequiresHttps(!0)?common.isNull(o)||(o.issupported_cache=1,o.available=2):common.isNull(o)||(o.issupported_cache=2,o.available=3)}else!1===e&&(global.webrtcavailable=0,common.PutToDebugLog(2,"webrtc engine NOT available"));!0===common.UseCustomAutoprov(!0)?common.GetCustomAutoprov(function(e){common.RecAutoprovCustom(e),t()}):t()})})}));var Ft=null,Ht=!1,jt=null,Bt=10,$t=185,qt=null,zt=null,Kt=!1,Xt=0,Jt="",Yt=!1,Qt=null,Zt=0,eo=0,to=!1,oo=!1,no=null,io=-1,ro=0,ao=0,so=null,lo=null,co=null,uo=!1,mo=0,go=null,po=0,ho=null,fo=null,bo=!1,vo=[],_o=[],Eo=null,To=[],Po=[],So=null,No=[],wo=[],Io=[],Co=[],Ro=null,yo=[],Lo=null,Do=0,Go={Reject:W,Accept:V,Hold:J,Hangup:k,GetAudioDevicesForMenu:g,Stop:Oe};return window.plhandler_public=Go,{Start:e,StartUp:n,Register:d,RegisterEx:p,CheckPresence:h,SetPresenceStatus:f,CheckBLF:b,GetVersionNS:v,GetVersionNSNum:_,GetVersionJava:E,IsEncrypted:T,SetSipHeader:P,GetSipHeader:S,GetSipMessage:N,ChangeTheme:w,GetWorkDir:I,Call:G,VideoCall:R,MuteVideo:y,ScreenShare:L,StopScreenShare:A,Hangup:k,Accept:V,Reject:W,Ignore:M,SetVideoSize:F,GetAvailableCallfunc:H,Forward:j,Conference:$,Transfer:q,Dtmf:z,MuteEx:K,IsMuted:X,Hold:J,IsOnHold:Y,SendChat:Q,SendSms:ee,Voicerecord:te,DevicePopup:ie,SetVolume:re,GetVolume:ae,SetLoudspeaker:se,PlaySound:le,AddContact:ce,DeleteContact:me,GetContact:de,ListContacts:pe,ListCallhistory:he,SetParameter:fe,GetParameter:be,SetLine:ve,GetLine:_e,LineToCallID:Ee,CallIDToLine:Te,IsRegistered:Re,IsInCall:ye,GetDeviceList:Le,GetDevice:De,SetDevice:Ge,StopEngine:xe,Stop:Oe,HelpWindow:Ue,BrowserWindowIsActive:ke,SettingsPage:Ve,DialPage:We,MessageInboxPage:Me,MessagePage:Fe,AddContactPage:He,InsertApplet:je,EnterKeyPress:Be,FileTransferCallback:$e,GetTelsearchName:qe,Cfin:D,bwanswer:ze,onappexit:Ke,getlogs:Xe,getlogsex:Je,putlogs:Ye,ImportContacts:Qe,delsettings:Ze,needratingrequest:et,IsMobileBrowser:tt,Getenginename:ot,GetLastInvite:nt,getstringresource:lt,Jvoip:ct,GetStatus:oe,GetRegFailReason:ne,Unregister:we,UnregisterEngine:Ie,HTTPKeepAlive:Ce,GetLineDetails:Pe,GetLastCallDetails:Se,GetIncomingDisplay:Ne,ParseReceivedParameters:a,GetOneStunSrv:ut,HandleWebrtcCodecs:gt,HandleWebrtcFirefoxHold:dt,HandleWebrtcFirefoxHold_RemoveDuplicateHeader:pt,IsServiceInstalled:bt,CanIUseWebrtc:vt,API_SetCredentials:Tt,API_SetCredentialsMD5:Pt,API_CheckVoicemail:St,API_SetLine:Nt,API_GetLine:wt,API_GetLineStatus:It,API_Forward:Ct,API_IsMuted:Rt,API_IsOnHold:yt,API_GetAudioDeviceList:Lt,API_GetAudioDevice:Dt,API_SetAudioDevice:Gt,API_GetVolume:xt,API_RecFiles_Upload:it,API_RecFiles_UploadEx:rt,API_RecFiles_Clear:at,API_RecFiles_Del:st,SendChatIsComposing:Ae,ShowToast:_t,AlertDialog:Et,LoginSkin:m}}();window.plhandler=plhandler,wpa.webphone=function(){function e(){try{common.PutToDebugLog(2,"EVENT, webphone Init called"),ke=!1,Ue=null,Ve=0,We=!1,Me=!0,Fe=!1,He=!1,ze=!1,Ke=0,window.webphone_pollstatus=!0,global.apppletloaded=!1}catch(e){common.PutToDebugLogException(2,"webphone: Init",e)}}function t(){try{common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs called"),void 0!==qe&&null!==qe&&clearTimeout(qe),qe=setTimeout(function(){common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting timer"),!0===window.webphone_pollstatus&&(common.PutToDebugLog(2,"EVENT, webphone: CheckWebphonetojs starting status polling"),Fe=!0,global.polltimerid=setInterval(function(){common.GetParameter("devicetype")===common.DEVICE_WEBPHONE()&&Ue&&Ue.API_Poll&&webphonetojs(Ue.API_Poll())},Be))},$e),setTimeout(function(){!0===Fe&&common.WinAPI("API_RegisterNoParam",function(){common.PutToDebugLog(2,"ERROR, webphone API_RegisterNoParam called")})},$e+1e3)}catch(e){common.PutToDebugLogException(2,"webphone: CheckWebphonetojs",e)}}function o(){try{common.PutToDebugLog(1,"EVENT, "+stringres.get("initializing")),e();try{if(!common.isNull(common.settmap2)){for(var t in common.settmap2){var o=common.settmap2[t];if(!common.isNull(o)&&!(t.indexOf("server")<0&&t.indexOf("username")<0&&t.indexOf("password")<0&&"1"===o[common.SETT_ISDEFAULT])){if("username"===t||"sipusername"===t||"password"===t){var i=o[common.SETT_VALUE];if(!common.isNull(i)&&i.length>0){i=n(i),je[t]=i;continue}}if("serveraddress"===t){var i=o[common.SETT_VALUE],r=je.serveraddress;if((common.isNull(i)||i.length<1)&&r.length>1)continue;if((common.isNull(r)||r.length<1)&&(common.isNull(i)||i.length<1)){je.serveraddress=common.GetParameter("serveraddress_user");continue}}else if("serveraddress_orig"===t)t="serveraddress";else if("upperserver"===t){var i=o[common.SETT_VALUE],r=common.GetParameter("serveraddress_orig");i===r||i.length<1?je[t]="":je[t]=common.GetParameter("serveraddress_orig")}else"aec"===t?t="aec_orig":"agc"===t?t="agc_orig":"denoise"===t?t="denoise_orig":"plc"===t?t="plc_orig":"has_video"===t?"0"===common.GetParameter2("video")?je[t]="false":je[t]="true":je[t]=o[common.SETT_VALUE]}}var a=common.GetParameter("extraoption");if(!common.isNull(a)&&a.length>0){a=common.Trim(a);var s=a.split(";");if(!common.isNull(s)&&s.length>0)for(var l=0;l<s.length;l++)if(!(common.isNull(s[l])||s[l].length<1||s[l].indexOf("=")<1)){var t=common.Trim(s[l].substring(0,s[l].indexOf("="))),o=common.Trim(s[l].substring(s[l].indexOf("=")+1));!common.isNull(t)&&t.length>0&&!common.isNull(o)&&(je[t]=o)}}}common.GetConfig("upperserverip").length>0&&(je.upperserverip=common.GetConfig("upperserverip")),common.GetConfig("upperserverdomain").length>0&&(je.upperserverdomain=common.GetConfig("upperserverdomain")),je.jsscriptevent=3,(common.isNull(je.serveraddress_orig)||je.serveraddress_orig.length<1)&&(je.serveraddress_orig=je.serveraddress);var c=webphone_api.parameters.customsipheader;if(!common.isNull(c)&&c.length>0&&(c=common.Trim(c),!common.isNull(je.customsipheader)&&je.customsipheader.toString().length>0?je.customsipheader.lastIndexOf(";")<je.customsipheader.length-1&&(je.customsipheader=je.customsipheader+";"):je.customsipheader="",je.customsipheader=je.customsipheader+c),!common.isNull(je.extraregisteraccounts)&&je.extraregisteraccounts.length>0&&(je.extraregisteraccounts="",!common.isNull(global.sipaccounts)&&global.sipaccounts.length>0))for(var l=0;l<global.sipaccounts.length;l++){var u=global.sipaccounts[l];common.isNull(u)||u.length<4||!0!==u.ismain&&!1!==u.enabled&&(je.extraregisteraccounts.length>0&&(je.extraregisteraccounts=je.extraregisteraccounts+";"),je.extraregisteraccounts=je.extraregisteraccounts+u.serveraddress+","+u.username+","+u.password+","+u.ival)}je.autohold="0",je.automute="0",common.LogAllParameters("Webphone all parameters:",je)}catch(m){common.PutToDebugLogException(2,"webphone: Start Setting parameters",m)}ue(),setTimeout(function(){Qe=common.GetTickCount(),ge()},1e3)}catch(m){common.PutToDebugLogException(2,"webphone: Start",m)}}function n(e){try{if(common.isNull(e))return common.PutToDebugLog(2,"ERROR, wp B4 invalid extracted value"),"";if(e.length<1)return"";var t=e;if(common.getuseengine()===global.ENGINE_WEBPHONE){if(t.indexOf("=")>=0)return t="Bb7Sb2VVVVV_"+common.B64Enc(t)}else if(common.getuseengine()===global.ENGINE_SERVICE||!0===common.IsWindowsSoftphone()){var o=common.GetParameterInt("srvupgrade_currversion",0);if(o>18&&(t.indexOf("%")>=0||t.indexOf("^")>=0||t.indexOf("&")>=0||t.indexOf("<")>=0||t.indexOf(">")>=0||t.indexOf("|")>=0||t.indexOf("'")>=0||t.indexOf("`")>=0||t.indexOf(",")>=0||t.indexOf(";")>=0||t.indexOf("=")>=0||t.indexOf("(")>=0||t.indexOf(")")>=0||t.indexOf("!")>=0||t.indexOf('"')>=0||t.indexOf("\\")>=0||t.indexOf("[")>=0||t.indexOf("]")>=0||t.indexOf('"')>=0||t.indexOf(".")>=0||t.indexOf("*")>=0||t.indexOf("?")>=0))return t="Bb7Sb2VVVVV_"+common.B64Enc(t)}}catch(n){common.PutToDebugLogException(2,"webphone: B64EncUserPwd",n)}return e}function i(){function o(e){common.PutToDebugLog(2,"EVENT, webphone: StartWin: API_SetParameters called"),common.PutToDebugLog(4,"EVENT, webphone: StartWin: API_SetParameters paramlist: "+r),i=37,common.WinAPI("API_SetParameters",function(e){ze=!0,Ke=0,i=41,common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),
e.indexOf("ok:")<0&&e.indexOf("true")<0&&common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_SetParameters callback: failed to save settings"),i=42,global.apistartstate=1,global.apistarttick=common.GetTickCount(),common.WinAPI("API_Start",function(e){i=43,common.SetDID(),He=!0,i=44,common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=45,common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (1), answ: "+e)):(i=46,a(),setTimeout(function(){global.phonestarted<2&&(global.phonestarted=2)},1e3))}),i=47,t()},e),setTimeout(function(){common.GetSrvVersions()},1e3)}var i=0;common.PutToDebugLog(2,"EVENT, webphone: StartWin called");try{e(),i=1;var r="",s=[];if(!common.isNull(common.settmap2)){i=2;for(var l in common.settmap2)if(!(common.isNull(l)||l.length<1)){var c=common.settmap2[l];"has_video"===l&&("0"===common.GetParameter2("video")?c[0]="false":c[0]="true"),l.indexOf("server")<0&&l.indexOf("username")<0&&l.indexOf("password")<0&&"1"===c[common.SETT_ISDEFAULT]||(s[l]=c[0])}i=3}i=4;for(var l in je)if(!(common.isNull(l)||l.length<1||"username"===l&&!common.isNull(s[l])&&s[l].length>0&&(common.isNull(je[l])||je[l].length<1))){if("loglevel"===l)try{common.GetLogLevel()>1?s.jsscriptevent="3":s.jsscriptevent="2";continue}catch(v){}s[l]=je[l]}i=5,!common.isNull(common.GetConfig("upperserverip"))&&common.GetConfig("upperserverip").length>0&&(s.upperserverip=common.GetConfig("upperserverip")),i=11,!common.isNull(common.GetConfig("upperserverdomain"))&&common.GetConfig("upperserverdomain").length>0&&(s.upperserverdomain=common.GetConfig("upperserverdomain")),i=12,common.isNull(s.serveraddress_orig||s.serveraddress_orig.length<1)&&(s.serveraddress_orig=s.serveraddress),i=13;var u=webphone_api.parameters.customsipheader;if(!common.isNull(u)&&u.length>0&&(i=14,u=common.Trim(u),!common.isNull(s.customsipheader)&&s.customsipheader.toString().length>0?(i=15,s.customsipheader.lastIndexOf(";")<s.customsipheader.length-1&&(s.customsipheader=s.customsipheader+";",i=16)):(i=17,s.customsipheader=""),s.customsipheader=s.customsipheader+u),i=21,!common.isNull(s.extraregisteraccounts)&&s.extraregisteraccounts.length>0&&(s.extraregisteraccounts="",!common.isNull(global.sipaccounts)&&global.sipaccounts.length>0))for(var m=0;m<global.sipaccounts.length;m++){var g=global.sipaccounts[m];common.isNull(g)||g.length<4||!0!==g.ismain&&!1!==g.enabled&&(s.extraregisteraccounts.length>0&&(s.extraregisteraccounts=s.extraregisteraccounts+";"),s.extraregisteraccounts=s.extraregisteraccounts+g.serveraddress+","+g.username+","+g.password+","+g.ival)}common.isNull(r)&&(r="");for(var l in s)if(!(common.isNull(l)||l.length<1||"callto"===l)){if("codec"===l){var d=common.GetParameter("prefcodec");if(!common.isNull(d)&&d.length>0&&"-1"===d)continue}"autohold"!==l&&"automute"!==l||(s[l]="0"),"sippassword"===l&&(l="password");var p=s[l];"password"===l&&!common.isNull(p)&&p.length>0&&(p=n(p)),!common.isNull(p)&&p.length>0&&(r.length>0&&(r+="\r\n"),r=r+l+"="+p)}i=22;var h=common.GetMinServiceVersion();r=r+"\r\nminserviceversion="+h,i=27,"rigitel"===common.GetConfig("brandname").toLowerCase()&&(r+="\r\nhasincomingcall=false");var f=common.GetNPLocation();i=31,common.isNull(f)&&(f=""),i=32;var b=f.indexOf("native/");b>0&&(f=f.substr(0,b)),i=33,r=r+"\r\nwebphoneurl="+f,i=34,r+="\r\ndummy=3",i=35,r="akarmidw=true\r\n"+r,i=36,o(r),Xe=setInterval(function(){return!0===ze?(common.isNull(Xe)||clearInterval(Xe),Xe=null,void(Ke=0)):++Ke>15?(common.PutToDebugLog(2,"ERROR, API_Setparameters timer reached maxloop"),common.isNull(Xe)||clearInterval(Xe),void(Xe=null)):(common.PutToDebugLog(2,"ERROR, API_Setparameters try to send parameters again, because earlier send failed"),void o(r))},1e3),i=51,setTimeout(function(){i=52,He||!0!==ze||(i=53,global.apistartstate=1,global.apistarttick=common.GetTickCount(),common.WinAPI("API_Start",function(e){i=54,common.SetDID(),common.isNull(e)&&(e=""),e=e.toString(),e=e.toLowerCase(),e.indexOf("ok:")<0&&e.indexOf("true")<0?(i=55,common.PutToDebugLog(2,"ERROR, webphone: StartWin: API_Start callback: failed to start webphone (2) answ: "+e)):(i=56,a())})),i=57,He=!1},2500),common.GetCustomMenus(),i=58}catch(_){common.PutToDebugLogException(2,"webphone: StartWin ("+i.toString()+")",_)}}function r(){try{common.PutToDebugLog(3,"EVENT, StartService"),i()}catch(e){common.PutToDebugLogException(2,"webphone: StartService",e)}}function a(){}function s(){try{return de()?Ue.API_Restart():(common.PutToDebugLog(3,"ERROR, webphone: Restart(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: Restart",e)}}function l(e){try{return de()?Ue.API_PushContactlist(e):(common.PutToDebugLog(3,"ERROR, webphone: PushContactlist(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: PushContactlist",t)}}function c(e){try{return de()?Ue.API_CheckPresence(e):(common.PutToDebugLog(3,"ERROR, webphone: CheckPresence(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: CheckPresence",t)}}function u(e){try{return de()?Ue.API_SetPresenceStatus(e):(common.PutToDebugLog(3,"ERROR, webphone: SetPresenceStatus(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: SetPresenceStatus",t)}}function m(e){try{return de()?Ue.API_CheckBLF(e):(common.PutToDebugLog(3,"ERROR, webphone: CheckBLF(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: CheckBLF",t)}}function g(){try{return de()?Ue.API_GetExeVersion():(common.PutToDebugLog(3,"ERROR, webphone: GetVersionNS(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: GetVersionNS",e)}return 0}function d(){try{return de()?Ue.API_GetExeVersionNumber():(common.PutToDebugLog(3,"ERROR, webphone: GetVersionNSNum(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: GetVersionNSNum",e)}return 0}function p(){try{return de()?Ue.API_GetVersion():(common.PutToDebugLog(3,"ERROR, webphone: GetVersionJava(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: GetVersionJava",e)}return 0}function h(){try{return de()?Ue.API_IsEncrypted():(common.PutToDebugLog(3,"ERROR, webphone: IsEncrypted(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: IsEncrypted",e)}return 0}function f(e){try{return de()?Ue.RegisterEx(e):(common.PutToDebugLog(3,"ERROR, webphone: RegisterEx(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: RegisterEx",t)}}function b(e,t){try{return de()?Ue.API_SetSIPHeader(e,t):(common.PutToDebugLog(3,"ERROR, webphone: SetSipHeader(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: SetSipHeader",o)}}function v(e,t){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetSipHeader(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";return Ue.API_GetSIPHeader(e,t)}catch(o){common.PutToDebugLogException(2,"webphone: GetSipHeader",o)}return""}function _(e,t,o){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetSipMessage(), no applethandle "),"ERROR, webphone: GetSipMessage(), no applethandle";return Ue.API_GetSIPMessage(e,t,o)}catch(n){common.PutToDebugLogException(2,"webphone: GetSipMessage",n)}return""}function E(e,t){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetGetLastInvite(), no applethandle "),"ERROR, webphone: GetSipHeader(), no applethandle";t(Ue.API_GetLastInvite(e))}catch(o){common.PutToDebugLogException(2,"webphone: GetGetLastInvite",o)}t("")}function T(){try{return de()?Ue.API_GetWorkdir():(common.PutToDebugLog(3,"ERROR, webphone: GetWorkDir(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: GetWorkDir",e)}return""}function P(){try{return de()?Ue.API_Unregister():(common.PutToDebugLog(3,"ERROR, webphone: Unregister(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: Unregister",e)}}function S(){try{return de()?Ue.API_HTTPKeepAlive():(common.PutToDebugLog(3,"ERROR, webphone: HTTPKeepAlive(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: HTTPKeepAlive",e)}}function N(e,t){try{return de()?Ue.API_Call(e,t):(common.PutToDebugLog(3,"ERROR, webphone: Call(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: Call",o)}}function w(e){try{return de()?Ue.API_Hangup(e):(common.PutToDebugLog(3,"ERROR, webphone: Hangup(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: Hangup",t)}}function I(e){try{return de()?Ue.API_Accept(e):(common.PutToDebugLog(3,"ERROR, webphone: Accept(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: Accept",t)}}function C(e){try{return de()?Ue.API_Reject(e):(common.PutToDebugLog(3,"ERROR, webphone: Reject(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: Reject",t)}}function R(e){try{return de()?Ue.API_Ignore(e):(common.PutToDebugLog(3,"ERROR, webphone: Ignore(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: Ignore",t)}}function y(e,t){try{return de()?Ue.API_Forward(e,t):(common.PutToDebugLog(3,"ERROR, webphone: Forward(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: Forward",o)}}function L(e){try{return de()?Ue.API_Conf(e):(common.PutToDebugLog(3,"ERROR, webphone: Conference(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: Conference",t)}}function D(e,t,o){try{return de()?Ue.API_ConfEx(e,t,o):(common.PutToDebugLog(3,"ERROR, webphone: ConferenceEx(), no applethandle "),!1)}catch(n){common.PutToDebugLogException(2,"webphone: ConferenceEx",n)}}function G(e,t){try{return de()?Ue.API_Transfer(e,t):(common.PutToDebugLog(3,"ERROR, webphone: Transfer(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: Transfer",o)}}function x(e,t){try{return de()?Ue.API_Dtmf(e,t):(common.PutToDebugLog(3,"ERROR, webphone: Dtmf(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: Dtmf",o)}}function O(e,t,o){try{return de()?Ue.API_MuteEx(e,t,o):(common.PutToDebugLog(3,"ERROR, webphone: MuteEx(), no applethandle "),!1)}catch(n){common.PutToDebugLogException(2,"webphone: MuteEx",n)}}function A(e){try{return de()?Ue.API_IsMuted(e):(common.PutToDebugLog(3,"ERROR, webphone: IsMuted(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: IsMuted",t)}}function k(e,t){try{return de()?Ue.API_Hold(e,t):(common.PutToDebugLog(3,"ERROR, webphone: Hold(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: Hold",o)}}function U(e){try{return de()?Ue.API_IsOnHold(e):(common.PutToDebugLog(3,"ERROR, webphone: IsOnHold(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: IsOnHold",t)}}function V(e,t,o,n){try{return de()?Ue.API_SendChat(e,t,o,n):(common.PutToDebugLog(3,"ERROR, webphone: SendChat(), no applethandle "),!1)}catch(i){common.PutToDebugLogException(2,"webphone: SendChat",i)}}function W(e,t,o){try{return de()?Ue.API_VoiceRecord(e,t,o):(common.PutToDebugLog(3,"ERROR, webphone: VoiceRecord(), no applethandle "),!1)}catch(n){common.PutToDebugLogException(2,"webphone: VoiceRecord",n)}}function M(){try{return de()?Ue.API_AudioDevice():(common.PutToDebugLog(3,"ERROR, webphone: AudioDevice(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: AudioDevice",e)}}function F(e,t){try{return de()?Ue.API_SetVolume(e,t):(common.PutToDebugLog(3,"ERROR, webphone: SetVolume(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: SetVolume",o)}}function H(e){try{return de()?Ue.API_GetVolume(e):(common.PutToDebugLog(3,"ERROR, webphone: GetVolume(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: GetVolume",t)}}function j(e,t,o,n,i,r,a,s,l){try{return de()?Ue.API_PlaySound(e,t,o,n,i,r,a,s,l):(common.PutToDebugLog(3,"ERROR, webphone: PlaySound(), no applethandle "),!1)}catch(c){common.PutToDebugLogException(2,"webphone: PlaySound",c)}return!1}function B(e,t){var o="";try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetRegFailReason(), no applethandle "),!1;o=Ue.API_GetRegFailReason(t)}catch(n){common.PutToDebugLogException(2,"webphone: GetVolume",n)}e(o)}function $(e,t){try{if(!We)return;if(common.isNull(global.maintimerid))return common.PutToDebugLog(3,"EVENT, webphone: SetParameter: cannot set parameter, because webphone is not running"),!1;if("callto"===e)return!1;if("codec"===e){var o=common.GetParameter("prefcodec");if(o.length>0&&"-1"===o)return!1}return de()?Ue.API_SetParameter(e,t):(common.PutToDebugLog(3,"ERROR, webphone: SetParameter(), no applethandle "),!1)}catch(n){common.PutToDebugLogException(2,"webphone: SetParameter",n)}}function q(e){try{if(common.isNull(e)||e<-4||e>35)return common.PutToDebugLog(3,"EVENT, webphone: SetLine: invalid line"),!1;if(!de())return common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),!1;Ue.API_SetLine(e)}catch(t){common.PutToDebugLogException(2,"webphone: SetLine",t)}}function z(e){try{if(common.isNull(e))return common.PutToDebugLog(3,"EVENT, webphone: SetLineEx: invalid line"),!1;if(!de())return common.PutToDebugLog(3,"ERROR, webphone: SetLineEx(), no applethandle "),!1;Ue.API_SetLineEx(e)}catch(t){common.PutToDebugLogException(2,"webphone: SetLine",t)}}function K(){try{return de()?Ue.API_GetLine():(common.PutToDebugLog(3,"ERROR, webphone: SetLine(), no applethandle "),-1)}catch(e){common.PutToDebugLogException(2,"webphone: GetLine",e)}return-1}function X(e){try{return de()?Ue.API_LineToCallID(e):(common.PutToDebugLog(3,"ERROR, webphone: LineToCallID(), no applethandle "),-1)}catch(t){common.PutToDebugLogException(2,"webphone: LineToCallID",t)}return""}function J(e){try{return de()?Ue.API_CallIDToLine(e):(common.PutToDebugLog(3,"ERROR, webphone: CallIDToLine(), no applethandle "),-1)}catch(t){common.PutToDebugLogException(2,"webphone: CallIDToLine",t)}return-10}function Y(e){try{return de()?Ue.API_GetLineDetails(e):(common.PutToDebugLog(3,"ERROR, webphone: GetLineDetails(), no applethandle "),"")}catch(t){common.PutToDebugLogException(2,"webphone: GetLineDetails",t)}return""}function Q(){try{return de()?Ue.API_IsRegistered():(common.PutToDebugLog(3,"ERROR, webphone: IsRegistered(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: IsRegistered",e)}}function Z(e){try{return de()?Ue.API_GetAudioDeviceList(e):(common.PutToDebugLog(3,"ERROR, webphone: GetAudioDeviceList(), no applethandle "),"")}catch(t){common.PutToDebugLogException(2,"webphone: GetAudioDeviceList",t)}}function ee(e){try{return de()?Ue.API_GetAudioDevice(e):(common.PutToDebugLog(3,"ERROR, webphone: GetAudioDevice(), no applethandle "),"")}catch(t){common.PutToDebugLogException(2,"webphone: GetAudioDevice",t)}}function te(e,t,o){try{return de()?Ue.API_SetAudioDevice(e,t,o):(common.PutToDebugLog(3,"ERROR, webphone: SetAudioDevice(), no applethandle "),!1)}catch(n){common.PutToDebugLogException(2,"webphone: SetAudioDevice",n)}}function oe(e,t,o,n){try{return de()?Ue.API_SetPushNotifications(e,t,o,n):(common.PutToDebugLog(3,"ERROR, webphone: SetPushNotifications(), no applethandle "),!1)}catch(i){common.PutToDebugLogException(2,"webphone: SetPushNotifications",i)}}function ne(){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: Exit(), no applethandle "),!1;var e=Ue.API_Exit();return common.isNull(e)&&(e=!1),common.PutToDebugLog(3,"EVENT, webphone: Exit result: "+e.toString()),e}catch(t){common.PutToDebugLogException(2,"webphone: Exit",t)}}function ie(e,t){try{return de()?Ue.API_SendChatIsComposing(e,t):(common.PutToDebugLog(3,"ERROR, webphone: SendChatIsComposing(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: SendChatIsComposing",o)}}function re(e){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: NeedRatingRequest(), no applethandle "),e(!1),!1;e(Ue.API_NeedRatingRequest())}catch(t){common.PutToDebugLogException(2,"webphone: NeedRatingRequest",t)}}function ae(){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetLastCallDetails(), no applethandle "),global.lastcalldetails;var e=Ue.API_GetLastCallDetails();if(!common.isNull(e)&&e.length>0){var t=e.split(",");common.isNull(t)&&(t="");for(var o="",n=0;n<t.length;n++)common.isNull(t[n])||t[n].length<1||(o.length>0&&(o+="<br>"),o+=common.Trim(t[n]));if(o.length>0)return o}}catch(i){common.PutToDebugLogException(2,"webphone: GetLastCallDetails",i)}return global.lastcalldetails}function se(){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: GetIncomingDisplay(), no applethandle "),"";var e=Ue.API_GetIncomingDisplay();return common.PutToDebugLog(5,"EVENT, webphone: API_GetIncomingDisplay: "+e),e}catch(t){common.PutToDebugLogException(2,"webphone: GetIncomingDisplay",t)}return""}function le(e){try{return de()?Ue.API_DelSettings(e):(common.PutToDebugLog(3,"ERROR, webphone: DelSettings(), no applethandle "),"")}catch(t){common.PutToDebugLogException(2,"webphone: GetIncomingDisplay",t)}return""}function ce(e,t){try{if(common.getuseengine()===global.ENGINE_WEBPHONE){if(!de())return common.PutToDebugLog(3,"ERROR, webphone: Jvoip(), no applethandle "),!1;Ue[e].apply(Ue,t)}else if(common.getuseengine()===global.ENGINE_SERVICE){var o=null,n=null,i=null,r=null,a=null,s=null,l=null,c=null,u=null;if(!common.isNull(t)&&t.length>0)for(var m=0;m<t.length;m++)0===m&&(o=t[0]),1===m&&(n=t[1]),2===m&&(i=t[2]),3===m&&(r=t[3]),4===m&&(a=t[4]),5===m&&(s=t[5]),6===m&&(l=t[6]),7===m&&(c=t[7]),8===m&&(u=t[8]);common.WinAPI(e,null,o,n,i,r,a,s,l,c,u)}}catch(g){common.PutToDebugLogException(2,"webphone: Jvoip",g)}}function ue(){try{if(global.apppletloaded)return;return global.apppletloaded=!0,common.PutToDebugLog(2,"EVENT, webphone LoadApplet called"),window.attributes=Ge,window.parameters=je,mwpdeploy.runApplet(Ge,je,"1.5"),Me=common.GetParameterBool("isfirststart",!0),ke=!0,!0}catch(e){common.PutToDebugLogException(2,"webphone: LoadApplet",e)}}function me(e){try{common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet called"),j$("#wpappletconatiner").remove();var t='<div id="wpappletconatiner" style="z-index:10000; position:absolute; float:left; top:0; left:0; line-height: 1px; font-size: 1px;">'+e+"</div>";j$("body").append(t),common.PutToDebugLog(2,"EVENT, webphone LoadApplet InsertApplet inserted")}catch(o){common.PutToDebugLogException(2,"webphone: InsertApplet",o)}}function ge(){if(Ve>20)return void common.PutToDebugLog(2,"ERROR, waitForWebphone maxloop elapsed");if(global.useengine.length>0&&"java"!==global.useengine)return void common.PutToDebugLog(2,"ERROR, waitForWebphone useengine not set or incorrect: "+global.useengine);if(common.GetTickCount()-Qe>45e3&&global.phonestarted<3){var e=100;if(!1===common.IsSDK()){var o=j$.mobile.activePage.attr("id");if(!common.isNull(o)&&o.indexOf("_settings")>0)return void setTimeout(function(){ge()},1e3);e=common.GetDeviceWidth(),!common.isNull(e)&&common.IsNumber(e)||(e=200)}common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_1");var n=common.GetDeviceHeight();common.isNull(n)&&(n=200),j$("#webphone").css("position","absolute"),j$("#webphone").css("top","100px"),j$("#webphone").width(e),j$("#webphone").height(n-100)}if(!1===global.applet_started&&global.phonestarted<3)return void setTimeout(function(){ge()},250);if((common.isNull(Je)||common.isNull(Ye)||Je<10||Ye<10)&&(Je=common.GetDeviceWidth(),(common.isNull(Je)||common.isNull(Ye)||Je<50||Ye<50)&&(Je=150,Ye=100)),Ve++,We=de())setTimeout(function(){j$("#webphone").width(1),j$("#webphone").height(1)},10),global.phonestarted<2&&(global.phonestarted=2),common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="none"),Ve=0,common.SaveParameter("isfirststart","false"),t(),common.PutToDebugLog(2,"EVENT, appletAvailable: "+We),a();else{var i=0;if(i=!0===Me?25:50,Ve>=i&&global.phonestarted<3){common.PutToDebugLog(2,"WARNING, waitForWebphone display Applet, because no handle found_2");var n=common.GetDeviceHeight();common.isNull(n)&&(n=200),j$("#webphone").css("position","absolute"),j$("#webphone").css("top","100px"),j$("#webphone").width(Je-1),j$("#webphone").height(n-100),common.isNull(document.getElementById("javaerrormsg"))||(document.getElementById("javaerrormsg").style.display="block")}setTimeout(function(){ge()},450)}}function de(){if(!1===global.applet_started)return!1;if(null===Ue||void 0===Ue){try{Ue=document.getElementById("webphone")}catch(a){}if(null==Ue){var e=null;try{e=document.applets,0==e.length&&(e=document.getElementsByTagName("object")),0==e.length&&(e=document.getElementsByTagName("applet"));for(var t=0;t<e.length;++t)try{if("undefined"!=typeof e[t].API_Call){Ue=e[t];break}}catch(a){}}catch(a){}if(null==Ue)try{Ue=document.applets[0]}catch(a){}null==Ue&&common.PutToDebugLog(3,"ERROR, webphone: initcheck(), cannot find applet handle")}if(null!=Ue)try{var o=Ue.getSubApplet();null!=o&&(Ue=o)}catch(a){}}var n="",i=navigator.userAgent.toLowerCase();try{if(null==Ue)return!1;if(void 0!==Ue&&(n=Ue.toString()),i.indexOf("msie")>0||i.indexOf("trident")>0)for(var r in Ue)if("contentDocument"===r){if(null==Ue)return!1;n=Ue[r].toString();break}}catch(a){common.PutToDebugLogException(2,"ERROR, webphone: initcheck",a)}return null==n||""==n||n.toLowerCase().indexOf("[object")>=0&&n.toLowerCase().indexOf("[object")<5?(Ue=null,!1):(window.webphone_handle=Ue,!0)}function pe(e,t,o,n,i){try{return de()?Ue.API_SetCredentials(e,t,o,n,i):(common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentials(), no applethandle "),!1)}catch(r){common.PutToDebugLogException(2,"webphone: API_SetCredentials",r)}}function he(e,t,o,n){try{return de()?Ue.API_SetCredentials(e,t,o,n):(common.PutToDebugLog(3,"ERROR, webphone: API_SetCredentialsMD5(), no applethandle "),!1)}catch(i){common.PutToDebugLogException(2,"webphone: API_SetCredentialsMD5",i)}}function fe(e){try{return de()?Ue.API_CheckVoicemail(e):(common.PutToDebugLog(3,"ERROR, webphone: API_CheckVoicemail(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_CheckVoicemail",t)}}function be(e){try{return de()?Ue.API_SetLine(e):(common.PutToDebugLog(3,"ERROR, webphone: API_SetLine(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_SetLine",t)}}function ve(e){try{return de()?Ue.API_GetLine(e):(common.PutToDebugLog(3,"ERROR, webphone: API_GetLine(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_GetLine",t)}}function _e(e){try{return de()?Ue.API_GetLineStatus(e):(common.PutToDebugLog(3,"ERROR, webphone: API_GetLineStatus(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_GetLineStatus",t)}}function Ee(e,t){try{return de()?Ue.API_Forward(e,t):(common.PutToDebugLog(3,"ERROR, webphone: API_Forward(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: API_Forward",o)}}function Te(e){try{return de()?Ue.API_IsMuted(e):(common.PutToDebugLog(3,"ERROR, webphone: API_IsMuted(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_IsMuted",t)}}function Pe(e){try{return de()?Ue.API_IsOnHold(e):(common.PutToDebugLog(3,"ERROR, webphone: API_IsOnHold(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_IsOnHold",t)}}function Se(e){try{return de()?Ue.API_GetAudioDeviceList(e):(common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDeviceList(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_GetAudioDeviceList",t)}}function Ne(e){try{return de()?Ue.API_GetAudioDevice(e):(common.PutToDebugLog(3,"ERROR, webphone: API_GetAudioDevice(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_GetAudioDevice",t)}}function we(e){try{return de()?Ue.API_SetAudioDevice(e):(common.PutToDebugLog(3,"ERROR, webphone: API_SetAudioDevice(), no applethandle "),!1)}catch(t){common.PutToDebugLogException(2,"webphone: API_SetAudioDevice",t)}}function Ie(e){try{if(!de())return common.PutToDebugLog(3,"ERROR, webphone: API_GetVolume(), no applethandle "),!1;var t=Ue.API_GetVolume(e);return common.PutToDebugLog(2,"webphone: GetVolume java returned: "+t.toString()),t}catch(o){common.PutToDebugLogException(2,"webphone: API_GetVolume",o)}}function Ce(){try{return de()?Ue.API_RecFiles_Upload():(common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Upload(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: API_RecFiles_Upload",e)}return!1}function Re(e,t){try{return de()?Ue.API_RecFiles_UploadEx(e,t):(common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_UploadEx(), no applethandle "),!1)}catch(o){common.PutToDebugLogException(2,"webphone: API_RecFiles_UploadEx",o)}return!1}function ye(){try{return de()?Ue.API_RecFiles_Clear():(common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Clear(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: API_RecFiles_Clear",e)}return!1}function Le(){try{return de()?Ue.API_RecFiles_Del():(common.PutToDebugLog(3,"ERROR, webphone: API_RecFiles_Del(), no applethandle "),!1)}catch(e){common.PutToDebugLogException(2,"webphone: API_RecFiles_Del",e)}return!1}var De=webphone_api.getbasedir2()+"native",Ge={id:"webphone",code:"webphone.webphone.class",name:"webphone",archive:"webphone.jar",codebase:De,width:1,height:1,MAYSCRIPT:!0},xe="X-Webdomain: "+common.GetWebdomain(),Oe=common.GetParameter("companyname");!common.isNull(Oe)&&Oe.length>0&&(xe=xe+"\r\nX-Company: "+Oe);var Ae=common.GetParameter("brandname");!common.isNull(Ae)&&Ae.length>0&&(xe=xe+"\r\nX-Brand: "+Ae);var ke,Ue,Ve,We,Me,Fe,He,je={serveraddress:"",username:"",MAYSCRIPT:!0,mayscript:"yes",scriptable:!0,jsscriptevent:3,autocfgsave:3,align:"middle",customsipheader:xe,loglevel:5,canopenlogview:!1,hasincomingcall:!1,haschat:1,pluginspage:"https://java.com/download/",permissions:"all-permissions",alt:"Enable or install java: https://www.java.com/en/download/index.jsp",java_arguments:"-Djava.net.preferIPv4Stack=true -Dsun.net.maxDatagramSockets=60"},Be=300,$e=8e3,qe=null,ze=!1,Ke=0,Xe=null,Je=0,Ye=0,Qe=0;window.webphone_handle=Ue,window.webphone_pollstatus=!0;var Ze={StartWin:i,webphone_started:!1,PushContactlist:l,CheckPresence:c,SetPresenceStatus:u};return window.webphone_public=Ze,{InsertApplet:me,Start:o,StartWin:i,StartService:r,LoadApplet:ue,Restart:s,PushContactlist:l,StartPresence:a,CheckPresence:c,SetPresenceStatus:u,CheckBLF:m,GetVersionNS:g,GetVersionNSNum:d,GetVersionJava:p,IsEncrypted:h,RegisterEx:f,SetSipHeader:b,GetSipHeader:v,GetSipMessage:_,GetGetLastInvite:E,GetWorkDir:T,Unregister:P,HTTPKeepAlive:S,Call:N,Hangup:w,Accept:I,Reject:C,Ignore:R,Forward:y,Conference:L,ConferenceEx:D,Transfer:G,Dtmf:x,MuteEx:O,IsMuted:A,Hold:k,IsOnHold:U,SendChat:V,VoiceRecord:W,AudioDevice:M,SetVolume:F,GetVolume:H,PlaySound:j,GetRegFailReason:B,SetParameter:$,SetLine:q,SetLineEx:z,GetLine:K,LineToCallID:X,CallIDToLine:J,GetLineDetails:Y,IsRegistered:Q,GetAudioDeviceList:Z,GetAudioDevice:ee,SetAudioDevice:te,SetPushNotifications:oe,Exit:ne,NeedRatingRequest:re,Jvoip:ce,GetLastCallDetails:ae,GetIncomingDisplay:se,DelSettings:le,API_SetCredentials:pe,API_SetCredentialsMD5:he,API_CheckVoicemail:fe,API_SetLine:be,API_GetLine:ve,API_GetLineStatus:_e,API_Forward:Ee,API_IsMuted:Te,API_IsOnHold:Pe,API_GetAudioDeviceList:Se,API_GetAudioDevice:Ne,API_SetAudioDevice:we,API_GetVolume:Ie,API_RecFiles_Upload:Ce,API_RecFiles_UploadEx:Re,API_RecFiles_Clear:ye,API_RecFiles_Del:Le,SendChatIsComposing:ie}}(),wpa.notifications=function(){function e(){try{global.creditRequestIval=100,global.closeCallAtivity=!1,b=!1,m=0;var e=common.GetTickCount();N=e,w=e,I=e,g=0,d=!1,p=!1,Te="",h="",global.last_event="",y=e,global.httpkatimer=e,global.audio_devices_loaded=!1,common.GetParameter("cache_audio_rec_device_list").length>5&&(global.audio_devices_loaded=!0),global.lastcallduration=0,D=-1,G=e,O=e,B=null,$="",q="";var t=common.GetParameter2("ringtimeout"),o=common.GetParameter2("ringtimeoutin"),n=common.GetParameter2("ringtimeoutout"),i=common.GetParameter2("calltimeout");if((common.isNull(t)||t.length<2||!1===common.IsNumber(t))&&(t=9e4),(common.isNull(o)||o.length<2||!1===common.IsNumber(o))&&(o=0),(common.isNull(n)||n.length<2||!1===common.IsNumber(n))&&(n=0),(common.isNull(i)||i.length<2||!1===common.IsNumber(i))&&(t=108e5),k=common.StrToInt(t),U=common.StrToInt(o),V=common.StrToInt(n),W=common.StrToInt(i),global.ringstart_time=0,global.callstart_time=0,global.useajax_forservice=!1,global.wsuser_succeded=!1,M=!1,global.acallcount=0,global.enstarteddisplayed=!1,F=!1,Ee=0,global.httpheaderslogged=!1,global.onregisteredcalled=!1,global.wsc_contimeout=0,global.wsc_reqtimeout=0,global.firstregister_sessiontick=0,common.isNull(document.getElementById("loader")))if(common.PutToDebugLog(2,"EVENT, init adding loader iframe, because not found in page"),common.isNull(document.body))common.PutToDebugLog(2,"ERROR, init adding loader iframe, document.body is NULL");else{var r=document.createElement("iframe");r.style.display="none",r.style.height="0",r.style.width="0",r.id="loader",r.setAttribute("allow","microphone; camera"),document.body.appendChild(r)}f=common.GetParameterInt("closecall_timeout",8e3),f<999&&(f*=1e3)}catch(a){common.PutToDebugLogException(2,"notifications: Init",a)}}function t(o){var l=0;try{if(global.initcalled||(global.initcalled=!0,e()),!common.isNull(o)&&o.length>0)try{var m=o.split(",");if(!common.isNull(m)&&m.length>0){for(var g="",f=0;f<m.length;f++)common.isNull(m[f])&&(m[f]=""),m[f]=common.Trim(m[f]),0===m[f].indexOf("_BASE64_")&&(m[f]=common.B64Dec(m[f]),common.isNull(m[f])&&(m[f]=""),m[f]=common.Trim(m[f])),g.length>0&&(g+=","),g+=m[f];!common.isNull(g)&&g.length>0&&(o=g)}}catch(Xt){common.PutToDebugLogException(2,"notifications: ProcessNotifications base64 decode",Xt)}if(ie<0&&(ie=common.IsCExt()),common.isNull(Z)&&common.getuseengine().length>0&&(Z=common.Te2(),common.getuseengine()!==global.ENGINE_WEBRTC&&(Z=!1),Z)){var N=[];N.push("L"),N.push("i"),N.push("m"),N.push("i"),N.push("t"),N.push(" "),N.push("f"),N.push("u"),N.push("n"),N.push("c");var w=N.join("");setTimeout(function(){common.PutToDebugLog(3,"EVENT, "+w)},920),N=[],N.push("S"),N.push("T"),N.push("A"),N.push("T"),N.push("U"),N.push("S"),ne=N.join("")}if(Z&&!common.isNull(ne)&&ne.length>0){var I="";if(!common.isNull(global.ep)&&global.ep.length>0)for(var f=0;f<global.ep.length;f++)if(!common.isNull(global.ep[f][common.EP_CALLID])&&global.ep[f][common.EP_CALLID].length>3){I=global.ep[f][common.EP_CALLID];break}!common.isNull(I)&&I.length>3&&!1===c(I)&&o.indexOf(ne)>=0&&(o=o.replace(ne,""),o=common.Trim(o),o=o.substring(1),o=common.Trim(o))}if(l=10,!b){global.presence_started=!1,b=!0,common.isNull(global.maintimerid)||clearInterval(global.maintimerid),global.maintimerid=null,global.maintimerid=setInterval(function(){n()},C),common.LcAc(!0,!1),l=14;try{if(0==common.IsSDK()){var y=common.GetColortheme(),G=themes.gettheme("theme_"+y);if(common.isNull(G))L="#ffffff";else{var x=G.fontcstatus;L=common.isNull(x.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))?"#ffffff":x}}}catch(Jt){common.PutToDebugLogException(2,"notifications: ProcessNotifications at init 1",Jt)}}if(l=20,common.isNull(o)||o.length<1)return;if(o=o.replace("NORETRY",""),X=common.Trim(o),0===X.indexOf("START")&&(X.indexOf("api")>0||X.indexOf("sip")>0)&&(global.apistartstate=2,plhandler_public.GetAudioDevicesForMenu(100)),!1===global.applet_started&&common.getuseengine()===global.ENGINE_WEBPHONE&&"START,api"===X){global.applet_started=!0,l=24;var O=common.GetParameter2("serveraddress_user");if((common.isNull(O)||O.length<2)&&(O=common.GetParameter2("serveraddress")),(common.isNull(O)||O.length<2)&&common.PutToDebugLog(2,"EVENT, notifications ProcessNotifications serveraddress not set"),!1===global.usestorage&&!common.CheckDID(O,!1)){var N=[];N.push("E"),N.push("R"),N.push("R"),
N.push("O"),N.push("R"),N.push(","),N.push("S"),N.push("e"),N.push("r"),N.push("v"),N.push("e"),N.push("r"),N.push(" "),N.push("n"),N.push("o"),N.push("t"),N.push(" "),N.push("a"),N.push("l"),N.push("l"),N.push("o"),N.push("w"),N.push("e"),N.push("d"),N.push("_"),N.push("3");var w=N.join("");return l=26,void setTimeout(function(){common.PutToDebugLog(1,w+" "+O)},1251)}}if(l=30,X.indexOf("CHATCOMPOSING")>=0){var A=0,k="",U=X.indexOf(",");if(U>0&&(l=32,X=X.substring(U+1),(U=X.indexOf(","))>0&&(l=34,A=common.Trim(X.substring(0,U)),X=X.substring(U+1),(U=X.indexOf(","))>0))){l=36,k=common.Trim(X.substring(0,U));var V=common.Trim(X.substring(U+1));!common.isNull(V)&&common.IsNumber(V)&&1===common.StrToInt(V)&&(l=39,s(k+" "+stringres.get("composing")+"...","EVENT",1,-1))}return}if(l=40,X.indexOf("SERVERCONTACTS")>=0){if(common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void common.PutToDebugLog(2,"ERROR, notifications: "+X);l=44;var W="",U=0;U=X.indexOf(","),U>0&&(W=common.Trim(X.substring(U+1,X.length))),l=48,common.SaveParameter("servercontacts",W),!common.isNull(W)&&W.length>0&&common.PutToDebugLog(2,"EVENT, servercontacts list: "+W)}if(l=50,X.indexOf("PRESENCE")>=0&&!0===common.UsePresence2()){if(common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void common.PutToDebugLog(2,"ERROR, notifications: "+X);var F="",U=0;if(U=X.indexOf(","),l=54,U>0){F=common.Trim(X.substring(U+1,X.length));var H="",j="",re="",ae="",ce="",ue=F.split(",");if(!common.isNull(ue)&&ue.length>1){H=common.Trim(ue[0]),j=common.Trim(ue[1]),ue.length>2&&(re=common.Trim(ue[2])),ue.length>3&&(ae=common.Trim(ue[3])),ue.length>4&&(ce=common.Trim(ue[4]));var me="-1";(common.isNull(re)||re.length<1)&&(re=j),me=common.SaveReceivedPresence2(H,re),"-2"===me&&j.length>1&&re!==j&&(me=common.SaveReceivedPresence2(H,j));try{webphone_api.onPresenceCb(H,j,ae,ce)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onPresenceStateChange() callback",Yt)}l=58,!1===common.IsSDK()&&wpa._dialpad.PopulateListRecents(),l=59,!0===global.isContactdetailsStarted&&!1===common.IsSDK()&&wpa._contactdetails.PopulateData(),!0===global.isMessageStarted&&message_public.DisplayPresence(me)}}}if(X.indexOf("BLF")>=0&&common.GetParameterInt("enableblf",1)>0){if(common.PutToDebugLog(3,"EVENT, notifications: "+X),X.toLowerCase().indexOf("error")>=0)return void common.PutToDebugLog(2,"ERROR, notifications: "+X);var ge="",U=0;if(U=X.indexOf(","),l=54,U>0){ge=common.Trim(X.substring(U+1,X.length));var H="",de="",j="",pe="",he=ge.split(",");if(!common.isNull(he)&&he.length>1){H=common.Trim(he[0]),de=common.Trim(he[1]),he.length>2&&(j=common.Trim(he[2])),he.length>3&&(pe=common.Trim(he[3]));try{webphone_api.onBLFCb(H,de,j,pe)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onBLFStateChange() callback",Yt)}}}}l=60,z="",K="";var U=0;if("["===X.charAt(0)&&(U=X.indexOf("]"))>0&&(X=common.Trim(X.substring(U+1,X.length))),l=63,U=X.indexOf(","),U>0?(z=common.Trim(X.substring(0,U)),X=common.Trim(X.substring(U+1,X.length))):z="EVENT",l=65,"ANSWER"===z)return l=69,void common.HttpAsyncHandler(X);if(l=70,"DTMF"===z){var fe=-1,be=common.Trim(o),ve=be.indexOf(",");ve>0&&(be=be.substring(ve+1),(ve=be.indexOf(","))>0&&(be=common.Trim(be.substring(0,ve)),!common.isNull(be)&&common.IsNumber(be)&&(fe=common.StrToInt(be))));try{webphone_api.onDTMFCb(X,fe)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onDTMF() callback",Yt)}}if("STATUS"!==z&&"CDR"!==z&&"CHAT"!==z&&"SUBSCRIBE"!==z&&"NOTIFY"!==z&&"EVENT"!==z&&"ERROR"!==z&&"WARNING"!==z&&"POPUP"!==z&&"CREDIT"!==z&&"RATING"!==z&&"MWI"!==z&&"START"!==z&&"VREC"!==z&&"DTMF"!==z&&"PRESENCE"!==z&&"CHATREPORT"!==z&&"CHATCOMPOSING"!==z&&"BLF"!==z&&"LINE"!==z&&"STOP"!==z&&"LINEDETAILS"!==z&&"QRCODE"!==z&&"NOTIFICATION"!==z&&"GROUP"!==z)return l=74,void(!1===Z&&common.PutToDebugLog(5,"WARNING, unknown notification a: "+o));l=71;try{webphone_api.onEventCb("event",common.Trim(o),null)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onEvent() callback at notification: "+o,Yt)}try{webphone_api.RecEvt(common.Trim(o))}catch(Yt){common.PutToDebugLogException(2,"There is an error in onEvents() callback at notification: "+o,Yt)}try{ie>0&&"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents(o)}catch(Yt){common.PutToDebugLogException(2,"notifications: ProcessNotifications AndroidWebphoneJsInterface send",Yt)}if(o.indexOf("-1,Stop")>=0&&global.phonestarted>0&&common.OpenSettings(!0,8),"GROUP"===z&&X.toLowerCase().indexOf("error")<0&&!1===common.IsSDK())try{var _e=X.split(",");if(!common.isNull(_e)&&_e.length>2){var Ee=_e[2];!common.isNull(Ee)&&Ee.length>0&&isCallStarted&&null!=Call.instance&&(CommonGUI.GetObj().PutToDebugLog(2,"EVENT, Group conference update peers to: "+Ee),j$("#page_call_additional_info").html(Ee),j$("#page_call_peer_details").html(""),j$("#page_call_peer_details").hide(),j$("#display_notmain_account").html(""),j$("#display_notmain_account").hide(),j$("#contact_image_img").attr("src",common.GetElementSource()+"images/default_contact_conf.png"))}}catch(Qt){common.PutToDebugLogException(2,"notifications ProcessNotifications handle group conference",Qt)}if("QRCODE"===z&&common.ParseQRcode(X),"CHATREPORT"===z){var Te=X.split(",");if(!common.isNull(Te)&&Te.length>5){var Pe=Te[1],Se=Te[2],Ne=Te[5];if(common.isNull(Pe)&&(Pe=""),Pe=common.Trim(Pe),Pe=Pe.toLowerCase(),common.isNull(Se)&&(Se=""),Se=common.Trim(Se),common.isNull(Ne)&&(Ne=""),Ne=common.Trim(Ne),"2"==Se||"4"==Se){var we="chat_"+common.GetSipusername()+"_"+Pe;Pe.length>0&&Se.length>0&&Ne.length>0&&(Ne=Ne.toLowerCase(),common.IsWindowsSoftphone()?common.ApiWinLoadFile(we,function(e){common.isNull(e)&&(e=""),a(we,Se,Ne,e,Pe)}):global.File.ReadFile(we,global.STORAGE_LOCAL,function(e){common.isNull(e)&&(e=""),a(we,Se,Ne,e,Pe)}))}}}if("LINEDETAILS"===z){var Ie=X.split(",");if(!common.isNull(Ie)&&Ie.length>10){common.PutToDebugLog(2,"EVENT, update ep from received LINEDETAILS notification");var Ce=Ie[0],Re=Ie[3],ye=Ie[2],Le=Ie[5],De=Ie[8],Ge=Ie[9];common.SaveCallSession(Ce,null,Re,Le,-1,-1,-1,null,ye,"","","",De,Ge,"")}}if("LINE"===z){var xe=-20,Oe=X,U=Oe.indexOf(",");if(U>0&&(Oe=Oe.substring(0,U)),Oe=common.Trim(Oe),common.IsNumber(Oe)&&(xe=common.StrToInt(Oe)),xe>-5)return void(global.aline=xe)}if(l=80,"STATUS"===z){global.apistartstate=2,h=X;var Ae=u(o,-1);global.lnstat[Ae]=[common.GetTickCount(),X]}if(("STATUS"===z||"EVENT"===z)&&X.toLowerCase().indexOf("permission")<0&&(global.last_event=X),!0===common.Glbr()&&"CREDIT"===z)S=!0,global.credit=" "+X;else if(!0===common.Glbr()&&"RATING"===z)l=82,global.rating=" ("+common.Trim(X)+")";else if("MWI"===z&&(l=83,!common.isNull(X)&&X.length>0&&X.indexOf(",")>=0)){var ke=X.split(",");if(!common.isNull(ke)&&ke.length>=2)if("no"===ke[0])l=85,60===common.GetConfigInt("brandid",-1)?common.SetNotCounter("dialpad_message_counter","0"):common.SetNotCounter("dialpad_voicemail_counter","0");else{l=87;var Ue=ke[2];common.isNull(Ue)&&(Ue=""),Ue=common.Trim(Ue),Ue.length>0&&common.IsNumber(Ue)&&(l=88,common.PutToDebugLog(3,"EVENT, New voicemail messages found: "+Ue),60===common.GetConfigInt("brandid",-1)?common.SetNotCounter("dialpad_message_counter",Ue):common.SetNotCounter("dialpad_voicemail_counter",Ue))}}l=90;var Ve=X.indexOf("POPUP");if(Ve>=0){var We=X.substring(Ve+5);We=common.Trim(We),Ve=We.indexOf(","),Ve>=0&&(We=We.substring(Ve+1)),l=94,!common.isNull(We)&&We.length>0&&common.ShowToast(We,5e3)}if(U=X.indexOf(","),X=common.Trim(X),U>0&&(X=common.Trim(X.substring(U+1,X.length))),l=96,U=X.indexOf(","),U>0?(K=common.Trim(X.substring(0,U)),X=common.Trim(X.substring(U+1,X.length))):K=X,l=100,U=K.indexOf("("),U>0&&K.indexOf(te)<0&&K.indexOf(oe)<0&&(K=common.Trim(K.substring(0,U))),K.length<1&&!1===Z)return void common.PutToDebugLog(5,"WARNING, unknown notification b: "+o);if(X.length<1&&!1===Z)return void common.PutToDebugLog(5,"WARNING, unknown notification c: "+o);if(l=110,"CDR"===z&&(common.PutToDebugLog("EVENT, notifications: ProcessNotifications CDR received: "+o,5),global.lastcallcdr=o,(U=o.indexOf(","))>0))try{var Me="";l=115;var Fe=o.split(","),He=Fe[1],H=Fe[2],je=Fe[3],Be=Fe[4],$e=(Fe[5],Fe[6]),qe=Fe[7],ze=Fe[8],Ke=Fe[9],pe="";Fe.length>10&&(pe=Fe[10]);var Xe=2;H===Be&&(Xe=1),common.isNull(Ke)&&(Ke=""),Ke.indexOf("[")>0&&(Ke=Ke.substring(0,Ke.indexOf("["))),l=120,common.getuseengine()===global.ENGINE_WEBRTC&&common.GetDiscReasonFromSignaling(function(e){(common.isNull(e)||e.length<2)&&(e=Ke),!0===global.dontshowdiscreason?common.PutToDebugLog(2,"EVENT, "+stringres.get("disc_reason")+": "+e):(common.PutToDebugLog(1,"EVENT, "+stringres.get("disc_reason")+": "+e),s(stringres.get("disc_reason")+": "+e,"EVENT",0,common.StrToIntDef(He,-1)))}),global.lastcalldetails="",common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_GetLastCallDetails",null),l=124;var Je="<br>",de="outgoing";if(2===Xe&&(de="incoming"),global.lastcalldetails=global.lastcalldetails+"Line: "+He+", Direction: "+de+Je,global.lastcalldetails=global.lastcalldetails+"Auth Username: "+common.GetSipusername()+Je,2===Xe?(global.lastcalldetails=global.lastcalldetails+"Caller: "+je+Je,je!==H&&(global.lastcalldetails=global.lastcalldetails+"Caller Name: "+H+Je)):global.lastcalldetails=global.lastcalldetails+"Caller ID: "+common.GetCallerid()+Je,l=128,global.lastcalldetails=global.lastcalldetails+"Connecttime: "+$e+" msec"+Je,global.lastcalldetails=global.lastcalldetails+"Duration: "+qe+" msec"+Je,global.lastcalldetails="1"===ze?global.lastcalldetails+"Disconnect By: Local"+Je:global.lastcalldetails+"Disconnect By: Remote"+Je,global.lastcalldetails=global.lastcalldetails+"Reason: "+Ke+Je,global.lastcalldetails=global.lastcalldetails+"CDR: "+global.lastcallcdr+Je,common.getuseengine===global.ENGINE_WEBRTC){var Ye=common.ReplaceAll(global.lastcalldetails,Je,"\n");setTimeout(function(){common.PutToDebugLog(2,"EVENT, Call details:\n"+Ye)},1)}common.getuseengine()!==global.ENGINE_WEBRTC&&(!0===global.dontshowdiscreason?common.PutToDebugLog(2,"EVENT, "+stringres.get("disc_reason")+": "+Ke):(common.PutToDebugLog(1,"EVENT, "+stringres.get("disc_reason")+": "+Ke),s(stringres.get("disc_reason")+": "+Ke,"EVENT",0,common.StrToIntDef(He,-1)))),l=122;try{webphone_api.onCdrCb(je,Be,$e,qe,Xe,H,Ke,common.StrToInt(He),pe)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onCdr() callback",Yt)}if(!0===common.UsePresence2()&&!common.isNull(qe)&&common.IsNumber(qe)){if(common.StrToInt(qe)<=0)common.PutToDebugLog(4,"EVENT,notifications CDR 0 duration get presence status for: "+H),!1===common.IsSDK()&&common.PresenceGet2(H);else{if(!common.isNull(global.presenceHM))var Qe=global.presenceHM[H];if(!common.isNull(Qe)){var Ze=Qe[common.PRES_STATUS];common.isNull(Ze)||"0"!==Ze||(common.PutToDebugLog(4,"EVENT,notifications CDR connected call but presence was offline, so set it to online for: "+H),common.SaveReceivedPresence2(H,"online"))}}}l=130,!common.isNull(Fe[9])&&Fe[9].length>0&&common.PutToDebugLog(1,"EVENT, "+Fe[9]),Me=common.Trim(Fe[2]);var et=0;try{et=common.StrToInt(Fe[7])/1e3}catch(Zt){}global.lastcallduration=et,l=132;var tt="recfile";if(2===Xe?(v=!1,!1===global.acceptReject?(l=136,i(Me,"2",tt,et,He,Ke)):(l=137,i(Me,"1",tt,et,He,Ke)),global.acceptReject=!1):(l=138,i(Me,"0",tt,et,He,Ke)),_="",tt="",et>60){var ot=common.GetParameterInt("successfulcalls",0),nt=common.GetParameterInt("webrtc_successfulcalls",0);ot<0&&(ot=0),nt<0&&(nt=0),ot++,common.SaveParameter("successfulcalls",ot.toString()),common.getuseengine()===global.ENGINE_WEBRTC&&(nt++,common.SaveParameter("webrtc_successfulcalls",nt.toString()));var it=4;ot===it&&"Android"===common.GetOs()&&(!1===common.IsSDK()&&(common.PutToDebugLog(4,"EVENT, Close call page because trying to display Add to Home Screen popup"),wpa._call.CloseCall()),setTimeout(function(){var e=j$(".ui-page-active .ui-popup-active").length;!0===common.IsSDK()||e<1?(common.PutToDebugLog(2,"EVENT, Offer pin to desktop Home Screen Android"),common.AlertDialog(stringres.get("add_to_home_title"),stringres.get("add_to_home_msg"))):(it-=1,common.SaveParameter("successfulcalls",it.toString()))},500))}}catch(Yt){common.PutToDebugLogException(2,"notifications: ProcessNotifications CDR and save to call history",Yt)}if(l=140,"STATUS"===z){if("Registered."===K||"Registered"===K){if(global.phonestarted=3,common.SaveParameter("firststart_webrtc","false"),common.SaveParameter("last_login_failed","false"),global.firstregister_sessiontick<1&&(global.firstregister_sessiontick=common.GetTickCount()),common.getuseengine()===global.ENGINE_WEBRTC&&2===global.usuk.length&&common.SaveParameter("last_good_webrtc_gw",global.usuk),!1===common.IsSDK()&&("undefined"!=typeof dialpad_public&&null!==dialpad_public?dialpad_public.HandleAutoaction():console&&console.log&&console.log("ERROR, notifications ProcessNotifications dialpad_public is not defined")),l=141,!0===common.UsePresence2()&&!1===global.pres_set_at_start&&(l=142,setTimeout(function(){global.pres_set_at_start=!0,common.PutToDebugLog(2,"EVENT,SetSelectedPresence to Online on notification reg"),common.SetSelectedPresence("Online"),common.getuseengine()===global.ENGINE_WEBRTC&&webrtcapi_public.SetSipHeader(-2,"X-IMStatus:"+common.GetParameter("presencestatus"))},200)),l=143,!1===global.onregisteredcalled){global.onregisteredcalled=!0;try{webphone_api.onRegStateChangeCb("registered",null)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onRegStateChangeCb(registered) callback",Yt)}try{webphone_api.onRegisteredCb()}catch(Yt){common.PutToDebugLogException(2,"There is an error in onRegistered() callback",Yt)}}if(j$("#webphone").width(1),j$("#webphone").height(1),l=145,l=147,!0===common.Glbr()&&!S){var rt=common.GetParameter("creditrequest");!common.isNull(rt)&&rt.length>0&&(l=148,common.UriParser(rt,"","","","","creditrequest"))}}if(l=150,K.toLowerCase().indexOf("unregistered")>=0&&(global.authenticated_displayed=!1,!1===global.onunregistered_flag)){global.onunregistered_flag=!0,global.onregisteredcalled=!1,setTimeout(function(){global.onunregistered_flag=!1},2e3),l=152;try{webphone_api.onRegStateChangeCb("unregistered",null)}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(unregistered) callback",Yt)}try{webphone_api.onUnRegisteredCb()}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onUnRegistered() callback",Yt)}}if(l=160,"CallSetup"===K||"Ringing"===K){var at=X.split(",");if(common.isNull(at)||at.length<3)return void common.PutToDebugLog(3,"EVENT, ProcessNotifications, skip ringing event, because not enough parameters: "+X);var st="",H="",de="",lt=o.replace(" ",""),ct="";if(!common.isNull(at)&&at.length>1&&(ct=at[1]),!1===common.UserExists(ct))return common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),J=K,Y="STATUS",void(Q=le);var ut="";!common.isNull(at)&&at.length>4&&(ut=at[4]),!common.isNull(at)&&at.length>2&&(!common.isNull(at[0])&&at[0].length>1?st=common.Trim(at[0]):!common.isNull(at[1])&&at[1].length>1&&(st=common.Trim(at[1])),l=163,!common.isNull(at[2])&&at[2].length>0&&(de=common.Trim(at[2])),l=164,at.length>3&&(H=at[3],(common.isNull(H)||H.length<1)&&(H=st))),l=167,common.isNull(st)&&(st="");var xe=global.aline;if(common.getuseengine()!==global.ENGINE_WEBRTC){var mt=common.Trim(o),gt=mt.indexOf(",");l=169,gt>0&&(mt=mt.substring(gt+1),mt=common.Trim(mt),(gt=mt.indexOf(","))>0&&(l=172,mt=mt.substring(0,gt),mt=common.Trim(mt),!common.isNull(mt)&&common.IsNumber(mt)&&(l=175,xe=common.StrToInt(mt),global.aline=xe)))}if("CallSetup"==q&&"Ringing"===K){try{webphone_api.onCallStateChangeCb("callRinging",common.StrToInt(de),st,H,xe,ut)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callRinging",Yt)}"1"==de?(l=271,common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallringing,"callRinging",de,st,st,"")):(l=272,common.CallScriptingUrl(webphone_api.parameters.scurl_onincallringing,"callRinging",de,st,st,""))}if(q=K,!common.isNull($)&&$.length>0&&$===ut)return;var dt=!1,pt=global.aline;if(common.getuseengine()===global.ENGINE_WEBRTC&&common.GetNrOfActiveCalls()>0&&"Firefox"===common.GetBrowser()&&!common.isNull(global.ep)&&global.ep.length>0)for(var f=0;f<global.ep.length;f++)if(!common.isNull(global.ep[f])&&"true"==global.ep[f][common.EP_HOLDSTATE]){var ht=global.ep[f][common.EP_LINE];webphone_api.setline(ht),common.PutToDebugLog(2,"EVENT, API_Hold mainlogic resume call from nt; peer: "+global.ep[f][common.EP_DESTNR]+" on line: "+ht),webphone_api.hold(!1),webphone_api.mute(!0),dt=!0}dt&&webphone_api.setline(pt),$=ut,common.isNull(B)||clearTimeout(B),B=null,global.acallcount++,M=!1,l=161,common.RemoveSipHeadreFromCache("X-reason"),common.RemoveSipHeadreFromCache("Reason"),common.RemoveSipHeadreFromCache("Warning"),global.ringstart_time=common.GetTickCount(),l=176;var fe=common.StrToInt(xe);fe>0&&common.GetOtherPartyName(fe,st),T=common.GetTickCount(),_=st,global.currcallnumber=_,global.checkIfInCall=!0,global.checkIfCallActive=!1,!1===common.IsSDK()&&j$("#video_container").is(":visible")&&setTimeout(function(){wpa._call.MeasureCall()},200),common.SaveCallSession(xe,null,st,de,common.GetTickCount(),-1,-1,"","","","",null),!0===common.GetParameterBool("voicerecording",!1)&&!1===callpage_public.IsRecStarted(st)&&callpage_public.StartRecording(st),l=177;try{webphone_api.onCallStateChangeCb("callSetup",common.StrToInt(de),st,H,xe,ut)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callSetup",Yt)}if(1==de?(l=178,common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallsetup,"callSetup",de,st,st,"","additional_info")):(l=179,common.CallScriptingUrl(webphone_api.parameters.scurl_onincallsetup,"callSetup",de,st,st,"","additional_info"),1===common.GetParameterInt("beeponincoming",0)&&common.Beep("1")),common.CallScriptingUrl(webphone_api.parameters.scurl_displaypeerdetails,"callSetup",de,st,st,"","scurl_displaypeerdetails"),common.PutToDebugLog(2,"EVENT, currevent: "+lt+"; isIcomingCall: "+de+"; line: "+Q),common.PutToDebugLog(2,"EVENT, lastRingEvenet: "+global.lastRingEvenet),common.UpdateContactLastActive(st),"2"==de){if(!1===common.IsSDK()&&!common.isNull(document.getElementById("display_notmain_account"))&&common.GetNrOfAcc()>1){var ft="",bt=at[1];if(!common.isNull(global.sipaccounts)&&global.sipaccounts.length>0){for(var f=0;f<global.sipaccounts.length;f++){var vt=global.sipaccounts[f];if(!0===vt.ismain){if(!common.isNull(bt)&&bt.length>0&&bt!=vt.username)for(var _t=0;_t<global.sipaccounts.length;_t++)if(global.sipaccounts[_t].username===bt){ft=global.sipaccounts[_t].username,!common.isNull(global.sipaccounts[_t].serveraddress)&&global.sipaccounts[_t].serveraddress.length>0&&(ft=ft+"@"+global.sipaccounts[_t].serveraddress);break}break}}!common.isNull(ft)&&ft.length>0&&(j$("#display_notmain_account").html(ft),j$("#display_notmain_account").show())}}var Et=common.GetParameter("callnot_title"),Tt=common.GetParameter("callnot_body"),Pt=common.GetParameter("callnot_icon"),St=common.GetParameter("callnot_image");(common.isNull(Et)||Et.length<1)&&(Et=common.GetBrandName()),(common.isNull(Tt)||Tt.length<1)&&(Tt=stringres.get("notification_message")),Tt+=": ",H.length>0&&H!==st?Tt=Tt+H+" ("+st+")":Tt+=st,(common.isNull(Pt)||Pt.length<1)&&(Pt=common.GetElementSource()+"images/notification_icon.png"),common.isNull(St)&&(St=""),common.ShowIncomingCallNotification(Et,Tt,Pt,!1,St)}if(!common.isNull(de)&&"2"==de&&lt!==global.lastRingEvenet){if(l=280,common.IsContactBlocked(_,null))return l=281,common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blocked contact: "+_),common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blocked contact: "+_),void webphone_api.hangup();if(common.IsNumberBlacklisted(_,null))return l=282,common.PutToDebugLog(4,"EVENT, call dropped (hangup) because blacklisted number: "+_),common.PutToDebugLog(2,"EVENT, mlogic API_Hangup blacklisted number: "+_),void webphone_api.hangup();if(global.active_incoming_call=!0,global.incommingCall=!0,v=!0,global.checkIfInCall=!0,global.checkIfCallActive=!1,l=285,common.SaveParameter("redial",_),common.SaveParameter("lastincalltime",common.GetTickCount()),global.intentcall[0]="number="+_,global.intentcall[1]="calltype=incoming",global.intentcall[2]="name=",l=286,!0===common.UsePresence2()&&!0===global.incommingCall&&"dnd"===common.GetParameter("presencestatus").toLowerCase())return common.PutToDebugLog(2,"EVENT, mlogic API_Hangup incoming call from: "+st+", because presence is DND"),void webphone_api.hangup();0==common.IsSDK()&&setTimeout(function(){l=290,!1===global.isCallStarted?j$.mobile.changePage("#page_call",{transition:"pop",role:"page"}):(l=292,callpage_public.OnNewIncomingCall())},500)}l=297,(common.isNull(global.lastRingEvenet)||global.lastRingEvenet.length<1)&&(global.lastRingEvenet=lt)}if(l=180,"CallConnect"===K){var st="",H="",de="",at=X.split(","),ct="";if(!common.isNull(at)&&at.length>1&&(ct=at[1]),!1===common.UserExists(ct))return common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),J=K,Y="STATUS",void(Q=le);common.PutToDebugLog(5,"EVENT, callConnected event received"),"Android"===common.GetOs()&&common.getuseengine()===global.ENGINE_WEBRTC&&(common.PutToDebugLog(2,"EVENT, mlogic API_GetDevice Callconnect"),webphone_api.getdevice(0,function(e){try{if(common.GetParameterInt("androidspeaker",1)>0){if("Default"===e){var t=common.GetAudioRecList();if(!common.isNull(t)&&t.length>0)for(var o=t.split("\r\n"),n=0;n<o.length;n++)!common.isNull(o[n])&&(o[n].toLowerCase().indexOf("earpiece")>=0||o[n].toLowerCase().indexOf("headset")>=0)&&(e=o[n],common.SaveParameter("sel_rtc_audio_in",e),global.audio_rec_curr_device=e,common.SaveParameter("cache_audio_rec_curr_device",e))}!common.isNull(e)&&e.length>0&&(common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}else{if(e.toLowerCase().indexOf("earpiece")>=0||e.toLowerCase().indexOf("headset")>=0){var t=common.GetAudioRecList();if(!common.isNull(t)&&t.length>0)for(var o=t.split("\r\n"),n=0;n<o.length;n++)!common.isNull(o[n])&&o[n].toLowerCase().indexOf("default")>=0&&(e=o[n],common.SaveParameter("sel_rtc_audio_in",e),global.audio_rec_curr_device=e,common.SaveParameter("cache_audio_rec_curr_device",e))}!common.isNull(e)&&e.length>0&&(common.PutToDebugLog(4,"EVENT, Set input device id for Android loudspeaker: "+e),common.PutToDebugLog(2,"EVENT, mlogic API_SetDevice Callconnect"),webphone_api.setdevice(0,e,2))}}catch(Yt){common.PutToDebugLogException(2,"notifications: getdevice loudspeaker 2",Yt)}})),common.ShowIncomingCallNotification("","","",!0,""),global.checkIfInCall=!0,global.callstart_time=common.GetTickCount(),l=182,!common.isNull(at)&&at.length>2&&(!common.isNull(at[0])&&at[0].length>1?st=common.Trim(at[0]):!common.isNull(at[1])&&at[1].length>1&&(st=common.Trim(at[1])),l=184,!common.isNull(at[2])&&at[2].length>0&&(de=common.Trim(at[2])),at.length>3&&(H=at[3],(common.isNull(H)||H.length<1)&&(H=st)),l=188);var Nt="";at.length>9&&!common.isNull(at[9])&&(Nt=at[9]),common.isNull(st)&&(st=""),l=190;try{common.PutToDebugLog(5,"EVENT, callConnected event sent"),webphone_api.onCallStateChangeCb("callConnected",common.StrToInt(de),st,H,common.StrToInt(global.aline),Nt)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callConnected",Yt)}if(1===common.StrToInt(de)){if(l=205,common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallconnected,"callConnected",de,st,st,""),common.getuseengine()===global.ENGINE_WEBRTC){var wt=common.GetParameterInt("beeponconnect",0);3!==wt&&4!==wt||common.Beep("1")}}else l=206,common.CallScriptingUrl(webphone_api.parameters.scurl_onincallconnected,"callConnected",de,st,st,"");l=207,common.SaveCallSession(global.aline,null,st,de,-1,common.GetTickCount(),-1,"","","","",null),setTimeout(function(){common.RefreshInfo()},400)}if(l=200,"CallDisconnect"===K){var It=common.Trim(o).split(","),ct="";if(!common.isNull(It)&&It.length>1&&(ct=It[1]),!1===common.UserExists(ct))return common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),J=K,Y="STATUS",void(Q=le);common.ShowIncomingCallNotification("","","",!0,"");var A=global.aline,Ct="";!common.isNull(It)&&It.length>3&&(!common.isNull(It[1])&&common.IsNumber(It[1])&&(A=common.StrToInt(It[1])),common.isNull(It[3])||(Ct=common.Trim(It[3]))),setTimeout(function(){common.PutToDebugLog(2,"EVENT, notifications delete/remove endpoint on call disconnected for number: "+Ct+"; line: "+A.toString());var e=!0;!0===global.calltransf_completed&&(e=!1),(!0!==global.checkIfInCall||common.isNull(global.ep)||1!==global.ep.length)&&common.GetEndpoint(A,Ct,"",e)},350),common.GetNrOfActiveCalls()<2&&(global.checkIfInCall=!1,global.isconfcall=!1),l=201,common_public.ResetIce();var at=X.split(","),st="",H="",de="";l=202,!common.isNull(at)&&at.length>2&&(!common.isNull(at[0])&&at[0].length>1?st=common.Trim(at[0]):!common.isNull(at[1])&&at[1].length>1&&(st=common.Trim(at[1])),l=204,!common.isNull(at[2])&&at[2].length>0&&(de=common.Trim(at[2])),l=206,at.length>3&&(H=at[3],(common.isNull(H)||H.length<1)&&(H=st)));var Nt="";at.length>9&&!common.isNull(at[9])&&(Nt=at[9]),l=213,common.isNull(st)&&(st=""),!1===common.IsSDK()&&(l=215),!0===common.GetParameterBool("voicerecording",!1)&&!0===callpage_public.IsRecStarted(st)&&callpage_public.StopRecording(st),l=218;try{webphone_api.onCallStateChangeCb("callDisconnected",common.StrToInt(de),st,H,A,Nt)}catch(Yt){common.PutToDebugLogException(2,"There is an error in onCallStateChange() callback callDisconnected",Yt)}!1===global.calltransf_completed&&common.SaveCallSession(null,null,st,common.StrToInt(de),-1,-1,common.GetTickCount(),"","","","",null),global.acallcount--,common.GetNrOfActiveCalls()<1&&(global.usemutemutiline=!1)}if(l=220,"Call Finished"===K){if(ee=!1,global.bothpartyhold=!1,global.authenticated_displayed=!1,global.ringstart_time=0,global.callstart_time=0,webphone_api.isscreensharecall=!1,global.rating="",global.isholdresume=!1,global.isresume=!1,global.holdresumecount=0,global.add_recall_header=!1,ie>0)try{"undefined"!=typeof AndroidWebphoneJsInterface&&null!==AndroidWebphoneJsInterface&&"undefined"!=typeof AndroidWebphoneJsInterface.jstoandroidEvents&&null!==AndroidWebphoneJsInterface.jstoandroidEvents&&AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_NOTIFICATION")}catch(Yt){common.PutToDebugLogException(2,"notifications: ProcessNotifications inner AndroidWebphoneJsInterface",Yt)}l=222,common_public.ResetIce(),common.GetNrOfActiveCalls()<1&&(global.closeCallAtivity=!0),E=common.GetTickCount(),global.isCallStarted&&common.GetNrOfActiveCalls()<1&&(common.isNull(global.waiting_conf_numbers)||global.waiting_conf_numbers.length<1)&&!1===global.dontshow_closecall&&(j$("#btn_hangup_img").attr("src",common.GetElementSource()+"images/btn_close_txt.png"),j$("#btn_hangup").attr("title",stringres.get("hint_closecall")),j$("#acceptreject_layout").hide(),j$("#callfunctions_layout").hide(),j$("#hangup_layout").show()),common.IsMultiline()||(global.hangupPressedCount=1),l=232,common.GetNrOfActiveCalls()<1&&(global.checkIfInCall=!1,global.checkIfCallActive=!1,global.isconfcall=!1,M=!1),global.callTypeInOut="",global.creditRequestTimer=global.CREDIT_REQUEST_IVAL_DEFVAL-50,global.lastRingEvenet="",global.isfirstcall=!1,p=!1}if(l=240,"Finished"===K){ee=!1,global.bothpartyhold=!1,global.ringstart_time=0,global.callstart_time=0,global.rating="",global.firefoxholdcount=0,global.isholdresume=!1,global.isresume=!1,global.holdresumecount=0,global.add_recall_header=!1,l=242,common_public.ResetIce(),!0===global.incommingCall&&!1===global.acceptReject&&global.isCallStarted&&(l=245,!1===common.IsSDK()&&wpa._call.OnCallerHangup()),common.GetNrOfActiveCalls()<1&&(global.checkIfInCall=!1,global.checkIfCallActive=!1,global.isconfcall=!1,M=!1,global.incommingCall=!1,global.speakerState=!0,global.bluetoothState=!0,global.lastBTclicktick=0,global.callTypeInOut="",global.lastRingEvenet="",global.isfirstcall=!1),p=!1;var Rt=common.GetParameterInt("vdnr",0);if(global.isvideocall||webphone_api.isscreensharecall){Rt+=1,common.SaveParameter("vdnr",Rt);4===common.GetParameterInt("videomode",0)&&common.ExitVideoMode("Auto, on call finished")}if(global.isvideocall=!1,webphone_api.isscreensharecall=!1,l=247,!1===global.usestorage&&!1===common.Strl(60)&&Rt<2&&common.getuseengine()===global.ENGINE_WEBRTC&&!0===common.CanIUseService()){if(!0===(!0===common.IsMacLin()&&!0===common.IsMizuWebRTCGateway())){l=248;var yt=common.GetParameterInt("lccnr",0);if(yt>0&&yt<46){var Lt=common.GetParameterInt("closecall_timeout",8e3);Lt<999&&(Lt*=1e3),Lt+=1500,setTimeout(function(){function e(){common.SaveParameter("lastusedengine","ns"),webphone_api.flagrestartwebrtc=!1,l=253,common.ResetEngineClicked();var e=common.GetEngine("ns");e.clicked=2,common.SetEngine("ns",e),common.EngineSelect(1),l=257,common.PutToDebugLog(2,"EVENT, notifications: offer ns engine instead of WebRTC: "+common.GetMinServiceVersion().toString()),l=259,common.EngineForcedInstall("ns",stringres.get("serviceengine_msg"),null,function(){webphone_api.startInner()})}var t=j$.mobile.activePage.find(".messagePopup");!common.isNull(t)&&t.length>0&&!0!==global.dontclosecurrpopup?j$.mobile.activePage.find(".messagePopup").popup("close").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),e()}}):e()},Lt)}}}}if(l=260,l=300,"Starting call"===K&&(global.checkIfInCall=!0,global.checkIfCallActive=!1,!1===common.IsSDK()&&j$("#video_container").is(":visible")&&wpa._call.MeasureCall()),l=304,"InCall"===K&&(global.checkIfInCall=!0,v&&(l=307,!1===common.IsSDK()&&common.GetNrOfActiveCalls()<2&&wpa._call.AcceptCall(!1))),l=310,"Speaking"===K){var at=X.split(","),ct="";if(!common.isNull(at)&&at.length>1&&(ct=at[1]),!1===common.UserExists(ct))return common.PutToDebugLog(2,"EVENT, Skip this notification proccessisng"),J=K,Y="STATUS",void(Q=le);if(global.apistartstate=2,!1===ee&&(l=312,ee=!0,!1===common.IsSDK()&&common.GetNrOfActiveCalls()<2&&wpa._call.AcceptCall(!1)),!1===common.IsSDK()&&!1===global.isCallStarted&&common.isNull(B)&&(B=setTimeout(function(){!1===global.isCallStarted&&(global.intentcall[0]="number=",global.intentcall[1]="calltype=outgoing",global.intentcall[2]="name=",global.intentcall[3]="callmode=0",j$.mobile.changePage("#page_call",{transition:"pop",role:"page"}))},1e3)),R=!0,global.incommingCall&&(global.incommingCall=!1),global.checkIfCallActive=!0,global.checkIfInCall=!0,global.lastRingEvenet="",!1===common.IsSDK()&&j$("#video_container").is(":visible")&&setTimeout(function(){wpa._call.MeasureCall()},200),l=314,common.getuseengine()===global.ENGINE_WEBRTC){l=315;var Dt=location.hostname;common.isNull(Dt)&&(Dt="");var Gt=1;if(!1===common.Awb2()){var N=[];N.push("L"),N.push("i"),N.push("c"),N.push("e"),N.push("n"),N.push("s"),N.push("e "),N.push("e"),N.push("r"),N.push("r"),N.push("o"),N.push("r"),N.push(", "),N.push("w"),N.push("e"),N.push("b"),N.push("s"),N.push("e"),N.push("r"),N.push("v"),N.push("e"),N.push("r"),N.push(" "),N.push("n"),N.push("o"),N.push("t"),N.push(" "),N.push("a"),N.push("l"),N.push("l"),N.push("o"),N.push("w"),N.push("e"),N.push("d"),N.push("(");var xt=[];xt.push(")"),xt.push(" "),xt.push("h"),xt.push("a"),xt.push("n"),xt.push("g"),xt.push("u"),xt.push("p");var w=N.join(""),Ot=xt.join("");l=320,setTimeout(function(){common.PutToDebugLog(1,"ERROR,"+w+Dt+Ot)},3576),setTimeout(function(){common.ShowToast(w+Dt+Ot)},4235),Gt=10}if(Gt>5&&setTimeout(function(){webphone_api.hangup()},1180),D<0){
if(!0===common.Ch())D=1;else{D=0;var N=[];N.push("L"),N.push("i"),N.push("c"),N.push("e"),N.push("n"),N.push("s"),N.push("e "),N.push("e"),N.push("r"),N.push("r"),N.push("o"),N.push("r"),N.push(", "),N.push("i"),N.push("n"),N.push("v"),N.push("a"),N.push("l"),N.push("i"),N.push("d "),N.push("s"),N.push("e"),N.push("r"),N.push("v"),N.push("e"),N.push("r"),N.push("a"),N.push("d"),N.push("d"),N.push("r"),N.push("e"),N.push("s"),N.push("s"),N.push(" "),N.push("h"),N.push("a"),N.push("n"),N.push("g"),N.push("u"),N.push("p");var w=N.join("");l=320,setTimeout(function(){common.PutToDebugLog(1,"ERROR,"+w)},351),setTimeout(function(){common.ShowToast(w)},391)}}0===D&&setTimeout(function(){webphone_api.hangup()},123)}if(l=322,common.GetNrOfActiveCalls()>1&&!1===M){M=!0;var At=common.StrToInt(common.GetParameter("automute")),kt=common.StrToInt(common.GetParameter("autohold")),Ut=common.GetParameterInt("defmute",0);if(3!==Ut&&4!==Ut||(Ut=0),(common.isNull(At)||At<1)&&(common.isNull(kt)||kt<1));else for(var f=0;f<global.ep.length;f++){var Vt=global.ep[f];if(!(common.isNull(Vt)||Vt.length<1)){if(!common.isNull(Vt[common.EP_DISCONNECTTIME])&&common.IsNumber(Vt[common.EP_DISCONNECTTIME])){var Wt=common.StrToInt(Vt[common.EP_DISCONNECTTIME]);if(Wt>10)continue}var Mt=Vt[common.EP_LINE];if(!(common.isNull(Mt)||Mt.length<1||!1===common.IsNumber(Mt))){var Ft=common.StrToInt(Mt);if(global.aline!=Ft){var Ht=Vt[common.EP_MUTESTATE],jt=Vt[common.EP_HOLDSTATE];"false"==Ht&&(3===At||2===At&&!1===v||1===At&&!0===v)&&(common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleMute(!0,Ut,Ft):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_MuteEx",null,Ft,!0,Ut):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.MuteEx(Ft,!0,Ut),global.ep[f][common.EP_MUTESTATE]="true"),"false"==jt&&(3===kt||2===kt&&!1===v||1===kt&&!0===v)&&(common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleHoldResume(!0,Ft):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_Hold",null,Ft,!0):common.getuseengine()===global.ENGINE_WEBPHONE&&(common.PutToDebugLog(2,"EVENT, API_Hold mainlogic hold call because autohold; peer: "+global.ep[f][common.EP_DESTNR]+" on line: "+global.ep[f][common.EP_LINE]),wpa.webphone.Hold(Ft,!0)),global.ep[f][common.EP_HOLDSTATE]="true")}}}}}p||(p=!0,l=338,global.isencrypted=webphone_api.isencrypted(),setTimeout(function(){global.isencrypted>0?j$(".img_encrypt").show():j$(".img_encrypt").hide()},1e3))}l=340,K.toLowerCase().indexOf("registered")>=0&&K.toLowerCase().indexOf("unregistered")<0&&(P<4&&(P=4),l=342,global.phonestarted=3,common.SaveParameter("lastsucc","1"),d||(d=!0),l=344,setTimeout(function(){global.isencrypted>0?j$(".img_encrypt").show():j$(".img_encrypt").hide()},1e3)),l=360}else if("CHAT"===z){var fe=-1,be=common.Trim(o),ve=be.indexOf(",");if(ve>0&&(be=be.substring(ve+1),(ve=be.indexOf(","))>0&&(be=common.Trim(be.substring(0,ve)),!common.isNull(be)&&common.IsNumber(be)&&(fe=common.StrToInt(be)))),X.indexOf("[PRESENCE")>=0)return X=X.replace("[",""),X=X.replace("]",""),void t(X);l=361,r(K,X,fe)}"Rejected"===K&&v&&(l=364,!1===common.IsSDK()&&wpa._call.RejectCall(!1)),U=X.indexOf(","),U>0&&(X=K),l=366,U=K.indexOf("[ep"),U>0&&(K=common.Trim(K.substring(0,U)),X=K),l=370;var Bt="";if(("EVENT"===z||"ERROR"===z||"WARNING"===z||"STATUS"===z)&&(l=371,U=X.indexOf("("),Bt=U>0&&K.indexOf(te)<0&&K.indexOf(oe)<0?common.Trim(X.substring(0,U)):X,l=374,!common.IsNumber(Bt.charAt(0)))){if(Bt=Bt.substring(0,1).toUpperCase()+Bt.substring(1),"STATUS"===z){if("Deletable"!==Bt&&Bt.indexOf("Chat")<0){se=Bt,le=-1;var $t=o.split(",");if(!common.isNull($t)&&$t.length>1&&!common.isNull($t[1])&&common.IsNumber($t[1])&&(le=common.StrToIntDef($t[1],-1)),common.isNull(global.callPageStatusCachePerLine)&&(global.callPageStatusCachePerLine={}),!1===common.IsSDK()&&("page_call"===j$.mobile.activePage.attr("id")||o.indexOf("CallSetup")>0)){var qt=common.StrToIntDef($t[1],-1);if(qt>0){var zt=L;o.indexOf("ERROR")>=0?zt="#FF0000":o.indexOf("WARNING")>=0&&(zt="#D28F00"),"undefined"!=typeof global.callPageStatusCachePerLine[qt]&&null!==global.callPageStatusCachePerLine[qt]&&"undefined"!=typeof global.callPageStatusCachePerLine[qt][0]&&null!==global.callPageStatusCachePerLine[qt][0]&&"Muted"===global.callPageStatusCachePerLine[qt][0]&&"Speaking"===Bt||(global.callPageStatusCachePerLine[qt]=[Bt,zt])}}}}else{J=Bt,Y=z,Q=-1;var $t=o.split(",");!common.isNull($t)&&$t.length>1&&!common.isNull($t[1])&&common.IsNumber($t[1])&&(Q=common.StrToIntDef($t[1],-1))}if(l=377,"Register failed"===Bt){se=Bt,le=-1;var $t=o.split(",");!common.isNull($t)&&$t.length>1&&!common.isNull($t[1])&&common.IsNumber($t[1])&&(le=common.StrToIntDef($t[1],-1))}if(l=379,(Bt.indexOf("Register failed")>=0||Bt.indexOf("Connection lost")>=0||Bt.indexOf("No network")>=0||Bt.indexOf("Network is down")>=0||Bt.indexOf("No response from server")>=0||Bt.indexOf("Server lost")>=0||Bt.indexOf("Authentication failed")>=0||Bt.indexOf("Rejected by server")>=0||Bt.indexOf("Register rejected")>=0||Bt.indexOf("Register expired")>=0||Bt.indexOf("Register failed")>=0)&&(common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE||common.WinAPI("API_GetRegFailReason",function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback service",Yt)}try{webphone_api.onRegisterFailedCb(e)}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback service",Yt)}},!0),common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.GetRegFailReason(function(e){try{webphone_api.onRegStateChangeCb("failed",e)}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onRegStateChangeCb(failed) callback webphone",Yt)}try{webphone_api.onRegisterFailedCb(e)}catch(Yt){common.PutToDebugLogException(2,"notifications: There is an error in onRegisterFailed() callback webphone",Yt)}},!0),!0===global.onunregistered_flag||!1===webphone_api.flagrestartwebrtc||common.SaveParameter("lastsucc","0"),global.dispregfailed<2&&(global.laststarttick<1||common.GetTickCount()-global.laststarttick>2500))){l=382,global.dispregfailed=2;var Kt=Bt;Kt=Kt.indexOf("Register failed")<0?"Register failed_: "+Kt:Kt.replace("Register failed","Register failed_"),common.PutToDebugLog(2,"EVENT, notification ProcessNotifications display: Register failed_: "+Kt),common.ShowToast(Kt,6e3)}}l=400}catch(Yt){common.PutToDebugLogException(2,"notifications: ProcessNotifications ("+l.toString()+"), not: "+o,Yt)}}function o(e){be=e}function n(){function e(e){try{common.PutToDebugLog(2,"EVENT, mlogic API_Hangup EarlyHangup: "+e),webphone_api.hangup()}catch(t){common.PutToDebugLogException(2,"notifications: EarlyHangup",t)}}var t=0;try{var o=common.GetTickCount();if(global.ever_received_pong&&global.pingpong>2){!0===WsReconnect()?common.PutToDebugLog(2,"EVENT, WSReConnect from timer succeded"):common.PutToDebugLog(2,"ERROR, WSReConnect from timer failed")}global.wsc_contimeout>10&&o-global.wsc_contimeout>5e3&&(global.wsc_contimeout=0,common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI connection timed out (from timer)"),common.WSReConnect()),global.wsc_reqtimeout>10&&o-global.wsc_reqtimeout>5e3&&(global.wsc_reqtimeout=0,common.PutToDebugLog(2,"ERROR, WSReConnect websocketAPI request timed out (from timer)"),common.WSReConnect()),!0===global.dontshowdiscreason&&H>25&&(H=0,global.dontshowdiscreason=!1),1===global.dispregfailed&&++Ee>330&&(Ee=0,global.dispregfailed=2,global.phonestarted<2&&!0===common.NeedRegister()&&(common.PutToDebugLog(2,"EVENT, notification OnTimerCycle display: Register failed"),common.ShowToast("Register failed"))),re<5e3&&re++,J.length>0?(J.toLowerCase().indexOf("authenticated successfully")>=0&&(se="Registered.",le=-1),ce=J,ue=Y,me=Q,re=0,J="",Y="",Q=-1):re>ae?(ce=se,ue="STATUS",me=le):se.indexOf("Registered.")>=0&&"ERROR"!==ue&&"WARNING"!==ue&&(global.firstregister_sessiontick<1||global.firstregister_sessiontick>0&&o-global.firstregister_sessiontick<5e3)&&(ce=se,ue="STATUS",me=le);try{var n=ce.indexOf("[");n>0&&(ce=ce.substring(0,n)),ce=common.Trim(ce),n=ce.indexOf("]"),n>0&&(ce=ce.substring(n+1)),ce=common.Trim(ce)}catch(T){common.PutToDebugLogException(3,"notifications OnTimerCycle parse displayed status",T)}if("Registered."!==ce&&"Registered"!==ce||(ce+=global.credit,Te!==global.useengine&&(Te=global.useengine,common.SaveLastUsedEngine())),"Register..."!==ce&&"Registering..."!==ce&&"Register Failed"!==ce&&"Not Found"!==ce||Te!==global.useengine&&(Te=global.useengine,common.SaveLastUsedEngine()),0!==ce.indexOf("Credit:")&&1!==ce.indexOf("Credit:")&&ce.indexOf("Outband")<0&&ce.indexOf("Deletable")<0&&ce.indexOf("Outbound")<0&&ce.indexOf("Subscribe")<0&&(ce.toLowerCase().indexOf("hide")>=0&&(ce=" "),s(ce,ue,0,me)),t=40,global.ringstart_time>0&&global.callstart_time<1){t=41,(common.isNull(k)||!1===common.IsNumber(k))&&(k=9e4),(common.isNull(U)||!1===common.IsNumber(U))&&(U=0),(common.isNull(V)||!1===common.IsNumber(V))&&(V=0);var i=k;!0===global.incommingCall?U>0&&(i=U):V>0&&(i=V);var r=common.GetParameter2("cutincoming"),a=0;"-1"===r?a=-1:"0"===r?a=0:"1"===r&&(a=1),t=51,o-global.ringstart_time>i&&e("Hangup because ringtimeout limit reached: "+i),-1===a?!0===global.incommingCall&&o-global.ringstart_time>14e3&&"Chrome"===common.GetBrowser()&&e("Hangup because ringtimeout in Chrome browser limit reached: 14000"):1===a&&!0===global.incommingCall&&o-global.ringstart_time>14e3&&e("Hangup because ringtimeout in ALL browsers limit reached: 14000")}if(t=55,global.callstart_time>0&&(t=56,(common.isNull(W)||!1===common.IsNumber(W))&&(t=57,W=108e5),t=58,o-global.callstart_time>W&&(t=67,common.PutToDebugLog(2,"EVENT, mlogic API_Hangup because calltimeout limit reached: "+W),t=68,webphone_api.hangup(),t=69)),t=70,!0===common.Glbr()&&!S&&0===global.creditRequestTimer&&P>2){var l=common.GetParameter("creditrequest");!common.isNull(l)&&l.length>0&&common.UriParser(l,"","","","","creditrequest")}if(global.creditRequestTimer++,global.creditRequestTimer>global.creditRequestIval&&(global.creditRequestTimer=0),o-y>global.presenceinterval&&(y=o,!1===common.IsSDK()&&!0===(F=common.UsePresence2())&&common.PresenceGet2(common.GetParameter("srvcontacts"))),!0===F&&!0===global.isMessageStarted&&++global.msg_presence_timer>200&&(global.msg_presence_timer=0,!1===common.IsSDK()&&wpa._message.RefreshPresence()),o-G>x&&(G=o,common.CallWsuserKeepAlive(!1)),o-O>A&&(O=o,common.CallWsuserKeepAlive(!0),common.PutToDebugLog(2,"EVENT, wsuser keepalive hourly called")),global.closeCallAtivity&&o-E>f&&(global.closeCallAtivity=!1,E=0,!1===global.incommingCall&&!1===global.checkIfInCall&&global.isCallStarted&&!1===common.IsSDK()&&wpa._call.CloseCall()),o-N>5e3&&!0===global.wasSettModified){N=o,global.wasSettModified=!1;var c="";c=1==common.IsSDK()?common.GetSettFilenameSDK():common.GetActiveAccSettingsFilename(),common.SaveSettingsFile(c,function(e){e?common.PutToDebugLog(2,"EVENT, SaveSettingsFile from timer Successfull"):common.PutToDebugLog(2,"ERROR, SaveSettingsFile from timer Failed")})}if(o-w>200&&(w=o,!0===global.wasCtModified&&(global.wasCtModified=!1,common.SaveContactsFile(function(e){e?common.PutToDebugLog(2,"EVENT, SaveContactsFile from timer Successfull"):common.PutToDebugLog(2,"ERROR, SaveContactsFile from timer Failed")}))),o-I>400&&(I=o,global.wasChModified&&(global.wasChModified=!1,common.SaveCallhistoryFile(function(e){e?common.PutToDebugLog(2,"EVENT, SaveCallhistoryFile from timer Successfull"):common.PutToDebugLog(2,"ERROR, SaveCallhistoryFile from timer Failed")}))),"Ringing"===K&&!0===pe&&(be=common.GetTickCount(),pe=!1,fe=!0),"Speaking"===K&&!0===he&&(be=common.GetTickCount(),he=!1,fe=!0),!1===common.IsSDK()&&global.isCallStarted&&!0===fe&&++ve>=3){_e=!0===common.GetHoldState(-1)?stringres.get("in_hold")+" ":"";var o=common.GetTickCount(),u=common.GetTickCount()-be,m=Math.floor(u/1e3),g=Math.floor(m/60);m%=60,m<10&&(m="0"+m),global.isCallStarted&&j$("#call_duration").html(_e+g+":"+m+"&nbsp;"),ve=0}if("Call Finished"!==K&&"Finished"!==K||common.GetNrOfActiveCalls()<1&&(fe=!1,pe=!0,he=!0,webrtcapi_public.RemoveUnusedAudioElements()),X.indexOf(":")>0){if("Call duration"===common.Trim(X.substring(0,X.indexOf(":")))){fe=!1,_e=stringres.get("duration")+" ";var d=common.Trim(X.substring(X.indexOf(":")+1,X.length)),p=0,g=0,m=0;if(d.indexOf(":")<0?m=common.Trim(d.substring(0,d.indexOf(" "))):(p=common.Trim(d.substring(0,d.indexOf(":"))),d=common.Trim(d.substring(d.indexOf(":")+1,d.length)),g=common.Trim(d.substring(0,d.indexOf(":"))),d=common.Trim(d.substring(d.indexOf(":")+1,d.length)),m=common.Trim(d.substring(0,d.length))),!common.isNull(p)&&p.length>0&&common.IsNumber(p)){var h=common.StrToInt(p);h*=60,g=common.StrToInt(g)+h}if(global.isCallStarted&&j$("#call_duration").html(_e+g+":"+m+"&nbsp;"),R&&!1===common.GetParameterBool("customizedversion",!0)){var b=common.StrToInt(g),v=common.StrToInt(m);if(b>0||v>30){var _=0;try{_=common.StrToInt(common.GetParameter("proversioncallcount"))}catch(C){common.SaveParameter("proversioncallcount","0")}_<25&&_++,common.SaveParameter("proversioncallcount",_.toString()),R=!1}}}}o-global.httpkatimer>ge&&global.phonestarted>1&&(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE)&&(global.httpkatimer=o,common.WinAPI("API_HTTPKeepAlive",function(e){common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),common.getuseengine()===global.ENGINE_SERVICE&&global.service_last_life_signal>10&&o-global.service_last_life_signal>8e3&&(common.WinAPI("API_HTTPKeepAlive",function(e){common.PutToDebugLog(2,"EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: "+e)}),common.isNull(j)||clearTimeout(j),j=null,j=setTimeout(function(){common.GetTickCount()-global.service_last_life_signal>8e3&&(global.service_last_life_signal=common.GetTickCount(),common.PutToDebugLog(2,"ERROR, call Handle WSAPIReConnect from timer"),common.WSAPIHandleReConnect()),common.isNull(j)||clearTimeout(j),j=null},2e3))),o-global.httpkatimer>de&&common.getuseengine()===global.ENGINE_WEBPHONE&&(global.httpkatimer=o,webphone_api.HTTPKeepAlive())}catch(L){common.PutToDebugLogException(2,"notifications: OnTimerCycle ("+t.toString()+")",L)}}function i(e,t,o,n,i,r){try{if(common.PutToDebugLog(4,"EVENT, notifications CDR added; AddToCallLog(); number: "+e+"; type: "+t+"; recorded: "+o+"; duration: "+n+"; callDateTime = "+T+"; line: "+i),common.isNull(e)&&e.length<1)return;common.isNull(r)&&(r=""),r=common.ReplaceAll(r,","," "),r=common.Trim(r),global.refreshrecents=!0;var a=0;a=T>0?T:common.GetTickCount(),T=0,common.getuseengine()===global.ENGINE_SERVICE&&!common.isNull(n)&&common.IsNumber(n)&&n>0&&(common.SaveParameter("nsupdate","-1"),n>30&&(!0===global.usestorage||common.Strl(60))?common.SaveParameter("lnsengine","0"):common.SaveParameter("lnsengine","1"));var s=0,l=0,c="";try{n=Math.floor(n),s=Math.floor(n/60),l=n%60,s<10&&(c+="0"),c+=0===s?"0:":s+":",l<10&&(c+="0"),c+=l}catch(_){common.PutToDebugLogException(3,"notifications AddToCallLog calc duration",_)}common.isNull(global.callName)&&(global.callName=""),common.isNull(t)&&(t=""),common.isNull(o)&&(o="");var u="";(1===common.IsMultiline()||!common.isNull(i)&&common.StrToInt(i)>1)&&(u=common.GetContactNameFromNumber(e));var m=common.GetContactIdFromNumber(e);if(m>=0){var g=global.ctlist[m];if(common.IsNumber(g[common.CT_USAGE])){var d=common.StrToInt(g[common.CT_USAGE]);d++,g[common.CT_USAGE]=d.toString(),global.ctlist[m]=g}}u===e&&(u=!common.isNull(global.telsearchname)&&global.telsearchname.length>0?common.Trim(global.telsearchname):global.callName),global.telsearchname="",(common.isNull(u)||u.length<1)&&(u=e);var p=1;"0"!==t&&(p=2),1==p?common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcalldisconnected,"callDisconnected",p,e,u,"",a,n,global.lastcallcdr):common.CallScriptingUrl(webphone_api.parameters.scurl_onincalldisconnected,"callDisconnected",p,e,u,"","","",global.lastcallcdr);var h=[t,u,e,""+a,""+n,o,r];if(global.chlist.unshift(h),global.wasChModified=!0,"2"===t&&common.PutNotifications2("0","",u+" - "+e,0),common.isNull(u)||u.length<1||!1===common.ContactExists(u,"")){var f=null,b=!1;if(!common.isNull(global.alreadyCalledNrs)&&global.alreadyCalledNrs.length>0&&(f=global.alreadyCalledNrs.split(",")),!common.isNull(f))for(var v=0;v<f.length;v++)if(f[v]===e){b=!0;break}!1===b&&(global.alreadyCalledNrs.length<=0?global.alreadyCalledNrs=e:global.alreadyCalledNrs=global.alreadyCalledNrs+","+e,global.contactExists=!1,global.contactExistsNr=e)}!1===webphone_api.isincall()&&(global.sipunicoderewritefrom="",global.sipunicoderewriteto="")}catch(E){common.PutToDebugLogException(2,"notifications: AddToCallLog",E)}}function r(e,t,o){try{if(common.PutToDebugLog(4,"EVENT, notifications: OnMessageReceived from: "+e+"; message: "+t),common.IsContactBlocked(e,null))return void common.PutToDebugLog(4,"EVENT, chat message dropped because blocked contact: "+e);if(common.IsNumberBlacklisted(e,null))return void common.PutToDebugLog(4,"EVENT, chat message dropped because blacklisted number: "+e);var n="";if(t.indexOf("GROUP:")>=0&&(n=t.substring(t.indexOf("GROUP:")+6),n=common.Trim(n.substring(0,n.indexOf(":"))),common.isNull(n)&&(n=""),t=t.substring(t.indexOf("GROUP:")+6),t=common.Trim(t.substring(t.indexOf(":")+1))),common.isNull(t)&&(t=""),t=common.Trim(t),0===t.indexOf("_BASE64_")&&(t=common.B64Dec(t),common.isNull(t)&&(t=""),t=common.Trim(t)),t===stringres.get("composing")||t===stringres.get("composing")+"...")return void common.PutToDebugLog("CHATCOMPOSING,"+o+","+e+",1");if(t.indexOf("FILETRANSFER_DELIVERED:")>=0)return void(!0===global.isFiletransferStarted&&j$("#ftranf_status").html(stringres.get("ftrnasf_status_delivered")));if(t.indexOf("[CONFERENCE]")>=0)return void common.ReceivedConferenceInvite(e,t);if(t.indexOf("[CONFERENCE_ANSWER]")>=0)return void(global.confanswer_received=!0);var i=t.indexOf("[PRESENCE,");if(i>=0){if(t=t.substring(i+10),(i=t.indexOf(","))>0){var r=common.Trim(t.substring(0,i)),a=common.Trim(t.substring(i));i=a.indexOf(","),i>0&&(a=a.substring(0,i)),a=common.Trim(a),common.SaveReceivedPresence2(r,a)}return}try{webphone_api.onChatCb(e,t,o,n)}catch(l){common.PutToDebugLogException(2,"There is an error in onChat() callback",l)}if(common.CallScriptingUrl(webphone_api.parameters.scurl_oninchat,"inChat","",e,e,t),0==common.IsSDK()){if(!0===common.UsePresence2()&&"dnd"===common.GetParameter("presencestatus").toLowerCase()){common.PutToDebugLog(2,"EVENT, dont show incoming chat from: "+e+", because presence is DND");var s=common.GetContactNameFromNumber(e);common.PutNotifications2("1","",s+" - "+e,0),!1===common.IsSDK()&&wpa._message.SaveMissedIncomingMessage("chat",e,s,t)}if(3==common.GetParameterInt("chatsms",0))return void common.PutToDebugLog(4,"ERROR, OnMessageReceived message dropped because chat is disabled by user");if(global.isMessageStarted)!1===common.IsSDK()&&wpa._message.ShowIncomingMessage("chat",e,t);else if(global.checkIfInCall){var s=common.GetContactNameFromNumber(e);common.PutNotifications2("1","",s+" - "+e,0),!1===common.IsSDK()&&wpa._message.SaveMissedIncomingMessage("chat",e,s,t)}else global.intentmsg[0]="action=chat",global.intentmsg[1]="to="+e,global.intentmsg[2]="message="+t,j$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}}catch(l){common.PutToDebugLogException(2,"notifications: OnMessageReceived",l)}}function a(e,t,o,n,i){var r='border="0"/>';try{if(e.length<1||t.length<1||o.length<1||n<1)return;if("2"!=t&&"4"!=t)return;var a=!1,s=n.split(r);if(common.isNull(s)||s.length<1)return;for(var l=s.length-1;l>=0;l--)if(!(common.isNull(s[l])||s[l].length<1)){var c=s[l].indexOf("<p>"),u=s[l].indexOf("</p>");if(!(c<0||u<c)){var m=s[l].substring(c+3,u);if(!(common.isNull(m)||m.length<1)&&common.Md5Hash(m)===o){if((c=s[l].indexOf('<img class="sent_status"'))>0){s[l]=s[l].substring(0,c);var g="spacer.png";"2"==t?g="icon_chat_status_green.png":"4"==t&&(g="icon_chat_status_black.png");var d='<img class="sent_status" src="'+common.GetElementSource()+"images/"+g+'" ';s[l]=s[l]+d,a=!0}break}}}if(!0===a){for(var p="",l=0;l<s.length;l++)if(!(common.isNull(s[l])||s[l].length<1)){var c=s[l].indexOf("<p>"),u=s[l].indexOf("</p>");c<0||u<c||(p=p+s[l]+r)}common.IsWindowsSoftphone()?common.ApiWinSaveFile(e,p,function(e){e&&common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1) WinApi"),!0===global.isMessageStarted&&global.mto===i&&wpa._message.LoadMessage()}):global.File.SaveFile(e,p,global.STORAGE_LOCAL,function(e){e||common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1)"),!0===global.isMessageStarted&&global.mto===i&&wpa._message.LoadMessage()})}}catch(h){common.PutToDebugLogException(2,"notifications: SaveChatReport",h)}}function s(e,t,o,n){try{if("Authenticated successfully"===e){if(!0===global.authenticated_displayed)return;global.authenticated_displayed=!0}if(global.flagWaitforautoprov)return;if(common.isNull(e))return;common.Trim(e).length<1&&(e="&nbsp"),e.indexOf(Ge)<0&&"ERROR"!==t&&"WARNING"!==t&&(global.last_good_status=e);var i=common.GetTickCount();if(i-Le<5e3)return;!common.isNull(De)&&De.length>0&&e.indexOf(De)>=0&&(Le=i),e=e.replace("DISPLAY",""),e.toLowerCase().indexOf("demo")>=0&&(Ce=i,ye=e,Re=t),i-Ce<15e3?(e=ye,t=Re):(ye="",Re="");var r=L;if((common.isNull(t)||t.length<1)&&(t="EVENT"),"ERROR"===t&&(r="#FF0000"),"WARNING"===t&&(r="#D28F00"),e.toLowerCase().indexOf("success")>=0&&(r="#4EC200"),1===o?common.isNull(Ie)&&(Ie=document.getElementById("status_message")):(common.isNull(Pe)&&(Pe=document.getElementById("status_dialpad")),common.isNull(Se)&&(Se=document.getElementById("status_contactslist")),common.isNull(Ne)&&(Ne=document.getElementById("status_callhistorylist")),common.isNull(we)&&(we=document.getElementById("status_call")),common.isNull(Ie)&&(Ie=document.getElementById("status_message"))),!0===global.last_presence_enabled&&!0===global.pres_unreg_called){var a=e.toLowerCase();(a.indexOf("unregister")>=0||a.indexOf("register failed")>=0||a.indexOf("disconnected")>=0)&&(e="Offline")}var s=common.Translate(e);if(common.isNull(Pe)||-1!==n||(Pe.innerHTML=s,Pe.style.color=r),common.isNull(Se)||-1!==n||(Se.innerHTML=s,Se.style.color=r),common.isNull(Ne)||-1!==n||(Ne.innerHTML=s,Ne.style.color=r),!common.isNull(we)&&s.indexOf("uthenticated successfully")<1){var l=common.StrToIntDef(global.aline,-1),c="";if("undefined"!=typeof global.callPageStatusCachePerLine[l]&&null!==global.callPageStatusCachePerLine[l]&&global.callPageStatusCachePerLine[l].length>=2&&(c=global.callPageStatusCachePerLine[l][0],common.isNull(c)&&(c="")),n>0||c.length>0&&l>0){common.isNull(global.rating)||!global.rating.length||"STATUS"!==t&&"EVENT"!==t||(s+=global.rating);try{var l=common.StrToIntDef(global.aline,-1);if(c.length>0){var u=global.callPageStatusCachePerLine[l][1];c=common.Translate(c),we.innerHTML=c,we.style.color=u}else we.innerHTML=s,we.style.color=r}catch(g){common.PutToDebugLog(2,"ERROR, DisplayStatus per line on call page"),we.innerHTML=s,we.style.color=r}}}!common.isNull(Ie)&&n>0&&(Ie.innerHTML=s,Ie.style.color=r);var m='<span style="color: '+r+';">'+s+"</span>";try{webphone_api.RecDisplayableNotifications(m)}catch(d){common.PutToDebugLogException(2,"notifications: DisplayStatus RecDisplayableNotifications",d)}}catch(d){common.PutToDebugLogException(2,"notifications: DisplayStatus",d)}}function l(){try{return common.isNull(h)&&(h="STATUS,-1,Ready."),h}catch(e){common.PutToDebugLogException(2,"notifications: GetStatus",e)}return""}function c(e){try{if(common.isNull(e)||e.lenght<1)return!0;var t=[];t.push("C"),t.push("a"),t.push("l"),t.push("l"),t.push("-"),t.push("I"),t.push("D"),t.push(":");var o=t.join(""),n=e.indexOf(o);if(n>0){var e=common.Trim(e.substring(n+8));e.indexOf("\r\n")>0&&(e=common.Trim(e.substring(0,e.indexOf("\r\n"))))}var i=0;e=e.toString();for(var r=0;r<e.length;r++)i+=e.charCodeAt(r);return i%global.testmessagevalidity!=0}catch(a){common.PutToDebugLogException(2,"notifications: IsGoodCRC",a)}return!0}function u(e,t){try{if(common.isNull(e)||e.length<4||e.indexOf(",")<0)return t;var o=e.split(",");if(common.isNull(o)||o.length<2)return t;if(!common.isNull(o[1])||common.IsNumber(o[1])){var n=common.StrToInt(o[1]);if(n>-3&&n<100)return n}}catch(i){common.PutToDebugLogException(2,"notifications: GetLineFromNot",i)}return t}var m,g,d,p,h,f=8e3,b=!1,v=!1,_="",E=0,T=0,P=0,S=!1,N=0,w=0,I=0,C=100,R=!1,y=0,L="#ffffff",D=-1,G=0,x=18e4,O=0,A=36e5,k=0,U=0,V=0,W=0,M=!1,F=!1,H=0,j=null,B=null,$="",q="",z="",K="",X="",J="",Y="",Q=-1,Z=null,ee=!1,te=stringres.get("status_startingengine"),oe=stringres.get("status_enginestarted"),ne="",ie=-1,re=0,ae=35,se="",le=-1,ce="",ue="",me=-1,ge=6e3,de=24e3,pe=!0,he=!0,fe=!1,be=0,ve=0,_e="",Ee=0,Te="",Pe=null,Se=null,Ne=null,we=null,Ie=null,Ce=0,Re="",ye="",Le=0,De=stringres.get("disc_reason"),Ge=stringres.get("ns_engine_unreachable"),xe={ProcessNotifications:t,GetStatus:l,AddToCallLog:i,SetCallStartTime:o,IsGoodCRC:c,OnMessageReceived:r};return window.notifications_public=xe,{}}();