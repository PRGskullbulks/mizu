wpa._accounts=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _accounts: onCreate"),j$(window).resize(function(){"page_accounts"===j$.mobile.activePage.attr("id")&&t()}),j$("#accounts_menu_ul").on("click","li",function(e){l(j$(this).attr("id"))}),j$("#btn_accounts_menu").on("click",function(){s("#accounts_menu_ul")}),j$("#btn_accounts_menu").attr("title",stringres.get("hint_menu")),j$(".minus_btn").attr("title",stringres.get("hint_removephone")),j$("#btn_add_acc").attr("title",stringres.get("accounts_add_hint"))}catch(a){common.PutToDebugLogException(2,"_accounts: onCreate",a)}}function a(e){try{common.PutToDebugLog(4,"EVENT, _accounts: onStart"),global.isAccountsStarted=!0,j$("#btn_add_acc").on("click",function(){n()}),j$("#acc_add_p").html(stringres.get("add_account")),document.getElementById("aec_label_phone").innerHTML=stringres.get("contact_phone"),j$("#accounts_list").attr("data-filter-placeholder",stringres.get("ct_search_hint")),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_accounts"),-30)),common.isNull(document.getElementById("addeditct_btnback"))||(document.getElementById("addeditct_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("btn_cancel"));var a="";if(!common.isNull(global.sipaccounts)&&global.sipaccounts.length>0){for(var c="",i=0;i<global.sipaccounts.length;i++){var s=global.sipaccounts[i];if(!0===s.ismain){var c=s.username;!common.isNull(s.serveraddress)&&s.serveraddress.length>0&&(c=c+"@"+s.serveraddress);break}}!common.isNull(c)&&c.length>0&&(a=stringres.get("active_account")+" "+c+". ")}var l=stringres.get("accounts_instructions1")+" "+a+stringres.get("accounts_instructions2");j$("#text_instructions").html(l),t(),document.getElementById("accounts_title").innerHTML=stringres.get("accounts_title"),j$("#accounts_title").attr("title",stringres.get("hint_page")),o()}catch(r){common.PutToDebugLogException(2,"_accounts: onStart",r)}}function t(){try{j$("#page_accounts").css("min-height","auto");var e=common.GetDeviceHeight()-j$("#accounts_header").height();e-=5,j$("#page_accounts_content").height(e)}catch(a){common.PutToDebugLogException(2,"_accounts: MeasureAccountst",a)}}function o(){try{var e="";if(common.isNull(global.sipaccounts)||global.sipaccounts.length<1)return j$(".btn_remove_account").off("click"),void j$("#acc_list").html("<br /><br />"+stringres.get("noaccounts"));for(var a=0;a<global.sipaccounts.length;a++){var t=global.sipaccounts[a],n=common.ReplaceAll(u,"[NR]",a.toString()),i=t.username;!common.isNull(t.serveraddress)&&t.serveraddress.length>0&&(i=i+"@"+t.serveraddress),n=n.replace("[USERNAME]",i),n=!0===t.ismain?n.replace("[MAIN_CHECKED]",'checked="checked"'):n.replace("[MAIN_CHECKED]",""),n=!0===t.enabled?n.replace("[ENABLE_CHECKED]",'checked="checked"'):n.replace("[ENABLE_CHECKED]",""),e+=n}j$("#acc_list").html(e),j$("#acc_list").trigger("create"),j$(".btn_remove_account").on("click",function(e){try{var a=j$(this).attr("id");if(!common.isNull(a)&&a.lastIndexOf("_")>0){var t=a.substring(a.lastIndexOf("_")+1);if(!common.isNull(t)&&!0===common.IsNumber(t)){c(common.StrToInt(t))}}}catch(o){common.PutToDebugLogException(2,"_accounts: remove account",o)}}),j$(".acc_checkbox").on("change",function(e){try{var a=j$(this).attr("id");if(!common.isNull(a)&&a.lastIndexOf("_")>0){var t=document.getElementById(a).checked,c=a.substring(a.lastIndexOf("_")+1);if(!common.isNull(c)&&!0===common.IsNumber(c)){var n=common.StrToInt(c);global.sipaccounts[n].enabled=t;for(var i=!1,s=0;s<global.sipaccounts.length;s++)if(s!==n&&!0===global.sipaccounts[s].enabled){i=!0;break}if(i){if(!1===t&&!0===global.sipaccounts[n].ismain)for(var s=0;s<global.sipaccounts.length;s++)if(s!==n&&!1!==global.sipaccounts[s].enabled){for(var l=0;l<global.sipaccounts.length;l++)global.sipaccounts[l].ismain=!1;global.sipaccounts[s].ismain=!0;break}}else if(global.sipaccounts.length>1){for(var s=0;s<global.sipaccounts.length;s++)if(s!==n){global.sipaccounts[s].enabled=!0,document.getElementById("acc_checkbox_"+s).checked=!0;for(var l=0;l<global.sipaccounts.length;l++)global.sipaccounts[l].ismain=!1;global.sipaccounts[s].ismain=!0,j$("#acc_radio_"+s).prop("checked",!0);break}}else{global.sipaccounts[0].enabled=!0,document.getElementById(a).checked=!0;for(var l=0;l<global.sipaccounts.length;l++)global.sipaccounts[l].ismain=!1;global.sipaccounts[0].ismain=!0,j$("#acc_radio_0").prop("checked",!0)}for(var s=0;s<global.sipaccounts.length;s++)j$("#acc_radio_"+s).is(":checked")?global.sipaccounts.ismain=!0:global.sipaccounts.ismain=!1;j$(".acc_checkbox").off("change"),common.SaveSipAccounts(),setTimeout(function(){o()},0)}}}catch(r){common.PutToDebugLogException(2,"_accounts: change ismain",r)}}),j$(".acc_radio").change(function(){try{for(var e=0;e<global.sipaccounts.length;e++)if(j$("#acc_radio_"+e).is(":checked")){for(var a=0;a<global.sipaccounts.length;a++)global.sipaccounts[a].ismain=!1;global.sipaccounts[e].ismain=!0,!1===global.sipaccounts[e].enabled&&(global.sipaccounts[e].enabled=!0),j$(".acc_radio").off("change"),common.SaveSipAccounts(),setTimeout(function(){o()},0);break}}catch(t){common.PutToDebugLogException(2,"_accounts: select ismain",t)}})}catch(s){common.PutToDebugLogException(2,"_accounts: PopulateData",s)}}function c(e,a){try{var t=common.GetDeviceWidth();t=!common.isNull(t)&&common.IsNumber(t)&&t>100?Math.floor(t/1.2):220;var c=global.sipaccounts[e].username,i='<div id="adialog_deleteaccount" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("accounts_remove_hint")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+stringres.get("accounts_remove_msg")+": "+c+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";a=a||function(){},j$.mobile.activePage.append(i).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*common.GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_adialog_ok").off("click"),a()}}),j$("#btn_adialog_ok").on("click",function(){try{global.sipaccounts.splice(e,1),common.PutToDebugLog(2,"EVENT, _accounts, account removed: "+e);for(var a=!1,t=0;t<global.sipaccounts.length;t++)t!==e&&!0===global.sipaccounts[t].enabled&&(a=!0);if(!a)if(global.sipaccounts.length>1){for(var t=0;t<global.sipaccounts.length;t++)if(t!==e){global.sipaccounts[t].enabled=!0,document.getElementById("acc_checkbox_"+t).checked=!0;for(var c=0;c<global.sipaccounts.length;c++)global.sipaccounts[c].ismain=!1;global.sipaccounts[t].ismain=!0,j$("#acc_radio_"+t).prop("checked",!0);break}}else if(!common.isNull(global.sipaccounts)&&global.sipaccounts.length>0){global.sipaccounts[0].enabled=!0,document.getElementById(id).checked=!0;for(var c=0;c<global.sipaccounts.length;c++)global.sipaccounts[c].ismain=!1;global.sipaccounts[0].ismain=!0,j$("#acc_radio_0").prop("checked",!0)}common.SaveSipAccounts(),o(),global.sipaccounts.length<1&&n()}catch(i){common.PutToDebugLogException(2,"_accounts: DeleteAccountPopup inner OK",i)}})}catch(s){common.PutToDebugLogException(2,"_accounts: DeleteAccountPopup",s)}}function n(e){try{var a=common.GetDeviceWidth();a=!common.isNull(a)&&common.IsNumber(a)&&a>100?Math.floor(a/1.2):220;var t=stringres.get("accounts_hint_server"),c=stringres.get("accounts_hint_user"),n=stringres.get("accounts_hint_password"),s=stringres.get("accounts_hint_callerid"),l=stringres.get("accounts_hint_displayname"),r=stringres.get("accounts_hint_proxy"),d=stringres.get("accounts_hint_realm"),u=stringres.get("accounts_hint_regival"),m="";if(!0===common.ShowServerInput()){var g=common.GetParameter("serveraddress_user"),p="";!common.isNull(g)&&g.length>0&&(p='value="'+g+'"'),m='<label for="addacc_serveraddress">'+stringres.get("addacc_server")+':</label><input type="text" id="addacc_serveraddress" name="addacc_serveraddress" data-theme="a" autocapitalize="off" '+p+' placeholder="'+t+'" />'}var _='<div id="addaccountpopup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+a+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("addaccount_title")+'</h1></div><div role="main" class="ui-content adialog_content" style="margin-right: 1em;"><style>#addaccountpopup LABEL{ text-align: left; font-size: .8em; }</style><span>'+stringres.get("addaccount_msg")+"</span>"+m+'<label for="addacc_username">'+stringres.get("addacc_user")+':</label><input type="text" id="addacc_username" name="addacc_username" data-theme="a" autocapitalize="off" placeholder="'+c+'" /><label for="addacc_password">'+stringres.get("addacc_password")+':</label><input type="text" id="addacc_password" name="addacc_password" data-theme="a" autocapitalize="off" placeholder="'+n+'" /><br /><a href="javascript:;" id="show_hide_advanced">'+stringres.get("ac_showadvanced")+'</a><br /><br /><div id="addaccountpopup_advanced" style="display: none; margin-left: 2em;"><label for="addacc_callerid">'+stringres.get("sett_display_name_username")+':</label><input type="text" id="addacc_callerid" name="addacc_callerid" value="" data-theme="a" autocapitalize="off" placeholder="'+s+'" /><label for="addacc_displayname">'+stringres.get("sett_display_name_displayname")+':</label><input type="text" id="addacc_displayname" name="addacc_displayname" value="" data-theme="a" autocapitalize="off" placeholder="'+l+'" /><label for="addacc_proxyaddress">'+stringres.get("sett_display_name_proxyaddress")+':</label><input type="text" id="addacc_proxyaddress" name="addacc_proxyaddress" value="" data-theme="a" autocapitalize="off" placeholder="'+r+'" /><label for="addacc_realm">'+stringres.get("sett_display_name_realm")+':</label><input type="text" id="addacc_realm" name="addacc_realm" value="" data-theme="a" autocapitalize="off" placeholder="'+d+'" /><br /><label for="addacc_ival">'+stringres.get("addacc_ival")+':</label><input type="text" id="addacc_ival" name="addacc_ival" value="3600" data-theme="a" autocapitalize="off" placeholder="'+u+'" /></div></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(_).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){var e=Math.floor(.6*common.GetDeviceHeight());j$(this).height()>e+100&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click")}}),j$("#adialog_positive").on("click",function(e){var a=j$("#addacc_serveraddress").val(),t=j$("#addacc_username").val(),c=j$("#addacc_password").val(),n=j$("#addacc_callerid").val(),s=j$("#addacc_displayname").val(),l=j$("#addacc_proxyaddress").val(),r=j$("#addacc_realm").val(),d=j$("#addacc_ival").val();j$("#addaccountpopup").on("popupafterclose",function(e){if("MSIE"===common.GetBrowser()&&e.preventDefault(),common.PutToDebugLog(5,"EVENT, accounts AddAccount ok onclick"),i(j$.mobile.activePage.find(".messagePopup")),!0===common.ShowServerInput()){if(common.isNull(a)||a.length<1)return void common.ShowToast(stringres.get("addacc_invalid")+" "+stringres.get("addacc_server"))}else a=common.GetParameter("serveraddress"),(common.isNull(a)||a.length<1)&&(a=common.GetParameter("serveraddress_user"));if(common.isNull(t)||t.length<1)return void common.ShowToast(stringres.get("addacc_invalid")+" "+stringres.get("addacc_user"));if(common.isNull(c)||c.length<1)return void common.ShowToast(stringres.get("addacc_invalid")+" "+stringres.get("addacc_password"));if(common.isNull(d)||d.length<1||!common.IsNumber(d))return void common.ShowToast(stringres.get("addacc_invalid")+" "+stringres.get("addacc_ival"));a=common.NormalizeInput(a,0),t=common.NormalizeInput(t,0),d=common.NormalizeInput(d,0),common.isNull(n)&&(n=""),common.isNull(s)&&(s=""),common.isNull(l)&&(l=""),common.isNull(r)&&(r=""),n=common.NormalizeInput(n,0),s=common.NormalizeInput(s,0),l=common.NormalizeInput(l,0),r=common.NormalizeInput(r,0),(common.isNull(d)||0==common.IsNumber(d))&&(d="3600");var u=common.StrToInt(d),m=!1;global.sipaccounts.length<1&&(m=!0),common.AddOneAcc(a,t,c,u,!0,m,!1,n,s,l,r),o()})}),j$("#adialog_negative").on("click",function(e){"MSIE"===common.GetBrowser()&&e.preventDefault(),i(j$.mobile.activePage.find(".messagePopup"))}),j$("#show_hide_advanced").on("click",function(e){if(j$("#addaccountpopup_advanced").is(":visible")){j$("#addaccountpopup_advanced").hide(),j$("#show_hide_advanced").html(stringres.get("ac_showadvanced"));var a=Math.floor(.6*common.GetDeviceHeight());j$(".messagePopup .ui-content").height()>a+100&&j$(".messagePopup .ui-content").height(a)}else{j$("#addaccountpopup_advanced").show(),j$("#show_hide_advanced").html(stringres.get("ac_hideadvanced"));var a=Math.floor(.6*common.GetDeviceHeight());j$(".messagePopup .ui-content").height()>a+100&&j$(".messagePopup .ui-content").height(a)}"MSIE"===common.GetBrowser()&&e.preventDefault(),i(j$.mobile.activePage.find(".messagePopup"))})}catch(b){common.PutToDebugLogException(2,"_accounts: AddAccount",b)}}function i(e){try{if(common.isNull(e)||common.isNull(e.popup))return;"MSIE"===common.GetBrowser()?e.popup("close"):"Firefox"===common.GetBrowser()&&setTimeout(function(){try{e.popup("close")}catch(a){}},200)}catch(a){common.PutToDebugLogException(2,"_accounts: ManuallyClosePopup",a)}}function s(e){try{return common.IsWindowsSoftphone()&&j$("#btn_accounts_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _accounts: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _accounts: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+m+'"><a data-rel="back">'+stringres.get("btn_close")+"</a></li>").listview("refresh"),!0)}catch(a){common.PutToDebugLogException(2,"_accounts: CreateOptionsMenu",a)}return!1}function l(e){try{if(common.isNull(e)||e.length<1)return;j$("#accounts_menu").on("popupafterclose",function(a){switch(j$("#accounts_menu").off("popupafterclose"),e){case m:j$.mobile.back()}})}catch(a){common.PutToDebugLogException(2,"_accounts: MenuItemSelected",a)}}function r(e){try{common.PutToDebugLog(4,"EVENT, _accounts: onStop"),global.isAccountsStarted=!1,j$(".btn_remove_account").off("click"),j$("#btn_add_acc").off("click"),j$("#acc_list").html("")}catch(a){common.PutToDebugLogException(2,"_accounts: onStop",a)}}function d(e){}var u='<div class="acc_item" id="acc_item_[NR]"><div class="acc_control"><input type="checkbox" class="acc_checkbox" id="acc_checkbox_[NR]" title="'+stringres.get("accounts_endis_hint")+'" name="acc_checkbox_[NR]" [ENABLE_CHECKED]><input type="radio" class="acc_radio" id="acc_radio_[NR]" title="'+stringres.get("accounts_main_hint")+'" name="acc_active_selection" [MAIN_CHECKED]></div><div class="acc_username" id="acc_username_[NR]">[USERNAME]</div><div class="acc_remove"><button id="btn_remove_account_[NR]" title="'+stringres.get("accounts_remove_hint")+'" class="btn_remove_account noshadow ui-btn-inline ui-btn ui-btn-corner-all ui-btn-b ui-icon-minus ui-btn-icon-notext">Remove</button></div><div class="separator_color_bg">\x3c!--//--\x3e</div></div>',m="#menuitem_accounts_close";return{onCreate:e,onStart:a,onStop:r,onDestroy:d}}();