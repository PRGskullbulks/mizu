wpa._addeditcontact=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _addeditcontact: onCreate"),j$(window).resize(function(){"page_addeditcontact"===j$.mobile.activePage.attr("id")&&o()}),j$("#addeditcontact_menu_ul").on("click","li",function(e){_(j$(this).attr("id"))}),j$("#btn_addeditcontact_menu").on("click",function(){s("#addeditcontact_menu_ul")}),j$("#btn_addeditcontact_menu").attr("title",stringres.get("hint_menu")),j$("#btn_save_aec").on("click",function(){r()}),j$("#btn_revert_aec").on("click",function(){j$.mobile.back()}),j$("#btn_add_aec").on("click",function(){a(null,null,!0)}),j$("#btn_add_aec").attr("title",stringres.get("hint_addphone")),j$(".minus_btn").attr("title",stringres.get("hint_removephone")),j$("#btn_add_aec_details").on("click",function(){i()}),j$("#btn_add_aec_details").attr("title",stringres.get("addeditct_hint_adddetails"));var t=j$("#aec_number_fields").children().length;if(!common.isNull(t)&&t>0)for(var n=0;n<t;n++)!function(e){j$("#btn_type_aec_"+e).on("click",function(){c(e,j$(this).html())}),j$("#btn_minus_aec_"+e).on("click",function(){l(e)})}(n);j$("#page_addeditcontact").keydown(function(e){if(13===e.which)j$("#btn_save_aec").click(),e.preventDefault();else{if(27!==e.which)return;j$("#btn_revert_aec").click(),e.preventDefault()}})}catch(d){common.PutToDebugLogException(2,"_addeditcontact: onCreate",d)}}function t(e){try{if(common.PutToDebugLog(4,"EVENT, _addeditcontact: onStart"),global.isAddeditcontactStarted=!0,document.getElementById("aec_label_name").innerHTML=stringres.get("contact_name"),j$("#aec_name").attr("placeholder",stringres.get("contact_name")),j$("#aec_lastname").attr("placeholder",stringres.get("contact_lastname")),document.getElementById("aec_label_phone").innerHTML=stringres.get("contact_phone"),document.getElementById("btn_save_aec").innerHTML=stringres.get("btn_save"),document.getElementById("btn_revert_aec").innerHTML=stringres.get("btn_cancel"),j$("#addeditcontact_list").attr("data-filter-placeholder",stringres.get("ct_search_hint")),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_addeditcontact"),-30)),common.isNull(document.getElementById("addeditct_btnback"))||(document.getElementById("addeditct_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("btn_cancel")),j$("#aec_label_details").html(stringres.get("addeditct_addfield")),j$("#aec_entry_email label").html(stringres.get("addeditct_label_email")+":"),j$("#aec_entry_address label").html(stringres.get("addeditct_label_address")+":"),j$("#aec_entry_notes label").html(stringres.get("addeditct_label_notes")+":"),j$("#aec_entry_website label").html(stringres.get("addeditct_label_website")+":"),o(),setTimeout(function(){o()},1e3),p=common.GetIntentParam(global.intentaddeditct,"action"),!common.isNull(p)&&p.length>0)if("add"===p)b=common.GetIntentParam(global.intentaddeditct,"numbertoadd"),h=common.GetIntentParam(global.intentaddeditct,"nametoadd"),common.isNull(h)&&(h=""),document.getElementById("addeditct_title").innerHTML=stringres.get("addeditct_title_new");else if("edit"===p){try{f=common.StrToInt(common.GetIntentParam(global.intentaddeditct,"ctid"))}catch(t){common.PutToDebugLogException(2,"_addeditcontact: onStart can't convert contact id",t)}$=global.ctlist[f],T=$[common.CT_NUMBER],y=$[common.CT_PTYPE],document.getElementById("addeditct_title").innerHTML=stringres.get("addeditct_title_edit")}else j$.mobile.back();j$("#addeditct_title").attr("title",stringres.get("hint_page")),!common.isNull($)&&$.length>0&&(v=$[common.CT_NAME]),j=document.getElementById("aec_name"),"add"!==p||common.isNull(j)||j.focus(),n()}catch(a){common.PutToDebugLogException(2,"_addeditcontact: onStart",a)}}function o(){try{j$("#page_addeditcontact").css("min-height","auto");var e=common.GetDeviceHeight()-j$("#addeditcontact_header").height()-j$("#aec_footer").height();e-=5,j$("#page_addeditcontact_content").height(e)}catch(t){common.PutToDebugLogException(2,"_addeditcontact: MeasureAddeditcontact",t)}}function n(){try{if("add"===p)h.length>0&&(j.value=h),!common.isNull(b)&&b.length>0?a("",common.Trim(b),!1):a("","",!1);else if("edit"===p){if(j.value=common.Trim(v),f<0)return void common.PutToDebugLog(2,"ERROR, _addeditcontact PopulateData incorrect ctid");if(common.isNull(T)||T.length<1)return;for(var e=j$("#aec_number_fields").children().length,t=0;t<T.length&&!(t>=e);t++){var o="";common.isNull(y[t])||(o=y[t]),a(o,T[t],!1)}var n=$[common.CT_EMAIL],i=$[common.CT_ADDRESS],c=$[common.CT_NOTES],l=$[common.CT_WEBSITE];!common.isNull(n)&&common.Trim(n).length>0&&(j$("#number_aec_email").val(n),j$("#aec_entry_email").show()),!common.isNull(i)&&common.Trim(i).length>0&&(j$("#number_aec_address").val(i),j$("#aec_entry_address").show()),!common.isNull(c)&&common.Trim(c).length>0&&(j$("#number_aec_notes").val(c),j$("#aec_entry_notes").show()),!common.isNull(l)&&common.Trim(l).length>0&&(j$("#number_aec_website").val(l),j$("#aec_entry_website").show())}j$("#aec_entry_email").is(":visible")&&j$("#aec_entry_address").is(":visible")&&j$("#aec_entry_notes").is(":visible")&&j$("#aec_entry_website").is(":visible")&&j$("#aec_add_deatils").hide()}catch(r){common.PutToDebugLogException(2,"_addeditcontact: PopulateData",r)}}function a(e,t,o){try{o&&common.PutToDebugLog(5,"EVENT, _addeditcontact: AddPhoneField on click"),(common.isNull(e)||e.length<3)&&(e="phone"),common.isNull(t)&&(t="");var n=j$("#aec_number_fields").children().length;j$("#aec_number_fields").children();if(common.isNull(n)||n<1)return;for(var a=0;a<n;a++){var i=document.getElementById("aec_entry_"+a);if(!common.isNull(i)&&"none"===i.style.display){i.style.display="block",j$("#btn_type_aec_"+a).html(stringres.get(e)),j$("#number_aec_"+a).val(t),o&&j$("#btn_type_aec_"+a).click();break}}}catch(c){common.PutToDebugLogException(2,"_addeditcontact: AddPhoneField",c)}}function i(e){try{var t=common.GetDeviceWidth();t=!common.isNull(t)&&common.IsNumber(t)&&t>100?Math.floor(t/1.2):220;var o="",n='<li id="#addfield_item_email"><a data-rel="back">'+stringres.get("addeditct_label_email")+"</a></li>",a='<li id="#addfield_item_address"><a data-rel="back">'+stringres.get("addeditct_label_address")+"</a></li>",i='<li id="#addfield_item_notes"><a data-rel="back">'+stringres.get("addeditct_label_notes")+"</a></li>",c='<li id="#addfield_item_website"><a data-rel="back">'+stringres.get("addeditct_label_website")+"</a></li>";j$("#aec_entry_email").is(":visible")||(o+=n),j$("#aec_entry_address").is(":visible")||(o+=a),j$("#aec_entry_notes").is(":visible")||(o+=i),j$("#aec_entry_website").is(":visible")||(o+=c);var l='<div id="addfieldpopup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+t+"px; min-width: "+Math.floor(.6*t)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("addeditct_hint_adddetails")+'</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="addfieldpopup_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">'+o+"</ul></div></div>";e=e||function(){},j$.mobile.activePage.append(l).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#addfieldpopup_ul").off("click","li"),e()}}),j$("#addfieldpopup_ul").on("click","li",function(e){var t=j$(this).attr("id");j$("#addfieldpopup").on("popupafterclose",function(e){"#addfield_item_email"===t&&j$("#aec_entry_email").show(),"#addfield_item_address"===t&&j$("#aec_entry_address").show(),"#addfield_item_notes"===t&&j$("#aec_entry_notes").show(),"#addfield_item_website"===t&&j$("#aec_entry_website").show(),j$("#aec_entry_email").is(":visible")&&j$("#aec_entry_address").is(":visible")&&j$("#aec_entry_notes").is(":visible")&&j$("#aec_entry_website").is(":visible")&&j$("#aec_add_deatils").hide()})})}catch(r){common.PutToDebugLogException(2,"_addeditcontact: AddDetailsField",r)}}function c(e,t,o){try{var n=common.GetDeviceWidth();n=!common.isNull(n)&&common.IsNumber(n)&&n>100?Math.floor(n/1.2):220;var a="",i="",c="",l="",r="",d="",m="",s="",_="";!common.isNull(t)&&t.length>0?(t===stringres.get("phone")&&(a='checked="checked"'),t===stringres.get("home")&&(i='checked="checked"'),t===stringres.get("mobile")&&(c='checked="checked"'),t===stringres.get("work")&&(l='checked="checked"'),t===stringres.get("other")&&(r='checked="checked"'),t===stringres.get("fax_home")&&(d='checked="checked"'),t===stringres.get("fax_work")&&(m='checked="checked"'),t===stringres.get("pager")&&(s='checked="checked"'),t===stringres.get("sip")&&(_='checked="checked"')):a='checked="checked"';var u='<form><fieldset data-role="controlgroup"><input name="phone_type" id="radio_phone" value="on" '+a+' type="radio"><label for="radio_phone">'+stringres.get("phone")+'</label><input name="phone_type" id="radio_home" value="on" '+i+' type="radio"><label for="radio_home">'+stringres.get("home")+'</label><input name="phone_type" id="radio_mobile" value="on" '+c+' type="radio"><label for="radio_mobile">'+stringres.get("mobile")+'</label><input name="phone_type" id="radio_work" value="on" '+l+' type="radio"><label for="radio_work">'+stringres.get("work")+'</label><input name="phone_type" id="radio_other" value="on" '+r+' type="radio"><label for="radio_other">'+stringres.get("other")+'</label><input name="phone_type" id="radio_fax_home" value="on" '+d+' type="radio"><label for="radio_fax_home">'+stringres.get("fax_home")+'</label><input name="phone_type" id="radio_fax_work" value="on" '+m+' type="radio"><label for="radio_fax_work">'+stringres.get("fax_work")+'</label><input name="phone_type" id="radio_pager" value="on" '+s+' type="radio"><label for="radio_pager">'+stringres.get("pager")+'</label><input name="phone_type" id="radio_sip" value="on" '+_+' type="radio"><label for="radio_sip">'+stringres.get("sip")+"</label></fieldset></form>",g='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+"px; min-width: "+Math.floor(.6*n)+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("contact_alert_title")+'</h1></div><div role="main" class="ui-content">'+u+"</div></div>";o=o||function(){},j$.mobile.activePage.append(g).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),o()}}),j$(":radio").on("change",function(t){j$.mobile.activePage.find(".messagePopup").popup("close");var o=j$(this).attr("id");if(!(common.isNull(o)||o.length<1)){var n=o.indexOf("_");n>0&&n<o.length&&(o=o.substring(n+1)),j$("#btn_type_aec_"+e).html(stringres.get(o))}})}catch(p){common.PutToDebugLogException(2,"_addeditcontact: ChooseType",p)}}function l(e){try{var t=document.getElementById("aec_entry_"+e);common.isNull(t)||(t.style.display="none")}catch(o){common.PutToDebugLogException(2,"_addeditcontact: RemoveEntry",o)}}function r(){try{if("add"===p)m();else{if("edit"!==p)return;d()}}catch(e){common.PutToDebugLogException(2,"_addeditcontact: SaveContact",e)}}function d(){try{var e=j.value;common.isNull(e)&&(e=""),e=common.Trim(e);var t=j$("#aec_number_fields").children().length;if(common.isNull(t)||t<1)return void common.PutToDebugLog(2,"ERROR, SaveEditedContact fieldcount is null");for(var o=[],n=[],a=0,i=0;i<t;i++){var c=document.getElementById("aec_entry_"+i),l=j$("#number_aec_"+i).val(),r=j$("#btn_type_aec_"+i).html(),d=stringres.get("mobile");common.isNull(c)||"none"===c.style.display||(common.isNull(l)||common.Trim(l).length<1||(r===stringres.get("phone")&&(d="phone"),r===stringres.get("home")&&(d="home"),r===stringres.get("mobile")&&(d="mobile"),r===stringres.get("work")&&(d="work"),r===stringres.get("other")&&(d="other"),r===stringres.get("fax_home")&&(d="fax_home"),r===stringres.get("fax_work")&&(d="fax_work"),r===stringres.get("pager")&&(d="pager"),r===stringres.get("sip")&&(d="sip"),o[a]=l,n[a]=d,a++))}if(common.isNull(o)||o.length<1){if(e.length<1)return void common.ShowToast(stringres.get("contact_no_nunber"));if(e.indexOf(" ")<0){var m="phone";common.IsNumber(e)||(m="sip"),o.push(e),n.push(m)}}e.length<1&&(e=o[0]);var s=common.GetTickCount().toString(),_="",u="",g="",p="";j$("#number_aec_email").is(":visible")&&(_=j$("#number_aec_email").val(),_=common.isNull(_)?"":common.Trim(_)),j$("#number_aec_address").is(":visible")&&(u=j$("#number_aec_address").val(),u=common.isNull(u)?"":common.Trim(u),u=common.ReplaceAll(u,"\r\n"," "),u=common.ReplaceAll(u,"\n"," "),u=common.ReplaceAll(u,","," ")),j$("#number_aec_notes").is(":visible")&&(g=j$("#number_aec_notes").val(),g=common.isNull(g)?"":common.Trim(g),g=common.ReplaceAll(g,"\r\n"," "),g=common.ReplaceAll(g,"\n"," "),g=common.ReplaceAll(g,","," ")),j$("#number_aec_website").is(":visible")&&(p=j$("#number_aec_website").val(),p=common.isNull(p)?"":common.Trim(p));var b=[];return b[common.CT_NAME]=e,b[common.CT_NUMBER]=o,b[common.CT_PTYPE]=n,b[common.CT_USAGE]=$[common.CT_USAGE],b[common.CT_LASTMODIF]=s,b[common.CT_DELFLAG]=$[common.CT_DELFLAG],b[common.CT_FAV]=$[common.CT_FAV],b[common.CT_EMAIL]=_,b[common.CT_ADDRESS]=u,b[common.CT_NOTES]=g,b[common.CT_WEBSITE]=p,b[common.CT_LASTACTIVE]=common.GetTickCount().toString(),b[common.CT_ISFROMSYNC]="0",global.ctlist[f]=b,global.wasCtModified=!0,common.SortContacts(),setTimeout(function(){common.ShowToast(stringres.get("contact_saved"))},300),void j$.mobile.back()}catch(h){common.PutToDebugLogException(2,"_addeditcontact: SaveEditedContact",h)}try{common.ShowToast(stringres.get("contact_save_error")),j$.mobile.back()}catch(h){}}function m(){try{var e=j.value;common.isNull(e)&&(e=""),e=common.Trim(e);var t=j$("#aec_number_fields").children().length;if(common.isNull(t)||t<1)return void common.PutToDebugLog(2,"ERROR, SaveNewContact fieldcount is null");for(var o=[],n=[],a=0,i=0;i<t;i++){var c=j$("#number_aec_"+i).val(),l=j$("#btn_type_aec_"+i).html(),r=stringres.get("mobile");common.isNull(c)||common.Trim(c).length<1||(l===stringres.get("phone")&&(r="phone"),l===stringres.get("home")&&(r="home"),l===stringres.get("mobile")&&(r="mobile"),l===stringres.get("work")&&(r="work"),l===stringres.get("other")&&(r="other"),l===stringres.get("fax_home")&&(r="fax_home"),l===stringres.get("fax_work")&&(r="fax_work"),l===stringres.get("pager")&&(r="pager"),l===stringres.get("sip")&&(r="sip"),o[a]=c,n[a]=r,a++)}if(common.isNull(o)||o.length<1){if(e.length<1)return void common.ShowToast(stringres.get("contact_no_nunber"));if(e.indexOf(" ")<0){var d="phone";common.IsNumber(e)||(d="sip"),o.push(e),n.push(d)}}e.length<1&&(e=o[0]);var m=common.GetTickCount().toString(),s="",_="",u="",g="";j$("#number_aec_email").is(":visible")&&(s=j$("#number_aec_email").val(),s=common.isNull(s)?"":common.Trim(s)),j$("#number_aec_address").is(":visible")&&(_=j$("#number_aec_address").val(),_=common.isNull(_)?"":common.Trim(_),_=common.ReplaceAll(_,"\r\n"," "),_=common.ReplaceAll(_,"\n"," "),_=common.ReplaceAll(_,","," ")),j$("#number_aec_notes").is(":visible")&&(u=j$("#number_aec_notes").val(),u=common.isNull(u)?"":common.Trim(u),u=common.ReplaceAll(u,"\r\n"," "),u=common.ReplaceAll(u,"\n"," "),u=common.ReplaceAll(u,","," ")),j$("#number_aec_website").is(":visible")&&(g=j$("#number_aec_website").val(),g=common.isNull(g)?"":common.Trim(g));var p=[];return p[common.CT_NAME]=e,p[common.CT_NUMBER]=o,p[common.CT_PTYPE]=n,p[common.CT_USAGE]="0",p[common.CT_LASTMODIF]=m,p[common.CT_DELFLAG]="0",p[common.CT_FAV]="0",p[common.CT_EMAIL]=s,p[common.CT_ADDRESS]=_,p[common.CT_NOTES]=u,p[common.CT_WEBSITE]=g,p[common.CT_LASTACTIVE]=common.GetTickCount().toString(),p[common.CT_ISFROMSYNC]="0",global.ctlist.push(p),global.wasCtModified=!0,common.SortContacts(),setTimeout(function(){common.ShowToast(stringres.get("contact_saved"))},300),void j$.mobile.back()}catch(b){common.PutToDebugLogException(2,"_addeditcontact: SaveNewContact",b)}try{common.ShowToast(stringres.get("contact_save_error")),j$.mobile.back()}catch(h){}}function s(e){try{return common.IsWindowsSoftphone()&&j$("#btn_addeditcontact_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _addeditcontact: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _addeditcontact: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+E+'"><a data-rel="back">'+stringres.get("btn_save")+"</a></li>").listview("refresh"),j$(e).append('<li id="'+k+'"><a data-rel="back">'+stringres.get("btn_revert")+"</a></li>").listview("refresh"),!0)}catch(t){common.PutToDebugLogException(2,"_addeditcontact: CreateOptionsMenu",t)}return!1}function _(e){try{if(common.isNull(e)||e.length<1)return;j$("#addeditcontact_menu").on("popupafterclose",function(t){switch(j$("#addeditcontact_menu").off("popupafterclose"),e){case E:r();break;case k:j$.mobile.back()}})}catch(t){common.PutToDebugLogException(2,"_addeditcontact: MenuItemSelected",t)}}function u(e){try{common.PutToDebugLog(4,"EVENT, _addeditcontact: onStop"),global.isAddeditcontactStarted=!1;var t=j$("#aec_number_fields").children().length;if(common.isNull(t)||t<1)return;for(var o=0;o<t;o++){var n=document.getElementById("aec_entry_"+o);common.isNull(n)||(n.style.display="none")}j$("#aec_entry_email").hide(),j$("#aec_entry_address").hide(),j$("#aec_entry_notes").hide(),j$("#aec_entry_website").hide(),j$("#aec_entry_email").val(""),j$("#aec_entry_address").val(""),j$("#aec_entry_notes").val(""),j$("#aec_entry_website").val(""),j$("#aec_add_deatils").show(),common.isNull(j)||(j.value="")}catch(a){common.PutToDebugLogException(2,"_addeditcontact: onStop",a)}}function g(e){}var p="",b="",h="",f=-1,v="",j=null,$=null,T=null,y=null,E="#menuitem_addeditcontact_save",k="#menuitem_addeditcontact_revert";return{onCreate:e,onStart:t,onStop:u,onDestroy:g}}();