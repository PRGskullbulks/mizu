wpa._call=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _call: onCreate"),j$("#call_menu_ul").on("click","li",function(e){D(j$(this).attr("id"))}),j$("#btn_call_menu").on("click",function(){C("#call_menu_ul")}),j$("#btn_call_menu").attr("title",stringres.get("hint_menu")),j$("#btn_hangup").on("click",function(){common.PutToDebugLog(4,"EVENT, _call Hangup onclick"),m()}),j$("#btn_accept").on("click",function(){common.PutToDebugLog(4,"EVENT, _call AcceptCall onclick"),u(!0)}),j$("#btn_reject").on("click",function(){common.PutToDebugLog(4,"EVENT, _call RejectCall onclick"),s(!0)}),j$("#btn_ml_accept").on("click",function(){common.PutToDebugLog(4,"EVENT, _call multiline Accept onclick"),u(!0)}),j$("#btn_ml_reject").on("click",function(){common.PutToDebugLog(4,"EVENT, _call RejectCallMultiline onclick"),l(!0)}),j$("#btn_ml_more").on("click",function(){common.PutToDebugLog(4,"EVENT, _call multiline more onclick"),j$("#btn_call_menu").click()}),j$("#btn_hangup").attr("title",stringres.get("hint_hangup")),j$("#btn_accept").attr("title",stringres.get("hint_accept")),j$("#btn_reject").attr("title",stringres.get("hint_reject")),j$("#calledcaller").attr("title",stringres.get("hint_called")),j$("#status_call").attr("title",stringres.get("hint_callstatus")),j$("#call_duration").attr("title",stringres.get("hint_callduration")),j$("#btn_ml_accept").attr("title",stringres.get("hint_accept")),j$("#btn_reject_ml").attr("title",stringres.get("hint_reject_new")),j$("#btn_ml_more").attr("title",stringres.get("hint_more")),j$("#btn_audiodevice").on("click",function(){common.PutToDebugLog(4,"EVENT, _call webphone_audiodevice onclick"),webphone_api.devicepopup()});var t;j$(window).resize(function(){"page_call"===j$.mobile.activePage.attr("id")&&(common.isNull(t)||clearTimeout(t),t=setTimeout(function(){h(!1),r()},100))}),j$("#numpad_btn_dp_1").on("click",function(){g("1")}),j$("#numpad_btn_dp_2").on("click",function(){g("2")}),j$("#numpad_btn_dp_3").on("click",function(){g("3")}),j$("#numpad_btn_dp_4").on("click",function(){g("4")}),j$("#numpad_btn_dp_5").on("click",function(){g("5")}),j$("#numpad_btn_dp_6").on("click",function(){g("6")}),j$("#numpad_btn_dp_7").on("click",function(){g("7")}),j$("#numpad_btn_dp_8").on("click",function(){g("8")}),j$("#numpad_btn_dp_9").on("click",function(){g("9")}),j$("#numpad_btn_dp_0").on("click",function(){g("0")}),j$("#numpad_btn_dp_ast").on("click",function(){g("*")}),j$("#numpad_btn_dp_diez").on("click",function(){g("#")}),j$("#page_call").keypress(function(e){o(e)}),j$("#page_call").keydown(function(e){try{var o=e.keyCode?e.keyCode:e.which;if(o==Y)return K=!0,!0;if(o==Z)return J=!0,!0;if(o==ee)return Q=!0,!0;if(e.ctrlKey||e.metaKey||e.altKey)return X=!0,!0;if(13===e.which){var t=j$.mobile.activePage.find(".messagePopup");!common.isNull(t)&&t.length>0?(j$("#adialog_positive").click(),e.preventDefault()):j$("#acceptreject_layout").is(":visible")?(j$("#btn_accept").click(),e.preventDefault()):j$("#mline_layout").is(":visible")&&(j$("#btn_ml_accept").click(),e.preventDefault())}else{if(27!==e.which)return;var t=j$.mobile.activePage.find(".messagePopup");!common.isNull(t)&&t.length>0?(j$("#adialog_negative").click(),e.preventDefault()):j$("#acceptreject_layout").is(":visible")?(j$("#btn_reject").click(),e.preventDefault()):j$("#mline_layout").is(":visible")?(j$("#btn_ml_reject").click(),e.preventDefault()):j$("#hangup_layout").is(":visible")&&(j$("#btn_hangup").click(),e.preventDefault())}}catch(n){common.PutToDebugLogException(2,"_call: keydown",n)}})}catch(n){common.PutToDebugLogException(2,"_call: onCreate",n)}}function o(e){try{if(j$(".ui-page-active .ui-popup-active").length>0)return!1;var o=e.keyCode?e.keyCode:e.which;return!(K||J||Q||X||8===o)&&((o>=48&&o<=57||42===o||35===o)&&g(String.fromCharCode(o)),!1)}catch(t){common.PutToDebugLogException(2,"_call: HandleKeyPress",t)}}function t(e){try{common.PutToDebugLog(4,"EVENT, _call: onStart"),global.isCallStarted=!0,global.hangupPressedCount=0,r(),common.isNull(document.getElementById("app_name_call"))||common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||(document.getElementById("app_name_call").innerHTML=common.GetBrandName()),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#call_header"),-30)),j$("#btn_hangup_img").attr("src",common.GetElementSource()+"images/btn_hangup_txt.png"),common.isNull(document.getElementById("btn_audiodevice"))||(document.getElementById("btn_audiodevice").innerHTML=stringres.get("btn_audio_device")),!0===common.GetParameterBool("displayvolumecontrols",!1)&&j$("#volumecontrols").show(),!0===common.GetParameterBool("displayaudiodevice",!1)&&j$("#audiodevice_container").show();var o=common.GetParameter("volumein");(common.isNull(o)||o.length<1||!common.IsNumber(o))&&(o="50"),j$("#volumein").val(o),j$("#volumein").slider("refresh");var t=common.GetParameter("volumeout");(common.isNull(t)||t.length<1||!common.IsNumber(t))&&(t="50"),j$("#volumeout").val(t),j$("#volumeout").slider("refresh"),j$("#volumein").on("slidestop",function(e,o){var t=this.value;common.isNull(t)||t.length<1||(t=common.Trim(t),common.SaveParameter("volumein",t),common.PutToDebugLog(5,"EVENT, volumein slidestop: "+this.value),webphone_api.setvolume(0,t))}),j$("#volumeout").on("slidestop",function(e,o){var t=this.value;common.isNull(t)||t.length<1||(t=common.Trim(t),common.SaveParameter("volumeout",t),common.PutToDebugLog(5,"EVENT, volumeout slidestop: "+this.value),webphone_api.setvolume(1,t))}),W=common.GetIntentParam(global.intentcall,"calltype");var a=common.GetIntentParam(global.intentcall,"callmode");!common.isNull(a)&&common.IsNumber(a)&&(q=common.StrToInt(a)),global.callName="",B=common.GetIntentParam(global.intentcall,"number"),global.callName=common.GetIntentParam(global.intentcall,"name"),(common.isNull(global.callName)||global.callName.length<1)&&(global.callName=common.GetContactNameFromNumber(B));var l=common.GetParameter2("telsearchurl");(common.isNull(l)||l.length<3)&&(l=webphone_api.parameters.telsearchurl),!common.isNull(l)&&l.length>3&&(global.callName.length<1||global.callName===B)&&webphone_api.gettelsearchname(B,function(e){common.isNull(e)||e.length<2||e.length>60||(global.telsearchname=e,global.callName=e,c=global.callName+"&nbsp;("+B+")&nbsp;",j$("#calledcaller").html(c),j$("#page_call_peer_details").html(c))});var c="";global.callName!==B?(c=global.callName+"&nbsp;("+B+")&nbsp;",j$("#calledcaller").html(c)):(c=B,j$("#calledcaller").html(c)),n(c),"incoming"===W&&webphone_api.GetIncomingDisplay(function(e){!common.isNull(e)&&e.length>0&&c.indexOf(e)<0&&(e=e.replace("\n",""),c=e+" "+c),n(c)}),"outgoing"===W&&(h(!1),j$("#acceptreject_layout").hide(),j$("#hangup_layout").show(),j$("#callfunctions_layout").show(),setTimeout(function(){var e=common.GetParameter("ratingrequest");!0===common.Glbr()&&!common.isNull(e)&&e.length>2&&!common.isNull(B)&&B.length>0&&(common.isNull(global.rating)||global.rating.length<1)&&webphone_api.needratingrequest(function(o){!0===o&&common.UriParser(e,"",B,"","","getrating")})},4e3)),"incoming"===W&&(!0===common.GetParameterBool("autoaccept",!1)?(j$("#hangup_layout").show(),j$("#callfunctions_layout").show(),j$("#acceptreject_layout").hide()):(h(!0),U=!0,z=!0,j$("#hangup_layout").hide(),j$("#callfunctions_layout").hide(),j$("#acceptreject_layout").show())),q>0&&!0===common.CanIUseVideo()&&(j$("#contact_details").hide(),j$("#video_container").show(),r(),setTimeout(function(){r()},200),1===common.GetParameterInt("softphonevideomode",0)&&j$("#div_video_fullscreen_button").hide(),common.PutToDebugLog(2,"EVENT, call onstart video container displayed")),!0===global.isdebugversion&&j$("#mline_layout").show(),r(),setTimeout(function(){r()},200)}catch(i){common.PutToDebugLogException(2,"_call: onStart",i)}}function n(e){try{if(common.isNull(e)||e.length<1)return void j$("#page_call_peer_details").html("");if(e.indexOf(" ")<0)return void j$("#page_call_peer_details").html(e);e=common.ReplaceAll(e,"-"," ");for(var o="",t=e.split(" "),n=0;n<t.length;)common.isNull(t[n])||common.Trim(t[n]).lengh<1?t.splice(n,1):n++;t=common.UniqueArray(t);for(var a=Math.ceil(t.length/2),l=0;l<t.length;l++)common.isNull(t[l])||common.Trim(t[l]).lengh<1||o.indexOf(t[l])<0&&(o.length>0&&(o+=l===a?"<br>":" "),o+=t[l]);j$("#page_call_peer_details").html(o)}catch(c){common.PutToDebugLogException(2,"_call: NormalizeDisplayDetails",c)}}function a(){try{var e=common.GetEndpoint(global.aline,"","",!1);if(common.isNull(e)||e.length<5)return void common.PutToDebugLog(2,"ERROR, _call OnNewIncomingCall: ep is NULL for line: "+global.aline.toString());e[common.EP_DESTNR];j$("#mline_layout").show(),j$("#hangup_layout").is(":visible")&&j$("#hangup_layout").hide(),j$("#acceptreject_layout").is(":visible")&&j$("#acceptreject_layout").hide(),common.RefreshInfo(),setTimeout(function(){r()},200)}catch(o){common.PutToDebugLogException(2,"_call: OnNewIncomingCall",o)}}function l(e){try{if(U=!1,z=!1,j$("#mline_layout").hide(),j$("#callfunctions_layout").show(),j$("#hangup_layout").show(),setTimeout(function(){r()},200),global.acceptReject=!0,e){var o=global.aline;plhandler_public.Reject(o);for(var t=0;t<global.ep.length;t++)if(!(common.isNull(global.ep[t])||global.ep[t].length<5)){var n=global.ep[t][common.EP_LINE];if(n==global.aline){global.ep[t][common.EP_FLAGDEL]="true";break}}for(var t=global.ep.length-1;t>=0;t--)if(!(common.isNull(global.ep[t])||global.ep[t].length<5)&&"false"==global.ep[t][common.EP_FLAGDEL]){common.PutToDebugLog(2,"EVENT, SetLine called from RejectCallMultiline"),webphone_api.setline(common.StrToInt(global.ep[t][common.EP_LINE]));break}setTimeout(function(){common.RefreshInfo()},400)}q=0}catch(a){common.PutToDebugLogException(2,"_call: RejectCallMultiline",a)}}function c(e){try{if(global.acceptReject=!0,h(!1),U=!1,z=!1,j$("#mline_layout").hide(),j$("#hangup_layout").show(),j$("#callfunctions_layout").show(),setTimeout(function(){r()},200),e){var o=-10;if(!common.isNull(global.ep))for(var t=0;t<global.ep.length;t++){var n=global.ep[t];common.isNull(n)||n.length<1||"true"!==n[common.EP_FLAGDEL]&&(common.isNull(n[common.EP_LINE])||!0!==common.IsNumber(n[common.EP_LINE])||0<common.StrToInt(n[common.EP_SETUPTIME])&&(o=common.StrToInt(n[common.EP_LINE])))}common.PutToDebugLog(2,"EVENT, mlogic API_Accept AcceptHold"),webphone_api.accept(global.aline),o>0&&(common.PutToDebugLog(2,"EVENT, API_Hold mainlogic hold call from cl AcceptHold;  on line: "+o),plhandler_public.Hold(!0,o),setTimeout(function(){h(!1)},250),common.PutToDebugLog(2,"EVENT, AcceptHold hold finished"))}}catch(a){common.PutToDebugLogException(2,"_call: AcceptHold",a)}}function i(e){try{if(global.acceptReject=!0,h(!1),U=!1,z=!1,j$("#mline_layout").hide(),j$("#hangup_layout").show(),j$("#callfunctions_layout").show(),setTimeout(function(){r()},200),e){var o=-10;if(!common.isNull(global.ep))for(var t=0;t<global.ep.length;t++){var n=global.ep[t];common.isNull(n)||n.length<1||"true"!==n[common.EP_FLAGDEL]&&(common.isNull(n[common.EP_LINE])||!0!==common.IsNumber(n[common.EP_LINE])||0<common.StrToInt(n[common.EP_SETUPTIME])&&(o=common.StrToInt(n[common.EP_LINE])))}common.PutToDebugLog(2,"EVENT, AcceptEnd called"),plhandler_public.Accept(global.aline),o>0&&(common.PutToDebugLog(2,"EVENT, hangup AcceptEnd"),plhandler_public.Hangup(o))}}catch(a){common.PutToDebugLogException(2,"_call: AcceptEnd",a)}}function r(){try{j$("#page_call").css("min-height","auto");var e=!1,o=!1;j$("#volumecontrols").is(":visible")&&(e=!0),j$("#audiodevice_container").is(":visible")&&(o=!0),j$("#page_call_content").height(common.GetDeviceHeight()-j$("#call_header").height()-j$(".separator_line_thick").height());var t=common.GetDeviceHeight()-j$("#call_header").height();j$("#page_call_content").height(t-3);var n=t-3,a=t-j$("#hangup_layout").height()-j$("#callfunctions_layout").height()-j$(".separator_color_bg").height()-12;j$("#mlcontainer").is(":visible")&&(a=a-j$("#mlcontainer").height()-2);var l=Math.floor(a/5);if(j$("#numpad_btn_grid .ui-btn").height(l),l-=6,j$("#numpad_number_container").height(l),j$("#numpad_number_container").css("line-height",l+"px"),"outgoing"===W){t=t-j$("#hangup_layout").height()-j$("#callfunctions_layout").height()-j$(".separator_color_bg").height()-1,e&&(t-=j$("#volumecontrols").height()),o&&(t-=j$("#audiodevice_container").height()),t=t-j$("#mlcontainer").height()-j$(".separator_line_thick").height(),t=Math.floor(t),j$("#contact_image").height(t);var c=(t-j$("#contact_image_img").height()-j$("#page_call_additional_info").height())/2;j$("#contact_image_img").css("margin-top",c+"px")}if("incoming"===W){"block"===document.getElementById("acceptreject_layout").style.display?(t=t-j$("#acceptreject_layout").height()-3,e&&(t-=j$("#volumecontrols").height()),o&&(t-=j$("#audiodevice_container").height()),t=t-j$("#mlcontainer").height()-j$(".separator_line_thick").height(),t=Math.floor(t)):(t=t-j$("#hangup_layout").height()-j$("#callfunctions_layout").height()-j$(".separator_color_bg").height()-1,e&&(t-=j$("#volumecontrols").height()),o&&(t-=j$("#audiodevice_container").height()),t=t-j$("#mlcontainer").height()-j$(".separator_line_thick").height(),t=Math.floor(t)),j$("#contact_image").height(t);var c=(t-j$("#contact_image_img").height()-j$("#page_call_additional_info").height())/2;j$("#contact_image_img").css("margin-top",c+"px")}var i=Math.floor(common.GetDeviceWidth()/4.6);if(j$("#app_name_call").width(i),j$("#video_container").is(":visible")){var r=j$("#video_remote").height();!common.isNull(r)&&common.IsNumber(r)&&(r-=55,n=n-j$("#hangup_layout").height()-j$("#callfunctions_layout").height()-j$(".separator_color_bg").height()-1,r>n&&(j$("#video_container").height(n),j$("#video_remote").height(n-55)))}}catch(m){common.PutToDebugLogException(2,"_call: MeasureCall",m)}}function m(){try{global.dontshowdiscreason=!0,common.GetNrOfActiveCalls()<2&&global.hangupPressedCount++,common.PutToDebugLog(4,"EVENT, _call HangupCall"),global.hangupPressedCount<2?(common.GetNrOfActiveCalls()<2&&(common.isNull(global.waiting_conf_numbers)||global.waiting_conf_numbers.length<1)&&!1===global.dontshow_closecall&&(j$("#callfunctions_layout").hide(),j$("#btn_hangup_img").attr("src",common.GetElementSource()+"images/btn_close_txt.png"),j$("#btn_hangup").attr("title",stringres.get("hint_closecall"))),webphone_api.hangup(),setTimeout(function(){common.RefreshInfo()},400)):global.hangupPressedCount>1&&(webphone_api.hangup(),j$.mobile.back(),global.hangupPressedCount=0),q=0}catch(e){common.PutToDebugLogException(2,"_call: HangupCall",e)}}function u(e){try{global.acceptReject=!0,h(!1),U=!1,z=!1,j$("#mline_layout").hide(),j$("#acceptreject_layout").hide(),j$("#hangup_layout").show(),j$("#callfunctions_layout").show(),setTimeout(function(){r()},200),e&&webphone_api.accept(-2)}catch(o){common.PutToDebugLogException(2,"_call: AcceptCall",o)}}function s(e){try{U=!1,z=!1,j$("#mline_layout").hide(),j$("#acceptreject_layout").hide(),common.GetNrOfActiveCalls()<2&&j$("#callfunctions_layout").hide(),j$("#hangup_layout").show(),setTimeout(function(){r()},200),global.acceptReject=!0,global.hangupPressedCount=1,e&&webphone_api.reject(-2),q=0}catch(o){common.PutToDebugLogException(2,"_call: RejectCall",o)}}function g(e){try{common.PutToDebugLog(5,"EVENT, _call SendDtmf: "+e),webphone_api.dtmf(e,-1);var o=j$("#numpad_number").html();common.isNull(o)&&(o=""),o.length>18&&(o=o.substring(10,o.length)+" "),j$("#numpad_number").html(o+e)}catch(t){common.PutToDebugLogException(2,"_call: SendDtmf",t)}}function p(){try{common.PutToDebugLog(3,"EVENT, _call CloseCall"),j$.mobile.back()}catch(e){common.PutToDebugLogException(2,"_call: CloseCall",e)}}function d(){try{global.hangupPressedCount=1}catch(e){common.PutToDebugLogException(2,"_call: OnCallerHangup",e)}}function _(){try{if(!0===common.IsSDK())return;var e=document.getElementById("mlcontainer");if(common.isNull(e))return;var o=document.getElementById("ml_buttons");if(common.isNull(o))return;if(common.isNull(global.ep)||global.ep.length<1)return;for(var t='<button class="ui-btn line_btn noshadow" data-theme="b" id="btn_line_[LINENR]"><span class="line_text">'+stringres.get("line_title")+' [LINENR]</span><span class="line_status [ISACTIVE]" id="line_[LINENR]_status" >&nbsp;</span></button>',n=[],a="",l=0;l<global.ep.length;l++){var c=global.ep[l];if(!(common.isNull(c)||c.length<1)){var i=c[common.EP_LINE];if(!(common.isNull(i)||i.length<1||!1===common.IsNumber(i))){var m=common.StrToInt(i),u="";global.aline==m&&(u="line_status_on");var s=common.ReplaceAll(t,"[LINENR]",m.toString());s=s.replace("[ISACTIVE]",u),a+=s,n.push(m.toString())}}}if(a===oe)return;oe=a,o.innerHTML=a;for(var l=0;l<n.length;l++)j$("#btn_line_"+n[l]).off("click"),j$("#btn_line_"+n[l]).on("click",function(e){b(j$(this).attr("id"))});n.length>1?"none"===e.style.display&&(e.style.display="block"):(o.innerHTML="",e.style.display="none"),common.RefreshInfo(),r()}catch(g){common.PutToDebugLogException(2,"_call: UpdateLineButtons",g)}}function b(e){try{if(!0===common.IsSDK())return;if(common.isNull(e)||0!==e.indexOf("btn_line_"))return void common.PutToDebugLog(2,"ERROR, _call: LineCliked invalid id: "+e);e=e.replace("btn_line_","");var o=common.StrToInt(e);common.PutToDebugLog(1,"EVENT, Line "+o.toString()+" selected by user"),webphone_api.setline(o);var t=common.GetParameterInt("defmute",0);3!==t&&4!==t||(t=0);for(var n=0;n<global.ep.length;n++){var a=global.ep[n];if(!(common.isNull(a)||a.length<1)){var l=a[common.EP_LINE];if(!(common.isNull(l)||l.length<1||!1===common.IsNumber(l))){var c=common.StrToInt(l);global.aline==c?("4"==common.GetParameter("automute")&&"true"==a[common.EP_MUTESTATE]&&(common.PutToDebugLog(2,"EVENT, EVENT, USER, automute, API_MuteEx, false on line: "+c+"; dest: "+a[common.EP_DESTNR]),common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleMute(!1,t,c):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_MuteEx",null,c,!1,t):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.MuteEx(c,!1,t),global.ep[n][common.EP_MUTESTATE]="false"),"4"==common.GetParameter("autohold")&&"true"==a[common.EP_HOLDSTATE]&&(common.PutToDebugLog(2,"EVENT, EVENT, USER, autohold, API_Hold mainlogic, false on line: "+c+"; dest: "+a[common.EP_DESTNR]),common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleHoldResume(!1,c):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_Hold",null,c,!1):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.Hold(c,!1),global.ep[n][common.EP_HOLDSTATE]="false")):("4"==common.GetParameter("automute")&&"false"==a[common.EP_MUTESTATE]&&(common.PutToDebugLog(2,"EVENT, EVENT, USER, automute, API_MuteEx, true on line: "+c+"; dest: "+a[common.EP_DESTNR]),common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleMute(!0,t,c):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_MuteEx",null,c,!0,t):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.MuteEx(c,!0,t),global.ep[n][common.EP_MUTESTATE]="true"),"4"==common.GetParameter("autohold")&&"false"==a[common.EP_HOLDSTATE]&&(common.PutToDebugLog(2,"EVENT, EVENT, USER, autohold, API_Hold mainlogic, true on line: "+c+"; dest: "+a[common.EP_DESTNR]),common.getuseengine()===global.ENGINE_WEBRTC?wpa.webrtcapi.SipToggleHoldResume(!0,c):common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()||common.getuseengine()===global.ENGINE_SERVICE?common.WinAPI("API_Hold",null,c,!0):common.getuseengine()===global.ENGINE_WEBPHONE&&wpa.webphone.Hold(c,!0),global.ep[n][common.EP_HOLDSTATE]="true"))}}}_(),h(!1),r()}catch(i){common.PutToDebugLogException(2,"_call: LineCliked",i)}}function f(e){try{common.PutToDebugLog(2,"EVENT, NewMultilineCall"),global.isdebugversion&&common.GetContacts(function(){});var o=common.GetDeviceWidth();o=!common.isNull(o)&&common.IsNumber(o)&&o>100?Math.floor(o/1.2):220;var t='<div id="mlcall_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("menu_multilinecall")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="mlcall_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+common.GetElementSource()+'images/btn_add_contact_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(t).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click"),j$("#btn_pickct").off("click")}});var n=document.getElementById("mlcall_input");!common.isNull(e)&&e.length>0&&(n.value=e),common.isNull(n)||n.focus(),j$("#adialog_positive").on("click",function(e){common.PutToDebugLog(5,"EVENT, call NewMultilineCall ok onclick");var o=common.Trim(n.value);!common.isNull(o)&&o.length>0?(webphone_api.call(o),common.RefreshInfo()):(common.ShowToast(stringres.get("err_msg_4")),j$.mobile.back())}),j$("#adialog_negative").on("click",function(e){}),j$("#btn_pickct").on("click",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#mlcall_popup").on("popupafterclose",function(e){j$("#mlcall_popup").off("popupafterclose"),common.PickContact(f)})})}catch(a){common.PutToDebugLogException(2,"_call: NewMultilineCall",a)}}function h(e){try{if(!0===common.IsSDK())return;if(common.GetParameterInt("featureset",3)<0)return j$("#callfunctions_layout").hide(),void r();F=e;j$("#callfunctions_layout").html("");var o=common.GetAvailableCallfunctions();if(common.isNull(o)||o.length<3)return void common.PutToDebugLog(2,"ERROR, _call: AddCallFunctions no available callfunctions (1)");var t=document.getElementById("callfunctions_layout");if(common.isNull(t))return void common.PutToDebugLog(2,"ERROR, _call: AddCallFunctions no available callfunctions (2)");var n=common.GetParameter("callfunctionsbtnusage");(common.isNull(n)||n.length<=0)&&(n="10,0,5,9,8,10,12,1,3,-2",common.SaveParameter("callfunctionsbtnusage",n));var a=n.lastIndexOf(","),l=common.StrToInt(n.substring(a+1)),c=n.substring(0,a);common.IsNumber(l)&&common.CanIUseVideo()&&l<1&&(l=3,n=c+","+l.toString(),common.SaveParameter("callfunctionsbtnusage",n));var i="",m=n.split(","),u=["callforward","conference","transfer","mute","hold","speaker","numpad","bluetooth","chat","video"];!0!==e&&(m.splice(0,1),u.splice(0,1));for(var s=0;s<m.length;s++)for(var g=s+1;g<m.length;g++){var p=0,d=0;try{p=common.StrToInt(m[s].trim()),d=common.StrToInt(m[g].trim())}catch(C){common.PutToDebugLogException(2,"_call AddCallFunctions parseint",C)}p<d&&(i=m[s],m[s]=m[g],m[g]=i,i=u[s],u[s]=u[g],u[g]=i)}if(!0===global.isdebugversion)for(var s=0;s<m.length;s++)common.PutToDebugLog(5,"cfusage "+u[s]+": "+m[s]);var _=o.split(","),b="";if(common.isNull(_)||_.length<1)return void common.PutToDebugLog(2,"ERROR, _call: AddCallFunctions no available callfunctions (3)");var f=!1;0===global.nrOfCallfunctionsToDisplay&&(global.nrOfCallfunctionsToDisplay=5),global.nrOfCallfunctionsToDisplay>_.length&&(global.nrOfCallfunctionsToDisplay=_.length),_.length>5&&(f=!0);for(var h=0,v='<div class="callfunc_btn_container"><button class="ui-btn callfunc_btn noshadow" data-theme="b" id="btn_[REPLACESTR]"><img src="'+common.GetElementSource()+'images/btn_[REPLACESTR]_txt.png" /><span class="callfunc_status" id="[REPLACESTR]_status" >&nbsp;</span></button></div>',j=common.GetColortheme(),s=0;s<u.length;s++){var $=u[s];if(!(common.isNull($)||common.Trim($).length<1)&&!(o.toLowerCase().indexOf($)<0||common.getuseengine()===global.ENGINE_WEBRTC&&"conference"===$)){var P=v;if(22!==j&&23!==j||(P=common.ReplaceAll(P,"btn_[REPLACESTR]_txt.png","btn_"+$+"_txt_grey.png"),P=common.ReplaceAll(P,"<button",'<button style="border-color: #FFFFFF"')),P=common.ReplaceAll(P,"[REPLACESTR]",$),b+=P,s<global.nrOfCallfunctionsToDisplay-1&&(b+='<div class="callfunc_spacer">&nbsp;</div>'),h++,f&&h>3){var P=v;22===j||23===j?(P=P.replace("btn_[REPLACESTR]_txt.png","menu_grey.png"),P=common.ReplaceAll(P,"<button",'<button style="border-color: #FFFFFF"')):P=P.replace("btn_[REPLACESTR]_txt.png","menu.png"),P=common.ReplaceAll(P,"[REPLACESTR]","more"),b+=P,h++;break}}}j$("#callfunctions_layout").html(b),j$("#btn_callforward").off("click"),j$("#btn_callforward").on("click",function(e){E("callforward")}),j$("#btn_conference").off("click"),j$("#btn_conference").on("click",function(e){E("conference")}),j$("#btn_transfer").off("click"),j$("#btn_transfer").on("click",function(e){E("transfer")}),j$("#btn_numpad").off("click"),j$("#btn_numpad").on("click",function(e){E("numpad")}),j$("#btn_mute").off("click"),j$("#btn_mute").on("click",function(e){E("mute")}),j$("#btn_hold").off("click"),j$("#btn_hold").on("click",function(e){E("hold")}),j$("#btn_speaker").off("click"),j$("#btn_speaker").on("click",function(e){E("speaker")}),j$("#btn_chat").off("click"),j$("#btn_chat").on("click",function(e){E("chat")}),j$("#btn_video").off("click"),j$("#btn_video").on("click",function(e){E("video")}),j$("#btn_more").off("click"),j$("#btn_more").on("click",function(e){E("more")}),j$("#btn_callforward").attr("title",stringres.get("hint_callforward")),j$("#btn_conference").attr("title",stringres.get("hint_conference")),j$("#btn_transfer").attr("title",stringres.get("hint_transfer")),j$("#btn_numpad").attr("title",stringres.get("hint_dialpad_dtmf")),j$("#btn_mute").attr("title",stringres.get("hint_mute")),j$("#btn_hold").attr("title",stringres.get("hint_hold")),j$("#btn_speaker").attr("title",stringres.get("hint_speaker")),j$("#btn_chat").attr("title",stringres.get("hint_message")),j$("#btn_video").attr("title",stringres.get("menu_videorecall")),j$("#btn_more").attr("title",stringres.get("hint_more"));var N=webphone_api.getline(),T=common.GetMuteState(N),k=common.GetHoldState(N),w=document.getElementById("mute_status");common.isNull(w)||(!0===T?!1===j$(w).hasClass("callfunc_status_on")&&j$(w).addClass("callfunc_status_on"):j$(w).hasClass("callfunc_status_on")&&j$(w).removeClass("callfunc_status_on"));var y=document.getElementById("hold_status");common.isNull(y)||(!0===k?!1===j$(y).hasClass("callfunc_status_on")&&j$(y).addClass("callfunc_status_on"):j$(y).hasClass("callfunc_status_on")&&j$(y).removeClass("callfunc_status_on")),0===h&&(h=global.nrOfCallfunctionsToDisplay);var I=common.GetDeviceWidth()-(h-1)*j$(".callfunc_spacer").width();I=Math.round(100*I/common.GetDeviceWidth()*100)/100,I=Math.floor(I/h*100)/100,I-=.1,j$(".callfunc_btn_container").width(I+"%")}catch(D){common.PutToDebugLogException(2,"_call: AddCallFunctions",D)}}function v(e){var o=0,t=!1;try{var n=common.GetParameter("callfunctionsbtnusage");if(o=1,common.isNull(n)||n.length<1)return;o=2;var a=n.split(",");o=3;var l=[];o=4;for(var c=0;c<a.length;c++)l[c]=common.StrToInt(a[c]),(l[c]>20||l[c]<-20)&&(t=!0);switch(o=5,e){case te:return void l[te]++;case ne:return void l[ne]++;case ae:return void l[ae]++;case le:return void l[le]++;case ce:return void l[ce]++;case ie:return void l[ie]++;case re:return void l[re]++;case me:return void l[me]++;case ue:return void l[ue]++}if(t)for(var c=0;c<l.length;c++)l[c]=Math.floor(l[c]/2);o=6,n=l[se]+","+l[te]+","+l[ne]+","+l[ae]+","+l[le]+","+l[ce]+","+l[ie]+","+l[re]+","+l[me]+","+l[ue],o=7,common.SaveParameter("callfunctionsbtnusage",n),o=8}catch(i){common.PutToDebugLogException(2,"_call: CFUsageClickCount ("+o.toString()+")",i)}}function E(e){try{if(common.isNull(e))return;if(common.PutToDebugLog(4,"EVENT, _call CallfunctionsOnclick func = "+e),"mute"===e){var o=k();if(!o)return}if("hold"===e){var o=w();if(!o)return}var t=document.getElementById(e+"_status");common.isNull(t)||"conference"===e||"transfer"===e||"chat"===e||"more"===e||"callforward"===e||(j$(t).hasClass("callfunc_status_on")?j$(t).removeClass("callfunc_status_on"):j$(t).addClass("callfunc_status_on")),"callforward"===e&&P(""),"conference"===e&&$(""),"transfer"===e&&N(""),"speaker"===e&&y(),"numpad"===e&&j(),"chat"===e&&I(),"video"===e&&x(),"more"===e&&j$("#btn_call_menu").click()}catch(n){common.PutToDebugLogException(2,"_call: CallfunctionsOnclick",n)}}function j(){try{"none"===j$("#numpad").css("display")?(ge=!!j$("#audiodevice_container").is(":visible"),pe=!!j$("#volumecontrols").is(":visible"),document.getElementById("numpad_number").innerHTML="&nbsp;",j$("#contact_image").hide(),j$("#audiodevice_container").hide(),j$("#volumecontrols").hide(),j$("#numpad").show(),r()):(j$("#numpad").hide(),j$("#contact_image").show(),ge&&j$("#audiodevice_container").show(),pe&&j$("#volumecontrols").show(),r())}catch(e){common.PutToDebugLogException(2,"_call: Numpad",e)}}function $(e){try{if(common.PutToDebugLog(1,"EVENT, "+stringres.get("initiate_conference")),common.getuseengine()===global.ENGINE_WEBRTC&&!1===common.GetConfigBool("usingmizuserver",!1)&&!1===common.IsMizuWebRTCEmbeddedServer()&&!1===common.IsMizuWebRTCGateway())if("true"!==common.GetParameter("conf_engineswitcheoffered")){var o=common.StrToInt(common.GetParameter2("enginepriority_webrtc")),t=common.StrToInt(common.GetParameter2("enginepriority_java")),n=common.StrToInt(common.GetParameter2("enginepriority_ns"));if(n>0&&o-n<3&&!0===common.CanIUseService())return void common.EngineSwitchConference("ns",e,$);if(t>0&&o-t<3&&!0===common.CanIUseApplet())return void common.EngineSwitchConference("java",e,$)}else common.PutToDebugLog(2,"ERROR, _call Conference engine switch already offered: "+common.getuseengine());if(global.isdebugversion&&common.GetContacts(function(){}),common.GetNrOfActiveCalls()>1)for(var a=0;a<global.ep.length;a++)if(!common.isNull(global.ep[a])&&"true"!==global.ep[common.EP_FLAGDEL]){var l=common.StrToInt(global.ep[a][common.EP_LINE]);if(l!==global.aline){var c=global.ep[a][common.EP_DESTNR];if(!common.isNull(c)&&c.length>0){if(!0===common.IsMizuServer()&&!0===V()){var i=common.GetEndpoint(global.aline,"","",!1);common.SendConferenceInvites(c,i[common.EP_DESTNR]),common.PutToDebugLog(2,"EVENT, _call: Conference, multiline conference: "+c+" AND "+i[common.EP_DESTNR])}else common.ShowToast(stringres.get("interconnect_conf")),webphone_api.conference(c,!0),common.SaveParameter("last_conference_number",c),common.PutToDebugLog(2,"EVENT, _call: Conference, multiline conference: "+c);return}}}var r=common.GetDeviceWidth();r=!common.isNull(r)&&common.IsNumber(r)&&r>100?Math.floor(r/1.2):220;var m="";common.GetNrOfActiveCalls()>1&&(common.getuseengine()===global.ENGINE_SERVICE||common.getuseengine()===global.ENGINE_WEBPHONE||!0===common.IsWindowsSoftphone())&&(m='<br /><button id="btn_interconnect_conf" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" style="font-size: .9em">'+stringres.get("interconnect")+"</button>")
;var u='<div id="conference_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+r+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("conference_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="conference_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+common.GetElementSource()+'images/btn_add_contact_txt.png"></button>'+m+'</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(u).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click"),j$("#btn_pickct").off("click"),j$("#btn_interconnect_conf").off("click")}});var s=document.getElementById("conference_input"),g=common.GetParameter("last_conference_number");!common.isNull(g)&&g.length>1&&(s.value=common.Trim(g)),!common.isNull(e)&&e.length>0&&(s.value=e),common.isNull(s)||s.focus(),j$("#adialog_positive").on("click",function(e){var o=common.Trim(s.value);if(common.PutToDebugLog(5,"EVENT, call Conference ok onclick ("+common.getuseengine()+"): "+o),!common.isNull(o)&&o.length>0){if(!1===common.IsWindowsSoftphone()&&common.getuseengine()===global.ENGINE_WEBRTC)return void(!0===global.isconfroom_call?common.SendConferenceInvites(o,B):(global.isconfroom_call=!0,webphone_api.conference(o,!0),common.SaveParameter("last_conference_number",o)));webphone_api.conference(o,!0),common.SaveParameter("last_conference_number",o)}else common.ShowToast(stringres.get("err_msg_4")),j$.mobile.back()}),j$("#adialog_negative").on("click",function(e){}),j$("#btn_pickct").on("click",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#conference_popup").on("popupafterclose",function(e){j$("#conference_popup").off("popupafterclose"),common.PickContact($)})}),j$("#btn_interconnect_conf").on("click",function(e){common.PutToDebugLog(2,"EVENT, conference interconnect on click"),j$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.conference("",!0)}),v(te)}catch(p){common.PutToDebugLogException(2,"_call: Conference",p)}}function P(e){try{common.PutToDebugLog(1,"EVENT, "+stringres.get("initiate_callforward"));var o=common.GetDeviceWidth();o=!common.isNull(o)&&common.IsNumber(o)&&o>100?Math.floor(o/1.2):220;var t='<div id="callforward_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("callforward_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="callforward_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+common.GetElementSource()+'images/btn_callforward_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(t).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_positive").off("click"),j$("#adialog_negative").off("click"),j$("#btn_pickct").off("click")}});var n=document.getElementById("callforward_input");!common.isNull(e)&&e.length>0&&(n.value=e),common.isNull(n)||n.focus(),j$("#adialog_positive").on("click",function(e){common.PutToDebugLog(5,"EVENT, call Callforward ok onclick");var o=common.Trim(n.value);!common.isNull(o)&&o.length>0?(webphone_api.forward(o),j$("#acceptreject_layout").hide(),j$("#hangup_layout").show()):common.ShowToast(stringres.get("err_msg_4"))}),j$("#adialog_negative").on("click",function(e){}),j$("#btn_pickct").on("click",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#callforward_popup").on("popupafterclose",function(e){j$("#callforward_popup").off("popupafterclose"),common.PickContact(P)})}),v(se)}catch(a){common.PutToDebugLogException(2,"_call: Callforward",a)}}function N(e){try{common.PutToDebugLog(1,"EVENT, "+stringres.get("initiate_call_transfer"));var o=common.GetDeviceWidth();o=!common.isNull(o)&&common.IsNumber(o)&&o>100?Math.floor(o/1.1):220;var t="";common.GetNrOfActiveCalls()>1&&(common.getuseengine()===global.ENGINE_SERVICE||common.getuseengine()===global.ENGINE_WEBPHONE||!0===common.IsWindowsSoftphone())&&(t='<br /><button id="btn_interconnect_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" style="font-size: .9em">'+stringres.get("interconnect")+"</button>");var n='<div id="transfer_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("transfer_title")+'</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>'+stringres.get("phone_nr")+'</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="transfer_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="'+common.GetElementSource()+'images/btn_add_contact_txt.png"></button>'+t+'</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_quick_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow" title="'+stringres.get("quicktransf_hint")+'">'+stringres.get("btn_quicktransf")+'</a><a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow" title="'+stringres.get("attendedtransf_hint")+'">'+stringres.get("btn_attendedtransf")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";j$.mobile.activePage.append(n).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_quick_transfer").off("click"),j$("#adialog_attended_transfer").off("click"),j$("#adialog_negative").off("click"),j$("#btn_pickct").off("click"),j$("#btn_interconnect_transfer").off("click")}});var a=document.getElementById("transfer_input"),l=common.GetParameter("last_transfer_number");!common.isNull(l)&&l.length>1&&(a.value=common.Trim(l)),!common.isNull(e)&&e.length>0&&(a.value=e),common.isNull(a)||a.focus(),j$("#adialog_quick_transfer").on("click",function(e){common.PutToDebugLog(5,"EVENT, call Transfer unattended(quick) ok onclick");var o=common.Trim(a.value);!common.isNull(o)&&o.length>0?(webphone_api.transfer(o,2),common.SaveParameter("last_transfer_number",o)):common.ShowToast(stringres.get("err_msg_4"))}),j$("#adialog_attended_transfer").on("click",function(e){j$("#transfer_popup").on("popupafterclose",function(e){common.PutToDebugLog(5,"EVENT, call Transfer attended ok onclick");var o=common.Trim(a.value);!common.isNull(o)&&o.length>0?(webphone_api.call(o),common.RefreshInfo(),common.SaveParameter("last_transfer_number",o),setTimeout(function(){T(o)},2e3)):common.ShowToast(stringres.get("err_msg_4"))})}),j$("#adialog_negative").on("click",function(e){}),j$("#btn_pickct").on("click",function(e){j$.mobile.activePage.find(".messagePopup").popup("close"),j$("#transfer_popup").on("popupafterclose",function(e){j$("#transfer_popup").off("popupafterclose"),common.PickContact(N)})}),j$("#btn_interconnect_transfer").on("click",function(e){common.PutToDebugLog(2,"EVENT, transfer interconnect on click"),j$.mobile.activePage.find(".messagePopup").popup("close"),webphone_api.transfer("")}),v(ne)}catch(c){common.PutToDebugLogException(2,"_call: Transfer",c)}}function T(e){try{var o=common.GetDeviceWidth();o=!common.isNull(o)&&common.IsNumber(o)&&o>100?Math.floor(o/1.2):220;var t='<div id="attended_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+o+"px; width: "+o+'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">'+stringres.get("attended_transfer_title")+'</h1></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_attended_transfer" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+stringres.get("btn_transfer")+'</a><a href="javascript:;" id="adialog_attended_revert" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back" data-transition="flow">'+stringres.get("btn_revert")+'</a><a href="javascript:;" id="adialog_attended_hangup" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_3button" data-rel="back">'+stringres.get("btn_hangup")+"</a></div></div>";j$.mobile.activePage.append(t).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(".ui-popup-screen").off(),j$(this).unbind("popupbeforeposition")}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#adialog_attended_transfer").off("click"),j$("#adialog_attended_revert").off("click"),j$("#adialog_attended_hangup").off("click")}}),j$("#adialog_attended_transfer").on("click",function(o){j$("#attended_popup").on("popupafterclose",function(o){j$("#attended_popup").off("popupafterclose"),common.PutToDebugLog(5,"EVENT, call AttendedPopup: transfer onclick: "+e),webphone_api.transfer(e,2)})}),j$("#adialog_attended_hangup").on("click",function(e){common.PutToDebugLog(5,"EVENT, call AttendedPopup: hangup onclick"),webphone_api.hangup()}),j$("#adialog_attended_revert").on("click",function(e){common.PutToDebugLog(5,"EVENT, call AttendedPopup: revert onclick")})}catch(n){common.PutToDebugLogException(2,"_call: AttendedPopup",n)}}function k(){try{var e=common.GetParameterInt("defmute",2);3!==e&&4!==e||(e=0);var o=!common.GetMuteState(-1);if(5===e)return common.PutToDebugLog(2,"WARNING, CALL, API_MutEx, "+o+", "+e+" Mute is disabled!"),!1;webphone_api.mute(o,e,-1);return v(ae),!0}catch(t){common.PutToDebugLogException(2,"_call: Mute",t)}return!1}function w(){try{var e=!common.GetHoldState(-1),o=webphone_api.hold(e,-1);if(v(le),o)return!0}catch(t){common.PutToDebugLogException(2,"_call: Hold",t)}return!1}function y(){try{alert("speaker on / off")}catch(e){common.PutToDebugLogException(2,"_call: Hold",e)}}function I(){try{!0===z&&m(),common.StartMsg(B,"","_call"),v(me)}catch(e){common.PutToDebugLogException(2,"_call: Chat",e)}}function C(e){try{if(common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()&&j$("#btn_call_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1)return void common.PutToDebugLog(2,"ERROR, _call: CreateOptionsMenu menuid null");if(j$(e).length<=0)return void common.PutToDebugLog(2,"ERROR, _call: CreateOptionsMenu can't get reference to Menu");"#"!==e.charAt(0)&&(e="#"+e),j$(e).html("");var o=common.GetParameterInt("featureset",3),t=common.GetAvailableCallfunctions();if(common.isNull(t)||t.length<3)return void common.PutToDebugLog(2,"ERROR, _call: CreateOptionsMenu no available callfunctions (1)");if(t.indexOf("numpad")>=0){var n=stringres.get("menu_numpad");j$("#numpad").is(":visible")&&(n=stringres.get("menu_numpad_hide")),j$(e).append('<li id="'+he+'"><a data-rel="back">'+n+"</a></li>").listview("refresh")}o>2&&t.indexOf("conference")>=0&&(!0===common.IsWindowsSoftphone()||common.getuseengine()===global.ENGINE_WEBPHONE||common.getuseengine()===global.ENGINE_SERVICE||common.getuseengine()===global.ENGINE_WEBRTC&&(!0===common.GetConfigBool("usingmizuserver",!1)||!0===common.IsMizuWebRTCEmbeddedServer()||!0===common.IsMizuWebRTCGateway()||!0===common.CanIUseService()))&&j$(e).append('<li id="'+be+'"><a data-rel="back">'+stringres.get("menu_conference")+"</a></li>").listview("refresh"),t.indexOf("chat")>=0&&j$(e).append('<li id="'+$e+'"><a data-rel="back">'+stringres.get("menu_message")+"</a></li>").listview("refresh"),o>1&&t.indexOf("transfer")>=0&&(!0===global.checkIfCallActive||common.GetNrOfActiveCalls()>0)&&j$(e).append('<li id="'+fe+'"><a data-rel="back">'+stringres.get("menu_transfer")+"</a></li>").listview("refresh"),o>1&&t.indexOf("mute")>=0&&(!0===global.checkIfCallActive||common.GetNrOfActiveCalls()>0)&&j$(e).append('<li id="'+ve+'"><a data-rel="back">'+stringres.get("menu_mute")+"</a></li>").listview("refresh"),o>1&&t.indexOf("hold")>=0&&(!0===global.checkIfCallActive||common.GetNrOfActiveCalls()>0)&&j$(e).append('<li id="'+Ee+'"><a data-rel="back">'+stringres.get("menu_hold")+"</a></li>").listview("refresh"),!0===common.CanIUseVideo()&&common.IsCExt()<1&&j$(e).append('<li id="'+Te+'"><a data-rel="back">'+stringres.get("menu_videorecall")+"</a></li>").listview("refresh"),1===common.IsMultiline()&&j$(e).append('<li id="'+we+'"><a data-rel="back">'+stringres.get("menu_multilinecall")+"</a></li>").listview("refresh"),o>2&&t.indexOf("callforward")>=0&&!0===F&&j$(e).append('<li id="'+_e+'"><a data-rel="back">'+stringres.get("menu_callforward")+"</a></li>").listview("refresh"),o>1&&t.indexOf("speaker")>=0&&j$(e).append('<li id="'+je+'"><a data-rel="back">'+stringres.get("menu_speaker")+"</a></li>").listview("refresh"),!0===U&&j$(e).append('<li id="'+de+'"><a data-rel="back">'+stringres.get("menu_ignore")+"</a></li>").listview("refresh"),!0===common.IsWindowsSoftphone()&&q>0&&1===common.GetParameterInt("softphonevideomode",0)&&j$(e).append('<li id="'+Ce+'"><a data-rel="back">'+stringres.get("menu_exit_videomode")+"</a></li>").listview("refresh"),j$("#mline_layout").is(":visible")&&(j$(e).append('<li id="'+ye+'"><a data-rel="back">'+stringres.get("menu_accept_hold")+"</a></li>").listview("refresh"),j$(e).append('<li id="'+Ie+'"><a data-rel="back">'+stringres.get("menu_accept_end")+"</a></li>").listview("refresh"));var a=common.GetConfig("callparknumber");if((common.isNull(a)||a.length<0)&&(a=common.GetParameter2("callparknumber")),a.length>0&&j$(e).append('<li id="'+ke+'"><a data-rel="back">'+stringres.get("menu_callpark")+"</a></li>").listview("refresh"),!1===common.GetParameterBool("displayvolumecontrols",!1)){var l="";l=j$("#volumecontrols").is(":visible")?stringres.get("menu_volumehide"):stringres.get("menu_volumeshow"),j$(e).append('<li id="'+Pe+'"><a data-rel="back">'+l+"</a></li>").listview("refresh")}return(common.getuseengine()!==global.ENGINE_WEBRTC||"Firefox"!==common.GetBrowser()&&"Chrome"!==common.GetBrowser())&&common.GetParameter("devicetype")!==common.DEVICE_WIN_SOFTPHONE()&&common.getuseengine()!==global.ENGINE_SERVICE&&common.getuseengine()!==global.ENGINE_WEBPHONE||j$(e).append('<li id="'+Ne+'"><a data-rel="back">'+stringres.get("menu_audiodeviceshow")+"</a></li>").listview("refresh"),1===q&&j$(e).append('<li id="'+De+'"><a data-rel="back">'+stringres.get("menu_mute_video")+"</a></li>").listview("refresh"),o>1&&common.GetParameter("voicerecftp_addr").length>0&&(!0===S(L())?j$(e).append('<li id="'+Le+'"><a data-rel="back">'+stringres.get("menu_stop_record_call")+"</a></li>").listview("refresh"):j$(e).append('<li id="'+Le+'"><a data-rel="back">'+stringres.get("menu_record_call")+"</a></li>").listview("refresh")),!0}catch(c){common.PutToDebugLogException(2,"_call: CreateOptionsMenu",c)}return!1}function D(e){try{if(common.isNull(e)||e.length<1)return;j$("#call_menu").on("popupafterclose",function(o){switch(j$("#call_menu").off("popupafterclose"),e){case de:webphone_api.ignore();break;case _e:E("callforward");break;case be:E("conference");break;case fe:E("transfer");break;case he:E("numpad");break;case ve:E("mute");break;case Ee:E("hold");break;case je:E("speaker");break;case $e:E("chat");break;case Pe:O();break;case Ne:webphone_api.devicepopup();break;case Te:x();break;case ke:A();break;case we:f();break;case ye:c(!0);break;case Ie:i(!0);break;case Ce:common.ExitVideoMode("USER,call Menu");break;case Le:var t=L();!0===S(t)?R(t):G(t)}})}catch(o){common.PutToDebugLogException(2,"_call: MenuItemSelected",o)}}function L(){try{if(!common.isNull(global.ep)||global.ep.length>0)for(var e=0;e<global.ep.length;e++)if(!(common.isNull(global.ep[e])||global.ep[e].length<5)){var o=global.ep[e][common.EP_LINE];if(o==global.aline){var t=global.ep[e][common.EP_DESTNR];if(!common.isNull(t)&&t.length>0)return t;break}}}catch(n){common.PutToDebugLogException(2,"_call: GetActiveLinePeer",n)}return B}function S(e){try{if(common.isNull(e)||e.length<1)return!1;common.isNull(Se)&&(Se={});var o=Se[e];if(!common.isNull(o)&&("1"==o||1==o))return!0}catch(t){common.PutToDebugLogException(2,"_call: IsRecStarted",t)}return!1}function G(e){try{if(common.isNull(e)||e.length<1)return;common.isNull(Se)&&(Se={}),webphone_api.voicerecord(!0,common.GetParameter("voicerecftp_addr")),Se[e]=1}catch(o){common.PutToDebugLogException(2,"_call: StartRecording",o)}}function R(e){try{if(common.isNull(e)||e.length<1)return;webphone_api.voicerecord(!1,common.GetParameter("voicerecftp_addr")),delete Se[e]}catch(o){common.PutToDebugLogException(2,"_call: StopRecording",o)}}function x(){try{if(q>0)return common.ShowToast("This is already a video call"),void common.PutToDebugLog(2,"WARNING, _call VideoRecall this is already a video call");common.PutToDebugLog(2,"EVENT, _call USER VideoRecall"),global.dontshow_closecall=!0,m(),setTimeout(function(){global.add_recall_header=!0,webphone_api.videocall(B),global.dontshow_closecall=!1},250),v(ue)}catch(e){common.PutToDebugLogException(2,"_call: VideoRecall",e)}}function A(){try{var e=common.GetConfig("callparknumber");if((common.isNull(e)||e.length<0)&&(e=common.GetParameter2("callparknumber")),common.PutToDebugLog(3,"EVENT, call CallPark onclick: "+e),e.length<1)return;webphone_api.dtmf(e)}catch(o){common.PutToDebugLogException(2,"_call: CallPark",o)}}function O(){try{j$("#volumecontrols").is(":visible")?j$("#volumecontrols").hide():j$("#volumecontrols").show(),r()}catch(e){common.PutToDebugLogException(2,"_call: ShowHideVolumeControls",e)}}function V(){try{if(common.isNull(B)||B.length<0)return!1;for(var e=common.GetParameter("received_confrooms"),o=e.split(","),t=0;t<o.length;t++)if(o[t]===B)return!0}catch(n){common.PutToDebugLogException(2,"_call: ShowHideVolumeControls",n)}return!1}function M(e){try{if(common.PutToDebugLog(4,"EVENT, _call: onStop"),global.isCallStarted=!1,global.hangupPressedCount=0,j$("#call_duration").html(""),global.rating="",global.closeCallAtivity=!1,plhandler.Cfin(),global.lastRingEvenet="",global.isconfroom_call=!1,q=0,oe="",j$("#page_call_additional_info").html(""),j$("#page_call_peer_details").html(""),j$("#callfunctions_layout").html(""),j$("#ml_buttons").html(""),global.acallcount=0,j$("#numpad_number").html(""),global.callPageStatusCachePerLine={},j$("#acceptreject_layout").hide(),j$("#hangup_layout").hide(),!common.isNull(Se)){var o=!1;for(var t in Se)if(Se.hasOwnProperty(t)&&1==Se[t]){o=!0;break}o&&R(L()),delete Se,Se={}}!1===common.IsSDK()&&(j$("#display_notmain_account").html(""),j$("#display_notmain_account").hide())}catch(n){common.PutToDebugLogException(2,"_call: onStop",n)}}function H(e){}var W="",B="",F=!1,U=!1,z=!1,q=0,K=!1,J=!1,Q=!1,X=!1,Y=17,Z=18,ee=16,oe="",te=0,ne=1,ae=2,le=3,ce=4,ie=5,re=6,me=7,ue=8,se=9,ge=!1,pe=!1,de="#menuitem_call_ignore",_e="#menuitem_call_callforward",be="#menuitem_call_conference",fe="#menuitem_call_transfer",he="#menuitem_call_numpad",ve="#menuitem_call_mute",Ee="#menuitem_call_hold",je="#menuitem_call_speaker",$e="#menuitem_call_message",Pe="#menuitem_volume_controls",Ne="#menuitem_audio_device",Te="#menuitem_recall_video",ke="#menuitem_callpark",we="#menuitem_multilinecall",ye="#menuitem_accepthold",Ie="#menuitem_acceptend",Ce="#menuitem_exit_videomode",De="#menuitem_call_audio_only",Le="#menuitem_call_record_call",Se={},Ge={LineCliked:b,OnNewIncomingCall:a,UpdateLineButtons:_,StartRecording:G,StopRecording:R,IsRecStarted:S,GetActiveLinePeer:L};return window.callpage_public=Ge,{onCreate:e,onStart:t,onStop:M,onDestroy:H,CloseCall:p,MeasureCall:r,OnCallerHangup:d,AcceptCall:u,RejectCall:s}}();