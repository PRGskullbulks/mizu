wpa._contactdetails=function(){function t(t){try{common.PutToDebugLog(4,"EVENT, _contactdetails: onCreate"),j$(window).resize(function(){"page_contactdetails"===j$.mobile.activePage.attr("id")&&o()}),j$("#contactdetails_menu_ul").on("click","li",function(t){s(j$(this).attr("id"))}),j$("#btn_contactdetails_menu").on("click",function(){m("#contactdetails_menu_ul")}),j$("#btn_contactdetails_menu").attr("title",stringres.get("hint_menu"))}catch(e){common.PutToDebugLogException(2,"_contactdetails: onCreate",e)}}function e(t){try{common.PutToDebugLog(4,"EVENT, _contactdetails: onStart"),global.isContactdetailsStarted=!0,j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_contactdetails"),-30)),common.isNull(document.getElementById("contactdetails_title"))||(document.getElementById("contactdetails_title").innerHTML=stringres.get("ctdetails_title")),j$("#contactdetails_title").attr("title",stringres.get("hint_page")),common.isNull(document.getElementById("ctdetails_btnback"))||(document.getElementById("ctdetails_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("ctdetails_btnback_txt")),o();var e=common.GetTickCount().toString(),c=common.GetIntentParam(global.intentctdetails,"ctname"),a=common.GetIntentParam(global.intentctdetails,"ctnumber");try{v=common.StrToInt(common.GetIntentParam(global.intentctdetails,"ctid"))}catch(i){common.PutToDebugLogException(2,"_contactdetails: onStart can't convert ctid to INT",i)}v<0&&!common.isNull(a)&&a.length>0&&(v=common.GetContactIdFromNumber(a)),v>=0&&(h=!0,f=global.ctlist[v]),v>=0?(j$("#btn_contactdetails_favorite").show(),E=common.ContactIsFavorite(v),!0===E?j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_on_normal_holo_light.png").attr("title",stringres.get("menu_ct_unsetfavorite")):j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_off_normal_holo_light.png").attr("title",stringres.get("menu_ct_setfavorite"))):(h=!1,common.isNull(c)&&(c=""),common.isNull(a)&&(a=""),c.length>0&&c===a&&(c=common.GetContactNameFromNumber(a)),f=[],f[common.CT_NAME]=c,f[common.CT_NUMBER]=[a],f[common.CT_PTYPE]=["other"],f[common.CT_USAGE]="0",f[common.CT_LASTMODIF]=e,f[common.CT_DELFLAG]="0",f[common.CT_FAV]="0",f[common.CT_EMAIL]="",f[common.CT_ADDRESS]="",f[common.CT_NOTES]="",f[common.CT_WEBSITE]="",f[common.CT_LASTACTIVE]="0"),n(),T=common.GetIntentParam(global.intentctdetails,"frompage"),"dialpad"!==T||common.isNull(document.getElementById("ctdetails_btnback"))||(document.getElementById("ctdetails_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("go_back_btn_txt"))}catch(i){common.PutToDebugLogException(2,"_contactdetails: onStart",i)}}function o(){try{j$("#page_contactdetails").css("min-height","auto");var t=common.GetDeviceHeight()-j$("#contactdetails_header").height();t-=3,j$("#page_contactdetails_content").height(t)}catch(e){common.PutToDebugLogException(2,"_contactdetails: MeasureContactdetails",e)}}function n(){var t=!1,e=[];try{if(common.isNull(f)||f.length<1)return void common.PutToDebugLog(2,"ERROR, _contactdetails PopulateData contact is NULL");j$("#page_contactdetails_content").html("");var o='<div id="contact_name"><p>'+f[common.CT_NAME]+'</p><div id="contact_blocked"><img src="'+common.GetElementSource()+'images/icon_block.png" id="contact_blocked_img" /></div><div id="contact_favorite"><img id="btn_contactdetails_favorite" style="display: none;" src="'+common.GetElementSource()+'images/btn_star_off_normal_holo_light.png" title="" /></div></div>',n=f[common.CT_NUMBER],m=f[common.CT_PTYPE];!0===common.UsePresence2()&&(t=!0),!common.isNull(n)&&n.length>0&&common.IsContactBlocked(null,n)&&(j=!0);var s="icon_call.png",r="icon_message.png",u="btn_video_txt.png";22!==common.GetColortheme()&&23!==common.GetColortheme()||(s="icon_call_grey.png",r="icon_message_grey.png",u="btn_video_txt_grey.png");common.GetTickCount();if(!common.isNull(n)&&n.length>0)for(var b=0;b<n.length;b++){var p="";if(t){var C="-1",$=global.presenceHM[n[b]];if(!common.isNull($)){C=$[common.PRES_STATUS];var P=$[common.PRES_TIME];!common.isNull(P)&&common.IsNumber(P)&&common.StrToInt(P)}common.isNull(C)||C.length<1||"-1"===C?(p="",common.isNull(e)&&(e=[]),e.indexOf(n[b])<0&&e.push(n[b])):p="0"===C?'<img src="'+common.GetElementSource()+'images/presence_grey.png" />':"1"===C?'<img src="'+common.GetElementSource()+'images/presence_white.png" />':"2"===C?'<img src="'+common.GetElementSource()+'images/presence_yellow.png" />':"3"===C?'<img src="'+common.GetElementSource()+'images/presence_orange.png" />':"4"===C?'<img src="'+common.GetElementSource()+'images/presence_red.png" />':"5"===C?'<img src="'+common.GetElementSource()+'images/presence_green.png" />':""}var k=stringres.get("type_"+m[b]);n.length<2&&(k=common.Trim(k.substring(0,k.indexOf(" "))));var y='<div id="ct_entry_'+b+'" class="cd_container"><div id="cd_call_'+b+'" class="cd_call"><div class="cd_data"><div class="cd_type">'+k+'</div><div class="cd_number">'+n[b]+'</div></div><div class="cd_icon">'+p+'<img src="'+common.GetElementSource()+"images/"+s+'" /></div></div></div>',N='<div id="ct_entry_'+b+'" class="cd_container"><div id="cd_msg_'+b+'" class="cd_call"><div class="cd_data"><div class="cd_type">'+stringres.get("send_msg")+'</div><div class="cd_number">'+n[b]+'</div></div><div class="cd_icon">'+p+'<img src="'+common.GetElementSource()+"images/"+r+'" /></div></div></div>',S="";!0===common.CanIUseVideo()&&(S='<div id="ct_entry_'+b+'" class="cd_container"><div id="cd_video_'+b+'" class="cd_call"><div class="cd_data"><div class="cd_type">'+stringres.get("video_call")+'</div><div class="cd_number">'+n[b]+'</div></div><div class="cd_icon">'+p+'<img src="'+common.GetElementSource()+"images/"+u+'" /></div></div></div>'),!0!==common.HideSettings("chat",stringres.get("sett_display_name_chat"),"chat",!0)&&3!=common.GetParameterInt("chatsms",0)||(N=""),o=o+y+N+S}var D="";D="dialpad"===T?stringres.get("btn_close"):stringres.get("ctdetails_btnback_txt");var L="";if(!0===common.CanIUseScreensharing()&&(L=L+'<div id="ct_screensh" class="cd_container"><div id="ct_screensh_entry_button" class="cd_call"><div class="cd_button">'+stringres.get("menu_screenshare")+"</div></div></div>"),!1===common.GetConfigBool("hasfiletransfer",!0)||!0!==common.GetConfigBool("usingmizuserver",!1)&&!0!==common.IsMizuWebRTCGateway()||!0===common.Glft()&&(L=L+'<div id="ct_filetransf" class="cd_container"><div id="ct_filetransf_entry_button" class="cd_call"><div class="cd_button">'+stringres.get("filetransf_title")+"</div></div></div>"),L=h?L+'<div id="ct_edit_entry" class="cd_container"><div id="ct_edit_entry_button" class="cd_call"><div class="cd_button">'+stringres.get("menu_editcontact")+'</div></div></div><div id="ct_delete_entry" class="cd_container"><div id="ct_delete_entry_button" class="cd_call"><div class="cd_button">'+stringres.get("menu_deletecontact")+"</div></div></div>":L+'<div id="ct_save_entry" class="cd_container"><div id="ct_save_entry_button" class="cd_call"><div class="cd_button">'+stringres.get("menu_createcontact")+"</div></div></div>",L=L+'<div id="ct_allcontacts_entry" class="cd_container"><div id="ct_allcontacts_entry_button" class="cd_call"><div class="cd_button">'+D+"</div></div></div>",o+=L,j$("#page_contactdetails_content").html(o),!0===j&&j$("#contact_blocked_img").show(),!common.isNull(n)&&n.length>0)for(var b=0;b<n.length;b++)!function(t){j$("#cd_call_"+t).on("click",function(){l(t,0)}),j$("#cd_msg_"+t).on("click",function(){l(t,1)}),j$("#cd_video_"+t).on("click",function(){l(t,2)})}(b);if(j$("#ct_screensh_entry_button").on("click",function(){c()}),j$("#ct_filetransf_entry_button").on("click",function(){a()}),j$("#ct_edit_entry_button").on("click",function(){_()}),j$("#ct_delete_entry_button").on("click",function(){g()}),j$("#ct_save_entry_button").on("click",function(){d()}),j$("#ct_allcontacts_entry_button").on("click",function(){j$.mobile.back()}),j$("#btn_contactdetails_favorite").off("click"),j$("#btn_contactdetails_favorite").on("click",function(){i()}),v>=0&&(j$("#btn_contactdetails_favorite").show(),E=common.ContactIsFavorite(v),!0===E?j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_on_normal_holo_light.png").attr("title",stringres.get("menu_ct_unsetfavorite")):j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_off_normal_holo_light.png").attr("title",stringres.get("menu_ct_setfavorite"))),t&&!common.isNull(e)&&e.length>0){for(var G="",b=0;b<e.length;b++)common.isNull(e[b])||common.Trim(e[b]).length<1||(G.length>0&&(G+=","),G+=e[b]);!common.isNull(G)&&G.length>0&&(G=common.ReplaceAll(G,"-",""),G=common.ReplaceAll(G,")",""),G=common.ReplaceAll(G,"(",""),common.PresenceGet2(G))}}catch(R){common.PutToDebugLogException(2,"_contactdetails: PopulateData",R)}}function c(){try{common.PutToDebugLog(2,"EVENT, _contactdetails: ScreenSh");var t=f[common.CT_NUMBER];return common.isNull(t)||t.length<1?(common.PutToDebugLog(1,"ERROR,"+stringres.get("ct_menu_error")),void common.ShowToast("ERROR,"+stringres.get("ct_menu_error"))):1===t.length?void webphone_api.screenshare(t[0]):void common.PickContactNumber(v,function(t,e){webphone_api.screenshare(t)})}catch(e){common.PutToDebugLogException(2,"_contactdetails: ScreenSh",e)}}function a(){try{common.PutToDebugLog(2,"EVENT, _contactdetails: FileTrasnf");var t=f[common.CT_NUMBER];return common.isNull(t)||t.length<1?(common.PutToDebugLog(1,"ERROR,"+stringres.get("ct_menu_error")),void common.ShowToast("ERROR,"+stringres.get("ct_menu_error"))):1===t.length?void common.FileTransfer(t[0]):void common.PickContactNumber(v,function(t,e){common.FileTransfer(t)})}catch(e){common.PutToDebugLogException(2,"_contactdetails: FileTrasnf",e)}}function i(){try{!0===E?(j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_off_normal_holo_light.png").attr("title",stringres.get("menu_ct_setfavorite")),common.ContactSetFavorite(v,!1)):(j$("#btn_contactdetails_favorite").attr("src",common.GetElementSource()+"images/btn_star_on_normal_holo_light.png").attr("title",stringres.get("menu_ct_unsetfavorite")),common.ContactSetFavorite(v,!0)),E=!E}catch(t){common.PutToDebugLogException(2,"_contactdetails: ToggleFavorite",t)}}function l(t,e){try{if(C)return;if(C=!0,setTimeout(function(){C=!1},1e3),common.isNull(t))return;var o=f[common.CT_NUMBER],n=o[t];f[common.CT_NAME];if(0===e){if(common.PutToDebugLog(4,"EVENT, _contactdetails initiate call to: "+n),setTimeout(function(){webphone_api.call(n,-1)},100),"p2p"===common.getuseengine())return;j$.mobile.back()}else 1===e?common.StartMsg(n,"","_contactdetails"):2===e&&(common.PutToDebugLog(4,"EVENT, _contactdetails initiate video call to: "+n),webphone_api.videocall(n))}catch(c){common.PutToDebugLogException(2,"_contactdetails: OnItemClick",c)}}function m(t){try{if(common.IsWindowsSoftphone()&&j$("#btn_contactdetails_menu").removeAttr("data-transition"),common.isNull(t)||t.lenght<1)return void common.PutToDebugLog(2,"ERROR, _contactdetails: CreateOptionsMenu menuid null");if(j$(t).length<=0)return void common.PutToDebugLog(2,"ERROR, _contactdetails: CreateOptionsMenu can't get reference to Menu");"#"!==t.charAt(0)&&(t="#"+t),j$(t).html(""),h?(j$(t).append('<li id="'+$+'"><a data-rel="back">'+stringres.get("menu_editcontact")+"</a></li>").listview("refresh"),j$(t).append('<li id="'+P+'"><a data-rel="back">'+stringres.get("menu_deletecontact")+"</a></li>").listview("refresh")):j$(t).append('<li id="'+k+'"><a data-rel="back">'+stringres.get("menu_createcontact")+"</a></li>").listview("refresh");var e=stringres.get("menu_block_contact");!0===j&&(e=stringres.get("menu_unblock_contact")),j$(t).append('<li id="'+y+'"><a data-rel="back">'+e+"</a></li>").listview("refresh");var o=stringres.get("menu_ct_setfavorite");return!0===E&&(o=stringres.get("menu_ct_unsetfavorite")),j$(t).append('<li id="'+N+'"><a data-rel="back">'+o+"</a></li>").listview("refresh"),!0}catch(n){common.PutToDebugLogException(2,"_contactdetails: CreateOptionsMenu",n)}return!1}function s(t){try{if(common.isNull(t)||t.length<1)return;j$("#contactdetails_menu").on("popupafterclose",function(e){switch(j$("#contactdetails_menu").off("popupafterclose"),t){case $:_();break;case P:g();break;case k:d();break;case y:r();break;case N:i()}})}catch(e){common.PutToDebugLogException(2,"_contactdetails: MenuItemSelected",e)}}function r(){try{if(!0===j){j=!1,j$("#contact_blocked_img").hide();var t=f[common.CT_NUMBER];!common.isNull(t)&&t.length>0&&common.UnBlockContact(null,t)}else{j=!0,j$("#contact_blocked_img").show();var t=f[common.CT_NUMBER];!common.isNull(t)&&t.length>0&&common.BlockContact(null,t)}}catch(e){common.PutToDebugLogException(2,"_contactdetails: ToggleCtBlocked",e)}}function d(){try{global.intentaddeditct[0]="action=add",global.intentaddeditct[1]="numbertoadd="+f[common.CT_NUMBER][0];var t=f[common.CT_NAME];(common.isNull(t)||t.length<1||t===f[common.CT_NUMBER][0])&&(t=""),global.intentaddeditct[2]="nametoadd="+t,j$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(e){common.PutToDebugLogException(2,"_contactdetails: CreateContact",e)}}function _(){try{global.intentaddeditct[0]="action=edit",global.intentaddeditct[1]="ctid="+v,j$.mobile.changePage("#page_addeditcontact",{transition:"pop",role:"page"})}catch(t){common.PutToDebugLogException(2,"_contactdetails: EditContact",t)}}function g(t){try{var e=common.GetDeviceWidth();e=!common.isNull(e)&&common.IsNumber(e)&&e>100?Math.floor(e/1.2):220;var o='<div id="delete_contact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+e+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("menu_deletecontact")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+stringres.get("contact_delete_msg")+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";t=t||function(){},j$.mobile.activePage.append(o).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(t){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var t=Math.floor(.6*common.GetDeviceHeight());j$(this).height()>t&&j$(".messagePopup .ui-content").height(t)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_adialog_ok").off("click"),t()}}),j$("#btn_adialog_ok").on("click",function(){u()})}catch(n){common.PutToDebugLogException(2,"_contactdetails: DeleteContactPopup",n)}}function u(){try{j$("#delete_contact_popup").on("popupafterclose",function(t){j$("#delete_contact_popup").off("popupafterclose"),global.ctlist.splice(v,1),common.SaveContactsFile(function(t){common.PutToDebugLog(4,"EVENT, _contactdetails: DeleteContact SaveContactsFile: "+t.toString())}),j$.mobile.back()})}catch(t){common.PutToDebugLogException(2,"_contactdetails: DeleteContact",t)}}function b(t){try{common.PutToDebugLog(4,"EVENT, _contactdetails: onStop"),global.isContactdetailsStarted=!1,j$("#contact_blocked_img").hide(),j=!1,j$("#page_contactdetails_content").html(""),j$("#btn_contactdetails_favorite").off("click"),v=-1,f=null,h=!1,T="",E=!1}catch(e){common.PutToDebugLogException(2,"_contactdetails: onStop",e)}}function p(t){}var v=-1,f=null,h=!1,T="",E=!1,j=!1,C=!1,$="#menuitem_contactdetails_edit",P="#menuitem_contactdetails_delete",k="#menuitem_contactdetails_create",y="#menuitem_contactdetails_blockct",N="#menuitem_contactdetails_favorite",S={PopulateData:n};return window.contactdetails_public=S,{onCreate:t,onStart:e,onStop:b,onDestroy:p,PopulateData:n}}();