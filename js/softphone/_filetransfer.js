wpa._filetransfer=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _filetransfer: onCreate"),j$(window).resize(function(){"page_filetransfer"===j$.mobile.activePage.attr("id")&&i()}),j$("#filetransfer_menu_ul").on("click","li",function(e){f(j$(this).attr("id"))}),j$("#btn_filetransfer_menu").on("click",function(){l("#filetransfer_menu_ul")}),j$("#btn_filetransfer_menu").attr("title",stringres.get("hint_menu")),j$("#btn_filetransfpick").on("click",function(){common.PickContact(a)}),j$("#btn_filetransfpick").attr("title",stringres.get("hint_choosect")),j$("#filetransfer_btnback").attr("title",stringres.get("hint_btnback"))}catch(t){common.PutToDebugLogException(2,"_filetransfer: onCreate",t)}}function t(e){try{common.PutToDebugLog(4,"EVENT, _filetransfer: onStart"),global.isFiletransferStarted=!0,common.isNull(document.getElementById("filetransfer_title"))||(document.getElementById("filetransfer_title").innerHTML=stringres.get("filetransf_title")),j$("#filetransfer_title").attr("title",stringres.get("hint_page")),common.isNull(document.getElementById("filetransfer_btnback"))||(document.getElementById("filetransfer_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("go_back_btn_txt"));var t=common.GetIntentParam(global.intentfiletransfer,"destination");common.isNull(t)&&(t=""),j$("#filetransfpick_input").val(t),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#filetransfer_header"),-30)),j$("#filetransfpick_input").attr("placeholder",stringres.get("filetransfer_nr")),setTimeout(function(){var e=j$("#filetransfpick_input").val();(common.isNull(e)||common.Trim(e).length<1)&&j$("#filetransfpick_input").focus()},100),g=m(),common.PutToDebugLog(2,"EVENT, filetransfer actionurl: "+g),u.style.background="transparent",u.style.border="0",u.style.width="100%",u.style.overflow="hidden";var n='<body style="margin 0; padding 0; background: transparent; width: 100%; overflow:hidden; font-size: 1em; color: #cecece;"><style>#fileinput { padding: .6em; background: #ffffff; display: inline-block; width: 95%; border: .1em solid #b8b8b8; -webkit-border-radius: .15em; border-radius: .15em;cursor: pointer; font-weight: bold; font-size: 1em; }#btn_filetransf { display: inline-block; margin-top: 1.5em; padding: .6em 2em .6em 2em; border: .1em solid #b8b8b8; -webkit-border-radius: .15em; border-radius: .15em;cursor: pointer; font-weight: bold; font-size: 1em; background: #cccccc; }#btn_filetransf:hover { background: #ffffff; }</style><form style=" width: 100%; margin: 0; padding: 0;" action="'+g+'" method="post" enctype="multipart/form-data" id="frm_filetransf" name="frm_filetransf" onsubmit="return OnFormSubmit()"><input type="hidden" id="filepath" name="filepath" value=""><input name="filedata" type="file" id="fileinput" /><br /><input type="submit" id="btn_filetransf" value="'+stringres.get("btn_send")+'" title="'+stringres.get("hint_filetranf")+'" /><script>function OnFormSubmit(){var directory = document.getElementById("filepath").value;var filename = document.getElementById("fileinput").value;return parent.filetransfer_public.FileTransferOnSubmit(directory, filename);}<\/script></form></body>';document.getElementById("ftranf_iframe_container").appendChild(u),u.contentWindow.document.open(),u.contentWindow.document.write(n),u.contentWindow.document.close(),u.onload=function(e){r(e)};var o=u.contentDocument||u.contentWindow.document;setTimeout(function(){function e(e){var t=document.getElementById("filetransfpick_input").value;if(common.isNull(t)||common.Trim(t).length<1)return e.preventDefault(),j$("#filetransfpick_input").focus(),void common.ShowToast(stringres.get("filetransf_err"));var n=common.GetTransferDirectoryName(t);o.getElementById("filepath").value=n,common.PutToDebugLog(4,"EVENT, filetransfer directory: "+n)}o.addEventListener?o.addEventListener("click",e,!1):o.attachEvent&&o.attachEvent("click",e)},150),i()}catch(a){common.PutToDebugLogException(2,"_filetransfer: onStart",a)}}function n(e,t){try{if(common.PutToDebugLog(4,"EVENT, FileTransferOnSubmit called from iframe form"),common.PutToDebugLog(4,"EVENT, FileTransferOnSubmit directory: "+e+"; filename: "+t),e=common.isNull(e)?"":"/"+e,common.isNull(t)||t.length<1)return common.PutToDebugLog(3,"ERROR, FileTransfer send failed: ivalid filename: "+t),common.ShowToast(stringres.get("fitransf_failed")),!1;var n=t.lastIndexOf("/");n>=0&&(t=t.substring(n+1,t.length)),n=t.lastIndexOf("\\"),n>=0&&(t=t.substring(n+1,t.length));var i=g+"filestorage"+e+"/"+o(t);common.PutToDebugLog(4,"EVENT, FileTransferOnSubmit filepath: "+i),j$("#ftranf_status").html(stringres.get("ftrnasf_status_processing"));var a='<a href="'+i+'" target="_blank" >'+o(t)+"</a>",m="[DONT_START_CHAT_WINDOW]"+common.GetSipusername()+" "+stringres.get("fitransf_chat")+": "+a,l=common.Trim(document.getElementById("filetransfpick_input").value);return webphone_api.sendchat(l,m),d=!0,"Firefox"!==common.GetBrowser()||(common.isNull(u)||document.getElementById("ftranf_iframe_container").removeChild(u),r(null),!1)}catch(f){common.PutToDebugLogException(2,"_filetransfer:  FileTransferOnSubmit",f)}return!1}function r(e){try{if(!1===d)return;d=!1,j$("#ftranf_status").html(stringres.get("ftrnasf_status_waiting")),setTimeout(function(){j$.mobile.back()},500)}catch(t){common.PutToDebugLogException(2,"_filetransfer:  FileUploaded",t)}}function o(e){try{var t=e,n=e.split("");if(common.isNull(n)||n.length<1)return t;for(var r=0;r<n.length;r++)n[r]>="0"&&n[r]<="9"||n[r]>="A"&&n[r]<="Z"||n[r]>="a"&&n[r]<="z"||"_"===n[r]||"."===n[r]||"-"===n[r]||(n[r]="_");return n.join("")}catch(o){common.PutToDebugLogException(2,"_filetransfer:  NormalizeFilename",o)}return t}function i(){try{j$("#page_filetransfer").css("min-height","auto"),j$("#page_filetransfer_content").height(common.GetDeviceHeight()-j$("#filetransfer_header").height()-2)}catch(e){common.PutToDebugLogException(2,"_filetransfer: MeasureFiletransfer",e)}}function a(e){try{document.getElementById("filetransfpick_input").value=e}catch(t){common.PutToDebugLogException(2,"_filetransfer: PickContactResult",t)}}function m(){var e="";try{var t="",n="",r=-1,o=common.GetParameter("filetransferurl");if(!common.isNull(o)&&o.length>2)return o=common.Trim(o),o=o.toLowerCase(),o.indexOf("http:")<0&&o.indexOf("https:")<0&&(o="http://"+o),common.IsHttps()&&(o=o.replace("http:","https:")),o;var i=common.GetWebrtcSrvAddr(),a=common.GetParameter("creditrequest"),m=common.GetWpS("uk");return!common.isNull(i)&&i.length>3&&i.toLowerCase().indexOf("mfstwebsock")>0?(t=i.toLowerCase(),n="http://",t.indexOf("wss:")>=0&&(n="https://"),t=common.NormalizeInput(t,0),r=t.indexOf("/"),r>0&&(t=t.substring(0,r)),t=common.Trim(t),e=n+t,n=""):!common.isNull(a)&&a.indexOf("mvapireq")>0?(t=a.toLowerCase(),r=t.indexOf("://"),r>0?(n=t.substring(0,r+3),t=t.substring(r+3)):(n="http://",!0===common.IsHttps()&&(n="https://")),r=t.indexOf("/"),r>0&&(t=t.substring(0,r)),t=common.Trim(t),e=n+t,n=""):!common.isNull(m)&&m.length>3&&(t=m.toLowerCase(),n="http://",t.indexOf("wss:")>=0&&(n="https://"),t=common.NormalizeInput(t,0),r=t.indexOf("/"),r>0&&(t=t.substring(0,r)),t=common.Trim(t),e=n+t,n=""),e.length<1?(common.PutToDebugLog(3,"ERROR, filetransfer invalid URL"),""):(e=e.replace("*",""),e+="/mvweb/")}catch(l){common.PutToDebugLogException(2,"_filetransfer: GetFormActionUrl",l)}return""}function l(e){try{return common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()&&j$("#btn_filetransfer_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _filetransfer: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _filetransfer: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+p+'"><a data-rel="back">'+stringres.get("menu_close")+"</a></li>").listview("refresh"),!0)}catch(t){common.PutToDebugLogException(2,"_filetransfer: CreateOptionsMenu",t)}return!1}function f(e){try{if(common.isNull(e)||e.length<1)return;j$("#filetransfer_menu").on("popupafterclose",function(t){switch(j$("#filetransfer_menu").off("popupafterclose"),e){case p:j$.mobile.back()}})}catch(t){common.PutToDebugLogException(2,"_filetransfer: MenuItemSelected",t)}}function c(e){try{common.PutToDebugLog(4,"EVENT, _filetransfer: onStop"),global.isFiletransferStarted=!1,common.isNull(u)||document.getElementById("ftranf_iframe_container").removeChild(u),document.getElementById("filetransfpick_input").value="",j$("#ftranf_status").html("")}catch(t){common.PutToDebugLogException(2,"_filetransfer: onStop",t)}}function s(e){}var u=document.createElement("iframe"),g="",d=!1,p="#menuitem_filetransfer_close",b={FileTransferOnSubmit:n};return window.filetransfer_public=b,{onCreate:e,onStart:t,onStop:c,onDestroy:s}}();