wpa._message=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _message: onCreate"),j$(window).resize(function(){"page_message"===j$.mobile.activePage.attr("id")&&t()}),j$("#message_menu_ul").on("click","li",function(e){v(j$(this).attr("id"))}),j$("#btn_message_menu").on("click",function(){h("#message_menu_ul")}),j$("#btn_message_menu").attr("title",stringres.get("hint_menu"));var o=0;j$("#msg_textarea").keyup(function(){j$("#msg_charcount").text(j$(this).html().length),(0===o||common.GetTickCount()-o>1e4)&&(o=common.GetTickCount(),webphone_api.sendchatiscomposing(global.mto))}),j$("#msg_textarea").keypress(function(e){if(!1===O){O=!0;var o=j$("#msg_textarea").html();if(!common.isNull(o)&&o.length>0){var n=o.indexOf("</span>");n>0&&(o=o.substring(n+7),j$("#msg_textarea").html(o))}}"false"!==common.GetParameter2("sendchatonenter")&&13===e.which&&(e.preventDefault(),j$("#btn_msgsend").click())}),j$("#status_message").attr("title",stringres.get("hint_status")),j$("#curr_user_message").attr("title",stringres.get("hint_curr_user")),j$("#btn_msgsend").on("click",function(){r(),o=0}),j$("#msg_btn_sendfile").on("click",function(){common.FileTransfer(j$("#msgpick_input").val())}),j$("#msg_btn_sendfile").attr("title",stringres.get("hint_filetranf")),j$("#btn_msgsend").attr("title",stringres.get("hint_sendmsg")),j$("#msg_btn_smiley").on("click",function(){j()}),j$("#msg_btn_smiley").attr("title",stringres.get("hint_smiley")),j$("#btn_msgpick").on("click",function(){common.PickContact(l)}),j$("#btn_msgpick").attr("title",stringres.get("hint_choosect")),j$("#msg_btnback").attr("title",stringres.get("hint_btnback"))}catch(n){common.PutToDebugLogException(2,"_message: onCreate",n)}}function o(e){try{common.PutToDebugLog(4,"EVENT, _message: onStart"),global.isMessageStarted=!0,j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_message"),-30)),j$("#msg_textarea").html(D),t(),!0===common.UsePresence2()&&(G=!0),y=common.GetIntentParam(global.intentmsg,"action"),global.mto=common.GetIntentParam(global.intentmsg,"to"),M=common.GetIntentParam(global.intentmsg,"message"),common.isNull(document.getElementById("msg_title"))||common.isNull(y)||(document.getElementById("msg_title").innerHTML="sms"===y?stringres.get("msg_title_sms"):stringres.get("msg_title_chat")),j$("#msg_title").attr("title",stringres.get("hint_page")),common.isNull(document.getElementById("msg_btnback"))||(document.getElementById("msg_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("go_back_btn_txt")),common.isNull(global.mto)&&(global.mto=""),common.isNull(M)&&(M=""),j$("#msgpick_input").attr("placeholder",stringres.get("chat_nr")),j$("#msgpick_input").keyup(function(){n()}),j$("#msgpick_input").on("input",function(e){n()}),setTimeout(function(){var e=j$("#msgpick_input").val();common.isNull(e)||common.Trim(e).length<1?j$("#msgpick_input").focus():j$("#msg_textarea").focus()},100),m()}catch(o){common.PutToDebugLogException(2,"_message: onStart",o)}}function n(){try{var e=common.GetParameter("sms");if(common.isNull(e)||e.length<3)return;var o=common.GetParameter("chatsms"),n=j$("#msgpick_input").val();if(common.isNull(n)||common.Trim(n).length<1)return;if(n=common.Trim(n),"1"!==o&&"2"!==o){var t=n;t.indexOf("+")>=0&&(t=t.substring(t.indexOf("+")+1,t.length)),common.IsNumber(t)&&t.length>6&&t.length<20?(y="sms",document.getElementById("msg_title").innerHTML=stringres.get("msg_title_sms")):(y="chat",document.getElementById("msg_title").innerHTML=stringres.get("msg_title_chat"))}}catch(m){common.PutToDebugLogException(2,"_message: HandleChatSms",m)}}function t(){try{j$("#page_message").css("min-height","auto");var e=common.GetDeviceHeight()-j$("#message_header").height()-j$("#msg_textarea_container").height();"block"===document.getElementById("msgpick_container").style.display&&(e-=j$("#msgpick_container").height());var o=common.GetCallerid();!common.isNull(o)&&o.length>0&&j$("#curr_user_message").html(o);var n=common.GetDeviceWidth()-j$("#curr_user_message").width()-25;!common.isNull(n)&&common.IsNumber(n)&&j$("#status_message").width(n),e=Math.floor(e-6),j$("#msg_list").height(e)}catch(t){common.PutToDebugLogException(2,"_message: MeasureMessage",t)}}function m(){try{if(!common.isNull(global.mto)&&global.mto.length>0){document.getElementById("msgpick_input").value=global.mto;var e=y+"_"+common.GetSipusername()+"_"+global.mto;global.File.ReadFile(e,global.STORAGE_LOCAL,function(e){(common.isNull(e)||common.Trim(e).length<1)&&(common.PutToDebugLog(2,"ERROR, _message: LoadMessage no content"),e="",document.getElementById("msgpick_container").style.display="block",t()),x=e,!common.isNull(M)&&M.length>0&&x.indexOf("<p>"+M+"</p>")<0&&_("1",!0),i()})}else document.getElementById("msgpick_container").style.display="block",t(),!common.isNull(M)&&M.length>0&&x.indexOf("<p>"+M+"</p>")<0&&_("1",!0),i()}catch(o){common.PutToDebugLogException(2,"_message: LoadMessage",o)}}function i(){try{if(common.isNull(document.getElementById("page_message_content")))return void common.PutToDebugLog(2,"ERROR, _message: PopulateList listelement is null");if(j$("#msg_list").html(""),j$("#msg_list").append(x),d(),c(),!common.isNull(global.mto)&&global.mto.length>0&&!0===G){var e="-1",o=global.presenceHM[global.mto];common.isNull(o)||(e=o[common.PRES_STATUS]),common.isNull(e)||e.length<1||"-1"===e?common.PresenceGet2(global.mto):a(e)}}catch(n){common.PutToDebugLogException(2,"_message: LoadMessage",n)}}function s(){common.PresenceGet2(global.mto)}function a(e){try{if(!0!==G||common.isNull(e)||e.length<1)return;if(I=e,!common.isNull(document.getElementById("msg_title"))&&!common.isNull(y)){var o="";o="sms"===y?stringres.get("msg_title_sms"):stringres.get("msg_title_chat");var n="";n=common.isNull(e)||e.length<1?"":"0"===e?'<img src="'+common.GetElementSource()+'images/presence_grey.png" />':"1"===e?'<img src="'+common.GetElementSource()+'images/presence_white.png" />':"2"===e?'<img src="'+common.GetElementSource()+'images/presence_yellow.png" />':"3"===e?'<img src="'+common.GetElementSource()+'images/presence_orange.png" />':"4"===e?'<img src="'+common.GetElementSource()+'images/presence_red.png" />':"5"===e?'<img src="'+common.GetElementSource()+'images/presence_green.png" />':"",!common.isNull(n)&&n.length>0&&!common.isNull(global.mto)&&global.mto.length>0&&(o=o+"&nbsp;&nbsp;&nbsp;"+global.mto+" "+n,document.getElementById("msg_title").innerHTML=o)}}catch(t){common.PutToDebugLogException(2,"_message: DisplayPresence",t)}}function c(){try{var e=common.GetParameter("messagefiles");if(common.isNull(e)||e.length<3)return void common.PutToDebugLog(3,"EVENT, _message: RemoveNotification no message files");var o=[];!common.isNull(e)&&e.length>0&&(o=e.split(","));for(var n=y+"_"+common.GetSipusername()+"_"+global.mto+"[#",t=0;t<o.length;t++)if(!(common.isNull(o[t])||o[t].length<3)&&0===o[t].indexOf(n)){var m=o[t].indexOf("[#");o[t]=o[t].substring(0,m),e="";for(var i=0;i<o.length;i++)e=e+","+o[i];0===e.indexOf(",")&&(e=e.substring(1)),e.lastIndexOf(",")===e.length-1&&(e=e.substring(0,e.length-1)),common.SaveParameter("messagefiles",e);break}}catch(s){common.PutToDebugLogException(2,"_message: RemoveNotification",s)}}function l(e){try{document.getElementById("msgpick_input").value=e,j$("#msg_textarea").focus(),n()}catch(o){common.PutToDebugLogException(2,"_message: PickContactResult",o)}}function g(e){try{if(common.isNull(e)||common.Trim(e).length<1)return void common.PutToDebugLog(2,"ERROR, _message: AddToGroupChat invalid destination: "+e);var o=document.getElementById("msgpick_input"),n=o.value;if(common.isNull(n)&&(n=""),n=common.Trim(n),!0===R&&"chat"===y){for(var t=n.split(","),m=0;m<t.length;m++)if(!(common.isNull(t[m])||common.Trim(t[m]).length<1)){var i=e+" "+stringres.get("gc_message2");webphone_api.sendchat(common.Trim(t[m]),i)}var s="["+stringres.get("gc_message")+": "+n+"]";webphone_api.sendchat(e,s)}n.length>0&&(n+=","),n+=e,o.value=n,common.PutToDebugLog(2,"EVENT, _message: AddToGroupChat: "+e)}catch(a){common.PutToDebugLogException(2,"_message: AddToGroupChat",a)}}function r(){try{if(common.PutToDebugLog(5,"EVENT, _message: SendMessage onclick"),common.isNull(N)&&(N=document.getElementById("msg_textarea"),common.isNull(N)))return void common.PutToDebugLog(2,"ERROR, _message: SendMessage textarea is NULL");M=N.innerHTML,common.isNull(M)||(M=M.replace(D,""));var e=document.getElementById("msgpick_input").value;if(common.isNull(e)||common.Trim(e).length<1)return void("sms"===y?common.ShowToast(stringres.get("err_msg_5")):common.ShowToast(stringres.get("err_msg_6")));if(global.mto=e,common.isNull(M)||common.Trim(M).length<1)return void(N.innerHTML="");M=$(M),u(global.mto,M),N.innerHTML="",P?_("1",!1):_("0",!1),N.focus()}catch(o){common.PutToDebugLogException(2,"_message: SendMessage",o)}}function u(e,o){try{if("sms"===y){common.PutToDebugLog(5,"EVENT, _message SMS SendMessage to: "+global.mto+"; message: "+M);var n=common.Trim(global.mto),t=common.StripXML(M);if(global.mto.indexOf(",")>0){for(var m=global.mto.split(","),i=0;i<m.length;i++)if(!(common.isNull(m[i])||common.Trim(m[i]).length<1)){if(!1===R){var s=m.toString();s=s.replace(","+m[i],""),s=s.replace(m[i]+",",""),s=s.replace(m[i],""),s="["+stringres.get("gc_message")+": "+s+"]",common.UriParser(common.GetParameter("sms"),"",common.GetSipusername(),common.Trim(m[i]),s,"sendsms")}common.UriParser(common.GetParameter("sms"),"",common.GetSipusername(),common.Trim(m[i]),t,"sendsms")}}else common.UriParser(common.GetParameter("sms"),"",common.GetSipusername(),n,t,"sendsms");P=!0}else{if(global.mto.indexOf(",")>0&&!1===R)for(var m=global.mto.split(","),i=0;i<m.length;i++)if(!(common.isNull(m[i])||common.Trim(m[i]).length<1)){var s=m.toString();s=s.replace(","+m[i],""),s=s.replace(m[i]+",",""),s=s.replace(m[i],""),s="["+stringres.get("gc_message")+": "+s+"]",webphone_api.sendchat(common.Trim(m[i]),s)}webphone_api.sendchat(global.mto,M),P=!0}R=!0}catch(a){common.PutToDebugLogException(2,"_message: SendAction",a)}}function f(){try{var e=new Date,o=e.getMinutes();o<10&&(o="0"+o);var n=e.getDate();n<10&&(n="0"+n);return A[e.getMonth()]+", "+n+" "+e.getFullYear()+" "+e.getHours()+":"+o}catch(t){common.PutToDebugLogException(2,"_message: GetDateForMessage",t)}return""}function _(e,o){var n=0;try{if(common.isNull(M))return void common.PutToDebugLog(3,"ERROR, _message: AddMessage message is empty (null)");C<0&&(C="true"===common.GetParameter2("filterchatduplicates")?1e4:1e3),n=1;var t=common.GetTickCount();if(M.length>0&&M===w&&t-H<C)return;w=M,H=t;var m="";m=o?common.GetContactNameFromNumber(global.mto):stringres.get("me");var s="";if(M.indexOf("/filestorage/")>0){var a=M,c="";if(h=a.indexOf("http:"),h<0&&(h=a.indexOf("https:")),h>=0&&(a=common.Trim(a.substring(h,a.length)),h=a.lastIndexOf("</"),h>0&&(a=common.Trim(a.substring(0,h))),c=a,h=c.lastIndexOf("/"),h>0&&(c=c.substring(h+1,c.length)),c=common.Trim(c)),!common.isNull(c)&&c.length>0&&!common.isNull(a)&&a.length>10){h=M.indexOf("http:"),h<0&&(h=M.indexOf("https:"));s=common.Trim(M.substring(0,h))+' <a href="'+a+'" target="_blank" onclick="try{webphone_api.filetransfercallback(\''+global.mto+"')}catch(e){;}\">"+c+"</a>"}else s=M}(common.isNull(s)||s.length<1)&&(s=M),s=L(s);var l="<b>"+m+":</b><p>"+s+'</p><p class="date">'+f()+'</p><img class="sent_status" src="'+common.GetElementSource()+'images/spacer.png" border="0"/>';if(j$("#msg_list").append(l),d(),common.isNull(global.mto)||global.mto.length<1)return void common.PutToDebugLog(2,"ERROR, _message: AddMessage destination number is NULL");var g=y+"_"+common.GetSipusername()+"_"+global.mto,r=common.GetParameter("messagefiles"),u=[];!common.isNull(r)&&r.length>0&&(u=r.split(","));for(var _=!1,b=0;b<u.length;b++)if(!common.isNull(u[b])){var p=u[b],h=p.indexOf("[#");if(h>0&&(p=p.substring(0,h)),p===g){u.splice(b,1),u.unshift(g),r="";for(var v=0;v<u.length;v++)r=r+","+u[v];0===r.indexOf(",")&&(r=r.substring(1)),r.lastIndexOf(",")===r.length-1&&(r=r.substring(0,r.length-1)),common.SaveParameter("messagefiles",r),_=!0;break}}_||(r.length>0?(r=g+","+r,0===r.indexOf(",")&&(r=r.substring(1)),r.lastIndexOf(",")===r.length-1&&(r=r.substring(0,r.length-1))):r=g,common.SaveParameter("messagefiles",r)),x.length<1?common.IsWindowsSoftphone()?common.ApiWinLoadFile(g,function(e){(!common.isNull(e)||common.Trim(e).length>0)&&(x=e),x+=l,i(),common.ApiWinSaveFile(g,x,function(e){e&&common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1) WinApi")})}):global.File.ReadFile(g,global.STORAGE_LOCAL,function(e){(!common.isNull(e)||common.Trim(e).length>0)&&(x=e),x+=l,i(),global.File.SaveFile(g,x,global.STORAGE_LOCAL,function(e){e||common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (1)")})}):(x+=l,common.IsWindowsSoftphone()?common.ApiWinSaveFile(g,x,function(e){e||common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (2) WinApi")}):global.File.SaveFile(g,x,global.STORAGE_LOCAL,function(e){e||common.PutToDebugLog(2,"ERROR, _message: AddMessage cannot save message file (2)")}))}catch(T){common.PutToDebugLogException(2,"_message: AddMessage ("+n.toString()+")",T)}}function b(e,o,n,t){try{var m="<b>"+n+":</b><p>"+t+'</p><p class="date">'+f()+"</p>";if(common.isNull(o)||o.length<1)return void common.PutToDebugLog(2,"ERROR, _message: SaveMissedIncomingMessage source number is NULL");var i=e+"_"+common.GetSipusername()+"_"+o,s=common.GetParameter("messagefiles"),a=[];!common.isNull(s)&&s.length>0&&(a=s.split(","));for(var c=!1,l=0,g=0;g<a.length;g++)if(!common.isNull(a[g])){var r=a[g],u=r.indexOf("[#");if(u>0&&(r=r.substring(0,u)),r===i){if(u>0){var _=common.Trim(a[g].substring(u+2));if(_.length>0)try{l=common.StrToInt(_)}catch(p){}}l+=1,a.splice(g,1),a.unshift(i+"[#"+l),s="";for(var b=0;b<a.length;b++)s=s+","+a[b];0===s.indexOf(",")&&(s=s.substring(1)),s.lastIndexOf(",")===s.length-1&&(s=s.substring(0,s.length-1)),common.SaveParameter("messagefiles",s),c=!0;break}}c||(s=s.length>0?i+"[#1,"+s:i+"[#1",common.SaveParameter("messagefiles",s)),common.IsWindowsSoftphone()?common.ApiWinLoadFile(i,function(e){common.isNull(e)&&(e=""),e+=m,common.ApiWinSaveFile(i,e,function(e){e||common.PutToDebugLog(2,"ERROR, _message: SaveMissedIncomingMessage cannot save message file (1) WinApi")})}):global.File.ReadFile(i,global.STORAGE_LOCAL,function(e){common.isNull(e)&&(e=""),e+=m,global.File.SaveFile(i,e,global.STORAGE_LOCAL,function(e){e||common.PutToDebugLog(2,"ERROR, _message: SaveMissedIncomingMessage cannot save message file (1)")})})}catch(p){common.PutToDebugLogException(2,"_message: SaveMissedIncomingMessage",p)}}function p(e,o,n){try{if(!0===G&&(global.msg_presence_timer=0,common.isNull(I)||"0"===I||a("5")),R=!0,global.mto.indexOf(o)>=0){if(n=common.ReplaceAll(n,"\\<.*?>",""),M=n,_("1",!0),global.mto.indexOf(",")>0)for(var t=global.mto.split(","),m=0;m<t.length;m++)common.isNull(t[m])||common.Trim(t[m]).length<1||t[m]!==o&&("sms"===y?common.UriParser(common.GetParameter("sms"),"",common.GetSipusername(),common.Trim(t[m]),n,"sendsms"):webphone_api.sendchat(common.Trim(t[m]),n))}else{var i=common.GetContactNameFromNumber(o);common.PutNotifications2("1","",i+" - "+o,0),b(e,o,i,n)}}catch(s){common.PutToDebugLogException(2,"_message: ShowIncomingMessage",s)}}function d(){try{var e=j$("#msg_list");e.scrollTop(e.prop("scrollHeight"))}catch(o){common.PutToDebugLogException(2,"_message: ScrollToBottom",o)}}function h(e){try{return common.IsWindowsSoftphone()&&j$("#btn_message_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _message: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _message: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+F+'"><a data-rel="back">'+stringres.get("delete_text")+"</a></li>").listview("refresh"),j$(e).append('<li id="'+W+'"><a data-rel="back">'+stringres.get("menu_call")+"</a></li>").listview("refresh"),!1===common.GetConfigBool("hasfiletransfer",!0)||!0!==common.GetConfigBool("usingmizuserver",!1)&&!0!==common.IsMizuWebRTCGateway()||j$(e).append('<li id="'+B+'"><a data-rel="back">'+stringres.get("filetransf_title")+"</a></li>").listview("refresh"),j$(e).append('<li id="'+U+'"><a data-rel="back">'+stringres.get("menu_groupchat")+"</a></li>").listview("refresh"),!0)}catch(o){common.PutToDebugLogException(2,"_message: CreateOptionsMenu",o)}return!1}function v(e){try{if(common.isNull(e)||e.length<1)return;j$("#message_menu").on("popupafterclose",function(o){switch(j$("#message_menu").off("popupafterclose"),e){case F:k();break;case B:common.FileTransfer(j$("#msgpick_input").val());break;case W:T(j$("#msgpick_input").val());break;case U:common.PickContact(g)}})}catch(o){common.PutToDebugLogException(2,"_message: MenuItemSelected",o)}}function T(e,o){try{if(common.isNull(e)||e.length<1)return common.ShowToast(stringres.get("err_msg_4")),void common.PutToDebugLog(2,"ERROR, _message: StartCall number is NULL");e=common.NormalizeNumber(e),!0===o?(common.PutToDebugLog(4,"EVENT, _message initiate video call to: "+e),webphone_api.videocall(e)):(common.PutToDebugLog(4,"EVENT, _message initiate call to: "+e),webphone_api.call(e,-1))}catch(n){common.PutToDebugLogException(2,"_message: StartCall",n)}}function k(e){try{var o=common.GetParameter("messagefiles");if(common.isNull(o)||o.length<3||common.isNull(global.mto)||global.mto.length<1)return void common.ShowToast(stringres.get("err_msg_7"));var n=common.GetDeviceWidth();n=!common.isNull(n)&&common.IsNumber(n)&&n>100?Math.floor(n/1.2):220;var t='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+n+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("delete_text")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+stringres.get("delete_msg_alert")+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";e=e||function(){},j$.mobile.activePage.append(t).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*common.GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_adialog_ok").off("click"),e()}}),j$("#btn_adialog_ok").on("click",function(){j$.mobile.activePage.find(".messagePopup").on("popupafterclose",function(e){j$(this).off("popupafterclose");for(var n=y+"_"+common.GetSipusername()+"_"+global.mto,t=o.split(","),m=0;m<t.length;m++)if(!common.isNull(t[m])){var i=t[m],s=i.indexOf("[#");if(s>0&&(i=i.substring(0,s)),i===n){t.splice(m,1),o="";for(var a=0;a<t.length;a++)o=o+","+t[a];0===o.indexOf(",")&&(o=o.substring(1)),o.lastIndexOf(",")===o.length-1&&(o=o.substring(0,o.length-1)),common.SaveParameter("messagefiles",o);break}}global.File.DeleteFile(n,function(e){common.PutToDebugLog(3,"EVENT, _message: ClearHistory DeleteFile: "+n+" status: "+e.toString())}),j$.mobile.back()})})}catch(m){common.PutToDebugLogException(2,"_message: ClearHistory",m)}}function j(){try{var e=document.getElementById("smiley_container");if(common.isNull(e))return void common.PutToDebugLog(2,"ERROR, _message OpenSmileys: container is NULL");e.style.display="block";var o=function(){e.style.display="none",j$("#btn_emoti_smiling").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_sad").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_laughing").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_winking").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_surprised").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_straightface").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_worried").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_crying").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_cool").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_angel").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_kiss").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_idea").off("click").off("mouseover").off("mouseout"),j$("#btn_emoti_thinking").off("click").off("mouseover").off("mouseout")};j$("#msg_btn_smiley_close").on("click",function(){o()}),j$("#msg_btn_smiley_close").attr("title",stringres.get("btn_close"));var n=document.getElementById("smiley_hint");common.isNull(n)||(j$("#btn_emoti_smiling").on("mouseover",function(){n.innerHTML="Smiling :)"}).on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_sad").on("mouseover",function(){n.innerHTML="Sad :("}),j$("#btn_emoti_sad").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_laughing").on("mouseover",function(){n.innerHTML="Laughing :))"}),j$("#btn_emoti_laughing").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_winking").on("mouseover",function(){n.innerHTML="Winking ;)"}),j$("#btn_emoti_winking").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_surprised").on("mouseover",function(){n.innerHTML="Surprised :-O"}),j$("#btn_emoti_surprised").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_straightface").on("mouseover",function(){n.innerHTML="StraightFace :|"}),j$("#btn_emoti_straightface").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_worried").on("mouseover",function(){n.innerHTML="Worried :-S"}),j$("#btn_emoti_worried").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_crying").on("mouseover",function(){n.innerHTML="Crying :(("}),j$("#btn_emoti_crying").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_cool").on("mouseover",function(){n.innerHTML="Cool B-)"}),j$("#btn_emoti_cool").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_angel").on("mouseover",function(){n.innerHTML="Angel :-O)"}),j$("#btn_emoti_angel").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_kiss").on("mouseover",function(){n.innerHTML="Kiss :x"}),j$("#btn_emoti_kiss").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_idea").on("mouseover",function(){n.innerHTML="Idea :-I"}),j$("#btn_emoti_idea").on("mouseout",function(){n.innerHTML=""}),j$("#btn_emoti_thinking").on("mouseover",function(){n.innerHTML="Thinking :-?"}),j$("#btn_emoti_thinking").on("mouseout",function(){n.innerHTML=""}));var t=function(e){try{o();var n='<img src="'+common.GetElementSource()+"images/smiley/"+e+'.gif">',t=document.getElementById("msg_textarea");t.innerHTML=t.innerHTML+" "+n+" "}catch(m){common.PutToDebugLogException(2,"_message: AddSmiley",m)}};j$("#btn_emoti_smiling").on("click",function(){t("Smiling")}),j$("#btn_emoti_sad").on("click",function(){t("Sad")}),j$("#btn_emoti_laughing").on("click",function(){t("Laughing")}),j$("#btn_emoti_winking").on("click",function(){t("Winking")}),j$("#btn_emoti_surprised").on("click",function(){t("Surprised")}),j$("#btn_emoti_straightface").on("click",function(){t("StraightFace")}),j$("#btn_emoti_worried").on("click",function(){t("Worried")}),j$("#btn_emoti_crying").on("click",function(){t("Crying")}),j$("#btn_emoti_cool").on("click",function(){t("Cool")}),j$("#btn_emoti_angel").on("click",function(){t("Angel")}),j$("#btn_emoti_kiss").on("click",function(){t("Kiss")}),j$("#btn_emoti_idea").on("click",function(){t("Idea")}),j$("#btn_emoti_thinking").on("click",function(){t("Thinking")})}catch(m){common.PutToDebugLogException(2,"_message: OpenSmileys",m)}}function L(e){try{if(common.isNull(e)||e.length<1)return e;var o=e;return o=common.ReplaceAll(o,":))",'<img src="'+common.GetElementSource()+'images/smiley/Laughing.gif">'),o=common.ReplaceAll(o,":((",'<img src="'+common.GetElementSource()+'images/smiley/Crying.gif">'),o=common.ReplaceAll(o,":)",'<img src="'+common.GetElementSource()+'images/smiley/Smiling.gif">'),o=common.ReplaceAll(o,":(",'<img src="'+common.GetElementSource()+'images/smiley/Sad.gif">'),o=common.ReplaceAll(o,";)",'<img src="'+common.GetElementSource()+'images/smiley/Winking.gif">'),o=common.ReplaceAll(o,":-O",'<img src="'+common.GetElementSource()+'images/smiley/Surprised.gif">'),o=common.ReplaceAll(o,":|",'<img src="'+common.GetElementSource()+'images/smiley/StraightFace.gif">'),o=common.ReplaceAll(o,":-S",'<img src="'+common.GetElementSource()+'images/smiley/Worried.gif">'),o=common.ReplaceAll(o,"B-)",'<img src="'+common.GetElementSource()+'images/smiley/Cool.gif">'),o=common.ReplaceAll(o,":-O)",'<img src="'+common.GetElementSource()+'images/smiley/Angel.gif">'),o=common.ReplaceAll(o,":x",'<img src="'+common.GetElementSource()+'images/smiley/Kiss.gif">'),o=common.ReplaceAll(o,":-I",'<img src="'+common.GetElementSource()+'images/smiley/Idea.gif">'),o=common.ReplaceAll(o,":-?",'<img src="'+common.GetElementSource()+'images/smiley/Thinking.gif">')}catch(n){common.PutToDebugLogException(2,"_message: AddEmoticon",n)}return e}function $(e){try{if(common.isNull(e)||e.length<1||e.indexOf("<img")<0)return e;for(var o="",n=e.split("<img"),t=0,m=0;m<n.length;m++){var i=n[m];if(!common.isNull(i)&&i.indexOf('.gif">')>0){var s=":)";switch(t=i.indexOf(".gif"),t>0&&(s=i.substring(0,t),(t=s.lastIndexOf("/"))>0&&(s=s.substr(t+1))),s){case"Smiling":s=":)";break;case"Sad":s=":(";break;case"Laughing":s=":))";break;case"Winking":s=";)";break;case"Surprised":s=":-O";break;case"StraightFace":s=":|";break;case"Worried":s=":-S";break;case"Crying":s=":((";break;case"Cool":s="B-)";break;case"Angel":s=":-O)";break;case"Kiss":s=":x";break;case"Idea":s=":-I";break;case"Thinking":s=":-?"}n[m]=s+i.substring(i.indexOf('.gif">')+6)}}for(var m=0;m<n.length;m++)o+=n[m];return o}catch(a){common.PutToDebugLogException(2,"_message: RemoveEmoticon",a)}return e}function E(e){try{common.PutToDebugLog(4,"EVENT, _message: onStop"),global.isMessageStarted=!1,R=!1,document.getElementById("msgpick_input").value="",document.getElementById("msg_list").innerHTML="",document.getElementById("msg_textarea").innerHTML="",document.getElementById("msg_charcount").innerHTML="0",document.getElementById("msgpick_container").style.display="none",y="",P=!1,global.mto="",M="",x="",O=!1,j$("#msgpick_input").off("input"),common.SaveContactsFile(function(e){common.PutToDebugLog(4,"EVENT, _message: onDestroy SaveContactsFile: "+e.toString())})}catch(o){common.PutToDebugLogException(2,"_message: onStop",o)}}function S(e){}var y="",P=!1,N=null,M="",x="",R=!1,O=!1,G=!1,D='<span style="color: #ccc;">'+stringres.get("messagepl")+"</span>",I="",A=new Array;A[0]="Jan",A[1]="Feb",A[2]="Mar",A[3]="Apr",A[4]="May",A[5]="Jun",A[6]="Jul",A[7]="Aug",A[8]="Sep",A[9]="Oct",A[10]="Nov",A[11]="Dec";var w="",H=0,C=-1,F="#menuitem_message_delete",B="#menuitem_message_filetransfer",W="#menuitem_message_call",U="#menuitem_message_groupchat",V={DisplayPresence:a};return window.message_public=V,{onCreate:e,onStart:o,onStop:E,onDestroy:S,ShowIncomingMessage:p,SaveMissedIncomingMessage:b,RefreshPresence:s,LoadMessage:m}}();