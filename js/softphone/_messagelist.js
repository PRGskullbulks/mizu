wpa._messagelist=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _messagelist: onCreate"),j$("#messagelist_list").on("click","li",function(e){o(j$(this).attr("id"))}),j$("#messagelist_notification_list").on("click",".nt_anchor",function(e){j$("#messagelist_not").panel("close"),common.NotificationOnClick2(j$(this).attr("id"),!1)}),j$("#messagelist_notification_list").on("click",".nt_menu",function(e){j$("#messagelist_not").panel("close"),common.NotificationOnClick2(j$(this).attr("id"),!0)}),j$("#messagelist_not_btn").on("click",function(){common.SaveParameter("notification_count2",0),common.ShowNotifications2()}),j$(window).resize(function(){"page_messagelist"===j$.mobile.activePage.attr("id")&&i()}),j$("#messagelist_menu_ul").on("click","li",function(e){m(j$(this).attr("id"))}),j$("#btn_messagelist_menu").on("click",function(){a("#messagelist_menu_ul")}),j$("#btn_messagelist_menu").attr("title",stringres.get("hint_menu")),j$("#msglist_btnback").attr("title",stringres.get("hint_btnback")),j$("#btn_newmessage").on("click",function(){n()})}catch(t){common.PutToDebugLogException(2,"_messagelist: onCreate",t)}}function t(e){try{common.PutToDebugLog(4,"EVENT, _messagelist: onStart"),global.isMessagelistStarted=!0,j$("#btn_newmessage").html(stringres.get("btn_new_message")),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_messagelist"),-30)),common.isNull(document.getElementById("msglist_title"))||(document.getElementById("msglist_title").innerHTML=stringres.get("msglist_title")),j$("#msglist_title").attr("title",stringres.get("hint_page")),common.isNull(document.getElementById("msglist_btnback"))||(document.getElementById("msglist_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("go_back_btn_txt")),i(),common.HideMessageNotifications2(),common.IsIeVersion(10)&&j$("#messagelist_list").children().css("line-height","normal"),common.IsIeVersion(10)&&j$("#messagelist_notification_list").children().css("line-height","normal"),j$("#messagelist_notification_list").height(common.GetDeviceHeight()-55),s()}catch(t){common.PutToDebugLogException(2,"_messagelist: onStart",t)}}function i(){try{j$("#page_messagelist").css("min-height","auto");var e=common.GetDeviceWidth()-j$("#messagelist_additional_header_left").width()-j$("#messagelist_additional_header_right").width(),t=common.StrToIntPx(j$("#messagelist_additional_header_left").css("margin-left"));(common.isNull(t)||0===t)&&(t=10),t=Math.ceil(6*t),e=Math.floor(e-t)-20;var i=common.GetDeviceHeight()-j$("#messagelist_header").height()-j$("#btn_newmessage_container").height();i=Math.floor(i-3),j$("#messagelist_list").height(i)}catch(s){common.PutToDebugLogException(2,"_messagelist: MeasureMessagelist",s)}}function s(){try{if(common.isNull(document.getElementById("messagelist_list")))return void common.PutToDebugLog(2,"ERROR, _messagelist: PopulateList listelement is null");j$("#messagelist_list").html("");var e=common.GetParameter("messagefiles");if(common.isNull(e)||e.length<3)return void common.PutToDebugLog(3,"EVENT, _messagelist: PopulateList no message files");common.PutToDebugLog(2,"EVENT, _messagelist Starting populate list");var t=[];!common.isNull(e)&&e.length>0&&(t=e.split(","));for(var i="",s=0;s<t.length;s++)if(!(common.isNull(t[s])||t[s].length<3)){var o=t[s].substring(t[s].lastIndexOf("_")+1),n=t[s].substring(0,t[s].indexOf("_")),a="",m=0,l=o.indexOf("[#");if(l>0){var g=o.substring(l+2,o.length);o=o.substring(0,l);try{m=common.StrToInt(common.Trim(g))}catch(u){}}var c=common.GetContactNameFromNumber(o);!common.isNull(m)&&m>0&&(a='<span class="ui-li-count">'+m+"</span>"),(common.isNull(c)||c.length<1)&&(c=o);var r='<li id="msgitem_'+s+'"><a class="msg_anchor mlistitem" data-transition="slide"><div class="msg_item_container"><div class="msg_name">'+c+' - <span id="msgitemnumber_'+s+'">'+o+"</span>"+a+'</div><div id="msgtype_'+s+'" class="msg_type">'+stringres.get(n)+"</div></div></a></li>";i+=r}j$("#messagelist_list").html(""),j$("#messagelist_list").append(i).listview("refresh")}catch(_){common.PutToDebugLogException(2,"_messagelist: PopulateList",_)}}function o(e){try{if(common.isNull(e)||e.length<1)return void common.PutToDebugLog(2,"ERROR, _messagelist OnListItemClick id is NULL");var t="",i=e.indexOf("_");if(i<2)return void common.PutToDebugLog(2,"ERROR, _messagelist OnListItemClick invalid id");t=common.Trim(e.substring(i+1));var s=j$("#msgitemnumber_"+t).html();s=common.isNull(s)?"":common.Trim(s);var o=j$("#msgtype_"+t).html();o=common.isNull(o)?stringres.get("chat"):common.Trim(o);var n="";o===stringres.get("chat")?n="chat":o===stringres.get("sms")&&(n="sms"),common.PutToDebugLog(4,"EVENT, _messagelist: OnListItemClick: action: "+n+"; to: "+s),global.intentmsg[0]="action="+n,global.intentmsg[1]="to="+s,global.intentmsg[2]="message=",common.GetParameter("devicetype")===common.DEVICE_WIN_SOFTPHONE()?j$.mobile.changePage("#page_message",{transition:"none",role:"page"}):j$.mobile.changePage("#page_message",{transition:"slide",role:"page"})}catch(a){common.PutToDebugLogException(2,"_messagelist: OnListItemClick",a)}}function n(){try{common.StartMsg("","","_messagelist")}catch(e){common.PutToDebugLogException(2,"_messagelist: NewMessage",e)}}function a(e){try{return common.IsWindowsSoftphone()&&j$("#btn_messagelist_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _messagelist: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _messagelist: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+r+'"><a data-rel="back">'+stringres.get("btn_new_message")+"</a></li>").listview("refresh"),j$(e).append('<li id="'+u+'"><a data-rel="back">'+stringres.get("delete_text")+"</a></li>").listview("refresh"),!0)}catch(t){common.PutToDebugLogException(2,"_messagelist: CreateOptionsMenu",t)}return!1}function m(e){try{if(common.isNull(e)||e.length<1)return;j$("#messagelist_menu").on("popupafterclose",function(t){switch(j$("#messagelist_menu").off("popupafterclose"),e){case r:n();break;case u:l()}})}catch(t){common.PutToDebugLogException(2,"_messagelist: MenuItemSelected",t)}}function l(e){try{var t=common.GetParameter("messagefiles");if(common.isNull(t)||t.length<3)return void common.ShowToast(stringres.get("err_msg_7"));var i=common.GetDeviceWidth();i=!common.isNull(i)&&common.IsNumber(i)&&i>100?Math.floor(i/1.2):220;var o='<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:'+i+'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">'+stringres.get("delete_text")+'</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> '+stringres.get("delete_all_msg_alert")+' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_ok" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">'+stringres.get("btn_ok")+'</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">'+stringres.get("btn_cancel")+"</a></div></div>";e=e||function(){},j$.mobile.activePage.append(o).trigger("create"),j$.mobile.activePage.find(".closePopup").bind("tap",function(e){j$.mobile.activePage.find(".messagePopup").popup("close")}),j$.mobile.activePage.find(".messagePopup").bind({popupbeforeposition:function(){j$(this).unbind("popupbeforeposition");var e=Math.floor(.6*common.GetDeviceHeight());j$(this).height()>e&&j$(".messagePopup .ui-content").height(e)}}),j$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({popupafterclose:function(){j$(this).unbind("popupafterclose").remove(),j$("#btn_adialog_ok").off("click"),e()}}),j$("#btn_adialog_ok").on("click",function(){for(var e=t.split(","),i=0;i<e.length;i++)if(!(common.isNull(e[i])||e[i].length<3)){var o=e[i].indexOf("[#");o>0&&(e[i]=e[i].substring(0,o)),global.File.DeleteFile(e[i],function(t){common.PutToDebugLog(3,"EVENT, _messagelist: ClearAllHistory DeleteFile: "+e[i]+" status: "+t.toString())})}common.SaveParameter("messagefiles",""),s()})}catch(n){common.PutToDebugLogException(2,"_messagelist: ClearAllHistory",n)}}function g(e){try{common.PutToDebugLog(4,"EVENT, _messagelist: onStop"),global.isMessagelistStarted=!1}catch(t){common.PutToDebugLogException(2,"_messagelist: onStop",t)}}function c(e){}var r="#menuitem_messagelist_newmessage",u="#menuitem_messagelist_delete";return{onCreate:e,onStart:t,onStop:g,onDestroy:c}}();