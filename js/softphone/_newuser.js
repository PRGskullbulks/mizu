wpa._newuser=function(){function e(e){try{common.PutToDebugLog(4,"EVENT, _newuser: onCreate"),j$(window).resize(function(){"page_newuser"===j$.mobile.activePage.attr("id")&&o()}),j$("#newuser_menu_ul").on("click","li",function(e){d(j$(this).attr("id"))}),j$("#btn_newuser_menu").on("click",function(){c("#newuser_menu_ul")}),j$("#btn_newuser_menu").attr("title",stringres.get("hint_menu")),j$("#btn_create_newuser").on("click",function(){r()}),j$("#btn_cancel_newuser").on("click",function(){j$.mobile.back()})}catch(n){common.PutToDebugLogException(2,"_newuser: onCreate",n)}}function n(e){try{common.PutToDebugLog(4,"EVENT, _newuser: onStart"),global.isNewuserStarted=!0,common.isNull(document.getElementById("newuser_title"))||(document.getElementById("newuser_title").innerHTML=stringres.get("newuser_title")),j$("#newuser_title").attr("title",stringres.get("hint_page")),common.isNull(document.getElementById("newuser_btnback"))||(document.getElementById("newuser_btnback").innerHTML="<b>&LT;</b>&nbsp;"+stringres.get("go_back_btn_txt")),common.isNull(document.getElementById("btn_create_newuser"))||(document.getElementById("btn_create_newuser").innerHTML=stringres.get("btn_create")),common.isNull(document.getElementById("btn_cancel_newuser"))||(document.getElementById("btn_cancel_newuser").innerHTML=stringres.get("btn_cancel"));var n=document.getElementById("nu_password");if(!common.isNull(n)){var m=common.GetParameterInt("autogenpassword",0);if(m>0){var r=common.RandomStr(12,!1,!0);common.PutToDebugLog(4,"EVENT, _newuser autogenpassword: "+r),n.value=r,m>1&&(n.readOnly=!0)}}global.nuiswebpage=null,o(),t()}catch(l){common.PutToDebugLogException(2,"_newuser: onStart",l)}}function o(){try{if(j$("#page_newuser").css("min-height","auto"),j$(".separator_line_thick").css("background-color",common.HoverCalc(common.getBgColor("#page_newuser"),-30)),common.NuIsWebPage()){var e=common.GetDeviceHeight()-j$("#newuser_header").height();e-=3,e=Math.floor(e),j$("#page_newuser_content").height(e),j$("#page_newuser").css("padding-bottom","0px"),j$("#iframe_nubrowser").width(common.GetDeviceWidth()),j$("#iframe_nubrowser").height(e-5)}else{var n=common.GetDeviceHeight()-j$("#newuser_header").height()-j$("#newuser_footer").height();n-=3,n=Math.floor(n),j$("#page_newuser_content").height(n)}}catch(o){common.PutToDebugLogException(2,"_newuser: MeasureNewuser",o)}}function t(){try{var e=common.GetParameter("newuser");if(common.isNull(e)&&(e=""),e=common.Trim(e),common.NuIsWebPage())return j$("#newuser_content_form").hide(),j$("#newuser_footer").hide(),o(),m(e),void o();var n=common.GetParameter("newuser_username_label");(common.isNull(n)||n.length<2)&&(n=stringres.get("nu_username")),j$("#label_nu_username").html("*"+n),j$("#label_nu_password").html("*"+stringres.get("nu_password")),j$("#label_nu_passwordverify").html("*"+stringres.get("nu_password_verify")),j$("#label_nu_email").html(stringres.get("nu_email")),j$("#label_nu_fullname").html(stringres.get("nu_fullname")),j$("#label_nu_firstname").html(stringres.get("nu_firstname")),j$("#label_nu_lastname").html(stringres.get("nu_lastname")),j$("#label_nu_phone").html(stringres.get("nu_phone")),j$("#label_nu_address").html(stringres.get("nu_address")),j$("#label_nu_country").html(stringres.get("nu_country")),j$("#label_nu_birthday").html(stringres.get("nu_birthday")),j$("#label_nu_gender").html(stringres.get("nu_gender")),j$("#label_nu_fpq").html(stringres.get("nu_fpq")),j$("#label_nu_fpa").html(stringres.get("nu_fpa"));var t=common.GetConfig("newuserform"),r=common.GetConfig("newusercountrylist");if(!common.isNull(t)&&t.length>0)!common.isNull(r)&&r.length>4?(common.UriParser(r,"","","","","get_new_user_countrylist"),p=setInterval(function(){if(++f>600)return f=0,common.isNull(p)||clearInterval(p),p=null,void common.PutToDebugLog(2,"ERROR, newuser: PopulateData: waiting for countrylist timeouted");!0===h&&(h=!1,f=0,common.isNull(p)||clearInterval(p),p=null,common.UriParser(t,"","","","","get_new_user_form_fields"))},200)):common.UriParser(t,"","","","","get_new_user_form_fields");else if(e.length>0){var l=common.GetUrlParamVal(e,"DISPLAYFIELDS");if(!common.isNull(l)&&l.length>0){l=l.toLowerCase();var a=l.split(",");a.indexOf("username")>=0&&(document.getElementById("nu_username_container").style.display="block"),a.indexOf("password")>=0&&(document.getElementById("nu_password_container").style.display="block"),a.indexOf("passwordverify")>=0&&(document.getElementById("nu_passwordverify_container").style.display="block"),a.indexOf("firstname")>=0&&(document.getElementById("nu_firstname_container").style.display="block"),a.indexOf("lastname")>=0&&(document.getElementById("nu_lastname_container").style.display="block"),a.indexOf("name")>=0&&(document.getElementById("nu_fullname_container").style.display="block"),(a.indexOf("mail")>=0||a.indexOf("email")>=0)&&(document.getElementById("nu_email_container").style.display="block"),a.indexOf("phone")>=0&&(document.getElementById("nu_phone_container").style.display="block"),a.indexOf("address")>=0&&(document.getElementById("nu_address_container").style.display="block"),a.indexOf("country")>=0&&(document.getElementById("nu_country_container").style.display="block"),a.indexOf("gender")>=0&&(document.getElementById("nu_gender_container").style.display="block"),a.indexOf("forgotpasswordquestion")>=0&&(document.getElementById("nu_fpq_container").style.display="block"),a.indexOf("forgotpasswordanswer")>=0&&(document.getElementById("nu_fpa_container").style.display="block");var i=common.GetUrlParamVal(e,"EXTRAFIELDCAPTION"),s=common.GetUrlParamVal(e,"EXTRAFIELDKEY");!common.isNull(i)&&i.length>0&&!common.isNull(s)&&s.length>0&&(document.getElementById("nu_extra_container").style.display="block",j$("#label_nu_extra").html(i))}else e.indexOf("USERNAME")>=0&&(document.getElementById("nu_username_container").style.display="block"),e.indexOf("PASSWORD")>=0&&(document.getElementById("nu_password_container").style.display="block"),e.indexOf("MAIL")>=0&&(document.getElementById("nu_email_container").style.display="block"),e.indexOf("NAME")>=0&&(document.getElementById("nu_fullname_container").style.display="block"),e.indexOf("PHONE")>=0&&(document.getElementById("nu_phone_container").style.display="block"),e.indexOf("ADDRESS")>=0&&(document.getElementById("nu_address_container").style.display="block"),e.indexOf("COUNTRY")>=0&&(document.getElementById("nu_country_container").style.display="block"),e.indexOf("BIRTHDAY")>=0&&(document.getElementById("nu_birthday_container").style.display="block"),e.indexOf("GENDER")>=0&&(document.getElementById("nu_gender_container").style.display="block"),e.indexOf("FORGOTPASSWORDQUESTION")>=0&&(document.getElementById("nu_fpq_container").style.display="block"),e.indexOf("FORGOTPASSWORDANSWER")>=0&&(document.getElementById("nu_fpa_container").style.display="block")}}catch(u){common.PutToDebugLogException(2,"_newuser: PopulateData",u)}}function m(e){try{if(common.isNull(e)||e.length<3)return void common.PutToDebugLog(3,"ERROR, _newuser no url to load: "+e);if(0===e.toLowerCase().indexOf("http://")&&!0===common.IsHttps())return void window.open(e,"_blank","location=yes,height="+common.GetDeviceHeight()+",width="+common.GetDeviceWidth());var n=common.GetDeviceWidth(),o=Math.floor(j$("#page_newuser_content").height()-5),t="",m=e.indexOf("[POST]");if(m>0){var r=common.Trim(e.substring(0,m)),l=common.Trim(e.substring(m+6)),a=[],i="";!common.isNull(l)&&l.length>0&&(a=l.split("&"),common.isNull(a)&&(a=[]));for(var s=0;s<a.length;s++)if(!(common.isNull(a[s])||a[s].length<2||a[s].indexOf("=")<1)){var c=a[s].substring(0,a[s].indexOf("=")),d=a[s].substring(a[s].indexOf("=")+1);common.isNull(c)||c.length<1||common.isNull(d)||(i+='<input type="hidden" name="'+c+'" value="'+d+'"/>')}common.PutToDebugLog(2,"EVENT, OpenWebPageNU, new user POST url in iframe: "+r),t='<form id="internalb_post" target="iframe_nubrowser" method="post" action="'+r+'" style="margin: 0; padding: 0;">'+i+'</form><iframe  allow="microphone; camera" frameborder="0" width="'+n+'" height="'+o+'" name="iframe_nubrowser" id="iframe_nubrowser" style="margin:0px; padding:0px;" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation allow-modals"></iframe><script type="text/javascript">document.getElementById("internalb_post").submit();<\/script>'}else common.PutToDebugLog(2,"EVENT, OpenWebPageNU, new user GET url in iframe: "+e),t='<iframe allow="microphone; camera" frameborder="0" width="'+n+'" height="'+o+'" src="'+e+'" name="iframe_nubrowser" id="iframe_nubrowser" style="margin:0px; padding:0px;" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation allow-modals"></iframe>';j$("#page_newuser_content").html(t),document.getElementById("iframe_nubrowser").onload=u}catch(g){common.PutToDebugLogException(2,"_newuser: OpenWebPageNU",g)}}function r(){try{var e=common.GetConfig("newuserform");if(!common.isNull(e)&&e.length>0){for(var n=[],o=[],t=null,m=0;m<w.length;m++)if(t=w[m],!(common.isNull(t)||t.length<4)){var r=t[y],l=t[b],i=t[v],s=t[P],u=t[T],c="";common.isNull(u)&&(u=""),u=u.toString(),u=common.Trim(u),u=u.toLowerCase();var d=1e3+m,g=d.toString();if(u.length<1||"text"===u||"email"===u)c=j$("#nu_"+g).val();else if("select"===u&&(c=j$("#nu_"+g+" option:selected").val(),50===common.GetConfigInt("brandid",-1)&&!common.isNull(c)&&c.length>0&&!common.isNull(E)&&E.length>0&&!common.isNull(N)&&N.length>0))for(var _=0;_<E.length;_++)E[_]===c&&N.length>_&&(c=N[_],common.PutToDebugLog(4,"EVENT, _newuser create-account with country: "+c));if(common.isNull(c)&&(c=""),c=common.Trim(c),common.isNull(i)&&(i=""),i=i.toString(),c.length<1&&!common.isNull(i)&&i.length>0&&(i=i.toLowerCase(),i.indexOf("yes")>=0||i.indexOf("true")>=0||i.indexOf("1")>=0))return void common.ShowToast(stringres.get("newuser_pleaseenter")+" "+l);if(common.isNull(s)&&(s=""),s=s.toString(),s=s.toLowerCase(),s.indexOf("yes")>=0||s.indexOf("true")>=0||s.indexOf("1")>=0||s.indexOf("mail")>=0){var p=!0;if(s.indexOf("mail")>=0||r.indexOf("mail")>=0?common.isNull(c.match("^[_A-Za-z0-9-]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9|-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$"))&&(p=!1):(s.indexOf("user")>=0||r.indexOf("user")>=0||s.indexOf("password")>=0||r.indexOf("password")>=0)&&common.isNull(c.match("^[A-Za-z0-9_-]{2,40}$"))&&(p=!1),!1===p)return void common.ShowToast(stringres.get("newuser_invalid")+" "+l)}n.push(r),o.push(c)}for(var f="",m=0;m<n.length;m++){var r=n[m],c=o[m];common.isNull(r)||r.length<1||common.isNull(c)||(f.length>0&&(f+="&"),c.indexOf("@")>0&&c.indexOf(".")>0||(c=encodeURIComponent(c)),f=f+r+"="+c)}var h=common.GetConfig("newuser");if(50===common.GetConfigInt("brandid",-1)){var O=platform.name,R=platform.version;(common.isNull(O)||"Android"===common.GetOs())&&(O=common.GetBrowser()),common.isNull(R)&&(R=common.GetBrowserVersion());var I=platform.os;(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream&&(I="iOS "+common.GetBrowserVersion());var D="version_name:"+common.GetVersionStr()+"-version_code:"+global.code_version+"-os_version:"+I+"-make:"+O+"-model:"+R;D=encodeURIComponent(D),f=f+"&device="+D,f+="&dialer=webphone"}return 50===common.GetConfigInt("brandid",-1)||h.indexOf("?")<1&&(f="?"+f),h=h.replace("[DYNAMIC_PARAMS]",f),void common.UriParser(h,"","","","","newuser_dynamic")}var S=document.getElementById("nu_username").value,L=document.getElementById("nu_password").value,x=document.getElementById("nu_email").value,G=document.getElementById("nu_fullname").value,U=document.getElementById("nu_firstname").value,A=document.getElementById("nu_lastname").value,B=document.getElementById("nu_phone").value,C=document.getElementById("nu_address").value,$=document.getElementById("nu_country").value,V=document.getElementById("nu_birthday").value,j=document.getElementById("nu_gender").value,M=document.getElementById("nu_fpq").value,H=document.getElementById("nu_fpa").value,k=document.getElementById("nu_extra").value;if(S=common.isNull(S)?"":common.Trim(S),L=common.isNull(L)?"":common.Trim(L),x=common.isNull(x)?"":common.Trim(x),G=common.isNull(G)?"":common.Trim(G),U=common.isNull(U)?"":common.Trim(U),A=common.isNull(A)?"":common.Trim(A),B=common.isNull(B)?"":common.Trim(B),C=common.isNull(C)?"":common.Trim(S),$=common.isNull($)?"":common.Trim($),V=common.isNull(V)?"":common.Trim(V),j=common.isNull(j)?"":common.Trim(j),M=common.isNull(M)?"":common.Trim(M),H=common.isNull(H)?"":common.Trim(H),k=common.isNull(k)?"":common.Trim(k),"block"===document.getElementById("nu_username_container").style.display){if(common.isNull(S)||S.length<1)return void common.ShowToast(stringres.get("err_msg_8"));if(S.length<common.MIN_USR_PWD_LENGHT)return void common.ShowToast(stringres.get("err_msg_13")+" "+common.MIN_USR_PWD_LENGHT);if(common.isNull(S.match("^[A-Za-z0-9_-]{2,120}$"))||S.match("^[A-Za-z0-9_-]{2,120}$")[0].length<1)return void common.ShowToast(stringres.get("err_msg_14"))}if("block"===document.getElementById("nu_password_container").style.display){if(common.isNull(L)||L.length<1)return void common.ShowToast(stringres.get("err_msg_9"));if(L.length<common.MIN_USR_PWD_LENGHT)return void common.ShowToast(stringres.get("err_msg_15")+" "+common.MIN_USR_PWD_LENGHT);if(common.isNull(L.match("^[A-Za-z0-9_-]{2,120}$"))||L.match("^[A-Za-z0-9_-]{2,120}$")[0].length<1)return void common.ShowToast(stringres.get("err_msg_16"))}if("block"===document.getElementById("nu_phone_container").style.display&&B.length>0){if(B.length<5)return void common.ShowToast(stringres.get("err_msg_19"));if(common.isNull(B.match("^[0-9+]{3,25}$"))||B.match("^[0-9+]{3,25}$")[0].length<1)return void common.ShowToast(stringres.get("err_msg_19"))}B=common.ReplaceAll(B," ",""),G=encodeURIComponent(G),U=encodeURIComponent(U),A=encodeURIComponent(A),B=encodeURIComponent(B),C=encodeURIComponent(C),$=encodeURIComponent($),V=encodeURIComponent(V),j=encodeURIComponent(j),M=encodeURIComponent(M),H=encodeURIComponent(H);var W=common.GetParameter("newuser");W=W.replace("[USERNAME]",S),W=W.replace("USERNAME",S),W=W.replace("USRNAME",S),W=W.replace("[PASSWORD]",L),W=W.replace("PASSWORD",L),W=W.replace("[EMAIL]",x),W=W.replace("EMAIL",x),W=W.replace("[MAIL]",x),W=W.replace("MAIL",x),W=W.replace("FIRSTNAME",U),W=W.replace("LASTNAME",A),W=W.replace("[NAME]",G),W=W.replace("NAME",G),W=W.replace("[PHONE]",B),W=W.replace("PHONE",B),W=W.replace("[ADDRESS]",C),W=W.replace("ADDRESS",C),W=W.replace("CURRENCY",""),W=W.replace("DEVICEID",common.GetDeviceId()),W=W.replace("COUNTRY",$),W=W.replace("BIRTHDAY",V),W=W.replace("GENDER",j),W=W.replace("FORGOTPASSWORDQUESTION",M),W=W.replace("FORGOTPASSWORDANSWER",H);var Y=common.GetUrlParamVal(a(),"EXTRAFIELDKEY");!common.isNull(Y)&&Y.length>0&&(W=W.replace(Y,k)),!common.isNull(x)&&x.length>0&&common.SaveParameter("email",x),!common.isNull(G)&&G.length>0&&common.SaveParameter("displayname",G),!common.isNull(S)&&S.length>0&&common.SaveParameter("sipusername",S),!common.isNull(L)&&L.length>0&&common.SaveParameter("password",L),common.UriParser(W,"","","","","newuserreg"),common.PutToDebugLog(4,"EVENT, _newuser CreateUser uri: "+W)}catch(J){common.PutToDebugLogException(2,"_newuser: CreateUser",J)}}function l(e,n){try{if("newuserreg"===n){e.toLowerCase().indexOf("error")>=0&&common.PutToDebugLog(2,"ERROR, HttpResponseHandler action: newuserreg, error: "+e);var o=!1;i().length>3&&(o=!0);var t=e.toLowerCase(),m=a(),r=common.GetUrlParamVal(m,"ERRORSTRING");common.isNull(r)&&(r=""),r=r.toLowerCase();var l=common.GetJsonParamVal(e,"message:");if((common.isNull(l)||l.length<1)&&(l=common.GetJsonParamVal(e,"msg:")),(common.isNull(l)||common.Trim(l).length<1)&&(l=e),e.length<1||t.indexOf("error")>=0||t.indexOf(r)>=0)return common.PutToDebugLog(2,"ERROR, New user creation failed: "+e),common.PutToDebugLog(1,"ERROR,"+l),void common.ShowToast(l);var u=common.GetUrlParamVal(m,"SUCCESSSTRING");if(common.isNull(u)&&(u=""),u=u.toLowerCase(),u.length>0){if(!(t.indexOf(u)>=0))return common.PutToDebugLog(1,"ERROR,"+l),common.PutToDebugLog(2,"ERROR, New user creation failed, does not contain SUCCESSSTRING"+e),void common.ShowToast(l);common.PutToDebugLog(1,"EVENT,"+l),common.PutToDebugLog(2,"EVENT, New user creation SUCCEDED"+e)}var c=common.GetJsonParamVal(e,"user_id:");(common.isNull(c)||c.length<1)&&(c=common.GetJsonParamVal(e,"userid:")),!common.isNull(c)&&c.length>0&&common.SaveParameter("userid",c);var d=commonGetUrlParamVal(m,"USERID_BEGIN"),g=commonGetUrlParamVal(m,"USERID_END"),_=commonGetUrlParamVal(m,"USERNAME_BEGIN"),p=commonGetUrlParamVal(m,"USERNAME_END"),f=commonGetUrlParamVal(m,"PASSWORD_BEGIN"),y=commonGetUrlParamVal(m,"PASSWORD_END"),b=commonGetUrlParamVal(m,"CALLERID_BEGIN"),T=commonGetUrlParamVal(m,"CALLERID_END"),v=commonGetUrlParamVal(m,"NAME_BEGIN"),P=commonGetUrlParamVal(m,"NAME_END"),O=commonGetUrlParamVal(m,"EMAIL_BEGIN"),R=commonGetUrlParamVal(m,"EMAIL_END"),I="",D="";if(O.length>0&&R.length>0&&e.indexOf(O)>=0&&e.indexOf(R)>0){var S=e.substring(e.indexOf(O)+O.length,e.indexOf(R));common.SaveParameter("email",S),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW email saved: "+S)}if(v.length>0&&P.length>0&&e.indexOf(v)>=0&&e.indexOf(P)>0){var L=e.substring(e.indexOf(v)+v.length,e.indexOf(P));common.SaveParameter("name",L),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW name saved: "+L)}if(b.length>0&&T.length>0&&e.indexOf(b)>=0&&e.indexOf(T)>0){var x=e.substring(e.indexOf(b)+b.length,e.indexOf(T));common.SaveParameter("username",x),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW callerid saved: "+x)}if(d.length>0&&g.length>0&&e.indexOf(d)>=0&&e.indexOf(g)>0){var G=e.substring(e.indexOf(d)+d.length,e.indexOf(g));common.SaveParameter("userid",G),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW userid saved: "+G)}_.length>0&&p.length>0&&e.indexOf(_)>=0&&e.indexOf(p)>0&&(I=e.substring(e.indexOf(_)+_.length,e.indexOf(p))),f.length>0&&y.length>0&&e.indexOf(f)>=0&&e.indexOf(y)>0&&(D=e.substring(e.indexOf(f)+f.length,e.indexOf(y))),(common.isNull(I)||I.length<1)&&(I=common.GetJsonParamVal(e,"sip_username"),(common.isNull(I)||I.length<1)&&(I=common.GetJsonParamVal(e,"sipusername")),(common.isNull(I)||I.length<1)&&(I=common.GetJsonParamVal(e,"username")),common.isNull(I)&&(I="")),(common.isNull(D)||D.length<1)&&(D=common.GetJsonParamVal(e,"sip_password"),(common.isNull(D)||D.length<1)&&(D=common.GetJsonParamVal(e,"sippassword")),(common.isNull(D)||D.length<1)&&(D=common.GetJsonParamVal(e,"password")),common.isNull(D)&&(D="")),!0===o||(common.SaveParameter("username",I),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW username saved: "+I)),!0===o||(common.SaveParameter("password",D),common.PutToDebugLog(2,"EVENT,newusersignup VerifyThreadHandler NEW password saved: "+D)),!0===o?(j$.mobile.back(),global.intentsmscodeverify[0]="username="+I,global.intentsmscodeverify[1]="password="+D,global.intentsmscodeverify[2]="smsverify_answer="+e,global.intentsmscodeverify[2]="smsverify_userid="+c,j$.mobile.changePage("#page_smscodeverify",{transition:"pop",role:"page"})):(!common.isNull(l)&&l.length>0&&(common.PutToDebugLog(2,"EVENT, newusersignup threadHandler display status message: "+l),common.ShowToast(l)),j$.mobile.back())}else if("get_new_user_countrylist"===n){if(e.indexOf("HttpRequest exception")>=0)return void common.ShowToast("Can't load country list.");if(50===common.GetConfigInt("brandid",-1)){var U=JSON.parse(e),A=U.data,B=U.error;if(!common.isNull(B)&&B.length>0)return common.PutToDebugLog(3,"ERROR, newuserreg get countrylist httpresponsehandler rec error: "+B),void common.ShowToast(B);if(common.isNull(A)||A.length<1)return common.PutToDebugLog(3,"ERROR, newuserreg get countrylist httpresponsehandler data is NULL"),void common.ShowToast("Can't load country list.");E=[],N=[],E.push(""),N.push("");for(var C=0;C<A.length;C++)if(U=A[C],!common.isNull(U)&&!common.isNull(U.n)&&!common.isNull(U.c)){var L=U.n,$=U.c;common.isNull(L)&&(L=""),E.push(L),N.push($)}}h=!0}else if("get_new_user_form_fields"===n){if(w=[],"string"==typeof e&&e.indexOf("HttpRequest exception")>=0)return void common.ShowToast("Can't load fileds. Please try again later.");if(50===common.GetConfigInt("brandid",-1)){var U=JSON.parse(e),A=U.data,B=U.error,V=U.data,B=U.error;if(!common.isNull(B)&&B.length>0)return common.PutToDebugLog(3,"ERROR, newuserreg httpresponsehandler rec error: "+B),void common.ShowToast(B);if(common.isNull(V))return common.PutToDebugLog(3,"ERROR, newuserreg httpresponsehandler data is NULL"),void common.ShowToast("Can't load form.");var A=V.fields;if(common.isNull(A)||A.length<1)return;for(var C=0;C<A.length;C++)if(U=A[C],!common.isNull(U)&&!(common.isNull(U.name)||common.isNull(U.displayName)||common.isNull(U.type)||common.isNull(U.value)||common.isNull(U.mandatory)||common.isNull(U.validation))){var L=U.name,j=U.displayName,M=U.type,H=U.value,k=U.mandatory,W=U.validation;common.PutToDebugLog(2,"name: "+L),common.PutToDebugLog(2,"displayName: "+j),common.PutToDebugLog(2,"type: "+M),common.PutToDebugLog(2,"defvalue: "+H),common.PutToDebugLog(2,"mandatory: "+k),common.PutToDebugLog(2,"validation: "+W),common.PutToDebugLog(2,"----------------------------------"),common.isNull(L)&&(L=""),common.isNull(j)&&(j=""),common.isNull(M)&&(M=""),common.isNull(H)&&(H=""),common.isNull(k)&&(k=""),common.isNull(W)&&(W=""),L=common.Trim(L),j=common.Trim(j),M=common.Trim(M),H=common.Trim(H),k=common.Trim(k),W=common.Trim(W);var Y=[];Y.push(L),Y.push(j),Y.push(M),Y.push(H),Y.push(k),Y.push(W),w.push(Y)}}s()}else if("newuser_dynamic"===n)try{if(50===common.GetConfigInt("brandid",-1)){var U=JSON.parse(e),V=U.data,B=U.error;if(!common.isNull(B)&&B.length>0)return common.PutToDebugLog(3,"ERROR, newuser_dynamic httpresponsehandler rec error: "+B),void common.ShowToast(B);if(common.isNull(V))return common.PutToDebugLog(3,"ERROR, newuser_dynamic httpresponsehandler data is NULL"),void common.ShowToast("Can't create user.");var J=V.Login,z=V.Password;common.isNull(J)&&(J=""),common.isNull(z)&&(z=""),common.SaveParameter("sipusername",J),common.SaveParameter("password",z),J.length>0&&z.length>0&&(global.favafone_autologin=!0),j$.mobile.back()}else common.PutToDebugLog(2,"ERROR, _newuser: HttpResponseHandler newuser_dynamic parse resp NOT HANDLED")}catch(F){common.PutToDebugLogException(2,"_newuser: HttpResponseHandler newuser_dynamic parse resp",F)}}catch(Z){common.PutToDebugLogException(2,"_newuser: HttpResponseHandler",Z)}}function a(){try{var e=common.GetParameter("newuser");return common.isNull(e)&&(e=""),e=decodeURIComponent(e),common.Trim(e)}catch(n){common.PutToDebugLogException(2,"_newuser: GetUriNU",n)}return""}function i(){try{var e=common.GetParameter("newuser_second");return(common.isNull(e)||e.length<1)&&(e=common.GetConfig("newuser_second")),common.isNull(e)&&(e=""),e=decodeURIComponent(e),common.Trim(e)}catch(n){common.PutToDebugLogException(2,"_newuser: GetUriSecondNU",n)}return""}function s(){var e="";try{var n=common.GetConfig("newuserform");if(common.isNull(n)||n.length<1)return;if(common.isNull(w)||w.length<1)return void common.PutToDebugLog(3,"ERROR,newuserreg PopulateDynamicFields list is empty");for(var t=null,m=0;m<w.length;m++)if(t=w[m],!(common.isNull(t)||t.length<4)){var r=t[y],l=t[b],a=t[v],i=t[T],s='<div id="nu_[ENTRYID]_container"><span id="label_nu_[ENTRYID]">[LABEL]</span><input name="nu_[ENTRYID]" id="nu_[ENTRYID]" value="" type="text" autocapitalize="off"></div>';if(common.isNull(a)&&(a=""),a=a.toString(),!common.isNull(a)&&a.length>0&&(a=a.toLowerCase(),(a.indexOf("yes")>=0||a.indexOf("true")>=0||a.indexOf("1")>=0)&&(l="*"+l)),common.isNull(i)&&(i=""),i=common.Trim(i),i.length<1||"text"===i||"email"===i){var u=1e3+m,c=u.toString();s=common.ReplaceAll(s,"[ENTRYID]",c),s=s.replace("[LABEL]",l),e+=s}else if("select"===i){s='<div id="nu_[ENTRYID]_container"><span id="label_nu_[ENTRYID]">[LABEL]</span><select name="nu_[ENTRYID]" id="nu_[ENTRYID]" style="margin: 0;">[SELECTCONTENT]</select></div>';var u=1e3+m,c=u.toString();s=common.ReplaceAll(s,"[ENTRYID]",c),s=s.replace("[LABEL]",l);var d="";if("country"===r&&!common.isNull(E)&&E.length>0)for(var g=0;g<E.length;g++){var _='<option value="[VALUE]">[TEXT]</option>';_=_.replace("[VALUE]",E[g]),_=_.replace("[TEXT]",E[g]),d+=_}s=s.replace("[SELECTCONTENT]",d),e+=s}}e="<form>"+e+"</form>",j$("#page_newuser_content").html(e).trigger("create"),o(),setTimeout(function(){o()},250)}catch(p){common.PutToDebugLogException(2,"_newuser: PopulateDynamicFields",p)}}function u(){try{if(common.NuIsWebPage()){var e=document.getElementById("iframe_nubrowser"),n=null;common.isNull(e)||(n=e.contentDocument||e.contentWindow.document);if(!common.isNull(n)){e.location&&e.location.href&&common.PutToDebugLog(2,"EVENT, _newuser IframeOnLoad new location: "+e.location.href);var o="";"undefined"!=typeof n.documentElement&&null!==n.documentElement&&("undefined"!=typeof n.documentElement.innerHTML&&null!==n.documentElement.innerHTML?(o=n.documentElement.innerHTML.toString(),common.isNull()&&(o=""),o=common.Trim(o),common.HandleNewUserResult(o,n.documentElement)):"undefined"!=typeof n.body.innerHTML&&null!==n.body.innerHTML&&(o=n.body.innerHTML.toString(),common.isNull()&&(o=""),o=common.Trim(o),common.HandleNewUserResult(o,n)))}}}catch(t){common.PutToDebugLogException(2,"_newuser: IframeOnLoad",t)}}function c(e){try{return common.IsWindowsSoftphone()&&j$("#btn_newuser_menu").removeAttr("data-transition"),common.isNull(e)||e.lenght<1?void common.PutToDebugLog(2,"ERROR, _newuser: CreateOptionsMenu menuid null"):j$(e).length<=0?void common.PutToDebugLog(2,"ERROR, _newuser: CreateOptionsMenu can't get reference to Menu"):("#"!==e.charAt(0)&&(e="#"+e),j$(e).html(""),j$(e).append('<li id="'+O+'"><a data-rel="back">'+stringres.get("btn_cancel")+"</a></li>").listview("refresh"),!0)}catch(n){common.PutToDebugLogException(2,"_newuser: CreateOptionsMenu",n)}return!1}function d(e){try{if(common.isNull(e)||e.length<1)return;j$("#newuser_menu").on("popupafterclose",function(n){switch(j$("#newuser_menu").off("popupafterclose"),e){case O:j$.mobile.back()}})}catch(n){common.PutToDebugLogException(2,"_newuser: MenuItemSelected",n)}}function g(e){try{common.PutToDebugLog(4,"EVENT, _newuser: onStop"),global.isNewuserStarted=!1,global.nuiswebpage=null}catch(n){common.PutToDebugLogException(2,"_newuser: onStop",n)}}function _(e){}var p=null,f=0,h=!1,E=null,N=null,w=null,y=0,b=1,T=2,v=4,P=5,O="#menuitem_newuser_close",R={HttpResponseHandler:l,GetUriSecondNU:i};return window.newuser_public=R,{onCreate:e,onStart:n,onStop:g,onDestroy:_}}();